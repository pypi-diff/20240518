# Comparing `tmp/amilib-0.1.0.tar.gz` & `tmp/amilib-0.1.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/amilib-0.1.0.tar", last modified: Fri May 10 09:12:03 2024, max compression
+gzip compressed data, was "dist/amilib-0.1.1.tar", last modified: Fri May 17 22:04:55 2024, max compression
```

## Comparing `amilib-0.1.0.tar` & `amilib-0.1.1.tar`

### file list

```diff
@@ -1,49 +1,40 @@
-drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-05-10 09:12:03.851110 amilib-0.1.0/
--rw-r--r--   0 pm286      (503) staff       (20)    11357 2024-04-16 00:05:01.000000 amilib-0.1.0/LICENSE
--rw-r--r--   0 pm286      (503) staff       (20)      816 2024-05-10 09:12:03.850958 amilib-0.1.0/PKG-INFO
--rw-r--r--   0 pm286      (503) staff       (20)       76 2024-04-16 00:05:01.000000 amilib-0.1.0/README.md
-drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-05-10 09:12:03.846638 amilib-0.1.0/amilib/
--rw-r--r--   0 pm286      (503) staff       (20)        0 2024-04-16 00:05:01.000000 amilib-0.1.0/amilib/__init__.py
--rw-r--r--   0 pm286      (503) staff       (20)     5132 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/ami_bib.py
--rw-r--r--   0 pm286      (503) staff       (20)      287 2024-04-17 21:43:55.000000 amilib-0.1.0/amilib/ami_csv.py
--rw-r--r--   0 pm286      (503) staff       (20)   164391 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/ami_html.py
--rw-r--r--   0 pm286      (503) staff       (20)    16455 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/ami_integrate.py
--rw-r--r--   0 pm286      (503) staff       (20)     8504 2024-04-16 00:05:01.000000 amilib-0.1.0/amilib/ami_nlp.py
--rw-r--r--   0 pm286      (503) staff       (20)    81745 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/ami_pdf_libs.py
--rw-r--r--   0 pm286      (503) staff       (20)     4976 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/ami_svg.py
--rw-r--r--   0 pm286      (503) staff       (20)    10651 2024-04-16 00:05:01.000000 amilib-0.1.0/amilib/ami_util.py
--rw-r--r--   0 pm286      (503) staff       (20)     8422 2024-04-16 00:05:01.000000 amilib-0.1.0/amilib/amidriver.py
--rw-r--r--   0 pm286      (503) staff       (20)    18606 2024-05-10 09:07:53.000000 amilib-0.1.0/amilib/amix.py
--rw-r--r--   0 pm286      (503) staff       (20)    19721 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/bbox.py
--rw-r--r--   0 pm286      (503) staff       (20)    14085 2024-04-16 00:05:01.000000 amilib-0.1.0/amilib/file_lib.py
--rw-r--r--   0 pm286      (503) staff       (20)    19595 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/headless_lib.py
--rw-r--r--   0 pm286      (503) staff       (20)     4132 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/html_args.py
--rw-r--r--   0 pm286      (503) staff       (20)     1334 2024-04-23 06:25:16.000000 amilib-0.1.0/amilib/html_extra.py
--rw-r--r--   0 pm286      (503) staff       (20)    16556 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/html_generator.py
--rw-r--r--   0 pm286      (503) staff       (20)    48083 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/html_marker.py
--rw-r--r--   0 pm286      (503) staff       (20)    26477 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/pdf_args.py
--rw-r--r--   0 pm286      (503) staff       (20)    36799 2024-04-16 00:05:01.000000 amilib-0.1.0/amilib/util.py
--rw-r--r--   0 pm286      (503) staff       (20)    33690 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/wikimedia.py
--rw-r--r--   0 pm286      (503) staff       (20)    54474 2024-05-10 07:45:14.000000 amilib-0.1.0/amilib/xml_lib.py
-drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-05-10 09:12:03.847581 amilib-0.1.0/amilib.egg-info/
--rw-r--r--   0 pm286      (503) staff       (20)      816 2024-05-10 09:12:03.000000 amilib-0.1.0/amilib.egg-info/PKG-INFO
--rw-r--r--   0 pm286      (503) staff       (20)      866 2024-05-10 09:12:03.000000 amilib-0.1.0/amilib.egg-info/SOURCES.txt
--rw-r--r--   0 pm286      (503) staff       (20)        1 2024-05-10 09:12:03.000000 amilib-0.1.0/amilib.egg-info/dependency_links.txt
--rw-r--r--   0 pm286      (503) staff       (20)       44 2024-05-10 09:12:03.000000 amilib-0.1.0/amilib.egg-info/entry_points.txt
--rw-r--r--   0 pm286      (503) staff       (20)        1 2024-05-10 09:12:03.000000 amilib-0.1.0/amilib.egg-info/not-zip-safe
--rw-r--r--   0 pm286      (503) staff       (20)      125 2024-05-10 09:12:03.000000 amilib-0.1.0/amilib.egg-info/requires.txt
--rw-r--r--   0 pm286      (503) staff       (20)        7 2024-05-10 09:12:03.000000 amilib-0.1.0/amilib.egg-info/top_level.txt
--rw-r--r--   0 pm286      (503) staff       (20)       38 2024-05-10 09:12:03.851158 amilib-0.1.0/setup.cfg
--rw-r--r--   0 pm286      (503) staff       (20)     1651 2024-05-10 09:09:27.000000 amilib-0.1.0/setup.py
-drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-05-10 09:12:03.850629 amilib-0.1.0/test/
--rw-r--r--   0 pm286      (503) staff       (20)     2679 2024-04-17 00:12:33.000000 amilib-0.1.0/test/test_all.py
--rw-r--r--   0 pm286      (503) staff       (20)     3941 2024-04-18 07:09:52.000000 amilib-0.1.0/test/test_file.py
--rw-r--r--   0 pm286      (503) staff       (20)    21468 2024-05-10 08:49:13.000000 amilib-0.1.0/test/test_headless.py
--rw-r--r--   0 pm286      (503) staff       (20)   120176 2024-04-23 06:41:05.000000 amilib-0.1.0/test/test_html.py
--rw-r--r--   0 pm286      (503) staff       (20)      733 2024-04-16 00:05:02.000000 amilib-0.1.0/test/test_nlp.py
--rw-r--r--   0 pm286      (503) staff       (20)    80225 2024-05-10 08:59:13.000000 amilib-0.1.0/test/test_pdf.py
--rw-r--r--   0 pm286      (503) staff       (20)     1087 2024-04-23 06:34:10.000000 amilib-0.1.0/test/test_stat.py
--rw-r--r--   0 pm286      (503) staff       (20)     1065 2024-04-16 00:05:02.000000 amilib-0.1.0/test/test_svg.py
--rw-r--r--   0 pm286      (503) staff       (20)    10541 2024-04-18 07:00:37.000000 amilib-0.1.0/test/test_util.py
--rw-r--r--   0 pm286      (503) staff       (20)    35765 2024-04-16 00:05:02.000000 amilib-0.1.0/test/test_wikidata.py
--rw-r--r--   0 pm286      (503) staff       (20)     4824 2024-04-23 06:34:10.000000 amilib-0.1.0/test/test_xml.py
+drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-05-17 22:04:55.424171 amilib-0.1.1/
+-rw-r--r--   0 pm286      (503) staff       (20)      850 2024-05-17 22:04:55.424246 amilib-0.1.1/PKG-INFO
+drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-05-17 22:04:55.421061 amilib-0.1.1/amilib/
+-rw-r--r--   0 pm286      (503) staff       (20)        0 2024-04-16 00:05:01.830761 amilib-0.1.1/amilib/__init__.py
+-rw-r--r--   0 pm286      (503) staff       (20)     9811 2024-05-17 15:11:52.431271 amilib-0.1.1/amilib/ami_args.py
+-rw-r--r--   0 pm286      (503) staff       (20)     5132 2024-05-10 07:45:14.848226 amilib-0.1.1/amilib/ami_bib.py
+-rw-r--r--   0 pm286      (503) staff       (20)      287 2024-04-17 21:43:55.251516 amilib-0.1.1/amilib/ami_csv.py
+-rw-r--r--   0 pm286      (503) staff       (20)   164403 2024-05-17 15:11:52.432392 amilib-0.1.1/amilib/ami_html.py
+-rw-r--r--   0 pm286      (503) staff       (20)    16407 2024-05-15 10:50:48.747796 amilib-0.1.1/amilib/ami_integrate.py
+-rw-r--r--   0 pm286      (503) staff       (20)     8542 2024-05-15 11:22:11.902271 amilib-0.1.1/amilib/ami_nlp.py
+-rw-r--r--   0 pm286      (503) staff       (20)    81770 2024-05-15 10:50:48.748320 amilib-0.1.1/amilib/ami_pdf_libs.py
+-rw-r--r--   0 pm286      (503) staff       (20)     5001 2024-05-15 10:50:48.748476 amilib-0.1.1/amilib/ami_svg.py
+-rw-r--r--   0 pm286      (503) staff       (20)    10651 2024-04-16 00:05:01.831984 amilib-0.1.1/amilib/ami_util.py
+-rw-r--r--   0 pm286      (503) staff       (20)     8422 2024-04-16 00:05:01.832063 amilib-0.1.1/amilib/amidriver.py
+-rw-r--r--   0 pm286      (503) staff       (20)    17098 2024-05-17 21:28:55.457223 amilib-0.1.1/amilib/amix.py
+-rw-r--r--   0 pm286      (503) staff       (20)    19721 2024-05-10 07:45:14.850101 amilib-0.1.1/amilib/bbox.py
+-rw-r--r--   0 pm286      (503) staff       (20)    14824 2024-05-15 10:50:48.748870 amilib-0.1.1/amilib/file_lib.py
+-rw-r--r--   0 pm286      (503) staff       (20)    19595 2024-05-10 07:45:14.850551 amilib-0.1.1/amilib/headless_lib.py
+-rw-r--r--   0 pm286      (503) staff       (20)     4440 2024-05-17 15:11:52.432782 amilib-0.1.1/amilib/html_args.py
+-rw-r--r--   0 pm286      (503) staff       (20)     1334 2024-04-23 06:25:16.187949 amilib-0.1.1/amilib/html_extra.py
+-rw-r--r--   0 pm286      (503) staff       (20)    16556 2024-05-10 07:45:14.851089 amilib-0.1.1/amilib/html_generator.py
+-rw-r--r--   0 pm286      (503) staff       (20)    48083 2024-05-10 07:45:14.851370 amilib-0.1.1/amilib/html_marker.py
+-rw-r--r--   0 pm286      (503) staff       (20)    26450 2024-05-17 15:11:52.433165 amilib-0.1.1/amilib/pdf_args.py
+-rw-r--r--   0 pm286      (503) staff       (20)    27640 2024-05-17 15:11:52.433562 amilib-0.1.1/amilib/util.py
+-rw-r--r--   0 pm286      (503) staff       (20)    33690 2024-05-10 07:45:14.851892 amilib-0.1.1/amilib/wikimedia.py
+-rw-r--r--   0 pm286      (503) staff       (20)    54474 2024-05-10 07:45:14.852158 amilib-0.1.1/amilib/xml_lib.py
+-rw-r--r--   0 pm286      (503) staff       (20)     1666 2024-05-17 21:30:15.093611 amilib-0.1.1/setup.py
+drwxr-xr-x   0 pm286      (503) staff       (20)        0 2024-05-17 22:04:55.424106 amilib-0.1.1/test/
+-rw-r--r--   0 pm286      (503) staff       (20)     2679 2024-04-17 00:12:33.325481 amilib-0.1.1/test/test_all.py
+-rw-r--r--   0 pm286      (503) staff       (20)     3941 2024-04-18 07:09:52.218257 amilib-0.1.1/test/test_file.py
+-rw-r--r--   0 pm286      (503) staff       (20)    21468 2024-05-10 08:49:13.862850 amilib-0.1.1/test/test_headless.py
+-rw-r--r--   0 pm286      (503) staff       (20)   120399 2024-05-17 15:11:52.445559 amilib-0.1.1/test/test_html.py
+-rw-r--r--   0 pm286      (503) staff       (20)      733 2024-04-16 00:05:02.394994 amilib-0.1.1/test/test_nlp.py
+-rw-r--r--   0 pm286      (503) staff       (20)    80476 2024-05-17 15:11:52.445978 amilib-0.1.1/test/test_pdf.py
+-rw-r--r--   0 pm286      (503) staff       (20)       92 2024-05-17 15:11:52.446099 amilib-0.1.1/test/test_pytest.py
+-rw-r--r--   0 pm286      (503) staff       (20)     1087 2024-04-23 06:34:10.071353 amilib-0.1.1/test/test_stat.py
+-rw-r--r--   0 pm286      (503) staff       (20)     1065 2024-04-16 00:05:02.395346 amilib-0.1.1/test/test_svg.py
+-rw-r--r--   0 pm286      (503) staff       (20)    10568 2024-05-17 15:11:52.446284 amilib-0.1.1/test/test_util.py
+-rw-r--r--   0 pm286      (503) staff       (20)    35765 2024-04-16 00:05:02.395578 amilib-0.1.1/test/test_wikidata.py
+-rw-r--r--   0 pm286      (503) staff       (20)     4824 2024-04-23 06:34:10.078244 amilib-0.1.1/test/test_xml.py
```

### Comparing `amilib-0.1.0/PKG-INFO` & `amilib-0.1.1/PKG-INFO`

 * *Files 11% similar despite different names*

```diff
@@ -1,32 +1,30 @@
-Metadata-Version: 2.1
+Metadata-Version: 1.1
 Name: amilib
-Version: 0.1.0
+Version: 0.1.1
 Summary: document download, cleaning, management
 Home-page: https://github.com/petermr/amilib
 Author: Peter Murray-Rust
 Author-email: petermurrayrust@googlemail.com
 License: Apache2
+Description: # amilib
+        library from pyamihtml
+        
+        mainly for amiclimate to start with
+        
+        
+        
+        
+        
+        
+        
+        
 Keywords: text and data mining
+Platform: UNKNOWN
 Classifier: Development Status :: 3 - Alpha
 Classifier: Intended Audience :: Developers
 Classifier: License :: OSI Approved :: Apache Software License
 Classifier: Natural Language :: English
 Classifier: Programming Language :: Python :: 3.4
 Classifier: Programming Language :: Python :: 3.5
 Classifier: Programming Language :: Python :: 3.6
 Classifier: Programming Language :: Python :: 3.8
-Requires-Python: >=3.7
-Description-Content-Type: text/markdown
-License-File: LICENSE
-
-# amilib
-library from pyamihtml
-
-mainly for amiclimate to start with
-
-
-
-
-
-
-
```

### Comparing `amilib-0.1.0/amilib/ami_bib.py` & `amilib-0.1.1/amilib/ami_bib.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/amilib/ami_html.py` & `amilib-0.1.1/amilib/ami_html.py`

 * *Files 1% similar despite different names*

```diff
@@ -28,10248 +28,10249 @@
 000001b0: 2069 6d70 6f72 7420 4854 4d4c 5061 7273   import HTMLPars
 000001c0: 6572 0a66 726f 6d20 736b 6c65 6172 6e2e  er.from sklearn.
 000001d0: 6c69 6e65 6172 5f6d 6f64 656c 2069 6d70  linear_model imp
 000001e0: 6f72 7420 4c69 6e65 6172 5265 6772 6573  ort LinearRegres
 000001f0: 7369 6f6e 0a0a 2320 6c6f 6361 6c0a 6672  sion..# local.fr
 00000200: 6f6d 2061 6d69 6c69 622e 6262 6f78 2069  om amilib.bbox i
 00000210: 6d70 6f72 7420 4242 6f78 0a66 726f 6d20  mport BBox.from 
-00000220: 616d 696c 6962 2e75 7469 6c20 696d 706f  amilib.util impo
-00000230: 7274 2053 5363 7269 7074 2c20 4162 7374  rt SScript, Abst
-00000240: 7261 6374 4172 6773 2c20 5574 696c 2c20  ractArgs, Util, 
-00000250: 416d 694c 6f67 6765 720a 6672 6f6d 2061  AmiLogger.from a
-00000260: 6d69 6c69 622e 786d 6c5f 6c69 6220 696d  milib.xml_lib im
-00000270: 706f 7274 2058 6d6c 4c69 622c 2048 746d  port XmlLib, Htm
-00000280: 6c4c 6962 0a0a 2320 6e6f 2074 7279 2d63  lLib..# no try-c
-00000290: 6174 6368 2069 6d70 6f72 7473 0a0a 6c6f  atch imports..lo
-000002a0: 6767 6572 203d 2041 6d69 4c6f 6767 6572  gger = AmiLogger
-000002b0: 2e63 7265 6174 655f 6e61 6d65 645f 6c6f  .create_named_lo
-000002c0: 6767 6572 285f 5f66 696c 655f 5f29 0a0a  gger(__file__)..
-000002d0: 2320 4854 4d4c 2065 6c65 6d65 6e74 730a  # HTML elements.
-000002e0: 485f 4854 4d4c 203d 2022 6874 6d6c 220a  H_HTML = "html".
-000002f0: 485f 4845 4144 203d 2022 6865 6164 220a  H_HEAD = "head".
-00000300: 485f 4d45 5441 203d 2022 6d65 7461 220a  H_META = "meta".
-00000310: 485f 5343 5249 5054 203d 2022 7363 7269  H_SCRIPT = "scri
-00000320: 7074 220a 485f 5354 594c 4520 3d20 2273  pt".H_STYLE = "s
-00000330: 7479 6c65 220a 485f 424f 4459 203d 2022  tyle".H_BODY = "
-00000340: 626f 6479 220a 485f 5441 424c 4520 3d20  body".H_TABLE = 
-00000350: 2274 6162 6c65 220a 485f 5448 4541 4420  "table".H_THEAD 
-00000360: 3d20 2274 6865 6164 220a 485f 5449 544c  = "thead".H_TITL
-00000370: 4520 3d20 2274 6974 6c65 220a 485f 5442  E = "title".H_TB
-00000380: 4f44 5920 3d20 2274 626f 6479 220a 485f  ODY = "tbody".H_
-00000390: 5452 203d 2022 7472 220a 485f 5448 203d  TR = "tr".H_TH =
-000003a0: 2022 7468 220a 485f 5444 203d 2022 7464   "th".H_TD = "td
-000003b0: 220a 485f 4449 5620 3d20 2264 6976 220a  ".H_DIV = "div".
-000003c0: 485f 5350 414e 203d 2022 7370 616e 220a  H_SPAN = "span".
-000003d0: 485f 554c 203d 2022 756c 220a 485f 4c49  H_UL = "ul".H_LI
-000003e0: 203d 2022 6c69 220a 485f 4120 3d20 2261   = "li".H_A = "a
-000003f0: 220a 485f 4220 3d20 2262 220a 485f 5020  ".H_B = "b".H_P 
-00000400: 3d20 2270 220a 0a58 203d 2022 7822 0a59  = "p"..X = "x".Y
-00000410: 203d 2022 7922 0a58 3020 3d20 2278 3022   = "y".X0 = "x0"
-00000420: 0a58 3120 3d20 2278 3122 0a0a 2320 4854  .X1 = "x1"..# HT
-00000430: 4d4c 2061 7474 7269 6275 7465 730a 415f  ML attributes.A_
-00000440: 434c 4153 5320 3d20 2263 6c61 7373 220a  CLASS = "class".
-00000450: 415f 4852 4546 203d 2022 6872 6566 220a  A_HREF = "href".
-00000460: 415f 4944 203d 2022 6964 220a 415f 4e41  A_ID = "id".A_NA
-00000470: 4d45 203d 2022 6e61 6d65 220a 415f 5354  ME = "name".A_ST
-00000480: 594c 4520 3d20 2273 7479 6c65 220a 415f  YLE = "style".A_
-00000490: 5445 524d 203d 2022 7465 726d 220a 415f  TERM = "term".A_
-000004a0: 5449 544c 4520 3d20 2274 6974 6c65 220a  TITLE = "title".
-000004b0: 0a58 5f50 5245 4345 4449 4e47 203d 2022  .X_PRECEDING = "
-000004c0: 7072 6563 6564 696e 6722 0a0a 2320 7374  preceding"..# st
-000004d0: 796c 6520 6275 6e64 6c65 0a53 5459 4c45  yle bundle.STYLE
-000004e0: 203d 2022 7374 796c 6522 0a49 5441 4c49   = "style".ITALI
-000004f0: 4320 3d20 2269 7461 6c69 6322 0a42 4f4c  C = "italic".BOL
-00000500: 4420 3d20 2262 6f6c 6422 0a54 494d 4553  D = "bold".TIMES
-00000510: 203d 2022 7469 6d65 7322 0a43 414c 4942   = "times".CALIB
-00000520: 5249 203d 2022 6361 6c69 6272 6922 0a46  RI = "calibri".F
-00000530: 4f4e 545f 4641 4d49 4c49 4553 203d 205b  ONT_FAMILIES = [
-00000540: 5449 4d45 532c 2043 414c 4942 5249 5d0a  TIMES, CALIBRI].
-00000550: 0a23 2073 7479 6c65 2061 7474 7269 6275  .# style attribu
-00000560: 7465 730a 464f 4e54 5f53 495a 4520 3d20  tes.FONT_SIZE = 
-00000570: 2266 6f6e 742d 7369 7a65 220a 464f 4e54  "font-size".FONT
-00000580: 5f53 5459 4c45 203d 2022 666f 6e74 2d73  _STYLE = "font-s
-00000590: 7479 6c65 220a 464f 4e54 5f57 4549 4748  tyle".FONT_WEIGH
-000005a0: 5420 3d20 2266 6f6e 742d 7765 6967 6874  T = "font-weight
-000005b0: 220a 464f 4e54 5f46 414d 494c 5920 3d20  ".FONT_FAMILY = 
-000005c0: 2266 6f6e 742d 6661 6d69 6c79 220a 464f  "font-family".FO
-000005d0: 4e54 5f46 4f4e 5420 3d20 2266 6f6e 7422  NT_FONT = "font"
-000005e0: 0a46 4f4e 545f 4e41 4d45 203d 2022 666f  .FONT_NAME = "fo
-000005f0: 6e74 2d6e 616d 6522 0a46 4f4e 545f 5354  nt-name".FONT_ST
-00000600: 5245 5443 4845 4420 3d20 2266 6f6e 742d  RETCHED = "font-
-00000610: 7374 7265 7463 6865 6422 0a46 494c 4c20  stretched".FILL 
-00000620: 3d20 2266 696c 6c22 0a53 5452 4f4b 4520  = "fill".STROKE 
-00000630: 3d20 2273 7472 6f6b 6522 0a0a 2320 6368  = "stroke"..# ch
-00000640: 6172 6163 7465 7220 7072 6f70 6572 7469  aracter properti
-00000650: 6573 0a50 5f46 4f4e 544e 414d 4520 3d20  es.P_FONTNAME = 
-00000660: 2266 6f6e 746e 616d 6522 0a50 5f48 4549  "fontname".P_HEI
-00000670: 4748 5420 3d20 2268 6569 6768 7422 0a50  GHT = "height".P
-00000680: 5f53 5452 4f4b 494e 475f 434f 4c4f 5220  _STROKING_COLOR 
-00000690: 3d20 2273 7472 6f6b 696e 675f 636f 6c6f  = "stroking_colo
-000006a0: 7222 0a50 5f4e 4f4e 5f53 5452 4f4b 494e  r".P_NON_STROKIN
-000006b0: 475f 434f 4c4f 5220 3d20 226e 6f6e 5f73  G_COLOR = "non_s
-000006c0: 7472 6f6b 696e 675f 636f 6c6f 7222 0a0a  troking_color"..
-000006d0: 505f 5830 203d 2022 7830 220a 505f 5831  P_X0 = "x0".P_X1
-000006e0: 203d 2022 7831 220a 505f 5930 203d 2022   = "x1".P_Y0 = "
-000006f0: 7930 220a 505f 5931 203d 2022 7931 220a  y0".P_Y1 = "y1".
-00000700: 505f 5445 5854 203d 2022 7465 7874 220a  P_TEXT = "text".
-00000710: 0a23 2055 6e77 616e 7465 6420 7365 6374  .# Unwanted sect
-00000720: 696f 6e73 0a55 5f58 5041 5448 203d 2022  ions.U_XPATH = "
-00000730: 7870 6174 6822 0a55 5f52 4547 4558 203d  xpath".U_REGEX =
-00000740: 2022 7265 6765 7822 0a0a 5354 594c 4553   "regex"..STYLES
-00000750: 203d 205b 0a20 2020 2046 4f4e 545f 5349   = [.    FONT_SI
-00000760: 5a45 2c0a 2020 2020 464f 4e54 5f53 5459  ZE,.    FONT_STY
-00000770: 4c45 2c0a 2020 2020 464f 4e54 5f46 414d  LE,.    FONT_FAM
-00000780: 494c 592c 0a20 2020 2046 4f4e 545f 5745  ILY,.    FONT_WE
-00000790: 4947 4854 2c0a 2020 2020 4649 4c4c 2c0a  IGHT,.    FILL,.
-000007a0: 2020 2020 5354 524f 4b45 2c0a 5d0a 0a23      STROKE,.]..#
-000007b0: 2043 5353 0a53 5f42 4f52 4445 5220 3d20   CSS.S_BORDER = 
-000007c0: 2262 6f72 6465 7222 0a53 5f50 4f53 4954  "border".S_POSIT
-000007d0: 494f 4e20 3d20 2270 6f73 6974 696f 6e22  ION = "position"
-000007e0: 0a53 5f57 4944 5448 203d 2022 7769 6474  .S_WIDTH = "widt
-000007f0: 6822 0a53 5f57 5249 5449 4e47 5f4d 4f44  h".S_WRITING_MOD
-00000800: 4520 3d20 2277 7269 7469 6e67 2d6d 6f64  E = "writing-mod
-00000810: 6522 0a0a 5f55 5446 3820 3d20 2255 5446  e".._UTF8 = "UTF
-00000820: 2d38 220a 0a43 4841 505f 544f 505f 5245  -8"..CHAP_TOP_RE
-00000830: 4320 3d20 7265 2e63 6f6d 7069 6c65 2822  C = re.compile("
-00000840: 5f5f 4e4f 545f 5f59 4554 5f5f 494d 504c  __NOT__YET__IMPL
-00000850: 454d 454e 5445 445f 5f22 290a 5345 4354  EMENTED__").SECT
-00000860: 494f 4e53 5f44 4543 494d 414c 5f52 4543  IONS_DECIMAL_REC
-00000870: 203d 2072 652e 636f 6d70 696c 6528 225c   = re.compile("\
-00000880: 5c64 2b5c 5c2e 5c5c 642b 2422 290a 5355  \d+\\.\\d+$").SU
-00000890: 4253 4543 5453 5f44 4543 494d 414c 5f52  BSECTS_DECIMAL_R
-000008a0: 4543 203d 2072 652e 636f 6d70 696c 6528  EC = re.compile(
-000008b0: 225c 5c64 2b5c 5c2e 5c5c 642b 5c5c 2e5c  "\\d+\\.\\d+\\.\
-000008c0: 5c64 2b24 2229 0a0a 434c 4153 5352 4546  \d+$")..CLASSREF
-000008d0: 203d 2022 636c 6173 7372 6566 220a 0a53   = "classref"..S
-000008e0: 5459 4c45 5f58 5041 5448 203d 2022 2f68  TYLE_XPATH = "/h
-000008f0: 746d 6c2f 6865 6164 2f73 7479 6c65 220a  tml/head/style".
-00000900: 0a22 2222 0a4e 4f54 452e 2074 6865 2075  .""".NOTE. the u
-00000910: 7365 206f 6620 636c 6173 736e 616d 652c  se of classname,
-00000920: 2063 6c61 7373 7265 6620 616e 6420 7369   classref and si
-00000930: 6d69 6c61 7220 6973 2069 6e63 6f6e 7369  milar is inconsi
-00000940: 7374 656e 742e 2057 6520 7761 6e74 2074  stent. We want t
-00000950: 6f20 6861 7665 3a0a 7331 2020 746f 206d  o have:.s1  to m
-00000960: 6561 6e20 636c 6173 7320 6e61 6d65 2028  ean class name (
-00000970: 636c 6173 736e 616d 6529 0a2e 7331 2074  classname)..s1 t
-00000980: 6f20 6d65 616e 2061 2072 6566 6572 656e  o mean a referen
-00000990: 6365 2074 6f20 6120 636c 6173 736e 616d  ce to a classnam
-000009a0: 6520 286f 6e6c 7920 7573 6564 2069 6e20  e (only used in 
-000009b0: 3c73 7479 6c65 3e20 656c 656d 656e 7473  <style> elements
-000009c0: 2062 7574 2069 6e76 6f6c 7665 6420 696e   but involved in
-000009d0: 2063 6f6e 7665 7273 696f 6e73 0a22 2222   conversions."""
-000009e0: 0a0a 6c6f 6767 6572 203d 206c 6f67 6769  ..logger = loggi
-000009f0: 6e67 2e67 6574 4c6f 6767 6572 285f 5f66  ng.getLogger(__f
-00000a00: 696c 655f 5f29 0a0a 636c 6173 7320 416d  ile__)..class Am
-00000a10: 6953 7061 6e3a 0a20 2020 2064 6566 205f  iSpan:.    def _
-00000a20: 5f69 6e69 745f 5f28 7365 6c66 293a 0a20  _init__(self):. 
-00000a30: 2020 2020 2020 2073 656c 662e 7465 7874         self.text
-00000a40: 5f73 7479 6c65 203d 204e 6f6e 650a 2020  _style = None.  
-00000a50: 2020 2020 2020 7365 6c66 2e73 7472 696e        self.strin
-00000a60: 6720 3d20 2222 0a20 2020 2020 2020 2073  g = "".        s
-00000a70: 656c 662e 7878 203d 205b 5d0a 2020 2020  elf.xx = [].    
-00000a80: 2020 2020 7365 6c66 2e78 3020 3d20 4e6f      self.x0 = No
-00000a90: 6e65 0a20 2020 2020 2020 2073 656c 662e  ne.        self.
-00000aa0: 7831 203d 204e 6f6e 650a 2020 2020 2020  x1 = None.      
-00000ab0: 2020 7365 6c66 2e79 3020 3d20 4e6f 6e65    self.y0 = None
-00000ac0: 0a20 2020 2020 2020 2023 2073 656c 662e  .        # self.
-00000ad0: 6164 7620 3d20 4e6f 6e65 0a0a 2020 2020  adv = None..    
-00000ae0: 6465 6620 6372 6561 7465 5f61 6e64 5f61  def create_and_a
-00000af0: 6464 5f74 6f28 7365 6c66 2c20 6469 7629  dd_to(self, div)
-00000b00: 3a0a 2020 2020 2020 2020 6874 6d6c 5f73  :.        html_s
-00000b10: 7061 6e20 3d20 4e6f 6e65 0a20 2020 2020  pan = None.     
-00000b20: 2020 2069 6620 6469 7620 6973 206e 6f74     if div is not
-00000b30: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00000b40: 2020 2068 746d 6c5f 7370 616e 203d 2045     html_span = E
-00000b50: 542e 5375 6245 6c65 6d65 6e74 2864 6976  T.SubElement(div
-00000b60: 2c20 485f 5350 414e 290a 2020 2020 2020  , H_SPAN).      
-00000b70: 2020 2020 2020 6874 6d6c 5f73 7061 6e2e        html_span.
-00000b80: 7465 7874 203d 2073 656c 662e 7374 7269  text = self.stri
-00000b90: 6e67 0a20 2020 2020 2020 2020 2020 2048  ng.            H
-00000ba0: 746d 6c53 7479 6c65 2e73 6574 5f73 7479  tmlStyle.set_sty
-00000bb0: 6c65 2868 746d 6c5f 7370 616e 2c20 7365  le(html_span, se
-00000bc0: 6c66 2e74 6578 745f 7374 796c 652e 6372  lf.text_style.cr
-00000bd0: 6561 7465 5f63 7373 5f73 7472 696e 6728  eate_css_string(
-00000be0: 2929 0a20 2020 2020 2020 2020 2020 2069  )).            i
-00000bf0: 6620 6c65 6e28 7365 6c66 2e78 7829 203e  f len(self.xx) >
-00000c00: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-00000c10: 2020 2020 6874 6d6c 5f73 7061 6e2e 6174      html_span.at
-00000c20: 7472 6962 5b58 5d20 3d20 7365 6c66 2e78  trib[X] = self.x
-00000c30: 785b 305d 0a20 2020 2020 2020 2020 2020  x[0].           
-00000c40: 2069 6620 7365 6c66 2e78 303a 0a20 2020   if self.x0:.   
-00000c50: 2020 2020 2020 2020 2020 2020 2068 746d               htm
-00000c60: 6c5f 7370 616e 2e61 7474 7269 625b 5830  l_span.attrib[X0
-00000c70: 5d20 3d20 7374 7228 7365 6c66 2e78 3029  ] = str(self.x0)
-00000c80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00000c90: 7365 6c66 2e78 313a 0a20 2020 2020 2020  self.x1:.       
-00000ca0: 2020 2020 2020 2020 2068 746d 6c5f 7370           html_sp
-00000cb0: 616e 2e61 7474 7269 625b 5831 5d20 3d20  an.attrib[X1] = 
-00000cc0: 7374 7228 7365 6c66 2e78 3129 0a20 2020  str(self.x1).   
-00000cd0: 2020 2020 2020 2020 2068 746d 6c5f 7370           html_sp
-00000ce0: 616e 2e61 7474 7269 625b 595d 203d 2073  an.attrib[Y] = s
-00000cf0: 7472 2873 656c 662e 7930 290a 2020 2020  tr(self.y0).    
-00000d00: 2020 2020 7265 7475 726e 2068 746d 6c5f      return html_
-00000d10: 7370 616e 0a0a 0a23 2073 686f 756c 6420  span...# should 
-00000d20: 6d61 7962 6520 6265 2069 6e20 5044 460a  maybe be in PDF.
-00000d30: 636c 6173 7320 5061 6765 426f 783a 2020  class PageBox:  
-00000d40: 2320 6465 6669 6e65 6420 6279 2070 6466  # defined by pdf
-00000d50: 6d69 6e65 7220 4920 7468 696e 6b0a 0a20  miner I think.. 
-00000d60: 2020 2022 2222 0a3c 6272 3e3c 7370 616e     """.<br><span
-00000d70: 2073 7479 6c65 3d22 706f 7369 7469 6f6e   style="position
-00000d80: 3a61 6273 6f6c 7574 653b 2062 6f72 6465  :absolute; borde
-00000d90: 723a 2067 7261 7920 3170 7820 736f 6c69  r: gray 1px soli
-00000da0: 643b 206c 6566 743a 3070 783b 2074 6f70  d; left:0px; top
-00000db0: 3a39 3431 7078 3b20 7769 6474 683a 3539  :941px; width:59
-00000dc0: 3570 783b 2068 6569 6768 743a 3834 3170  5px; height:841p
-00000dd0: 783b 223e 3c2f 7370 616e 3e0a 3c64 6976  x;"></span>.<div
-00000de0: 2073 7479 6c65 3d22 706f 7369 7469 6f6e   style="position
-00000df0: 3a61 6273 6f6c 7574 653b 2074 6f70 3a39  :absolute; top:9
-00000e00: 3431 7078 3b22 3e3c 6120 6e61 6d65 3d22  41px;"><a name="
-00000e10: 3222 3e50 6167 6520 323c 2f61 3e3c 2f64  2">Page 2</a></d
-00000e20: 6976 3e0a 0a66 6f72 2049 5043 4320 746f  iv>..for IPCC to
-00000e30: 7028 5061 6765 3129 203d 2035 300a 746f  p(Page1) = 50.to
-00000e40: 7028 5061 6765 6e29 203d 2035 3020 2b20  p(Pagen) = 50 + 
-00000e50: 286e 202d 2031 2920 2a20 2838 3431 202b  (n - 1) * (841 +
-00000e60: 2034 3729 0a0a 2020 2020 2222 220a 0a20   47)..    """.. 
-00000e70: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-00000e80: 7365 6c66 2c20 6373 735f 7374 796c 653d  self, css_style=
-00000e90: 4e6f 6e65 293a 0a20 2020 2020 2020 2073  None):.        s
-00000ea0: 656c 662e 6373 735f 7374 796c 6520 3d20  elf.css_style = 
-00000eb0: 6373 735f 7374 796c 650a 2020 2020 2020  css_style.      
-00000ec0: 2020 7365 6c66 2e62 626f 7820 3d20 4242    self.bbox = BB
-00000ed0: 6f78 2829 2020 2320 756e 696e 6974 6961  ox()  # uninitia
-00000ee0: 6c69 7365 640a 2020 2020 2020 2020 6966  lised.        if
-00000ef0: 2073 656c 662e 6373 735f 7374 796c 653a   self.css_style:
-00000f00: 0a20 2020 2020 2020 2020 2020 2074 6f70  .            top
-00000f10: 203d 2073 656c 662e 6373 735f 7374 796c   = self.css_styl
-00000f20: 652e 746f 700a 2020 2020 2020 2020 2020  e.top.          
-00000f30: 2020 6c65 6674 203d 2073 656c 662e 6373    left = self.cs
-00000f40: 735f 7374 796c 652e 6c65 6674 0a20 2020  s_style.left.   
-00000f50: 2020 2020 2020 2020 2077 6964 7468 203d           width =
-00000f60: 2073 656c 662e 6373 735f 7374 796c 652e   self.css_style.
-00000f70: 7769 6474 680a 2020 2020 2020 2020 2020  width.          
-00000f80: 2020 6865 6967 6874 203d 2073 656c 662e    height = self.
-00000f90: 6373 735f 7374 796c 652e 6865 6967 6874  css_style.height
-00000fa0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00000fb0: 662e 6262 6f78 2e78 795f 7261 6e67 6573  f.bbox.xy_ranges
-00000fc0: 203d 205b 5b6c 6566 742c 206c 6566 7420   = [[left, left 
-00000fd0: 2b20 7769 6474 685d 2c20 5b74 6f70 2c20  + width], [top, 
-00000fe0: 746f 7020 2b20 6865 6967 6874 5d5d 0a20  top + height]]. 
-00000ff0: 2020 2020 2020 2073 656c 662e 656c 656d         self.elem
-00001000: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00001010: 7365 6c66 2e69 6e74 5f6e 756d 6265 7220  self.int_number 
-00001020: 3d20 4e6f 6e65 2020 2320 7064 6670 6c75  = None  # pdfplu
-00001030: 6d62 6572 2069 6e74 6567 6572 2070 6167  mber integer pag
-00001040: 6520 2831 2d62 6173 6564 290a 2020 2020  e (1-based).    
-00001050: 2020 2020 7365 6c66 2e70 5f6e 756d 5f73      self.p_num_s
-00001060: 7472 203d 204e 6f6e 6520 2023 2070 6466  tr = None  # pdf
-00001070: 706c 756d 6265 7220 2250 6167 6520 3132  plumber "Page 12
-00001080: 220a 0a20 2020 2040 7072 6f70 6572 7479  "..    @property
-00001090: 0a20 2020 2064 6566 2070 6167 655f 6e75  .    def page_nu
-000010a0: 6d62 6572 2873 656c 6629 3a0a 2020 2020  mber(self):.    
-000010b0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
-000010c0: 696e 745f 6e75 6d62 6572 3a0a 2020 2020  int_number:.    
-000010d0: 2020 2020 2020 2020 7365 6c66 2e69 6e74          self.int
-000010e0: 5f6e 756d 6265 7220 3d20 4e6f 6e65 2069  _number = None i
-000010f0: 6620 7365 6c66 2e65 6c65 6d20 6973 204e  f self.elem is N
-00001100: 6f6e 6520 656c 7365 2050 6167 6542 6f78  one else PageBox
-00001110: 2e65 7874 7261 6374 5f70 6167 655f 6e75  .extract_page_nu
-00001120: 6d62 6572 5f66 726f 6d5f 7064 665f 6874  mber_from_pdf_ht
-00001130: 6d6c 2873 656c 662e 656c 656d 290a 2020  ml(self.elem).  
-00001140: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00001150: 662e 696e 745f 6e75 6d62 6572 0a0a 2020  f.int_number..  
-00001160: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00001170: 2020 2064 6566 2065 7874 7261 6374 5f70     def extract_p
-00001180: 6167 655f 6e75 6d62 6572 5f66 726f 6d5f  age_number_from_
-00001190: 7064 665f 6874 6d6c 2863 6c73 2c20 656c  pdf_html(cls, el
-000011a0: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-000011b0: 0a20 2020 2020 2020 2073 6f6d 6520 656c  .        some el
-000011c0: 656d 656e 7473 203f 7370 616e 7329 2066  ements ?spans) f
-000011d0: 726f 6d20 7064 6620 7061 7273 696e 6720  rom pdf parsing 
-000011e0: 6861 7665 2074 6865 2066 6f72 6d3a 0a20  have the form:. 
-000011f0: 2020 2020 2020 203c 6469 7620 2e2e 2e3e         <div ...>
-00001200: 3c61 206e 616d 653d 2232 223e 5061 6765  <a name="2">Page
-00001210: 2032 3c2f 613e 0a0a 2020 2020 2020 2020   2</a>..        
-00001220: 3a70 6172 616d 2065 6c65 6d3a 2063 6f6e  :param elem: con
-00001230: 7461 696e 7320 7061 6765 206e 756d 6265  tains page numbe
-00001240: 720a 2020 2020 2020 2020 3a72 6574 7572  r.        :retur
-00001250: 6e3a 2070 6167 6520 6e75 6d62 6572 206f  n: page number o
-00001260: 7220 6e6f 6e65 0a20 2020 2020 2020 2022  r none.        "
-00001270: 2222 0a20 2020 2020 2020 2069 6620 656c  "".        if el
-00001280: 656d 2069 7320 4e6f 6e65 3a0a 2020 2020  em is None:.    
-00001290: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-000012a0: 6f6e 650a 2020 2020 2020 2020 7870 6174  one.        xpat
-000012b0: 6878 203d 2066 222e 2f2f 612f 407b 415f  hx = f".//a/@{A_
-000012c0: 4e41 4d45 7d22 0a20 2020 2020 2020 2061  NAME}".        a
-000012d0: 6e61 6d65 203d 2065 6c65 6d2e 7870 6174  name = elem.xpat
-000012e0: 6828 7870 6174 6878 290a 2020 2020 2020  h(xpathx).      
-000012f0: 2020 7265 7475 726e 2061 6e61 6d65 0a0a    return aname..
-00001300: 2020 2020 6465 6620 6164 645f 7374 796c      def add_styl
-00001310: 655f 7370 616e 5f61 6e64 5f70 6167 655f  e_span_and_page_
-00001320: 6e75 6d62 6572 2873 656c 662c 2065 6c65  number(self, ele
-00001330: 6d29 3a0a 2020 2020 2020 2020 2222 220a  m):.        """.
-00001340: 2020 2020 2020 2020 6164 6420 7374 796c          add styl
-00001350: 6520 7370 616e 2020 616e 6420 616c 736f  e span  and also
-00001360: 2067 6574 2070 6167 656e 756d 6265 7220   get pagenumber 
-00001370: 6672 6f6d 206e 6578 7420 656c 656d 656e  from next elemen
-00001380: 740a 0a20 2020 2020 2020 2074 7970 6963  t..        typic
-00001390: 616c 2074 7261 696c 696e 6720 656c 656d  al trailing elem
-000013a0: 656e 740a 2020 2020 2020 2020 3c64 6976  ent.        <div
-000013b0: 2073 7479 6c65 3d22 706f 7369 7469 6f6e   style="position
-000013c0: 3a61 6273 6f6c 7574 653b 2074 6f70 3a31  :absolute; top:1
-000013d0: 3037 3533 7078 3b22 3e3c 6120 6e61 6d65  0753px;"><a name
-000013e0: 3d22 3133 223e 5061 6765 2031 333c 2f61  ="13">Page 13</a
-000013f0: 3e3c 2f64 6976 3e0a 2020 2020 2020 2020  ></div>.        
-00001400: 2222 220a 2020 2020 2020 2020 7365 6c66  """.        self
-00001410: 2e65 6c65 6d20 3d20 656c 656d 0a20 2020  .elem = elem.   
-00001420: 2020 2020 2070 6167 655f 6469 7620 3d20       page_div = 
-00001430: 656c 656d 2e67 6574 6e65 7874 2829 0a20  elem.getnext(). 
-00001440: 2020 2020 2020 2069 6620 7061 6765 5f64         if page_d
-00001450: 6976 2069 7320 6e6f 7420 4e6f 6e65 3a0a  iv is not None:.
-00001460: 2020 2020 2020 2020 2020 2020 6e20 3d20              n = 
-00001470: 7061 6765 5f64 6976 2e78 7061 7468 2866  page_div.xpath(f
-00001480: 222e 2f61 2f40 7b41 5f4e 414d 457d 2229  "./a/@{A_NAME}")
-00001490: 0a20 2020 2020 2020 2020 2020 206e 203d  .            n =
-000014a0: 206e 5b30 5d20 6966 206c 656e 286e 2920   n[0] if len(n) 
-000014b0: 3d3d 2031 2065 6c73 6520 4e6f 6e65 0a20  == 1 else None. 
-000014c0: 2020 2020 2020 2020 2020 2069 6620 6e3a             if n:
-000014d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000014e0: 2073 656c 662e 696e 745f 6e75 6d62 6572   self.int_number
-000014f0: 203d 2069 6e74 286e 290a 0a20 2020 2020   = int(n)..     
-00001500: 2020 2020 2020 2070 203d 2070 6167 655f         p = page_
-00001510: 6469 762e 7870 6174 6828 6622 2e2f 615b  div.xpath(f"./a[
-00001520: 407b 415f 4e41 4d45 7d20 616e 6420 636f  @{A_NAME} and co
-00001530: 6e74 6169 6e73 282e 2c20 2750 6167 6527  ntains(., 'Page'
-00001540: 295d 2229 0a20 2020 2020 2020 2020 2020  )]").           
-00001550: 2073 656c 662e 705f 6e75 6d5f 7374 7220   self.p_num_str 
-00001560: 3d20 705b 305d 2069 6620 6c65 6e28 7029  = p[0] if len(p)
-00001570: 203d 3d20 3120 656c 7365 204e 6f6e 650a   == 1 else None.
-00001580: 0a0a 636c 6173 7320 4874 6d6c 5469 6479  ..class HtmlTidy
-00001590: 3a0a 2020 2020 2222 2266 6f72 2074 6964  :.    """for tid
-000015a0: 7969 6e67 2050 4446 202f 2053 5647 2f20  ying PDF / SVG/ 
-000015b0: 4f43 5220 7061 7273 696e 670a 2020 2020  OCR parsing.    
-000015c0: 7461 6b65 7320 7261 7720 4854 4d4c 2028  takes raw HTML (
-000015d0: 7072 6f62 6162 6c79 2073 6361 7474 6572  probably scatter
-000015e0: 6564 2077 6f72 6473 206f 7220 6c69 6e65  ed words or line
-000015f0: 7320 2c20 706f 7373 6962 6c79 2077 6974  s , possibly wit
-00001600: 6820 636f 6f72 6469 6e61 7465 7320 616e  h coordinates an
-00001610: 6420 6372 6561 7465 730a 2020 2020 666c  d creates.    fl
-00001620: 6f77 696e 6720 7374 796c 6564 2048 544d  owing styled HTM
-00001630: 4c20 7769 7468 2073 7562 7363 7269 7074  L with subscript
-00001640: 732c 2066 6f6e 7420 7374 796c 6573 2c20  s, font styles, 
-00001650: 6574 632e 0a20 2020 2022 2222 0a0a 2020  etc..    """..  
-00001660: 2020 4d49 4e5f 5041 4745 5f42 4f58 5f48    MIN_PAGE_BOX_H
-00001670: 4549 4748 5420 3d20 3330 3020 2023 2061  EIGHT = 300  # a
-00001680: 6c6c 6f77 7320 666f 7220 6c61 6e64 7363  llows for landsc
-00001690: 6170 650a 2020 2020 4845 4144 5f45 4c45  ape.    HEAD_ELE
-000016a0: 4d53 5f49 4e5f 5850 4154 4820 3d20 6622  MS_IN_XPATH = f"
-000016b0: 7b48 5f4d 4554 417d 207c 207b 485f 5449  {H_META} | {H_TI
-000016c0: 544c 457d 207c 207b 485f 5343 5249 5054  TLE} | {H_SCRIPT
-000016d0: 7d20 7c20 7b48 5f53 5459 4c45 7d22 0a0a  } | {H_STYLE}"..
-000016e0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
-000016f0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00001700: 7365 6c66 2e75 6e77 616e 7465 6473 203d  self.unwanteds =
-00001710: 205b 5d20 2023 206e 6f74 2073 7572 6520   []  # not sure 
-00001720: 7768 6174 2074 6869 7320 6973 0a20 2020  what this is.   
-00001730: 2020 2020 2073 656c 662e 656d 7074 795f       self.empty_
-00001740: 656c 656d 656e 7473 5f74 6f5f 7265 6d6f  elements_to_remo
-00001750: 7665 203d 205b 5d0a 2020 2020 2020 2020  ve = [].        
-00001760: 7365 6c66 2e73 7479 6c65 735f 746f 5f72  self.styles_to_r
-00001770: 656d 6f76 6520 3d20 5b5d 0a20 2020 2020  emove = [].     
-00001780: 2020 2073 656c 662e 6465 7363 656e 6461     self.descenda
-00001790: 6e74 735f 746f 5f72 656d 6f76 6520 3d20  nts_to_remove = 
-000017a0: 5b5d 0a20 2020 2020 2020 2073 656c 662e  [].        self.
-000017b0: 7265 6d6f 7665 5f6c 685f 6c69 6e65 5f6e  remove_lh_line_n
-000017c0: 756d 6265 7273 203d 2054 7275 650a 2020  umbers = True.  
-000017d0: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
-000017e0: 655f 6c61 7267 655f 666f 6e74 6564 5f65  e_large_fonted_e
-000017f0: 6c65 6d65 6e74 7320 3d20 5472 7565 0a20  lements = True. 
-00001800: 2020 2020 2020 2073 656c 662e 7374 796c         self.styl
-00001810: 655f 6174 7472 6962 7574 6573 5f74 6f5f  e_attributes_to_
-00001820: 7265 6d6f 7665 203d 205b 5d0a 2020 2020  remove = [].    
-00001830: 2020 2020 7365 6c66 2e6d 6172 6b65 725f      self.marker_
-00001840: 7870 6174 6820 3d20 4e6f 6e65 0a20 2020  xpath = None.   
-00001850: 2020 2020 2073 656c 662e 7374 796c 655f       self.style_
-00001860: 6174 7472 6962 7574 6573 5f74 6f5f 7265  attributes_to_re
-00001870: 6d6f 7665 203d 205b 5d0a 0a20 2020 2020  move = []..     
-00001880: 2020 2073 656c 662e 6164 645f 6964 203d     self.add_id =
-00001890: 2054 7275 650a 2020 2020 2020 2020 7365   True.        se
-000018a0: 6c66 2e68 6561 6465 7220 3d20 3830 0a20  lf.header = 80. 
-000018b0: 2020 2020 2020 2073 656c 662e 666f 6f74         self.foot
-000018c0: 6572 203d 2038 300a 2020 2020 2020 2020  er = 80.        
-000018d0: 7365 6c66 2e70 6167 655f 746f 7073 203d  self.page_tops =
-000018e0: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-000018f0: 6c66 2e70 6167 655f 626f 7865 7320 3d20  lf.page_boxes = 
-00001900: 5b5d 0a20 2020 2020 2020 2073 656c 662e  [].        self.
-00001910: 7261 775f 656c 656d 203d 204e 6f6e 650a  raw_elem = None.
-00001920: 2020 2020 2020 2020 7365 6c66 2e6f 7574          self.out
-00001930: 6469 7220 3d20 4e6f 6e65 0a0a 2020 2020  dir = None..    
-00001940: 6465 6620 7469 6479 5f66 6c6f 7728 7365  def tidy_flow(se
-00001950: 6c66 2c20 7261 775f 6874 6d6c 293a 0a20  lf, raw_html):. 
-00001960: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00001970: 2020 204e 6565 6420 746f 2063 6170 7475     Need to captu
-00001980: 7265 2070 6167 6520 696e 666f 726d 6174  re page informat
-00001990: 696f 6e20 746f 2063 6f6d 7075 7465 2070  ion to compute p
-000019a0: 6167 6520 636f 6f72 6469 6e61 7465 732c  age coordinates,
-000019b0: 206e 6f74 2064 6f63 756d 656e 7420 636f   not document co
-000019c0: 6f72 6469 6e61 7465 730a 2020 2020 2020  ordinates.      
-000019d0: 2020 636f 6e76 6572 7473 2072 6177 2068    converts raw h
-000019e0: 746d 6c20 746f 2074 6964 790a 2020 2020  tml to tidy.    
-000019f0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00001a00: 2023 2054 4f44 4f20 6368 6563 6b20 616e   # TODO check an
-00001a10: 6420 6d6f 7665 2074 6f20 696e 7374 616e  d move to instan
-00001a20: 6365 206f 6620 4874 6d6c 5469 6479 0a0a  ce of HtmlTidy..
-00001a30: 2020 2020 2020 2020 6966 2072 6177 5f68          if raw_h
-00001a40: 746d 6c20 6973 204e 6f6e 653a 0a20 2020  tml is None:.   
-00001a50: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00001a60: 616c 7565 4572 726f 7228 224e 6f20 4854  alueError("No HT
-00001a70: 4d4c 2229 0a20 2020 2020 2020 2072 6177  ML").        raw
-00001a80: 5f74 7265 6520 3d20 4554 2e70 6172 7365  _tree = ET.parse
-00001a90: 2853 7472 696e 6749 4f28 7261 775f 6874  (StringIO(raw_ht
-00001aa0: 6d6c 292c 2045 542e 4854 4d4c 5061 7273  ml), ET.HTMLPars
-00001ab0: 6572 2829 290a 2020 2020 2020 2020 7365  er()).        se
-00001ac0: 6c66 2e72 6177 5f65 6c65 6d20 3d20 7261  lf.raw_elem = ra
-00001ad0: 775f 7472 6565 2e67 6574 726f 6f74 2829  w_tree.getroot()
-00001ae0: 0a20 2020 2020 2020 2073 656c 662e 6578  .        self.ex
-00001af0: 7472 6163 745f 7061 6765 5f62 6f78 6573  tract_page_boxes
-00001b00: 2829 0a0a 2020 2020 2020 2020 7365 6c66  ()..        self
-00001b10: 2e61 6464 5f65 6c65 6d65 6e74 2873 656c  .add_element(sel
-00001b20: 662e 7261 775f 656c 656d 290a 0a20 2020  f.raw_elem)..   
-00001b30: 2020 2020 2023 2074 6869 7320 6973 2073       # this is s
-00001b40: 6574 2062 7920 7573 6572 0a20 2020 2020  et by user.     
-00001b50: 2020 2073 656c 662e 7365 745f 7265 6d6f     self.set_remo
-00001b60: 7665 5f66 6c61 6773 2829 0a0a 2020 2020  ve_flags()..    
-00001b70: 2020 2020 7365 6c66 2e72 656d 6f76 655f      self.remove_
-00001b80: 756e 7761 6e74 6564 5f61 7474 7269 6275  unwanted_attribu
-00001b90: 7465 735f 616e 645f 656c 656d 656e 7473  tes_and_elements
-00001ba0: 2829 0a20 2020 2020 2020 2070 6167 6573  ().        pages
-00001bb0: 697a 6520 3d20 4e6f 6e65 0a20 2020 2020  ize = None.     
-00001bc0: 2020 2069 6620 7365 6c66 2e6d 6172 6b65     if self.marke
-00001bd0: 725f 7870 6174 683a 0a20 2020 2020 2020  r_xpath:.       
-00001be0: 2020 2020 206f 6666 7365 742c 2070 6167       offset, pag
-00001bf0: 6573 697a 652c 2070 6167 655f 636f 6f72  esize, page_coor
-00001c00: 6473 203d 2048 746d 6c55 7469 6c2e 6669  ds = HtmlUtil.fi
-00001c10: 6e64 5f63 6f6e 7374 616e 745f 636f 6f72  nd_constant_coor
-00001c20: 6469 6e61 7465 5f6d 6172 6b65 7273 2873  dinate_markers(s
-00001c30: 656c 662e 7261 775f 656c 656d 2c20 7365  elf.raw_elem, se
-00001c40: 6c66 2e6d 6172 6b65 725f 7870 6174 6829  lf.marker_xpath)
-00001c50: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
-00001c60: 6c55 7469 6c2e 7265 6d6f 7665 5f68 6561  lUtil.remove_hea
-00001c70: 6465 7273 5f61 6e64 5f66 6f6f 7465 7273  ders_and_footers
-00001c80: 5f75 7369 6e67 5f70 6466 6d69 6e65 725f  _using_pdfminer_
-00001c90: 636f 6f72 6473 280a 2020 2020 2020 2020  coords(.        
-00001ca0: 2020 2020 2020 2020 7365 6c66 2e72 6177          self.raw
-00001cb0: 5f65 6c65 6d2c 0a20 2020 2020 2020 2020  _elem,.         
-00001cc0: 2020 2020 2020 2070 6167 6573 697a 652c         pagesize,
-00001cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00001ce0: 2073 656c 662e 6865 6164 6572 2c0a 2020   self.header,.  
-00001cf0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00001d00: 6c66 2e66 6f6f 7465 722c 0a20 2020 2020  lf.footer,.     
-00001d10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00001d20: 6d61 726b 6572 5f78 7061 7468 2c0a 2020  marker_xpath,.  
-00001d30: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00001d40: 6765 5f74 6f70 733d 7365 6c66 2e70 6167  ge_tops=self.pag
-00001d50: 655f 746f 7073 2c0a 2020 2020 2020 2020  e_tops,.        
-00001d60: 2020 2020 290a 2020 2020 2020 2020 666f      ).        fo
-00001d70: 7220 6174 7420 696e 2073 656c 662e 7374  r att in self.st
-00001d80: 796c 655f 6174 7472 6962 7574 6573 5f74  yle_attributes_t
-00001d90: 6f5f 7265 6d6f 7665 3a0a 2020 2020 2020  o_remove:.      
-00001da0: 2020 2020 2020 4874 6d6c 5574 696c 2e72        HtmlUtil.r
-00001db0: 656d 6f76 655f 7374 796c 655f 6174 7472  emove_style_attr
-00001dc0: 6962 7574 6528 7365 6c66 2e72 6177 5f65  ibute(self.raw_e
-00001dd0: 6c65 6d2c 2061 7474 290a 2020 2020 2020  lem, att).      
-00001de0: 2020 4874 6d6c 5574 696c 2e72 656d 6f76    HtmlUtil.remov
-00001df0: 655f 756e 7761 6e74 6564 7328 7365 6c66  e_unwanteds(self
-00001e00: 2e72 6177 5f65 6c65 6d2c 2073 656c 662e  .raw_elem, self.
-00001e10: 756e 7761 6e74 6564 7329 0a20 2020 2020  unwanteds).     
-00001e20: 2020 2048 746d 6c55 7469 6c2e 7265 6d6f     HtmlUtil.remo
-00001e30: 7665 5f6e 6577 6c69 6e65 7328 7365 6c66  ve_newlines(self
-00001e40: 2e72 6177 5f65 6c65 6d29 0a20 2020 2020  .raw_elem).     
-00001e50: 2020 2048 746d 6c54 7265 652e 6d61 6b65     HtmlTree.make
-00001e60: 5f73 6563 7469 6f6e 735f 616e 645f 6f75  _sections_and_ou
-00001e70: 7470 7574 2873 656c 662e 7261 775f 656c  tput(self.raw_el
-00001e80: 656d 2c20 6f75 7470 7574 5f64 6972 3d73  em, output_dir=s
-00001e90: 656c 662e 6f75 7464 6972 2c20 7265 6373  elf.outdir, recs
-00001ea0: 5f62 795f 7365 6374 696f 6e3d 5245 4353  _by_section=RECS
-00001eb0: 5f42 595f 5345 4354 494f 4e29 0a20 2020  _BY_SECTION).   
-00001ec0: 2020 2020 2068 746d 6c73 7472 203d 2045       htmlstr = E
-00001ed0: 542e 746f 7374 7269 6e67 2873 656c 662e  T.tostring(self.
-00001ee0: 7261 775f 656c 656d 2c20 656e 636f 6469  raw_elem, encodi
-00001ef0: 6e67 3d5f 5554 4638 292e 6465 636f 6465  ng=_UTF8).decode
-00001f00: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-00001f10: 6e20 6874 6d6c 7374 720a 0a20 2020 2064  n htmlstr..    d
-00001f20: 6566 2072 656d 6f76 655f 756e 7761 6e74  ef remove_unwant
-00001f30: 6564 5f61 7474 7269 6275 7465 735f 616e  ed_attributes_an
-00001f40: 645f 656c 656d 656e 7473 2873 656c 6629  d_elements(self)
-00001f50: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00001f60: 2020 2020 2020 7265 6d6f 7665 206f 626a        remove obj
-00001f70: 6563 7473 2069 6620 666c 6167 7320 6861  ects if flags ha
-00001f80: 7665 2062 6565 6e20 7365 7420 696e 2073  ve been set in s
-00001f90: 656c 660a 2020 2020 2020 2020 2222 220a  elf.        """.
-00001fa0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00001fb0: 6164 645f 6964 3a0a 2020 2020 2020 2020  add_id:.        
-00001fc0: 2020 2020 4874 6d6c 5574 696c 2e61 6464      HtmlUtil.add
-00001fd0: 5f67 656e 6572 6174 6564 5f69 6473 2873  _generated_ids(s
-00001fe0: 656c 662e 7261 775f 656c 656d 290a 2020  elf.raw_elem).  
-00001ff0: 2020 2020 2020 666f 7220 7461 6720 696e        for tag in
-00002000: 2073 656c 662e 6465 7363 656e 6461 6e74   self.descendant
-00002010: 735f 746f 5f72 656d 6f76 653a 0a20 2020  s_to_remove:.   
-00002020: 2020 2020 2020 2020 2045 542e 7374 7269           ET.stri
-00002030: 705f 7461 6773 2873 656c 662e 7261 775f  p_tags(self.raw_
-00002040: 656c 656d 2c20 5b74 6167 5d29 0a20 2020  elem, [tag]).   
-00002050: 2020 2020 2069 6620 7365 6c66 2e72 656d       if self.rem
-00002060: 6f76 655f 6c68 5f6c 696e 655f 6e75 6d62  ove_lh_line_numb
-00002070: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
-00002080: 2048 746d 6c55 7469 6c2e 7265 6d6f 7665   HtmlUtil.remove
-00002090: 5f6c 685f 6c69 6e65 5f6e 756d 6265 7273  _lh_line_numbers
-000020a0: 2873 656c 662e 7261 775f 656c 656d 290a  (self.raw_elem).
-000020b0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-000020c0: 7265 6d6f 7665 5f6c 6172 6765 5f66 6f6e  remove_large_fon
-000020d0: 7465 645f 656c 656d 656e 7473 3a0a 2020  ted_elements:.  
-000020e0: 2020 2020 2020 2020 2020 4874 6d6c 5574            HtmlUt
-000020f0: 696c 2e72 656d 6f76 655f 6c61 7267 655f  il.remove_large_
-00002100: 666f 6e74 6564 5f65 6c65 6d65 6e74 7328  fonted_elements(
-00002110: 7365 6c66 2e72 6177 5f65 6c65 6d29 0a20  self.raw_elem). 
-00002120: 2020 2020 2020 2066 6f72 2074 6167 2069         for tag i
-00002130: 6e20 7365 6c66 2e65 6d70 7479 5f65 6c65  n self.empty_ele
-00002140: 6d65 6e74 735f 746f 5f72 656d 6f76 653a  ments_to_remove:
-00002150: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
-00002160: 6c55 7469 6c2e 7265 6d6f 7665 5f65 6d70  lUtil.remove_emp
-00002170: 7479 5f65 6c65 6d65 6e74 7328 7365 6c66  ty_elements(self
-00002180: 2e72 6177 5f65 6c65 6d2c 205b 7461 675d  .raw_elem, [tag]
-00002190: 290a 2020 2020 2020 2020 666f 7220 7374  ).        for st
-000021a0: 796c 6520 696e 2073 656c 662e 7374 796c  yle in self.styl
-000021b0: 6573 5f74 6f5f 7265 6d6f 7665 3a0a 2020  es_to_remove:.  
-000021c0: 2020 2020 2020 2020 2020 4874 6d6c 5574            HtmlUt
-000021d0: 696c 2e72 656d 6f76 655f 7374 796c 6528  il.remove_style(
-000021e0: 7365 6c66 2e72 6177 5f65 6c65 6d2c 205b  self.raw_elem, [
-000021f0: 7374 796c 655d 290a 0a20 2020 2064 6566  style])..    def
-00002200: 2073 6574 5f72 656d 6f76 655f 666c 6167   set_remove_flag
-00002210: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-00002220: 2022 2222 0a20 2020 2020 2020 2073 6574   """.        set
-00002230: 2066 6c61 6773 2077 6869 6368 2064 6972   flags which dir
-00002240: 6563 7420 7265 6d6f 7661 6c20 6f66 2065  ect removal of e
-00002250: 6c65 6d65 6e74 732f 6174 7472 6962 7574  lements/attribut
-00002260: 6573 0a20 2020 2020 2020 206e 6f72 6d61  es.        norma
-00002270: 6c6c 7920 756e 6465 7220 7573 6572 2063  lly under user c
-00002280: 6f6e 7472 6f6c 0a20 2020 2020 2020 2022  ontrol.        "
-00002290: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-000022a0: 6164 645f 6465 7363 656e 6461 6e74 5f65  add_descendant_e
-000022b0: 6c65 6d65 6e74 5f74 6f5f 7265 6d6f 7665  lement_to_remove
-000022c0: 285b 2262 7222 5d29 0a20 2020 2020 2020  (["br"]).       
-000022d0: 2073 656c 662e 6164 645f 7374 796c 6573   self.add_styles
-000022e0: 5f74 6f5f 7265 6d6f 7665 280a 2020 2020  _to_remove(.    
-000022f0: 2020 2020 2020 2020 5b0a 2020 2020 2020          [.      
-00002300: 2020 2020 2020 2020 2020 535f 504f 5349            S_POSI
-00002310: 5449 4f4e 2c0a 2020 2020 2020 2020 2020  TION,.          
-00002320: 2020 2020 2020 2320 226c 6566 7422 2c0a        # "left",.
-00002330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002340: 535f 424f 5244 4552 2c0a 2020 2020 2020  S_BORDER,.      
-00002350: 2020 2020 2020 2020 2020 535f 5752 4954            S_WRIT
-00002360: 494e 475f 4d4f 4445 2c0a 2020 2020 2020  ING_MODE,.      
-00002370: 2020 2020 2020 2020 2020 535f 5749 4454            S_WIDT
-00002380: 482c 2020 2320 7468 6973 2064 6973 6162  H,  # this disab
-00002390: 6c65 7320 666c 6f77 696e 6720 7465 7874  les flowing text
-000023a0: 0a20 2020 2020 2020 2020 2020 205d 0a20  .            ]. 
-000023b0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000023c0: 2073 656c 662e 6164 645f 6964 203d 2054   self.add_id = T
-000023d0: 7275 650a 2020 2020 2020 2020 7365 6c66  rue.        self
-000023e0: 2e61 6464 5f65 6d70 7479 5f65 6c65 6d65  .add_empty_eleme
-000023f0: 6e74 735f 746f 5f72 656d 6f76 6528 5b22  nts_to_remove(["
-00002400: 7370 616e 222c 2022 6469 7622 5d29 0a20  span", "div"]). 
-00002410: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
-00002420: 7665 5f6c 685f 6c69 6e65 5f6e 756d 6265  ve_lh_line_numbe
-00002430: 7273 203d 2054 7275 6520 2023 2078 0a20  rs = True  # x. 
-00002440: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
-00002450: 7665 5f6c 6172 6765 5f66 6f6e 7465 645f  ve_large_fonted_
-00002460: 656c 656d 656e 7473 203d 2054 7275 650a  elements = True.
-00002470: 2020 2020 2020 2020 7365 6c66 2e73 7479          self.sty
-00002480: 6c65 5f61 7474 7269 6275 7465 735f 746f  le_attributes_to
-00002490: 5f72 656d 6f76 6520 3d20 5b22 746f 7022  _remove = ["top"
-000024a0: 5d0a 2020 2020 2020 2020 7365 6c66 2e6d  ].        self.m
-000024b0: 6172 6b65 725f 7870 6174 6820 3d20 222e  arker_xpath = ".
-000024c0: 2f2f 6469 765b 615b 406e 616d 655d 5d22  //div[a[@name]]"
-000024d0: 0a20 2020 2020 2020 2073 656c 662e 7374  .        self.st
-000024e0: 796c 655f 6174 7472 6962 7574 6573 5f74  yle_attributes_t
-000024f0: 6f5f 7265 6d6f 7665 203d 205b 226c 6566  o_remove = ["lef
-00002500: 7422 2c20 2268 6569 6768 7422 5d0a 0a20  t", "height"].. 
-00002510: 2020 2064 6566 2065 7874 7261 6374 5f70     def extract_p
-00002520: 6167 655f 626f 7865 7328 7365 6c66 2c20  age_boxes(self, 
-00002530: 7261 6e67 6573 3d4e 6f6e 6529 3a0a 2020  ranges=None):.  
-00002540: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00002550: 2020 4261 7365 6420 6f6e 2070 6466 706c    Based on pdfpl
-00002560: 756d 6265 7220 6f75 7470 7574 0a20 2020  umber output.   
-00002570: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00002580: 2073 656c 662e 7061 6765 5f62 6f78 6573   self.page_boxes
-00002590: 203d 205b 5d20 2023 2070 6167 6542 6f78   = []  # pageBox
-000025a0: 206d 6179 206d 6572 6765 2077 6974 6820   may merge with 
-000025b0: 416d 6950 6167 650a 0a20 2020 2020 2020  AmiPage..       
-000025c0: 2069 6620 7365 6c66 2e72 6177 5f65 6c65   if self.raw_ele
-000025d0: 6d20 6973 204e 6f6e 653a 0a20 2020 2020  m is None:.     
-000025e0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-000025f0: 2020 2020 2020 7374 796c 655f 7370 616e        style_span
-00002600: 7320 3d20 7365 6c66 2e72 6177 5f65 6c65  s = self.raw_ele
-00002610: 6d2e 7870 6174 6828 222f 2f73 7061 6e5b  m.xpath("//span[
-00002620: 636f 6e74 6169 6e73 2840 7374 796c 652c  contains(@style,
-00002630: 2770 6f73 6974 696f 6e3a 6162 736f 6c75  'position:absolu
-00002640: 7465 2729 5d22 290a 2020 2020 2020 2020  te')]").        
-00002650: 666f 7220 7374 796c 655f 7370 616e 2069  for style_span i
-00002660: 6e20 7374 796c 655f 7370 616e 733a 0a20  n style_spans:. 
-00002670: 2020 2020 2020 2020 2020 2063 7373 5f73             css_s
-00002680: 7479 6c65 203d 2043 5353 5374 796c 652e  tyle = CSSStyle.
-00002690: 6372 6561 7465 5f63 7373 5f73 7479 6c65  create_css_style
-000026a0: 5f66 726f 6d5f 6174 7472 6962 7574 655f  _from_attribute_
-000026b0: 6f66 5f62 6f64 795f 656c 656d 656e 7428  of_body_element(
-000026c0: 7374 796c 655f 7370 616e 290a 2020 2020  style_span).    
-000026d0: 2020 2020 2020 2020 6966 2063 7373 5f73          if css_s
-000026e0: 7479 6c65 2e68 6569 6768 7420 3e20 7365  tyle.height > se
-000026f0: 6c66 2e4d 494e 5f50 4147 455f 424f 585f  lf.MIN_PAGE_BOX_
-00002700: 4845 4947 4854 3a0a 2020 2020 2020 2020  HEIGHT:.        
-00002710: 2020 2020 2020 2020 7061 6765 5f62 6f78          page_box
-00002720: 203d 2050 6167 6542 6f78 2863 7373 5f73   = PageBox(css_s
-00002730: 7479 6c65 3d63 7373 5f73 7479 6c65 290a  tyle=css_style).
-00002740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002750: 7061 6765 5f62 6f78 2e61 6464 5f73 7479  page_box.add_sty
-00002760: 6c65 5f73 7061 6e5f 616e 645f 7061 6765  le_span_and_page
-00002770: 5f6e 756d 6265 7228 7374 796c 655f 7370  _number(style_sp
-00002780: 616e 290a 2020 2020 2020 2020 2020 2020  an).            
-00002790: 2020 2020 7365 6c66 2e70 6167 655f 626f      self.page_bo
-000027a0: 7865 732e 6170 7065 6e64 2870 6167 655f  xes.append(page_
-000027b0: 626f 7829 0a0a 2020 2020 2020 2020 7365  box)..        se
-000027c0: 6c66 2e65 7874 7261 6374 5f70 6167 655f  lf.extract_page_
-000027d0: 6e75 6d62 6572 7328 290a 0a20 2020 2064  numbers()..    d
-000027e0: 6566 2065 7874 7261 6374 5f70 6167 655f  ef extract_page_
-000027f0: 6e75 6d62 6572 7328 7365 6c66 293a 0a20  numbers(self):. 
-00002800: 2020 2020 2020 2070 6167 656e 6f5f 7870         pageno_xp
-00002810: 6174 6820 3d20 222f 2f73 7061 6e2f 6469  ath = "//span/di
-00002820: 762f 615b 406e 616d 655d 2220 2023 2070  v/a[@name]"  # p
-00002830: 6167 6520 6e75 6d62 6572 2062 6f78 6573  age number boxes
-00002840: 3b20 7468 6520 7061 7265 6e74 2073 7061  ; the parent spa
-00002850: 6e20 6973 2068 6f72 7269 640a 2020 2020  n is horrid.    
-00002860: 2020 2020 656c 656d 5f77 6974 685f 7061      elem_with_pa
-00002870: 6765 6e6f 7320 3d20 7365 6c66 2e72 6177  genos = self.raw
-00002880: 5f65 6c65 6d2e 7870 6174 6828 7061 6765  _elem.xpath(page
-00002890: 6e6f 5f78 7061 7468 290a 2020 2020 2020  no_xpath).      
-000028a0: 2020 6373 735f 6c61 7374 203d 204e 6f6e    css_last = Non
-000028b0: 650a 2020 2020 2020 2020 2222 223c 6272  e.        """<br
-000028c0: 3e3c 2f73 7061 6e3e 3c73 7061 6e20 7374  ></span><span st
-000028d0: 796c 653d 2266 6f6e 742d 6661 6d69 6c79  yle="font-family
-000028e0: 3a20 4361 6c69 6272 693b 2066 6f6e 742d  : Calibri; font-
-000028f0: 7369 7a65 3a31 3070 7822 3e20 0a20 2020  size:10px"> .   
-00002900: 2020 2020 2020 2020 2020 2020 203c 6272               <br
-00002910: 3e3c 7370 616e 2073 7479 6c65 3d22 706f  ><span style="po
-00002920: 7369 7469 6f6e 3a61 6273 6f6c 7574 653b  sition:absolute;
-00002930: 2062 6f72 6465 723a 2067 7261 7920 3170   border: gray 1p
-00002940: 7820 736f 6c69 643b 206c 6566 743a 3070  x solid; left:0p
-00002950: 783b 2074 6f70 3a39 3431 7078 3b20 7769  x; top:941px; wi
-00002960: 6474 683a 3539 3570 783b 2068 6569 6768  dth:595px; heigh
-00002970: 743a 3834 3170 783b 223e 3c2f 7370 616e  t:841px;"></span
-00002980: 3e0a 2020 2020 2020 2020 2020 2020 2020  >.              
-00002990: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-000029a0: 2020 203c 6469 7620 7374 796c 653d 2270     <div style="p
-000029b0: 6f73 6974 696f 6e3a 6162 736f 6c75 7465  osition:absolute
-000029c0: 3b20 746f 703a 3934 3170 783b 223e 3c61  ; top:941px;"><a
-000029d0: 206e 616d 653d 2232 223e 5061 6765 2032   name="2">Page 2
-000029e0: 3c2f 613e 3c2f 6469 763e 0a20 2020 2020  </a></div>.     
-000029f0: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
-00002a00: 2020 2020 2020 2066 6f72 2065 6c65 6d5f         for elem_
-00002a10: 7769 7468 5f70 6167 656e 6f20 696e 2065  with_pageno in e
-00002a20: 6c65 6d5f 7769 7468 5f70 6167 656e 6f73  lem_with_pagenos
-00002a30: 3a0a 2020 2020 2020 2020 2020 2020 6765  :.            ge
-00002a40: 7470 6172 656e 7420 3d20 656c 656d 5f77  tparent = elem_w
-00002a50: 6974 685f 7061 6765 6e6f 2e67 6574 7061  ith_pageno.getpa
-00002a60: 7265 6e74 2829 0a20 2020 2020 2020 2020  rent().         
-00002a70: 2020 2063 7373 203d 2043 5353 5374 796c     css = CSSStyl
-00002a80: 652e 6372 6561 7465 5f63 7373 5f73 7479  e.create_css_sty
-00002a90: 6c65 5f66 726f 6d5f 6174 7472 6962 7574  le_from_attribut
-00002aa0: 655f 6f66 5f62 6f64 795f 656c 656d 656e  e_of_body_elemen
-00002ab0: 7428 6765 7470 6172 656e 7429 0a20 2020  t(getparent).   
-00002ac0: 2020 2020 2020 2020 2070 7265 765f 656c           prev_el
-00002ad0: 656d 203d 2067 6574 7061 7265 6e74 2e67  em = getparent.g
-00002ae0: 6574 7072 6576 696f 7573 2829 0a20 2020  etprevious().   
-00002af0: 2020 2020 2020 2020 2068 6569 6768 7420           height 
-00002b00: 3d20 2d31 2069 6620 6373 735f 6c61 7374  = -1 if css_last
-00002b10: 2069 7320 4e6f 6e65 2065 6c73 6520 6373   is None else cs
-00002b20: 732e 746f 7020 2d20 6373 735f 6c61 7374  s.top - css_last
-00002b30: 2e74 6f70 0a20 2020 2020 2020 2020 2020  .top.           
-00002b40: 2070 7265 765f 7374 796c 6520 3d20 4353   prev_style = CS
-00002b50: 5353 7479 6c65 2e63 7265 6174 655f 6373  SStyle.create_cs
-00002b60: 735f 7374 796c 655f 6672 6f6d 5f61 7474  s_style_from_att
-00002b70: 7269 6275 7465 5f6f 665f 626f 6479 5f65  ribute_of_body_e
-00002b80: 6c65 6d65 6e74 2870 7265 765f 656c 656d  lement(prev_elem
-00002b90: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00002ba0: 206e 6f74 2070 7265 765f 7374 796c 653a   not prev_style:
-00002bb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002bc0: 206c 6f67 6769 6e67 2e77 6172 6e69 6e67   logging.warning
-00002bd0: 2866 2220 6e6f 2070 7265 7669 6f75 7320  (f" no previous 
-00002be0: 7374 796c 6522 290a 2020 2020 2020 2020  style").        
-00002bf0: 2020 2020 6262 6f78 203d 204e 6f6e 6520      bbox = None 
-00002c00: 6966 2070 7265 765f 7374 796c 6520 6973  if prev_style is
-00002c10: 204e 6f6e 6520 656c 7365 2070 7265 765f   None else prev_
-00002c20: 7374 796c 652e 6372 6561 7465 5f62 626f  style.create_bbo
-00002c30: 7828 290a 2020 2020 2020 2020 2020 2020  x().            
-00002c40: 6373 735f 6c61 7374 203d 2063 7373 0a20  css_last = css. 
-00002c50: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-00002c60: 656d 5f77 6974 685f 7061 6765 6e6f 730a  em_with_pagenos.
-00002c70: 0a0a 2020 2020 6465 6620 7072 696e 745f  ..    def print_
-00002c80: 7061 6765 735f 6469 7628 7365 6c66 2c20  pages_div(self, 
-00002c90: 7261 6e67 6573 3d4e 6f6e 6529 3a0a 2020  ranges=None):.  
-00002ca0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00002cb0: 2020 6d61 7962 6520 6a75 7374 2061 2064    maybe just a d
-00002cc0: 6562 7567 6765 720a 2020 2020 2020 2020  ebugger.        
-00002cd0: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-00002ce0: 7261 6e67 6573 3a0a 2020 2020 2020 2020  ranges:.        
-00002cf0: 2020 2020 4874 6d6c 5469 6479 2e64 6562      HtmlTidy.deb
-00002d00: 7567 5f62 795f 7870 6174 6828 7365 6c66  ug_by_xpath(self
-00002d10: 2e72 6177 5f65 6c65 6d2c 2022 2f68 746d  .raw_elem, "/htm
-00002d20: 6c2f 626f 6479 2f73 7061 6e22 2c20 7469  l/body/span", ti
-00002d30: 746c 653d 2264 6972 6563 7420 7370 616e  tle="direct span
-00002d40: 7320 756e 6465 7220 626f 6479 2022 2c0a  s under body ",.
-00002d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000220: 616d 696c 6962 2e66 696c 655f 6c69 6220  amilib.file_lib 
+00000230: 696d 706f 7274 2046 696c 654c 6962 0a66  import FileLib.f
+00000240: 726f 6d20 616d 696c 6962 2e75 7469 6c20  rom amilib.util 
+00000250: 696d 706f 7274 2053 5363 7269 7074 2c20  import SScript, 
+00000260: 5574 696c 2c20 416d 694c 6f67 6765 720a  Util, AmiLogger.
+00000270: 6672 6f6d 2061 6d69 6c69 622e 786d 6c5f  from amilib.xml_
+00000280: 6c69 6220 696d 706f 7274 2058 6d6c 4c69  lib import XmlLi
+00000290: 622c 2048 746d 6c4c 6962 0a0a 2320 6e6f  b, HtmlLib..# no
+000002a0: 2074 7279 2d63 6174 6368 2069 6d70 6f72   try-catch impor
+000002b0: 7473 0a0a 6c6f 6767 6572 203d 2046 696c  ts..logger = Fil
+000002c0: 654c 6962 2e67 6574 5f6c 6f67 6765 7228  eLib.get_logger(
+000002d0: 5f5f 6669 6c65 5f5f 290a 0a23 2048 544d  __file__)..# HTM
+000002e0: 4c20 656c 656d 656e 7473 0a48 5f48 544d  L elements.H_HTM
+000002f0: 4c20 3d20 2268 746d 6c22 0a48 5f48 4541  L = "html".H_HEA
+00000300: 4420 3d20 2268 6561 6422 0a48 5f4d 4554  D = "head".H_MET
+00000310: 4120 3d20 226d 6574 6122 0a48 5f53 4352  A = "meta".H_SCR
+00000320: 4950 5420 3d20 2273 6372 6970 7422 0a48  IPT = "script".H
+00000330: 5f53 5459 4c45 203d 2022 7374 796c 6522  _STYLE = "style"
+00000340: 0a48 5f42 4f44 5920 3d20 2262 6f64 7922  .H_BODY = "body"
+00000350: 0a48 5f54 4142 4c45 203d 2022 7461 626c  .H_TABLE = "tabl
+00000360: 6522 0a48 5f54 4845 4144 203d 2022 7468  e".H_THEAD = "th
+00000370: 6561 6422 0a48 5f54 4954 4c45 203d 2022  ead".H_TITLE = "
+00000380: 7469 746c 6522 0a48 5f54 424f 4459 203d  title".H_TBODY =
+00000390: 2022 7462 6f64 7922 0a48 5f54 5220 3d20   "tbody".H_TR = 
+000003a0: 2274 7222 0a48 5f54 4820 3d20 2274 6822  "tr".H_TH = "th"
+000003b0: 0a48 5f54 4420 3d20 2274 6422 0a48 5f44  .H_TD = "td".H_D
+000003c0: 4956 203d 2022 6469 7622 0a48 5f53 5041  IV = "div".H_SPA
+000003d0: 4e20 3d20 2273 7061 6e22 0a48 5f55 4c20  N = "span".H_UL 
+000003e0: 3d20 2275 6c22 0a48 5f4c 4920 3d20 226c  = "ul".H_LI = "l
+000003f0: 6922 0a48 5f41 203d 2022 6122 0a48 5f42  i".H_A = "a".H_B
+00000400: 203d 2022 6222 0a48 5f50 203d 2022 7022   = "b".H_P = "p"
+00000410: 0a0a 5820 3d20 2278 220a 5920 3d20 2279  ..X = "x".Y = "y
+00000420: 220a 5830 203d 2022 7830 220a 5831 203d  ".X0 = "x0".X1 =
+00000430: 2022 7831 220a 0a23 2048 544d 4c20 6174   "x1"..# HTML at
+00000440: 7472 6962 7574 6573 0a41 5f43 4c41 5353  tributes.A_CLASS
+00000450: 203d 2022 636c 6173 7322 0a41 5f48 5245   = "class".A_HRE
+00000460: 4620 3d20 2268 7265 6622 0a41 5f49 4420  F = "href".A_ID 
+00000470: 3d20 2269 6422 0a41 5f4e 414d 4520 3d20  = "id".A_NAME = 
+00000480: 226e 616d 6522 0a41 5f53 5459 4c45 203d  "name".A_STYLE =
+00000490: 2022 7374 796c 6522 0a41 5f54 4552 4d20   "style".A_TERM 
+000004a0: 3d20 2274 6572 6d22 0a41 5f54 4954 4c45  = "term".A_TITLE
+000004b0: 203d 2022 7469 746c 6522 0a0a 585f 5052   = "title"..X_PR
+000004c0: 4543 4544 494e 4720 3d20 2270 7265 6365  ECEDING = "prece
+000004d0: 6469 6e67 220a 0a23 2073 7479 6c65 2062  ding"..# style b
+000004e0: 756e 646c 650a 5354 594c 4520 3d20 2273  undle.STYLE = "s
+000004f0: 7479 6c65 220a 4954 414c 4943 203d 2022  tyle".ITALIC = "
+00000500: 6974 616c 6963 220a 424f 4c44 203d 2022  italic".BOLD = "
+00000510: 626f 6c64 220a 5449 4d45 5320 3d20 2274  bold".TIMES = "t
+00000520: 696d 6573 220a 4341 4c49 4252 4920 3d20  imes".CALIBRI = 
+00000530: 2263 616c 6962 7269 220a 464f 4e54 5f46  "calibri".FONT_F
+00000540: 414d 494c 4945 5320 3d20 5b54 494d 4553  AMILIES = [TIMES
+00000550: 2c20 4341 4c49 4252 495d 0a0a 2320 7374  , CALIBRI]..# st
+00000560: 796c 6520 6174 7472 6962 7574 6573 0a46  yle attributes.F
+00000570: 4f4e 545f 5349 5a45 203d 2022 666f 6e74  ONT_SIZE = "font
+00000580: 2d73 697a 6522 0a46 4f4e 545f 5354 594c  -size".FONT_STYL
+00000590: 4520 3d20 2266 6f6e 742d 7374 796c 6522  E = "font-style"
+000005a0: 0a46 4f4e 545f 5745 4947 4854 203d 2022  .FONT_WEIGHT = "
+000005b0: 666f 6e74 2d77 6569 6768 7422 0a46 4f4e  font-weight".FON
+000005c0: 545f 4641 4d49 4c59 203d 2022 666f 6e74  T_FAMILY = "font
+000005d0: 2d66 616d 696c 7922 0a46 4f4e 545f 464f  -family".FONT_FO
+000005e0: 4e54 203d 2022 666f 6e74 220a 464f 4e54  NT = "font".FONT
+000005f0: 5f4e 414d 4520 3d20 2266 6f6e 742d 6e61  _NAME = "font-na
+00000600: 6d65 220a 464f 4e54 5f53 5452 4554 4348  me".FONT_STRETCH
+00000610: 4544 203d 2022 666f 6e74 2d73 7472 6574  ED = "font-stret
+00000620: 6368 6564 220a 4649 4c4c 203d 2022 6669  ched".FILL = "fi
+00000630: 6c6c 220a 5354 524f 4b45 203d 2022 7374  ll".STROKE = "st
+00000640: 726f 6b65 220a 0a23 2063 6861 7261 6374  roke"..# charact
+00000650: 6572 2070 726f 7065 7274 6965 730a 505f  er properties.P_
+00000660: 464f 4e54 4e41 4d45 203d 2022 666f 6e74  FONTNAME = "font
+00000670: 6e61 6d65 220a 505f 4845 4947 4854 203d  name".P_HEIGHT =
+00000680: 2022 6865 6967 6874 220a 505f 5354 524f   "height".P_STRO
+00000690: 4b49 4e47 5f43 4f4c 4f52 203d 2022 7374  KING_COLOR = "st
+000006a0: 726f 6b69 6e67 5f63 6f6c 6f72 220a 505f  roking_color".P_
+000006b0: 4e4f 4e5f 5354 524f 4b49 4e47 5f43 4f4c  NON_STROKING_COL
+000006c0: 4f52 203d 2022 6e6f 6e5f 7374 726f 6b69  OR = "non_stroki
+000006d0: 6e67 5f63 6f6c 6f72 220a 0a50 5f58 3020  ng_color"..P_X0 
+000006e0: 3d20 2278 3022 0a50 5f58 3120 3d20 2278  = "x0".P_X1 = "x
+000006f0: 3122 0a50 5f59 3020 3d20 2279 3022 0a50  1".P_Y0 = "y0".P
+00000700: 5f59 3120 3d20 2279 3122 0a50 5f54 4558  _Y1 = "y1".P_TEX
+00000710: 5420 3d20 2274 6578 7422 0a0a 2320 556e  T = "text"..# Un
+00000720: 7761 6e74 6564 2073 6563 7469 6f6e 730a  wanted sections.
+00000730: 555f 5850 4154 4820 3d20 2278 7061 7468  U_XPATH = "xpath
+00000740: 220a 555f 5245 4745 5820 3d20 2272 6567  ".U_REGEX = "reg
+00000750: 6578 220a 0a53 5459 4c45 5320 3d20 5b0a  ex"..STYLES = [.
+00000760: 2020 2020 464f 4e54 5f53 495a 452c 0a20      FONT_SIZE,. 
+00000770: 2020 2046 4f4e 545f 5354 594c 452c 0a20     FONT_STYLE,. 
+00000780: 2020 2046 4f4e 545f 4641 4d49 4c59 2c0a     FONT_FAMILY,.
+00000790: 2020 2020 464f 4e54 5f57 4549 4748 542c      FONT_WEIGHT,
+000007a0: 0a20 2020 2046 494c 4c2c 0a20 2020 2053  .    FILL,.    S
+000007b0: 5452 4f4b 452c 0a5d 0a0a 2320 4353 530a  TROKE,.]..# CSS.
+000007c0: 535f 424f 5244 4552 203d 2022 626f 7264  S_BORDER = "bord
+000007d0: 6572 220a 535f 504f 5349 5449 4f4e 203d  er".S_POSITION =
+000007e0: 2022 706f 7369 7469 6f6e 220a 535f 5749   "position".S_WI
+000007f0: 4454 4820 3d20 2277 6964 7468 220a 535f  DTH = "width".S_
+00000800: 5752 4954 494e 475f 4d4f 4445 203d 2022  WRITING_MODE = "
+00000810: 7772 6974 696e 672d 6d6f 6465 220a 0a5f  writing-mode".._
+00000820: 5554 4638 203d 2022 5554 462d 3822 0a0a  UTF8 = "UTF-8"..
+00000830: 4348 4150 5f54 4f50 5f52 4543 203d 2072  CHAP_TOP_REC = r
+00000840: 652e 636f 6d70 696c 6528 225f 5f4e 4f54  e.compile("__NOT
+00000850: 5f5f 5945 545f 5f49 4d50 4c45 4d45 4e54  __YET__IMPLEMENT
+00000860: 4544 5f5f 2229 0a53 4543 5449 4f4e 535f  ED__").SECTIONS_
+00000870: 4445 4349 4d41 4c5f 5245 4320 3d20 7265  DECIMAL_REC = re
+00000880: 2e63 6f6d 7069 6c65 2822 5c5c 642b 5c5c  .compile("\\d+\\
+00000890: 2e5c 5c64 2b24 2229 0a53 5542 5345 4354  .\\d+$").SUBSECT
+000008a0: 535f 4445 4349 4d41 4c5f 5245 4320 3d20  S_DECIMAL_REC = 
+000008b0: 7265 2e63 6f6d 7069 6c65 2822 5c5c 642b  re.compile("\\d+
+000008c0: 5c5c 2e5c 5c64 2b5c 5c2e 5c5c 642b 2422  \\.\\d+\\.\\d+$"
+000008d0: 290a 0a43 4c41 5353 5245 4620 3d20 2263  )..CLASSREF = "c
+000008e0: 6c61 7373 7265 6622 0a0a 5354 594c 455f  lassref"..STYLE_
+000008f0: 5850 4154 4820 3d20 222f 6874 6d6c 2f68  XPATH = "/html/h
+00000900: 6561 642f 7374 796c 6522 0a0a 2222 220a  ead/style"..""".
+00000910: 4e4f 5445 2e20 7468 6520 7573 6520 6f66  NOTE. the use of
+00000920: 2063 6c61 7373 6e61 6d65 2c20 636c 6173   classname, clas
+00000930: 7372 6566 2061 6e64 2073 696d 696c 6172  sref and similar
+00000940: 2069 7320 696e 636f 6e73 6973 7465 6e74   is inconsistent
+00000950: 2e20 5765 2077 616e 7420 746f 2068 6176  . We want to hav
+00000960: 653a 0a73 3120 2074 6f20 6d65 616e 2063  e:.s1  to mean c
+00000970: 6c61 7373 206e 616d 6520 2863 6c61 7373  lass name (class
+00000980: 6e61 6d65 290a 2e73 3120 746f 206d 6561  name)..s1 to mea
+00000990: 6e20 6120 7265 6665 7265 6e63 6520 746f  n a reference to
+000009a0: 2061 2063 6c61 7373 6e61 6d65 2028 6f6e   a classname (on
+000009b0: 6c79 2075 7365 6420 696e 203c 7374 796c  ly used in <styl
+000009c0: 653e 2065 6c65 6d65 6e74 7320 6275 7420  e> elements but 
+000009d0: 696e 766f 6c76 6564 2069 6e20 636f 6e76  involved in conv
+000009e0: 6572 7369 6f6e 730a 2222 220a 0a6c 6f67  ersions."""..log
+000009f0: 6765 7220 3d20 4669 6c65 4c69 622e 6765  ger = FileLib.ge
+00000a00: 745f 6c6f 6767 6572 285f 5f66 696c 655f  t_logger(__file_
+00000a10: 5f29 0a0a 636c 6173 7320 416d 6953 7061  _)..class AmiSpa
+00000a20: 6e3a 0a20 2020 2064 6566 205f 5f69 6e69  n:.    def __ini
+00000a30: 745f 5f28 7365 6c66 293a 0a20 2020 2020  t__(self):.     
+00000a40: 2020 2073 656c 662e 7465 7874 5f73 7479     self.text_sty
+00000a50: 6c65 203d 204e 6f6e 650a 2020 2020 2020  le = None.      
+00000a60: 2020 7365 6c66 2e73 7472 696e 6720 3d20    self.string = 
+00000a70: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+00000a80: 7878 203d 205b 5d0a 2020 2020 2020 2020  xx = [].        
+00000a90: 7365 6c66 2e78 3020 3d20 4e6f 6e65 0a20  self.x0 = None. 
+00000aa0: 2020 2020 2020 2073 656c 662e 7831 203d         self.x1 =
+00000ab0: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
+00000ac0: 6c66 2e79 3020 3d20 4e6f 6e65 0a20 2020  lf.y0 = None.   
+00000ad0: 2020 2020 2023 2073 656c 662e 6164 7620       # self.adv 
+00000ae0: 3d20 4e6f 6e65 0a0a 2020 2020 6465 6620  = None..    def 
+00000af0: 6372 6561 7465 5f61 6e64 5f61 6464 5f74  create_and_add_t
+00000b00: 6f28 7365 6c66 2c20 6469 7629 3a0a 2020  o(self, div):.  
+00000b10: 2020 2020 2020 6874 6d6c 5f73 7061 6e20        html_span 
+00000b20: 3d20 4e6f 6e65 0a20 2020 2020 2020 2069  = None.        i
+00000b30: 6620 6469 7620 6973 206e 6f74 204e 6f6e  f div is not Non
+00000b40: 653a 0a20 2020 2020 2020 2020 2020 2068  e:.            h
+00000b50: 746d 6c5f 7370 616e 203d 2045 542e 5375  tml_span = ET.Su
+00000b60: 6245 6c65 6d65 6e74 2864 6976 2c20 485f  bElement(div, H_
+00000b70: 5350 414e 290a 2020 2020 2020 2020 2020  SPAN).          
+00000b80: 2020 6874 6d6c 5f73 7061 6e2e 7465 7874    html_span.text
+00000b90: 203d 2073 656c 662e 7374 7269 6e67 0a20   = self.string. 
+00000ba0: 2020 2020 2020 2020 2020 2048 746d 6c53             HtmlS
+00000bb0: 7479 6c65 2e73 6574 5f73 7479 6c65 2868  tyle.set_style(h
+00000bc0: 746d 6c5f 7370 616e 2c20 7365 6c66 2e74  tml_span, self.t
+00000bd0: 6578 745f 7374 796c 652e 6372 6561 7465  ext_style.create
+00000be0: 5f63 7373 5f73 7472 696e 6728 2929 0a20  _css_string()). 
+00000bf0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00000c00: 6e28 7365 6c66 2e78 7829 203e 2030 3a0a  n(self.xx) > 0:.
+00000c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00000c20: 6874 6d6c 5f73 7061 6e2e 6174 7472 6962  html_span.attrib
+00000c30: 5b58 5d20 3d20 7365 6c66 2e78 785b 305d  [X] = self.xx[0]
+00000c40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00000c50: 7365 6c66 2e78 303a 0a20 2020 2020 2020  self.x0:.       
+00000c60: 2020 2020 2020 2020 2068 746d 6c5f 7370           html_sp
+00000c70: 616e 2e61 7474 7269 625b 5830 5d20 3d20  an.attrib[X0] = 
+00000c80: 7374 7228 7365 6c66 2e78 3029 0a20 2020  str(self.x0).   
+00000c90: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00000ca0: 2e78 313a 0a20 2020 2020 2020 2020 2020  .x1:.           
+00000cb0: 2020 2020 2068 746d 6c5f 7370 616e 2e61       html_span.a
+00000cc0: 7474 7269 625b 5831 5d20 3d20 7374 7228  ttrib[X1] = str(
+00000cd0: 7365 6c66 2e78 3129 0a20 2020 2020 2020  self.x1).       
+00000ce0: 2020 2020 2068 746d 6c5f 7370 616e 2e61       html_span.a
+00000cf0: 7474 7269 625b 595d 203d 2073 7472 2873  ttrib[Y] = str(s
+00000d00: 656c 662e 7930 290a 2020 2020 2020 2020  elf.y0).        
+00000d10: 7265 7475 726e 2068 746d 6c5f 7370 616e  return html_span
+00000d20: 0a0a 0a23 2073 686f 756c 6420 6d61 7962  ...# should mayb
+00000d30: 6520 6265 2069 6e20 5044 460a 636c 6173  e be in PDF.clas
+00000d40: 7320 5061 6765 426f 783a 2020 2320 6465  s PageBox:  # de
+00000d50: 6669 6e65 6420 6279 2070 6466 6d69 6e65  fined by pdfmine
+00000d60: 7220 4920 7468 696e 6b0a 0a20 2020 2022  r I think..    "
+00000d70: 2222 0a3c 6272 3e3c 7370 616e 2073 7479  "".<br><span sty
+00000d80: 6c65 3d22 706f 7369 7469 6f6e 3a61 6273  le="position:abs
+00000d90: 6f6c 7574 653b 2062 6f72 6465 723a 2067  olute; border: g
+00000da0: 7261 7920 3170 7820 736f 6c69 643b 206c  ray 1px solid; l
+00000db0: 6566 743a 3070 783b 2074 6f70 3a39 3431  eft:0px; top:941
+00000dc0: 7078 3b20 7769 6474 683a 3539 3570 783b  px; width:595px;
+00000dd0: 2068 6569 6768 743a 3834 3170 783b 223e   height:841px;">
+00000de0: 3c2f 7370 616e 3e0a 3c64 6976 2073 7479  </span>.<div sty
+00000df0: 6c65 3d22 706f 7369 7469 6f6e 3a61 6273  le="position:abs
+00000e00: 6f6c 7574 653b 2074 6f70 3a39 3431 7078  olute; top:941px
+00000e10: 3b22 3e3c 6120 6e61 6d65 3d22 3222 3e50  ;"><a name="2">P
+00000e20: 6167 6520 323c 2f61 3e3c 2f64 6976 3e0a  age 2</a></div>.
+00000e30: 0a66 6f72 2049 5043 4320 746f 7028 5061  .for IPCC top(Pa
+00000e40: 6765 3129 203d 2035 300a 746f 7028 5061  ge1) = 50.top(Pa
+00000e50: 6765 6e29 203d 2035 3020 2b20 286e 202d  gen) = 50 + (n -
+00000e60: 2031 2920 2a20 2838 3431 202b 2034 3729   1) * (841 + 47)
+00000e70: 0a0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
+00000e80: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
+00000e90: 2c20 6373 735f 7374 796c 653d 4e6f 6e65  , css_style=None
+00000ea0: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
+00000eb0: 6373 735f 7374 796c 6520 3d20 6373 735f  css_style = css_
+00000ec0: 7374 796c 650a 2020 2020 2020 2020 7365  style.        se
+00000ed0: 6c66 2e62 626f 7820 3d20 4242 6f78 2829  lf.bbox = BBox()
+00000ee0: 2020 2320 756e 696e 6974 6961 6c69 7365    # uninitialise
+00000ef0: 640a 2020 2020 2020 2020 6966 2073 656c  d.        if sel
+00000f00: 662e 6373 735f 7374 796c 653a 0a20 2020  f.css_style:.   
+00000f10: 2020 2020 2020 2020 2074 6f70 203d 2073           top = s
+00000f20: 656c 662e 6373 735f 7374 796c 652e 746f  elf.css_style.to
+00000f30: 700a 2020 2020 2020 2020 2020 2020 6c65  p.            le
+00000f40: 6674 203d 2073 656c 662e 6373 735f 7374  ft = self.css_st
+00000f50: 796c 652e 6c65 6674 0a20 2020 2020 2020  yle.left.       
+00000f60: 2020 2020 2077 6964 7468 203d 2073 656c       width = sel
+00000f70: 662e 6373 735f 7374 796c 652e 7769 6474  f.css_style.widt
+00000f80: 680a 2020 2020 2020 2020 2020 2020 6865  h.            he
+00000f90: 6967 6874 203d 2073 656c 662e 6373 735f  ight = self.css_
+00000fa0: 7374 796c 652e 6865 6967 6874 0a20 2020  style.height.   
+00000fb0: 2020 2020 2020 2020 2073 656c 662e 6262           self.bb
+00000fc0: 6f78 2e78 795f 7261 6e67 6573 203d 205b  ox.xy_ranges = [
+00000fd0: 5b6c 6566 742c 206c 6566 7420 2b20 7769  [left, left + wi
+00000fe0: 6474 685d 2c20 5b74 6f70 2c20 746f 7020  dth], [top, top 
+00000ff0: 2b20 6865 6967 6874 5d5d 0a20 2020 2020  + height]].     
+00001000: 2020 2073 656c 662e 656c 656d 203d 204e     self.elem = N
+00001010: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
+00001020: 2e69 6e74 5f6e 756d 6265 7220 3d20 4e6f  .int_number = No
+00001030: 6e65 2020 2320 7064 6670 6c75 6d62 6572  ne  # pdfplumber
+00001040: 2069 6e74 6567 6572 2070 6167 6520 2831   integer page (1
+00001050: 2d62 6173 6564 290a 2020 2020 2020 2020  -based).        
+00001060: 7365 6c66 2e70 5f6e 756d 5f73 7472 203d  self.p_num_str =
+00001070: 204e 6f6e 6520 2023 2070 6466 706c 756d   None  # pdfplum
+00001080: 6265 7220 2250 6167 6520 3132 220a 0a20  ber "Page 12".. 
+00001090: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+000010a0: 2064 6566 2070 6167 655f 6e75 6d62 6572   def page_number
+000010b0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+000010c0: 6966 206e 6f74 2073 656c 662e 696e 745f  if not self.int_
+000010d0: 6e75 6d62 6572 3a0a 2020 2020 2020 2020  number:.        
+000010e0: 2020 2020 7365 6c66 2e69 6e74 5f6e 756d      self.int_num
+000010f0: 6265 7220 3d20 4e6f 6e65 2069 6620 7365  ber = None if se
+00001100: 6c66 2e65 6c65 6d20 6973 204e 6f6e 6520  lf.elem is None 
+00001110: 656c 7365 2050 6167 6542 6f78 2e65 7874  else PageBox.ext
+00001120: 7261 6374 5f70 6167 655f 6e75 6d62 6572  ract_page_number
+00001130: 5f66 726f 6d5f 7064 665f 6874 6d6c 2873  _from_pdf_html(s
+00001140: 656c 662e 656c 656d 290a 2020 2020 2020  elf.elem).      
+00001150: 2020 7265 7475 726e 2073 656c 662e 696e    return self.in
+00001160: 745f 6e75 6d62 6572 0a0a 2020 2020 4063  t_number..    @c
+00001170: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00001180: 6566 2065 7874 7261 6374 5f70 6167 655f  ef extract_page_
+00001190: 6e75 6d62 6572 5f66 726f 6d5f 7064 665f  number_from_pdf_
+000011a0: 6874 6d6c 2863 6c73 2c20 656c 656d 293a  html(cls, elem):
+000011b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000011c0: 2020 2020 2073 6f6d 6520 656c 656d 656e       some elemen
+000011d0: 7473 203f 7370 616e 7329 2066 726f 6d20  ts ?spans) from 
+000011e0: 7064 6620 7061 7273 696e 6720 6861 7665  pdf parsing have
+000011f0: 2074 6865 2066 6f72 6d3a 0a20 2020 2020   the form:.     
+00001200: 2020 203c 6469 7620 2e2e 2e3e 3c61 206e     <div ...><a n
+00001210: 616d 653d 2232 223e 5061 6765 2032 3c2f  ame="2">Page 2</
+00001220: 613e 0a0a 2020 2020 2020 2020 3a70 6172  a>..        :par
+00001230: 616d 2065 6c65 6d3a 2063 6f6e 7461 696e  am elem: contain
+00001240: 7320 7061 6765 206e 756d 6265 720a 2020  s page number.  
+00001250: 2020 2020 2020 3a72 6574 7572 6e3a 2070        :return: p
+00001260: 6167 6520 6e75 6d62 6572 206f 7220 6e6f  age number or no
+00001270: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
+00001280: 2020 2020 2020 2069 6620 656c 656d 2069         if elem i
+00001290: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+000012a0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+000012b0: 2020 2020 2020 2020 7870 6174 6878 203d          xpathx =
+000012c0: 2066 222e 2f2f 612f 407b 415f 4e41 4d45   f".//a/@{A_NAME
+000012d0: 7d22 0a20 2020 2020 2020 2061 6e61 6d65  }".        aname
+000012e0: 203d 2065 6c65 6d2e 7870 6174 6828 7870   = elem.xpath(xp
+000012f0: 6174 6878 290a 2020 2020 2020 2020 7265  athx).        re
+00001300: 7475 726e 2061 6e61 6d65 0a0a 2020 2020  turn aname..    
+00001310: 6465 6620 6164 645f 7374 796c 655f 7370  def add_style_sp
+00001320: 616e 5f61 6e64 5f70 6167 655f 6e75 6d62  an_and_page_numb
+00001330: 6572 2873 656c 662c 2065 6c65 6d29 3a0a  er(self, elem):.
+00001340: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00001350: 2020 2020 6164 6420 7374 796c 6520 7370      add style sp
+00001360: 616e 2020 616e 6420 616c 736f 2067 6574  an  and also get
+00001370: 2070 6167 656e 756d 6265 7220 6672 6f6d   pagenumber from
+00001380: 206e 6578 7420 656c 656d 656e 740a 0a20   next element.. 
+00001390: 2020 2020 2020 2074 7970 6963 616c 2074         typical t
+000013a0: 7261 696c 696e 6720 656c 656d 656e 740a  railing element.
+000013b0: 2020 2020 2020 2020 3c64 6976 2073 7479          <div sty
+000013c0: 6c65 3d22 706f 7369 7469 6f6e 3a61 6273  le="position:abs
+000013d0: 6f6c 7574 653b 2074 6f70 3a31 3037 3533  olute; top:10753
+000013e0: 7078 3b22 3e3c 6120 6e61 6d65 3d22 3133  px;"><a name="13
+000013f0: 223e 5061 6765 2031 333c 2f61 3e3c 2f64  ">Page 13</a></d
+00001400: 6976 3e0a 2020 2020 2020 2020 2222 220a  iv>.        """.
+00001410: 2020 2020 2020 2020 7365 6c66 2e65 6c65          self.ele
+00001420: 6d20 3d20 656c 656d 0a20 2020 2020 2020  m = elem.       
+00001430: 2070 6167 655f 6469 7620 3d20 656c 656d   page_div = elem
+00001440: 2e67 6574 6e65 7874 2829 0a20 2020 2020  .getnext().     
+00001450: 2020 2069 6620 7061 6765 5f64 6976 2069     if page_div i
+00001460: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+00001470: 2020 2020 2020 2020 6e20 3d20 7061 6765          n = page
+00001480: 5f64 6976 2e78 7061 7468 2866 222e 2f61  _div.xpath(f"./a
+00001490: 2f40 7b41 5f4e 414d 457d 2229 0a20 2020  /@{A_NAME}").   
+000014a0: 2020 2020 2020 2020 206e 203d 206e 5b30           n = n[0
+000014b0: 5d20 6966 206c 656e 286e 2920 3d3d 2031  ] if len(n) == 1
+000014c0: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
+000014d0: 2020 2020 2020 2069 6620 6e3a 0a20 2020         if n:.   
+000014e0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000014f0: 662e 696e 745f 6e75 6d62 6572 203d 2069  f.int_number = i
+00001500: 6e74 286e 290a 0a20 2020 2020 2020 2020  nt(n)..         
+00001510: 2020 2070 203d 2070 6167 655f 6469 762e     p = page_div.
+00001520: 7870 6174 6828 6622 2e2f 615b 407b 415f  xpath(f"./a[@{A_
+00001530: 4e41 4d45 7d20 616e 6420 636f 6e74 6169  NAME} and contai
+00001540: 6e73 282e 2c20 2750 6167 6527 295d 2229  ns(., 'Page')]")
+00001550: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00001560: 662e 705f 6e75 6d5f 7374 7220 3d20 705b  f.p_num_str = p[
+00001570: 305d 2069 6620 6c65 6e28 7029 203d 3d20  0] if len(p) == 
+00001580: 3120 656c 7365 204e 6f6e 650a 0a0a 636c  1 else None...cl
+00001590: 6173 7320 4874 6d6c 5469 6479 3a0a 2020  ass HtmlTidy:.  
+000015a0: 2020 2222 2266 6f72 2074 6964 7969 6e67    """for tidying
+000015b0: 2050 4446 202f 2053 5647 2f20 4f43 5220   PDF / SVG/ OCR 
+000015c0: 7061 7273 696e 670a 2020 2020 7461 6b65  parsing.    take
+000015d0: 7320 7261 7720 4854 4d4c 2028 7072 6f62  s raw HTML (prob
+000015e0: 6162 6c79 2073 6361 7474 6572 6564 2077  ably scattered w
+000015f0: 6f72 6473 206f 7220 6c69 6e65 7320 2c20  ords or lines , 
+00001600: 706f 7373 6962 6c79 2077 6974 6820 636f  possibly with co
+00001610: 6f72 6469 6e61 7465 7320 616e 6420 6372  ordinates and cr
+00001620: 6561 7465 730a 2020 2020 666c 6f77 696e  eates.    flowin
+00001630: 6720 7374 796c 6564 2048 544d 4c20 7769  g styled HTML wi
+00001640: 7468 2073 7562 7363 7269 7074 732c 2066  th subscripts, f
+00001650: 6f6e 7420 7374 796c 6573 2c20 6574 632e  ont styles, etc.
+00001660: 0a20 2020 2022 2222 0a0a 2020 2020 4d49  .    """..    MI
+00001670: 4e5f 5041 4745 5f42 4f58 5f48 4549 4748  N_PAGE_BOX_HEIGH
+00001680: 5420 3d20 3330 3020 2023 2061 6c6c 6f77  T = 300  # allow
+00001690: 7320 666f 7220 6c61 6e64 7363 6170 650a  s for landscape.
+000016a0: 2020 2020 4845 4144 5f45 4c45 4d53 5f49      HEAD_ELEMS_I
+000016b0: 4e5f 5850 4154 4820 3d20 6622 7b48 5f4d  N_XPATH = f"{H_M
+000016c0: 4554 417d 207c 207b 485f 5449 544c 457d  ETA} | {H_TITLE}
+000016d0: 207c 207b 485f 5343 5249 5054 7d20 7c20   | {H_SCRIPT} | 
+000016e0: 7b48 5f53 5459 4c45 7d22 0a0a 2020 2020  {H_STYLE}"..    
+000016f0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
+00001700: 6629 3a0a 2020 2020 2020 2020 7365 6c66  f):.        self
+00001710: 2e75 6e77 616e 7465 6473 203d 205b 5d20  .unwanteds = [] 
+00001720: 2023 206e 6f74 2073 7572 6520 7768 6174   # not sure what
+00001730: 2074 6869 7320 6973 0a20 2020 2020 2020   this is.       
+00001740: 2073 656c 662e 656d 7074 795f 656c 656d   self.empty_elem
+00001750: 656e 7473 5f74 6f5f 7265 6d6f 7665 203d  ents_to_remove =
+00001760: 205b 5d0a 2020 2020 2020 2020 7365 6c66   [].        self
+00001770: 2e73 7479 6c65 735f 746f 5f72 656d 6f76  .styles_to_remov
+00001780: 6520 3d20 5b5d 0a20 2020 2020 2020 2073  e = [].        s
+00001790: 656c 662e 6465 7363 656e 6461 6e74 735f  elf.descendants_
+000017a0: 746f 5f72 656d 6f76 6520 3d20 5b5d 0a20  to_remove = []. 
+000017b0: 2020 2020 2020 2073 656c 662e 7265 6d6f         self.remo
+000017c0: 7665 5f6c 685f 6c69 6e65 5f6e 756d 6265  ve_lh_line_numbe
+000017d0: 7273 203d 2054 7275 650a 2020 2020 2020  rs = True.      
+000017e0: 2020 7365 6c66 2e72 656d 6f76 655f 6c61    self.remove_la
+000017f0: 7267 655f 666f 6e74 6564 5f65 6c65 6d65  rge_fonted_eleme
+00001800: 6e74 7320 3d20 5472 7565 0a20 2020 2020  nts = True.     
+00001810: 2020 2073 656c 662e 7374 796c 655f 6174     self.style_at
+00001820: 7472 6962 7574 6573 5f74 6f5f 7265 6d6f  tributes_to_remo
+00001830: 7665 203d 205b 5d0a 2020 2020 2020 2020  ve = [].        
+00001840: 7365 6c66 2e6d 6172 6b65 725f 7870 6174  self.marker_xpat
+00001850: 6820 3d20 4e6f 6e65 0a20 2020 2020 2020  h = None.       
+00001860: 2073 656c 662e 7374 796c 655f 6174 7472   self.style_attr
+00001870: 6962 7574 6573 5f74 6f5f 7265 6d6f 7665  ibutes_to_remove
+00001880: 203d 205b 5d0a 0a20 2020 2020 2020 2073   = []..        s
+00001890: 656c 662e 6164 645f 6964 203d 2054 7275  elf.add_id = Tru
+000018a0: 650a 2020 2020 2020 2020 7365 6c66 2e68  e.        self.h
+000018b0: 6561 6465 7220 3d20 3830 0a20 2020 2020  eader = 80.     
+000018c0: 2020 2073 656c 662e 666f 6f74 6572 203d     self.footer =
+000018d0: 2038 300a 2020 2020 2020 2020 7365 6c66   80.        self
+000018e0: 2e70 6167 655f 746f 7073 203d 204e 6f6e  .page_tops = Non
+000018f0: 650a 2020 2020 2020 2020 7365 6c66 2e70  e.        self.p
+00001900: 6167 655f 626f 7865 7320 3d20 5b5d 0a20  age_boxes = []. 
+00001910: 2020 2020 2020 2073 656c 662e 7261 775f         self.raw_
+00001920: 656c 656d 203d 204e 6f6e 650a 2020 2020  elem = None.    
+00001930: 2020 2020 7365 6c66 2e6f 7574 6469 7220      self.outdir 
+00001940: 3d20 4e6f 6e65 0a0a 2020 2020 6465 6620  = None..    def 
+00001950: 7469 6479 5f66 6c6f 7728 7365 6c66 2c20  tidy_flow(self, 
+00001960: 7261 775f 6874 6d6c 293a 0a20 2020 2020  raw_html):.     
+00001970: 2020 2022 2222 0a20 2020 2020 2020 204e     """.        N
+00001980: 6565 6420 746f 2063 6170 7475 7265 2070  eed to capture p
+00001990: 6167 6520 696e 666f 726d 6174 696f 6e20  age information 
+000019a0: 746f 2063 6f6d 7075 7465 2070 6167 6520  to compute page 
+000019b0: 636f 6f72 6469 6e61 7465 732c 206e 6f74  coordinates, not
+000019c0: 2064 6f63 756d 656e 7420 636f 6f72 6469   document coordi
+000019d0: 6e61 7465 730a 2020 2020 2020 2020 636f  nates.        co
+000019e0: 6e76 6572 7473 2072 6177 2068 746d 6c20  nverts raw html 
+000019f0: 746f 2074 6964 790a 2020 2020 2020 2020  to tidy.        
+00001a00: 2222 220a 0a20 2020 2020 2020 2023 2054  """..        # T
+00001a10: 4f44 4f20 6368 6563 6b20 616e 6420 6d6f  ODO check and mo
+00001a20: 7665 2074 6f20 696e 7374 616e 6365 206f  ve to instance o
+00001a30: 6620 4874 6d6c 5469 6479 0a0a 2020 2020  f HtmlTidy..    
+00001a40: 2020 2020 6966 2072 6177 5f68 746d 6c20      if raw_html 
+00001a50: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00001a60: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+00001a70: 4572 726f 7228 224e 6f20 4854 4d4c 2229  Error("No HTML")
+00001a80: 0a20 2020 2020 2020 2072 6177 5f74 7265  .        raw_tre
+00001a90: 6520 3d20 4554 2e70 6172 7365 2853 7472  e = ET.parse(Str
+00001aa0: 696e 6749 4f28 7261 775f 6874 6d6c 292c  ingIO(raw_html),
+00001ab0: 2045 542e 4854 4d4c 5061 7273 6572 2829   ET.HTMLParser()
+00001ac0: 290a 2020 2020 2020 2020 7365 6c66 2e72  ).        self.r
+00001ad0: 6177 5f65 6c65 6d20 3d20 7261 775f 7472  aw_elem = raw_tr
+00001ae0: 6565 2e67 6574 726f 6f74 2829 0a20 2020  ee.getroot().   
+00001af0: 2020 2020 2073 656c 662e 6578 7472 6163       self.extrac
+00001b00: 745f 7061 6765 5f62 6f78 6573 2829 0a0a  t_page_boxes()..
+00001b10: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+00001b20: 5f65 6c65 6d65 6e74 2873 656c 662e 7261  _element(self.ra
+00001b30: 775f 656c 656d 290a 0a20 2020 2020 2020  w_elem)..       
+00001b40: 2023 2074 6869 7320 6973 2073 6574 2062   # this is set b
+00001b50: 7920 7573 6572 0a20 2020 2020 2020 2073  y user.        s
+00001b60: 656c 662e 7365 745f 7265 6d6f 7665 5f66  elf.set_remove_f
+00001b70: 6c61 6773 2829 0a0a 2020 2020 2020 2020  lags()..        
+00001b80: 7365 6c66 2e72 656d 6f76 655f 756e 7761  self.remove_unwa
+00001b90: 6e74 6564 5f61 7474 7269 6275 7465 735f  nted_attributes_
+00001ba0: 616e 645f 656c 656d 656e 7473 2829 0a20  and_elements(). 
+00001bb0: 2020 2020 2020 2070 6167 6573 697a 6520         pagesize 
+00001bc0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2069  = None.        i
+00001bd0: 6620 7365 6c66 2e6d 6172 6b65 725f 7870  f self.marker_xp
+00001be0: 6174 683a 0a20 2020 2020 2020 2020 2020  ath:.           
+00001bf0: 206f 6666 7365 742c 2070 6167 6573 697a   offset, pagesiz
+00001c00: 652c 2070 6167 655f 636f 6f72 6473 203d  e, page_coords =
+00001c10: 2048 746d 6c55 7469 6c2e 6669 6e64 5f63   HtmlUtil.find_c
+00001c20: 6f6e 7374 616e 745f 636f 6f72 6469 6e61  onstant_coordina
+00001c30: 7465 5f6d 6172 6b65 7273 2873 656c 662e  te_markers(self.
+00001c40: 7261 775f 656c 656d 2c20 7365 6c66 2e6d  raw_elem, self.m
+00001c50: 6172 6b65 725f 7870 6174 6829 0a20 2020  arker_xpath).   
+00001c60: 2020 2020 2020 2020 2048 746d 6c55 7469           HtmlUti
+00001c70: 6c2e 7265 6d6f 7665 5f68 6561 6465 7273  l.remove_headers
+00001c80: 5f61 6e64 5f66 6f6f 7465 7273 5f75 7369  _and_footers_usi
+00001c90: 6e67 5f70 6466 6d69 6e65 725f 636f 6f72  ng_pdfminer_coor
+00001ca0: 6473 280a 2020 2020 2020 2020 2020 2020  ds(.            
+00001cb0: 2020 2020 7365 6c66 2e72 6177 5f65 6c65      self.raw_ele
+00001cc0: 6d2c 0a20 2020 2020 2020 2020 2020 2020  m,.             
+00001cd0: 2020 2070 6167 6573 697a 652c 0a20 2020     pagesize,.   
+00001ce0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00001cf0: 662e 6865 6164 6572 2c0a 2020 2020 2020  f.header,.      
+00001d00: 2020 2020 2020 2020 2020 7365 6c66 2e66            self.f
+00001d10: 6f6f 7465 722c 0a20 2020 2020 2020 2020  ooter,.         
+00001d20: 2020 2020 2020 2073 656c 662e 6d61 726b         self.mark
+00001d30: 6572 5f78 7061 7468 2c0a 2020 2020 2020  er_xpath,.      
+00001d40: 2020 2020 2020 2020 2020 7061 6765 5f74            page_t
+00001d50: 6f70 733d 7365 6c66 2e70 6167 655f 746f  ops=self.page_to
+00001d60: 7073 2c0a 2020 2020 2020 2020 2020 2020  ps,.            
+00001d70: 290a 2020 2020 2020 2020 666f 7220 6174  ).        for at
+00001d80: 7420 696e 2073 656c 662e 7374 796c 655f  t in self.style_
+00001d90: 6174 7472 6962 7574 6573 5f74 6f5f 7265  attributes_to_re
+00001da0: 6d6f 7665 3a0a 2020 2020 2020 2020 2020  move:.          
+00001db0: 2020 4874 6d6c 5574 696c 2e72 656d 6f76    HtmlUtil.remov
+00001dc0: 655f 7374 796c 655f 6174 7472 6962 7574  e_style_attribut
+00001dd0: 6528 7365 6c66 2e72 6177 5f65 6c65 6d2c  e(self.raw_elem,
+00001de0: 2061 7474 290a 2020 2020 2020 2020 4874   att).        Ht
+00001df0: 6d6c 5574 696c 2e72 656d 6f76 655f 756e  mlUtil.remove_un
+00001e00: 7761 6e74 6564 7328 7365 6c66 2e72 6177  wanteds(self.raw
+00001e10: 5f65 6c65 6d2c 2073 656c 662e 756e 7761  _elem, self.unwa
+00001e20: 6e74 6564 7329 0a20 2020 2020 2020 2048  nteds).        H
+00001e30: 746d 6c55 7469 6c2e 7265 6d6f 7665 5f6e  tmlUtil.remove_n
+00001e40: 6577 6c69 6e65 7328 7365 6c66 2e72 6177  ewlines(self.raw
+00001e50: 5f65 6c65 6d29 0a20 2020 2020 2020 2048  _elem).        H
+00001e60: 746d 6c54 7265 652e 6d61 6b65 5f73 6563  tmlTree.make_sec
+00001e70: 7469 6f6e 735f 616e 645f 6f75 7470 7574  tions_and_output
+00001e80: 2873 656c 662e 7261 775f 656c 656d 2c20  (self.raw_elem, 
+00001e90: 6f75 7470 7574 5f64 6972 3d73 656c 662e  output_dir=self.
+00001ea0: 6f75 7464 6972 2c20 7265 6373 5f62 795f  outdir, recs_by_
+00001eb0: 7365 6374 696f 6e3d 5245 4353 5f42 595f  section=RECS_BY_
+00001ec0: 5345 4354 494f 4e29 0a20 2020 2020 2020  SECTION).       
+00001ed0: 2068 746d 6c73 7472 203d 2045 542e 746f   htmlstr = ET.to
+00001ee0: 7374 7269 6e67 2873 656c 662e 7261 775f  string(self.raw_
+00001ef0: 656c 656d 2c20 656e 636f 6469 6e67 3d5f  elem, encoding=_
+00001f00: 5554 4638 292e 6465 636f 6465 2829 0a20  UTF8).decode(). 
+00001f10: 2020 2020 2020 2072 6574 7572 6e20 6874         return ht
+00001f20: 6d6c 7374 720a 0a20 2020 2064 6566 2072  mlstr..    def r
+00001f30: 656d 6f76 655f 756e 7761 6e74 6564 5f61  emove_unwanted_a
+00001f40: 7474 7269 6275 7465 735f 616e 645f 656c  ttributes_and_el
+00001f50: 656d 656e 7473 2873 656c 6629 3a0a 2020  ements(self):.  
+00001f60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00001f70: 2020 7265 6d6f 7665 206f 626a 6563 7473    remove objects
+00001f80: 2069 6620 666c 6167 7320 6861 7665 2062   if flags have b
+00001f90: 6565 6e20 7365 7420 696e 2073 656c 660a  een set in self.
+00001fa0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00001fb0: 2020 2020 6966 2073 656c 662e 6164 645f      if self.add_
+00001fc0: 6964 3a0a 2020 2020 2020 2020 2020 2020  id:.            
+00001fd0: 4874 6d6c 5574 696c 2e61 6464 5f67 656e  HtmlUtil.add_gen
+00001fe0: 6572 6174 6564 5f69 6473 2873 656c 662e  erated_ids(self.
+00001ff0: 7261 775f 656c 656d 290a 2020 2020 2020  raw_elem).      
+00002000: 2020 666f 7220 7461 6720 696e 2073 656c    for tag in sel
+00002010: 662e 6465 7363 656e 6461 6e74 735f 746f  f.descendants_to
+00002020: 5f72 656d 6f76 653a 0a20 2020 2020 2020  _remove:.       
+00002030: 2020 2020 2045 542e 7374 7269 705f 7461       ET.strip_ta
+00002040: 6773 2873 656c 662e 7261 775f 656c 656d  gs(self.raw_elem
+00002050: 2c20 5b74 6167 5d29 0a20 2020 2020 2020  , [tag]).       
+00002060: 2069 6620 7365 6c66 2e72 656d 6f76 655f   if self.remove_
+00002070: 6c68 5f6c 696e 655f 6e75 6d62 6572 733a  lh_line_numbers:
+00002080: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
+00002090: 6c55 7469 6c2e 7265 6d6f 7665 5f6c 685f  lUtil.remove_lh_
+000020a0: 6c69 6e65 5f6e 756d 6265 7273 2873 656c  line_numbers(sel
+000020b0: 662e 7261 775f 656c 656d 290a 2020 2020  f.raw_elem).    
+000020c0: 2020 2020 6966 2073 656c 662e 7265 6d6f      if self.remo
+000020d0: 7665 5f6c 6172 6765 5f66 6f6e 7465 645f  ve_large_fonted_
+000020e0: 656c 656d 656e 7473 3a0a 2020 2020 2020  elements:.      
+000020f0: 2020 2020 2020 4874 6d6c 5574 696c 2e72        HtmlUtil.r
+00002100: 656d 6f76 655f 6c61 7267 655f 666f 6e74  emove_large_font
+00002110: 6564 5f65 6c65 6d65 6e74 7328 7365 6c66  ed_elements(self
+00002120: 2e72 6177 5f65 6c65 6d29 0a20 2020 2020  .raw_elem).     
+00002130: 2020 2066 6f72 2074 6167 2069 6e20 7365     for tag in se
+00002140: 6c66 2e65 6d70 7479 5f65 6c65 6d65 6e74  lf.empty_element
+00002150: 735f 746f 5f72 656d 6f76 653a 0a20 2020  s_to_remove:.   
+00002160: 2020 2020 2020 2020 2048 746d 6c55 7469           HtmlUti
+00002170: 6c2e 7265 6d6f 7665 5f65 6d70 7479 5f65  l.remove_empty_e
+00002180: 6c65 6d65 6e74 7328 7365 6c66 2e72 6177  lements(self.raw
+00002190: 5f65 6c65 6d2c 205b 7461 675d 290a 2020  _elem, [tag]).  
+000021a0: 2020 2020 2020 666f 7220 7374 796c 6520        for style 
+000021b0: 696e 2073 656c 662e 7374 796c 6573 5f74  in self.styles_t
+000021c0: 6f5f 7265 6d6f 7665 3a0a 2020 2020 2020  o_remove:.      
+000021d0: 2020 2020 2020 4874 6d6c 5574 696c 2e72        HtmlUtil.r
+000021e0: 656d 6f76 655f 7374 796c 6528 7365 6c66  emove_style(self
+000021f0: 2e72 6177 5f65 6c65 6d2c 205b 7374 796c  .raw_elem, [styl
+00002200: 655d 290a 0a20 2020 2064 6566 2073 6574  e])..    def set
+00002210: 5f72 656d 6f76 655f 666c 6167 7328 7365  _remove_flags(se
+00002220: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+00002230: 0a20 2020 2020 2020 2073 6574 2066 6c61  .        set fla
+00002240: 6773 2077 6869 6368 2064 6972 6563 7420  gs which direct 
+00002250: 7265 6d6f 7661 6c20 6f66 2065 6c65 6d65  removal of eleme
+00002260: 6e74 732f 6174 7472 6962 7574 6573 0a20  nts/attributes. 
+00002270: 2020 2020 2020 206e 6f72 6d61 6c6c 7920         normally 
+00002280: 756e 6465 7220 7573 6572 2063 6f6e 7472  under user contr
+00002290: 6f6c 0a20 2020 2020 2020 2022 2222 0a20  ol.        """. 
+000022a0: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
+000022b0: 6465 7363 656e 6461 6e74 5f65 6c65 6d65  descendant_eleme
+000022c0: 6e74 5f74 6f5f 7265 6d6f 7665 285b 2262  nt_to_remove(["b
+000022d0: 7222 5d29 0a20 2020 2020 2020 2073 656c  r"]).        sel
+000022e0: 662e 6164 645f 7374 796c 6573 5f74 6f5f  f.add_styles_to_
+000022f0: 7265 6d6f 7665 280a 2020 2020 2020 2020  remove(.        
+00002300: 2020 2020 5b0a 2020 2020 2020 2020 2020      [.          
+00002310: 2020 2020 2020 535f 504f 5349 5449 4f4e        S_POSITION
+00002320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00002330: 2020 2320 226c 6566 7422 2c0a 2020 2020    # "left",.    
+00002340: 2020 2020 2020 2020 2020 2020 535f 424f              S_BO
+00002350: 5244 4552 2c0a 2020 2020 2020 2020 2020  RDER,.          
+00002360: 2020 2020 2020 535f 5752 4954 494e 475f        S_WRITING_
+00002370: 4d4f 4445 2c0a 2020 2020 2020 2020 2020  MODE,.          
+00002380: 2020 2020 2020 535f 5749 4454 482c 2020        S_WIDTH,  
+00002390: 2320 7468 6973 2064 6973 6162 6c65 7320  # this disables 
+000023a0: 666c 6f77 696e 6720 7465 7874 0a20 2020  flowing text.   
+000023b0: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+000023c0: 2020 2029 0a20 2020 2020 2020 2073 656c     ).        sel
+000023d0: 662e 6164 645f 6964 203d 2054 7275 650a  f.add_id = True.
+000023e0: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
+000023f0: 5f65 6d70 7479 5f65 6c65 6d65 6e74 735f  _empty_elements_
+00002400: 746f 5f72 656d 6f76 6528 5b22 7370 616e  to_remove(["span
+00002410: 222c 2022 6469 7622 5d29 0a20 2020 2020  ", "div"]).     
+00002420: 2020 2073 656c 662e 7265 6d6f 7665 5f6c     self.remove_l
+00002430: 685f 6c69 6e65 5f6e 756d 6265 7273 203d  h_line_numbers =
+00002440: 2054 7275 6520 2023 2078 0a20 2020 2020   True  # x.     
+00002450: 2020 2073 656c 662e 7265 6d6f 7665 5f6c     self.remove_l
+00002460: 6172 6765 5f66 6f6e 7465 645f 656c 656d  arge_fonted_elem
+00002470: 656e 7473 203d 2054 7275 650a 2020 2020  ents = True.    
+00002480: 2020 2020 7365 6c66 2e73 7479 6c65 5f61      self.style_a
+00002490: 7474 7269 6275 7465 735f 746f 5f72 656d  ttributes_to_rem
+000024a0: 6f76 6520 3d20 5b22 746f 7022 5d0a 2020  ove = ["top"].  
+000024b0: 2020 2020 2020 7365 6c66 2e6d 6172 6b65        self.marke
+000024c0: 725f 7870 6174 6820 3d20 222e 2f2f 6469  r_xpath = ".//di
+000024d0: 765b 615b 406e 616d 655d 5d22 0a20 2020  v[a[@name]]".   
+000024e0: 2020 2020 2073 656c 662e 7374 796c 655f       self.style_
+000024f0: 6174 7472 6962 7574 6573 5f74 6f5f 7265  attributes_to_re
+00002500: 6d6f 7665 203d 205b 226c 6566 7422 2c20  move = ["left", 
+00002510: 2268 6569 6768 7422 5d0a 0a20 2020 2064  "height"]..    d
+00002520: 6566 2065 7874 7261 6374 5f70 6167 655f  ef extract_page_
+00002530: 626f 7865 7328 7365 6c66 2c20 7261 6e67  boxes(self, rang
+00002540: 6573 3d4e 6f6e 6529 3a0a 2020 2020 2020  es=None):.      
+00002550: 2020 2222 220a 2020 2020 2020 2020 4261    """.        Ba
+00002560: 7365 6420 6f6e 2070 6466 706c 756d 6265  sed on pdfplumbe
+00002570: 7220 6f75 7470 7574 0a20 2020 2020 2020  r output.       
+00002580: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
+00002590: 662e 7061 6765 5f62 6f78 6573 203d 205b  f.page_boxes = [
+000025a0: 5d20 2023 2070 6167 6542 6f78 206d 6179  ]  # pageBox may
+000025b0: 206d 6572 6765 2077 6974 6820 416d 6950   merge with AmiP
+000025c0: 6167 650a 0a20 2020 2020 2020 2069 6620  age..        if 
+000025d0: 7365 6c66 2e72 6177 5f65 6c65 6d20 6973  self.raw_elem is
+000025e0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+000025f0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+00002600: 2020 7374 796c 655f 7370 616e 7320 3d20    style_spans = 
+00002610: 7365 6c66 2e72 6177 5f65 6c65 6d2e 7870  self.raw_elem.xp
+00002620: 6174 6828 222f 2f73 7061 6e5b 636f 6e74  ath("//span[cont
+00002630: 6169 6e73 2840 7374 796c 652c 2770 6f73  ains(@style,'pos
+00002640: 6974 696f 6e3a 6162 736f 6c75 7465 2729  ition:absolute')
+00002650: 5d22 290a 2020 2020 2020 2020 666f 7220  ]").        for 
+00002660: 7374 796c 655f 7370 616e 2069 6e20 7374  style_span in st
+00002670: 796c 655f 7370 616e 733a 0a20 2020 2020  yle_spans:.     
+00002680: 2020 2020 2020 2063 7373 5f73 7479 6c65         css_style
+00002690: 203d 2043 5353 5374 796c 652e 6372 6561   = CSSStyle.crea
+000026a0: 7465 5f63 7373 5f73 7479 6c65 5f66 726f  te_css_style_fro
+000026b0: 6d5f 6174 7472 6962 7574 655f 6f66 5f62  m_attribute_of_b
+000026c0: 6f64 795f 656c 656d 656e 7428 7374 796c  ody_element(styl
+000026d0: 655f 7370 616e 290a 2020 2020 2020 2020  e_span).        
+000026e0: 2020 2020 6966 2063 7373 5f73 7479 6c65      if css_style
+000026f0: 2e68 6569 6768 7420 3e20 7365 6c66 2e4d  .height > self.M
+00002700: 494e 5f50 4147 455f 424f 585f 4845 4947  IN_PAGE_BOX_HEIG
+00002710: 4854 3a0a 2020 2020 2020 2020 2020 2020  HT:.            
+00002720: 2020 2020 7061 6765 5f62 6f78 203d 2050      page_box = P
+00002730: 6167 6542 6f78 2863 7373 5f73 7479 6c65  ageBox(css_style
+00002740: 3d63 7373 5f73 7479 6c65 290a 2020 2020  =css_style).    
+00002750: 2020 2020 2020 2020 2020 2020 7061 6765              page
+00002760: 5f62 6f78 2e61 6464 5f73 7479 6c65 5f73  _box.add_style_s
+00002770: 7061 6e5f 616e 645f 7061 6765 5f6e 756d  pan_and_page_num
+00002780: 6265 7228 7374 796c 655f 7370 616e 290a  ber(style_span).
+00002790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000027a0: 7365 6c66 2e70 6167 655f 626f 7865 732e  self.page_boxes.
+000027b0: 6170 7065 6e64 2870 6167 655f 626f 7829  append(page_box)
+000027c0: 0a0a 2020 2020 2020 2020 7365 6c66 2e65  ..        self.e
+000027d0: 7874 7261 6374 5f70 6167 655f 6e75 6d62  xtract_page_numb
+000027e0: 6572 7328 290a 0a20 2020 2064 6566 2065  ers()..    def e
+000027f0: 7874 7261 6374 5f70 6167 655f 6e75 6d62  xtract_page_numb
+00002800: 6572 7328 7365 6c66 293a 0a20 2020 2020  ers(self):.     
+00002810: 2020 2070 6167 656e 6f5f 7870 6174 6820     pageno_xpath 
+00002820: 3d20 222f 2f73 7061 6e2f 6469 762f 615b  = "//span/div/a[
+00002830: 406e 616d 655d 2220 2023 2070 6167 6520  @name]"  # page 
+00002840: 6e75 6d62 6572 2062 6f78 6573 3b20 7468  number boxes; th
+00002850: 6520 7061 7265 6e74 2073 7061 6e20 6973  e parent span is
+00002860: 2068 6f72 7269 640a 2020 2020 2020 2020   horrid.        
+00002870: 656c 656d 5f77 6974 685f 7061 6765 6e6f  elem_with_pageno
+00002880: 7320 3d20 7365 6c66 2e72 6177 5f65 6c65  s = self.raw_ele
+00002890: 6d2e 7870 6174 6828 7061 6765 6e6f 5f78  m.xpath(pageno_x
+000028a0: 7061 7468 290a 2020 2020 2020 2020 6373  path).        cs
+000028b0: 735f 6c61 7374 203d 204e 6f6e 650a 2020  s_last = None.  
+000028c0: 2020 2020 2020 2222 223c 6272 3e3c 2f73        """<br></s
+000028d0: 7061 6e3e 3c73 7061 6e20 7374 796c 653d  pan><span style=
+000028e0: 2266 6f6e 742d 6661 6d69 6c79 3a20 4361  "font-family: Ca
+000028f0: 6c69 6272 693b 2066 6f6e 742d 7369 7a65  libri; font-size
+00002900: 3a31 3070 7822 3e20 0a20 2020 2020 2020  :10px"> .       
+00002910: 2020 2020 2020 2020 203c 6272 3e3c 7370           <br><sp
+00002920: 616e 2073 7479 6c65 3d22 706f 7369 7469  an style="positi
+00002930: 6f6e 3a61 6273 6f6c 7574 653b 2062 6f72  on:absolute; bor
+00002940: 6465 723a 2067 7261 7920 3170 7820 736f  der: gray 1px so
+00002950: 6c69 643b 206c 6566 743a 3070 783b 2074  lid; left:0px; t
+00002960: 6f70 3a39 3431 7078 3b20 7769 6474 683a  op:941px; width:
+00002970: 3539 3570 783b 2068 6569 6768 743a 3834  595px; height:84
+00002980: 3170 783b 223e 3c2f 7370 616e 3e0a 2020  1px;"></span>.  
+00002990: 2020 2020 2020 2020 2020 2020 2020 0a20                . 
+000029a0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
+000029b0: 6469 7620 7374 796c 653d 2270 6f73 6974  div style="posit
+000029c0: 696f 6e3a 6162 736f 6c75 7465 3b20 746f  ion:absolute; to
+000029d0: 703a 3934 3170 783b 223e 3c61 206e 616d  p:941px;"><a nam
+000029e0: 653d 2232 223e 5061 6765 2032 3c2f 613e  e="2">Page 2</a>
+000029f0: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
+00002a00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00002a10: 2020 2066 6f72 2065 6c65 6d5f 7769 7468     for elem_with
+00002a20: 5f70 6167 656e 6f20 696e 2065 6c65 6d5f  _pageno in elem_
+00002a30: 7769 7468 5f70 6167 656e 6f73 3a0a 2020  with_pagenos:.  
+00002a40: 2020 2020 2020 2020 2020 6765 7470 6172            getpar
+00002a50: 656e 7420 3d20 656c 656d 5f77 6974 685f  ent = elem_with_
+00002a60: 7061 6765 6e6f 2e67 6574 7061 7265 6e74  pageno.getparent
+00002a70: 2829 0a20 2020 2020 2020 2020 2020 2063  ().            c
+00002a80: 7373 203d 2043 5353 5374 796c 652e 6372  ss = CSSStyle.cr
+00002a90: 6561 7465 5f63 7373 5f73 7479 6c65 5f66  eate_css_style_f
+00002aa0: 726f 6d5f 6174 7472 6962 7574 655f 6f66  rom_attribute_of
+00002ab0: 5f62 6f64 795f 656c 656d 656e 7428 6765  _body_element(ge
+00002ac0: 7470 6172 656e 7429 0a20 2020 2020 2020  tparent).       
+00002ad0: 2020 2020 2070 7265 765f 656c 656d 203d       prev_elem =
+00002ae0: 2067 6574 7061 7265 6e74 2e67 6574 7072   getparent.getpr
+00002af0: 6576 696f 7573 2829 0a20 2020 2020 2020  evious().       
+00002b00: 2020 2020 2068 6569 6768 7420 3d20 2d31       height = -1
+00002b10: 2069 6620 6373 735f 6c61 7374 2069 7320   if css_last is 
+00002b20: 4e6f 6e65 2065 6c73 6520 6373 732e 746f  None else css.to
+00002b30: 7020 2d20 6373 735f 6c61 7374 2e74 6f70  p - css_last.top
+00002b40: 0a20 2020 2020 2020 2020 2020 2070 7265  .            pre
+00002b50: 765f 7374 796c 6520 3d20 4353 5353 7479  v_style = CSSSty
+00002b60: 6c65 2e63 7265 6174 655f 6373 735f 7374  le.create_css_st
+00002b70: 796c 655f 6672 6f6d 5f61 7474 7269 6275  yle_from_attribu
+00002b80: 7465 5f6f 665f 626f 6479 5f65 6c65 6d65  te_of_body_eleme
+00002b90: 6e74 2870 7265 765f 656c 656d 290a 2020  nt(prev_elem).  
+00002ba0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00002bb0: 2070 7265 765f 7374 796c 653a 0a20 2020   prev_style:.   
+00002bc0: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+00002bd0: 6769 6e67 2e77 6172 6e69 6e67 2866 2220  ging.warning(f" 
+00002be0: 6e6f 2070 7265 7669 6f75 7320 7374 796c  no previous styl
+00002bf0: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
+00002c00: 6262 6f78 203d 204e 6f6e 6520 6966 2070  bbox = None if p
+00002c10: 7265 765f 7374 796c 6520 6973 204e 6f6e  rev_style is Non
+00002c20: 6520 656c 7365 2070 7265 765f 7374 796c  e else prev_styl
+00002c30: 652e 6372 6561 7465 5f62 626f 7828 290a  e.create_bbox().
+00002c40: 2020 2020 2020 2020 2020 2020 6373 735f              css_
+00002c50: 6c61 7374 203d 2063 7373 0a20 2020 2020  last = css.     
+00002c60: 2020 2072 6574 7572 6e20 656c 656d 5f77     return elem_w
+00002c70: 6974 685f 7061 6765 6e6f 730a 0a0a 2020  ith_pagenos...  
+00002c80: 2020 6465 6620 7072 696e 745f 7061 6765    def print_page
+00002c90: 735f 6469 7628 7365 6c66 2c20 7261 6e67  s_div(self, rang
+00002ca0: 6573 3d4e 6f6e 6529 3a0a 2020 2020 2020  es=None):.      
+00002cb0: 2020 2222 220a 2020 2020 2020 2020 6d61    """.        ma
+00002cc0: 7962 6520 6a75 7374 2061 2064 6562 7567  ybe just a debug
+00002cd0: 6765 720a 2020 2020 2020 2020 2222 220a  ger.        """.
+00002ce0: 0a20 2020 2020 2020 2069 6620 7261 6e67  .        if rang
+00002cf0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
+00002d00: 4874 6d6c 5469 6479 2e64 6562 7567 5f62  HtmlTidy.debug_b
+00002d10: 795f 7870 6174 6828 7365 6c66 2e72 6177  y_xpath(self.raw
+00002d20: 5f65 6c65 6d2c 2022 2f68 746d 6c2f 626f  _elem, "/html/bo
+00002d30: 6479 2f73 7061 6e22 2c20 7469 746c 653d  dy/span", title=
+00002d40: 2264 6972 6563 7420 7370 616e 7320 756e  "direct spans un
+00002d50: 6465 7220 626f 6479 2022 2c0a 2020 2020  der body ",.    
 00002d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d70: 2020 2020 7261 6e67 653d 7261 6e67 6573      range=ranges
-00002d80: 5b30 5d29 2c0a 2020 2020 2020 2020 2020  [0]),.          
-00002d90: 2020 4874 6d6c 5469 6479 2e64 6562 7567    HtmlTidy.debug
-00002da0: 5f62 795f 7870 6174 6828 7365 6c66 2e72  _by_xpath(self.r
-00002db0: 6177 5f65 6c65 6d2c 2022 2f68 746d 6c2f  aw_elem, "/html/
-00002dc0: 626f 6479 2f73 7061 6e5b 6469 765d 222c  body/span[div]",
-00002dd0: 2074 6974 6c65 3d22 746f 702d 6c65 7665   title="top-leve
-00002de0: 6c20 7370 616e 7320 7769 7468 2064 6976  l spans with div
-00002df0: 733f 222c 0a20 2020 2020 2020 2020 2020  s?",.           
-00002e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e10: 2020 2020 2020 2020 2072 616e 6765 3d72           range=r
-00002e20: 616e 6765 735b 315d 290a 2020 2020 2020  anges[1]).      
-00002e30: 2020 2020 2020 4874 6d6c 5469 6479 2e64        HtmlTidy.d
-00002e40: 6562 7567 5f62 795f 7870 6174 6828 7365  ebug_by_xpath(se
-00002e50: 6c66 2e72 6177 5f65 6c65 6d2c 2022 2f68  lf.raw_elem, "/h
-00002e60: 746d 6c2f 626f 6479 2f73 7061 6e2f 6469  tml/body/span/di
-00002e70: 7622 2c20 7469 746c 653d 2274 6865 2064  v", title="the d
-00002e80: 6976 7320 696e 2073 746f 702d 6c65 7665  ivs in stop-leve
-00002e90: 6c20 7370 616e 7322 2c0a 2020 2020 2020  l spans",.      
-00002ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002eb0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00002ec0: 6e67 653d 7261 6e67 6573 5b32 5d29 0a20  nge=ranges[2]). 
-00002ed0: 2020 2020 2020 2020 2020 2022 2222 0a20             """. 
-00002ee0: 2020 2020 2020 2020 2020 2020 2020 203c                 <
-00002ef0: 6469 7620 7374 796c 653d 2270 6f73 6974  div style="posit
-00002f00: 696f 6e3a 6162 736f 6c75 7465 3b20 746f  ion:absolute; to
-00002f10: 703a 3435 3039 7078 3b22 3e3c 6120 6e61  p:4509px;"><a na
-00002f20: 6d65 3d22 3622 3e50 6167 6520 363c 2f61  me="6">Page 6</a
-00002f30: 3e3c 2f64 6976 3e0a 2020 2020 2020 2020  ></div>.        
-00002f40: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00002f50: 2020 2020 4874 6d6c 5469 6479 2e64 6562      HtmlTidy.deb
-00002f60: 7567 5f62 795f 7870 6174 6828 7365 6c66  ug_by_xpath(self
-00002f70: 2e72 6177 5f65 6c65 6d2c 2022 2f68 746d  .raw_elem, "/htm
-00002f80: 6c2f 626f 6479 2f64 6976 5b40 7374 796c  l/body/div[@styl
-00002f90: 6520 616e 6420 615d 222c 2074 6974 6c65  e and a]", title
-00002fa0: 3d22 7061 6765 206e 756d 6265 7220 626f  ="page number bo
-00002fb0: 7865 7320 756e 6465 7220 626f 6479 222c  xes under body",
-00002fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002d80: 7261 6e67 653d 7261 6e67 6573 5b30 5d29  range=ranges[0])
+00002d90: 2c0a 2020 2020 2020 2020 2020 2020 4874  ,.            Ht
+00002da0: 6d6c 5469 6479 2e64 6562 7567 5f62 795f  mlTidy.debug_by_
+00002db0: 7870 6174 6828 7365 6c66 2e72 6177 5f65  xpath(self.raw_e
+00002dc0: 6c65 6d2c 2022 2f68 746d 6c2f 626f 6479  lem, "/html/body
+00002dd0: 2f73 7061 6e5b 6469 765d 222c 2074 6974  /span[div]", tit
+00002de0: 6c65 3d22 746f 702d 6c65 7665 6c20 7370  le="top-level sp
+00002df0: 616e 7320 7769 7468 2064 6976 733f 222c  ans with divs?",
+00002e00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002e20: 2020 2020 2072 616e 6765 3d72 616e 6765       range=range
+00002e30: 735b 315d 290a 2020 2020 2020 2020 2020  s[1]).          
+00002e40: 2020 4874 6d6c 5469 6479 2e64 6562 7567    HtmlTidy.debug
+00002e50: 5f62 795f 7870 6174 6828 7365 6c66 2e72  _by_xpath(self.r
+00002e60: 6177 5f65 6c65 6d2c 2022 2f68 746d 6c2f  aw_elem, "/html/
+00002e70: 626f 6479 2f73 7061 6e2f 6469 7622 2c20  body/span/div", 
+00002e80: 7469 746c 653d 2274 6865 2064 6976 7320  title="the divs 
+00002e90: 696e 2073 746f 702d 6c65 7665 6c20 7370  in stop-level sp
+00002ea0: 616e 7322 2c0a 2020 2020 2020 2020 2020  ans",.          
+00002eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ec0: 2020 2020 2020 2020 2020 7261 6e67 653d            range=
+00002ed0: 7261 6e67 6573 5b32 5d29 0a20 2020 2020  ranges[2]).     
+00002ee0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00002ef0: 2020 2020 2020 2020 2020 203c 6469 7620             <div 
+00002f00: 7374 796c 653d 2270 6f73 6974 696f 6e3a  style="position:
+00002f10: 6162 736f 6c75 7465 3b20 746f 703a 3435  absolute; top:45
+00002f20: 3039 7078 3b22 3e3c 6120 6e61 6d65 3d22  09px;"><a name="
+00002f30: 3622 3e50 6167 6520 363c 2f61 3e3c 2f64  6">Page 6</a></d
+00002f40: 6976 3e0a 2020 2020 2020 2020 2020 2020  iv>.            
+00002f50: 2222 220a 2020 2020 2020 2020 2020 2020  """.            
+00002f60: 4874 6d6c 5469 6479 2e64 6562 7567 5f62  HtmlTidy.debug_b
+00002f70: 795f 7870 6174 6828 7365 6c66 2e72 6177  y_xpath(self.raw
+00002f80: 5f65 6c65 6d2c 2022 2f68 746d 6c2f 626f  _elem, "/html/bo
+00002f90: 6479 2f64 6976 5b40 7374 796c 6520 616e  dy/div[@style an
+00002fa0: 6420 615d 222c 2074 6974 6c65 3d22 7061  d a]", title="pa
+00002fb0: 6765 206e 756d 6265 7220 626f 7865 7320  ge number boxes 
+00002fc0: 756e 6465 7220 626f 6479 222c 0a20 2020  under body",.   
 00002fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fe0: 2020 2020 2072 616e 6765 3d72 616e 6765       range=range
-00002ff0: 735b 335d 290a 2020 2020 2020 2020 2020  s[3]).          
-00003000: 2020 4874 6d6c 5469 6479 2e64 6562 7567    HtmlTidy.debug
-00003010: 5f62 795f 7870 6174 6828 7365 6c66 2e72  _by_xpath(self.r
-00003020: 6177 5f65 6c65 6d2c 2022 2f68 746d 6c2f  aw_elem, "/html/
-00003030: 626f 6479 2f2f 6469 765b 4073 7479 6c65  body//div[@style
-00003040: 2061 6e64 2061 5b63 6f6e 7461 696e 7328   and a[contains(
-00003050: 2e2c 2027 5061 6765 2729 5d5d 222c 0a20  ., 'Page')]]",. 
-00003060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002ff0: 2072 616e 6765 3d72 616e 6765 735b 335d   range=ranges[3]
+00003000: 290a 2020 2020 2020 2020 2020 2020 4874  ).            Ht
+00003010: 6d6c 5469 6479 2e64 6562 7567 5f62 795f  mlTidy.debug_by_
+00003020: 7870 6174 6828 7365 6c66 2e72 6177 5f65  xpath(self.raw_e
+00003030: 6c65 6d2c 2022 2f68 746d 6c2f 626f 6479  lem, "/html/body
+00003040: 2f2f 6469 765b 4073 7479 6c65 2061 6e64  //div[@style and
+00003050: 2061 5b63 6f6e 7461 696e 7328 2e2c 2027   a[contains(., '
+00003060: 5061 6765 2729 5d5d 222c 0a20 2020 2020  Page')]]",.     
 00003070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003080: 2020 2074 6974 6c65 3d22 7061 6765 206e     title="page n
-00003090: 756d 6265 7220 626f 7865 7320 756e 6465  umber boxes unde
-000030a0: 7220 626f 6479 2f73 7061 6e22 2c20 7261  r body/span", ra
-000030b0: 6e67 653d 7261 6e67 6573 5b34 5d29 0a0a  nge=ranges[4])..
-000030c0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-000030d0: 0a20 2020 2064 6566 2064 6562 7567 5f62  .    def debug_b
-000030e0: 795f 7870 6174 6828 636c 732c 2065 6c65  y_xpath(cls, ele
-000030f0: 6d2c 2078 7061 7468 2c20 7469 746c 653d  m, xpath, title=
-00003100: 4e6f 6e65 2c20 7261 6e67 653d 4e6f 6e65  None, range=None
-00003110: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
-00003120: 2020 2222 220a 2020 2020 2020 2020 6170    """.        ap
-00003130: 706c 6965 7320 7870 6174 6820 616e 6420  plies xpath and 
-00003140: 7072 696e 7473 2064 6562 7567 390a 2020  prints debug9.  
-00003150: 2020 2020 2020 6173 7365 7274 0a20 2020        assert.   
-00003160: 2020 2020 203a 7061 7261 6d20 656c 656d       :param elem
-00003170: 3a20 746f 2064 6562 7567 0a20 2020 2020  : to debug.     
-00003180: 2020 203a 7061 7261 6d20 7870 6174 683a     :param xpath:
-00003190: 2074 6f20 6465 6275 6720 7769 7468 0a20   to debug with. 
-000031a0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-000031b0: 7870 6174 6820 636f 756e 740a 2020 2020  xpath count.    
-000031c0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000031d0: 7370 616e 7320 3d20 656c 656d 2e78 7061  spans = elem.xpa
-000031e0: 7468 2878 7061 7468 290a 2020 2020 2020  th(xpath).      
-000031f0: 2020 6966 2072 616e 6765 3a0a 2020 2020    if range:.    
-00003200: 2020 2020 2020 2020 6173 7365 7274 2072          assert r
-00003210: 616e 6765 5b30 5d20 3c3d 206c 656e 2873  ange[0] <= len(s
-00003220: 7061 6e73 2920 3c3d 2072 616e 6765 5b31  pans) <= range[1
-00003230: 5d2c 2066 227b 2727 2069 6620 6e6f 7420  ], f"{'' if not 
-00003240: 7469 746c 6520 656c 7365 2074 6974 6c65  title else title
-00003250: 7d3a 2066 6f75 6e64 3a20 7b6c 656e 2873  }: found: {len(s
-00003260: 7061 6e73 297d 220a 2020 2020 2020 2020  pans)}".        
-00003270: 7265 7475 726e 206c 656e 2873 7061 6e73  return len(spans
-00003280: 290a 0a20 2020 2064 6566 2061 6464 5f65  )..    def add_e
-00003290: 6c65 6d65 6e74 2873 656c 662c 2065 6c65  lement(self, ele
-000032a0: 6d29 3a0a 2020 2020 2020 2020 7365 6c66  m):.        self
-000032b0: 2e65 6c65 6d65 6e74 203d 2065 6c65 6d0a  .element = elem.
-000032c0: 0a20 2020 2064 6566 2061 6464 5f64 6573  .    def add_des
-000032d0: 6365 6e64 616e 745f 656c 656d 656e 745f  cendant_element_
-000032e0: 746f 5f72 656d 6f76 6528 7365 6c66 2c20  to_remove(self, 
-000032f0: 6465 7363 656e 6461 6e74 5f65 6c65 6d29  descendant_elem)
-00003300: 3a0a 2020 2020 2020 2020 4874 6d6c 5469  :.        HtmlTi
-00003310: 6479 2e61 6464 5f65 6c65 6d65 6e74 735f  dy.add_elements_
-00003320: 746f 5f73 746f 7265 2864 6573 6365 6e64  to_store(descend
-00003330: 616e 745f 656c 656d 2c20 7365 6c66 2e64  ant_elem, self.d
-00003340: 6573 6365 6e64 616e 7473 5f74 6f5f 7265  escendants_to_re
-00003350: 6d6f 7665 290a 0a20 2020 2064 6566 2061  move)..    def a
-00003360: 6464 5f73 7479 6c65 735f 746f 5f72 656d  dd_styles_to_rem
-00003370: 6f76 6528 7365 6c66 2c20 7374 796c 6529  ove(self, style)
-00003380: 3a0a 2020 2020 2020 2020 7365 6c66 2e73  :.        self.s
-00003390: 7479 6c65 735f 746f 5f72 656d 6f76 652e  tyles_to_remove.
-000033a0: 6170 7065 6e64 2873 7479 6c65 290a 0a20  append(style).. 
-000033b0: 2020 2064 6566 2061 6464 5f65 6d70 7479     def add_empty
-000033c0: 5f65 6c65 6d65 6e74 735f 746f 5f72 656d  _elements_to_rem
-000033d0: 6f76 6528 7365 6c66 2c20 656c 656d 735f  ove(self, elems_
-000033e0: 746f 5f72 656d 6f76 6529 3a0a 2020 2020  to_remove):.    
-000033f0: 2020 2020 4874 6d6c 5469 6479 2e61 6464      HtmlTidy.add
-00003400: 5f65 6c65 6d65 6e74 735f 746f 5f73 746f  _elements_to_sto
-00003410: 7265 2865 6c65 6d73 5f74 6f5f 7265 6d6f  re(elems_to_remo
-00003420: 7665 2c20 7365 6c66 2e65 6d70 7479 5f65  ve, self.empty_e
-00003430: 6c65 6d65 6e74 735f 746f 5f72 656d 6f76  lements_to_remov
-00003440: 6529 0a0a 2020 2020 4063 6c61 7373 6d65  e)..    @classme
-00003450: 7468 6f64 0a20 2020 2064 6566 2061 6464  thod.    def add
-00003460: 5f65 6c65 6d65 6e74 735f 746f 5f73 746f  _elements_to_sto
-00003470: 7265 2863 6c73 2c20 656c 656d 735f 746f  re(cls, elems_to
-00003480: 5f73 746f 7265 2c20 656c 656d 5f73 746f  _store, elem_sto
-00003490: 7261 6765 293a 0a20 2020 2020 2020 2069  rage):.        i
-000034a0: 6620 656c 656d 735f 746f 5f73 746f 7265  f elems_to_store
-000034b0: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-000034c0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-000034d0: 2074 7970 6528 656c 656d 735f 746f 5f73   type(elems_to_s
-000034e0: 746f 7265 2920 6973 206c 6973 743a 0a20  tore) is list:. 
-000034f0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00003500: 6c65 6d73 5f74 6f5f 7374 6f72 6520 3d20  lems_to_store = 
-00003510: 6c69 7374 2865 6c65 6d73 5f74 6f5f 7374  list(elems_to_st
-00003520: 6f72 6529 0a20 2020 2020 2020 2020 2020  ore).           
-00003530: 2065 6c65 6d5f 7374 6f72 6167 652e 6578   elem_storage.ex
-00003540: 7465 6e64 2865 6c65 6d73 5f74 6f5f 7374  tend(elems_to_st
-00003550: 6f72 6529 0a0a 2020 2020 4063 6c61 7373  ore)..    @class
-00003560: 6d65 7468 6f64 0a20 2020 2064 6566 2065  method.    def e
-00003570: 6e73 7572 655f 6874 6d6c 5f68 6561 645f  nsure_html_head_
-00003580: 626f 6479 2863 6c73 2c20 6874 6d6c 5f65  body(cls, html_e
-00003590: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
-000035a0: 220a 2020 2020 2020 2020 6164 6473 203c  ".        adds <
-000035b0: 6874 6d6c 3e2c 203c 6865 6164 3e2c 203c  html>, <head>, <
-000035c0: 626f 6479 3e20 6966 206e 6f74 2070 7265  body> if not pre
-000035d0: 7365 6e74 0a20 2020 2020 2020 204d 6f76  sent.        Mov
-000035e0: 6520 746f 2048 544d 4c54 6964 790a 2020  e to HTMLTidy.  
-000035f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00003600: 2020 6874 6d6c 5f65 6c65 6d20 3d20 636c    html_elem = cl
-00003610: 732e 5f65 6e73 7572 655f 6874 6d6c 5f72  s._ensure_html_r
-00003620: 6f6f 7428 6874 6d6c 5f65 6c65 6d29 0a20  oot(html_elem). 
-00003630: 2020 2020 2020 2068 746d 6c5f 7769 7468         html_with
-00003640: 5f68 6561 6420 3d20 636c 732e 5f65 6e73  _head = cls._ens
-00003650: 7572 655f 6865 6164 626f 6479 2868 746d  ure_headbody(htm
-00003660: 6c5f 656c 656d 2c20 2268 6561 6422 2c20  l_elem, "head", 
-00003670: 3029 0a20 2020 2020 2020 2068 746d 6c5f  0).        html_
-00003680: 7769 7468 5f68 6561 645f 626f 6479 203d  with_head_body =
-00003690: 2063 6c73 2e5f 656e 7375 7265 5f68 6561   cls._ensure_hea
-000036a0: 6462 6f64 7928 6874 6d6c 5f77 6974 685f  dbody(html_with_
-000036b0: 6865 6164 2c20 2262 6f64 7922 2c20 3129  head, "body", 1)
-000036c0: 0a20 2020 2020 2020 2068 746d 6c5f 6964  .        html_id
-000036d0: 6561 6c20 3d20 636c 732e 5f74 6964 795f  eal = cls._tidy_
-000036e0: 6e6f 6e5f 6865 6164 5f62 6f64 795f 6368  non_head_body_ch
-000036f0: 696c 6472 656e 2868 746d 6c5f 7769 7468  ildren(html_with
-00003700: 5f68 6561 645f 626f 6479 290a 2020 2020  _head_body).    
-00003710: 2020 2020 7265 7475 726e 2068 746d 6c5f      return html_
-00003720: 6964 6561 6c0a 0a20 2020 2040 636c 6173  ideal..    @clas
-00003730: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00003740: 5f65 6e73 7572 655f 6865 6164 626f 6479  _ensure_headbody
-00003750: 2863 6c73 2c20 6874 6d6c 5f72 6f6f 742c  (cls, html_root,
-00003760: 2074 6167 2c20 706f 7329 3a0a 2020 2020   tag, pos):.    
-00003770: 2020 2020 6465 7363 656e 6473 203d 206c      descends = l
-00003780: 656e 2868 746d 6c5f 726f 6f74 2e78 7061  en(html_root.xpa
-00003790: 7468 2866 222e 2f2f 7b74 6167 7d22 2929  th(f".//{tag}"))
-000037a0: 0a20 2020 2020 2020 2069 6620 6465 7363  .        if desc
-000037b0: 656e 6473 203e 2031 3a0a 2020 2020 2020  ends > 1:.      
-000037c0: 2020 2020 2020 6c6f 6767 696e 672e 7761        logging.wa
-000037d0: 726e 696e 6728 6622 6d6f 7265 2074 6861  rning(f"more tha
-000037e0: 6e20 3120 7b74 6167 7d3b 2063 616e 6e6f  n 1 {tag}; canno
-000037f0: 7420 7072 6f63 6573 7322 290a 2020 2020  t process").    
-00003800: 2020 2020 656c 6966 2064 6573 6365 6e64      elif descend
-00003810: 7320 3d3d 2031 3a0a 2020 2020 2020 2020  s == 1:.        
-00003820: 2020 2020 2320 6f6e 6520 7461 672c 206f      # one tag, o
-00003830: 6b0a 2020 2020 2020 2020 2020 2020 7061  k.            pa
-00003840: 7373 0a20 2020 2020 2020 2065 6c69 6620  ss.        elif 
-00003850: 6465 7363 656e 6473 203d 3d20 303a 0a20  descends == 0:. 
-00003860: 2020 2020 2020 2020 2020 2068 6561 6420             head 
-00003870: 3d20 4554 2e45 6c65 6d65 6e74 2874 6167  = ET.Element(tag
-00003880: 290a 2020 2020 2020 2020 2020 2020 6874  ).            ht
-00003890: 6d6c 5f72 6f6f 742e 696e 7365 7274 2870  ml_root.insert(p
-000038a0: 6f73 2c20 6865 6164 290a 2020 2020 2020  os, head).      
-000038b0: 2020 7265 7475 726e 2068 746d 6c5f 726f    return html_ro
-000038c0: 6f74 0a0a 2020 2020 4063 6c61 7373 6d65  ot..    @classme
-000038d0: 7468 6f64 0a20 2020 2064 6566 205f 656e  thod.    def _en
-000038e0: 7375 7265 5f68 746d 6c5f 726f 6f74 2863  sure_html_root(c
-000038f0: 6c73 2c20 6874 6d6c 5f65 6c65 6d29 3a0a  ls, html_elem):.
-00003900: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00003910: 2020 2020 6966 2072 6f6f 7420 656c 656d      if root elem
-00003920: 656e 7420 6973 206e 6f74 203c 6874 6d6c  ent is not <html
-00003930: 3e20 6372 6561 7465 7320 6f6e 6520 616e  > creates one an
-00003940: 6420 7472 616e 7366 6572 7320 6368 696c  d transfers chil
-00003950: 6472 656e 0a20 2020 2020 2020 203a 7061  dren.        :pa
-00003960: 7261 6d20 6874 6d6c 5f65 6c65 6d3a 206f  ram html_elem: o
-00003970: 6c64 2045 6c65 6d65 6e74 5472 6565 206f  ld ElementTree o
-00003980: 7220 726f 6f74 2045 6c65 6d65 6e74 0a20  r root Element. 
-00003990: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000039a0: 2020 206f 6c64 5f72 6f6f 7420 3d20 6874     old_root = ht
-000039b0: 6d6c 5f65 6c65 6d2e 6765 7472 6f6f 7428  ml_elem.getroot(
-000039c0: 2920 6966 2074 7970 6528 6874 6d6c 5f65  ) if type(html_e
-000039d0: 6c65 6d29 2069 7320 5f45 6c65 6d65 6e74  lem) is _Element
-000039e0: 5472 6565 2065 6c73 6520 6874 6d6c 5f65  Tree else html_e
-000039f0: 6c65 6d0a 2020 2020 2020 2020 6874 6d6c  lem.        html
-00003a00: 7320 3d20 6874 6d6c 5f65 6c65 6d2e 7870  s = html_elem.xp
-00003a10: 6174 6828 222f 6874 6d6c 2229 0a20 2020  ath("/html").   
-00003a20: 2020 2020 2069 6620 6c65 6e28 6874 6d6c       if len(html
-00003a30: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
-00003a40: 2020 2020 2068 746d 6c5f 726f 6f74 203d       html_root =
-00003a50: 2045 542e 456c 656d 656e 7428 2268 746d   ET.Element("htm
-00003a60: 6c22 290a 2020 2020 2020 2020 2020 2020  l").            
-00003a70: 6874 6d6c 5f72 6f6f 742e 696e 7365 7274  html_root.insert
-00003a80: 2830 2c20 6f6c 645f 726f 6f74 290a 2020  (0, old_root).  
-00003a90: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00003aa0: 2068 746d 6c5f 726f 6f74 0a20 2020 2020   html_root.     
-00003ab0: 2020 2072 6574 7572 6e20 6874 6d6c 5f65     return html_e
-00003ac0: 6c65 6d0a 0a20 2020 2040 636c 6173 736d  lem..    @classm
-00003ad0: 6574 686f 640a 2020 2020 6465 6620 5f74  ethod.    def _t
-00003ae0: 6964 795f 6e6f 6e5f 6865 6164 5f62 6f64  idy_non_head_bod
-00003af0: 795f 6368 696c 6472 656e 2863 6c73 2c20  y_children(cls, 
-00003b00: 6874 6d6c 5f77 6974 685f 6865 6164 5f62  html_with_head_b
-00003b10: 6f64 7929 3a0a 0a20 2020 2020 2020 2068  ody):..        h
-00003b20: 6561 645f 656c 656d 7320 3d20 6874 6d6c  ead_elems = html
-00003b30: 5f77 6974 685f 6865 6164 5f62 6f64 792e  _with_head_body.
-00003b40: 7870 6174 6828 4874 6d6c 5469 6479 2e48  xpath(HtmlTidy.H
-00003b50: 4541 445f 454c 454d 535f 494e 5f58 5041  EAD_ELEMS_IN_XPA
-00003b60: 5448 290a 2020 2020 2020 2020 6865 6164  TH).        head
-00003b70: 203d 2068 746d 6c5f 7769 7468 5f68 6561   = html_with_hea
-00003b80: 645f 626f 6479 2e78 7061 7468 2822 6865  d_body.xpath("he
-00003b90: 6164 2229 5b30 5d0a 2020 2020 2020 2020  ad")[0].        
-00003ba0: 666f 7220 656c 656d 2069 6e20 6865 6164  for elem in head
-00003bb0: 5f65 6c65 6d73 3a0a 2020 2020 2020 2020  _elems:.        
-00003bc0: 2020 2020 6865 6164 2e61 7070 656e 6428      head.append(
-00003bd0: 656c 656d 290a 2020 2020 2020 2020 7265  elem).        re
-00003be0: 7374 5f65 6c65 6d73 203d 2068 746d 6c5f  st_elems = html_
-00003bf0: 7769 7468 5f68 6561 645f 626f 6479 2e78  with_head_body.x
-00003c00: 7061 7468 2822 2a5b 6e6f 7428 6e61 6d65  path("*[not(name
-00003c10: 2829 3d27 6865 6164 2729 2061 6e64 206e  ()='head') and n
-00003c20: 6f74 286e 616d 6528 293d 2762 6f64 7927  ot(name()='body'
-00003c30: 295d 2229 0a20 2020 2020 2020 2062 6f64  )]").        bod
-00003c40: 7920 3d20 6874 6d6c 5f77 6974 685f 6865  y = html_with_he
-00003c50: 6164 5f62 6f64 792e 7870 6174 6828 2262  ad_body.xpath("b
-00003c60: 6f64 7922 295b 305d 0a20 2020 2020 2020  ody")[0].       
-00003c70: 2066 6f72 2065 6c65 6d20 696e 2072 6573   for elem in res
-00003c80: 745f 656c 656d 733a 0a20 2020 2020 2020  t_elems:.       
-00003c90: 2020 2020 2062 6f64 792e 6170 7065 6e64       body.append
-00003ca0: 2865 6c65 6d29 0a20 2020 2020 2020 2072  (elem).        r
-00003cb0: 6574 7572 6e20 6874 6d6c 5f77 6974 685f  eturn html_with_
-00003cc0: 6865 6164 5f62 6f64 790a 0a20 2020 2040  head_body..    @
-00003cd0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00003ce0: 6465 6620 636f 6e63 6174 656e 6174 655f  def concatenate_
-00003cf0: 7370 616e 735f 7769 7468 5f69 6465 6e74  spans_with_ident
-00003d00: 6963 616c 5f73 7479 6c65 7328 636c 732c  ical_styles(cls,
-00003d10: 2065 6c65 6d2c 2061 6464 7370 6163 653d   elem, addspace=
-00003d20: 5472 7565 293a 0a0a 2020 2020 2020 2020  True):..        
-00003d30: 2222 220a 2020 2020 2020 2020 536f 6d65  """.        Some
-00003d40: 7469 6d65 7320 756e 6e65 6365 7373 6172  times unnecessar
-00003d50: 7920 7370 616e 7320 6172 6520 6372 6561  y spans are crea
-00003d60: 7465 6420 2865 2e67 2e0a 2020 2020 2020  ted (e.g..      
-00003d70: 2020 3c73 7061 6e20 636c 6173 733d 2773    <span class='s
-00003d80: 3127 3e66 6f6f 3c2f 7370 616e 3e3c 7370  1'>foo</span><sp
-00003d90: 616e 6520 636c 6173 733d 2273 3122 3e62  ane class="s1">b
-00003da0: 6172 3c2f 7370 616e 3e0a 2020 2020 2020  ar</span>.      
-00003db0: 2020 6372 6561 7465 7320 3c73 7061 6e20    creates <span 
-00003dc0: 636c 6173 733d 2273 3122 3e66 6f6f 2062  class="s1">foo b
-00003dd0: 6172 3c2f 7370 616e 3e0a 2020 2020 2020  ar</span>.      
-00003de0: 2020 3a70 6172 616d 2065 6c65 6d3a 2070    :param elem: p
-00003df0: 726f 6261 626c 7920 6120 6469 7620 7769  robably a div wi
-00003e00: 7468 2063 6869 6c64 2073 7061 6e73 0a20  th child spans. 
-00003e10: 2020 2020 2020 203a 7061 7261 6d20 6164         :param ad
-00003e20: 6473 7061 6365 3a20 696e 7365 7274 2073  dspace: insert s
-00003e30: 7061 6365 0a20 2020 2020 2020 2022 2222  pace.        """
-00003e40: 0a20 2020 2020 2020 2073 7061 6e73 203d  .        spans =
-00003e50: 2065 6c65 6d2e 7870 6174 6828 222e 2f73   elem.xpath("./s
-00003e60: 7061 6e5b 4063 6c61 7373 5d22 290a 2020  pan[@class]").  
-00003e70: 2020 2020 2020 6c61 7374 5f73 7061 6e20        last_span 
-00003e80: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
-00003e90: 7061 6365 7320 3d20 2222 2069 6620 6e6f  paces = "" if no
-00003ea0: 7420 6164 6473 7061 6365 2065 6c73 6520  t addspace else 
-00003eb0: 2220 220a 2020 2020 2020 2020 666f 7220  " ".        for 
-00003ec0: 7370 616e 2069 6e20 7370 616e 733a 0a20  span in spans:. 
-00003ed0: 2020 2020 2020 2020 2020 2069 6620 6c61             if la
-00003ee0: 7374 5f73 7061 6e20 6973 206e 6f74 204e  st_span is not N
-00003ef0: 6f6e 6520 616e 6420 6c61 7374 5f73 7061  one and last_spa
-00003f00: 6e2e 6174 7472 6962 5b22 636c 6173 7322  n.attrib["class"
-00003f10: 5d20 3d3d 2073 7061 6e2e 6174 7472 6962  ] == span.attrib
-00003f20: 5b22 636c 6173 7322 5d3a 0a20 2020 2020  ["class"]:.     
-00003f30: 2020 2020 2020 2020 2020 206c 6173 745f             last_
-00003f40: 7370 616e 2e74 6578 7420 3d20 6c61 7374  span.text = last
-00003f50: 5f73 7061 6e2e 7465 7874 202b 2073 7061  _span.text + spa
-00003f60: 6365 7320 2b20 7370 616e 2e74 6578 740a  ces + span.text.
-00003f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f80: 656c 656d 2e72 656d 6f76 6528 7370 616e  elem.remove(span
-00003f90: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00003fa0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00003fb0: 2020 2020 6c61 7374 5f73 7061 6e20 3d20      last_span = 
-00003fc0: 7370 616e 0a0a 0a64 6566 2067 6574 5f74  span...def get_t
-00003fd0: 6172 6765 745f 6872 6566 2874 6172 6765  arget_href(targe
-00003fe0: 745f 6964 293a 0a20 2020 2072 655f 7461  t_id):.    re_ta
-00003ff0: 7267 6574 203d 2072 652e 636f 6d70 696c  rget = re.compil
-00004000: 6528 225c 5c73 2a28 3f50 3c72 6570 6f72  e("\\s*(?P<repor
-00004010: 743e 5747 497c 5747 4949 7c57 4749 4949  t>WGI|WGII|WGIII
-00004020: 7c53 5243 434c 7c53 524f 4343 7c53 5231  |SRCCL|SROCC|SR1
-00004030: 357c 5359 5229 5c5c 732b 283f 503c 6368  5|SYR)\\s+(?P<ch
-00004040: 6170 7465 723e 5350 4d7c 5453 295c 5c73  apter>SPM|TS)\\s
-00004050: 2b28 3f50 3c73 6563 7469 6f6e 3e5b 412d  +(?P<section>[A-
-00004060: 475d 5c5c 2e3f 5c5c 642b 283f 3a5c 5c2e  G]\\.?\\d+(?:\\.
-00004070: 5c5c 642b 292a 2922 290a 2020 2020 6769  \\d+)*)").    gi
-00004080: 7468 7562 5f62 6173 6520 3d20 2268 7474  thub_base = "htt
-00004090: 7073 3a2f 2f68 746d 6c70 7265 7669 6577  ps://htmlpreview
-000040a0: 2e67 6974 6875 622e 696f 2f3f 6874 7470  .github.io/?http
-000040b0: 733a 2f2f 6769 7468 7562 2e63 6f6d 220a  s://github.com".
-000040c0: 2020 2020 776f 726b 696e 675f 7572 6c20      working_url 
-000040d0: 3d20 2268 7474 7073 3a2f 2f68 746d 6c70  = "https://htmlp
-000040e0: 7265 7669 6577 2e67 6974 6875 622e 696f  review.github.io
-000040f0: 2f3f 6874 7470 733a 2f2f 6769 7468 7562  /?https://github
-00004100: 2e63 6f6d 2f70 6574 6572 6d72 2f73 656d  .com/petermr/sem
-00004110: 616e 7469 6343 6c69 6d61 7465 2f62 6c6f  anticClimate/blo
-00004120: 622f 6d61 696e 2f74 6573 742e 6874 6d6c  b/main/test.html
-00004130: 220a 2020 2020 7265 706f 7274 5f64 6963  ".    report_dic
-00004140: 7420 3d20 7b0a 2020 2020 2020 2020 2277  t = {.        "w
-00004150: 6769 2220 3a20 2277 6731 222c 0a20 2020  gi" : "wg1",.   
-00004160: 2020 2020 2022 7767 6969 223a 2022 7767       "wgii": "wg
-00004170: 3222 2c0a 2020 2020 2020 2020 2277 6769  2",.        "wgi
-00004180: 6969 223a 2022 7767 3322 2c0a 2020 2020  ii": "wg3",.    
-00004190: 7d0a 2020 2020 6872 6566 203d 2022 220a  }.    href = "".
-000041a0: 2020 2020 6d61 7463 6820 3d20 7265 5f74      match = re_t
-000041b0: 6172 6765 742e 6d61 7463 6828 7461 7267  arget.match(targ
-000041c0: 6574 5f69 6429 0a20 2020 2069 6620 6d61  et_id).    if ma
-000041d0: 7463 683a 0a20 2020 2020 2020 2072 6570  tch:.        rep
-000041e0: 6f72 7420 3d20 6d61 7463 682e 6772 6f75  ort = match.grou
-000041f0: 7028 2272 6570 6f72 7422 292e 6c6f 7765  p("report").lowe
-00004200: 7228 290a 2020 2020 2020 2020 7265 706f  r().        repo
-00004210: 7274 3120 3d20 7265 706f 7274 5f64 6963  rt1 = report_dic
-00004220: 742e 6765 7428 7265 706f 7274 290a 2020  t.get(report).  
-00004230: 2020 2020 2020 7265 706f 7274 203d 2072        report = r
-00004240: 6570 6f72 7431 2069 6620 7265 706f 7274  eport1 if report
-00004250: 3120 656c 7365 2072 6570 6f72 740a 2020  1 else report.  
-00004260: 2020 2020 2020 6368 6170 7465 7220 3d20        chapter = 
-00004270: 6d61 7463 682e 6772 6f75 7028 2263 6861  match.group("cha
-00004280: 7074 6572 2229 2e6c 6f77 6572 2829 0a20  pter").lower(). 
-00004290: 2020 2020 2020 2073 6563 7469 6f6e 203d         section =
-000042a0: 206d 6174 6368 2e67 726f 7570 2822 7365   match.group("se
-000042b0: 6374 696f 6e22 292e 6c6f 7765 7228 290a  ction").lower().
-000042c0: 2020 2020 2020 2020 6872 6566 203d 2066          href = f
-000042d0: 227b 6769 7468 7562 5f62 6173 657d 2f70  "{github_base}/p
-000042e0: 6574 6572 6d72 2f73 656d 616e 7469 6343  etermr/semanticC
-000042f0: 6c69 6d61 7465 2f62 6c6f 622f 6d61 696e  limate/blob/main
-00004300: 2f61 7236 2f61 7236 2f7b 7265 706f 7274  /ar6/ar6/{report
-00004310: 7d2f 7b63 6861 7074 6572 7d2f 6874 6d6c  }/{chapter}/html
-00004320: 2f66 756c 6c74 6578 742f 6772 6f75 7073  /fulltext/groups
-00004330: 5f67 726f 7570 732e 6874 6d6c 237b 7365  _groups.html#{se
-00004340: 6374 696f 6e7d 220a 0a20 2020 2072 6574  ction}"..    ret
-00004350: 7572 6e20 6872 6566 0a0a 0a63 6c61 7373  urn href...class
-00004360: 2048 746d 6c47 726f 7570 3a0a 2020 2020   HtmlGroup:.    
-00004370: 2222 2267 726f 7570 7320 7369 626c 696e  """groups siblin
-00004380: 6773 2069 6e74 6f20 6469 7673 2222 220a  gs into divs""".
-00004390: 0a20 2020 2044 4546 4155 4c54 5f53 5459  .    DEFAULT_STY
-000043a0: 4c45 5320 3d20 5b0a 2020 2020 2020 2020  LES = [.        
-000043b0: 2822 2e73 6563 7469 6f6e 5f74 6974 6c65  (".section_title
-000043c0: 222c 205b 2822 636f 6c6f 7222 2c20 2272  ", [("color", "r
-000043d0: 6564 3b22 295d 292c 0a20 2020 2020 2020  ed;")]),.       
-000043e0: 2028 222e 7375 625f 7365 6374 696f 6e5f   (".sub_section_
-000043f0: 7469 746c 6522 2c20 5b28 2263 6f6c 6f72  title", [("color
-00004400: 222c 2022 626c 7565 3b22 295d 292c 0a20  ", "blue;")]),. 
-00004410: 2020 2020 2020 2028 222e 7375 625f 7375         (".sub_su
-00004420: 625f 7365 6374 696f 6e5f 7469 746c 6522  b_section_title"
-00004430: 2c20 5b28 2263 6f6c 6f72 222c 2022 6772  , [("color", "gr
-00004440: 6565 6e3b 2229 5d29 2c0a 2020 2020 2020  een;")]),.      
-00004450: 2020 2822 2e63 6f6e 6669 6465 6e63 6522    (".confidence"
-00004460: 2c20 5b28 2263 6f6c 6f72 222c 2022 6f72  , [("color", "or
-00004470: 616e 6765 3b22 295d 292c 0a20 2020 2020  ange;")]),.     
-00004480: 2020 2028 222e 7072 6f62 6162 696c 6974     (".probabilit
-00004490: 7922 2c20 5b28 2263 6f6c 6f72 222c 2022  y", [("color", "
-000044a0: 2338 3838 3866 663b 2229 5d29 2c0a 2020  #8888ff;")]),.  
-000044b0: 2020 2020 2020 2822 2e73 7570 6572 7363        (".supersc
-000044c0: 7269 7074 222c 205b 2822 636f 6c6f 7222  ript", [("color"
-000044d0: 2c20 226d 6167 656e 7461 3b22 292c 2028  , "magenta;"), (
-000044e0: 2262 6163 6b67 726f 756e 6422 2c20 2279  "background", "y
-000044f0: 656c 6c6f 773b 2229 5d29 2c0a 2020 2020  ellow;")]),.    
-00004500: 2020 2020 2822 2e63 6875 6e6b 222c 205b      (".chunk", [
-00004510: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
-00004520: 6379 616e 3b22 295d 292c 0a20 2020 2020  cyan;")]),.     
-00004530: 2020 2028 222e 7461 7267 6574 7322 2c20     (".targets", 
-00004540: 5b28 2262 6163 6b67 726f 756e 6422 2c20  [("background", 
-00004550: 2223 3838 6666 3838 3b22 295d 292c 0a20  "#88ff88;")]),. 
-00004560: 2020 2020 2020 2028 222e 7374 6172 7422         (".start"
-00004570: 2c20 5b28 2262 6163 6b67 726f 756e 6422  , [("background"
-00004580: 2c20 2267 7261 793b 2229 5d29 2c0a 2020  , "gray;")]),.  
-00004590: 2020 2020 2020 2822 2e65 6e64 222c 205b        (".end", [
-000045a0: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
-000045b0: 7965 6c6c 6f77 3b22 295d 292c 0a20 2020  yellow;")]),.   
-000045c0: 2020 2020 2028 222e 7061 6765 222c 205b       (".page", [
-000045d0: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
-000045e0: 6d61 6765 6e74 613b 2229 5d29 2c0a 2020  magenta;")]),.  
-000045f0: 2020 2020 2020 2822 2e73 7461 7465 6d65        (".stateme
-00004600: 6e74 222c 205b 2822 6261 636b 6772 6f75  nt", [("backgrou
-00004610: 6e64 222c 2022 2364 6464 6466 663b 2229  nd", "#ddddff;")
-00004620: 5d29 2c0a 2020 2020 2020 2020 2822 2e6c  ]),.        (".l
-00004630: 6576 656c 3122 2c20 5b28 2262 6163 6b67  evel1", [("backg
-00004640: 726f 756e 6422 2c20 2223 6666 6666 6464  round", "#ffffdd
-00004650: 3b22 295d 292c 0a20 2020 2020 2020 2028  ;")]),.        (
-00004660: 222e 6c65 7665 6c32 222c 205b 2822 6261  ".level2", [("ba
-00004670: 636b 6772 6f75 6e64 222c 2022 2364 6466  ckground", "#ddf
-00004680: 6666 663b 2229 5d29 2c0a 2020 2020 2020  fff;")]),.      
-00004690: 2020 2822 2e6c 6576 656c 3322 2c20 5b28    (".level3", [(
-000046a0: 2262 6163 6b67 726f 756e 6422 2c20 2223  "background", "#
-000046b0: 6464 6666 6464 3b22 295d 292c 0a20 2020  ddffdd;")]),.   
-000046c0: 2020 2020 2028 222e 666f 6f74 6e6f 7465       (".footnote
-000046d0: 222c 205b 2822 6261 636b 6772 6f75 6e64  ", [("background
-000046e0: 222c 2022 2366 6664 6466 663b 2229 5d29  ", "#ffddff;")])
-000046f0: 2c0a 2020 2020 5d0a 0a20 2020 2040 636c  ,.    ]..    @cl
-00004700: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00004710: 6620 6765 6e65 7261 7465 5f6c 6f77 6572  f generate_lower
-00004720: 6361 7365 5f6c 6574 7465 725f 6964 2863  case_letter_id(c
-00004730: 6c73 2c20 6929 3a0a 2020 2020 2020 2020  ls, i):.        
-00004740: 226d 616b 6520 6964 206f 6620 666f 726d  "make id of form
-00004750: 2061 2c62 2c63 2c20 2e2e 2e20 6161 2c20   a,b,c, ... aa, 
-00004760: 6162 2c20 6163 202e 2e2e 2062 612c 2062  ab, ac ... ba, b
-00004770: 622c 202e 2e2e 207a 7a20 2c20 402e 7374  b, ... zz , @.st
-00004780: 7228 6929 220a 2020 2020 2020 2020 6162  r(i)".        ab
-00004790: 6320 3d20 2261 6263 6465 6667 6869 6a6b  c = "abcdefghijk
-000047a0: 6c6d 6e6f 7071 7273 7475 7677 7879 7a22  lmnopqrstuvwxyz"
-000047b0: 0a20 2020 2020 2020 2069 6920 3d20 6920  .        ii = i 
-000047c0: 2520 3236 0a20 2020 2020 2020 206a 6a20  % 26.        jj 
-000047d0: 3d20 6920 2f2f 2032 360a 2020 2020 2020  = i // 26.      
-000047e0: 2020 6966 2069 203e 3d20 3136 202a 2031    if i >= 16 * 1
-000047f0: 363a 0a20 2020 2020 2020 2020 2020 2072  6:.            r
-00004800: 6574 7572 6e20 2240 2e22 202b 2073 7472  eturn "@." + str
-00004810: 2869 290a 2020 2020 2020 2020 7320 3d20  (i).        s = 
-00004820: 2222 2069 6620 6a6a 203d 3d20 3020 656c  "" if jj == 0 el
-00004830: 7365 2061 6263 5b6a 6a20 2d20 315d 0a20  se abc[jj - 1]. 
-00004840: 2020 2020 2020 2072 6574 7572 6e20 7320         return s 
-00004850: 2b20 6162 635b 6969 5d0a 0a0a 0a20 2020  + abc[ii]....   
-00004860: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00004870: 2020 6465 6620 6772 6f75 705f 7369 626c    def group_sibl
-00004880: 696e 6773 2863 6c73 2c20 6874 6d6c 5f65  ings(cls, html_e
-00004890: 6c65 6d2c 206c 6f63 6174 6f72 3d4e 6f6e  lem, locator=Non
-000048a0: 652c 2070 6172 656e 745f 6c6f 6361 746f  e, parent_locato
-000048b0: 723d 4e6f 6e65 2c20 7374 796c 653d 4e6f  r=None, style=No
-000048c0: 6e65 2c20 6465 6275 673d 4661 6c73 6529  ne, debug=False)
-000048d0: 3a0a 2020 2020 2020 2020 2222 2265 7672  :.        """evr
-000048e0: 7974 6869 6e67 2073 7461 7274 7320 6173  ything starts as
-000048f0: 2061 2073 6962 6c69 6e67 2122 2222 0a20   a sibling!""". 
-00004900: 2020 2020 2020 2073 6563 7469 6f6e 7320         sections 
-00004910: 3d20 6874 6d6c 5f65 6c65 6d2e 7870 6174  = html_elem.xpat
-00004920: 6828 6622 2e2f 2f73 7061 6e5b 7374 6172  h(f".//span[star
-00004930: 7473 2d77 6974 6828 4063 6c61 7373 2c20  ts-with(@class, 
-00004940: 277b 6c6f 6361 746f 727d 2729 5d22 290a  '{locator}')]").
-00004950: 2020 2020 2020 2020 6665 6e63 6570 6f73          fencepos
-00004960: 7473 203d 2068 746d 6c5f 656c 656d 2e78  ts = html_elem.x
-00004970: 7061 7468 2866 222e 2f2f 7370 616e 5b73  path(f".//span[s
-00004980: 7461 7274 732d 7769 7468 2840 636c 6173  tarts-with(@clas
-00004990: 732c 277b 7061 7265 6e74 5f6c 6f63 6174  s,'{parent_locat
-000049a0: 6f72 7d27 295d 2229 0a20 2020 2020 2020  or}')]").       
-000049b0: 2069 6620 6c65 6e28 7365 6374 696f 6e73   if len(sections
-000049c0: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-000049d0: 2020 2070 6172 656e 7420 3d20 7365 6374     parent = sect
-000049e0: 696f 6e73 5b30 5d2e 6765 7470 6172 656e  ions[0].getparen
-000049f0: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
-00004a00: 666f 7220 7365 6374 696f 6e20 696e 2073  for section in s
-00004a10: 6563 7469 6f6e 733a 0a20 2020 2020 2020  ections:.       
-00004a20: 2020 2020 2020 2020 2063 6c73 2e67 726f           cls.gro
-00004a30: 7570 5f73 6962 6c69 6e67 735f 6265 7477  up_siblings_betw
-00004a40: 6565 6e5f 6665 6e63 6570 6f73 7473 2866  een_fenceposts(f
-00004a50: 656e 6365 706f 7374 732c 2073 7479 6c65  enceposts, style
-00004a60: 3d73 7479 6c65 2c20 6465 6275 673d 6465  =style, debug=de
-00004a70: 6275 6729 0a0a 2020 2020 4063 6c61 7373  bug)..    @class
-00004a80: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
-00004a90: 726f 7570 5f73 6962 6c69 6e67 735f 6265  roup_siblings_be
-00004aa0: 7477 6565 6e5f 6665 6e63 6570 6f73 7473  tween_fenceposts
-00004ab0: 2863 6c73 2c20 6665 6e63 6570 6f73 7473  (cls, fenceposts
-00004ac0: 2c20 7374 796c 653d 4e6f 6e65 2c20 6465  , style=None, de
-00004ad0: 6275 673d 4661 6c73 6529 3a0a 2020 2020  bug=False):.    
-00004ae0: 2020 2020 666f 7220 692c 2066 656e 6365      for i, fence
-00004af0: 706f 7374 2069 6e20 656e 756d 6572 6174  post in enumerat
-00004b00: 6528 6665 6e63 6570 6f73 7473 293a 0a20  e(fenceposts):. 
-00004b10: 2020 2020 2020 2020 2020 2066 656e 6365             fence
-00004b20: 706f 7374 5f66 6f6c 6c6f 7765 7273 203d  post_followers =
-00004b30: 2066 656e 6365 706f 7374 2e78 7061 7468   fencepost.xpath
-00004b40: 2822 666f 6c6c 6f77 696e 672d 7369 626c  ("following-sibl
-00004b50: 696e 673a 3a64 6976 5b73 7061 6e5d 2229  ing::div[span]")
-00004b60: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00004b70: 7461 696e 6572 5f64 6976 203d 2045 542e  tainer_div = ET.
-00004b80: 456c 656d 656e 7428 2264 6976 2229 0a20  Element("div"). 
-00004b90: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
-00004ba0: 696e 6572 5f64 6976 2e61 7474 7269 625b  iner_div.attrib[
-00004bb0: 2273 7479 6c65 225d 203d 2073 7479 6c65  "style"] = style
-00004bc0: 0a20 2020 2020 2020 2020 2020 2066 656e  .            fen
-00004bd0: 6365 706f 7374 2e61 6464 7072 6576 696f  cepost.addprevio
-00004be0: 7573 2863 6f6e 7461 696e 6572 5f64 6976  us(container_div
-00004bf0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-00004c00: 6e74 6169 6e65 725f 6469 762e 6170 7065  ntainer_div.appe
-00004c10: 6e64 2866 656e 6365 706f 7374 290a 2020  nd(fencepost).  
-00004c20: 2020 2020 2020 2020 2020 7469 746c 6520            title 
-00004c30: 3d20 6665 6e63 6570 6f73 742e 7870 6174  = fencepost.xpat
-00004c40: 6828 2273 7061 6e22 295b 305d 2e61 7474  h("span")[0].att
-00004c50: 7269 622e 6765 7428 2269 6422 290a 2020  rib.get("id").  
-00004c60: 2020 2020 2020 2020 2020 6966 2074 6974            if tit
-00004c70: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-00004c80: 2020 2020 636f 6e74 6169 6e65 725f 6469      container_di
-00004c90: 762e 6174 7472 6962 5b22 7469 746c 6522  v.attrib["title"
-00004ca0: 5d20 3d20 7469 746c 650a 2020 2020 2020  ] = title.      
-00004cb0: 2020 2020 2020 666f 7220 666f 6c6c 6f77        for follow
-00004cc0: 6572 2069 6e20 6665 6e63 6570 6f73 745f  er in fencepost_
-00004cd0: 666f 6c6c 6f77 6572 733a 0a20 2020 2020  followers:.     
-00004ce0: 2020 2020 2020 2020 2020 2069 6620 666f             if fo
-00004cf0: 6c6c 6f77 6572 2069 6e20 6665 6e63 6570  llower in fencep
-00004d00: 6f73 7473 3a0a 2020 2020 2020 2020 2020  osts:.          
-00004d10: 2020 2020 2020 2020 2020 6964 203d 2066            id = f
-00004d20: 6f6c 6c6f 7765 722e 7870 6174 6828 222e  ollower.xpath(".
-00004d30: 2f73 7061 6e22 295b 305d 2e61 7474 7269  /span")[0].attri
-00004d40: 622e 6765 7428 2269 6422 290a 2020 2020  b.get("id").    
-00004d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d60: 6966 2064 6562 7567 3a0a 2020 2020 2020  if debug:.      
-00004d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004d80: 2020 7072 696e 7428 6622 2069 643a 207b    print(f" id: {
-00004d90: 6964 7d22 290a 2020 2020 2020 2020 2020  id}").          
-00004da0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-00004db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004dc0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00004dd0: 2020 2020 2020 2020 2020 6966 2064 6562            if deb
-00004de0: 7567 3a0a 2020 2020 2020 2020 2020 2020  ug:.            
-00004df0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00004e00: 7428 6622 6d6f 7665 6420 666f 6c6c 6f77  t(f"moved follow
-00004e10: 6572 207b 666f 6c6c 6f77 6572 7d20 746f  er {follower} to
-00004e20: 207b 636f 6e74 6169 6e65 725f 6469 762e   {container_div.
-00004e30: 6174 7472 6962 2e67 6574 2827 7469 746c  attrib.get('titl
-00004e40: 6527 297d 2229 0a20 2020 2020 2020 2020  e')}").         
-00004e50: 2020 2020 2020 2020 2020 2063 6f6e 7461             conta
-00004e60: 696e 6572 5f64 6976 2e61 7070 656e 6428  iner_div.append(
-00004e70: 666f 6c6c 6f77 6572 290a 0a20 2020 2020  follower)..     
-00004e80: 2020 2022 2222 4927 6d20 776f 726b 696e     """I'm workin
-00004e90: 6720 7769 7468 206c 786d 6c20 696e 2050  g with lxml in P
-00004ea0: 7974 686f 6e20 616e 6420 7769 7368 2074  ython and wish t
-00004eb0: 6f20 6772 6f75 7020 6120 666c 6174 2073  o group a flat s
-00004ec0: 6574 206f 6620 3c64 6976 3e20 656c 656d  et of <div> elem
-00004ed0: 656e 7473 2069 6e74 6f20 6120 7472 6565  ents into a tree
-00004ee0: 2062 6173 6564 206f 6e20 7468 6569 7220   based on their 
-00004ef0: 636c 6173 7320 6174 7472 6962 7574 6573  class attributes
-00004f00: 0a49 2068 6176 6520 6120 7365 7420 6f66  .I have a set of
-00004f10: 2073 6563 7469 6f6e 7320 3c64 6976 3e20   sections <div> 
-00004f20: 7468 6174 2061 7265 2061 6c6c 2063 6869  that are all chi
-00004f30: 6c64 7265 6e20 6f66 203c 626f 6479 3e20  ldren of <body> 
-00004f40: 7768 6963 6820 6d75 7374 2062 6520 6172  which must be ar
-00004f50: 7261 6e67 6564 2069 6e20 6120 7472 6565  ranged in a tree
-00004f60: 2073 7472 7563 7475 7265 2e20 536f 6d65   structure. Some
-00004f70: 206f 6620 7468 6520 6469 7673 2063 6f6e   of the divs con
-00004f80: 7461 696e 206a 7573 7420 6120 7469 746c  tain just a titl
-00004f90: 652d 7374 7269 6e67 2028 7469 746c 652d  e-string (title-
-00004fa0: 6469 7673 2920 696e 6469 6361 7469 6e67  divs) indicating
-00004fb0: 2074 6865 206c 6576 656c 2069 6e20 7472   the level in tr
-00004fc0: 6565 3b20 7468 6973 2069 7320 696e 6469  ee; this is indi
-00004fd0: 6361 7465 6420 6279 2061 2063 6c61 7373  cated by a class
-00004fe0: 2061 7474 7269 6275 7465 206f 6620 2273   attribute of "s
-00004ff0: 6563 7469 6f6e 222c 2022 7375 625f 7365  ection", "sub_se
-00005000: 6374 696f 6e22 2c20 2273 7562 5f73 7562  ction", "sub_sub
-00005010: 5f73 6563 7469 6f6e 222c 2065 7463 2e20  _section", etc. 
-00005020: 416e 7920 6469 7673 2066 6f6c 6c6f 7769  Any divs followi
-00005030: 6e67 2074 6974 6c65 2d64 6976 7320 6265  ng title-divs be
-00005040: 6c6f 6e67 2074 6f20 7468 6520 7361 6d65  long to the same
-00005050: 206c 6576 656c 2c20 756e 7469 6c20 6120   level, until a 
-00005060: 666f 6c6c 6f77 696e 6720 7469 746c 652d  following title-
-00005070: 6469 7620 6973 2072 6561 6368 6564 2e20  div is reached. 
-00005080: 506c 6561 7365 2063 7265 6174 6520 636f  Please create co
-00005090: 6465 2074 6861 743a 0a2a 2063 7265 6174  de that:.* creat
-000050a0: 6573 2061 206e 6577 2068 6965 7261 7263  es a new hierarc
-000050b0: 6879 206f 6620 6469 7673 2072 6570 7265  hy of divs repre
-000050c0: 7365 6e74 696e 6720 7468 6520 7472 6565  senting the tree
-000050d0: 2073 7472 7563 7475 7265 0a2a 2061 6464   structure.* add
-000050e0: 7320 7468 6520 7469 746c 652d 6469 7673  s the title-divs
-000050f0: 2061 6e64 2074 6865 6972 2066 6f6c 6c6f   and their follo
-00005100: 7769 6e67 206e 6f6e 2d74 6974 6c65 2d64  wing non-title-d
-00005110: 6976 7320 746f 2074 6865 2061 7070 726f  ivs to the appro
-00005120: 7072 6961 7465 2070 6f73 6974 696f 6e20  priate position 
-00005130: 696e 2074 6865 2068 6965 7261 7263 6879  in the hierarchy
-00005140: 2e0a 0a48 6572 6520 6973 2061 2074 7970  ...Here is a typ
-00005150: 6963 616c 2069 6e70 7574 3a0a 0a3c 6874  ical input:..<ht
-00005160: 6d6c 3e0a 2020 3c68 6561 643e 2e2e 2e3c  ml>.  <head>...<
-00005170: 2f68 6561 643e 0a20 203c 626f 6479 3e0a  /head>.  <body>.
-00005180: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
-00005190: 7365 6374 696f 6e5f 7469 746c 6522 3e53  section_title">S
-000051a0: 6563 7469 6f6e 2031 3c2f 6469 763e 0a20  ection 1</div>. 
-000051b0: 2020 203c 6469 763e 7374 7566 6620 613c     <div>stuff a<
-000051c0: 2f64 6976 3e0a 2020 2020 3c64 6976 2063  /div>.    <div c
-000051d0: 6c61 7373 3d22 7375 6273 6563 7469 6f6e  lass="subsection
-000051e0: 5f74 6974 6c65 223e 5365 6374 696f 6e20  _title">Section 
-000051f0: 312e 313c 2f64 6976 3e0a 2020 2020 3c64  1.1</div>.    <d
-00005200: 6976 3e73 7475 6666 2062 3c2f 6469 763e  iv>stuff b</div>
-00005210: 0a20 2020 203c 6469 763e 7374 7566 6620  .    <div>stuff 
-00005220: 6278 3c2f 6469 763e 0a20 2020 203c 6469  bx</div>.    <di
-00005230: 7620 636c 6173 733d 2273 7562 7375 6273  v class="subsubs
-00005240: 6563 7469 6f6e 5f74 6974 6c65 223e 5365  ection_title">Se
-00005250: 6374 696f 6e20 312e 312e 313c 2f64 6976  ction 1.1.1</div
-00005260: 3e0a 2020 2020 3c64 6976 3e73 7475 6666  >.    <div>stuff
-00005270: 207a 3c2f 6469 763e 0a20 2020 203c 6469   z</div>.    <di
-00005280: 763e 7374 7566 6620 7a7a 3c2f 6469 763e  v>stuff zz</div>
-00005290: 0a20 2020 203c 6469 7620 636c 6173 733d  .    <div class=
-000052a0: 2273 7562 7375 6273 6563 7469 6f6e 5f74  "subsubsection_t
-000052b0: 6974 6c65 223e 5365 6374 696f 6e20 312e  itle">Section 1.
-000052c0: 312e 323c 2f64 6976 3e0a 2020 2020 3c64  1.2</div>.    <d
-000052d0: 6976 3e73 7475 6666 2078 3c2f 6469 763e  iv>stuff x</div>
-000052e0: 0a20 2020 203c 6469 763e 7374 7566 6620  .    <div>stuff 
-000052f0: 7878 3c2f 6469 763e 0a20 2020 203c 6469  xx</div>.    <di
-00005300: 763e 7374 7566 6620 7878 783c 2f64 6976  v>stuff xxx</div
-00005310: 3e0a 2020 2020 3c64 6976 2063 6c61 7373  >.    <div class
-00005320: 3d22 7375 6273 6563 7469 6f6e 5f74 6974  ="subsection_tit
-00005330: 6c65 223e 5365 6374 696f 6e20 312e 323c  le">Section 1.2<
-00005340: 2f64 6976 3e0a 2020 3c2f 626f 6479 3e0a  /div>.  </body>.
-00005350: 3c2f 6874 6d6c 3e0a 0a20 2020 616e 6420  </html>..   and 
-00005360: 6465 7369 7265 6420 6f75 7470 7574 0a3c  desired output.<
-00005370: 6874 6d6c 3e0a 2020 3c68 6561 643e 2e2e  html>.  <head>..
-00005380: 2e3c 2f68 6561 643e 0a20 203c 626f 6479  .</head>.  <body
-00005390: 3e0a 2020 2020 3c64 6976 2063 6c61 7373  >.    <div class
-000053a0: 3d22 7365 6374 696f 6e22 3e0a 2020 2020  ="section">.    
-000053b0: 2020 3c64 6976 2063 6c61 7373 3d22 7365    <div class="se
-000053c0: 6374 696f 6e5f 7469 746c 6522 3e53 6563  ction_title">Sec
-000053d0: 7469 6f6e 2031 3c2f 6469 763e 0a20 2020  tion 1</div>.   
-000053e0: 2020 203c 6469 763e 7374 7566 6620 613c     <div>stuff a<
-000053f0: 2f64 6976 3e0a 0920 203c 6469 7620 636c  /div>..  <div cl
-00005400: 6173 733d 2273 7562 7365 6374 696f 6e22  ass="subsection"
-00005410: 3e0a 2020 2020 2020 2020 3c64 6976 2063  >.        <div c
-00005420: 6c61 7373 3d22 7375 6273 6563 7469 6f6e  lass="subsection
-00005430: 5f74 6974 6c65 223e 5365 6374 696f 6e20  _title">Section 
-00005440: 312e 313c 2f64 6976 3e0a 2020 2020 2020  1.1</div>.      
-00005450: 2020 3c64 6976 3e73 7475 6666 2062 3c2f    <div>stuff b</
-00005460: 6469 763e 0a20 2020 2020 2020 203c 6469  div>.        <di
-00005470: 763e 7374 7566 6620 6278 3c2f 6469 763e  v>stuff bx</div>
-00005480: 0a09 093c 6469 7620 636c 6173 733d 2273  ...<div class="s
-00005490: 7562 7375 6273 6563 7469 6f6e 223e 0a20  ubsubsection">. 
-000054a0: 2020 2020 2020 2020 203c 6469 7620 636c           <div cl
-000054b0: 6173 733d 2273 7562 7375 6273 6563 7469  ass="subsubsecti
-000054c0: 6f6e 5f74 6974 6c65 223e 5365 6374 696f  on_title">Sectio
-000054d0: 6e20 312e 312e 313c 2f64 6976 3e0a 2020  n 1.1.1</div>.  
-000054e0: 2020 2020 2020 2020 3c64 6976 3e73 7475          <div>stu
-000054f0: 6666 207a 3c2f 6469 763e 0a20 2020 2020  ff z</div>.     
-00005500: 2020 2020 203c 6469 763e 7374 7566 6620       <div>stuff 
-00005510: 7a7a 3c2f 6469 763e 0a09 093c 2f64 6976  zz</div>...</div
-00005520: 3e0a 0909 3c64 6976 2063 6c61 7373 3d22  >...<div class="
-00005530: 7375 6273 7562 7365 6374 696f 6e22 3e0a  subsubsection">.
-00005540: 2020 2020 2020 2020 2020 3c64 6976 2063            <div c
-00005550: 6c61 7373 3d22 7375 6273 7562 7365 6374  lass="subsubsect
-00005560: 696f 6e5f 7469 746c 6522 3e53 6563 7469  ion_title">Secti
-00005570: 6f6e 2031 2e31 2e32 3c2f 6469 763e 0a20  on 1.1.2</div>. 
-00005580: 2020 2020 2020 2020 203c 6469 763e 7374           <div>st
-00005590: 7566 6620 783c 2f64 6976 3e0a 2020 2020  uff x</div>.    
-000055a0: 2020 2020 2020 3c64 6976 3e73 7475 6666        <div>stuff
-000055b0: 2078 783c 2f64 6976 3e0a 2020 2020 2020   xx</div>.      
-000055c0: 2020 2020 3c64 6976 3e73 7475 6666 2078      <div>stuff x
-000055d0: 7878 3c2f 6469 763e 0a09 093c 2f64 6976  xx</div>...</div
-000055e0: 3e0a 0920 203c 2f64 6976 3e0a 093c 2f64  >..  </div>..</d
-000055f0: 6976 3e0a 2020 2020 3c64 6976 2063 6c61  iv>.    <div cla
-00005600: 7373 3d22 7365 6374 696f 6e22 3e0a 2020  ss="section">.  
-00005610: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
-00005620: 7365 6374 696f 6e5f 7469 746c 6522 3e53  section_title">S
-00005630: 6563 7469 6f6e 2032 3c2f 6469 763e 0a09  ection 2</div>..
-00005640: 3c2f 6469 763e 0a20 203c 2f62 6f64 793e  </div>.  </body>
-00005650: 0a3c 2f68 746d 6c3e 0a0a 4368 6174 4750  .</html>..ChatGP
-00005660: 540a 546f 2061 6368 6965 7665 2074 6865  T.To achieve the
-00005670: 2064 6573 6972 6564 206f 7574 7075 742c   desired output,
-00005680: 2079 6f75 2063 616e 2075 7365 2074 6865   you can use the
-00005690: 2066 6f6c 6c6f 7769 6e67 2050 7974 686f   following Pytho
-000056a0: 6e20 636f 6465 2074 6f20 7061 7273 6520  n code to parse 
-000056b0: 7468 6520 4854 4d4c 2075 7369 6e67 206c  the HTML using l
-000056c0: 786d 6c20 616e 6420 7265 7374 7275 6374  xml and restruct
-000056d0: 7572 6520 7468 6520 3c64 6976 3e20 656c  ure the <div> el
-000056e0: 656d 656e 7473 2069 6e74 6f20 6120 7472  ements into a tr
-000056f0: 6565 2073 7472 7563 7475 7265 2062 6173  ee structure bas
-00005700: 6564 206f 6e20 7468 6569 7220 636c 6173  ed on their clas
-00005710: 7320 6174 7472 6962 7574 6573 3a0a 0a70  s attributes:..p
-00005720: 7974 686f 6e0a 436f 7079 2063 6f64 650a  ython.Copy code.
-00005730: 6672 6f6d 206c 786d 6c20 696d 706f 7274  from lxml import
-00005740: 2065 7472 6565 2023 2069 6e20 636f 6d6d   etree # in comm
-00005750: 656e 740a 0a64 6566 2067 726f 7570 5f64  ent..def group_d
-00005760: 6976 735f 696e 746f 5f74 7265 6528 6874  ivs_into_tree(ht
-00005770: 6d6c 293a 0a20 2020 2023 2050 6172 7365  ml):.    # Parse
-00005780: 2074 6865 2048 544d 4c0a 2020 2020 7472   the HTML.    tr
-00005790: 6565 203d 2065 7472 6565 2e48 544d 4c28  ee = etree.HTML(
-000057a0: 6874 6d6c 290a 0a20 2020 2023 2046 696e  html)..    # Fin
-000057b0: 6420 616c 6c20 3c64 6976 3e20 656c 656d  d all <div> elem
-000057c0: 656e 7473 2077 6974 6869 6e20 7468 6520  ents within the 
-000057d0: 3c62 6f64 793e 2074 6167 0a20 2020 2064  <body> tag.    d
-000057e0: 6976 5f65 6c65 6d65 6e74 7320 3d20 7472  iv_elements = tr
-000057f0: 6565 2e78 7061 7468 2822 2f2f 626f 6479  ee.xpath("//body
-00005800: 2f64 6976 2229 0a0a 2020 2020 2320 4372  /div")..    # Cr
-00005810: 6561 7465 2061 206e 6577 2072 6f6f 7420  eate a new root 
-00005820: 3c64 6976 3e20 656c 656d 656e 7420 746f  <div> element to
-00005830: 2068 6f6c 6420 7468 6520 7472 6565 2073   hold the tree s
-00005840: 7472 7563 7475 7265 0a20 2020 2072 6f6f  tructure.    roo
-00005850: 7420 3d20 6574 7265 652e 456c 656d 656e  t = etree.Elemen
-00005860: 7428 2264 6976 2229 0a0a 2020 2020 2320  t("div")..    # 
-00005870: 496e 6974 6961 6c69 7a65 2076 6172 6961  Initialize varia
-00005880: 626c 6573 2074 6f20 6b65 6570 2074 7261  bles to keep tra
-00005890: 636b 206f 6620 7468 6520 6375 7272 656e  ck of the curren
-000058a0: 7420 7061 7265 6e74 203c 6469 763e 2061  t parent <div> a
-000058b0: 6e64 2069 7473 206c 6576 656c 0a20 2020  nd its level.   
-000058c0: 2063 7572 7265 6e74 5f70 6172 656e 7420   current_parent 
-000058d0: 3d20 726f 6f74 0a20 2020 2063 7572 7265  = root.    curre
-000058e0: 6e74 5f6c 6576 656c 203d 2030 0a0a 2020  nt_level = 0..  
-000058f0: 2020 666f 7220 6469 7620 696e 2064 6976    for div in div
-00005900: 5f65 6c65 6d65 6e74 733a 0a20 2020 2020  _elements:.     
-00005910: 2020 2023 2043 6865 636b 2069 6620 7468     # Check if th
-00005920: 6520 6375 7272 656e 7420 3c64 6976 3e20  e current <div> 
-00005930: 6861 7320 6120 636c 6173 7320 6174 7472  has a class attr
-00005940: 6962 7574 650a 2020 2020 2020 2020 6966  ibute.        if
-00005950: 2022 636c 6173 7322 2069 6e20 6469 762e   "class" in div.
-00005960: 6174 7472 6962 3a0a 2020 2020 2020 2020  attrib:.        
-00005970: 2020 2020 636c 6173 735f 7661 6c75 6520      class_value 
-00005980: 3d20 6469 762e 6174 7472 6962 5b22 636c  = div.attrib["cl
-00005990: 6173 7322 5d0a 0a20 2020 2020 2020 2020  ass"]..         
-000059a0: 2020 2023 2044 6574 6572 6d69 6e65 2074     # Determine t
-000059b0: 6865 206c 6576 656c 2062 6173 6564 206f  he level based o
-000059c0: 6e20 7468 6520 636c 6173 7320 6174 7472  n the class attr
-000059d0: 6962 7574 650a 2020 2020 2020 2020 2020  ibute.          
-000059e0: 2020 6966 2063 6c61 7373 5f76 616c 7565    if class_value
-000059f0: 2e73 7461 7274 7377 6974 6828 2273 6563  .startswith("sec
-00005a00: 7469 6f6e 5f74 6974 6c65 2229 3a0a 2020  tion_title"):.  
-00005a10: 2020 2020 2020 2020 2020 2020 2020 6c65                le
-00005a20: 7665 6c20 3d20 300a 2020 2020 2020 2020  vel = 0.        
-00005a30: 2020 2020 656c 6966 2063 6c61 7373 5f76      elif class_v
-00005a40: 616c 7565 2e73 7461 7274 7377 6974 6828  alue.startswith(
-00005a50: 2273 7562 7365 6374 696f 6e5f 7469 746c  "subsection_titl
-00005a60: 6522 293a 0a20 2020 2020 2020 2020 2020  e"):.           
-00005a70: 2020 2020 206c 6576 656c 203d 2031 0a20       level = 1. 
-00005a80: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
-00005a90: 636c 6173 735f 7661 6c75 652e 7374 6172  class_value.star
-00005aa0: 7473 7769 7468 2822 7375 6273 7562 7365  tswith("subsubse
-00005ab0: 6374 696f 6e5f 7469 746c 6522 293a 0a20  ction_title"):. 
-00005ac0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00005ad0: 6576 656c 203d 2032 0a20 2020 2020 2020  evel = 2.       
-00005ae0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00005af0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-00005b00: 6e75 6520 2023 2053 6b69 7020 3c64 6976  nue  # Skip <div
-00005b10: 3e20 656c 656d 656e 7473 2077 6974 686f  > elements witho
-00005b20: 7574 2074 6974 6c65 2063 6c61 7373 6573  ut title classes
-00005b30: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
-00005b40: 4372 6561 7465 2061 206e 6577 203c 6469  Create a new <di
-00005b50: 763e 2065 6c65 6d65 6e74 2061 6e64 2073  v> element and s
-00005b60: 6574 2069 7473 2063 6c61 7373 2061 7474  et its class att
-00005b70: 7269 6275 7465 0a20 2020 2020 2020 2020  ribute.         
-00005b80: 2020 206e 6577 5f64 6976 203d 2065 7472     new_div = etr
-00005b90: 6565 2e53 7562 456c 656d 656e 7428 6375  ee.SubElement(cu
-00005ba0: 7272 656e 745f 7061 7265 6e74 2c20 2264  rrent_parent, "d
-00005bb0: 6976 2229 0a20 2020 2020 2020 2020 2020  iv").           
-00005bc0: 206e 6577 5f64 6976 2e61 7474 7269 625b   new_div.attrib[
-00005bd0: 2263 6c61 7373 225d 203d 2022 7365 6374  "class"] = "sect
-00005be0: 696f 6e22 202a 2028 6c65 7665 6c20 2b20  ion" * (level + 
-00005bf0: 3129 2020 2320 4164 6420 6170 7072 6f70  1)  # Add approp
-00005c00: 7269 6174 6520 636c 6173 7320 6261 7365  riate class base
-00005c10: 6420 6f6e 206c 6576 656c 0a0a 2020 2020  d on level..    
-00005c20: 2020 2020 2020 2020 2320 4164 6420 7468          # Add th
-00005c30: 6520 6375 7272 656e 7420 3c64 6976 3e20  e current <div> 
-00005c40: 746f 2074 6865 206e 6577 203c 6469 763e  to the new <div>
-00005c50: 2065 6c65 6d65 6e74 0a20 2020 2020 2020   element.       
-00005c60: 2020 2020 206e 6577 5f64 6976 2e61 7070       new_div.app
-00005c70: 656e 6428 6469 7629 0a0a 2020 2020 2020  end(div)..      
-00005c80: 2020 2020 2020 2320 5570 6461 7465 2074        # Update t
-00005c90: 6865 2063 7572 7265 6e74 2070 6172 656e  he current paren
-00005ca0: 7420 616e 6420 6c65 7665 6c0a 2020 2020  t and level.    
-00005cb0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-00005cc0: 7061 7265 6e74 203d 206e 6577 5f64 6976  parent = new_div
-00005cd0: 0a20 2020 2020 2020 2020 2020 2063 7572  .            cur
-00005ce0: 7265 6e74 5f6c 6576 656c 203d 206c 6576  rent_level = lev
-00005cf0: 656c 0a20 2020 2020 2020 2065 6c73 653a  el.        else:
-00005d00: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
-00005d10: 6464 206e 6f6e 2d74 6974 6c65 203c 6469  dd non-title <di
-00005d20: 763e 2065 6c65 6d65 6e74 7320 746f 2074  v> elements to t
-00005d30: 6865 2063 7572 7265 6e74 2070 6172 656e  he current paren
-00005d40: 740a 2020 2020 2020 2020 2020 2020 6375  t.            cu
-00005d50: 7272 656e 745f 7061 7265 6e74 2e61 7070  rrent_parent.app
-00005d60: 656e 6428 6469 7629 0a0a 2020 2020 2320  end(div)..    # 
-00005d70: 5265 7475 726e 2074 6865 206d 6f64 6966  Return the modif
-00005d80: 6965 6420 4854 4d4c 2061 7320 6120 7374  ied HTML as a st
-00005d90: 7269 6e67 0a20 2020 2072 6574 7572 6e20  ring.    return 
-00005da0: 6574 7265 652e 746f 7374 7269 6e67 2874  etree.tostring(t
-00005db0: 7265 652c 2065 6e63 6f64 696e 673d 2275  ree, encoding="u
-00005dc0: 6e69 636f 6465 2229 0a0a 2320 4578 616d  nicode")..# Exam
-00005dd0: 706c 6520 7573 6167 650a 6874 6d6c 203d  ple usage.html =
-00005de0: 2027 2727 0a3c 6874 6d6c 3e0a 2020 3c68   '''.<html>.  <h
-00005df0: 6561 643e 2e2e 2e3c 2f68 6561 643e 0a20  ead>...</head>. 
-00005e00: 203c 626f 6479 3e0a 2020 2020 3c64 6976   <body>.    <div
-00005e10: 2063 6c61 7373 3d22 7365 6374 696f 6e5f   class="section_
-00005e20: 7469 746c 6522 3e53 6563 7469 6f6e 2031  title">Section 1
-00005e30: 3c2f 6469 763e 0a20 2020 203c 6469 763e  </div>.    <div>
-00005e40: 7374 7566 6620 613c 2f64 6976 3e0a 2020  stuff a</div>.  
-00005e50: 2020 3c64 6976 2063 6c61 7373 3d22 7375    <div class="su
-00005e60: 6273 6563 7469 6f6e 5f74 6974 6c65 223e  bsection_title">
-00005e70: 5365 6374 696f 6e20 312e 313c 2f64 6976  Section 1.1</div
-00005e80: 3e0a 2020 2020 3c64 6976 3e73 7475 6666  >.    <div>stuff
-00005e90: 2062 3c2f 6469 763e 0a20 2020 203c 6469   b</div>.    <di
-00005ea0: 763e 7374 7566 6620 6278 3c2f 6469 763e  v>stuff bx</div>
-00005eb0: 0a20 2020 203c 6469 7620 636c 6173 733d  .    <div class=
-00005ec0: 2273 7562 7375 6273 6563 7469 6f6e 5f74  "subsubsection_t
-00005ed0: 6974 6c65 223e 5365 6374 696f 6e20 312e  itle">Section 1.
-00005ee0: 312e 313c 2f64 6976 3e0a 2020 2020 3c64  1.1</div>.    <d
-00005ef0: 6976 3e73 7475 6666 207a 3c2f 6469 763e  iv>stuff z</div>
-00005f00: 0a20 2020 203c 6469 763e 7374 7566 6620  .    <div>stuff 
-00005f10: 7a7a 3c2f 6469 763e 0a20 2020 203c 6469  zz</div>.    <di
-00005f20: 7620 636c 6173 733d 2273 7562 7375 6273  v class="subsubs
-00005f30: 6563 7469 6f6e 5f74 6974 6c65 223e 5365  ection_title">Se
-00005f40: 6374 696f 6e20 312e 312e 323c 2f64 6976  ction 1.1.2</div
-00005f50: 3e0a 2020 2020 3c64 6976 3e73 7475 6666  >.    <div>stuff
-00005f60: 2078 3c2f 6469 763e 0a20 2020 203c 6469   x</div>.    <di
-00005f70: 763e 7374 7566 6620 7878 3c2f 6469 763e  v>stuff xx</div>
-00005f80: 0a20 2020 203c 6469 763e 7374 7566 6620  .    <div>stuff 
-00005f90: 7878 783c 2f64 6976 3e0a 2020 2020 3c64  xxx</div>.    <d
-00005fa0: 6976 2063 6c61 7373 3d22 7375 6273 6563  iv class="subsec
-00005fb0: 7469 6f6e 5f74 6974 6c65 223e 5365 6374  tion_title">Sect
-00005fc0: 696f 6e20 312e 323c 2f64 6976 3e0a 2020  ion 1.2</div>.  
-00005fd0: 3c2f 626f 6479 3e0a 3c2f 6874 6d6c 3e0a  </body>.</html>.
-00005fe0: 2727 270a 0a6f 7574 7075 745f 6874 6d6c  '''..output_html
-00005ff0: 203d 2067 726f 7570 5f64 6976 735f 696e   = group_divs_in
-00006000: 746f 5f74 7265 6528 6874 6d6c 290a 7072  to_tree(html).pr
-00006010: 696e 7428 6f75 7470 7574 5f68 746d 6c29  int(output_html)
-00006020: 0a54 6865 2063 6f64 6520 7769 6c6c 2070  .The code will p
-00006030: 6172 7365 2074 6865 2048 544d 4c2c 2069  arse the HTML, i
-00006040: 6465 6e74 6966 7920 7468 6520 7469 746c  dentify the titl
-00006050: 6520 3c64 6976 3e20 656c 656d 656e 7473  e <div> elements
-00006060: 2062 6173 6564 206f 6e20 7468 6569 7220   based on their 
-00006070: 636c 6173 7320 6174 7472 6962 7574 6573  class attributes
-00006080: 2c20 6372 6561 7465 2061 206e 6577 2068  , create a new h
-00006090: 6965 7261 7263 6879 206f 6620 3c64 6976  ierarchy of <div
-000060a0: 3e20 656c 656d 656e 7473 2c20 616e 6420  > elements, and 
-000060b0: 6164 6420 7468 6520 7469 746c 6520 3c64  add the title <d
-000060c0: 6976 3e73 2061 6e64 2074 6865 6972 2066  iv>s and their f
-000060d0: 6f6c 6c6f 7769 6e67 206e 6f6e 2d74 6974  ollowing non-tit
-000060e0: 6c65 203c 6469 763e 7320 746f 2074 6865  le <div>s to the
-000060f0: 2061 7070 726f 7072 6961 7465 2070 6f73   appropriate pos
-00006100: 6974 696f 6e20 696e 2074 6865 2068 6965  ition in the hie
-00006110: 7261 7263 6879 2e20 4669 6e61 6c6c 792c  rarchy. Finally,
-00006120: 2069 7420 7769 6c6c 2072 6574 7572 6e20   it will return 
-00006130: 7468 6520 6d6f 6469 6669 6564 2048 544d  the modified HTM
-00006140: 4c20 6173 2061 2073 7472 696e 672e 0a0a  L as a string...
-00006150: 506c 6561 7365 206e 6f74 6520 7468 6174  Please note that
-00006160: 2074 6865 2063 6f64 6520 6173 7375 6d65   the code assume
-00006170: 7320 7468 6174 2074 6865 2063 6c61 7373  s that the class
-00006180: 2076 616c 7565 7320 666f 7220 7468 6520   values for the 
-00006190: 7469 746c 6520 3c64 6976 3e20 656c 656d  title <div> elem
-000061a0: 656e 7473 2066 6f6c 6c6f 7720 7468 6520  ents follow the 
-000061b0: 7061 7474 6572 6e20 2273 6563 7469 6f6e  pattern "section
-000061c0: 5f74 6974 6c65 222c 2022 7375 6273 6563  _title", "subsec
-000061d0: 7469 6f6e 5f74 6974 6c65 222c 2022 7375  tion_title", "su
-000061e0: 6273 7562 7365 6374 696f 6e5f 7469 746c  bsubsection_titl
-000061f0: 6522 2c20 616e 6420 736f 206f 6e2e 2049  e", and so on. I
-00006200: 6620 796f 7572 2061 6374 7561 6c20 636c  f your actual cl
-00006210: 6173 7320 6e61 6d65 7320 6469 6666 6572  ass names differ
-00006220: 2c20 796f 7520 6d61 7920 6e65 6564 2074  , you may need t
-00006230: 6f20 6d6f 6469 6679 2074 6865 2063 6f64  o modify the cod
-00006240: 6520 6163 636f 7264 696e 676c 792e 0a0a  e accordingly...
-00006250: 0a0a 0a0a 5265 6765 6e65 7261 7465 2072  ....Regenerate r
-00006260: 6573 706f 6e73 650a 5365 6e64 2061 206d  esponse.Send a m
-00006270: 6573 7361 6765 2e0a 0a46 7265 6520 5265  essage...Free Re
-00006280: 7365 6172 6368 2050 7265 7669 6577 2e20  search Preview. 
-00006290: 4368 6174 4750 5420 6d61 7920 7072 6f64  ChatGPT may prod
-000062a0: 7563 6520 696e 6163 6375 7261 7465 2069  uce inaccurate i
-000062b0: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
-000062c0: 2070 656f 706c 652c 2070 6c61 6365 732c   people, places,
-000062d0: 206f 7220 6661 6374 732e 2043 6861 7447   or facts. ChatG
-000062e0: 5054 204d 6179 2031 3220 5665 7273 696f  PT May 12 Versio
-000062f0: 6e22 2222 0a20 2020 2040 636c 6173 736d  n""".    @classm
-00006300: 6574 686f 640a 2020 2020 6465 6620 6772  ethod.    def gr
-00006310: 6f75 705f 6469 7673 5f69 6e74 6f5f 7472  oup_divs_into_tr
-00006320: 6565 2863 6c73 2c20 626f 6479 293a 0a20  ee(cls, body):. 
-00006330: 2020 2020 2020 2022 2222 5065 7465 7220         """Peter 
-00006340: 4d75 7272 6179 2d52 7573 7422 2222 0a20  Murray-Rust""". 
-00006350: 2020 2020 2020 2045 4e44 203d 2022 5b45         END = "[E
-00006360: 4e44 220a 2020 2020 2020 2020 5354 4152  ND".        STAR
-00006370: 5420 3d20 225b 5354 4152 5422 0a20 2020  T = "[START".   
-00006380: 2020 2020 2046 4c4f 4154 203d 2022 666c       FLOAT = "fl
-00006390: 6f61 7422 0a0a 2020 2020 2020 2020 736b  oat"..        sk
-000063a0: 6970 5f72 6573 203d 205b 0a20 2020 2020  ip_res = [.     
-000063b0: 2020 2020 2020 2072 652e 636f 6d70 696c         re.compil
-000063c0: 6528 2241 646f 7074 6564 2e2a 2229 2c0a  e("Adopted.*"),.
-000063d0: 2020 2020 2020 2020 2020 2020 7265 2e63              re.c
-000063e0: 6f6d 7069 6c65 2822 5375 626a 6563 7420  ompile("Subject 
-000063f0: 746f 2043 6f70 7922 290a 2020 2020 2020  to Copy").      
-00006400: 2020 5d0a 0a0a 2020 2020 2020 2020 6469    ]...        di
-00006410: 765f 7374 796c 6573 203d 205b 2262 6f72  v_styles = ["bor
-00006420: 6465 723a 2023 3838 3838 6666 2073 6f6c  der: #8888ff sol
-00006430: 6964 2033 7078 3b22 2c0a 2020 2020 2020  id 3px;",.      
-00006440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006450: 2262 6f72 6465 723a 2063 7961 6e20 6461  "border: cyan da
-00006460: 7368 6564 2032 2e35 7078 3b22 2c0a 2020  shed 2.5px;",.  
-00006470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006480: 2020 2020 2262 6f72 6465 723a 2067 7265      "border: gre
-00006490: 656e 2064 6173 6865 6420 3270 783b 222c  en dashed 2px;",
-000064a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000064b0: 2020 2020 2020 205d 0a0a 2020 2020 2020         ]..      
-000064c0: 2020 2320 4669 6e64 2061 6c6c 203c 6469    # Find all <di
-000064d0: 763e 2065 6c65 6d65 6e74 7320 7769 7468  v> elements with
-000064e0: 696e 2074 6865 203c 626f 6479 3e20 7461  in the <body> ta
-000064f0: 670a 2020 2020 2020 2020 6469 765f 656c  g.        div_el
-00006500: 656d 656e 7473 203d 2062 6f64 792e 7870  ements = body.xp
-00006510: 6174 6828 222e 2f64 6976 2229 0a0a 2020  ath("./div")..  
-00006520: 2020 2020 2020 2320 4372 6561 7465 2061        # Create a
-00006530: 206e 6577 2072 6f6f 7420 3c64 6976 3e20   new root <div> 
-00006540: 656c 656d 656e 7420 746f 2068 6f6c 6420  element to hold 
-00006550: 7468 6520 7472 6565 2073 7472 7563 7475  the tree structu
-00006560: 7265 0a20 2020 2020 2020 2072 6f6f 745f  re.        root_
-00006570: 6469 7620 3d20 4554 2e45 6c65 6d65 6e74  div = ET.Element
-00006580: 2822 6469 7622 290a 2020 2020 2020 2020  ("div").        
-00006590: 726f 6f74 5f64 6976 2e61 7474 7269 625b  root_div.attrib[
-000065a0: 2263 6c61 7373 225d 203d 2022 726f 6f74  "class"] = "root
-000065b0: 220a 2020 2020 2020 2020 726f 6f74 5f64  ".        root_d
-000065c0: 6976 2e61 7474 7269 625b 2274 6974 6c65  iv.attrib["title
-000065d0: 225d 203d 2022 726f 6f74 220a 0a20 2020  "] = "root"..   
-000065e0: 2020 2020 2023 2049 6e69 7469 616c 697a       # Initializ
-000065f0: 6520 7661 7269 6162 6c65 7320 746f 206b  e variables to k
-00006600: 6565 7020 7472 6163 6b20 6f66 2074 6865  eep track of the
-00006610: 2063 7572 7265 6e74 2070 6172 656e 7420   current parent 
-00006620: 3c64 6976 3e20 616e 6420 6974 7320 6c65  <div> and its le
-00006630: 7665 6c0a 2020 2020 2020 2020 6375 7272  vel.        curr
-00006640: 656e 745f 7061 7265 6e74 203d 2072 6f6f  ent_parent = roo
-00006650: 745f 6469 760a 2020 2020 2020 2020 6375  t_div.        cu
-00006660: 7272 656e 745f 6c65 7665 6c20 3d20 300a  rrent_level = 0.
-00006670: 0a20 2020 2020 2020 2070 6172 656e 7473  .        parents
-00006680: 203d 205b 726f 6f74 5f64 6976 2c20 4e6f   = [root_div, No
-00006690: 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65 5d0a  ne, None, None].
-000066a0: 2020 2020 2020 2020 7374 6172 745f 656e          start_en
-000066b0: 6473 203d 205b 5d0a 2020 2020 2020 2020  ds = [].        
-000066c0: 7061 7265 6e74 203d 2072 6f6f 745f 6469  parent = root_di
-000066d0: 760a 2020 2020 2020 2020 666f 7220 6469  v.        for di
-000066e0: 7620 696e 2064 6976 5f65 6c65 6d65 6e74  v in div_element
-000066f0: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-00006700: 2043 6865 636b 2069 6620 7468 6520 6375   Check if the cu
-00006710: 7272 656e 7420 3c64 6976 3e20 6861 7320  rrent <div> has 
-00006720: 6120 636c 6173 7320 6174 7472 6962 7574  a class attribut
-00006730: 650a 2020 2020 2020 2020 2020 2020 7465  e.            te
-00006740: 7874 203d 2027 272e 6a6f 696e 2864 6976  xt = ''.join(div
-00006750: 2e69 7465 7274 6578 7428 2929 0a20 2020  .itertext()).   
-00006760: 2020 2020 2020 2020 2069 6620 2263 6c61           if "cla
-00006770: 7373 2220 696e 2064 6976 2e61 7474 7269  ss" in div.attri
-00006780: 623a 0a20 2020 2020 2020 2020 2020 2020  b:.             
-00006790: 2020 2070 6172 656e 7420 3d20 636c 732e     parent = cls.
-000067a0: 7072 6f63 6573 735f 636c 6173 735f 6469  process_class_di
-000067b0: 7628 6469 762c 2064 6976 5f73 7479 6c65  v(div, div_style
-000067c0: 732c 2070 6172 656e 742c 2070 6172 656e  s, parent, paren
-000067d0: 7473 2c20 7465 7874 290a 0a20 2020 2020  ts, text)..     
-000067e0: 2020 2020 2020 2065 6c69 6620 7465 7874         elif text
-000067f0: 2e73 7461 7274 7377 6974 6828 5354 4152  .startswith(STAR
-00006800: 5429 3a0a 2020 2020 2020 2020 2020 2020  T):.            
-00006810: 2020 2020 7061 7265 6e74 203d 2063 6c73      parent = cls
-00006820: 2e70 726f 6365 7373 5f69 7063 635f 7374  .process_ipcc_st
-00006830: 6172 7428 464c 4f41 542c 2053 5441 5254  art(FLOAT, START
-00006840: 2c20 7061 7265 6e74 2c20 7374 6172 745f  , parent, start_
-00006850: 656e 6473 2c20 7465 7874 290a 0a20 2020  ends, text)..   
-00006860: 2020 2020 2020 2020 2065 6c69 6620 7465           elif te
-00006870: 7874 2e73 7461 7274 7377 6974 6828 454e  xt.startswith(EN
-00006880: 4429 3a0a 2020 2020 2020 2020 2020 2020  D):.            
-00006890: 2020 2020 7061 7265 6e74 203d 2063 6c73      parent = cls
-000068a0: 2e70 726f 6365 7373 5f69 7063 635f 656e  .process_ipcc_en
-000068b0: 6428 454e 442c 2053 5441 5254 2c20 7061  d(END, START, pa
-000068c0: 7265 6e74 2c20 7374 6172 745f 656e 6473  rent, start_ends
-000068d0: 2c20 7465 7874 290a 0a20 2020 2020 2020  , text)..       
-000068e0: 2020 2020 2065 6c69 6620 636c 732e 736b       elif cls.sk
-000068f0: 6970 5f63 6f6e 7465 6e74 2874 6578 742c  ip_content(text,
-00006900: 2073 6b69 705f 7265 7329 3a0a 2020 2020   skip_res):.    
-00006910: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00006920: 7428 6622 736b 6970 7065 6420 7b74 6578  t(f"skipped {tex
-00006930: 745b 3a35 305d 7d22 290a 0a20 2020 2020  t[:50]}")..     
-00006940: 2020 2020 2020 2023 2065 6c69 6620 636c         # elif cl
-00006950: 732e 6973 5f66 6f6f 746e 6f74 6528 7370  s.is_footnote(sp
-00006960: 616e 293a 0a20 2020 2020 2020 2020 2020  an):.           
-00006970: 2023 2020 2020 2070 7269 6e74 2866 2273   #     print(f"s
-00006980: 6b69 7070 6564 207b 7465 7874 5b3a 3530  kipped {text[:50
-00006990: 5d7d 2229 0a20 2020 2020 2020 2020 2020  ]}").           
-000069a0: 2023 0a20 2020 2020 2020 2020 2020 2065   #.            e
-000069b0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000069c0: 2020 2020 2070 6172 656e 742e 6170 7065       parent.appe
-000069d0: 6e64 2864 6976 290a 0a20 2020 2020 2020  nd(div)..       
-000069e0: 2072 6574 7572 6e20 726f 6f74 5f64 6976   return root_div
-000069f0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00006a00: 6f64 0a20 2020 2064 6566 2070 726f 6365  od.    def proce
-00006a10: 7373 5f69 7063 635f 656e 6428 636c 732c  ss_ipcc_end(cls,
-00006a20: 2045 4e44 2c20 5354 4152 542c 2070 6172   END, START, par
-00006a30: 656e 742c 2073 7461 7274 5f65 6e64 732c  ent, start_ends,
-00006a40: 2074 6578 7429 3a0a 2020 2020 2020 2020   text):.        
-00006a50: 656e 645f 7374 7220 3d20 7465 7874 5b6c  end_str = text[l
-00006a60: 656e 2845 4e44 293a 5d0a 2020 2020 2020  en(END):].      
-00006a70: 2020 6966 2073 7461 7274 5f65 6e64 733a    if start_ends:
-00006a80: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
-00006a90: 6f6d 6574 696d 6573 2075 6e62 616c 616e  ometimes unbalan
-00006aa0: 6365 6420 696e 2064 6f63 756d 656e 740a  ced in document.
-00006ab0: 2020 2020 2020 2020 2020 2020 7374 6172              star
-00006ac0: 745f 7374 7220 3d20 7374 6172 745f 656e  t_str = start_en
-00006ad0: 6473 2e70 6f70 2829 0a20 2020 2020 2020  ds.pop().       
-00006ae0: 2020 2020 2069 6620 7374 6172 745f 7374       if start_st
-00006af0: 7220 213d 2065 6e64 5f73 7472 3a0a 2020  r != end_str:.  
-00006b00: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-00006b10: 6767 6572 2e77 6172 6e69 6e67 2866 2275  gger.warning(f"u
-00006b20: 6e62 616c 616e 6365 643a 207b 5354 4152  nbalanced: {STAR
-00006b30: 5420 2b20 7374 6172 745f 7374 727d 2061  T + start_str} a
-00006b40: 6e64 207b 454e 4420 2b20 656e 645f 7374  nd {END + end_st
-00006b50: 727d 2229 0a20 2020 2020 2020 2020 2020  r}").           
-00006b60: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00006b70: 2020 2020 2020 2070 6172 656e 7420 3d20         parent = 
-00006b80: 7061 7265 6e74 2e67 6574 7061 7265 6e74  parent.getparent
-00006b90: 2829 0a20 2020 2020 2020 2072 6574 7572  ().        retur
-00006ba0: 6e20 7061 7265 6e74 0a0a 2020 2020 4063  n parent..    @c
-00006bb0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00006bc0: 6566 2070 726f 6365 7373 5f69 7063 635f  ef process_ipcc_
-00006bd0: 7374 6172 7428 636c 732c 2046 4c4f 4154  start(cls, FLOAT
-00006be0: 2c20 5354 4152 542c 2070 6172 656e 742c  , START, parent,
-00006bf0: 2073 7461 7274 5f65 6e64 732c 2074 6578   start_ends, tex
-00006c00: 7429 3a0a 2020 2020 2020 2020 7374 6172  t):.        star
-00006c10: 745f 7374 7220 3d20 7465 7874 5b6c 656e  t_str = text[len
-00006c20: 2853 5441 5254 293a 5d0a 2020 2020 2020  (START):].      
-00006c30: 2020 7374 6172 745f 656e 6473 2e61 7070    start_ends.app
-00006c40: 656e 6428 7374 6172 745f 7374 7229 0a20  end(start_str). 
-00006c50: 2020 2020 2020 2073 7562 5f64 6976 203d         sub_div =
-00006c60: 2045 542e 5375 6245 6c65 6d65 6e74 2870   ET.SubElement(p
-00006c70: 6172 656e 742c 2022 6469 7622 290a 2020  arent, "div").  
-00006c80: 2020 2020 2020 7375 625f 6469 762e 6174        sub_div.at
-00006c90: 7472 6962 5b22 636c 6173 7322 5d20 3d20  trib["class"] = 
-00006ca0: 464c 4f41 540a 2020 2020 2020 2020 7375  FLOAT.        su
-00006cb0: 625f 6469 762e 6174 7472 6962 5b22 7469  b_div.attrib["ti
-00006cc0: 746c 6522 5d20 3d20 7465 7874 0a20 2020  tle"] = text.   
-00006cd0: 2020 2020 2073 7562 5f64 6976 2e61 7474       sub_div.att
-00006ce0: 7269 625b 2273 7479 6c65 225d 203d 2022  rib["style"] = "
-00006cf0: 626f 7264 6572 3a20 6461 7368 6564 2062  border: dashed b
-00006d00: 6c75 6520 3370 783b 220a 2020 2020 2020  lue 3px;".      
-00006d10: 2020 7061 7265 6e74 203d 2073 7562 5f64    parent = sub_d
-00006d20: 6976 0a20 2020 2020 2020 2072 6574 7572  iv.        retur
-00006d30: 6e20 7061 7265 6e74 0a0a 2020 2020 4063  n parent..    @c
-00006d40: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00006d50: 6566 2070 726f 6365 7373 5f63 6c61 7373  ef process_class
-00006d60: 5f64 6976 2863 6c73 2c20 6469 762c 2064  _div(cls, div, d
-00006d70: 6976 5f73 7479 6c65 732c 2070 6172 656e  iv_styles, paren
-00006d80: 742c 2070 6172 656e 7473 2c20 7465 7874  t, parents, text
-00006d90: 293a 0a20 2020 2020 2020 2063 6c61 7373  ):.        class
-00006da0: 5f76 616c 7565 203d 2064 6976 2e61 7474  _value = div.att
-00006db0: 7269 625b 2263 6c61 7373 225d 0a20 2020  rib["class"].   
-00006dc0: 2020 2020 2023 2044 6574 6572 6d69 6e65       # Determine
-00006dd0: 2074 6865 206c 6576 656c 2062 6173 6564   the level based
-00006de0: 206f 6e20 7468 6520 636c 6173 7320 6174   on the class at
-00006df0: 7472 6962 7574 650a 2020 2020 2020 2020  tribute.        
-00006e00: 6966 2063 6c61 7373 5f76 616c 7565 2e73  if class_value.s
-00006e10: 7461 7274 7377 6974 6828 2273 6563 7469  tartswith("secti
-00006e20: 6f6e 2229 3a0a 2020 2020 2020 2020 2020  on"):.          
-00006e30: 2020 6c65 7665 6c20 3d20 310a 2020 2020    level = 1.    
-00006e40: 2020 2020 656c 6966 2063 6c61 7373 5f76      elif class_v
-00006e50: 616c 7565 2e73 7461 7274 7377 6974 6828  alue.startswith(
-00006e60: 2273 7562 5f73 6563 7469 6f6e 2229 3a0a  "sub_section"):.
-00006e70: 2020 2020 2020 2020 2020 2020 6c65 7665              leve
-00006e80: 6c20 3d20 320a 2020 2020 2020 2020 656c  l = 2.        el
-00006e90: 6966 2063 6c61 7373 5f76 616c 7565 2e73  if class_value.s
-00006ea0: 7461 7274 7377 6974 6828 2273 7562 5f73  tartswith("sub_s
-00006eb0: 7562 5f73 6563 7469 6f6e 2229 3a0a 2020  ub_section"):.  
-00006ec0: 2020 2020 2020 2020 2020 6c65 7665 6c20            level 
-00006ed0: 3d20 330a 2020 2020 2020 2020 656c 7365  = 3.        else
-00006ee0: 3a0a 2020 2020 2020 2020 2020 2020 6c65  :.            le
-00006ef0: 7665 6c20 3d20 4e6f 6e65 0a20 2020 2020  vel = None.     
-00006f00: 2020 2020 2020 2023 2063 6f6e 7469 6e75         # continu
-00006f10: 6520 2023 2053 6b69 7020 3c64 6976 3e20  e  # Skip <div> 
-00006f20: 656c 656d 656e 7473 2077 6974 686f 7574  elements without
-00006f30: 2074 6974 6c65 2063 6c61 7373 6573 0a20   title classes. 
-00006f40: 2020 2020 2020 2069 6620 6c65 7665 6c3a         if level:
-00006f50: 0a20 2020 2020 2020 2020 2020 2073 7461  .            sta
-00006f60: 636b 5f70 6172 656e 7420 3d20 7061 7265  ck_parent = pare
-00006f70: 6e74 735b 6c65 7665 6c20 2d20 315d 0a20  nts[level - 1]. 
-00006f80: 2020 2020 2020 2020 2020 2069 6620 7374             if st
-00006f90: 6163 6b5f 7061 7265 6e74 2069 7320 6e6f  ack_parent is no
-00006fa0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00006fb0: 2020 2020 2020 2020 6e65 775f 6469 7620          new_div 
-00006fc0: 3d20 4554 2e53 7562 456c 656d 656e 7428  = ET.SubElement(
-00006fd0: 7374 6163 6b5f 7061 7265 6e74 2c20 2264  stack_parent, "d
-00006fe0: 6976 2229 0a20 2020 2020 2020 2020 2020  iv").           
-00006ff0: 2020 2020 206e 6577 5f64 6976 2e61 7474       new_div.att
-00007000: 7269 625b 2274 6974 6c65 225d 203d 2074  rib["title"] = t
-00007010: 6578 745b 3a35 305d 0a20 2020 2020 2020  ext[:50].       
-00007020: 2020 2020 2020 2020 206e 6577 5f64 6976           new_div
-00007030: 2e61 7474 7269 625b 2273 7479 6c65 225d  .attrib["style"]
-00007040: 203d 2064 6976 5f73 7479 6c65 735b 6c65   = div_styles[le
-00007050: 7665 6c20 2d20 315d 0a0a 2020 2020 2020  vel - 1]..      
-00007060: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
-00007070: 203d 206e 6577 5f64 6976 0a20 2020 2020   = new_div.     
-00007080: 2020 2020 2020 2020 2020 2070 6172 656e             paren
-00007090: 7473 5b6c 6576 656c 5d20 3d20 6e65 775f  ts[level] = new_
-000070a0: 6469 760a 2020 2020 2020 2020 2020 2020  div.            
-000070b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000070c0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
-000070d0: 6f28 6622 6e6f 2070 6172 656e 7420 6f6e  o(f"no parent on
-000070e0: 2073 7461 636b 206c 6576 656c 207b 6c65   stack level {le
-000070f0: 7665 6c7d 2229 0a0a 0a0a 2020 2020 2020  vel}")....      
-00007100: 2020 7061 7265 6e74 2e61 7070 656e 6428    parent.append(
-00007110: 6469 7629 0a20 2020 2020 2020 2072 6574  div).        ret
-00007120: 7572 6e20 7061 7265 6e74 0a0a 2020 2020  urn parent..    
-00007130: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00007140: 2064 6566 2073 6b69 705f 636f 6e74 656e   def skip_conten
-00007150: 7428 636c 732c 2074 6578 742c 2073 6b69  t(cls, text, ski
-00007160: 705f 7265 7329 3a0a 2020 2020 2020 2020  p_res):.        
-00007170: 666f 7220 736b 6970 5f72 6520 696e 2073  for skip_re in s
-00007180: 6b69 705f 7265 733a 0a20 2020 2020 2020  kip_res:.       
-00007190: 2020 2020 2069 6620 736b 6970 5f72 652e       if skip_re.
-000071a0: 6d61 7463 6828 7465 7874 293a 0a20 2020  match(text):.   
-000071b0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000071c0: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
-000071d0: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
-000071e0: 2020 2064 6566 206d 6174 6368 5f72 6567     def match_reg
-000071f0: 6578 2864 6976 2c20 7265 6765 782c 2073  ex(div, regex, s
-00007200: 6563 7469 6f6e 5f63 6c61 7373 2c20 7465  ection_class, te
-00007210: 7874 293a 0a20 2020 2020 2020 2074 7279  xt):.        try
-00007220: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00007230: 6720 3d20 7265 2e63 6f6d 7069 6c65 2872  g = re.compile(r
-00007240: 6567 6578 290a 2020 2020 2020 2020 6578  egex).        ex
-00007250: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
-00007260: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00007270: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-00007280: 7228 6622 4241 4420 5245 4745 5820 7b72  r(f"BAD REGEX {r
-00007290: 6567 6578 7d20 6265 6361 7573 6520 7b65  egex} because {e
-000072a0: 7d22 290a 2020 2020 2020 2020 6d61 7463  }").        matc
-000072b0: 6820 3d20 7265 672e 6d61 7463 6828 7465  h = reg.match(te
-000072c0: 7874 290a 2020 2020 2020 2020 6966 206d  xt).        if m
-000072d0: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
-000072e0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-000072f0: 2020 2020 2020 2069 6420 3d20 6d61 7463         id = matc
-00007300: 682e 6772 6f75 7028 2769 6427 290a 2020  h.group('id').  
-00007310: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00007320: 762e 6174 7472 6962 5b22 7469 746c 6522  v.attrib["title"
-00007330: 5d20 3d20 6964 0a20 2020 2020 2020 2020  ] = id.         
-00007340: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-00007350: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-00007360: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00007370: 6622 6661 696c 6564 2074 6f20 6d61 7463  f"failed to matc
-00007380: 6820 6964 2069 6e20 7b72 6567 6578 7d22  h id in {regex}"
-00007390: 290a 2020 2020 2020 2020 2020 2020 6469  ).            di
-000073a0: 762e 6174 7472 6962 5b22 636c 6173 7322  v.attrib["class"
-000073b0: 5d20 3d20 7365 6374 696f 6e5f 636c 6173  ] = section_clas
-000073c0: 730a 0a0a 2020 2020 4063 6c61 7373 6d65  s...    @classme
-000073d0: 7468 6f64 0a20 2020 2064 6566 2061 6e6e  thod.    def ann
-000073e0: 6f74 6174 655f 7469 746c 655f 7365 6374  otate_title_sect
-000073f0: 696f 6e73 2863 6c73 2c20 6874 6d6c 5f65  ions(cls, html_e
-00007400: 6c65 6d2c 2073 6563 7469 6f6e 5f72 6567  lem, section_reg
-00007410: 6578 6573 3d4e 6f6e 6529 3a0a 2020 2020  exes=None):.    
-00007420: 2020 2020 6966 2073 6563 7469 6f6e 5f72      if section_r
-00007430: 6567 6578 6573 2069 7320 4e6f 6e65 3a0a  egexes is None:.
-00007440: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00007450: 6520 5661 6c75 6545 7272 6f72 2822 6d75  e ValueError("mu
-00007460: 7374 2068 6176 6520 7365 6374 696f 6e5f  st have section_
-00007470: 7265 6765 7865 7320 6172 6775 6d65 6e74  regexes argument
-00007480: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-00007490: 2074 6869 7320 6f6e 6c79 2077 6f72 6b73   this only works
-000074a0: 2066 6f72 2049 5043 4320 6472 6166 740a   for IPCC draft.
-000074b0: 2020 2020 2020 2020 2020 2020 2320 7365              # se
-000074c0: 6374 696f 6e5f 7265 6765 7865 7320 3d20  ction_regexes = 
-000074d0: 5b0a 2020 2020 2020 2020 2020 2020 2320  [.            # 
-000074e0: 2020 2020 2822 7365 6374 696f 6e22 2c20      ("section", 
-000074f0: 2253 6563 7469 6f6e 5c73 2a28 3f50 3c69  "Section\s*(?P<i
-00007500: 643e 5c64 293a 5c73 2b2e 2a22 292c 0a20  d>\d):\s+.*"),. 
-00007510: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00007520: 2028 2273 7562 5f73 6563 7469 6f6e 222c   ("sub_section",
-00007530: 2022 283f 503c 6964 3e5c 642b 5c2e 5c64   "(?P<id>\d+\.\d
-00007540: 2b29 5c73 2e2a 2229 2c0a 2020 2020 2020  +)\s.*"),.      
-00007550: 2020 2020 2020 2320 2020 2020 2822 7375        #     ("su
-00007560: 625f 7375 625f 7365 6374 696f 6e22 2c20  b_sub_section", 
-00007570: 2228 3f50 3c69 643e 5c64 2b5c 2e5c 642b  "(?P<id>\d+\.\d+
-00007580: 5c2e 5c64 2b29 5c73 2e2a 2229 0a20 2020  \.\d+)\s.*").   
-00007590: 2020 2020 2020 2020 2023 205d 0a0a 2020           # ]..  
-000075a0: 2020 2020 2020 626f 6479 203d 2048 746d        body = Htm
-000075b0: 6c4c 6962 2e67 6574 5f62 6f64 7928 6874  lLib.get_body(ht
-000075c0: 6d6c 5f65 6c65 6d29 0a20 2020 2020 2020  ml_elem).       
-000075d0: 2066 6f72 2064 6976 2069 6e20 626f 6479   for div in body
-000075e0: 2e78 7061 7468 2822 2e2f 2f64 6976 2229  .xpath(".//div")
-000075f0: 3a0a 2020 2020 2020 2020 2020 2020 7465  :.            te
-00007600: 7874 203d 2027 272e 6a6f 696e 2864 6976  xt = ''.join(div
-00007610: 2e69 7465 7274 6578 7428 2929 0a0a 2020  .itertext())..  
-00007620: 2020 2020 2020 2020 2020 666f 7220 7365            for se
-00007630: 6374 696f 6e5f 7265 6765 7820 696e 2073  ction_regex in s
-00007640: 6563 7469 6f6e 5f72 6567 6578 6573 3a0a  ection_regexes:.
-00007650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007660: 7365 6374 696f 6e5f 636c 6173 7320 3d20  section_class = 
-00007670: 7365 6374 696f 6e5f 7265 6765 785b 305d  section_regex[0]
-00007680: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007690: 2072 6567 6578 203d 204e 6f6e 6520 6966   regex = None if
-000076a0: 206e 6f74 2073 6563 7469 6f6e 5f72 6567   not section_reg
-000076b0: 6578 2065 6c73 6520 7365 6374 696f 6e5f  ex else section_
-000076c0: 7265 6765 785b 315d 0a20 2020 2020 2020  regex[1].       
-000076d0: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-000076e0: 7265 6765 783a 0a20 2020 2020 2020 2020  regex:.         
-000076f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00007700: 2866 224e 4f20 5245 4745 583a 2072 6567  (f"NO REGEX: reg
-00007710: 6578 2069 6e20 7365 6374 696f 6e5f 7265  ex in section_re
-00007720: 6765 7820 7b73 6563 7469 6f6e 5f72 6567  gex {section_reg
-00007730: 6578 7d22 290a 2020 2020 2020 2020 2020  ex}").          
-00007740: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00007750: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00007760: 2020 2063 6c73 2e6d 6174 6368 5f72 6567     cls.match_reg
-00007770: 6578 2864 6976 2c20 7265 6765 782c 2073  ex(div, regex, s
-00007780: 6563 7469 6f6e 5f63 6c61 7373 2c20 7465  ection_class, te
-00007790: 7874 290a 0a20 2020 2040 636c 6173 736d  xt)..    @classm
-000077a0: 6574 686f 640a 2020 2020 6465 6620 636f  ethod.    def co
-000077b0: 6c6c 6563 745f 666c 6f61 7473 5f74 6f5f  llect_floats_to_
-000077c0: 6261 636b 2863 6c73 2c20 6874 6d6c 5f65  back(cls, html_e
-000077d0: 6c65 6d29 3a0a 2020 2020 2020 2020 6261  lem):.        ba
-000077e0: 636b 203d 2048 746d 6c47 726f 7570 2e67  ck = HtmlGroup.g
-000077f0: 6574 5f62 6163 6b5f 6469 7628 6874 6d6c  et_back_div(html
-00007800: 5f65 6c65 6d29 0a20 2020 2020 2020 2066  _elem).        f
-00007810: 6c6f 6174 7320 3d20 6874 6d6c 5f65 6c65  loats = html_ele
-00007820: 6d2e 7870 6174 6828 222e 2f2f 6469 765b  m.xpath(".//div[
-00007830: 4063 6c61 7373 3d27 666c 6f61 7427 5d22  @class='float']"
-00007840: 290a 2020 2020 2020 2020 6c6f 6767 6572  ).        logger
-00007850: 2e64 6562 7567 2866 2266 6c6f 6174 7320  .debug(f"floats 
-00007860: 7b6c 656e 2866 6c6f 6174 7329 7d22 290a  {len(floats)}").
-00007870: 2020 2020 2020 2020 666f 7220 666c 6f61          for floa
-00007880: 7420 696e 2066 6c6f 6174 733a 0a20 2020  t in floats:.   
-00007890: 2020 2020 2020 2020 2062 6163 6b2e 6170           back.ap
-000078a0: 7065 6e64 2866 6c6f 6174 290a 0a20 2020  pend(float)..   
-000078b0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-000078c0: 2020 6465 6620 6372 6561 7465 5f62 6163    def create_bac
-000078d0: 6b5f 6469 7628 636c 732c 2068 746d 6c5f  k_div(cls, html_
-000078e0: 656c 656d 293a 0a20 2020 2020 2020 2062  elem):.        b
-000078f0: 6163 6b20 3d20 4554 2e53 7562 456c 656d  ack = ET.SubElem
-00007900: 656e 7428 4874 6d6c 4c69 622e 6765 745f  ent(HtmlLib.get_
-00007910: 626f 6479 2868 746d 6c5f 656c 656d 292c  body(html_elem),
-00007920: 2022 6469 7622 290a 2020 2020 2020 2020   "div").        
-00007930: 6261 636b 2e61 7474 7269 625b 2263 6c61  back.attrib["cla
-00007940: 7373 225d 203d 2022 6261 636b 220a 2020  ss"] = "back".  
-00007950: 2020 2020 2020 6261 636b 2e61 7474 7269        back.attri
-00007960: 625b 2274 6974 6c65 225d 203d 2022 6261  b["title"] = "ba
-00007970: 636b 206d 6174 7465 7222 0a20 2020 2020  ck matter".     
-00007980: 2020 2062 6163 6b2e 6174 7472 6962 5b22     back.attrib["
-00007990: 7374 796c 6522 5d20 3d20 2262 6163 6b67  style"] = "backg
-000079a0: 726f 756e 643a 2023 6666 6666 6464 3b20  round: #ffffdd; 
-000079b0: 626f 7264 6572 3a20 736f 6c69 6420 7075  border: solid pu
-000079c0: 7270 6c65 2031 2e35 7078 3b20 6d61 7267  rple 1.5px; marg
-000079d0: 696e 3a20 3270 783b 220a 2020 2020 2020  in: 2px;".      
-000079e0: 2020 6261 636b 5f74 6974 6c65 203d 2045    back_title = E
-000079f0: 542e 5375 6245 6c65 6d65 6e74 2862 6163  T.SubElement(bac
-00007a00: 6b2c 2022 6469 7622 290a 2020 2020 2020  k, "div").      
-00007a10: 2020 6261 636b 5f74 6974 6c65 2e74 6578    back_title.tex
-00007a20: 7420 3d20 2242 6163 6b20 4d61 7474 6572  t = "Back Matter
-00007a30: 2c20 466f 6f74 6e6f 7465 732c 2046 6967  , Footnotes, Fig
-00007a40: 7572 6573 2c20 5461 626c 6573 2c20 426f  ures, Tables, Bo
-00007a50: 7865 7322 0a20 2020 2020 2020 2062 6163  xes".        bac
-00007a60: 6b5f 7469 746c 652e 6174 7472 6962 5b22  k_title.attrib["
-00007a70: 7374 796c 6522 5d20 3d20 2266 6f6e 742d  style"] = "font-
-00007a80: 7369 7a65 3a20 3230 7078 3b20 666f 6e74  size: 20px; font
-00007a90: 2d66 616d 696c 793a 2073 616e 7365 7269  -family: sanseri
-00007aa0: 663b 220a 2020 2020 2020 2020 7265 7475  f;".        retu
-00007ab0: 726e 2062 6163 6b0a 0a20 2020 2040 636c  rn back..    @cl
-00007ac0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00007ad0: 6620 6765 745f 6261 636b 5f64 6976 2863  f get_back_div(c
-00007ae0: 6c73 2c20 6874 6d6c 5f65 6c65 6d29 3a0a  ls, html_elem):.
-00007af0: 2020 2020 2020 2020 2222 2267 6574 206f          """get o
-00007b00: 7220 6372 6561 7465 2062 6f64 792f 6469  r create body/di
-00007b10: 765b 4063 6c61 7373 3d27 6261 636b 275d  v[@class='back']
-00007b20: 2222 220a 2020 2020 2020 2020 6261 636b  """.        back
-00007b30: 7320 3d20 4874 6d6c 4c69 622e 6765 745f  s = HtmlLib.get_
-00007b40: 626f 6479 2868 746d 6c5f 656c 656d 292e  body(html_elem).
-00007b50: 7870 6174 6828 222e 2f64 6976 5b63 6c61  xpath("./div[cla
-00007b60: 7373 3d27 6261 636b 275d 2229 0a20 2020  ss='back']").   
-00007b70: 2020 2020 2072 6574 7572 6e20 6261 636b       return back
-00007b80: 735b 305d 2069 6620 6c65 6e28 6261 636b  s[0] if len(back
-00007b90: 7329 203e 2030 2065 6c73 6520 4874 6d6c  s) > 0 else Html
-00007ba0: 4772 6f75 702e 6372 6561 7465 5f62 6163  Group.create_bac
-00007bb0: 6b5f 6469 7628 6874 6d6c 5f65 6c65 6d29  k_div(html_elem)
-00007bc0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00007bd0: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
-00007be0: 655f 6865 6164 5f73 7479 6c65 5f65 6c65  e_head_style_ele
-00007bf0: 6d28 636c 732c 206e 6577 5f68 746d 6c2c  m(cls, new_html,
-00007c00: 2074 6169 6c3d 225a 5a5a 2229 3a0a 2020   tail="ZZZ"):.  
-00007c10: 2020 2020 2020 7374 796c 6520 3d20 4554        style = ET
-00007c20: 2e53 7562 456c 656d 656e 7428 4874 6d6c  .SubElement(Html
-00007c30: 4c69 622e 6765 745f 6865 6164 286e 6577  Lib.get_head(new
-00007c40: 5f68 746d 6c29 2c20 4353 5353 7479 6c65  _html), CSSStyle
-00007c50: 2e53 5459 4c45 290a 2020 2020 2020 2020  .STYLE).        
-00007c60: 6966 2074 6169 6c3a 0a20 2020 2020 2020  if tail:.       
-00007c70: 2020 2020 2073 7479 6c65 2e74 6169 6c20       style.tail 
-00007c80: 3d20 7461 696c 0a20 2020 2020 2020 2023  = tail.        #
-00007c90: 2062 6173 6963 2073 7479 6c69 6e67 2074   basic styling t
-00007ca0: 6f20 7368 6f77 2064 6976 7320 616e 6420  o show divs and 
-00007cb0: 7370 616e 730a 2020 2020 2020 2020 7374  spans.        st
-00007cc0: 796c 652e 7465 7874 203d 2022 2222 0a20  yle.text = """. 
-00007cd0: 2020 2020 2020 2064 6976 207b 626f 7264         div {bord
-00007ce0: 6572 3a20 7265 6420 736f 6c69 6420 3170  er: red solid 1p
-00007cf0: 783b 206d 6172 6769 6e3a 2031 7078 3b7d  x; margin: 1px;}
-00007d00: 0a20 2020 2020 2020 2073 7061 6e20 7b62  .        span {b
-00007d10: 6163 6b67 726f 756e 643a 2023 6565 6565  ackground: #eeee
-00007d20: 6565 3b20 6d61 7267 696e 3a20 3170 783b  ee; margin: 1px;
-00007d30: 7d0a 2020 2020 2020 2020 6469 762e 666c  }.        div.fl
-00007d40: 6f61 7420 7b62 6163 6b67 726f 756e 643a  oat {background:
-00007d50: 2023 6464 6666 6666 3b7d 0a20 2020 2020   #ddffff;}.     
-00007d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007d70: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-00007d80: 726e 2073 7479 6c65 0a0a 2020 2020 4063  rn style..    @c
-00007d90: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00007da0: 6566 2065 7874 7261 6374 5f66 6f6f 746e  ef extract_footn
-00007db0: 6f74 6573 5f74 6f5f 6261 636b 2863 6c73  otes_to_back(cls
-00007dc0: 2c20 6874 6d6c 5f65 6c65 6d29 3a0a 2020  , html_elem):.  
-00007dd0: 2020 2020 2020 4874 6d6c 5574 696c 2e65        HtmlUtil.e
-00007de0: 7874 7261 6374 5f66 6f6f 746e 6f74 6573  xtract_footnotes
-00007df0: 2868 746d 6c5f 656c 656d 2c20 2266 6f6e  (html_elem, "fon
-00007e00: 742d 7369 7a65 3a20 362e 3022 290a 0a20  t-size: 6.0").. 
-00007e10: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00007e20: 2020 2020 6465 6620 7265 6d6f 7665 5f65      def remove_e
-00007e30: 6d70 7479 5f64 6976 7328 636c 732c 2065  mpty_divs(cls, e
-00007e40: 6c65 6d29 3a0a 2020 2020 2020 2020 6469  lem):.        di
-00007e50: 7673 203d 2065 6c65 6d2e 7870 6174 6828  vs = elem.xpath(
-00007e60: 222e 2f2f 6469 7622 290a 2020 2020 2020  ".//div").      
-00007e70: 2020 666f 7220 6469 7620 696e 2064 6976    for div in div
-00007e80: 733a 0a20 2020 2020 2020 2020 2020 2074  s:.            t
-00007e90: 6578 7420 3d20 2727 2e6a 6f69 6e28 6469  ext = ''.join(di
-00007ea0: 762e 6974 6572 7465 7874 2829 290a 2020  v.itertext()).  
-00007eb0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00007ec0: 2074 6578 743a 0a20 2020 2020 2020 2020   text:.         
-00007ed0: 2020 2020 2020 2064 6976 2e67 6574 7061         div.getpa
-00007ee0: 7265 6e74 2829 2e72 656d 6f76 6528 6469  rent().remove(di
-00007ef0: 7629 0a0a 2020 2020 4063 6c61 7373 6d65  v)..    @classme
-00007f00: 7468 6f64 0a20 2020 2064 6566 206a 6f69  thod.    def joi
-00007f10: 6e5f 7370 6c69 745f 6469 7673 2863 6c73  n_split_divs(cls
-00007f20: 2c20 746f 705f 6469 7629 3a0a 2020 2020  , top_div):.    
-00007f30: 2020 2020 6469 7673 203d 2074 6f70 5f64      divs = top_d
-00007f40: 6976 2e78 7061 7468 2822 2e2f 2f64 6976  iv.xpath(".//div
-00007f50: 2229 0a20 2020 2020 2020 2066 6f72 2069  ").        for i
-00007f60: 2c20 6469 7620 696e 2065 6e75 6d65 7261  , div in enumera
-00007f70: 7465 2864 6976 7329 3a0a 2020 2020 2020  te(divs):.      
-00007f80: 2020 2020 2020 6966 2069 203e 2030 3a0a        if i > 0:.
-00007f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007fa0: 6469 7630 203d 2064 6976 735b 6920 2d20  div0 = divs[i - 
-00007fb0: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
-00007fc0: 2020 2073 7061 6e30 203d 2048 746d 6c47     span0 = HtmlG
-00007fd0: 726f 7570 2e67 6574 5f6c 6173 745f 7370  roup.get_last_sp
-00007fe0: 616e 2864 6976 3029 0a20 2020 2020 2020  an(div0).       
-00007ff0: 2020 2020 2020 2020 2073 7061 6e31 203d           span1 =
-00008000: 2048 746d 6c47 726f 7570 2e67 6574 5f66   HtmlGroup.get_f
-00008010: 6972 7374 5f73 7061 6e28 6469 7629 0a20  irst_span(div). 
-00008020: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00008030: 6620 7370 616e 3020 6973 206e 6f74 204e  f span0 is not N
-00008040: 6f6e 6520 616e 6420 7370 616e 3120 6973  one and span1 is
-00008050: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-00008060: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00008070: 7479 6c65 3020 3d20 4353 5353 7479 6c65  tyle0 = CSSStyle
-00008080: 2e63 7265 6174 655f 6373 735f 7374 796c  .create_css_styl
-00008090: 655f 6672 6f6d 5f61 7474 7269 6275 7465  e_from_attribute
-000080a0: 5f6f 665f 626f 6479 5f65 6c65 6d65 6e74  _of_body_element
-000080b0: 2873 7061 6e30 290a 2020 2020 2020 2020  (span0).        
-000080c0: 2020 2020 2020 2020 2020 2020 7374 796c              styl
-000080d0: 6531 203d 2043 5353 5374 796c 652e 6372  e1 = CSSStyle.cr
-000080e0: 6561 7465 5f63 7373 5f73 7479 6c65 5f66  eate_css_style_f
-000080f0: 726f 6d5f 6174 7472 6962 7574 655f 6f66  rom_attribute_of
-00008100: 5f62 6f64 795f 656c 656d 656e 7428 7370  _body_element(sp
-00008110: 616e 3029 0a20 2020 2020 2020 2020 2020  an0).           
-00008120: 2020 2020 2020 2020 2069 6620 7374 796c           if styl
-00008130: 6530 203d 3d20 7374 796c 6531 3a0a 2020  e0 == style1:.  
-00008140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008150: 2020 2020 2020 6966 2073 7061 6e31 2069        if span1 i
-00008160: 7320 6e6f 7420 4e6f 6e65 2061 6e64 206c  s not None and l
-00008170: 656e 2873 7061 6e31 2e74 6578 7429 203e  en(span1.text) >
-00008180: 2030 2061 6e64 2073 7061 6e31 2e74 6578   0 and span1.tex
-00008190: 745b 305d 2e69 736c 6f77 6572 2829 3a0a  t[0].islower():.
-000081a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000081b0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-000081c0: 696e 7428 6622 206a 6f69 6e65 6420 7365  int(f" joined se
-000081d0: 636f 6e64 5f73 7061 6e20 7b73 7061 6e31  cond_span {span1
-000081e0: 2e74 6578 747d 2229 0a20 2020 2020 2020  .text}").       
-000081f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008200: 2020 2020 2048 746d 6c55 7469 6c2e 6a6f       HtmlUtil.jo
-00008210: 696e 5f73 7061 6e73 5f69 6e5f 7361 6d65  in_spans_in_same
-00008220: 5f64 6976 2873 7061 6e30 2c20 7370 616e  _div(span0, span
-00008230: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
-00008240: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00008250: 6f72 2073 7061 6e20 696e 2064 6976 2e78  or span in div.x
-00008260: 7061 7468 2822 2e2f 7370 616e 2229 3a0a  path("./span"):.
-00008270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003080: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00003090: 6974 6c65 3d22 7061 6765 206e 756d 6265  itle="page numbe
+000030a0: 7220 626f 7865 7320 756e 6465 7220 626f  r boxes under bo
+000030b0: 6479 2f73 7061 6e22 2c20 7261 6e67 653d  dy/span", range=
+000030c0: 7261 6e67 6573 5b34 5d29 0a0a 2020 2020  ranges[4])..    
+000030d0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+000030e0: 2064 6566 2064 6562 7567 5f62 795f 7870   def debug_by_xp
+000030f0: 6174 6828 636c 732c 2065 6c65 6d2c 2078  ath(cls, elem, x
+00003100: 7061 7468 2c20 7469 746c 653d 4e6f 6e65  path, title=None
+00003110: 2c20 7261 6e67 653d 4e6f 6e65 2920 2d3e  , range=None) ->
+00003120: 2069 6e74 3a0a 2020 2020 2020 2020 2222   int:.        ""
+00003130: 220a 2020 2020 2020 2020 6170 706c 6965  ".        applie
+00003140: 7320 7870 6174 6820 616e 6420 7072 696e  s xpath and prin
+00003150: 7473 2064 6562 7567 390a 2020 2020 2020  ts debug9.      
+00003160: 2020 6173 7365 7274 0a20 2020 2020 2020    assert.       
+00003170: 203a 7061 7261 6d20 656c 656d 3a20 746f   :param elem: to
+00003180: 2064 6562 7567 0a20 2020 2020 2020 203a   debug.        :
+00003190: 7061 7261 6d20 7870 6174 683a 2074 6f20  param xpath: to 
+000031a0: 6465 6275 6720 7769 7468 0a20 2020 2020  debug with.     
+000031b0: 2020 203a 7265 7475 726e 3a20 7870 6174     :return: xpat
+000031c0: 6820 636f 756e 740a 2020 2020 2020 2020  h count.        
+000031d0: 2222 220a 2020 2020 2020 2020 7370 616e  """.        span
+000031e0: 7320 3d20 656c 656d 2e78 7061 7468 2878  s = elem.xpath(x
+000031f0: 7061 7468 290a 2020 2020 2020 2020 6966  path).        if
+00003200: 2072 616e 6765 3a0a 2020 2020 2020 2020   range:.        
+00003210: 2020 2020 6173 7365 7274 2072 616e 6765      assert range
+00003220: 5b30 5d20 3c3d 206c 656e 2873 7061 6e73  [0] <= len(spans
+00003230: 2920 3c3d 2072 616e 6765 5b31 5d2c 2066  ) <= range[1], f
+00003240: 227b 2727 2069 6620 6e6f 7420 7469 746c  "{'' if not titl
+00003250: 6520 656c 7365 2074 6974 6c65 7d3a 2066  e else title}: f
+00003260: 6f75 6e64 3a20 7b6c 656e 2873 7061 6e73  ound: {len(spans
+00003270: 297d 220a 2020 2020 2020 2020 7265 7475  )}".        retu
+00003280: 726e 206c 656e 2873 7061 6e73 290a 0a20  rn len(spans).. 
+00003290: 2020 2064 6566 2061 6464 5f65 6c65 6d65     def add_eleme
+000032a0: 6e74 2873 656c 662c 2065 6c65 6d29 3a0a  nt(self, elem):.
+000032b0: 2020 2020 2020 2020 7365 6c66 2e65 6c65          self.ele
+000032c0: 6d65 6e74 203d 2065 6c65 6d0a 0a20 2020  ment = elem..   
+000032d0: 2064 6566 2061 6464 5f64 6573 6365 6e64   def add_descend
+000032e0: 616e 745f 656c 656d 656e 745f 746f 5f72  ant_element_to_r
+000032f0: 656d 6f76 6528 7365 6c66 2c20 6465 7363  emove(self, desc
+00003300: 656e 6461 6e74 5f65 6c65 6d29 3a0a 2020  endant_elem):.  
+00003310: 2020 2020 2020 4874 6d6c 5469 6479 2e61        HtmlTidy.a
+00003320: 6464 5f65 6c65 6d65 6e74 735f 746f 5f73  dd_elements_to_s
+00003330: 746f 7265 2864 6573 6365 6e64 616e 745f  tore(descendant_
+00003340: 656c 656d 2c20 7365 6c66 2e64 6573 6365  elem, self.desce
+00003350: 6e64 616e 7473 5f74 6f5f 7265 6d6f 7665  ndants_to_remove
+00003360: 290a 0a20 2020 2064 6566 2061 6464 5f73  )..    def add_s
+00003370: 7479 6c65 735f 746f 5f72 656d 6f76 6528  tyles_to_remove(
+00003380: 7365 6c66 2c20 7374 796c 6529 3a0a 2020  self, style):.  
+00003390: 2020 2020 2020 7365 6c66 2e73 7479 6c65        self.style
+000033a0: 735f 746f 5f72 656d 6f76 652e 6170 7065  s_to_remove.appe
+000033b0: 6e64 2873 7479 6c65 290a 0a20 2020 2064  nd(style)..    d
+000033c0: 6566 2061 6464 5f65 6d70 7479 5f65 6c65  ef add_empty_ele
+000033d0: 6d65 6e74 735f 746f 5f72 656d 6f76 6528  ments_to_remove(
+000033e0: 7365 6c66 2c20 656c 656d 735f 746f 5f72  self, elems_to_r
+000033f0: 656d 6f76 6529 3a0a 2020 2020 2020 2020  emove):.        
+00003400: 4874 6d6c 5469 6479 2e61 6464 5f65 6c65  HtmlTidy.add_ele
+00003410: 6d65 6e74 735f 746f 5f73 746f 7265 2865  ments_to_store(e
+00003420: 6c65 6d73 5f74 6f5f 7265 6d6f 7665 2c20  lems_to_remove, 
+00003430: 7365 6c66 2e65 6d70 7479 5f65 6c65 6d65  self.empty_eleme
+00003440: 6e74 735f 746f 5f72 656d 6f76 6529 0a0a  nts_to_remove)..
+00003450: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00003460: 0a20 2020 2064 6566 2061 6464 5f65 6c65  .    def add_ele
+00003470: 6d65 6e74 735f 746f 5f73 746f 7265 2863  ments_to_store(c
+00003480: 6c73 2c20 656c 656d 735f 746f 5f73 746f  ls, elems_to_sto
+00003490: 7265 2c20 656c 656d 5f73 746f 7261 6765  re, elem_storage
+000034a0: 293a 0a20 2020 2020 2020 2069 6620 656c  ):.        if el
+000034b0: 656d 735f 746f 5f73 746f 7265 2069 7320  ems_to_store is 
+000034c0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000034d0: 2020 2020 2020 6966 206e 6f74 2074 7970        if not typ
+000034e0: 6528 656c 656d 735f 746f 5f73 746f 7265  e(elems_to_store
+000034f0: 2920 6973 206c 6973 743a 0a20 2020 2020  ) is list:.     
+00003500: 2020 2020 2020 2020 2020 2065 6c65 6d73             elems
+00003510: 5f74 6f5f 7374 6f72 6520 3d20 6c69 7374  _to_store = list
+00003520: 2865 6c65 6d73 5f74 6f5f 7374 6f72 6529  (elems_to_store)
+00003530: 0a20 2020 2020 2020 2020 2020 2065 6c65  .            ele
+00003540: 6d5f 7374 6f72 6167 652e 6578 7465 6e64  m_storage.extend
+00003550: 2865 6c65 6d73 5f74 6f5f 7374 6f72 6529  (elems_to_store)
+00003560: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00003570: 6f64 0a20 2020 2064 6566 2065 6e73 7572  od.    def ensur
+00003580: 655f 6874 6d6c 5f68 6561 645f 626f 6479  e_html_head_body
+00003590: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d29  (cls, html_elem)
+000035a0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000035b0: 2020 2020 2020 6164 6473 203c 6874 6d6c        adds <html
+000035c0: 3e2c 203c 6865 6164 3e2c 203c 626f 6479  >, <head>, <body
+000035d0: 3e20 6966 206e 6f74 2070 7265 7365 6e74  > if not present
+000035e0: 0a20 2020 2020 2020 204d 6f76 6520 746f  .        Move to
+000035f0: 2048 544d 4c54 6964 790a 2020 2020 2020   HTMLTidy.      
+00003600: 2020 2222 220a 2020 2020 2020 2020 6874    """.        ht
+00003610: 6d6c 5f65 6c65 6d20 3d20 636c 732e 5f65  ml_elem = cls._e
+00003620: 6e73 7572 655f 6874 6d6c 5f72 6f6f 7428  nsure_html_root(
+00003630: 6874 6d6c 5f65 6c65 6d29 0a20 2020 2020  html_elem).     
+00003640: 2020 2068 746d 6c5f 7769 7468 5f68 6561     html_with_hea
+00003650: 6420 3d20 636c 732e 5f65 6e73 7572 655f  d = cls._ensure_
+00003660: 6865 6164 626f 6479 2868 746d 6c5f 656c  headbody(html_el
+00003670: 656d 2c20 2268 6561 6422 2c20 3029 0a20  em, "head", 0). 
+00003680: 2020 2020 2020 2068 746d 6c5f 7769 7468         html_with
+00003690: 5f68 6561 645f 626f 6479 203d 2063 6c73  _head_body = cls
+000036a0: 2e5f 656e 7375 7265 5f68 6561 6462 6f64  ._ensure_headbod
+000036b0: 7928 6874 6d6c 5f77 6974 685f 6865 6164  y(html_with_head
+000036c0: 2c20 2262 6f64 7922 2c20 3129 0a20 2020  , "body", 1).   
+000036d0: 2020 2020 2068 746d 6c5f 6964 6561 6c20       html_ideal 
+000036e0: 3d20 636c 732e 5f74 6964 795f 6e6f 6e5f  = cls._tidy_non_
+000036f0: 6865 6164 5f62 6f64 795f 6368 696c 6472  head_body_childr
+00003700: 656e 2868 746d 6c5f 7769 7468 5f68 6561  en(html_with_hea
+00003710: 645f 626f 6479 290a 2020 2020 2020 2020  d_body).        
+00003720: 7265 7475 726e 2068 746d 6c5f 6964 6561  return html_idea
+00003730: 6c0a 0a20 2020 2040 636c 6173 736d 6574  l..    @classmet
+00003740: 686f 640a 2020 2020 6465 6620 5f65 6e73  hod.    def _ens
+00003750: 7572 655f 6865 6164 626f 6479 2863 6c73  ure_headbody(cls
+00003760: 2c20 6874 6d6c 5f72 6f6f 742c 2074 6167  , html_root, tag
+00003770: 2c20 706f 7329 3a0a 2020 2020 2020 2020  , pos):.        
+00003780: 6465 7363 656e 6473 203d 206c 656e 2868  descends = len(h
+00003790: 746d 6c5f 726f 6f74 2e78 7061 7468 2866  tml_root.xpath(f
+000037a0: 222e 2f2f 7b74 6167 7d22 2929 0a20 2020  ".//{tag}")).   
+000037b0: 2020 2020 2069 6620 6465 7363 656e 6473       if descends
+000037c0: 203e 2031 3a0a 2020 2020 2020 2020 2020   > 1:.          
+000037d0: 2020 6c6f 6767 696e 672e 7761 726e 696e    logging.warnin
+000037e0: 6728 6622 6d6f 7265 2074 6861 6e20 3120  g(f"more than 1 
+000037f0: 7b74 6167 7d3b 2063 616e 6e6f 7420 7072  {tag}; cannot pr
+00003800: 6f63 6573 7322 290a 2020 2020 2020 2020  ocess").        
+00003810: 656c 6966 2064 6573 6365 6e64 7320 3d3d  elif descends ==
+00003820: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00003830: 2320 6f6e 6520 7461 672c 206f 6b0a 2020  # one tag, ok.  
+00003840: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+00003850: 2020 2020 2020 2065 6c69 6620 6465 7363         elif desc
+00003860: 656e 6473 203d 3d20 303a 0a20 2020 2020  ends == 0:.     
+00003870: 2020 2020 2020 2068 6561 6420 3d20 4554         head = ET
+00003880: 2e45 6c65 6d65 6e74 2874 6167 290a 2020  .Element(tag).  
+00003890: 2020 2020 2020 2020 2020 6874 6d6c 5f72            html_r
+000038a0: 6f6f 742e 696e 7365 7274 2870 6f73 2c20  oot.insert(pos, 
+000038b0: 6865 6164 290a 2020 2020 2020 2020 7265  head).        re
+000038c0: 7475 726e 2068 746d 6c5f 726f 6f74 0a0a  turn html_root..
+000038d0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+000038e0: 0a20 2020 2064 6566 205f 656e 7375 7265  .    def _ensure
+000038f0: 5f68 746d 6c5f 726f 6f74 2863 6c73 2c20  _html_root(cls, 
+00003900: 6874 6d6c 5f65 6c65 6d29 3a0a 2020 2020  html_elem):.    
+00003910: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00003920: 6966 2072 6f6f 7420 656c 656d 656e 7420  if root element 
+00003930: 6973 206e 6f74 203c 6874 6d6c 3e20 6372  is not <html> cr
+00003940: 6561 7465 7320 6f6e 6520 616e 6420 7472  eates one and tr
+00003950: 616e 7366 6572 7320 6368 696c 6472 656e  ansfers children
+00003960: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00003970: 6874 6d6c 5f65 6c65 6d3a 206f 6c64 2045  html_elem: old E
+00003980: 6c65 6d65 6e74 5472 6565 206f 7220 726f  lementTree or ro
+00003990: 6f74 2045 6c65 6d65 6e74 0a20 2020 2020  ot Element.     
+000039a0: 2020 2022 2222 0a20 2020 2020 2020 206f     """.        o
+000039b0: 6c64 5f72 6f6f 7420 3d20 6874 6d6c 5f65  ld_root = html_e
+000039c0: 6c65 6d2e 6765 7472 6f6f 7428 2920 6966  lem.getroot() if
+000039d0: 2074 7970 6528 6874 6d6c 5f65 6c65 6d29   type(html_elem)
+000039e0: 2069 7320 5f45 6c65 6d65 6e74 5472 6565   is _ElementTree
+000039f0: 2065 6c73 6520 6874 6d6c 5f65 6c65 6d0a   else html_elem.
+00003a00: 2020 2020 2020 2020 6874 6d6c 7320 3d20          htmls = 
+00003a10: 6874 6d6c 5f65 6c65 6d2e 7870 6174 6828  html_elem.xpath(
+00003a20: 222f 6874 6d6c 2229 0a20 2020 2020 2020  "/html").       
+00003a30: 2069 6620 6c65 6e28 6874 6d6c 7329 203d   if len(htmls) =
+00003a40: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00003a50: 2068 746d 6c5f 726f 6f74 203d 2045 542e   html_root = ET.
+00003a60: 456c 656d 656e 7428 2268 746d 6c22 290a  Element("html").
+00003a70: 2020 2020 2020 2020 2020 2020 6874 6d6c              html
+00003a80: 5f72 6f6f 742e 696e 7365 7274 2830 2c20  _root.insert(0, 
+00003a90: 6f6c 645f 726f 6f74 290a 2020 2020 2020  old_root).      
+00003aa0: 2020 2020 2020 7265 7475 726e 2068 746d        return htm
+00003ab0: 6c5f 726f 6f74 0a20 2020 2020 2020 2072  l_root.        r
+00003ac0: 6574 7572 6e20 6874 6d6c 5f65 6c65 6d0a  eturn html_elem.
+00003ad0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00003ae0: 640a 2020 2020 6465 6620 5f74 6964 795f  d.    def _tidy_
+00003af0: 6e6f 6e5f 6865 6164 5f62 6f64 795f 6368  non_head_body_ch
+00003b00: 696c 6472 656e 2863 6c73 2c20 6874 6d6c  ildren(cls, html
+00003b10: 5f77 6974 685f 6865 6164 5f62 6f64 7929  _with_head_body)
+00003b20: 3a0a 0a20 2020 2020 2020 2068 6561 645f  :..        head_
+00003b30: 656c 656d 7320 3d20 6874 6d6c 5f77 6974  elems = html_wit
+00003b40: 685f 6865 6164 5f62 6f64 792e 7870 6174  h_head_body.xpat
+00003b50: 6828 4874 6d6c 5469 6479 2e48 4541 445f  h(HtmlTidy.HEAD_
+00003b60: 454c 454d 535f 494e 5f58 5041 5448 290a  ELEMS_IN_XPATH).
+00003b70: 2020 2020 2020 2020 6865 6164 203d 2068          head = h
+00003b80: 746d 6c5f 7769 7468 5f68 6561 645f 626f  tml_with_head_bo
+00003b90: 6479 2e78 7061 7468 2822 6865 6164 2229  dy.xpath("head")
+00003ba0: 5b30 5d0a 2020 2020 2020 2020 666f 7220  [0].        for 
+00003bb0: 656c 656d 2069 6e20 6865 6164 5f65 6c65  elem in head_ele
+00003bc0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
+00003bd0: 6865 6164 2e61 7070 656e 6428 656c 656d  head.append(elem
+00003be0: 290a 2020 2020 2020 2020 7265 7374 5f65  ).        rest_e
+00003bf0: 6c65 6d73 203d 2068 746d 6c5f 7769 7468  lems = html_with
+00003c00: 5f68 6561 645f 626f 6479 2e78 7061 7468  _head_body.xpath
+00003c10: 2822 2a5b 6e6f 7428 6e61 6d65 2829 3d27  ("*[not(name()='
+00003c20: 6865 6164 2729 2061 6e64 206e 6f74 286e  head') and not(n
+00003c30: 616d 6528 293d 2762 6f64 7927 295d 2229  ame()='body')]")
+00003c40: 0a20 2020 2020 2020 2062 6f64 7920 3d20  .        body = 
+00003c50: 6874 6d6c 5f77 6974 685f 6865 6164 5f62  html_with_head_b
+00003c60: 6f64 792e 7870 6174 6828 2262 6f64 7922  ody.xpath("body"
+00003c70: 295b 305d 0a20 2020 2020 2020 2066 6f72  )[0].        for
+00003c80: 2065 6c65 6d20 696e 2072 6573 745f 656c   elem in rest_el
+00003c90: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
+00003ca0: 2062 6f64 792e 6170 7065 6e64 2865 6c65   body.append(ele
+00003cb0: 6d29 0a20 2020 2020 2020 2072 6574 7572  m).        retur
+00003cc0: 6e20 6874 6d6c 5f77 6974 685f 6865 6164  n html_with_head
+00003cd0: 5f62 6f64 790a 0a20 2020 2040 636c 6173  _body..    @clas
+00003ce0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00003cf0: 636f 6e63 6174 656e 6174 655f 7370 616e  concatenate_span
+00003d00: 735f 7769 7468 5f69 6465 6e74 6963 616c  s_with_identical
+00003d10: 5f73 7479 6c65 7328 636c 732c 2065 6c65  _styles(cls, ele
+00003d20: 6d2c 2061 6464 7370 6163 653d 5472 7565  m, addspace=True
+00003d30: 293a 0a0a 2020 2020 2020 2020 2222 220a  ):..        """.
+00003d40: 2020 2020 2020 2020 536f 6d65 7469 6d65          Sometime
+00003d50: 7320 756e 6e65 6365 7373 6172 7920 7370  s unnecessary sp
+00003d60: 616e 7320 6172 6520 6372 6561 7465 6420  ans are created 
+00003d70: 2865 2e67 2e0a 2020 2020 2020 2020 3c73  (e.g..        <s
+00003d80: 7061 6e20 636c 6173 733d 2773 3127 3e66  pan class='s1'>f
+00003d90: 6f6f 3c2f 7370 616e 3e3c 7370 616e 6520  oo</span><spane 
+00003da0: 636c 6173 733d 2273 3122 3e62 6172 3c2f  class="s1">bar</
+00003db0: 7370 616e 3e0a 2020 2020 2020 2020 6372  span>.        cr
+00003dc0: 6561 7465 7320 3c73 7061 6e20 636c 6173  eates <span clas
+00003dd0: 733d 2273 3122 3e66 6f6f 2062 6172 3c2f  s="s1">foo bar</
+00003de0: 7370 616e 3e0a 2020 2020 2020 2020 3a70  span>.        :p
+00003df0: 6172 616d 2065 6c65 6d3a 2070 726f 6261  aram elem: proba
+00003e00: 626c 7920 6120 6469 7620 7769 7468 2063  bly a div with c
+00003e10: 6869 6c64 2073 7061 6e73 0a20 2020 2020  hild spans.     
+00003e20: 2020 203a 7061 7261 6d20 6164 6473 7061     :param addspa
+00003e30: 6365 3a20 696e 7365 7274 2073 7061 6365  ce: insert space
+00003e40: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00003e50: 2020 2020 2073 7061 6e73 203d 2065 6c65       spans = ele
+00003e60: 6d2e 7870 6174 6828 222e 2f73 7061 6e5b  m.xpath("./span[
+00003e70: 4063 6c61 7373 5d22 290a 2020 2020 2020  @class]").      
+00003e80: 2020 6c61 7374 5f73 7061 6e20 3d20 4e6f    last_span = No
+00003e90: 6e65 0a20 2020 2020 2020 2073 7061 6365  ne.        space
+00003ea0: 7320 3d20 2222 2069 6620 6e6f 7420 6164  s = "" if not ad
+00003eb0: 6473 7061 6365 2065 6c73 6520 2220 220a  dspace else " ".
+00003ec0: 2020 2020 2020 2020 666f 7220 7370 616e          for span
+00003ed0: 2069 6e20 7370 616e 733a 0a20 2020 2020   in spans:.     
+00003ee0: 2020 2020 2020 2069 6620 6c61 7374 5f73         if last_s
+00003ef0: 7061 6e20 6973 206e 6f74 204e 6f6e 6520  pan is not None 
+00003f00: 616e 6420 6c61 7374 5f73 7061 6e2e 6174  and last_span.at
+00003f10: 7472 6962 5b22 636c 6173 7322 5d20 3d3d  trib["class"] ==
+00003f20: 2073 7061 6e2e 6174 7472 6962 5b22 636c   span.attrib["cl
+00003f30: 6173 7322 5d3a 0a20 2020 2020 2020 2020  ass"]:.         
+00003f40: 2020 2020 2020 206c 6173 745f 7370 616e         last_span
+00003f50: 2e74 6578 7420 3d20 6c61 7374 5f73 7061  .text = last_spa
+00003f60: 6e2e 7465 7874 202b 2073 7061 6365 7320  n.text + spaces 
+00003f70: 2b20 7370 616e 2e74 6578 740a 2020 2020  + span.text.    
+00003f80: 2020 2020 2020 2020 2020 2020 656c 656d              elem
+00003f90: 2e72 656d 6f76 6528 7370 616e 290a 2020  .remove(span).  
+00003fa0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00003fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003fc0: 6c61 7374 5f73 7061 6e20 3d20 7370 616e  last_span = span
+00003fd0: 0a0a 0a64 6566 2067 6574 5f74 6172 6765  ...def get_targe
+00003fe0: 745f 6872 6566 2874 6172 6765 745f 6964  t_href(target_id
+00003ff0: 293a 0a20 2020 2072 655f 7461 7267 6574  ):.    re_target
+00004000: 203d 2072 652e 636f 6d70 696c 6528 225c   = re.compile("\
+00004010: 5c73 2a28 3f50 3c72 6570 6f72 743e 5747  \s*(?P<report>WG
+00004020: 497c 5747 4949 7c57 4749 4949 7c53 5243  I|WGII|WGIII|SRC
+00004030: 434c 7c53 524f 4343 7c53 5231 357c 5359  CL|SROCC|SR15|SY
+00004040: 5229 5c5c 732b 283f 503c 6368 6170 7465  R)\\s+(?P<chapte
+00004050: 723e 5350 4d7c 5453 295c 5c73 2b28 3f50  r>SPM|TS)\\s+(?P
+00004060: 3c73 6563 7469 6f6e 3e5b 412d 475d 5c5c  <section>[A-G]\\
+00004070: 2e3f 5c5c 642b 283f 3a5c 5c2e 5c5c 642b  .?\\d+(?:\\.\\d+
+00004080: 292a 2922 290a 2020 2020 6769 7468 7562  )*)").    github
+00004090: 5f62 6173 6520 3d20 2268 7474 7073 3a2f  _base = "https:/
+000040a0: 2f68 746d 6c70 7265 7669 6577 2e67 6974  /htmlpreview.git
+000040b0: 6875 622e 696f 2f3f 6874 7470 733a 2f2f  hub.io/?https://
+000040c0: 6769 7468 7562 2e63 6f6d 220a 2020 2020  github.com".    
+000040d0: 776f 726b 696e 675f 7572 6c20 3d20 2268  working_url = "h
+000040e0: 7474 7073 3a2f 2f68 746d 6c70 7265 7669  ttps://htmlprevi
+000040f0: 6577 2e67 6974 6875 622e 696f 2f3f 6874  ew.github.io/?ht
+00004100: 7470 733a 2f2f 6769 7468 7562 2e63 6f6d  tps://github.com
+00004110: 2f70 6574 6572 6d72 2f73 656d 616e 7469  /petermr/semanti
+00004120: 6343 6c69 6d61 7465 2f62 6c6f 622f 6d61  cClimate/blob/ma
+00004130: 696e 2f74 6573 742e 6874 6d6c 220a 2020  in/test.html".  
+00004140: 2020 7265 706f 7274 5f64 6963 7420 3d20    report_dict = 
+00004150: 7b0a 2020 2020 2020 2020 2277 6769 2220  {.        "wgi" 
+00004160: 3a20 2277 6731 222c 0a20 2020 2020 2020  : "wg1",.       
+00004170: 2022 7767 6969 223a 2022 7767 3222 2c0a   "wgii": "wg2",.
+00004180: 2020 2020 2020 2020 2277 6769 6969 223a          "wgiii":
+00004190: 2022 7767 3322 2c0a 2020 2020 7d0a 2020   "wg3",.    }.  
+000041a0: 2020 6872 6566 203d 2022 220a 2020 2020    href = "".    
+000041b0: 6d61 7463 6820 3d20 7265 5f74 6172 6765  match = re_targe
+000041c0: 742e 6d61 7463 6828 7461 7267 6574 5f69  t.match(target_i
+000041d0: 6429 0a20 2020 2069 6620 6d61 7463 683a  d).    if match:
+000041e0: 0a20 2020 2020 2020 2072 6570 6f72 7420  .        report 
+000041f0: 3d20 6d61 7463 682e 6772 6f75 7028 2272  = match.group("r
+00004200: 6570 6f72 7422 292e 6c6f 7765 7228 290a  eport").lower().
+00004210: 2020 2020 2020 2020 7265 706f 7274 3120          report1 
+00004220: 3d20 7265 706f 7274 5f64 6963 742e 6765  = report_dict.ge
+00004230: 7428 7265 706f 7274 290a 2020 2020 2020  t(report).      
+00004240: 2020 7265 706f 7274 203d 2072 6570 6f72    report = repor
+00004250: 7431 2069 6620 7265 706f 7274 3120 656c  t1 if report1 el
+00004260: 7365 2072 6570 6f72 740a 2020 2020 2020  se report.      
+00004270: 2020 6368 6170 7465 7220 3d20 6d61 7463    chapter = matc
+00004280: 682e 6772 6f75 7028 2263 6861 7074 6572  h.group("chapter
+00004290: 2229 2e6c 6f77 6572 2829 0a20 2020 2020  ").lower().     
+000042a0: 2020 2073 6563 7469 6f6e 203d 206d 6174     section = mat
+000042b0: 6368 2e67 726f 7570 2822 7365 6374 696f  ch.group("sectio
+000042c0: 6e22 292e 6c6f 7765 7228 290a 2020 2020  n").lower().    
+000042d0: 2020 2020 6872 6566 203d 2066 227b 6769      href = f"{gi
+000042e0: 7468 7562 5f62 6173 657d 2f70 6574 6572  thub_base}/peter
+000042f0: 6d72 2f73 656d 616e 7469 6343 6c69 6d61  mr/semanticClima
+00004300: 7465 2f62 6c6f 622f 6d61 696e 2f61 7236  te/blob/main/ar6
+00004310: 2f61 7236 2f7b 7265 706f 7274 7d2f 7b63  /ar6/{report}/{c
+00004320: 6861 7074 6572 7d2f 6874 6d6c 2f66 756c  hapter}/html/ful
+00004330: 6c74 6578 742f 6772 6f75 7073 5f67 726f  ltext/groups_gro
+00004340: 7570 732e 6874 6d6c 237b 7365 6374 696f  ups.html#{sectio
+00004350: 6e7d 220a 0a20 2020 2072 6574 7572 6e20  n}"..    return 
+00004360: 6872 6566 0a0a 0a63 6c61 7373 2048 746d  href...class Htm
+00004370: 6c47 726f 7570 3a0a 2020 2020 2222 2267  lGroup:.    """g
+00004380: 726f 7570 7320 7369 626c 696e 6773 2069  roups siblings i
+00004390: 6e74 6f20 6469 7673 2222 220a 0a20 2020  nto divs"""..   
+000043a0: 2044 4546 4155 4c54 5f53 5459 4c45 5320   DEFAULT_STYLES 
+000043b0: 3d20 5b0a 2020 2020 2020 2020 2822 2e73  = [.        (".s
+000043c0: 6563 7469 6f6e 5f74 6974 6c65 222c 205b  ection_title", [
+000043d0: 2822 636f 6c6f 7222 2c20 2272 6564 3b22  ("color", "red;"
+000043e0: 295d 292c 0a20 2020 2020 2020 2028 222e  )]),.        (".
+000043f0: 7375 625f 7365 6374 696f 6e5f 7469 746c  sub_section_titl
+00004400: 6522 2c20 5b28 2263 6f6c 6f72 222c 2022  e", [("color", "
+00004410: 626c 7565 3b22 295d 292c 0a20 2020 2020  blue;")]),.     
+00004420: 2020 2028 222e 7375 625f 7375 625f 7365     (".sub_sub_se
+00004430: 6374 696f 6e5f 7469 746c 6522 2c20 5b28  ction_title", [(
+00004440: 2263 6f6c 6f72 222c 2022 6772 6565 6e3b  "color", "green;
+00004450: 2229 5d29 2c0a 2020 2020 2020 2020 2822  ")]),.        ("
+00004460: 2e63 6f6e 6669 6465 6e63 6522 2c20 5b28  .confidence", [(
+00004470: 2263 6f6c 6f72 222c 2022 6f72 616e 6765  "color", "orange
+00004480: 3b22 295d 292c 0a20 2020 2020 2020 2028  ;")]),.        (
+00004490: 222e 7072 6f62 6162 696c 6974 7922 2c20  ".probability", 
+000044a0: 5b28 2263 6f6c 6f72 222c 2022 2338 3838  [("color", "#888
+000044b0: 3866 663b 2229 5d29 2c0a 2020 2020 2020  8ff;")]),.      
+000044c0: 2020 2822 2e73 7570 6572 7363 7269 7074    (".superscript
+000044d0: 222c 205b 2822 636f 6c6f 7222 2c20 226d  ", [("color", "m
+000044e0: 6167 656e 7461 3b22 292c 2028 2262 6163  agenta;"), ("bac
+000044f0: 6b67 726f 756e 6422 2c20 2279 656c 6c6f  kground", "yello
+00004500: 773b 2229 5d29 2c0a 2020 2020 2020 2020  w;")]),.        
+00004510: 2822 2e63 6875 6e6b 222c 205b 2822 6261  (".chunk", [("ba
+00004520: 636b 6772 6f75 6e64 222c 2022 6379 616e  ckground", "cyan
+00004530: 3b22 295d 292c 0a20 2020 2020 2020 2028  ;")]),.        (
+00004540: 222e 7461 7267 6574 7322 2c20 5b28 2262  ".targets", [("b
+00004550: 6163 6b67 726f 756e 6422 2c20 2223 3838  ackground", "#88
+00004560: 6666 3838 3b22 295d 292c 0a20 2020 2020  ff88;")]),.     
+00004570: 2020 2028 222e 7374 6172 7422 2c20 5b28     (".start", [(
+00004580: 2262 6163 6b67 726f 756e 6422 2c20 2267  "background", "g
+00004590: 7261 793b 2229 5d29 2c0a 2020 2020 2020  ray;")]),.      
+000045a0: 2020 2822 2e65 6e64 222c 205b 2822 6261    (".end", [("ba
+000045b0: 636b 6772 6f75 6e64 222c 2022 7965 6c6c  ckground", "yell
+000045c0: 6f77 3b22 295d 292c 0a20 2020 2020 2020  ow;")]),.       
+000045d0: 2028 222e 7061 6765 222c 205b 2822 6261   (".page", [("ba
+000045e0: 636b 6772 6f75 6e64 222c 2022 6d61 6765  ckground", "mage
+000045f0: 6e74 613b 2229 5d29 2c0a 2020 2020 2020  nta;")]),.      
+00004600: 2020 2822 2e73 7461 7465 6d65 6e74 222c    (".statement",
+00004610: 205b 2822 6261 636b 6772 6f75 6e64 222c   [("background",
+00004620: 2022 2364 6464 6466 663b 2229 5d29 2c0a   "#ddddff;")]),.
+00004630: 2020 2020 2020 2020 2822 2e6c 6576 656c          (".level
+00004640: 3122 2c20 5b28 2262 6163 6b67 726f 756e  1", [("backgroun
+00004650: 6422 2c20 2223 6666 6666 6464 3b22 295d  d", "#ffffdd;")]
+00004660: 292c 0a20 2020 2020 2020 2028 222e 6c65  ),.        (".le
+00004670: 7665 6c32 222c 205b 2822 6261 636b 6772  vel2", [("backgr
+00004680: 6f75 6e64 222c 2022 2364 6466 6666 663b  ound", "#ddffff;
+00004690: 2229 5d29 2c0a 2020 2020 2020 2020 2822  ")]),.        ("
+000046a0: 2e6c 6576 656c 3322 2c20 5b28 2262 6163  .level3", [("bac
+000046b0: 6b67 726f 756e 6422 2c20 2223 6464 6666  kground", "#ddff
+000046c0: 6464 3b22 295d 292c 0a20 2020 2020 2020  dd;")]),.       
+000046d0: 2028 222e 666f 6f74 6e6f 7465 222c 205b   (".footnote", [
+000046e0: 2822 6261 636b 6772 6f75 6e64 222c 2022  ("background", "
+000046f0: 2366 6664 6466 663b 2229 5d29 2c0a 2020  #ffddff;")]),.  
+00004700: 2020 5d0a 0a20 2020 2040 636c 6173 736d    ]..    @classm
+00004710: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
+00004720: 6e65 7261 7465 5f6c 6f77 6572 6361 7365  nerate_lowercase
+00004730: 5f6c 6574 7465 725f 6964 2863 6c73 2c20  _letter_id(cls, 
+00004740: 6929 3a0a 2020 2020 2020 2020 226d 616b  i):.        "mak
+00004750: 6520 6964 206f 6620 666f 726d 2061 2c62  e id of form a,b
+00004760: 2c63 2c20 2e2e 2e20 6161 2c20 6162 2c20  ,c, ... aa, ab, 
+00004770: 6163 202e 2e2e 2062 612c 2062 622c 202e  ac ... ba, bb, .
+00004780: 2e2e 207a 7a20 2c20 402e 7374 7228 6929  .. zz , @.str(i)
+00004790: 220a 2020 2020 2020 2020 6162 6320 3d20  ".        abc = 
+000047a0: 2261 6263 6465 6667 6869 6a6b 6c6d 6e6f  "abcdefghijklmno
+000047b0: 7071 7273 7475 7677 7879 7a22 0a20 2020  pqrstuvwxyz".   
+000047c0: 2020 2020 2069 6920 3d20 6920 2520 3236       ii = i % 26
+000047d0: 0a20 2020 2020 2020 206a 6a20 3d20 6920  .        jj = i 
+000047e0: 2f2f 2032 360a 2020 2020 2020 2020 6966  // 26.        if
+000047f0: 2069 203e 3d20 3136 202a 2031 363a 0a20   i >= 16 * 16:. 
+00004800: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00004810: 6e20 2240 2e22 202b 2073 7472 2869 290a  n "@." + str(i).
+00004820: 2020 2020 2020 2020 7320 3d20 2222 2069          s = "" i
+00004830: 6620 6a6a 203d 3d20 3020 656c 7365 2061  f jj == 0 else a
+00004840: 6263 5b6a 6a20 2d20 315d 0a20 2020 2020  bc[jj - 1].     
+00004850: 2020 2072 6574 7572 6e20 7320 2b20 6162     return s + ab
+00004860: 635b 6969 5d0a 0a0a 0a20 2020 2040 636c  c[ii]....    @cl
+00004870: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00004880: 6620 6772 6f75 705f 7369 626c 696e 6773  f group_siblings
+00004890: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d2c  (cls, html_elem,
+000048a0: 206c 6f63 6174 6f72 3d4e 6f6e 652c 2070   locator=None, p
+000048b0: 6172 656e 745f 6c6f 6361 746f 723d 4e6f  arent_locator=No
+000048c0: 6e65 2c20 7374 796c 653d 4e6f 6e65 2c20  ne, style=None, 
+000048d0: 6465 6275 673d 4661 6c73 6529 3a0a 2020  debug=False):.  
+000048e0: 2020 2020 2020 2222 2265 7672 7974 6869        """evrythi
+000048f0: 6e67 2073 7461 7274 7320 6173 2061 2073  ng starts as a s
+00004900: 6962 6c69 6e67 2122 2222 0a20 2020 2020  ibling!""".     
+00004910: 2020 2073 6563 7469 6f6e 7320 3d20 6874     sections = ht
+00004920: 6d6c 5f65 6c65 6d2e 7870 6174 6828 6622  ml_elem.xpath(f"
+00004930: 2e2f 2f73 7061 6e5b 7374 6172 7473 2d77  .//span[starts-w
+00004940: 6974 6828 4063 6c61 7373 2c20 277b 6c6f  ith(@class, '{lo
+00004950: 6361 746f 727d 2729 5d22 290a 2020 2020  cator}')]").    
+00004960: 2020 2020 6665 6e63 6570 6f73 7473 203d      fenceposts =
+00004970: 2068 746d 6c5f 656c 656d 2e78 7061 7468   html_elem.xpath
+00004980: 2866 222e 2f2f 7370 616e 5b73 7461 7274  (f".//span[start
+00004990: 732d 7769 7468 2840 636c 6173 732c 277b  s-with(@class,'{
+000049a0: 7061 7265 6e74 5f6c 6f63 6174 6f72 7d27  parent_locator}'
+000049b0: 295d 2229 0a20 2020 2020 2020 2069 6620  )]").        if 
+000049c0: 6c65 6e28 7365 6374 696f 6e73 2920 3e20  len(sections) > 
+000049d0: 303a 0a20 2020 2020 2020 2020 2020 2070  0:.            p
+000049e0: 6172 656e 7420 3d20 7365 6374 696f 6e73  arent = sections
+000049f0: 5b30 5d2e 6765 7470 6172 656e 7428 290a  [0].getparent().
+00004a00: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00004a10: 7365 6374 696f 6e20 696e 2073 6563 7469  section in secti
+00004a20: 6f6e 733a 0a20 2020 2020 2020 2020 2020  ons:.           
+00004a30: 2020 2020 2063 6c73 2e67 726f 7570 5f73       cls.group_s
+00004a40: 6962 6c69 6e67 735f 6265 7477 6565 6e5f  iblings_between_
+00004a50: 6665 6e63 6570 6f73 7473 2866 656e 6365  fenceposts(fence
+00004a60: 706f 7374 732c 2073 7479 6c65 3d73 7479  posts, style=sty
+00004a70: 6c65 2c20 6465 6275 673d 6465 6275 6729  le, debug=debug)
+00004a80: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00004a90: 6f64 0a20 2020 2064 6566 2067 726f 7570  od.    def group
+00004aa0: 5f73 6962 6c69 6e67 735f 6265 7477 6565  _siblings_betwee
+00004ab0: 6e5f 6665 6e63 6570 6f73 7473 2863 6c73  n_fenceposts(cls
+00004ac0: 2c20 6665 6e63 6570 6f73 7473 2c20 7374  , fenceposts, st
+00004ad0: 796c 653d 4e6f 6e65 2c20 6465 6275 673d  yle=None, debug=
+00004ae0: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
+00004af0: 666f 7220 692c 2066 656e 6365 706f 7374  for i, fencepost
+00004b00: 2069 6e20 656e 756d 6572 6174 6528 6665   in enumerate(fe
+00004b10: 6e63 6570 6f73 7473 293a 0a20 2020 2020  nceposts):.     
+00004b20: 2020 2020 2020 2066 656e 6365 706f 7374         fencepost
+00004b30: 5f66 6f6c 6c6f 7765 7273 203d 2066 656e  _followers = fen
+00004b40: 6365 706f 7374 2e78 7061 7468 2822 666f  cepost.xpath("fo
+00004b50: 6c6c 6f77 696e 672d 7369 626c 696e 673a  llowing-sibling:
+00004b60: 3a64 6976 5b73 7061 6e5d 2229 0a20 2020  :div[span]").   
+00004b70: 2020 2020 2020 2020 2063 6f6e 7461 696e           contain
+00004b80: 6572 5f64 6976 203d 2045 542e 456c 656d  er_div = ET.Elem
+00004b90: 656e 7428 2264 6976 2229 0a20 2020 2020  ent("div").     
+00004ba0: 2020 2020 2020 2063 6f6e 7461 696e 6572         container
+00004bb0: 5f64 6976 2e61 7474 7269 625b 2273 7479  _div.attrib["sty
+00004bc0: 6c65 225d 203d 2073 7479 6c65 0a20 2020  le"] = style.   
+00004bd0: 2020 2020 2020 2020 2066 656e 6365 706f           fencepo
+00004be0: 7374 2e61 6464 7072 6576 696f 7573 2863  st.addprevious(c
+00004bf0: 6f6e 7461 696e 6572 5f64 6976 290a 2020  ontainer_div).  
+00004c00: 2020 2020 2020 2020 2020 636f 6e74 6169            contai
+00004c10: 6e65 725f 6469 762e 6170 7065 6e64 2866  ner_div.append(f
+00004c20: 656e 6365 706f 7374 290a 2020 2020 2020  encepost).      
+00004c30: 2020 2020 2020 7469 746c 6520 3d20 6665        title = fe
+00004c40: 6e63 6570 6f73 742e 7870 6174 6828 2273  ncepost.xpath("s
+00004c50: 7061 6e22 295b 305d 2e61 7474 7269 622e  pan")[0].attrib.
+00004c60: 6765 7428 2269 6422 290a 2020 2020 2020  get("id").      
+00004c70: 2020 2020 2020 6966 2074 6974 6c65 3a0a        if title:.
+00004c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c90: 636f 6e74 6169 6e65 725f 6469 762e 6174  container_div.at
+00004ca0: 7472 6962 5b22 7469 746c 6522 5d20 3d20  trib["title"] = 
+00004cb0: 7469 746c 650a 2020 2020 2020 2020 2020  title.          
+00004cc0: 2020 666f 7220 666f 6c6c 6f77 6572 2069    for follower i
+00004cd0: 6e20 6665 6e63 6570 6f73 745f 666f 6c6c  n fencepost_foll
+00004ce0: 6f77 6572 733a 0a20 2020 2020 2020 2020  owers:.         
+00004cf0: 2020 2020 2020 2069 6620 666f 6c6c 6f77         if follow
+00004d00: 6572 2069 6e20 6665 6e63 6570 6f73 7473  er in fenceposts
+00004d10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004d20: 2020 2020 2020 6964 203d 2066 6f6c 6c6f        id = follo
+00004d30: 7765 722e 7870 6174 6828 222e 2f73 7061  wer.xpath("./spa
+00004d40: 6e22 295b 305d 2e61 7474 7269 622e 6765  n")[0].attrib.ge
+00004d50: 7428 2269 6422 290a 2020 2020 2020 2020  t("id").        
+00004d60: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00004d70: 6562 7567 3a0a 2020 2020 2020 2020 2020  ebug:.          
+00004d80: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+00004d90: 696e 7428 6622 2069 643a 207b 6964 7d22  int(f" id: {id}"
+00004da0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004db0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+00004dc0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00004dd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004de0: 2020 2020 2020 6966 2064 6562 7567 3a0a        if debug:.
+00004df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004e00: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+00004e10: 6d6f 7665 6420 666f 6c6c 6f77 6572 207b  moved follower {
+00004e20: 666f 6c6c 6f77 6572 7d20 746f 207b 636f  follower} to {co
+00004e30: 6e74 6169 6e65 725f 6469 762e 6174 7472  ntainer_div.attr
+00004e40: 6962 2e67 6574 2827 7469 746c 6527 297d  ib.get('title')}
+00004e50: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+00004e60: 2020 2020 2020 2063 6f6e 7461 696e 6572         container
+00004e70: 5f64 6976 2e61 7070 656e 6428 666f 6c6c  _div.append(foll
+00004e80: 6f77 6572 290a 0a20 2020 2020 2020 2022  ower)..        "
+00004e90: 2222 4927 6d20 776f 726b 696e 6720 7769  ""I'm working wi
+00004ea0: 7468 206c 786d 6c20 696e 2050 7974 686f  th lxml in Pytho
+00004eb0: 6e20 616e 6420 7769 7368 2074 6f20 6772  n and wish to gr
+00004ec0: 6f75 7020 6120 666c 6174 2073 6574 206f  oup a flat set o
+00004ed0: 6620 3c64 6976 3e20 656c 656d 656e 7473  f <div> elements
+00004ee0: 2069 6e74 6f20 6120 7472 6565 2062 6173   into a tree bas
+00004ef0: 6564 206f 6e20 7468 6569 7220 636c 6173  ed on their clas
+00004f00: 7320 6174 7472 6962 7574 6573 0a49 2068  s attributes.I h
+00004f10: 6176 6520 6120 7365 7420 6f66 2073 6563  ave a set of sec
+00004f20: 7469 6f6e 7320 3c64 6976 3e20 7468 6174  tions <div> that
+00004f30: 2061 7265 2061 6c6c 2063 6869 6c64 7265   are all childre
+00004f40: 6e20 6f66 203c 626f 6479 3e20 7768 6963  n of <body> whic
+00004f50: 6820 6d75 7374 2062 6520 6172 7261 6e67  h must be arrang
+00004f60: 6564 2069 6e20 6120 7472 6565 2073 7472  ed in a tree str
+00004f70: 7563 7475 7265 2e20 536f 6d65 206f 6620  ucture. Some of 
+00004f80: 7468 6520 6469 7673 2063 6f6e 7461 696e  the divs contain
+00004f90: 206a 7573 7420 6120 7469 746c 652d 7374   just a title-st
+00004fa0: 7269 6e67 2028 7469 746c 652d 6469 7673  ring (title-divs
+00004fb0: 2920 696e 6469 6361 7469 6e67 2074 6865  ) indicating the
+00004fc0: 206c 6576 656c 2069 6e20 7472 6565 3b20   level in tree; 
+00004fd0: 7468 6973 2069 7320 696e 6469 6361 7465  this is indicate
+00004fe0: 6420 6279 2061 2063 6c61 7373 2061 7474  d by a class att
+00004ff0: 7269 6275 7465 206f 6620 2273 6563 7469  ribute of "secti
+00005000: 6f6e 222c 2022 7375 625f 7365 6374 696f  on", "sub_sectio
+00005010: 6e22 2c20 2273 7562 5f73 7562 5f73 6563  n", "sub_sub_sec
+00005020: 7469 6f6e 222c 2065 7463 2e20 416e 7920  tion", etc. Any 
+00005030: 6469 7673 2066 6f6c 6c6f 7769 6e67 2074  divs following t
+00005040: 6974 6c65 2d64 6976 7320 6265 6c6f 6e67  itle-divs belong
+00005050: 2074 6f20 7468 6520 7361 6d65 206c 6576   to the same lev
+00005060: 656c 2c20 756e 7469 6c20 6120 666f 6c6c  el, until a foll
+00005070: 6f77 696e 6720 7469 746c 652d 6469 7620  owing title-div 
+00005080: 6973 2072 6561 6368 6564 2e20 506c 6561  is reached. Plea
+00005090: 7365 2063 7265 6174 6520 636f 6465 2074  se create code t
+000050a0: 6861 743a 0a2a 2063 7265 6174 6573 2061  hat:.* creates a
+000050b0: 206e 6577 2068 6965 7261 7263 6879 206f   new hierarchy o
+000050c0: 6620 6469 7673 2072 6570 7265 7365 6e74  f divs represent
+000050d0: 696e 6720 7468 6520 7472 6565 2073 7472  ing the tree str
+000050e0: 7563 7475 7265 0a2a 2061 6464 7320 7468  ucture.* adds th
+000050f0: 6520 7469 746c 652d 6469 7673 2061 6e64  e title-divs and
+00005100: 2074 6865 6972 2066 6f6c 6c6f 7769 6e67   their following
+00005110: 206e 6f6e 2d74 6974 6c65 2d64 6976 7320   non-title-divs 
+00005120: 746f 2074 6865 2061 7070 726f 7072 6961  to the appropria
+00005130: 7465 2070 6f73 6974 696f 6e20 696e 2074  te position in t
+00005140: 6865 2068 6965 7261 7263 6879 2e0a 0a48  he hierarchy...H
+00005150: 6572 6520 6973 2061 2074 7970 6963 616c  ere is a typical
+00005160: 2069 6e70 7574 3a0a 0a3c 6874 6d6c 3e0a   input:..<html>.
+00005170: 2020 3c68 6561 643e 2e2e 2e3c 2f68 6561    <head>...</hea
+00005180: 643e 0a20 203c 626f 6479 3e0a 2020 2020  d>.  <body>.    
+00005190: 3c64 6976 2063 6c61 7373 3d22 7365 6374  <div class="sect
+000051a0: 696f 6e5f 7469 746c 6522 3e53 6563 7469  ion_title">Secti
+000051b0: 6f6e 2031 3c2f 6469 763e 0a20 2020 203c  on 1</div>.    <
+000051c0: 6469 763e 7374 7566 6620 613c 2f64 6976  div>stuff a</div
+000051d0: 3e0a 2020 2020 3c64 6976 2063 6c61 7373  >.    <div class
+000051e0: 3d22 7375 6273 6563 7469 6f6e 5f74 6974  ="subsection_tit
+000051f0: 6c65 223e 5365 6374 696f 6e20 312e 313c  le">Section 1.1<
+00005200: 2f64 6976 3e0a 2020 2020 3c64 6976 3e73  /div>.    <div>s
+00005210: 7475 6666 2062 3c2f 6469 763e 0a20 2020  tuff b</div>.   
+00005220: 203c 6469 763e 7374 7566 6620 6278 3c2f   <div>stuff bx</
+00005230: 6469 763e 0a20 2020 203c 6469 7620 636c  div>.    <div cl
+00005240: 6173 733d 2273 7562 7375 6273 6563 7469  ass="subsubsecti
+00005250: 6f6e 5f74 6974 6c65 223e 5365 6374 696f  on_title">Sectio
+00005260: 6e20 312e 312e 313c 2f64 6976 3e0a 2020  n 1.1.1</div>.  
+00005270: 2020 3c64 6976 3e73 7475 6666 207a 3c2f    <div>stuff z</
+00005280: 6469 763e 0a20 2020 203c 6469 763e 7374  div>.    <div>st
+00005290: 7566 6620 7a7a 3c2f 6469 763e 0a20 2020  uff zz</div>.   
+000052a0: 203c 6469 7620 636c 6173 733d 2273 7562   <div class="sub
+000052b0: 7375 6273 6563 7469 6f6e 5f74 6974 6c65  subsection_title
+000052c0: 223e 5365 6374 696f 6e20 312e 312e 323c  ">Section 1.1.2<
+000052d0: 2f64 6976 3e0a 2020 2020 3c64 6976 3e73  /div>.    <div>s
+000052e0: 7475 6666 2078 3c2f 6469 763e 0a20 2020  tuff x</div>.   
+000052f0: 203c 6469 763e 7374 7566 6620 7878 3c2f   <div>stuff xx</
+00005300: 6469 763e 0a20 2020 203c 6469 763e 7374  div>.    <div>st
+00005310: 7566 6620 7878 783c 2f64 6976 3e0a 2020  uff xxx</div>.  
+00005320: 2020 3c64 6976 2063 6c61 7373 3d22 7375    <div class="su
+00005330: 6273 6563 7469 6f6e 5f74 6974 6c65 223e  bsection_title">
+00005340: 5365 6374 696f 6e20 312e 323c 2f64 6976  Section 1.2</div
+00005350: 3e0a 2020 3c2f 626f 6479 3e0a 3c2f 6874  >.  </body>.</ht
+00005360: 6d6c 3e0a 0a20 2020 616e 6420 6465 7369  ml>..   and desi
+00005370: 7265 6420 6f75 7470 7574 0a3c 6874 6d6c  red output.<html
+00005380: 3e0a 2020 3c68 6561 643e 2e2e 2e3c 2f68  >.  <head>...</h
+00005390: 6561 643e 0a20 203c 626f 6479 3e0a 2020  ead>.  <body>.  
+000053a0: 2020 3c64 6976 2063 6c61 7373 3d22 7365    <div class="se
+000053b0: 6374 696f 6e22 3e0a 2020 2020 2020 3c64  ction">.      <d
+000053c0: 6976 2063 6c61 7373 3d22 7365 6374 696f  iv class="sectio
+000053d0: 6e5f 7469 746c 6522 3e53 6563 7469 6f6e  n_title">Section
+000053e0: 2031 3c2f 6469 763e 0a20 2020 2020 203c   1</div>.      <
+000053f0: 6469 763e 7374 7566 6620 613c 2f64 6976  div>stuff a</div
+00005400: 3e0a 0920 203c 6469 7620 636c 6173 733d  >..  <div class=
+00005410: 2273 7562 7365 6374 696f 6e22 3e0a 2020  "subsection">.  
+00005420: 2020 2020 2020 3c64 6976 2063 6c61 7373        <div class
+00005430: 3d22 7375 6273 6563 7469 6f6e 5f74 6974  ="subsection_tit
+00005440: 6c65 223e 5365 6374 696f 6e20 312e 313c  le">Section 1.1<
+00005450: 2f64 6976 3e0a 2020 2020 2020 2020 3c64  /div>.        <d
+00005460: 6976 3e73 7475 6666 2062 3c2f 6469 763e  iv>stuff b</div>
+00005470: 0a20 2020 2020 2020 203c 6469 763e 7374  .        <div>st
+00005480: 7566 6620 6278 3c2f 6469 763e 0a09 093c  uff bx</div>...<
+00005490: 6469 7620 636c 6173 733d 2273 7562 7375  div class="subsu
+000054a0: 6273 6563 7469 6f6e 223e 0a20 2020 2020  bsection">.     
+000054b0: 2020 2020 203c 6469 7620 636c 6173 733d       <div class=
+000054c0: 2273 7562 7375 6273 6563 7469 6f6e 5f74  "subsubsection_t
+000054d0: 6974 6c65 223e 5365 6374 696f 6e20 312e  itle">Section 1.
+000054e0: 312e 313c 2f64 6976 3e0a 2020 2020 2020  1.1</div>.      
+000054f0: 2020 2020 3c64 6976 3e73 7475 6666 207a      <div>stuff z
+00005500: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
+00005510: 203c 6469 763e 7374 7566 6620 7a7a 3c2f   <div>stuff zz</
+00005520: 6469 763e 0a09 093c 2f64 6976 3e0a 0909  div>...</div>...
+00005530: 3c64 6976 2063 6c61 7373 3d22 7375 6273  <div class="subs
+00005540: 7562 7365 6374 696f 6e22 3e0a 2020 2020  ubsection">.    
+00005550: 2020 2020 2020 3c64 6976 2063 6c61 7373        <div class
+00005560: 3d22 7375 6273 7562 7365 6374 696f 6e5f  ="subsubsection_
+00005570: 7469 746c 6522 3e53 6563 7469 6f6e 2031  title">Section 1
+00005580: 2e31 2e32 3c2f 6469 763e 0a20 2020 2020  .1.2</div>.     
+00005590: 2020 2020 203c 6469 763e 7374 7566 6620       <div>stuff 
+000055a0: 783c 2f64 6976 3e0a 2020 2020 2020 2020  x</div>.        
+000055b0: 2020 3c64 6976 3e73 7475 6666 2078 783c    <div>stuff xx<
+000055c0: 2f64 6976 3e0a 2020 2020 2020 2020 2020  /div>.          
+000055d0: 3c64 6976 3e73 7475 6666 2078 7878 3c2f  <div>stuff xxx</
+000055e0: 6469 763e 0a09 093c 2f64 6976 3e0a 0920  div>...</div>.. 
+000055f0: 203c 2f64 6976 3e0a 093c 2f64 6976 3e0a   </div>..</div>.
+00005600: 2020 2020 3c64 6976 2063 6c61 7373 3d22      <div class="
+00005610: 7365 6374 696f 6e22 3e0a 2020 2020 2020  section">.      
+00005620: 3c64 6976 2063 6c61 7373 3d22 7365 6374  <div class="sect
+00005630: 696f 6e5f 7469 746c 6522 3e53 6563 7469  ion_title">Secti
+00005640: 6f6e 2032 3c2f 6469 763e 0a09 3c2f 6469  on 2</div>..</di
+00005650: 763e 0a20 203c 2f62 6f64 793e 0a3c 2f68  v>.  </body>.</h
+00005660: 746d 6c3e 0a0a 4368 6174 4750 540a 546f  tml>..ChatGPT.To
+00005670: 2061 6368 6965 7665 2074 6865 2064 6573   achieve the des
+00005680: 6972 6564 206f 7574 7075 742c 2079 6f75  ired output, you
+00005690: 2063 616e 2075 7365 2074 6865 2066 6f6c   can use the fol
+000056a0: 6c6f 7769 6e67 2050 7974 686f 6e20 636f  lowing Python co
+000056b0: 6465 2074 6f20 7061 7273 6520 7468 6520  de to parse the 
+000056c0: 4854 4d4c 2075 7369 6e67 206c 786d 6c20  HTML using lxml 
+000056d0: 616e 6420 7265 7374 7275 6374 7572 6520  and restructure 
+000056e0: 7468 6520 3c64 6976 3e20 656c 656d 656e  the <div> elemen
+000056f0: 7473 2069 6e74 6f20 6120 7472 6565 2073  ts into a tree s
+00005700: 7472 7563 7475 7265 2062 6173 6564 206f  tructure based o
+00005710: 6e20 7468 6569 7220 636c 6173 7320 6174  n their class at
+00005720: 7472 6962 7574 6573 3a0a 0a70 7974 686f  tributes:..pytho
+00005730: 6e0a 436f 7079 2063 6f64 650a 6672 6f6d  n.Copy code.from
+00005740: 206c 786d 6c20 696d 706f 7274 2065 7472   lxml import etr
+00005750: 6565 2023 2069 6e20 636f 6d6d 656e 740a  ee # in comment.
+00005760: 0a64 6566 2067 726f 7570 5f64 6976 735f  .def group_divs_
+00005770: 696e 746f 5f74 7265 6528 6874 6d6c 293a  into_tree(html):
+00005780: 0a20 2020 2023 2050 6172 7365 2074 6865  .    # Parse the
+00005790: 2048 544d 4c0a 2020 2020 7472 6565 203d   HTML.    tree =
+000057a0: 2065 7472 6565 2e48 544d 4c28 6874 6d6c   etree.HTML(html
+000057b0: 290a 0a20 2020 2023 2046 696e 6420 616c  )..    # Find al
+000057c0: 6c20 3c64 6976 3e20 656c 656d 656e 7473  l <div> elements
+000057d0: 2077 6974 6869 6e20 7468 6520 3c62 6f64   within the <bod
+000057e0: 793e 2074 6167 0a20 2020 2064 6976 5f65  y> tag.    div_e
+000057f0: 6c65 6d65 6e74 7320 3d20 7472 6565 2e78  lements = tree.x
+00005800: 7061 7468 2822 2f2f 626f 6479 2f64 6976  path("//body/div
+00005810: 2229 0a0a 2020 2020 2320 4372 6561 7465  ")..    # Create
+00005820: 2061 206e 6577 2072 6f6f 7420 3c64 6976   a new root <div
+00005830: 3e20 656c 656d 656e 7420 746f 2068 6f6c  > element to hol
+00005840: 6420 7468 6520 7472 6565 2073 7472 7563  d the tree struc
+00005850: 7475 7265 0a20 2020 2072 6f6f 7420 3d20  ture.    root = 
+00005860: 6574 7265 652e 456c 656d 656e 7428 2264  etree.Element("d
+00005870: 6976 2229 0a0a 2020 2020 2320 496e 6974  iv")..    # Init
+00005880: 6961 6c69 7a65 2076 6172 6961 626c 6573  ialize variables
+00005890: 2074 6f20 6b65 6570 2074 7261 636b 206f   to keep track o
+000058a0: 6620 7468 6520 6375 7272 656e 7420 7061  f the current pa
+000058b0: 7265 6e74 203c 6469 763e 2061 6e64 2069  rent <div> and i
+000058c0: 7473 206c 6576 656c 0a20 2020 2063 7572  ts level.    cur
+000058d0: 7265 6e74 5f70 6172 656e 7420 3d20 726f  rent_parent = ro
+000058e0: 6f74 0a20 2020 2063 7572 7265 6e74 5f6c  ot.    current_l
+000058f0: 6576 656c 203d 2030 0a0a 2020 2020 666f  evel = 0..    fo
+00005900: 7220 6469 7620 696e 2064 6976 5f65 6c65  r div in div_ele
+00005910: 6d65 6e74 733a 0a20 2020 2020 2020 2023  ments:.        #
+00005920: 2043 6865 636b 2069 6620 7468 6520 6375   Check if the cu
+00005930: 7272 656e 7420 3c64 6976 3e20 6861 7320  rrent <div> has 
+00005940: 6120 636c 6173 7320 6174 7472 6962 7574  a class attribut
+00005950: 650a 2020 2020 2020 2020 6966 2022 636c  e.        if "cl
+00005960: 6173 7322 2069 6e20 6469 762e 6174 7472  ass" in div.attr
+00005970: 6962 3a0a 2020 2020 2020 2020 2020 2020  ib:.            
+00005980: 636c 6173 735f 7661 6c75 6520 3d20 6469  class_value = di
+00005990: 762e 6174 7472 6962 5b22 636c 6173 7322  v.attrib["class"
+000059a0: 5d0a 0a20 2020 2020 2020 2020 2020 2023  ]..            #
+000059b0: 2044 6574 6572 6d69 6e65 2074 6865 206c   Determine the l
+000059c0: 6576 656c 2062 6173 6564 206f 6e20 7468  evel based on th
+000059d0: 6520 636c 6173 7320 6174 7472 6962 7574  e class attribut
+000059e0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+000059f0: 2063 6c61 7373 5f76 616c 7565 2e73 7461   class_value.sta
+00005a00: 7274 7377 6974 6828 2273 6563 7469 6f6e  rtswith("section
+00005a10: 5f74 6974 6c65 2229 3a0a 2020 2020 2020  _title"):.      
+00005a20: 2020 2020 2020 2020 2020 6c65 7665 6c20            level 
+00005a30: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
+00005a40: 656c 6966 2063 6c61 7373 5f76 616c 7565  elif class_value
+00005a50: 2e73 7461 7274 7377 6974 6828 2273 7562  .startswith("sub
+00005a60: 7365 6374 696f 6e5f 7469 746c 6522 293a  section_title"):
+00005a70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005a80: 206c 6576 656c 203d 2031 0a20 2020 2020   level = 1.     
+00005a90: 2020 2020 2020 2065 6c69 6620 636c 6173         elif clas
+00005aa0: 735f 7661 6c75 652e 7374 6172 7473 7769  s_value.startswi
+00005ab0: 7468 2822 7375 6273 7562 7365 6374 696f  th("subsubsectio
+00005ac0: 6e5f 7469 746c 6522 293a 0a20 2020 2020  n_title"):.     
+00005ad0: 2020 2020 2020 2020 2020 206c 6576 656c             level
+00005ae0: 203d 2032 0a20 2020 2020 2020 2020 2020   = 2.           
+00005af0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00005b00: 2020 2020 2020 2063 6f6e 7469 6e75 6520         continue 
+00005b10: 2023 2053 6b69 7020 3c64 6976 3e20 656c   # Skip <div> el
+00005b20: 656d 656e 7473 2077 6974 686f 7574 2074  ements without t
+00005b30: 6974 6c65 2063 6c61 7373 6573 0a0a 2020  itle classes..  
+00005b40: 2020 2020 2020 2020 2020 2320 4372 6561            # Crea
+00005b50: 7465 2061 206e 6577 203c 6469 763e 2065  te a new <div> e
+00005b60: 6c65 6d65 6e74 2061 6e64 2073 6574 2069  lement and set i
+00005b70: 7473 2063 6c61 7373 2061 7474 7269 6275  ts class attribu
+00005b80: 7465 0a20 2020 2020 2020 2020 2020 206e  te.            n
+00005b90: 6577 5f64 6976 203d 2065 7472 6565 2e53  ew_div = etree.S
+00005ba0: 7562 456c 656d 656e 7428 6375 7272 656e  ubElement(curren
+00005bb0: 745f 7061 7265 6e74 2c20 2264 6976 2229  t_parent, "div")
+00005bc0: 0a20 2020 2020 2020 2020 2020 206e 6577  .            new
+00005bd0: 5f64 6976 2e61 7474 7269 625b 2263 6c61  _div.attrib["cla
+00005be0: 7373 225d 203d 2022 7365 6374 696f 6e22  ss"] = "section"
+00005bf0: 202a 2028 6c65 7665 6c20 2b20 3129 2020   * (level + 1)  
+00005c00: 2320 4164 6420 6170 7072 6f70 7269 6174  # Add appropriat
+00005c10: 6520 636c 6173 7320 6261 7365 6420 6f6e  e class based on
+00005c20: 206c 6576 656c 0a0a 2020 2020 2020 2020   level..        
+00005c30: 2020 2020 2320 4164 6420 7468 6520 6375      # Add the cu
+00005c40: 7272 656e 7420 3c64 6976 3e20 746f 2074  rrent <div> to t
+00005c50: 6865 206e 6577 203c 6469 763e 2065 6c65  he new <div> ele
+00005c60: 6d65 6e74 0a20 2020 2020 2020 2020 2020  ment.           
+00005c70: 206e 6577 5f64 6976 2e61 7070 656e 6428   new_div.append(
+00005c80: 6469 7629 0a0a 2020 2020 2020 2020 2020  div)..          
+00005c90: 2020 2320 5570 6461 7465 2074 6865 2063    # Update the c
+00005ca0: 7572 7265 6e74 2070 6172 656e 7420 616e  urrent parent an
+00005cb0: 6420 6c65 7665 6c0a 2020 2020 2020 2020  d level.        
+00005cc0: 2020 2020 6375 7272 656e 745f 7061 7265      current_pare
+00005cd0: 6e74 203d 206e 6577 5f64 6976 0a20 2020  nt = new_div.   
+00005ce0: 2020 2020 2020 2020 2063 7572 7265 6e74           current
+00005cf0: 5f6c 6576 656c 203d 206c 6576 656c 0a20  _level = level. 
+00005d00: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00005d10: 2020 2020 2020 2020 2023 2041 6464 206e           # Add n
+00005d20: 6f6e 2d74 6974 6c65 203c 6469 763e 2065  on-title <div> e
+00005d30: 6c65 6d65 6e74 7320 746f 2074 6865 2063  lements to the c
+00005d40: 7572 7265 6e74 2070 6172 656e 740a 2020  urrent parent.  
+00005d50: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+00005d60: 745f 7061 7265 6e74 2e61 7070 656e 6428  t_parent.append(
+00005d70: 6469 7629 0a0a 2020 2020 2320 5265 7475  div)..    # Retu
+00005d80: 726e 2074 6865 206d 6f64 6966 6965 6420  rn the modified 
+00005d90: 4854 4d4c 2061 7320 6120 7374 7269 6e67  HTML as a string
+00005da0: 0a20 2020 2072 6574 7572 6e20 6574 7265  .    return etre
+00005db0: 652e 746f 7374 7269 6e67 2874 7265 652c  e.tostring(tree,
+00005dc0: 2065 6e63 6f64 696e 673d 2275 6e69 636f   encoding="unico
+00005dd0: 6465 2229 0a0a 2320 4578 616d 706c 6520  de")..# Example 
+00005de0: 7573 6167 650a 6874 6d6c 203d 2027 2727  usage.html = '''
+00005df0: 0a3c 6874 6d6c 3e0a 2020 3c68 6561 643e  .<html>.  <head>
+00005e00: 2e2e 2e3c 2f68 6561 643e 0a20 203c 626f  ...</head>.  <bo
+00005e10: 6479 3e0a 2020 2020 3c64 6976 2063 6c61  dy>.    <div cla
+00005e20: 7373 3d22 7365 6374 696f 6e5f 7469 746c  ss="section_titl
+00005e30: 6522 3e53 6563 7469 6f6e 2031 3c2f 6469  e">Section 1</di
+00005e40: 763e 0a20 2020 203c 6469 763e 7374 7566  v>.    <div>stuf
+00005e50: 6620 613c 2f64 6976 3e0a 2020 2020 3c64  f a</div>.    <d
+00005e60: 6976 2063 6c61 7373 3d22 7375 6273 6563  iv class="subsec
+00005e70: 7469 6f6e 5f74 6974 6c65 223e 5365 6374  tion_title">Sect
+00005e80: 696f 6e20 312e 313c 2f64 6976 3e0a 2020  ion 1.1</div>.  
+00005e90: 2020 3c64 6976 3e73 7475 6666 2062 3c2f    <div>stuff b</
+00005ea0: 6469 763e 0a20 2020 203c 6469 763e 7374  div>.    <div>st
+00005eb0: 7566 6620 6278 3c2f 6469 763e 0a20 2020  uff bx</div>.   
+00005ec0: 203c 6469 7620 636c 6173 733d 2273 7562   <div class="sub
+00005ed0: 7375 6273 6563 7469 6f6e 5f74 6974 6c65  subsection_title
+00005ee0: 223e 5365 6374 696f 6e20 312e 312e 313c  ">Section 1.1.1<
+00005ef0: 2f64 6976 3e0a 2020 2020 3c64 6976 3e73  /div>.    <div>s
+00005f00: 7475 6666 207a 3c2f 6469 763e 0a20 2020  tuff z</div>.   
+00005f10: 203c 6469 763e 7374 7566 6620 7a7a 3c2f   <div>stuff zz</
+00005f20: 6469 763e 0a20 2020 203c 6469 7620 636c  div>.    <div cl
+00005f30: 6173 733d 2273 7562 7375 6273 6563 7469  ass="subsubsecti
+00005f40: 6f6e 5f74 6974 6c65 223e 5365 6374 696f  on_title">Sectio
+00005f50: 6e20 312e 312e 323c 2f64 6976 3e0a 2020  n 1.1.2</div>.  
+00005f60: 2020 3c64 6976 3e73 7475 6666 2078 3c2f    <div>stuff x</
+00005f70: 6469 763e 0a20 2020 203c 6469 763e 7374  div>.    <div>st
+00005f80: 7566 6620 7878 3c2f 6469 763e 0a20 2020  uff xx</div>.   
+00005f90: 203c 6469 763e 7374 7566 6620 7878 783c   <div>stuff xxx<
+00005fa0: 2f64 6976 3e0a 2020 2020 3c64 6976 2063  /div>.    <div c
+00005fb0: 6c61 7373 3d22 7375 6273 6563 7469 6f6e  lass="subsection
+00005fc0: 5f74 6974 6c65 223e 5365 6374 696f 6e20  _title">Section 
+00005fd0: 312e 323c 2f64 6976 3e0a 2020 3c2f 626f  1.2</div>.  </bo
+00005fe0: 6479 3e0a 3c2f 6874 6d6c 3e0a 2727 270a  dy>.</html>.'''.
+00005ff0: 0a6f 7574 7075 745f 6874 6d6c 203d 2067  .output_html = g
+00006000: 726f 7570 5f64 6976 735f 696e 746f 5f74  roup_divs_into_t
+00006010: 7265 6528 6874 6d6c 290a 7072 696e 7428  ree(html).print(
+00006020: 6f75 7470 7574 5f68 746d 6c29 0a54 6865  output_html).The
+00006030: 2063 6f64 6520 7769 6c6c 2070 6172 7365   code will parse
+00006040: 2074 6865 2048 544d 4c2c 2069 6465 6e74   the HTML, ident
+00006050: 6966 7920 7468 6520 7469 746c 6520 3c64  ify the title <d
+00006060: 6976 3e20 656c 656d 656e 7473 2062 6173  iv> elements bas
+00006070: 6564 206f 6e20 7468 6569 7220 636c 6173  ed on their clas
+00006080: 7320 6174 7472 6962 7574 6573 2c20 6372  s attributes, cr
+00006090: 6561 7465 2061 206e 6577 2068 6965 7261  eate a new hiera
+000060a0: 7263 6879 206f 6620 3c64 6976 3e20 656c  rchy of <div> el
+000060b0: 656d 656e 7473 2c20 616e 6420 6164 6420  ements, and add 
+000060c0: 7468 6520 7469 746c 6520 3c64 6976 3e73  the title <div>s
+000060d0: 2061 6e64 2074 6865 6972 2066 6f6c 6c6f   and their follo
+000060e0: 7769 6e67 206e 6f6e 2d74 6974 6c65 203c  wing non-title <
+000060f0: 6469 763e 7320 746f 2074 6865 2061 7070  div>s to the app
+00006100: 726f 7072 6961 7465 2070 6f73 6974 696f  ropriate positio
+00006110: 6e20 696e 2074 6865 2068 6965 7261 7263  n in the hierarc
+00006120: 6879 2e20 4669 6e61 6c6c 792c 2069 7420  hy. Finally, it 
+00006130: 7769 6c6c 2072 6574 7572 6e20 7468 6520  will return the 
+00006140: 6d6f 6469 6669 6564 2048 544d 4c20 6173  modified HTML as
+00006150: 2061 2073 7472 696e 672e 0a0a 506c 6561   a string...Plea
+00006160: 7365 206e 6f74 6520 7468 6174 2074 6865  se note that the
+00006170: 2063 6f64 6520 6173 7375 6d65 7320 7468   code assumes th
+00006180: 6174 2074 6865 2063 6c61 7373 2076 616c  at the class val
+00006190: 7565 7320 666f 7220 7468 6520 7469 746c  ues for the titl
+000061a0: 6520 3c64 6976 3e20 656c 656d 656e 7473  e <div> elements
+000061b0: 2066 6f6c 6c6f 7720 7468 6520 7061 7474   follow the patt
+000061c0: 6572 6e20 2273 6563 7469 6f6e 5f74 6974  ern "section_tit
+000061d0: 6c65 222c 2022 7375 6273 6563 7469 6f6e  le", "subsection
+000061e0: 5f74 6974 6c65 222c 2022 7375 6273 7562  _title", "subsub
+000061f0: 7365 6374 696f 6e5f 7469 746c 6522 2c20  section_title", 
+00006200: 616e 6420 736f 206f 6e2e 2049 6620 796f  and so on. If yo
+00006210: 7572 2061 6374 7561 6c20 636c 6173 7320  ur actual class 
+00006220: 6e61 6d65 7320 6469 6666 6572 2c20 796f  names differ, yo
+00006230: 7520 6d61 7920 6e65 6564 2074 6f20 6d6f  u may need to mo
+00006240: 6469 6679 2074 6865 2063 6f64 6520 6163  dify the code ac
+00006250: 636f 7264 696e 676c 792e 0a0a 0a0a 0a0a  cordingly.......
+00006260: 5265 6765 6e65 7261 7465 2072 6573 706f  Regenerate respo
+00006270: 6e73 650a 5365 6e64 2061 206d 6573 7361  nse.Send a messa
+00006280: 6765 2e0a 0a46 7265 6520 5265 7365 6172  ge...Free Resear
+00006290: 6368 2050 7265 7669 6577 2e20 4368 6174  ch Preview. Chat
+000062a0: 4750 5420 6d61 7920 7072 6f64 7563 6520  GPT may produce 
+000062b0: 696e 6163 6375 7261 7465 2069 6e66 6f72  inaccurate infor
+000062c0: 6d61 7469 6f6e 2061 626f 7574 2070 656f  mation about peo
+000062d0: 706c 652c 2070 6c61 6365 732c 206f 7220  ple, places, or 
+000062e0: 6661 6374 732e 2043 6861 7447 5054 204d  facts. ChatGPT M
+000062f0: 6179 2031 3220 5665 7273 696f 6e22 2222  ay 12 Version"""
+00006300: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00006310: 640a 2020 2020 6465 6620 6772 6f75 705f  d.    def group_
+00006320: 6469 7673 5f69 6e74 6f5f 7472 6565 2863  divs_into_tree(c
+00006330: 6c73 2c20 626f 6479 293a 0a20 2020 2020  ls, body):.     
+00006340: 2020 2022 2222 5065 7465 7220 4d75 7272     """Peter Murr
+00006350: 6179 2d52 7573 7422 2222 0a20 2020 2020  ay-Rust""".     
+00006360: 2020 2045 4e44 203d 2022 5b45 4e44 220a     END = "[END".
+00006370: 2020 2020 2020 2020 5354 4152 5420 3d20          START = 
+00006380: 225b 5354 4152 5422 0a20 2020 2020 2020  "[START".       
+00006390: 2046 4c4f 4154 203d 2022 666c 6f61 7422   FLOAT = "float"
+000063a0: 0a0a 2020 2020 2020 2020 736b 6970 5f72  ..        skip_r
+000063b0: 6573 203d 205b 0a20 2020 2020 2020 2020  es = [.         
+000063c0: 2020 2072 652e 636f 6d70 696c 6528 2241     re.compile("A
+000063d0: 646f 7074 6564 2e2a 2229 2c0a 2020 2020  dopted.*"),.    
+000063e0: 2020 2020 2020 2020 7265 2e63 6f6d 7069          re.compi
+000063f0: 6c65 2822 5375 626a 6563 7420 746f 2043  le("Subject to C
+00006400: 6f70 7922 290a 2020 2020 2020 2020 5d0a  opy").        ].
+00006410: 0a0a 2020 2020 2020 2020 6469 765f 7374  ..        div_st
+00006420: 796c 6573 203d 205b 2262 6f72 6465 723a  yles = ["border:
+00006430: 2023 3838 3838 6666 2073 6f6c 6964 2033   #8888ff solid 3
+00006440: 7078 3b22 2c0a 2020 2020 2020 2020 2020  px;",.          
+00006450: 2020 2020 2020 2020 2020 2020 2262 6f72              "bor
+00006460: 6465 723a 2063 7961 6e20 6461 7368 6564  der: cyan dashed
+00006470: 2032 2e35 7078 3b22 2c0a 2020 2020 2020   2.5px;",.      
+00006480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006490: 2262 6f72 6465 723a 2067 7265 656e 2064  "border: green d
+000064a0: 6173 6865 6420 3270 783b 222c 0a20 2020  ashed 2px;",.   
+000064b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000064c0: 2020 205d 0a0a 2020 2020 2020 2020 2320     ]..        # 
+000064d0: 4669 6e64 2061 6c6c 203c 6469 763e 2065  Find all <div> e
+000064e0: 6c65 6d65 6e74 7320 7769 7468 696e 2074  lements within t
+000064f0: 6865 203c 626f 6479 3e20 7461 670a 2020  he <body> tag.  
+00006500: 2020 2020 2020 6469 765f 656c 656d 656e        div_elemen
+00006510: 7473 203d 2062 6f64 792e 7870 6174 6828  ts = body.xpath(
+00006520: 222e 2f64 6976 2229 0a0a 2020 2020 2020  "./div")..      
+00006530: 2020 2320 4372 6561 7465 2061 206e 6577    # Create a new
+00006540: 2072 6f6f 7420 3c64 6976 3e20 656c 656d   root <div> elem
+00006550: 656e 7420 746f 2068 6f6c 6420 7468 6520  ent to hold the 
+00006560: 7472 6565 2073 7472 7563 7475 7265 0a20  tree structure. 
+00006570: 2020 2020 2020 2072 6f6f 745f 6469 7620         root_div 
+00006580: 3d20 4554 2e45 6c65 6d65 6e74 2822 6469  = ET.Element("di
+00006590: 7622 290a 2020 2020 2020 2020 726f 6f74  v").        root
+000065a0: 5f64 6976 2e61 7474 7269 625b 2263 6c61  _div.attrib["cla
+000065b0: 7373 225d 203d 2022 726f 6f74 220a 2020  ss"] = "root".  
+000065c0: 2020 2020 2020 726f 6f74 5f64 6976 2e61        root_div.a
+000065d0: 7474 7269 625b 2274 6974 6c65 225d 203d  ttrib["title"] =
+000065e0: 2022 726f 6f74 220a 0a20 2020 2020 2020   "root"..       
+000065f0: 2023 2049 6e69 7469 616c 697a 6520 7661   # Initialize va
+00006600: 7269 6162 6c65 7320 746f 206b 6565 7020  riables to keep 
+00006610: 7472 6163 6b20 6f66 2074 6865 2063 7572  track of the cur
+00006620: 7265 6e74 2070 6172 656e 7420 3c64 6976  rent parent <div
+00006630: 3e20 616e 6420 6974 7320 6c65 7665 6c0a  > and its level.
+00006640: 2020 2020 2020 2020 6375 7272 656e 745f          current_
+00006650: 7061 7265 6e74 203d 2072 6f6f 745f 6469  parent = root_di
+00006660: 760a 2020 2020 2020 2020 6375 7272 656e  v.        curren
+00006670: 745f 6c65 7665 6c20 3d20 300a 0a20 2020  t_level = 0..   
+00006680: 2020 2020 2070 6172 656e 7473 203d 205b       parents = [
+00006690: 726f 6f74 5f64 6976 2c20 4e6f 6e65 2c20  root_div, None, 
+000066a0: 4e6f 6e65 2c20 4e6f 6e65 5d0a 2020 2020  None, None].    
+000066b0: 2020 2020 7374 6172 745f 656e 6473 203d      start_ends =
+000066c0: 205b 5d0a 2020 2020 2020 2020 7061 7265   [].        pare
+000066d0: 6e74 203d 2072 6f6f 745f 6469 760a 2020  nt = root_div.  
+000066e0: 2020 2020 2020 666f 7220 6469 7620 696e        for div in
+000066f0: 2064 6976 5f65 6c65 6d65 6e74 733a 0a20   div_elements:. 
+00006700: 2020 2020 2020 2020 2020 2023 2043 6865             # Che
+00006710: 636b 2069 6620 7468 6520 6375 7272 656e  ck if the curren
+00006720: 7420 3c64 6976 3e20 6861 7320 6120 636c  t <div> has a cl
+00006730: 6173 7320 6174 7472 6962 7574 650a 2020  ass attribute.  
+00006740: 2020 2020 2020 2020 2020 7465 7874 203d            text =
+00006750: 2027 272e 6a6f 696e 2864 6976 2e69 7465   ''.join(div.ite
+00006760: 7274 6578 7428 2929 0a20 2020 2020 2020  rtext()).       
+00006770: 2020 2020 2069 6620 2263 6c61 7373 2220       if "class" 
+00006780: 696e 2064 6976 2e61 7474 7269 623a 0a20  in div.attrib:. 
+00006790: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+000067a0: 6172 656e 7420 3d20 636c 732e 7072 6f63  arent = cls.proc
+000067b0: 6573 735f 636c 6173 735f 6469 7628 6469  ess_class_div(di
+000067c0: 762c 2064 6976 5f73 7479 6c65 732c 2070  v, div_styles, p
+000067d0: 6172 656e 742c 2070 6172 656e 7473 2c20  arent, parents, 
+000067e0: 7465 7874 290a 0a20 2020 2020 2020 2020  text)..         
+000067f0: 2020 2065 6c69 6620 7465 7874 2e73 7461     elif text.sta
+00006800: 7274 7377 6974 6828 5354 4152 5429 3a0a  rtswith(START):.
+00006810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006820: 7061 7265 6e74 203d 2063 6c73 2e70 726f  parent = cls.pro
+00006830: 6365 7373 5f69 7063 635f 7374 6172 7428  cess_ipcc_start(
+00006840: 464c 4f41 542c 2053 5441 5254 2c20 7061  FLOAT, START, pa
+00006850: 7265 6e74 2c20 7374 6172 745f 656e 6473  rent, start_ends
+00006860: 2c20 7465 7874 290a 0a20 2020 2020 2020  , text)..       
+00006870: 2020 2020 2065 6c69 6620 7465 7874 2e73       elif text.s
+00006880: 7461 7274 7377 6974 6828 454e 4429 3a0a  tartswith(END):.
+00006890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000068a0: 7061 7265 6e74 203d 2063 6c73 2e70 726f  parent = cls.pro
+000068b0: 6365 7373 5f69 7063 635f 656e 6428 454e  cess_ipcc_end(EN
+000068c0: 442c 2053 5441 5254 2c20 7061 7265 6e74  D, START, parent
+000068d0: 2c20 7374 6172 745f 656e 6473 2c20 7465  , start_ends, te
+000068e0: 7874 290a 0a20 2020 2020 2020 2020 2020  xt)..           
+000068f0: 2065 6c69 6620 636c 732e 736b 6970 5f63   elif cls.skip_c
+00006900: 6f6e 7465 6e74 2874 6578 742c 2073 6b69  ontent(text, ski
+00006910: 705f 7265 7329 3a0a 2020 2020 2020 2020  p_res):.        
+00006920: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+00006930: 736b 6970 7065 6420 7b74 6578 745b 3a35  skipped {text[:5
+00006940: 305d 7d22 290a 0a20 2020 2020 2020 2020  0]}")..         
+00006950: 2020 2023 2065 6c69 6620 636c 732e 6973     # elif cls.is
+00006960: 5f66 6f6f 746e 6f74 6528 7370 616e 293a  _footnote(span):
+00006970: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+00006980: 2020 2070 7269 6e74 2866 2273 6b69 7070     print(f"skipp
+00006990: 6564 207b 7465 7874 5b3a 3530 5d7d 2229  ed {text[:50]}")
+000069a0: 0a20 2020 2020 2020 2020 2020 2023 0a20  .            #. 
+000069b0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+000069c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000069d0: 2070 6172 656e 742e 6170 7065 6e64 2864   parent.append(d
+000069e0: 6976 290a 0a20 2020 2020 2020 2072 6574  iv)..        ret
+000069f0: 7572 6e20 726f 6f74 5f64 6976 0a0a 2020  urn root_div..  
+00006a00: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00006a10: 2020 2064 6566 2070 726f 6365 7373 5f69     def process_i
+00006a20: 7063 635f 656e 6428 636c 732c 2045 4e44  pcc_end(cls, END
+00006a30: 2c20 5354 4152 542c 2070 6172 656e 742c  , START, parent,
+00006a40: 2073 7461 7274 5f65 6e64 732c 2074 6578   start_ends, tex
+00006a50: 7429 3a0a 2020 2020 2020 2020 656e 645f  t):.        end_
+00006a60: 7374 7220 3d20 7465 7874 5b6c 656e 2845  str = text[len(E
+00006a70: 4e44 293a 5d0a 2020 2020 2020 2020 6966  ND):].        if
+00006a80: 2073 7461 7274 5f65 6e64 733a 0a20 2020   start_ends:.   
+00006a90: 2020 2020 2020 2020 2023 2073 6f6d 6574           # somet
+00006aa0: 696d 6573 2075 6e62 616c 616e 6365 6420  imes unbalanced 
+00006ab0: 696e 2064 6f63 756d 656e 740a 2020 2020  in document.    
+00006ac0: 2020 2020 2020 2020 7374 6172 745f 7374          start_st
+00006ad0: 7220 3d20 7374 6172 745f 656e 6473 2e70  r = start_ends.p
+00006ae0: 6f70 2829 0a20 2020 2020 2020 2020 2020  op().           
+00006af0: 2069 6620 7374 6172 745f 7374 7220 213d   if start_str !=
+00006b00: 2065 6e64 5f73 7472 3a0a 2020 2020 2020   end_str:.      
+00006b10: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00006b20: 2e77 6172 6e69 6e67 2866 2275 6e62 616c  .warning(f"unbal
+00006b30: 616e 6365 643a 207b 5354 4152 5420 2b20  anced: {START + 
+00006b40: 7374 6172 745f 7374 727d 2061 6e64 207b  start_str} and {
+00006b50: 454e 4420 2b20 656e 645f 7374 727d 2229  END + end_str}")
+00006b60: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00006b70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00006b80: 2020 2070 6172 656e 7420 3d20 7061 7265     parent = pare
+00006b90: 6e74 2e67 6574 7061 7265 6e74 2829 0a20  nt.getparent(). 
+00006ba0: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
+00006bb0: 7265 6e74 0a0a 2020 2020 4063 6c61 7373  rent..    @class
+00006bc0: 6d65 7468 6f64 0a20 2020 2064 6566 2070  method.    def p
+00006bd0: 726f 6365 7373 5f69 7063 635f 7374 6172  rocess_ipcc_star
+00006be0: 7428 636c 732c 2046 4c4f 4154 2c20 5354  t(cls, FLOAT, ST
+00006bf0: 4152 542c 2070 6172 656e 742c 2073 7461  ART, parent, sta
+00006c00: 7274 5f65 6e64 732c 2074 6578 7429 3a0a  rt_ends, text):.
+00006c10: 2020 2020 2020 2020 7374 6172 745f 7374          start_st
+00006c20: 7220 3d20 7465 7874 5b6c 656e 2853 5441  r = text[len(STA
+00006c30: 5254 293a 5d0a 2020 2020 2020 2020 7374  RT):].        st
+00006c40: 6172 745f 656e 6473 2e61 7070 656e 6428  art_ends.append(
+00006c50: 7374 6172 745f 7374 7229 0a20 2020 2020  start_str).     
+00006c60: 2020 2073 7562 5f64 6976 203d 2045 542e     sub_div = ET.
+00006c70: 5375 6245 6c65 6d65 6e74 2870 6172 656e  SubElement(paren
+00006c80: 742c 2022 6469 7622 290a 2020 2020 2020  t, "div").      
+00006c90: 2020 7375 625f 6469 762e 6174 7472 6962    sub_div.attrib
+00006ca0: 5b22 636c 6173 7322 5d20 3d20 464c 4f41  ["class"] = FLOA
+00006cb0: 540a 2020 2020 2020 2020 7375 625f 6469  T.        sub_di
+00006cc0: 762e 6174 7472 6962 5b22 7469 746c 6522  v.attrib["title"
+00006cd0: 5d20 3d20 7465 7874 0a20 2020 2020 2020  ] = text.       
+00006ce0: 2073 7562 5f64 6976 2e61 7474 7269 625b   sub_div.attrib[
+00006cf0: 2273 7479 6c65 225d 203d 2022 626f 7264  "style"] = "bord
+00006d00: 6572 3a20 6461 7368 6564 2062 6c75 6520  er: dashed blue 
+00006d10: 3370 783b 220a 2020 2020 2020 2020 7061  3px;".        pa
+00006d20: 7265 6e74 203d 2073 7562 5f64 6976 0a20  rent = sub_div. 
+00006d30: 2020 2020 2020 2072 6574 7572 6e20 7061         return pa
+00006d40: 7265 6e74 0a0a 2020 2020 4063 6c61 7373  rent..    @class
+00006d50: 6d65 7468 6f64 0a20 2020 2064 6566 2070  method.    def p
+00006d60: 726f 6365 7373 5f63 6c61 7373 5f64 6976  rocess_class_div
+00006d70: 2863 6c73 2c20 6469 762c 2064 6976 5f73  (cls, div, div_s
+00006d80: 7479 6c65 732c 2070 6172 656e 742c 2070  tyles, parent, p
+00006d90: 6172 656e 7473 2c20 7465 7874 293a 0a20  arents, text):. 
+00006da0: 2020 2020 2020 2063 6c61 7373 5f76 616c         class_val
+00006db0: 7565 203d 2064 6976 2e61 7474 7269 625b  ue = div.attrib[
+00006dc0: 2263 6c61 7373 225d 0a20 2020 2020 2020  "class"].       
+00006dd0: 2023 2044 6574 6572 6d69 6e65 2074 6865   # Determine the
+00006de0: 206c 6576 656c 2062 6173 6564 206f 6e20   level based on 
+00006df0: 7468 6520 636c 6173 7320 6174 7472 6962  the class attrib
+00006e00: 7574 650a 2020 2020 2020 2020 6966 2063  ute.        if c
+00006e10: 6c61 7373 5f76 616c 7565 2e73 7461 7274  lass_value.start
+00006e20: 7377 6974 6828 2273 6563 7469 6f6e 2229  swith("section")
+00006e30: 3a0a 2020 2020 2020 2020 2020 2020 6c65  :.            le
+00006e40: 7665 6c20 3d20 310a 2020 2020 2020 2020  vel = 1.        
+00006e50: 656c 6966 2063 6c61 7373 5f76 616c 7565  elif class_value
+00006e60: 2e73 7461 7274 7377 6974 6828 2273 7562  .startswith("sub
+00006e70: 5f73 6563 7469 6f6e 2229 3a0a 2020 2020  _section"):.    
+00006e80: 2020 2020 2020 2020 6c65 7665 6c20 3d20          level = 
+00006e90: 320a 2020 2020 2020 2020 656c 6966 2063  2.        elif c
+00006ea0: 6c61 7373 5f76 616c 7565 2e73 7461 7274  lass_value.start
+00006eb0: 7377 6974 6828 2273 7562 5f73 7562 5f73  swith("sub_sub_s
+00006ec0: 6563 7469 6f6e 2229 3a0a 2020 2020 2020  ection"):.      
+00006ed0: 2020 2020 2020 6c65 7665 6c20 3d20 330a        level = 3.
+00006ee0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00006ef0: 2020 2020 2020 2020 2020 6c65 7665 6c20            level 
+00006f00: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
+00006f10: 2020 2023 2063 6f6e 7469 6e75 6520 2023     # continue  #
+00006f20: 2053 6b69 7020 3c64 6976 3e20 656c 656d   Skip <div> elem
+00006f30: 656e 7473 2077 6974 686f 7574 2074 6974  ents without tit
+00006f40: 6c65 2063 6c61 7373 6573 0a20 2020 2020  le classes.     
+00006f50: 2020 2069 6620 6c65 7665 6c3a 0a20 2020     if level:.   
+00006f60: 2020 2020 2020 2020 2073 7461 636b 5f70           stack_p
+00006f70: 6172 656e 7420 3d20 7061 7265 6e74 735b  arent = parents[
+00006f80: 6c65 7665 6c20 2d20 315d 0a20 2020 2020  level - 1].     
+00006f90: 2020 2020 2020 2069 6620 7374 6163 6b5f         if stack_
+00006fa0: 7061 7265 6e74 2069 7320 6e6f 7420 4e6f  parent is not No
+00006fb0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00006fc0: 2020 2020 6e65 775f 6469 7620 3d20 4554      new_div = ET
+00006fd0: 2e53 7562 456c 656d 656e 7428 7374 6163  .SubElement(stac
+00006fe0: 6b5f 7061 7265 6e74 2c20 2264 6976 2229  k_parent, "div")
+00006ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007000: 206e 6577 5f64 6976 2e61 7474 7269 625b   new_div.attrib[
+00007010: 2274 6974 6c65 225d 203d 2074 6578 745b  "title"] = text[
+00007020: 3a35 305d 0a20 2020 2020 2020 2020 2020  :50].           
+00007030: 2020 2020 206e 6577 5f64 6976 2e61 7474       new_div.att
+00007040: 7269 625b 2273 7479 6c65 225d 203d 2064  rib["style"] = d
+00007050: 6976 5f73 7479 6c65 735b 6c65 7665 6c20  iv_styles[level 
+00007060: 2d20 315d 0a0a 2020 2020 2020 2020 2020  - 1]..          
+00007070: 2020 2020 2020 7061 7265 6e74 203d 206e        parent = n
+00007080: 6577 5f64 6976 0a20 2020 2020 2020 2020  ew_div.         
+00007090: 2020 2020 2020 2070 6172 656e 7473 5b6c         parents[l
+000070a0: 6576 656c 5d20 3d20 6e65 775f 6469 760a  evel] = new_div.
+000070b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000070c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000070d0: 2020 6c6f 6767 6572 2e69 6e66 6f28 6622    logger.info(f"
+000070e0: 6e6f 2070 6172 656e 7420 6f6e 2073 7461  no parent on sta
+000070f0: 636b 206c 6576 656c 207b 6c65 7665 6c7d  ck level {level}
+00007100: 2229 0a0a 0a0a 2020 2020 2020 2020 7061  ")....        pa
+00007110: 7265 6e74 2e61 7070 656e 6428 6469 7629  rent.append(div)
+00007120: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00007130: 7061 7265 6e74 0a0a 2020 2020 4063 6c61  parent..    @cla
+00007140: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00007150: 2073 6b69 705f 636f 6e74 656e 7428 636c   skip_content(cl
+00007160: 732c 2074 6578 742c 2073 6b69 705f 7265  s, text, skip_re
+00007170: 7329 3a0a 2020 2020 2020 2020 666f 7220  s):.        for 
+00007180: 736b 6970 5f72 6520 696e 2073 6b69 705f  skip_re in skip_
+00007190: 7265 733a 0a20 2020 2020 2020 2020 2020  res:.           
+000071a0: 2069 6620 736b 6970 5f72 652e 6d61 7463   if skip_re.matc
+000071b0: 6828 7465 7874 293a 0a20 2020 2020 2020  h(text):.       
+000071c0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000071d0: 5472 7565 0a20 2020 2020 2020 2072 6574  True.        ret
+000071e0: 7572 6e20 4661 6c73 650a 0a20 2020 2064  urn False..    d
+000071f0: 6566 206d 6174 6368 5f72 6567 6578 2864  ef match_regex(d
+00007200: 6976 2c20 7265 6765 782c 2073 6563 7469  iv, regex, secti
+00007210: 6f6e 5f63 6c61 7373 2c20 7465 7874 293a  on_class, text):
+00007220: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00007230: 2020 2020 2020 2020 2020 7265 6720 3d20            reg = 
+00007240: 7265 2e63 6f6d 7069 6c65 2872 6567 6578  re.compile(regex
+00007250: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00007260: 2045 7863 6570 7469 6f6e 2061 7320 653a   Exception as e:
+00007270: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00007280: 7365 2056 616c 7565 4572 726f 7228 6622  se ValueError(f"
+00007290: 4241 4420 5245 4745 5820 7b72 6567 6578  BAD REGEX {regex
+000072a0: 7d20 6265 6361 7573 6520 7b65 7d22 290a  } because {e}").
+000072b0: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
+000072c0: 7265 672e 6d61 7463 6828 7465 7874 290a  reg.match(text).
+000072d0: 2020 2020 2020 2020 6966 206d 6174 6368          if match
+000072e0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+000072f0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00007300: 2020 2069 6420 3d20 6d61 7463 682e 6772     id = match.gr
+00007310: 6f75 7028 2769 6427 290a 2020 2020 2020  oup('id').      
+00007320: 2020 2020 2020 2020 2020 6469 762e 6174            div.at
+00007330: 7472 6962 5b22 7469 746c 6522 5d20 3d20  trib["title"] = 
+00007340: 6964 0a20 2020 2020 2020 2020 2020 2065  id.            e
+00007350: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+00007360: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00007370: 2020 2020 2020 7072 696e 7428 6622 6661        print(f"fa
+00007380: 696c 6564 2074 6f20 6d61 7463 6820 6964  iled to match id
+00007390: 2069 6e20 7b72 6567 6578 7d22 290a 2020   in {regex}").  
+000073a0: 2020 2020 2020 2020 2020 6469 762e 6174            div.at
+000073b0: 7472 6962 5b22 636c 6173 7322 5d20 3d20  trib["class"] = 
+000073c0: 7365 6374 696f 6e5f 636c 6173 730a 0a0a  section_class...
+000073d0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+000073e0: 0a20 2020 2064 6566 2061 6e6e 6f74 6174  .    def annotat
+000073f0: 655f 7469 746c 655f 7365 6374 696f 6e73  e_title_sections
+00007400: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d2c  (cls, html_elem,
+00007410: 2073 6563 7469 6f6e 5f72 6567 6578 6573   section_regexes
+00007420: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
+00007430: 6966 2073 6563 7469 6f6e 5f72 6567 6578  if section_regex
+00007440: 6573 2069 7320 4e6f 6e65 3a0a 2020 2020  es is None:.    
+00007450: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00007460: 6c75 6545 7272 6f72 2822 6d75 7374 2068  lueError("must h
+00007470: 6176 6520 7365 6374 696f 6e5f 7265 6765  ave section_rege
+00007480: 7865 7320 6172 6775 6d65 6e74 2229 0a20  xes argument"). 
+00007490: 2020 2020 2020 2020 2020 2023 2074 6869             # thi
+000074a0: 7320 6f6e 6c79 2077 6f72 6b73 2066 6f72  s only works for
+000074b0: 2049 5043 4320 6472 6166 740a 2020 2020   IPCC draft.    
+000074c0: 2020 2020 2020 2020 2320 7365 6374 696f          # sectio
+000074d0: 6e5f 7265 6765 7865 7320 3d20 5b0a 2020  n_regexes = [.  
+000074e0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+000074f0: 2822 7365 6374 696f 6e22 2c20 2253 6563  ("section", "Sec
+00007500: 7469 6f6e 5c73 2a28 3f50 3c69 643e 5c64  tion\s*(?P<id>\d
+00007510: 293a 5c73 2b2e 2a22 292c 0a20 2020 2020  ):\s+.*"),.     
+00007520: 2020 2020 2020 2023 2020 2020 2028 2273         #     ("s
+00007530: 7562 5f73 6563 7469 6f6e 222c 2022 283f  ub_section", "(?
+00007540: 503c 6964 3e5c 642b 5c2e 5c64 2b29 5c73  P<id>\d+\.\d+)\s
+00007550: 2e2a 2229 2c0a 2020 2020 2020 2020 2020  .*"),.          
+00007560: 2020 2320 2020 2020 2822 7375 625f 7375    #     ("sub_su
+00007570: 625f 7365 6374 696f 6e22 2c20 2228 3f50  b_section", "(?P
+00007580: 3c69 643e 5c64 2b5c 2e5c 642b 5c2e 5c64  <id>\d+\.\d+\.\d
+00007590: 2b29 5c73 2e2a 2229 0a20 2020 2020 2020  +)\s.*").       
+000075a0: 2020 2020 2023 205d 0a0a 2020 2020 2020       # ]..      
+000075b0: 2020 626f 6479 203d 2048 746d 6c4c 6962    body = HtmlLib
+000075c0: 2e67 6574 5f62 6f64 7928 6874 6d6c 5f65  .get_body(html_e
+000075d0: 6c65 6d29 0a20 2020 2020 2020 2066 6f72  lem).        for
+000075e0: 2064 6976 2069 6e20 626f 6479 2e78 7061   div in body.xpa
+000075f0: 7468 2822 2e2f 2f64 6976 2229 3a0a 2020  th(".//div"):.  
+00007600: 2020 2020 2020 2020 2020 7465 7874 203d            text =
+00007610: 2027 272e 6a6f 696e 2864 6976 2e69 7465   ''.join(div.ite
+00007620: 7274 6578 7428 2929 0a0a 2020 2020 2020  rtext())..      
+00007630: 2020 2020 2020 666f 7220 7365 6374 696f        for sectio
+00007640: 6e5f 7265 6765 7820 696e 2073 6563 7469  n_regex in secti
+00007650: 6f6e 5f72 6567 6578 6573 3a0a 2020 2020  on_regexes:.    
+00007660: 2020 2020 2020 2020 2020 2020 7365 6374              sect
+00007670: 696f 6e5f 636c 6173 7320 3d20 7365 6374  ion_class = sect
+00007680: 696f 6e5f 7265 6765 785b 305d 0a20 2020  ion_regex[0].   
+00007690: 2020 2020 2020 2020 2020 2020 2072 6567               reg
+000076a0: 6578 203d 204e 6f6e 6520 6966 206e 6f74  ex = None if not
+000076b0: 2073 6563 7469 6f6e 5f72 6567 6578 2065   section_regex e
+000076c0: 6c73 6520 7365 6374 696f 6e5f 7265 6765  lse section_rege
+000076d0: 785b 315d 0a20 2020 2020 2020 2020 2020  x[1].           
+000076e0: 2020 2020 2069 6620 6e6f 7420 7265 6765       if not rege
+000076f0: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
+00007700: 2020 2020 2020 2070 7269 6e74 2866 224e         print(f"N
+00007710: 4f20 5245 4745 583a 2072 6567 6578 2069  O REGEX: regex i
+00007720: 6e20 7365 6374 696f 6e5f 7265 6765 7820  n section_regex 
+00007730: 7b73 6563 7469 6f6e 5f72 6567 6578 7d22  {section_regex}"
+00007740: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00007750: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00007760: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00007770: 6c73 2e6d 6174 6368 5f72 6567 6578 2864  ls.match_regex(d
+00007780: 6976 2c20 7265 6765 782c 2073 6563 7469  iv, regex, secti
+00007790: 6f6e 5f63 6c61 7373 2c20 7465 7874 290a  on_class, text).
+000077a0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+000077b0: 640a 2020 2020 6465 6620 636f 6c6c 6563  d.    def collec
+000077c0: 745f 666c 6f61 7473 5f74 6f5f 6261 636b  t_floats_to_back
+000077d0: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d29  (cls, html_elem)
+000077e0: 3a0a 2020 2020 2020 2020 6261 636b 203d  :.        back =
+000077f0: 2048 746d 6c47 726f 7570 2e67 6574 5f62   HtmlGroup.get_b
+00007800: 6163 6b5f 6469 7628 6874 6d6c 5f65 6c65  ack_div(html_ele
+00007810: 6d29 0a20 2020 2020 2020 2066 6c6f 6174  m).        float
+00007820: 7320 3d20 6874 6d6c 5f65 6c65 6d2e 7870  s = html_elem.xp
+00007830: 6174 6828 222e 2f2f 6469 765b 4063 6c61  ath(".//div[@cla
+00007840: 7373 3d27 666c 6f61 7427 5d22 290a 2020  ss='float']").  
+00007850: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
+00007860: 7567 2866 2266 6c6f 6174 7320 7b6c 656e  ug(f"floats {len
+00007870: 2866 6c6f 6174 7329 7d22 290a 2020 2020  (floats)}").    
+00007880: 2020 2020 666f 7220 666c 6f61 7420 696e      for float in
+00007890: 2066 6c6f 6174 733a 0a20 2020 2020 2020   floats:.       
+000078a0: 2020 2020 2062 6163 6b2e 6170 7065 6e64       back.append
+000078b0: 2866 6c6f 6174 290a 0a20 2020 2040 636c  (float)..    @cl
+000078c0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+000078d0: 6620 6372 6561 7465 5f62 6163 6b5f 6469  f create_back_di
+000078e0: 7628 636c 732c 2068 746d 6c5f 656c 656d  v(cls, html_elem
+000078f0: 293a 0a20 2020 2020 2020 2062 6163 6b20  ):.        back 
+00007900: 3d20 4554 2e53 7562 456c 656d 656e 7428  = ET.SubElement(
+00007910: 4874 6d6c 4c69 622e 6765 745f 626f 6479  HtmlLib.get_body
+00007920: 2868 746d 6c5f 656c 656d 292c 2022 6469  (html_elem), "di
+00007930: 7622 290a 2020 2020 2020 2020 6261 636b  v").        back
+00007940: 2e61 7474 7269 625b 2263 6c61 7373 225d  .attrib["class"]
+00007950: 203d 2022 6261 636b 220a 2020 2020 2020   = "back".      
+00007960: 2020 6261 636b 2e61 7474 7269 625b 2274    back.attrib["t
+00007970: 6974 6c65 225d 203d 2022 6261 636b 206d  itle"] = "back m
+00007980: 6174 7465 7222 0a20 2020 2020 2020 2062  atter".        b
+00007990: 6163 6b2e 6174 7472 6962 5b22 7374 796c  ack.attrib["styl
+000079a0: 6522 5d20 3d20 2262 6163 6b67 726f 756e  e"] = "backgroun
+000079b0: 643a 2023 6666 6666 6464 3b20 626f 7264  d: #ffffdd; bord
+000079c0: 6572 3a20 736f 6c69 6420 7075 7270 6c65  er: solid purple
+000079d0: 2031 2e35 7078 3b20 6d61 7267 696e 3a20   1.5px; margin: 
+000079e0: 3270 783b 220a 2020 2020 2020 2020 6261  2px;".        ba
+000079f0: 636b 5f74 6974 6c65 203d 2045 542e 5375  ck_title = ET.Su
+00007a00: 6245 6c65 6d65 6e74 2862 6163 6b2c 2022  bElement(back, "
+00007a10: 6469 7622 290a 2020 2020 2020 2020 6261  div").        ba
+00007a20: 636b 5f74 6974 6c65 2e74 6578 7420 3d20  ck_title.text = 
+00007a30: 2242 6163 6b20 4d61 7474 6572 2c20 466f  "Back Matter, Fo
+00007a40: 6f74 6e6f 7465 732c 2046 6967 7572 6573  otnotes, Figures
+00007a50: 2c20 5461 626c 6573 2c20 426f 7865 7322  , Tables, Boxes"
+00007a60: 0a20 2020 2020 2020 2062 6163 6b5f 7469  .        back_ti
+00007a70: 746c 652e 6174 7472 6962 5b22 7374 796c  tle.attrib["styl
+00007a80: 6522 5d20 3d20 2266 6f6e 742d 7369 7a65  e"] = "font-size
+00007a90: 3a20 3230 7078 3b20 666f 6e74 2d66 616d  : 20px; font-fam
+00007aa0: 696c 793a 2073 616e 7365 7269 663b 220a  ily: sanserif;".
+00007ab0: 2020 2020 2020 2020 7265 7475 726e 2062          return b
+00007ac0: 6163 6b0a 0a20 2020 2040 636c 6173 736d  ack..    @classm
+00007ad0: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
+00007ae0: 745f 6261 636b 5f64 6976 2863 6c73 2c20  t_back_div(cls, 
+00007af0: 6874 6d6c 5f65 6c65 6d29 3a0a 2020 2020  html_elem):.    
+00007b00: 2020 2020 2222 2267 6574 206f 7220 6372      """get or cr
+00007b10: 6561 7465 2062 6f64 792f 6469 765b 4063  eate body/div[@c
+00007b20: 6c61 7373 3d27 6261 636b 275d 2222 220a  lass='back']""".
+00007b30: 2020 2020 2020 2020 6261 636b 7320 3d20          backs = 
+00007b40: 4874 6d6c 4c69 622e 6765 745f 626f 6479  HtmlLib.get_body
+00007b50: 2868 746d 6c5f 656c 656d 292e 7870 6174  (html_elem).xpat
+00007b60: 6828 222e 2f64 6976 5b63 6c61 7373 3d27  h("./div[class='
+00007b70: 6261 636b 275d 2229 0a20 2020 2020 2020  back']").       
+00007b80: 2072 6574 7572 6e20 6261 636b 735b 305d   return backs[0]
+00007b90: 2069 6620 6c65 6e28 6261 636b 7329 203e   if len(backs) >
+00007ba0: 2030 2065 6c73 6520 4874 6d6c 4772 6f75   0 else HtmlGrou
+00007bb0: 702e 6372 6561 7465 5f62 6163 6b5f 6469  p.create_back_di
+00007bc0: 7628 6874 6d6c 5f65 6c65 6d29 0a0a 2020  v(html_elem)..  
+00007bd0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00007be0: 2020 2064 6566 2063 7265 6174 655f 6865     def create_he
+00007bf0: 6164 5f73 7479 6c65 5f65 6c65 6d28 636c  ad_style_elem(cl
+00007c00: 732c 206e 6577 5f68 746d 6c2c 2074 6169  s, new_html, tai
+00007c10: 6c3d 225a 5a5a 2229 3a0a 2020 2020 2020  l="ZZZ"):.      
+00007c20: 2020 7374 796c 6520 3d20 4554 2e53 7562    style = ET.Sub
+00007c30: 456c 656d 656e 7428 4874 6d6c 4c69 622e  Element(HtmlLib.
+00007c40: 6765 745f 6865 6164 286e 6577 5f68 746d  get_head(new_htm
+00007c50: 6c29 2c20 4353 5353 7479 6c65 2e53 5459  l), CSSStyle.STY
+00007c60: 4c45 290a 2020 2020 2020 2020 6966 2074  LE).        if t
+00007c70: 6169 6c3a 0a20 2020 2020 2020 2020 2020  ail:.           
+00007c80: 2073 7479 6c65 2e74 6169 6c20 3d20 7461   style.tail = ta
+00007c90: 696c 0a20 2020 2020 2020 2023 2062 6173  il.        # bas
+00007ca0: 6963 2073 7479 6c69 6e67 2074 6f20 7368  ic styling to sh
+00007cb0: 6f77 2064 6976 7320 616e 6420 7370 616e  ow divs and span
+00007cc0: 730a 2020 2020 2020 2020 7374 796c 652e  s.        style.
+00007cd0: 7465 7874 203d 2022 2222 0a20 2020 2020  text = """.     
+00007ce0: 2020 2064 6976 207b 626f 7264 6572 3a20     div {border: 
+00007cf0: 7265 6420 736f 6c69 6420 3170 783b 206d  red solid 1px; m
+00007d00: 6172 6769 6e3a 2031 7078 3b7d 0a20 2020  argin: 1px;}.   
+00007d10: 2020 2020 2073 7061 6e20 7b62 6163 6b67       span {backg
+00007d20: 726f 756e 643a 2023 6565 6565 6565 3b20  round: #eeeeee; 
+00007d30: 6d61 7267 696e 3a20 3170 783b 7d0a 2020  margin: 1px;}.  
+00007d40: 2020 2020 2020 6469 762e 666c 6f61 7420        div.float 
+00007d50: 7b62 6163 6b67 726f 756e 643a 2023 6464  {background: #dd
+00007d60: 6666 6666 3b7d 0a20 2020 2020 2020 2020  ffff;}.         
+00007d70: 2020 2020 2020 2020 2020 2020 2222 220a              """.
+00007d80: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00007d90: 7479 6c65 0a0a 2020 2020 4063 6c61 7373  tyle..    @class
+00007da0: 6d65 7468 6f64 0a20 2020 2064 6566 2065  method.    def e
+00007db0: 7874 7261 6374 5f66 6f6f 746e 6f74 6573  xtract_footnotes
+00007dc0: 5f74 6f5f 6261 636b 2863 6c73 2c20 6874  _to_back(cls, ht
+00007dd0: 6d6c 5f65 6c65 6d29 3a0a 2020 2020 2020  ml_elem):.      
+00007de0: 2020 4874 6d6c 5574 696c 2e65 7874 7261    HtmlUtil.extra
+00007df0: 6374 5f66 6f6f 746e 6f74 6573 2868 746d  ct_footnotes(htm
+00007e00: 6c5f 656c 656d 2c20 2266 6f6e 742d 7369  l_elem, "font-si
+00007e10: 7a65 3a20 362e 3022 290a 0a20 2020 2040  ze: 6.0")..    @
+00007e20: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00007e30: 6465 6620 7265 6d6f 7665 5f65 6d70 7479  def remove_empty
+00007e40: 5f64 6976 7328 636c 732c 2065 6c65 6d29  _divs(cls, elem)
+00007e50: 3a0a 2020 2020 2020 2020 6469 7673 203d  :.        divs =
+00007e60: 2065 6c65 6d2e 7870 6174 6828 222e 2f2f   elem.xpath(".//
+00007e70: 6469 7622 290a 2020 2020 2020 2020 666f  div").        fo
+00007e80: 7220 6469 7620 696e 2064 6976 733a 0a20  r div in divs:. 
+00007e90: 2020 2020 2020 2020 2020 2074 6578 7420             text 
+00007ea0: 3d20 2727 2e6a 6f69 6e28 6469 762e 6974  = ''.join(div.it
+00007eb0: 6572 7465 7874 2829 290a 2020 2020 2020  ertext()).      
+00007ec0: 2020 2020 2020 6966 206e 6f74 2074 6578        if not tex
+00007ed0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00007ee0: 2020 2064 6976 2e67 6574 7061 7265 6e74     div.getparent
+00007ef0: 2829 2e72 656d 6f76 6528 6469 7629 0a0a  ().remove(div)..
+00007f00: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00007f10: 0a20 2020 2064 6566 206a 6f69 6e5f 7370  .    def join_sp
+00007f20: 6c69 745f 6469 7673 2863 6c73 2c20 746f  lit_divs(cls, to
+00007f30: 705f 6469 7629 3a0a 2020 2020 2020 2020  p_div):.        
+00007f40: 6469 7673 203d 2074 6f70 5f64 6976 2e78  divs = top_div.x
+00007f50: 7061 7468 2822 2e2f 2f64 6976 2229 0a20  path(".//div"). 
+00007f60: 2020 2020 2020 2066 6f72 2069 2c20 6469         for i, di
+00007f70: 7620 696e 2065 6e75 6d65 7261 7465 2864  v in enumerate(d
+00007f80: 6976 7329 3a0a 2020 2020 2020 2020 2020  ivs):.          
+00007f90: 2020 6966 2069 203e 2030 3a0a 2020 2020    if i > 0:.    
+00007fa0: 2020 2020 2020 2020 2020 2020 6469 7630              div0
+00007fb0: 203d 2064 6976 735b 6920 2d20 315d 0a20   = divs[i - 1]. 
+00007fc0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00007fd0: 7061 6e30 203d 2048 746d 6c47 726f 7570  pan0 = HtmlGroup
+00007fe0: 2e67 6574 5f6c 6173 745f 7370 616e 2864  .get_last_span(d
+00007ff0: 6976 3029 0a20 2020 2020 2020 2020 2020  iv0).           
+00008000: 2020 2020 2073 7061 6e31 203d 2048 746d       span1 = Htm
+00008010: 6c47 726f 7570 2e67 6574 5f66 6972 7374  lGroup.get_first
+00008020: 5f73 7061 6e28 6469 7629 0a20 2020 2020  _span(div).     
+00008030: 2020 2020 2020 2020 2020 2069 6620 7370             if sp
+00008040: 616e 3020 6973 206e 6f74 204e 6f6e 6520  an0 is not None 
+00008050: 616e 6420 7370 616e 3120 6973 206e 6f74  and span1 is not
+00008060: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00008070: 2020 2020 2020 2020 2020 2073 7479 6c65             style
+00008080: 3020 3d20 4353 5353 7479 6c65 2e63 7265  0 = CSSStyle.cre
+00008090: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
+000080a0: 6f6d 5f61 7474 7269 6275 7465 5f6f 665f  om_attribute_of_
+000080b0: 626f 6479 5f65 6c65 6d65 6e74 2873 7061  body_element(spa
+000080c0: 6e30 290a 2020 2020 2020 2020 2020 2020  n0).            
+000080d0: 2020 2020 2020 2020 7374 796c 6531 203d          style1 =
+000080e0: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
+000080f0: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
+00008100: 6174 7472 6962 7574 655f 6f66 5f62 6f64  attribute_of_bod
+00008110: 795f 656c 656d 656e 7428 7370 616e 3029  y_element(span0)
+00008120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008130: 2020 2020 2069 6620 7374 796c 6530 203d       if style0 =
+00008140: 3d20 7374 796c 6531 3a0a 2020 2020 2020  = style1:.      
+00008150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008160: 2020 6966 2073 7061 6e31 2069 7320 6e6f    if span1 is no
+00008170: 7420 4e6f 6e65 2061 6e64 206c 656e 2873  t None and len(s
+00008180: 7061 6e31 2e74 6578 7429 203e 2030 2061  pan1.text) > 0 a
+00008190: 6e64 2073 7061 6e31 2e74 6578 745b 305d  nd span1.text[0]
+000081a0: 2e69 736c 6f77 6572 2829 3a0a 2020 2020  .islower():.    
+000081b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000081c0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+000081d0: 6622 206a 6f69 6e65 6420 7365 636f 6e64  f" joined second
+000081e0: 5f73 7061 6e20 7b73 7061 6e31 2e74 6578  _span {span1.tex
+000081f0: 747d 2229 0a20 2020 2020 2020 2020 2020  t}").           
+00008200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008210: 2048 746d 6c55 7469 6c2e 6a6f 696e 5f73   HtmlUtil.join_s
+00008220: 7061 6e73 5f69 6e5f 7361 6d65 5f64 6976  pans_in_same_div
+00008230: 2873 7061 6e30 2c20 7370 616e 3129 0a20  (span0, span1). 
+00008240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008250: 2020 2020 2020 2020 2020 2066 6f72 2073             for s
+00008260: 7061 6e20 696e 2064 6976 2e78 7061 7468  pan in div.xpath
+00008270: 2822 2e2f 7370 616e 2229 3a0a 2020 2020  ("./span"):.    
 00008280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008290: 6469 7630 2e61 7070 656e 6428 7370 616e  div0.append(span
-000082a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000082b0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-000082c0: 762e 6765 7470 6172 656e 7428 292e 7265  v.getparent().re
-000082d0: 6d6f 7665 2864 6976 290a 0a0a 2020 2020  move(div)...    
-000082e0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-000082f0: 2064 6566 2067 6574 5f6c 6173 745f 7370   def get_last_sp
-00008300: 616e 2863 6c73 2c20 6469 7629 3a0a 2020  an(cls, div):.  
-00008310: 2020 2020 2020 7370 616e 7320 3d20 6469        spans = di
-00008320: 762e 7870 6174 6828 222e 2f73 7061 6e22  v.xpath("./span"
-00008330: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00008340: 2073 7061 6e73 5b2d 315d 2069 6620 6c65   spans[-1] if le
-00008350: 6e28 7370 616e 7329 203e 2030 2065 6c73  n(spans) > 0 els
-00008360: 6520 4e6f 6e65 0a0a 2020 2020 4063 6c61  e None..    @cla
-00008370: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00008380: 2067 6574 5f66 6972 7374 5f73 7061 6e28   get_first_span(
-00008390: 636c 732c 2064 6976 293a 0a20 2020 2020  cls, div):.     
-000083a0: 2020 2073 7061 6e73 203d 2064 6976 2e78     spans = div.x
-000083b0: 7061 7468 2822 2e2f 7370 616e 2229 0a20  path("./span"). 
-000083c0: 2020 2020 2020 2072 6574 7572 6e20 7370         return sp
-000083d0: 616e 735b 305d 2069 6620 6c65 6e28 7370  ans[0] if len(sp
-000083e0: 616e 7329 203e 2030 2065 6c73 6520 4e6f  ans) > 0 else No
-000083f0: 6e65 0a0a 2020 2020 4063 6c61 7373 6d65  ne..    @classme
-00008400: 7468 6f64 0a20 2020 2064 6566 2061 6464  thod.    def add
-00008410: 5f70 6172 6167 7261 7068 5f69 6473 2863  _paragraph_ids(c
-00008420: 6c73 2c20 746f 705f 6469 7629 3a0a 2020  ls, top_div):.  
-00008430: 2020 2020 2020 2222 2261 6464 7320 7365        """adds se
-00008440: 7175 656e 7469 616c 2070 6172 6167 7261  quential paragra
-00008450: 7068 206e 756d 6265 7269 6e67 2028 652e  ph numbering (e.
-00008460: 672e 2031 2e32 2e33 203d 3e20 312e 322e  g. 1.2.3 => 1.2.
-00008470: 332e 612c 2031 2e32 2e33 2e62 2065 7463  3.a, 1.2.3.b etc
-00008480: 2222 220a 2020 2020 2020 2020 7469 746c  """.        titl
-00008490: 655f 7061 7261 5f64 6976 7320 3d20 746f  e_para_divs = to
-000084a0: 705f 6469 762e 7870 6174 6828 222e 2f2f  p_div.xpath(".//
-000084b0: 6469 765b 4074 6974 6c65 2061 6e64 2063  div[@title and c
-000084c0: 6f6e 7461 696e 7328 4063 6c61 7373 2c20  ontains(@class, 
-000084d0: 2773 6563 7469 6f6e 2729 5d22 290a 2020  'section')]").  
-000084e0: 2020 2020 2020 666f 7220 7469 746c 655f        for title_
-000084f0: 7061 7261 5f64 6976 2069 6e20 7469 746c  para_div in titl
-00008500: 655f 7061 7261 5f64 6976 733a 0a20 2020  e_para_divs:.   
-00008510: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-00008520: 6465 6275 6728 6622 7469 746c 6520 7061  debug(f"title pa
-00008530: 7261 2064 6976 7320 7b6c 656e 2874 6974  ra divs {len(tit
-00008540: 6c65 5f70 6172 615f 6469 7673 297d 2229  le_para_divs)}")
-00008550: 0a20 2020 2020 2020 2020 2020 2074 6974  .            tit
-00008560: 6c65 5f69 6420 3d20 7469 746c 655f 7061  le_id = title_pa
-00008570: 7261 5f64 6976 2e61 7474 7269 622e 6765  ra_div.attrib.ge
-00008580: 7428 2774 6974 6c65 2729 0a20 2020 2020  t('title').     
-00008590: 2020 2020 2020 2069 6620 6e6f 7420 7469         if not ti
-000085a0: 746c 655f 6964 3a0a 2020 2020 2020 2020  tle_id:.        
-000085b0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-000085c0: 0a20 2020 2020 2020 2020 2020 2066 6f6c  .            fol
-000085d0: 6c6f 7765 7273 203d 2074 6974 6c65 5f70  lowers = title_p
-000085e0: 6172 615f 6469 762e 7870 6174 6828 2266  ara_div.xpath("f
-000085f0: 6f6c 6c6f 7769 6e67 2d73 6962 6c69 6e67  ollowing-sibling
-00008600: 3a3a 6469 7622 290a 2020 2020 2020 2020  ::div").        
-00008610: 2020 2020 666f 7220 692c 2066 6f6c 6c6f      for i, follo
-00008620: 7765 7220 696e 2065 6e75 6d65 7261 7465  wer in enumerate
-00008630: 2866 6f6c 6c6f 7765 7273 293a 0a20 2020  (followers):.   
-00008640: 2020 2020 2020 2020 2020 2020 206c 6574               let
-00008650: 7465 7220 3d20 4874 6d6c 4772 6f75 702e  ter = HtmlGroup.
-00008660: 6765 6e65 7261 7465 5f6c 6f77 6572 6361  generate_lowerca
-00008670: 7365 5f6c 6574 7465 725f 6964 2869 290a  se_letter_id(i).
-00008680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008690: 6964 203d 2074 6974 6c65 5f69 6420 2b20  id = title_id + 
-000086a0: 222e 2220 2b20 6c65 7474 6572 0a20 2020  "." + letter.   
-000086b0: 2020 2020 2020 2020 2020 2020 2073 7061               spa
-000086c0: 6e20 3d20 4554 2e45 6c65 6d65 6e74 2822  n = ET.Element("
-000086d0: 7370 616e 2229 0a20 2020 2020 2020 2020  span").         
-000086e0: 2020 2020 2020 2073 7061 6e2e 6174 7472         span.attr
-000086f0: 6962 5b22 7374 796c 6522 5d20 3d20 2262  ib["style"] = "b
-00008700: 6163 6b67 726f 756e 643a 2023 6666 6666  ackground: #ffff
-00008710: 6464 3b20 666f 6e74 2d73 697a 653a 2038  dd; font-size: 8
-00008720: 7078 220a 2020 2020 2020 2020 2020 2020  px".            
-00008730: 2020 2020 7370 616e 2e74 6578 7420 3d20      span.text = 
-00008740: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
-00008750: 2020 2073 7061 6e2e 6174 7472 6962 5b22     span.attrib["
-00008760: 6964 225d 203d 2069 640a 2020 2020 2020  id"] = id.      
-00008770: 2020 2020 2020 2020 2020 666f 6c6c 6f77            follow
-00008780: 6572 2e69 6e73 6572 7428 302c 2073 7061  er.insert(0, spa
-00008790: 6e29 0a0a 2020 2020 4063 6c61 7373 6d65  n)..    @classme
-000087a0: 7468 6f64 0a20 2020 2064 6566 206d 616b  thod.    def mak
-000087b0: 655f 6869 6572 6172 6368 6963 616c 5f73  e_hierarchical_s
-000087c0: 6563 7469 6f6e 735f 4b45 5928 636c 732c  ections_KEY(cls,
-000087d0: 2068 746d 6c5f 656c 656d 2c20 7374 656d   html_elem, stem
-000087e0: 2c20 7365 6374 696f 6e5f 7265 6765 7865  , section_regexe
-000087f0: 733d 4e6f 6e65 2c20 6f75 7464 6972 3d4e  s=None, outdir=N
-00008800: 6f6e 652c 2064 6562 7567 3d46 616c 7365  one, debug=False
-00008810: 293a 0a20 2020 2020 2020 2022 2222 4b65  ):.        """Ke
-00008820: 7920 666f 726d 6174 7469 6e67 2072 6f75  y formatting rou
-00008830: 7469 6e65 0a20 2020 2020 2020 2022 2222  tine.        """
-00008840: 0a20 2020 2020 2020 2048 746d 6c53 7479  .        HtmlSty
-00008850: 6c65 2e65 7874 7261 6374 5f73 7479 6c65  le.extract_style
-00008860: 735f 616e 645f 6e6f 726d 616c 697a 655f  s_and_normalize_
-00008870: 636c 6173 7372 6566 7328 6874 6d6c 5f65  classrefs(html_e
-00008880: 6c65 6d2c 206f 7574 6469 723d 6f75 7464  lem, outdir=outd
-00008890: 6972 290a 2020 2020 2020 2020 6966 206f  ir).        if o
-000088a0: 7574 6469 723a 0a20 2020 2020 2020 2020  utdir:.         
-000088b0: 2020 2048 746d 6c4c 6962 2e77 7269 7465     HtmlLib.write
-000088c0: 5f68 746d 6c5f 6669 6c65 2868 746d 6c5f  _html_file(html_
-000088d0: 656c 656d 2c20 5061 7468 286f 7574 6469  elem, Path(outdi
-000088e0: 722c 2066 227b 7374 656d 7d5f 7374 796c  r, f"{stem}_styl
-000088f0: 6573 2e68 746d 6c22 292c 2064 6562 7567  es.html"), debug
-00008900: 3d54 7275 6529 0a20 2020 2020 2020 2048  =True).        H
-00008910: 746d 6c47 726f 7570 2e61 6e6e 6f74 6174  tmlGroup.annotat
-00008920: 655f 7469 746c 655f 7365 6374 696f 6e73  e_title_sections
-00008930: 2868 746d 6c5f 656c 656d 2c20 7365 6374  (html_elem, sect
-00008940: 696f 6e5f 7265 6765 7865 733d 7365 6374  ion_regexes=sect
-00008950: 696f 6e5f 7265 6765 7865 7329 0a20 2020  ion_regexes).   
-00008960: 2020 2020 2048 746d 6c47 726f 7570 2e65       HtmlGroup.e
-00008970: 7874 7261 6374 5f66 6f6f 746e 6f74 6573  xtract_footnotes
-00008980: 5f74 6f5f 6261 636b 2868 746d 6c5f 656c  _to_back(html_el
-00008990: 656d 290a 2020 2020 2020 2020 6e65 775f  em).        new_
-000089a0: 6469 7620 3d20 4874 6d6c 4772 6f75 702e  div = HtmlGroup.
-000089b0: 6772 6f75 705f 6469 7673 5f69 6e74 6f5f  group_divs_into_
-000089c0: 7472 6565 2848 746d 6c4c 6962 2e67 6574  tree(HtmlLib.get
-000089d0: 5f62 6f64 7928 6874 6d6c 5f65 6c65 6d29  _body(html_elem)
-000089e0: 290a 2020 2020 2020 2020 4874 6d6c 4772  ).        HtmlGr
-000089f0: 6f75 702e 7265 6d6f 7665 5f65 6d70 7479  oup.remove_empty
-00008a00: 5f64 6976 7328 6e65 775f 6469 7629 0a20  _divs(new_div). 
-00008a10: 2020 2020 2020 2048 746d 6c47 726f 7570         HtmlGroup
-00008a20: 2e6a 6f69 6e5f 7370 6c69 745f 6469 7673  .join_split_divs
-00008a30: 286e 6577 5f64 6976 290a 2020 2020 2020  (new_div).      
-00008a40: 2020 4874 6d6c 4772 6f75 702e 6164 645f    HtmlGroup.add_
-00008a50: 7061 7261 6772 6170 685f 6964 7328 6e65  paragraph_ids(ne
-00008a60: 775f 6469 7629 0a20 2020 2020 2020 2023  w_div).        #
-00008a70: 2074 7261 6e73 6665 7220 746f 206e 6577   transfer to new
-00008a80: 2065 6c65 6d65 6e74 2028 6d61 7920 6e6f   element (may no
-00008a90: 7420 6265 206e 6563 6573 7361 7279 3f29  t be necessary?)
-00008aa0: 0a20 2020 2020 2020 206e 6577 5f68 746d  .        new_htm
-00008ab0: 6c20 3d20 4874 6d6c 4c69 622e 6372 6561  l = HtmlLib.crea
-00008ac0: 7465 5f68 746d 6c5f 7769 7468 5f65 6d70  te_html_with_emp
-00008ad0: 7479 5f68 6561 645f 626f 6479 2829 0a20  ty_head_body(). 
-00008ae0: 2020 2020 2020 2048 746d 6c4c 6962 2e67         HtmlLib.g
-00008af0: 6574 5f62 6f64 7928 6e65 775f 6874 6d6c  et_body(new_html
-00008b00: 292e 6170 7065 6e64 286e 6577 5f64 6976  ).append(new_div
-00008b10: 290a 2020 2020 2020 2020 4874 6d6c 5374  ).        HtmlSt
-00008b20: 796c 652e 7472 616e 7366 6572 5f68 6561  yle.transfer_hea
-00008b30: 645f 7374 796c 6573 2868 746d 6c5f 656c  d_styles(html_el
-00008b40: 656d 2c20 6e65 775f 6874 6d6c 290a 2020  em, new_html).  
-00008b50: 2020 2020 2020 4874 6d6c 4772 6f75 702e        HtmlGroup.
-00008b60: 636f 6c6c 6563 745f 666c 6f61 7473 5f74  collect_floats_t
-00008b70: 6f5f 6261 636b 286e 6577 5f68 746d 6c29  o_back(new_html)
-00008b80: 0a20 2020 2020 2020 2048 746d 6c47 726f  .        HtmlGro
-00008b90: 7570 2e61 6e6e 6f74 6174 655f 6970 6363  up.annotate_ipcc
-00008ba0: 5f74 6172 6765 745f 6964 7328 6e65 775f  _target_ids(new_
-00008bb0: 6874 6d6c 290a 2020 2020 2020 2020 6966  html).        if
-00008bc0: 206f 7574 6469 723a 0a20 2020 2020 2020   outdir:.       
-00008bd0: 2020 2020 2048 746d 6c4c 6962 2e77 7269       HtmlLib.wri
-00008be0: 7465 5f68 746d 6c5f 6669 6c65 286e 6577  te_html_file(new
-00008bf0: 5f68 746d 6c2c 2050 6174 6828 6f75 7464  _html, Path(outd
-00008c00: 6972 2c20 6622 7b73 7465 6d7d 5f67 726f  ir, f"{stem}_gro
-00008c10: 7570 732e 6874 6d6c 2229 2c20 6465 6275  ups.html"), debu
-00008c20: 673d 5472 7565 290a 2020 2020 2020 2020  g=True).        
-00008c30: 7370 6c69 745f 7370 616e 5f72 6567 6578  split_span_regex
-00008c40: 203d 2022 283f 503c 7072 653e 2e2a 283f   = "(?P<pre>.*(?
-00008c50: 3a68 6967 687c 6d65 6469 756d 7c6c 6f77  :high|medium|low
-00008c60: 295c 5c73 2a28 636f 6e66 6964 656e 6365  )\\s*(confidence
-00008c70: 2929 283f 503c 706f 7374 3e2e 2a29 220a  ))(?P<post>.*)".
-00008c80: 2020 2020 2020 2020 4874 6d6c 4772 6f75          HtmlGrou
-00008c90: 702e 7370 6c69 745f 7370 616e 7328 6e65  p.split_spans(ne
-00008ca0: 775f 6874 6d6c 2c20 7370 6c69 745f 7370  w_html, split_sp
-00008cb0: 616e 5f72 6567 6578 290a 2020 2020 2020  an_regex).      
-00008cc0: 2020 6966 206f 7574 6469 723a 0a20 2020    if outdir:.   
-00008cd0: 2020 2020 2020 2020 2048 746d 6c4c 6962           HtmlLib
-00008ce0: 2e77 7269 7465 5f68 746d 6c5f 6669 6c65  .write_html_file
-00008cf0: 286e 6577 5f68 746d 6c2c 2050 6174 6828  (new_html, Path(
-00008d00: 6f75 7464 6972 2c20 6622 7b73 7465 6d7d  outdir, f"{stem}
-00008d10: 5f73 7461 7465 6d65 6e74 732e 6874 6d6c  _statements.html
-00008d20: 2229 2c20 6465 6275 673d 5472 7565 290a  "), debug=True).
-00008d30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00008d40: 6e65 775f 6874 6d6c 0a0a 2020 2020 4063  new_html..    @c
-00008d50: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00008d60: 6566 2067 726f 7570 5f6e 6573 7465 645f  ef group_nested_
-00008d70: 7369 626c 696e 6773 2863 6c73 2c20 6874  siblings(cls, ht
-00008d80: 6d6c 5f65 6c65 6d2c 2073 7479 6c65 733d  ml_elem, styles=
-00008d90: 4e6f 6e65 293a 0a20 2020 2020 2020 2069  None):.        i
-00008da0: 6620 7374 796c 6573 2069 7320 4e6f 6e65  f styles is None
-00008db0: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
-00008dc0: 796c 6573 203d 205b 0a20 2020 2020 2020  yles = [.       
-00008dd0: 2020 2020 2022 626f 7264 6572 203a 2073       "border : s
-00008de0: 6f6c 6964 2070 7572 706c 6520 3270 783b  olid purple 2px;
-00008df0: 206d 6172 6769 6e3a 3270 783b 222c 0a20   margin:2px;",. 
-00008e00: 2020 2020 2020 2020 2020 2022 626f 7264             "bord
-00008e10: 6572 203a 2064 6173 6865 6420 6772 6565  er : dashed gree
-00008e20: 6e20 312e 3570 783b 206d 6172 6769 6e3a  n 1.5px; margin:
-00008e30: 312e 3570 783b 222c 0a20 2020 2020 2020  1.5px;",.       
-00008e40: 2020 2020 2022 626f 7264 6572 203a 2064       "border : d
-00008e50: 6f74 7465 6420 626c 7565 2031 7078 3b20  otted blue 1px; 
-00008e60: 6d61 7267 696e 3a31 7078 3b22 2c0a 2020  margin:1px;",.  
-00008e70: 2020 2020 2020 2020 2020 5d0a 0a20 2020            ]..   
-00008e80: 2020 2020 2048 746d 6c47 726f 7570 2e67       HtmlGroup.g
-00008e90: 726f 7570 5f73 6962 6c69 6e67 7328 6874  roup_siblings(ht
-00008ea0: 6d6c 5f65 6c65 6d2c 206c 6f63 6174 6f72  ml_elem, locator
-00008eb0: 3d22 7365 6374 696f 6e22 2c20 7374 796c  ="section", styl
-00008ec0: 653d 7374 796c 6573 5b30 5d29 0a20 2020  e=styles[0]).   
-00008ed0: 2020 2020 2048 746d 6c47 726f 7570 2e67       HtmlGroup.g
-00008ee0: 726f 7570 5f73 6962 6c69 6e67 7328 6874  roup_siblings(ht
-00008ef0: 6d6c 5f65 6c65 6d2c 206c 6f63 6174 6f72  ml_elem, locator
-00008f00: 3d22 7375 625f 7365 6374 696f 6e22 2c20  ="sub_section", 
-00008f10: 7374 796c 653d 7374 796c 6573 5b31 5d2c  style=styles[1],
-00008f20: 2064 6562 7567 3d54 7275 6529 0a20 2020   debug=True).   
-00008f30: 2020 2020 2048 746d 6c47 726f 7570 2e67       HtmlGroup.g
-00008f40: 726f 7570 5f73 6962 6c69 6e67 7328 6874  roup_siblings(ht
-00008f50: 6d6c 5f65 6c65 6d2c 206c 6f63 6174 6f72  ml_elem, locator
-00008f60: 3d22 7375 625f 7375 625f 7365 6374 696f  ="sub_sub_sectio
-00008f70: 6e22 2c20 7374 796c 653d 7374 796c 6573  n", style=styles
-00008f80: 5b32 5d29 0a0a 2020 2020 4063 6c61 7373  [2])..    @class
-00008f90: 6d65 7468 6f64 0a20 2020 2064 6566 2061  method.    def a
-00008fa0: 6e6e 6f74 6174 655f 6970 6363 5f74 6172  nnotate_ipcc_tar
-00008fb0: 6765 745f 6964 7328 636c 732c 2068 746d  get_ids(cls, htm
-00008fc0: 6c5f 656c 656d 293a 0a20 2020 2020 2020  l_elem):.       
-00008fd0: 2022 2222 6669 6e64 7320 7365 6374 696f   """finds sectio
-00008fe0: 6e73 206f 6620 666f 726d 207b 7461 7267  ns of form {targ
-00008ff0: 6574 5f69 642c 2074 6172 6765 745f 6964  et_id, target_id
-00009000: 2e2e 2e7d 2061 6e64 2061 6464 7320 636c  ...} and adds cl
-00009010: 6173 733d 7461 7267 6574 730a 2020 2020  ass=targets.    
-00009020: 2020 2020 5468 6973 2069 7320 6265 7474      This is bett
-00009030: 6572 2064 6f6e 6520 696e 2074 6865 2061  er done in the a
-00009040: 6e6e 6f74 6174 6f72 2077 6f72 6b66 6c6f  nnotator workflo
-00009050: 7720 7768 6572 6520 6974 2077 6f72 6b73  w where it works
-00009060: 2e20 5468 6973 2069 7320 6120 6861 636b  . This is a hack
-00009070: 2066 6f72 0a20 2020 2020 2020 2066 696c   for.        fil
-00009080: 6573 2077 6869 6368 2068 6176 6520 6265  es which have be
-00009090: 656e 206d 6973 7365 6422 2222 0a20 2020  en missed""".   
-000090a0: 2020 2020 2072 655f 6375 726c 7920 3d20       re_curly = 
-000090b0: 7265 2e63 6f6d 7069 6c65 2872 2228 3f50  re.compile(r"(?P
-000090c0: 3c70 7265 3e2e 2a29 7b28 3f50 3c62 6f64  <pre>.*){(?P<bod
-000090d0: 793e 5b5e 7d5d 2b29 7d28 3f50 3c70 6f73  y>[^}]+)}(?P<pos
-000090e0: 743e 2e2a 2922 290a 2020 2020 2020 2020  t>.*)").        
-000090f0: 5441 5247 4554 5320 3d20 2274 6172 6765  TARGETS = "targe
-00009100: 7473 220a 2020 2020 2020 2020 6375 726c  ts".        curl
-00009110: 795f 7370 616e 7320 3d20 6874 6d6c 5f65  y_spans = html_e
-00009120: 6c65 6d2e 7870 6174 6828 6622 2e2f 2f73  lem.xpath(f".//s
-00009130: 7061 6e5b 636f 6e74 6169 6e73 282e 2c20  pan[contains(., 
-00009140: 277b 7b27 2920 616e 6420 636f 6e74 6169  '{{') and contai
-00009150: 6e73 282e 2c20 277d 7d27 295d 2229 0a20  ns(., '}}')]"). 
-00009160: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
-00009170: 6275 6728 6622 666f 756e 6420 6375 726c  bug(f"found curl
-00009180: 6965 7320 7b6c 656e 2863 7572 6c79 5f73  ies {len(curly_s
-00009190: 7061 6e73 297d 2229 0a20 2020 2020 2020  pans)}").       
-000091a0: 2066 6f72 2073 7061 6e20 696e 2063 7572   for span in cur
-000091b0: 6c79 5f73 7061 6e73 3a0a 2020 2020 2020  ly_spans:.      
-000091c0: 2020 2020 2020 7061 7265 6e74 203d 2073        parent = s
-000091d0: 7061 6e2e 6765 7470 6172 656e 7428 290a  pan.getparent().
-000091e0: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
-000091f0: 6820 3d20 7265 5f63 7572 6c79 2e6d 6174  h = re_curly.mat
-00009200: 6368 2873 7061 6e2e 7465 7874 290a 2020  ch(span.text).  
-00009210: 2020 2020 2020 2020 2020 6966 206d 6174            if mat
-00009220: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
-00009230: 2020 2020 666f 7220 6770 2069 6e20 5b22      for gp in ["
-00009240: 7072 6522 2c20 2262 6f64 7922 2c20 2270  pre", "body", "p
-00009250: 6f73 7422 5d3a 0a20 2020 2020 2020 2020  ost"]:.         
-00009260: 2020 2020 2020 2020 2020 2074 203d 206d             t = m
-00009270: 6174 6368 2e67 726f 7570 2867 7029 0a20  atch.group(gp). 
-00009280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009290: 2020 2069 6620 6c65 6e28 7429 203e 2030     if len(t) > 0
-000092a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000092b0: 2020 2020 2020 2020 2020 6966 2067 7020            if gp 
-000092c0: 3d3d 2022 626f 6479 223a 0a20 2020 2020  == "body":.     
-000092d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000092e0: 2020 2020 2020 2074 6172 6765 745f 6964         target_id
-000092f0: 7320 3d20 7265 2e73 706c 6974 2822 5b2c  s = re.split("[,
-00009300: 3b5d 222c 2074 290a 2020 2020 2020 2020  ;]", t).        
-00009310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009320: 2020 2020 666f 7220 7461 7267 6574 5f69      for target_i
-00009330: 6420 696e 2074 6172 6765 745f 6964 733a  d in target_ids:
-00009340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008290: 2020 2020 2020 2020 2020 2020 6469 7630              div0
+000082a0: 2e61 7070 656e 6428 7370 616e 290a 2020  .append(span).  
+000082b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000082c0: 2020 2020 2020 2020 2020 6469 762e 6765            div.ge
+000082d0: 7470 6172 656e 7428 292e 7265 6d6f 7665  tparent().remove
+000082e0: 2864 6976 290a 0a0a 2020 2020 4063 6c61  (div)...    @cla
+000082f0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00008300: 2067 6574 5f6c 6173 745f 7370 616e 2863   get_last_span(c
+00008310: 6c73 2c20 6469 7629 3a0a 2020 2020 2020  ls, div):.      
+00008320: 2020 7370 616e 7320 3d20 6469 762e 7870    spans = div.xp
+00008330: 6174 6828 222e 2f73 7061 6e22 290a 2020  ath("./span").  
+00008340: 2020 2020 2020 7265 7475 726e 2073 7061        return spa
+00008350: 6e73 5b2d 315d 2069 6620 6c65 6e28 7370  ns[-1] if len(sp
+00008360: 616e 7329 203e 2030 2065 6c73 6520 4e6f  ans) > 0 else No
+00008370: 6e65 0a0a 2020 2020 4063 6c61 7373 6d65  ne..    @classme
+00008380: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
+00008390: 5f66 6972 7374 5f73 7061 6e28 636c 732c  _first_span(cls,
+000083a0: 2064 6976 293a 0a20 2020 2020 2020 2073   div):.        s
+000083b0: 7061 6e73 203d 2064 6976 2e78 7061 7468  pans = div.xpath
+000083c0: 2822 2e2f 7370 616e 2229 0a20 2020 2020  ("./span").     
+000083d0: 2020 2072 6574 7572 6e20 7370 616e 735b     return spans[
+000083e0: 305d 2069 6620 6c65 6e28 7370 616e 7329  0] if len(spans)
+000083f0: 203e 2030 2065 6c73 6520 4e6f 6e65 0a0a   > 0 else None..
+00008400: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00008410: 0a20 2020 2064 6566 2061 6464 5f70 6172  .    def add_par
+00008420: 6167 7261 7068 5f69 6473 2863 6c73 2c20  agraph_ids(cls, 
+00008430: 746f 705f 6469 7629 3a0a 2020 2020 2020  top_div):.      
+00008440: 2020 2222 2261 6464 7320 7365 7175 656e    """adds sequen
+00008450: 7469 616c 2070 6172 6167 7261 7068 206e  tial paragraph n
+00008460: 756d 6265 7269 6e67 2028 652e 672e 2031  umbering (e.g. 1
+00008470: 2e32 2e33 203d 3e20 312e 322e 332e 612c  .2.3 => 1.2.3.a,
+00008480: 2031 2e32 2e33 2e62 2065 7463 2222 220a   1.2.3.b etc""".
+00008490: 2020 2020 2020 2020 7469 746c 655f 7061          title_pa
+000084a0: 7261 5f64 6976 7320 3d20 746f 705f 6469  ra_divs = top_di
+000084b0: 762e 7870 6174 6828 222e 2f2f 6469 765b  v.xpath(".//div[
+000084c0: 4074 6974 6c65 2061 6e64 2063 6f6e 7461  @title and conta
+000084d0: 696e 7328 4063 6c61 7373 2c20 2773 6563  ins(@class, 'sec
+000084e0: 7469 6f6e 2729 5d22 290a 2020 2020 2020  tion')]").      
+000084f0: 2020 666f 7220 7469 746c 655f 7061 7261    for title_para
+00008500: 5f64 6976 2069 6e20 7469 746c 655f 7061  _div in title_pa
+00008510: 7261 5f64 6976 733a 0a20 2020 2020 2020  ra_divs:.       
+00008520: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+00008530: 6728 6622 7469 746c 6520 7061 7261 2064  g(f"title para d
+00008540: 6976 7320 7b6c 656e 2874 6974 6c65 5f70  ivs {len(title_p
+00008550: 6172 615f 6469 7673 297d 2229 0a20 2020  ara_divs)}").   
+00008560: 2020 2020 2020 2020 2074 6974 6c65 5f69           title_i
+00008570: 6420 3d20 7469 746c 655f 7061 7261 5f64  d = title_para_d
+00008580: 6976 2e61 7474 7269 622e 6765 7428 2774  iv.attrib.get('t
+00008590: 6974 6c65 2729 0a20 2020 2020 2020 2020  itle').         
+000085a0: 2020 2069 6620 6e6f 7420 7469 746c 655f     if not title_
+000085b0: 6964 3a0a 2020 2020 2020 2020 2020 2020  id:.            
+000085c0: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+000085d0: 2020 2020 2020 2020 2066 6f6c 6c6f 7765           followe
+000085e0: 7273 203d 2074 6974 6c65 5f70 6172 615f  rs = title_para_
+000085f0: 6469 762e 7870 6174 6828 2266 6f6c 6c6f  div.xpath("follo
+00008600: 7769 6e67 2d73 6962 6c69 6e67 3a3a 6469  wing-sibling::di
+00008610: 7622 290a 2020 2020 2020 2020 2020 2020  v").            
+00008620: 666f 7220 692c 2066 6f6c 6c6f 7765 7220  for i, follower 
+00008630: 696e 2065 6e75 6d65 7261 7465 2866 6f6c  in enumerate(fol
+00008640: 6c6f 7765 7273 293a 0a20 2020 2020 2020  lowers):.       
+00008650: 2020 2020 2020 2020 206c 6574 7465 7220           letter 
+00008660: 3d20 4874 6d6c 4772 6f75 702e 6765 6e65  = HtmlGroup.gene
+00008670: 7261 7465 5f6c 6f77 6572 6361 7365 5f6c  rate_lowercase_l
+00008680: 6574 7465 725f 6964 2869 290a 2020 2020  etter_id(i).    
+00008690: 2020 2020 2020 2020 2020 2020 6964 203d              id =
+000086a0: 2074 6974 6c65 5f69 6420 2b20 222e 2220   title_id + "." 
+000086b0: 2b20 6c65 7474 6572 0a20 2020 2020 2020  + letter.       
+000086c0: 2020 2020 2020 2020 2073 7061 6e20 3d20           span = 
+000086d0: 4554 2e45 6c65 6d65 6e74 2822 7370 616e  ET.Element("span
+000086e0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+000086f0: 2020 2073 7061 6e2e 6174 7472 6962 5b22     span.attrib["
+00008700: 7374 796c 6522 5d20 3d20 2262 6163 6b67  style"] = "backg
+00008710: 726f 756e 643a 2023 6666 6666 6464 3b20  round: #ffffdd; 
+00008720: 666f 6e74 2d73 697a 653a 2038 7078 220a  font-size: 8px".
+00008730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008740: 7370 616e 2e74 6578 7420 3d20 6964 0a20  span.text = id. 
+00008750: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00008760: 7061 6e2e 6174 7472 6962 5b22 6964 225d  pan.attrib["id"]
+00008770: 203d 2069 640a 2020 2020 2020 2020 2020   = id.          
+00008780: 2020 2020 2020 666f 6c6c 6f77 6572 2e69        follower.i
+00008790: 6e73 6572 7428 302c 2073 7061 6e29 0a0a  nsert(0, span)..
+000087a0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+000087b0: 0a20 2020 2064 6566 206d 616b 655f 6869  .    def make_hi
+000087c0: 6572 6172 6368 6963 616c 5f73 6563 7469  erarchical_secti
+000087d0: 6f6e 735f 4b45 5928 636c 732c 2068 746d  ons_KEY(cls, htm
+000087e0: 6c5f 656c 656d 2c20 7374 656d 2c20 7365  l_elem, stem, se
+000087f0: 6374 696f 6e5f 7265 6765 7865 733d 4e6f  ction_regexes=No
+00008800: 6e65 2c20 6f75 7464 6972 3d4e 6f6e 652c  ne, outdir=None,
+00008810: 2064 6562 7567 3d46 616c 7365 293a 0a20   debug=False):. 
+00008820: 2020 2020 2020 2022 2222 4b65 7920 666f         """Key fo
+00008830: 726d 6174 7469 6e67 2072 6f75 7469 6e65  rmatting routine
+00008840: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00008850: 2020 2020 2048 746d 6c53 7479 6c65 2e65       HtmlStyle.e
+00008860: 7874 7261 6374 5f73 7479 6c65 735f 616e  xtract_styles_an
+00008870: 645f 6e6f 726d 616c 697a 655f 636c 6173  d_normalize_clas
+00008880: 7372 6566 7328 6874 6d6c 5f65 6c65 6d2c  srefs(html_elem,
+00008890: 206f 7574 6469 723d 6f75 7464 6972 290a   outdir=outdir).
+000088a0: 2020 2020 2020 2020 6966 206f 7574 6469          if outdi
+000088b0: 723a 0a20 2020 2020 2020 2020 2020 2048  r:.            H
+000088c0: 746d 6c4c 6962 2e77 7269 7465 5f68 746d  tmlLib.write_htm
+000088d0: 6c5f 6669 6c65 2868 746d 6c5f 656c 656d  l_file(html_elem
+000088e0: 2c20 5061 7468 286f 7574 6469 722c 2066  , Path(outdir, f
+000088f0: 227b 7374 656d 7d5f 7374 796c 6573 2e68  "{stem}_styles.h
+00008900: 746d 6c22 292c 2064 6562 7567 3d54 7275  tml"), debug=Tru
+00008910: 6529 0a20 2020 2020 2020 2048 746d 6c47  e).        HtmlG
+00008920: 726f 7570 2e61 6e6e 6f74 6174 655f 7469  roup.annotate_ti
+00008930: 746c 655f 7365 6374 696f 6e73 2868 746d  tle_sections(htm
+00008940: 6c5f 656c 656d 2c20 7365 6374 696f 6e5f  l_elem, section_
+00008950: 7265 6765 7865 733d 7365 6374 696f 6e5f  regexes=section_
+00008960: 7265 6765 7865 7329 0a20 2020 2020 2020  regexes).       
+00008970: 2048 746d 6c47 726f 7570 2e65 7874 7261   HtmlGroup.extra
+00008980: 6374 5f66 6f6f 746e 6f74 6573 5f74 6f5f  ct_footnotes_to_
+00008990: 6261 636b 2868 746d 6c5f 656c 656d 290a  back(html_elem).
+000089a0: 2020 2020 2020 2020 6e65 775f 6469 7620          new_div 
+000089b0: 3d20 4874 6d6c 4772 6f75 702e 6772 6f75  = HtmlGroup.grou
+000089c0: 705f 6469 7673 5f69 6e74 6f5f 7472 6565  p_divs_into_tree
+000089d0: 2848 746d 6c4c 6962 2e67 6574 5f62 6f64  (HtmlLib.get_bod
+000089e0: 7928 6874 6d6c 5f65 6c65 6d29 290a 2020  y(html_elem)).  
+000089f0: 2020 2020 2020 4874 6d6c 4772 6f75 702e        HtmlGroup.
+00008a00: 7265 6d6f 7665 5f65 6d70 7479 5f64 6976  remove_empty_div
+00008a10: 7328 6e65 775f 6469 7629 0a20 2020 2020  s(new_div).     
+00008a20: 2020 2048 746d 6c47 726f 7570 2e6a 6f69     HtmlGroup.joi
+00008a30: 6e5f 7370 6c69 745f 6469 7673 286e 6577  n_split_divs(new
+00008a40: 5f64 6976 290a 2020 2020 2020 2020 4874  _div).        Ht
+00008a50: 6d6c 4772 6f75 702e 6164 645f 7061 7261  mlGroup.add_para
+00008a60: 6772 6170 685f 6964 7328 6e65 775f 6469  graph_ids(new_di
+00008a70: 7629 0a20 2020 2020 2020 2023 2074 7261  v).        # tra
+00008a80: 6e73 6665 7220 746f 206e 6577 2065 6c65  nsfer to new ele
+00008a90: 6d65 6e74 2028 6d61 7920 6e6f 7420 6265  ment (may not be
+00008aa0: 206e 6563 6573 7361 7279 3f29 0a20 2020   necessary?).   
+00008ab0: 2020 2020 206e 6577 5f68 746d 6c20 3d20       new_html = 
+00008ac0: 4874 6d6c 4c69 622e 6372 6561 7465 5f68  HtmlLib.create_h
+00008ad0: 746d 6c5f 7769 7468 5f65 6d70 7479 5f68  tml_with_empty_h
+00008ae0: 6561 645f 626f 6479 2829 0a20 2020 2020  ead_body().     
+00008af0: 2020 2048 746d 6c4c 6962 2e67 6574 5f62     HtmlLib.get_b
+00008b00: 6f64 7928 6e65 775f 6874 6d6c 292e 6170  ody(new_html).ap
+00008b10: 7065 6e64 286e 6577 5f64 6976 290a 2020  pend(new_div).  
+00008b20: 2020 2020 2020 4874 6d6c 5374 796c 652e        HtmlStyle.
+00008b30: 7472 616e 7366 6572 5f68 6561 645f 7374  transfer_head_st
+00008b40: 796c 6573 2868 746d 6c5f 656c 656d 2c20  yles(html_elem, 
+00008b50: 6e65 775f 6874 6d6c 290a 2020 2020 2020  new_html).      
+00008b60: 2020 4874 6d6c 4772 6f75 702e 636f 6c6c    HtmlGroup.coll
+00008b70: 6563 745f 666c 6f61 7473 5f74 6f5f 6261  ect_floats_to_ba
+00008b80: 636b 286e 6577 5f68 746d 6c29 0a20 2020  ck(new_html).   
+00008b90: 2020 2020 2048 746d 6c47 726f 7570 2e61       HtmlGroup.a
+00008ba0: 6e6e 6f74 6174 655f 6970 6363 5f74 6172  nnotate_ipcc_tar
+00008bb0: 6765 745f 6964 7328 6e65 775f 6874 6d6c  get_ids(new_html
+00008bc0: 290a 2020 2020 2020 2020 6966 206f 7574  ).        if out
+00008bd0: 6469 723a 0a20 2020 2020 2020 2020 2020  dir:.           
+00008be0: 2048 746d 6c4c 6962 2e77 7269 7465 5f68   HtmlLib.write_h
+00008bf0: 746d 6c5f 6669 6c65 286e 6577 5f68 746d  tml_file(new_htm
+00008c00: 6c2c 2050 6174 6828 6f75 7464 6972 2c20  l, Path(outdir, 
+00008c10: 6622 7b73 7465 6d7d 5f67 726f 7570 732e  f"{stem}_groups.
+00008c20: 6874 6d6c 2229 2c20 6465 6275 673d 5472  html"), debug=Tr
+00008c30: 7565 290a 2020 2020 2020 2020 7370 6c69  ue).        spli
+00008c40: 745f 7370 616e 5f72 6567 6578 203d 2022  t_span_regex = "
+00008c50: 283f 503c 7072 653e 2e2a 283f 3a68 6967  (?P<pre>.*(?:hig
+00008c60: 687c 6d65 6469 756d 7c6c 6f77 295c 5c73  h|medium|low)\\s
+00008c70: 2a28 636f 6e66 6964 656e 6365 2929 283f  *(confidence))(?
+00008c80: 503c 706f 7374 3e2e 2a29 220a 2020 2020  P<post>.*)".    
+00008c90: 2020 2020 4874 6d6c 4772 6f75 702e 7370      HtmlGroup.sp
+00008ca0: 6c69 745f 7370 616e 7328 6e65 775f 6874  lit_spans(new_ht
+00008cb0: 6d6c 2c20 7370 6c69 745f 7370 616e 5f72  ml, split_span_r
+00008cc0: 6567 6578 290a 2020 2020 2020 2020 6966  egex).        if
+00008cd0: 206f 7574 6469 723a 0a20 2020 2020 2020   outdir:.       
+00008ce0: 2020 2020 2048 746d 6c4c 6962 2e77 7269       HtmlLib.wri
+00008cf0: 7465 5f68 746d 6c5f 6669 6c65 286e 6577  te_html_file(new
+00008d00: 5f68 746d 6c2c 2050 6174 6828 6f75 7464  _html, Path(outd
+00008d10: 6972 2c20 6622 7b73 7465 6d7d 5f73 7461  ir, f"{stem}_sta
+00008d20: 7465 6d65 6e74 732e 6874 6d6c 2229 2c20  tements.html"), 
+00008d30: 6465 6275 673d 5472 7565 290a 0a20 2020  debug=True)..   
+00008d40: 2020 2020 2072 6574 7572 6e20 6e65 775f       return new_
+00008d50: 6874 6d6c 0a0a 2020 2020 4063 6c61 7373  html..    @class
+00008d60: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
+00008d70: 726f 7570 5f6e 6573 7465 645f 7369 626c  roup_nested_sibl
+00008d80: 696e 6773 2863 6c73 2c20 6874 6d6c 5f65  ings(cls, html_e
+00008d90: 6c65 6d2c 2073 7479 6c65 733d 4e6f 6e65  lem, styles=None
+00008da0: 293a 0a20 2020 2020 2020 2069 6620 7374  ):.        if st
+00008db0: 796c 6573 2069 7320 4e6f 6e65 3a0a 2020  yles is None:.  
+00008dc0: 2020 2020 2020 2020 2020 7374 796c 6573            styles
+00008dd0: 203d 205b 0a20 2020 2020 2020 2020 2020   = [.           
+00008de0: 2022 626f 7264 6572 203a 2073 6f6c 6964   "border : solid
+00008df0: 2070 7572 706c 6520 3270 783b 206d 6172   purple 2px; mar
+00008e00: 6769 6e3a 3270 783b 222c 0a20 2020 2020  gin:2px;",.     
+00008e10: 2020 2020 2020 2022 626f 7264 6572 203a         "border :
+00008e20: 2064 6173 6865 6420 6772 6565 6e20 312e   dashed green 1.
+00008e30: 3570 783b 206d 6172 6769 6e3a 312e 3570  5px; margin:1.5p
+00008e40: 783b 222c 0a20 2020 2020 2020 2020 2020  x;",.           
+00008e50: 2022 626f 7264 6572 203a 2064 6f74 7465   "border : dotte
+00008e60: 6420 626c 7565 2031 7078 3b20 6d61 7267  d blue 1px; marg
+00008e70: 696e 3a31 7078 3b22 2c0a 2020 2020 2020  in:1px;",.      
+00008e80: 2020 2020 2020 5d0a 0a20 2020 2020 2020        ]..       
+00008e90: 2048 746d 6c47 726f 7570 2e67 726f 7570   HtmlGroup.group
+00008ea0: 5f73 6962 6c69 6e67 7328 6874 6d6c 5f65  _siblings(html_e
+00008eb0: 6c65 6d2c 206c 6f63 6174 6f72 3d22 7365  lem, locator="se
+00008ec0: 6374 696f 6e22 2c20 7374 796c 653d 7374  ction", style=st
+00008ed0: 796c 6573 5b30 5d29 0a20 2020 2020 2020  yles[0]).       
+00008ee0: 2048 746d 6c47 726f 7570 2e67 726f 7570   HtmlGroup.group
+00008ef0: 5f73 6962 6c69 6e67 7328 6874 6d6c 5f65  _siblings(html_e
+00008f00: 6c65 6d2c 206c 6f63 6174 6f72 3d22 7375  lem, locator="su
+00008f10: 625f 7365 6374 696f 6e22 2c20 7374 796c  b_section", styl
+00008f20: 653d 7374 796c 6573 5b31 5d2c 2064 6562  e=styles[1], deb
+00008f30: 7567 3d54 7275 6529 0a20 2020 2020 2020  ug=True).       
+00008f40: 2048 746d 6c47 726f 7570 2e67 726f 7570   HtmlGroup.group
+00008f50: 5f73 6962 6c69 6e67 7328 6874 6d6c 5f65  _siblings(html_e
+00008f60: 6c65 6d2c 206c 6f63 6174 6f72 3d22 7375  lem, locator="su
+00008f70: 625f 7375 625f 7365 6374 696f 6e22 2c20  b_sub_section", 
+00008f80: 7374 796c 653d 7374 796c 6573 5b32 5d29  style=styles[2])
+00008f90: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00008fa0: 6f64 0a20 2020 2064 6566 2061 6e6e 6f74  od.    def annot
+00008fb0: 6174 655f 6970 6363 5f74 6172 6765 745f  ate_ipcc_target_
+00008fc0: 6964 7328 636c 732c 2068 746d 6c5f 656c  ids(cls, html_el
+00008fd0: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
+00008fe0: 6669 6e64 7320 7365 6374 696f 6e73 206f  finds sections o
+00008ff0: 6620 666f 726d 207b 7461 7267 6574 5f69  f form {target_i
+00009000: 642c 2074 6172 6765 745f 6964 2e2e 2e7d  d, target_id...}
+00009010: 2061 6e64 2061 6464 7320 636c 6173 733d   and adds class=
+00009020: 7461 7267 6574 730a 2020 2020 2020 2020  targets.        
+00009030: 5468 6973 2069 7320 6265 7474 6572 2064  This is better d
+00009040: 6f6e 6520 696e 2074 6865 2061 6e6e 6f74  one in the annot
+00009050: 6174 6f72 2077 6f72 6b66 6c6f 7720 7768  ator workflow wh
+00009060: 6572 6520 6974 2077 6f72 6b73 2e20 5468  ere it works. Th
+00009070: 6973 2069 7320 6120 6861 636b 2066 6f72  is is a hack for
+00009080: 0a20 2020 2020 2020 2066 696c 6573 2077  .        files w
+00009090: 6869 6368 2068 6176 6520 6265 656e 206d  hich have been m
+000090a0: 6973 7365 6422 2222 0a20 2020 2020 2020  issed""".       
+000090b0: 2072 655f 6375 726c 7920 3d20 7265 2e63   re_curly = re.c
+000090c0: 6f6d 7069 6c65 2872 2228 3f50 3c70 7265  ompile(r"(?P<pre
+000090d0: 3e2e 2a29 7b28 3f50 3c62 6f64 793e 5b5e  >.*){(?P<body>[^
+000090e0: 7d5d 2b29 7d28 3f50 3c70 6f73 743e 2e2a  }]+)}(?P<post>.*
+000090f0: 2922 290a 2020 2020 2020 2020 5441 5247  )").        TARG
+00009100: 4554 5320 3d20 2274 6172 6765 7473 220a  ETS = "targets".
+00009110: 2020 2020 2020 2020 6375 726c 795f 7370          curly_sp
+00009120: 616e 7320 3d20 6874 6d6c 5f65 6c65 6d2e  ans = html_elem.
+00009130: 7870 6174 6828 6622 2e2f 2f73 7061 6e5b  xpath(f".//span[
+00009140: 636f 6e74 6169 6e73 282e 2c20 277b 7b27  contains(., '{{'
+00009150: 2920 616e 6420 636f 6e74 6169 6e73 282e  ) and contains(.
+00009160: 2c20 277d 7d27 295d 2229 0a20 2020 2020  , '}}')]").     
+00009170: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
+00009180: 6622 666f 756e 6420 6375 726c 6965 7320  f"found curlies 
+00009190: 7b6c 656e 2863 7572 6c79 5f73 7061 6e73  {len(curly_spans
+000091a0: 297d 2229 0a20 2020 2020 2020 2066 6f72  )}").        for
+000091b0: 2073 7061 6e20 696e 2063 7572 6c79 5f73   span in curly_s
+000091c0: 7061 6e73 3a0a 2020 2020 2020 2020 2020  pans:.          
+000091d0: 2020 7061 7265 6e74 203d 2073 7061 6e2e    parent = span.
+000091e0: 6765 7470 6172 656e 7428 290a 2020 2020  getparent().    
+000091f0: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
+00009200: 7265 5f63 7572 6c79 2e6d 6174 6368 2873  re_curly.match(s
+00009210: 7061 6e2e 7465 7874 290a 2020 2020 2020  pan.text).      
+00009220: 2020 2020 2020 6966 206d 6174 6368 3a0a        if match:.
+00009230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009240: 666f 7220 6770 2069 6e20 5b22 7072 6522  for gp in ["pre"
+00009250: 2c20 2262 6f64 7922 2c20 2270 6f73 7422  , "body", "post"
+00009260: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00009270: 2020 2020 2020 2074 203d 206d 6174 6368         t = match
+00009280: 2e67 726f 7570 2867 7029 0a20 2020 2020  .group(gp).     
+00009290: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000092a0: 6620 6c65 6e28 7429 203e 2030 3a0a 2020  f len(t) > 0:.  
+000092b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092c0: 2020 2020 2020 6966 2067 7020 3d3d 2022        if gp == "
+000092d0: 626f 6479 223a 0a20 2020 2020 2020 2020  body":.         
+000092e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000092f0: 2020 2074 6172 6765 745f 6964 7320 3d20     target_ids = 
+00009300: 7265 2e73 706c 6974 2822 5b2c 3b5d 222c  re.split("[,;]",
+00009310: 2074 290a 2020 2020 2020 2020 2020 2020   t).            
+00009320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009330: 666f 7220 7461 7267 6574 5f69 6420 696e  for target_id in
+00009340: 2074 6172 6765 745f 6964 733a 0a20 2020   target_ids:.   
 00009350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009360: 2061 203d 2045 542e 5375 6245 6c65 6d65   a = ET.SubEleme
-00009370: 6e74 2870 6172 656e 742c 2022 6122 290a  nt(parent, "a").
-00009380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009360: 2020 2020 2020 2020 2020 2020 2061 203d               a =
+00009370: 2045 542e 5375 6245 6c65 6d65 6e74 2870   ET.SubElement(p
+00009380: 6172 656e 742c 2022 6122 290a 2020 2020  arent, "a").    
 00009390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093a0: 7370 616e 2e61 6464 7072 6576 696f 7573  span.addprevious
-000093b0: 2861 290a 2020 2020 2020 2020 2020 2020  (a).            
+000093a0: 2020 2020 2020 2020 2020 2020 7370 616e              span
+000093b0: 2e61 6464 7072 6576 696f 7573 2861 290a  .addprevious(a).
 000093c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000093d0: 2020 2020 612e 7465 7874 203d 2074 6172      a.text = tar
-000093e0: 6765 745f 6964 0a20 2020 2020 2020 2020  get_id.         
-000093f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009400: 2020 2020 2020 2061 2e61 7474 7269 625b         a.attrib[
-00009410: 2268 7265 6622 5d20 3d20 6765 745f 7461  "href"] = get_ta
-00009420: 7267 6574 5f68 7265 6628 7429 0a20 2020  rget_href(t).   
-00009430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009440: 2020 2020 2020 2020 2023 2070 6172 656e           # paren
-00009450: 742e 7265 6d6f 7665 2873 7061 6e29 0a20  t.remove(span). 
-00009460: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009470: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00009480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009490: 2020 2020 2020 2020 2073 7061 6e78 203d           spanx =
-000094a0: 2045 542e 5375 6245 6c65 6d65 6e74 2870   ET.SubElement(p
-000094b0: 6172 656e 742c 2022 7370 616e 2229 0a20  arent, "span"). 
-000094c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000094d0: 2020 2020 2020 2020 2020 2073 7061 6e78             spanx
-000094e0: 2e74 6578 7420 3d20 740a 2020 2020 2020  .text = t.      
-000094f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009500: 2020 2020 2020 666f 7220 6174 7420 696e        for att in
-00009510: 2073 7061 6e2e 6174 7472 6962 3a0a 2020   span.attrib:.  
-00009520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009530: 2020 2020 2020 2020 2020 2020 2020 7370                sp
-00009540: 616e 782e 6174 7472 6962 5b61 7474 5d20  anx.attrib[att] 
-00009550: 3d20 7370 616e 2e61 7474 7269 625b 6174  = span.attrib[at
-00009560: 745d 0a20 2020 2020 2020 2020 2020 2020  t].             
-00009570: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00009580: 7061 6e2e 6164 6470 7265 7669 6f75 7328  pan.addprevious(
-00009590: 7370 616e 7829 0a20 2020 2020 2020 2020  spanx).         
-000095a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095b0: 2020 2073 7061 6e78 2e61 7474 7269 625b     spanx.attrib[
-000095c0: 2261 6e63 686f 7222 5d20 3d20 6770 0a0a  "anchor"] = gp..
-000095d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000095e0: 7061 7265 6e74 2e72 656d 6f76 6528 7370  parent.remove(sp
-000095f0: 616e 290a 0a0a 0a0a 2020 2020 2020 2020  an).....        
-00009600: 2020 2020 7370 616e 2e61 7474 7269 625b      span.attrib[
-00009610: 2263 6c61 7373 225d 203d 2054 4152 4745  "class"] = TARGE
-00009620: 5453 0a0a 0a0a 0a20 2020 2040 636c 6173  TS.....    @clas
-00009630: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00009640: 6578 7472 6163 745f 7365 6374 696f 6e5f  extract_section_
-00009650: 6964 7328 636c 732c 2068 746d 6c5f 656c  ids(cls, html_el
-00009660: 656d 2c20 7870 6174 6873 3d4e 6f6e 652c  em, xpaths=None,
-00009670: 2072 6567 6578 6573 3d4e 6f6e 6529 3a0a   regexes=None):.
-00009680: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00009690: 2020 2020 6578 7472 6163 7473 2073 6563      extracts sec
-000096a0: 7469 6f6e 7320 616e 6420 706f 7373 6962  tions and possib
-000096b0: 6c79 2073 7562 7365 6374 696f 6e73 2066  ly subsections f
-000096c0: 726f 6d20 636f 6d70 6f75 6e64 2065 6c65  rom compound ele
-000096d0: 6d65 6e74 7320 2865 2e67 2e20 6469 7629  ments (e.g. div)
-000096e0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000096f0: 6874 6d6c 5f65 6c65 6d3a 2063 6f6d 706f  html_elem: compo
-00009700: 756e 6420 656c 656d 656e 740a 2020 2020  und element.    
-00009710: 2020 2020 3a70 6172 616d 2078 7061 7468      :param xpath
-00009720: 733a 206c 6973 7420 6f66 2078 7061 7468  s: list of xpath
-00009730: 2066 6f72 2073 6563 7469 6f6e 2c20 6f70   for section, op
-00009740: 7469 6f6e 616c 2073 7562 7365 6374 696f  tional subsectio
-00009750: 6e2c 2063 7572 7265 6e74 6c79 206c 656e  n, currently len
-00009760: 2031 206f 7220 322c 0a20 2020 2020 2020   1 or 2,.       
-00009770: 2020 2073 696e 676c 6520 7870 6174 6820     single xpath 
-00009780: 6973 2074 6865 6e20 7772 6170 7065 6420  is then wrapped 
-00009790: 746f 206c 6973 743b 2064 6566 6175 6c74  to list; default
-000097a0: 7320 746f 2020 5b22 2e2f 2f64 6976 222c  s to  [".//div",
-000097b0: 2022 2e2f 7370 616e 225d 0a20 2020 2020   "./span"].     
-000097c0: 2020 203a 7061 7261 6d20 7265 6765 7865     :param regexe
-000097d0: 733a 206c 6973 7420 6f66 2072 6567 6578  s: list of regex
-000097e0: 6573 2066 6f72 2065 6163 6820 6465 7363  es for each desc
-000097f0: 656e 743b 2073 696e 676c 6520 6973 2077  ent; single is w
-00009800: 7261 7070 6564 2074 6f20 6c69 7374 203b  rapped to list ;
-00009810: 2069 6620 6e6f 6e65 2067 6976 656e 0a20   if none given. 
-00009820: 2020 2020 2020 2020 2061 6363 6570 7473           accepts
-00009830: 2061 6c6c 2064 6573 6365 6e64 616e 7473   all descendants
-00009840: 2066 726f 6d20 7870 6174 680a 2020 2020   from xpath.    
-00009850: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00009860: 6966 206e 6f74 2078 7061 7468 733a 0a20  if not xpaths:. 
-00009870: 2020 2020 2020 2020 2020 2078 7061 7468             xpath
-00009880: 7320 3d20 5b22 2e2f 2f64 6976 222c 2022  s = [".//div", "
-00009890: 2e2f 7370 616e 225d 0a20 2020 2020 2020  ./span"].       
-000098a0: 2069 6620 6e6f 7420 7479 7065 2878 7061   if not type(xpa
-000098b0: 7468 7329 2069 7320 6c69 7374 3a0a 2020  ths) is list:.  
-000098c0: 2020 2020 2020 2020 2020 7870 6174 6873            xpaths
-000098d0: 203d 205b 7870 6174 6873 5d0a 2020 2020   = [xpaths].    
-000098e0: 2020 2020 6173 7365 7274 2030 203c 206c      assert 0 < l
-000098f0: 656e 2878 7061 7468 7329 203c 3d20 322c  en(xpaths) <= 2,
-00009900: 2066 226e 6f20 7870 6174 6873 2067 6976   f"no xpaths giv
-00009910: 656e 220a 0a20 2020 2020 2020 2069 6620  en"..        if 
-00009920: 6e6f 7420 7265 6765 7865 733a 0a20 2020  not regexes:.   
-00009930: 2020 2020 2020 2020 2072 6567 6578 6573           regexes
-00009940: 203d 205b 5d0a 2020 2020 2020 2020 6966   = [].        if
-00009950: 206e 6f74 2074 7970 6528 7265 6765 7865   not type(regexe
-00009960: 7329 2069 7320 6c69 7374 3a0a 2020 2020  s) is list:.    
-00009970: 2020 2020 2020 2020 7265 6765 7865 7320          regexes 
-00009980: 3d20 5b72 6567 6578 6573 5d0a 0a20 2020  = [regexes]..   
-00009990: 2020 2020 2064 6976 7320 3d20 6874 6d6c       divs = html
-000099a0: 5f65 6c65 6d2e 7870 6174 6828 7870 6174  _elem.xpath(xpat
-000099b0: 6873 5b30 5d29 0a20 2020 2020 2020 2073  hs[0]).        s
-000099c0: 6563 7469 6f6e 7320 3d20 5b5d 0a20 2020  ections = [].   
-000099d0: 2020 2020 2073 7562 7365 6374 696f 6e73       subsections
-000099e0: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-000099f0: 7220 6469 7620 696e 2064 6976 733a 0a20  r div in divs:. 
-00009a00: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-00009a10: 6e28 7265 6765 7865 7329 203e 2030 2061  n(regexes) > 0 a
-00009a20: 6e64 2072 6567 6578 6573 5b30 5d3a 0a20  nd regexes[0]:. 
-00009a30: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00009a40: 6563 7469 6f6e 5f69 6420 3d20 4874 6d6c  ection_id = Html
-00009a50: 5574 696c 2e65 7874 7261 6374 5f73 7562  Util.extract_sub
-00009a60: 7374 7269 6e67 7328 6469 762c 2078 7061  strings(div, xpa
-00009a70: 7468 3d78 7061 7468 735b 305d 2c20 7265  th=xpaths[0], re
-00009a80: 6765 783d 7265 6765 7865 735b 305d 290a  gex=regexes[0]).
-00009a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009aa0: 6966 2073 6563 7469 6f6e 5f69 643a 0a20  if section_id:. 
-00009ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ac0: 2020 2073 6563 7469 6f6e 732e 6170 7065     sections.appe
-00009ad0: 6e64 2873 6563 7469 6f6e 5f69 6429 0a20  nd(section_id). 
-00009ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009af0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-00009b00: 2020 2020 2020 2020 6966 206c 656e 2028          if len (
-00009b10: 7265 6765 7865 7329 203e 2031 2061 6e64  regexes) > 1 and
-00009b20: 2072 6567 6578 6573 5b31 5d3a 0a20 2020   regexes[1]:.   
-00009b30: 2020 2020 2020 2020 2020 2020 2073 7562               sub
-00009b40: 7365 6374 696f 6e5f 6964 203d 2048 746d  section_id = Htm
-00009b50: 6c55 7469 6c2e 6578 7472 6163 745f 7375  lUtil.extract_su
-00009b60: 6273 7472 696e 6773 2864 6976 2c20 7870  bstrings(div, xp
-00009b70: 6174 683d 7870 6174 6873 5b31 5d2c 0a20  ath=xpaths[1],. 
-00009b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000093e0: 612e 7465 7874 203d 2074 6172 6765 745f  a.text = target_
+000093f0: 6964 0a20 2020 2020 2020 2020 2020 2020  id.             
+00009400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009410: 2020 2061 2e61 7474 7269 625b 2268 7265     a.attrib["hre
+00009420: 6622 5d20 3d20 6765 745f 7461 7267 6574  f"] = get_target
+00009430: 5f68 7265 6628 7429 0a20 2020 2020 2020  _href(t).       
+00009440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009450: 2020 2020 2023 2070 6172 656e 742e 7265       # parent.re
+00009460: 6d6f 7665 2873 7061 6e29 0a20 2020 2020  move(span).     
+00009470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009480: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00009490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094a0: 2020 2020 2073 7061 6e78 203d 2045 542e       spanx = ET.
+000094b0: 5375 6245 6c65 6d65 6e74 2870 6172 656e  SubElement(paren
+000094c0: 742c 2022 7370 616e 2229 0a20 2020 2020  t, "span").     
+000094d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000094e0: 2020 2020 2020 2073 7061 6e78 2e74 6578         spanx.tex
+000094f0: 7420 3d20 740a 2020 2020 2020 2020 2020  t = t.          
+00009500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009510: 2020 666f 7220 6174 7420 696e 2073 7061    for att in spa
+00009520: 6e2e 6174 7472 6962 3a0a 2020 2020 2020  n.attrib:.      
+00009530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009540: 2020 2020 2020 2020 2020 7370 616e 782e            spanx.
+00009550: 6174 7472 6962 5b61 7474 5d20 3d20 7370  attrib[att] = sp
+00009560: 616e 2e61 7474 7269 625b 6174 745d 0a20  an.attrib[att]. 
+00009570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009580: 2020 2020 2020 2020 2020 2073 7061 6e2e             span.
+00009590: 6164 6470 7265 7669 6f75 7328 7370 616e  addprevious(span
+000095a0: 7829 0a20 2020 2020 2020 2020 2020 2020  x).             
+000095b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+000095c0: 7061 6e78 2e61 7474 7269 625b 2261 6e63  panx.attrib["anc
+000095d0: 686f 7222 5d20 3d20 6770 0a0a 2020 2020  hor"] = gp..    
+000095e0: 2020 2020 2020 2020 2020 2020 7061 7265              pare
+000095f0: 6e74 2e72 656d 6f76 6528 7370 616e 290a  nt.remove(span).
+00009600: 0a0a 0a0a 2020 2020 2020 2020 2020 2020  ....            
+00009610: 7370 616e 2e61 7474 7269 625b 2263 6c61  span.attrib["cla
+00009620: 7373 225d 203d 2054 4152 4745 5453 0a0a  ss"] = TARGETS..
+00009630: 0a0a 0a20 2020 2040 636c 6173 736d 6574  ...    @classmet
+00009640: 686f 640a 2020 2020 6465 6620 6578 7472  hod.    def extr
+00009650: 6163 745f 7365 6374 696f 6e5f 6964 7328  act_section_ids(
+00009660: 636c 732c 2068 746d 6c5f 656c 656d 2c20  cls, html_elem, 
+00009670: 7870 6174 6873 3d4e 6f6e 652c 2072 6567  xpaths=None, reg
+00009680: 6578 6573 3d4e 6f6e 6529 3a0a 2020 2020  exes=None):.    
+00009690: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000096a0: 6578 7472 6163 7473 2073 6563 7469 6f6e  extracts section
+000096b0: 7320 616e 6420 706f 7373 6962 6c79 2073  s and possibly s
+000096c0: 7562 7365 6374 696f 6e73 2066 726f 6d20  ubsections from 
+000096d0: 636f 6d70 6f75 6e64 2065 6c65 6d65 6e74  compound element
+000096e0: 7320 2865 2e67 2e20 6469 7629 0a20 2020  s (e.g. div).   
+000096f0: 2020 2020 203a 7061 7261 6d20 6874 6d6c       :param html
+00009700: 5f65 6c65 6d3a 2063 6f6d 706f 756e 6420  _elem: compound 
+00009710: 656c 656d 656e 740a 2020 2020 2020 2020  element.        
+00009720: 3a70 6172 616d 2078 7061 7468 733a 206c  :param xpaths: l
+00009730: 6973 7420 6f66 2078 7061 7468 2066 6f72  ist of xpath for
+00009740: 2073 6563 7469 6f6e 2c20 6f70 7469 6f6e   section, option
+00009750: 616c 2073 7562 7365 6374 696f 6e2c 2063  al subsection, c
+00009760: 7572 7265 6e74 6c79 206c 656e 2031 206f  urrently len 1 o
+00009770: 7220 322c 0a20 2020 2020 2020 2020 2073  r 2,.          s
+00009780: 696e 676c 6520 7870 6174 6820 6973 2074  ingle xpath is t
+00009790: 6865 6e20 7772 6170 7065 6420 746f 206c  hen wrapped to l
+000097a0: 6973 743b 2064 6566 6175 6c74 7320 746f  ist; defaults to
+000097b0: 2020 5b22 2e2f 2f64 6976 222c 2022 2e2f    [".//div", "./
+000097c0: 7370 616e 225d 0a20 2020 2020 2020 203a  span"].        :
+000097d0: 7061 7261 6d20 7265 6765 7865 733a 206c  param regexes: l
+000097e0: 6973 7420 6f66 2072 6567 6578 6573 2066  ist of regexes f
+000097f0: 6f72 2065 6163 6820 6465 7363 656e 743b  or each descent;
+00009800: 2073 696e 676c 6520 6973 2077 7261 7070   single is wrapp
+00009810: 6564 2074 6f20 6c69 7374 203b 2069 6620  ed to list ; if 
+00009820: 6e6f 6e65 2067 6976 656e 0a20 2020 2020  none given.     
+00009830: 2020 2020 2061 6363 6570 7473 2061 6c6c       accepts all
+00009840: 2064 6573 6365 6e64 616e 7473 2066 726f   descendants fro
+00009850: 6d20 7870 6174 680a 2020 2020 2020 2020  m xpath.        
+00009860: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
+00009870: 6f74 2078 7061 7468 733a 0a20 2020 2020  ot xpaths:.     
+00009880: 2020 2020 2020 2078 7061 7468 7320 3d20         xpaths = 
+00009890: 5b22 2e2f 2f64 6976 222c 2022 2e2f 7370  [".//div", "./sp
+000098a0: 616e 225d 0a20 2020 2020 2020 2069 6620  an"].        if 
+000098b0: 6e6f 7420 7479 7065 2878 7061 7468 7329  not type(xpaths)
+000098c0: 2069 7320 6c69 7374 3a0a 2020 2020 2020   is list:.      
+000098d0: 2020 2020 2020 7870 6174 6873 203d 205b        xpaths = [
+000098e0: 7870 6174 6873 5d0a 2020 2020 2020 2020  xpaths].        
+000098f0: 6173 7365 7274 2030 203c 206c 656e 2878  assert 0 < len(x
+00009900: 7061 7468 7329 203c 3d20 322c 2066 226e  paths) <= 2, f"n
+00009910: 6f20 7870 6174 6873 2067 6976 656e 220a  o xpaths given".
+00009920: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00009930: 7265 6765 7865 733a 0a20 2020 2020 2020  regexes:.       
+00009940: 2020 2020 2072 6567 6578 6573 203d 205b       regexes = [
+00009950: 5d0a 2020 2020 2020 2020 6966 206e 6f74  ].        if not
+00009960: 2074 7970 6528 7265 6765 7865 7329 2069   type(regexes) i
+00009970: 7320 6c69 7374 3a0a 2020 2020 2020 2020  s list:.        
+00009980: 2020 2020 7265 6765 7865 7320 3d20 5b72      regexes = [r
+00009990: 6567 6578 6573 5d0a 0a20 2020 2020 2020  egexes]..       
+000099a0: 2064 6976 7320 3d20 6874 6d6c 5f65 6c65   divs = html_ele
+000099b0: 6d2e 7870 6174 6828 7870 6174 6873 5b30  m.xpath(xpaths[0
+000099c0: 5d29 0a20 2020 2020 2020 2073 6563 7469  ]).        secti
+000099d0: 6f6e 7320 3d20 5b5d 0a20 2020 2020 2020  ons = [].       
+000099e0: 2073 7562 7365 6374 696f 6e73 203d 205b   subsections = [
+000099f0: 5d0a 2020 2020 2020 2020 666f 7220 6469  ].        for di
+00009a00: 7620 696e 2064 6976 733a 0a20 2020 2020  v in divs:.     
+00009a10: 2020 2020 2020 2069 6620 6c65 6e28 7265         if len(re
+00009a20: 6765 7865 7329 203e 2030 2061 6e64 2072  gexes) > 0 and r
+00009a30: 6567 6578 6573 5b30 5d3a 0a20 2020 2020  egexes[0]:.     
+00009a40: 2020 2020 2020 2020 2020 2073 6563 7469             secti
+00009a50: 6f6e 5f69 6420 3d20 4874 6d6c 5574 696c  on_id = HtmlUtil
+00009a60: 2e65 7874 7261 6374 5f73 7562 7374 7269  .extract_substri
+00009a70: 6e67 7328 6469 762c 2078 7061 7468 3d78  ngs(div, xpath=x
+00009a80: 7061 7468 735b 305d 2c20 7265 6765 783d  paths[0], regex=
+00009a90: 7265 6765 7865 735b 305d 290a 2020 2020  regexes[0]).    
+00009aa0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+00009ab0: 6563 7469 6f6e 5f69 643a 0a20 2020 2020  ection_id:.     
+00009ac0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00009ad0: 6563 7469 6f6e 732e 6170 7065 6e64 2873  ections.append(s
+00009ae0: 6563 7469 6f6e 5f69 6429 0a20 2020 2020  ection_id).     
+00009af0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00009b00: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00009b10: 2020 2020 6966 206c 656e 2028 7265 6765      if len (rege
+00009b20: 7865 7329 203e 2031 2061 6e64 2072 6567  xes) > 1 and reg
+00009b30: 6578 6573 5b31 5d3a 0a20 2020 2020 2020  exes[1]:.       
+00009b40: 2020 2020 2020 2020 2073 7562 7365 6374           subsect
+00009b50: 696f 6e5f 6964 203d 2048 746d 6c55 7469  ion_id = HtmlUti
+00009b60: 6c2e 6578 7472 6163 745f 7375 6273 7472  l.extract_substr
+00009b70: 696e 6773 2864 6976 2c20 7870 6174 683d  ings(div, xpath=
+00009b80: 7870 6174 6873 5b31 5d2c 0a20 2020 2020  xpaths[1],.     
 00009b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bb0: 2020 2020 2020 2020 2020 2072 6567 6578             regex
-00009bc0: 3d72 6567 6578 6573 5b31 5d2c 0a20 2020  =regexes[1],.   
-00009bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009bc0: 2020 2020 2020 2072 6567 6578 3d72 6567         regex=reg
+00009bd0: 6578 6573 5b31 5d2c 0a20 2020 2020 2020  exes[1],.       
 00009be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c00: 2020 2020 2020 2020 2072 656d 6f76 653d           remove=
-00009c10: 4661 6c73 6529 0a20 2020 2020 2020 2020  False).         
-00009c20: 2020 2020 2020 2069 6620 7375 6273 6563         if subsec
-00009c30: 7469 6f6e 5f69 643a 0a20 2020 2020 2020  tion_id:.       
-00009c40: 2020 2020 2020 2020 2020 2020 2073 7562               sub
-00009c50: 7365 6374 696f 6e73 2e61 7070 656e 6428  sections.append(
-00009c60: 7375 6273 6563 7469 6f6e 5f69 6429 0a20  subsection_id). 
-00009c70: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00009c80: 6374 696f 6e73 2c20 7375 6273 6563 7469  ctions, subsecti
-00009c90: 6f6e 730a 0a20 2020 2040 636c 6173 736d  ons..    @classm
-00009ca0: 6574 686f 640a 2020 2020 6465 6620 616e  ethod.    def an
-00009cb0: 6e6f 7461 7465 5f64 6976 5f73 7061 6e73  notate_div_spans
-00009cc0: 5f77 7269 7465 5f66 696e 616c 5f68 746d  _write_final_htm
-00009cd0: 6c28 636c 732c 2069 6e70 7574 5f68 746d  l(cls, input_htm
-00009ce0: 6c2c 206f 7574 6669 6c65 2c20 7374 796c  l, outfile, styl
-00009cf0: 6573 3d4e 6f6e 6529 3a0a 2020 2020 2020  es=None):.      
-00009d00: 2020 6966 206e 6f74 2073 7479 6c65 733a    if not styles:
-00009d10: 0a20 2020 2020 2020 2020 2020 2073 7479  .            sty
-00009d20: 6c65 7320 3d20 4874 6d6c 4772 6f75 702e  les = HtmlGroup.
-00009d30: 4445 4641 554c 545f 5354 594c 4553 0a20  DEFAULT_STYLES. 
-00009d40: 2020 2020 2020 2068 746d 6c5f 656c 656d         html_elem
-00009d50: 203d 2045 542e 7061 7273 6528 7374 7228   = ET.parse(str(
-00009d60: 696e 7075 745f 6874 6d6c 2929 2e67 6574  input_html)).get
-00009d70: 726f 6f74 2829 0a20 2020 2020 2020 2061  root().        a
-00009d80: 6e6e 6f74 6174 6f72 203d 2048 746d 6c41  nnotator = HtmlA
-00009d90: 6e6e 6f74 6174 6f72 2e63 7265 6174 655f  nnotator.create_
-00009da0: 6970 6363 5f61 6e6e 6f74 6174 6f72 2829  ipcc_annotator()
-00009db0: 0a20 2020 2020 2020 2048 746d 6c53 7479  .        HtmlSty
-00009dc0: 6c65 2e61 6464 5f68 6561 645f 7374 796c  le.add_head_styl
-00009dd0: 6573 5f6f 7269 6728 6874 6d6c 5f65 6c65  es_orig(html_ele
-00009de0: 6d2c 2073 7479 6c65 7329 0a20 2020 2020  m, styles).     
-00009df0: 2020 2073 7061 6e73 203d 2068 746d 6c5f     spans = html_
-00009e00: 656c 656d 2e78 7061 7468 2822 2e2f 2f73  elem.xpath(".//s
-00009e10: 7061 6e22 290a 2020 2020 2020 2020 666f  pan").        fo
-00009e20: 7220 7370 616e 2069 6e20 7370 616e 733a  r span in spans:
-00009e30: 0a20 2020 2020 2020 2020 2020 2061 6e6e  .            ann
-00009e40: 6f74 6174 6f72 2e72 756e 5f63 6f6d 6d61  otator.run_comma
-00009e50: 6e64 7328 7370 616e 290a 2020 2020 2020  nds(span).      
-00009e60: 2020 4874 6d6c 4772 6f75 702e 6772 6f75    HtmlGroup.grou
-00009e70: 705f 6e65 7374 6564 5f73 6962 6c69 6e67  p_nested_sibling
-00009e80: 7328 6874 6d6c 5f65 6c65 6d2c 2073 7479  s(html_elem, sty
-00009e90: 6c65 733d 4e6f 6e65 290a 2020 2020 2020  les=None).      
-00009ea0: 2020 4874 6d6c 4c69 622e 7772 6974 655f    HtmlLib.write_
-00009eb0: 6874 6d6c 5f66 696c 6528 6874 6d6c 5f65  html_file(html_e
-00009ec0: 6c65 6d2c 206f 7574 6669 6c65 2c20 6465  lem, outfile, de
-00009ed0: 6275 673d 5472 7565 290a 0a20 2020 2040  bug=True)..    @
-00009ee0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00009ef0: 6465 6620 7370 6c69 745f 7370 616e 7328  def split_spans(
-00009f00: 636c 732c 2068 746d 6c2c 2073 706c 6974  cls, html, split
-00009f10: 5f73 7061 6e5f 7265 6765 7829 3a0a 2020  _span_regex):.  
-00009f20: 2020 2020 2020 7265 5f73 706c 6974 203d        re_split =
-00009f30: 2072 652e 636f 6d70 696c 6528 7370 6c69   re.compile(spli
-00009f40: 745f 7370 616e 5f72 6567 6578 290a 2020  t_span_regex).  
-00009f50: 2020 2020 2020 7370 616e 7320 3d20 6874        spans = ht
-00009f60: 6d6c 2e78 7061 7468 2822 2f2f 7370 616e  ml.xpath("//span
-00009f70: 2229 0a20 2020 2020 2020 206e 7370 616e  ").        nspan
-00009f80: 7320 3d20 6c65 6e28 7370 616e 7329 0a0a  s = len(spans)..
-00009f90: 2020 2020 2020 2020 636c 732e 7363 616e          cls.scan
-00009fa0: 5f72 656d 6169 6e69 6e67 5f73 7061 6e73  _remaining_spans
-00009fb0: 2872 655f 7370 6c69 742c 2073 7061 6e73  (re_split, spans
-00009fc0: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
-00009fd0: 686f 640a 2020 2020 6465 6620 7363 616e  hod.    def scan
-00009fe0: 5f72 656d 6169 6e69 6e67 5f73 7061 6e73  _remaining_spans
-00009ff0: 2863 6c73 2c20 7265 5f73 706c 6974 2c20  (cls, re_split, 
-0000a000: 7370 616e 7329 3a0a 2020 2020 2020 2020  spans):.        
-0000a010: 6469 7620 3d20 4e6f 6e65 0a20 2020 2020  div = None.     
-0000a020: 2020 2077 6869 6c65 206c 656e 2873 7061     while len(spa
-0000a030: 6e73 2920 3e20 303a 0a20 2020 2020 2020  ns) > 0:.       
-0000a040: 2020 2020 2066 6f72 2069 2c20 7370 616e       for i, span
-0000a050: 2069 6e20 656e 756d 6572 6174 6528 7370   in enumerate(sp
-0000a060: 616e 7329 3a0a 2020 2020 2020 2020 2020  ans):.          
-0000a070: 2020 2020 2020 6966 2064 6976 2069 7320        if div is 
-0000a080: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0000a090: 2020 2020 2020 2020 2020 2020 2020 6469                di
-0000a0a0: 762e 6170 7065 6e64 2873 7061 6e29 0a20  v.append(span). 
-0000a0b0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0000a0c0: 6174 6368 203d 2072 655f 7370 6c69 742e  atch = re_split.
-0000a0d0: 6d61 7463 6828 7370 616e 2e74 6578 7429  match(span.text)
-0000a0e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a0f0: 2069 6620 6d61 7463 683a 0a20 2020 2020   if match:.     
-0000a100: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000a110: 7265 203d 206d 6174 6368 2e67 726f 7570  re = match.group
-0000a120: 2822 7072 6522 290a 2020 2020 2020 2020  ("pre").        
-0000a130: 2020 2020 2020 2020 2020 2020 706f 7374              post
-0000a140: 203d 206d 6174 6368 2e67 726f 7570 2822   = match.group("
-0000a150: 706f 7374 2229 0a20 2020 2020 2020 2020  post").         
-0000a160: 2020 2020 2020 2020 2020 2073 7061 6e2e             span.
-0000a170: 7465 7874 203d 2070 7265 0a20 2020 2020  text = pre.     
-0000a180: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0000a190: 6172 656e 745f 6469 7620 3d20 7370 616e  arent_div = span
-0000a1a0: 2e67 6574 7061 7265 6e74 2829 0a20 2020  .getparent().   
-0000a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1c0: 206e 6578 745f 7370 616e 203d 2045 542e   next_span = ET.
-0000a1d0: 5375 6245 6c65 6d65 6e74 2870 6172 656e  SubElement(paren
-0000a1e0: 745f 6469 762c 2022 7370 616e 2229 0a20  t_div, "span"). 
-0000a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a200: 2020 2066 6f72 2061 7474 2069 6e20 7370     for att in sp
-0000a210: 616e 2e61 7474 7269 623a 0a20 2020 2020  an.attrib:.     
-0000a220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a230: 2020 206e 6578 745f 7370 616e 2e61 7474     next_span.att
-0000a240: 7269 625b 6174 745b 305d 5d20 3d20 6174  rib[att[0]] = at
-0000a250: 745b 315d 0a20 2020 2020 2020 2020 2020  t[1].           
-0000a260: 2020 2020 2020 2020 2020 2020 2073 7061               spa
-0000a270: 6e2e 6164 646e 6578 7428 6e65 7874 5f73  n.addnext(next_s
-0000a280: 7061 6e29 0a20 2020 2020 2020 2020 2020  pan).           
-0000a290: 2020 2020 2020 2020 2073 7061 6e73 203d           spans =
-0000a2a0: 2073 7061 6e73 5b69 202b 2031 3a5d 0a20   spans[i + 1:]. 
-0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2c0: 2020 2064 6976 203d 2045 542e 5375 6245     div = ET.SubE
-0000a2d0: 6c65 6d65 6e74 2870 6172 656e 745f 6469  lement(parent_di
-0000a2e0: 762e 6765 7470 6172 656e 7428 292c 2022  v.getparent(), "
-0000a2f0: 6469 7622 290a 0a20 2020 2020 2020 2020  div")..         
-0000a300: 2020 2020 2020 2020 2020 2062 7265 616b             break
-0000a310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a320: 2069 6620 6920 3d3d 206c 656e 2873 7061   if i == len(spa
-0000a330: 6e73 2920 2d20 313a 0a20 2020 2020 2020  ns) - 1:.       
-0000a340: 2020 2020 2020 2020 2020 2020 2073 7061               spa
-0000a350: 6e73 203d 205b 5d0a 0a0a 0a63 6c61 7373  ns = []....class
-0000a360: 2048 746d 6c55 7469 6c3a 0a20 2020 2053   HtmlUtil:.    S
-0000a370: 4352 4950 545f 4641 4354 203d 2030 2e39  CRIPT_FACT = 0.9
-0000a380: 2020 2320 6d61 7962 6520 7368 6f6c 646e    # maybe sholdn
-0000a390: 2774 2062 6520 6865 7265 3b20 6176 6f69  't be here; avoi
-0000a3a0: 6420 6369 7263 756c 6172 0a20 2020 204d  d circular.    M
-0000a3b0: 4152 4b45 5220 3d20 226d 6172 6b65 7222  ARKER = "marker"
-0000a3c0: 0a0a 0a20 2020 2040 636c 6173 736d 6574  ...    @classmet
-0000a3d0: 686f 640a 2020 2020 6465 6620 7265 6d6f  hod.    def remo
-0000a3e0: 7665 5f65 6d70 7479 5f65 6c65 6d65 6e74  ve_empty_element
-0000a3f0: 7328 636c 732c 2065 6c65 6d2c 2074 6167  s(cls, elem, tag
-0000a400: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0000a410: 2020 2020 2020 204d 6179 6265 206d 6f76         Maybe mov
-0000a420: 6520 746f 2048 544d 4c54 6964 790a 2020  e to HTMLTidy.  
-0000a430: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000a440: 2020 6966 2074 6167 3a0a 2020 2020 2020    if tag:.      
-0000a450: 2020 2020 2020 6966 2074 7970 6528 7461        if type(ta
-0000a460: 6729 2069 7320 6c69 7374 3a0a 2020 2020  g) is list:.    
-0000a470: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0000a480: 7420 696e 2074 6167 3a0a 2020 2020 2020  t in tag:.      
-0000a490: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-0000a4a0: 732e 7265 6d6f 7665 5f65 6d70 7479 5f65  s.remove_empty_e
-0000a4b0: 6c65 6d65 6e74 7328 656c 656d 2c20 7429  lements(elem, t)
-0000a4c0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0000a4d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000a4e0: 2020 2078 7020 3d20 6622 2e2f 2f7b 7461     xp = f".//{ta
-0000a4f0: 677d 5b6e 6f72 6d61 6c69 7a65 2d73 7061  g}[normalize-spa
-0000a500: 6365 282e 293d 2727 2061 6e64 2063 6f75  ce(.)='' and cou
-0000a510: 6e74 287b 7461 677d 2f2a 2920 3d20 305d  nt({tag}/*) = 0]
-0000a520: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000a530: 2020 656c 656d 7320 3d20 656c 656d 2e78    elems = elem.x
-0000a540: 7061 7468 2878 7029 0a20 2020 2020 2020  path(xp).       
-0000a550: 2020 2020 2020 2020 2066 6f72 2065 6c20           for el 
-0000a560: 696e 2065 6c65 6d73 3a0a 2020 2020 2020  in elems:.      
-0000a570: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-0000a580: 732e 7265 6d6f 7665 5f65 6c65 6d5f 6b65  s.remove_elem_ke
-0000a590: 6570 5f74 6169 6c28 656c 290a 0a20 2020  ep_tail(el)..   
-0000a5a0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-0000a5b0: 2020 6465 6620 7265 6d6f 7665 5f65 6c65    def remove_ele
-0000a5c0: 6d5f 6b65 6570 5f74 6169 6c28 636c 732c  m_keep_tail(cls,
-0000a5d0: 2065 6c29 3a0a 2020 2020 2020 2020 2222   el):.        ""
-0000a5e0: 220a 2020 2020 2020 2020 4d61 7962 6520  ".        Maybe 
-0000a5f0: 6d6f 7665 2074 6f20 4854 4d4c 5469 6479  move to HTMLTidy
-0000a600: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000a610: 2020 2020 2070 6172 656e 7420 3d20 656c       parent = el
-0000a620: 2e67 6574 7061 7265 6e74 2829 0a20 2020  .getparent().   
-0000a630: 2020 2020 2074 6169 6c20 3d20 656c 2e74       tail = el.t
-0000a640: 6169 6c0a 2020 2020 2020 2020 6966 2074  ail.        if t
-0000a650: 6169 6c20 6973 206e 6f74 204e 6f6e 6520  ail is not None 
-0000a660: 616e 6420 6c65 6e28 7461 696c 2e73 7472  and len(tail.str
-0000a670: 6970 2829 2920 3e20 303a 0a20 2020 2020  ip()) > 0:.     
-0000a680: 2020 2020 2020 2070 7265 7620 3d20 656c         prev = el
-0000a690: 2e67 6574 7072 6576 696f 7573 2829 0a20  .getprevious(). 
-0000a6a0: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
-0000a6b0: 6576 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ev is not None:.
-0000a6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6d0: 7072 6576 2e74 6169 6c20 3d20 2870 7265  prev.tail = (pre
-0000a6e0: 762e 7461 696c 206f 7220 2727 2920 2b20  v.tail or '') + 
-0000a6f0: 656c 2e74 6169 6c0a 2020 2020 2020 2020  el.tail.        
-0000a700: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000a710: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
-0000a720: 2e74 6578 7420 3d20 2870 6172 656e 742e  .text = (parent.
-0000a730: 7465 7874 206f 7220 2727 2920 2b20 656c  text or '') + el
-0000a740: 2e74 6169 6c0a 0a20 2020 2020 2020 2070  .tail..        p
-0000a750: 6172 656e 742e 7265 6d6f 7665 2865 6c29  arent.remove(el)
-0000a760: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-0000a770: 6f64 0a20 2020 2064 6566 2073 706c 6974  od.    def split
-0000a780: 5f73 7061 6e5f 6174 5f6d 6174 6368 2863  _span_at_match(c
-0000a790: 6c73 2c20 656c 656d 782c 2072 6567 6578  ls, elemx, regex
-0000a7a0: 2c20 636f 7079 5f61 7474 733d 5472 7565  , copy_atts=True
-0000a7b0: 2c20 7265 6375 7273 653d 5472 7565 2c20  , recurse=True, 
-0000a7c0: 6964 5f72 6f6f 743d 4e6f 6e65 2c20 6964  id_root=None, id
-0000a7d0: 5f63 6f75 6e74 6572 3d30 2c0a 2020 2020  _counter=0,.    
-0000a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a7f0: 2020 2020 2020 2020 6e65 775f 7461 6773          new_tags
-0000a800: 3d4e 6f6e 6529 3a0a 2020 2020 2020 2020  =None):.        
-0000a810: 2222 2273 706c 6974 7320 616e 2065 6c65  """splits an ele
-0000a820: 6d20 286e 6f72 6d61 6c6c 7920 7370 616e  m (normally span
-0000a830: 2920 696e 746f 2033 2063 6f6d 706f 6e65  ) into 3 compone
-0000a840: 6e74 7320 6279 2072 6567 6578 206d 6174  nts by regex mat
-0000a850: 6368 0a20 2020 2020 2020 203a 7061 7261  ch.        :para
-0000a860: 6d20 656c 656d 783a 2065 6c65 6d20 746f  m elemx: elem to
-0000a870: 2073 706c 6974 2028 6e6f 726d 616c 6c79   split (normally
-0000a880: 2068 6173 2061 2070 6172 656e 7420 2865   has a parent (e
-0000a890: 2e67 2e20 6469 7629 0a20 2020 2020 2020  .g. div).       
-0000a8a0: 203a 7061 7261 6d20 7265 6765 783a 2072   :param regex: r
-0000a8b0: 6567 6578 2074 6f20 7370 6c69 7420 656c  egex to split el
-0000a8c0: 656d 2028 6f66 2066 6f72 6d20 2870 7265  em (of form (pre
-0000a8d0: 2928 6d61 7463 6829 2870 6f73 7429 0a20  )(match)(post). 
-0000a8e0: 2020 2020 2020 203a 7061 7261 6d20 636f         :param co
-0000a8f0: 7079 5f61 7474 733a 2069 6620 5472 7565  py_atts: if True
-0000a900: 2063 6f70 7920 6174 7473 2066 726f 6d20   copy atts from 
-0000a910: 656c 656d 0a20 2020 2020 2020 203a 7061  elem.        :pa
-0000a920: 7261 6d20 7265 6375 7273 653a 2069 6620  ram recurse: if 
-0000a930: 5472 7565 2c20 7265 7365 7473 2065 6c65  True, resets ele
-0000a940: 6d20 746f 2074 7261 696c 696e 6720 656c  m to trailing el
-0000a950: 656d 2061 6e64 2072 6561 6e6c 7973 6573  em and reanlyses
-0000a960: 2075 6e74 696c 206e 6f20 6d6f 7265 206d   until no more m
-0000a970: 6174 6368 0a20 2020 2020 2020 203a 7061  atch.        :pa
-0000a980: 7261 6d20 6964 5f72 6f6f 743a 2061 7574  ram id_root: aut
-0000a990: 6f2d 6765 6e65 7261 7465 2069 6473 2062  o-generate ids b
-0000a9a0: 7569 6c64 696e 6720 6f6e 2069 645f 726f  uilding on id_ro
-0000a9b0: 6f74 0a20 2020 2020 2020 203a 7061 7261  ot.        :para
-0000a9c0: 6d20 6964 5f63 6f75 6e74 6572 3a20 636f  m id_counter: co
-0000a9d0: 756e 7465 7220 666f 7220 6964 730a 2020  unter for ids.  
-0000a9e0: 2020 2020 2020 3a70 6172 616d 206e 6577        :param new
-0000a9f0: 5f74 6167 733a 206e 6577 5f65 6c65 6d65  _tags: new_eleme
-0000aa00: 6e74 2074 6167 7320 2864 6566 6175 6c74  nt tags (default
-0000aa10: 2073 7061 6e2c 2073 7061 6e2c 2073 7061   span, span, spa
-0000aa20: 6e29 0a20 2020 2020 2020 203a 7265 7475  n).        :retu
-0000aa30: 726e 3a20 6c69 7374 206f 6620 3320 656c  rn: list of 3 el
-0000aa40: 656d 733b 2069 6620 6e65 775f 656c 656d  ems; if new_elem
-0000aa50: 735b 325d 2069 7320 6e6f 7420 4e6f 6e65  s[2] is not None
-0000aa60: 2069 7427 7320 6176 6169 6c61 626c 6520   it's available 
-0000aa70: 666f 7220 7265 6375 7273 696f 6e29 0a20  for recursion). 
-0000aa80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000aa90: 2020 2069 6620 6e6f 7420 6e65 775f 7461     if not new_ta
-0000aaa0: 6773 3a0a 2020 2020 2020 2020 2020 2020  gs:.            
-0000aab0: 6e65 775f 7461 6773 203d 205b 485f 5350  new_tags = [H_SP
-0000aac0: 414e 2c20 485f 5350 414e 2c20 485f 5350  AN, H_SPAN, H_SP
-0000aad0: 414e 5d0a 2020 2020 2020 2020 6173 7365  AN].        asse
-0000aae0: 7274 2065 6c65 6d78 2069 7320 6e6f 7420  rt elemx is not 
-0000aaf0: 4e6f 6e65 0a20 2020 2020 2020 2074 6578  None.        tex
-0000ab00: 7478 203d 2048 746d 6c55 7469 6c2e 6765  tx = HtmlUtil.ge
-0000ab10: 745f 7465 7874 5f63 6f6e 7465 6e74 2865  t_text_content(e
-0000ab20: 6c65 6d78 290a 2020 2020 2020 2020 7265  lemx).        re
-0000ab30: 6320 3d20 7265 2e63 6f6d 7069 6c65 2872  c = re.compile(r
-0000ab40: 6567 6578 290a 2020 2020 2020 2020 6d61  egex).        ma
-0000ab50: 7463 6820 3d20 7265 632e 6d61 7463 6828  tch = rec.match(
-0000ab60: 7465 7874 7829 0a20 2020 2020 2020 206e  textx).        n
-0000ab70: 6577 5f65 6c65 6d73 203d 205b 4e6f 6e65  ew_elems = [None
-0000ab80: 2c20 4e6f 6e65 2c20 4e6f 6e65 5d0a 2020  , None, None].  
-0000ab90: 2020 2020 2020 6966 206d 6174 6368 3a0a        if match:.
-0000aba0: 2020 2020 2020 2020 2020 2020 7061 7265              pare
-0000abb0: 6e74 203d 2065 6c65 6d78 2e67 6574 7061  nt = elemx.getpa
-0000abc0: 7265 6e74 2829 0a20 2020 2020 2020 2020  rent().         
-0000abd0: 2020 2069 6620 6c65 6e28 6d61 7463 682e     if len(match.
-0000abe0: 6772 6f75 7073 2829 2920 213d 2033 3a20  groups()) != 3: 
-0000abf0: 2023 2073 6f6d 6520 6d61 7920 6265 2065   # some may be e
-0000ac00: 6d70 7479 2073 7472 696e 6773 0a20 2020  mpty strings.   
-0000ac10: 2020 2020 2020 2020 2020 2020 206c 6f67               log
-0000ac20: 6769 6e67 2e77 6172 6e69 6e67 2866 2243  ging.warning(f"C
-0000ac30: 616e 6e6f 7420 6d61 7463 6820 7b74 6578  annot match {tex
-0000ac40: 7478 7d20 6167 6169 6e73 7420 7b72 6567  tx} against {reg
-0000ac50: 6578 7d22 290a 2020 2020 2020 2020 2020  ex}").          
-0000ac60: 2020 2020 2020 7265 7475 726e 206e 6577        return new
-0000ac70: 5f65 6c65 6d73 2c20 6964 5f63 6f75 6e74  _elems, id_count
-0000ac80: 6572 0a20 2020 2020 2020 2020 2020 2067  er.            g
-0000ac90: 726f 7570 3120 3d20 6d61 7463 682e 6772  roup1 = match.gr
-0000aca0: 6f75 7028 3129 0a20 2020 2020 2020 2020  oup(1).         
-0000acb0: 2020 2069 6620 6772 6f75 7031 2021 3d20     if group1 != 
-0000acc0: 2222 3a20 2023 2064 6f6e 2774 2061 6464  "":  # don't add
-0000acd0: 2065 6d70 7479 2073 7472 696e 670a 2020   empty string.  
-0000ace0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000acf0: 656d 7820 3d20 4874 6d6c 5574 696c 2e61  emx = HtmlUtil.a
-0000ad00: 6464 5f73 6962 6c69 6e67 5f61 6674 6572  dd_sibling_after
-0000ad10: 2865 6c65 6d78 2c20 6e65 775f 7461 6773  (elemx, new_tags
-0000ad20: 5b30 5d2c 2072 6570 6c61 6365 3d54 7275  [0], replace=Tru
-0000ad30: 652c 2063 6f70 795f 6174 7473 3d63 6f70  e, copy_atts=cop
-0000ad40: 795f 6174 7473 2c0a 2020 2020 2020 2020  y_atts,.        
-0000ad50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c10: 2020 2020 2072 656d 6f76 653d 4661 6c73       remove=Fals
+00009c20: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00009c30: 2020 2069 6620 7375 6273 6563 7469 6f6e     if subsection
+00009c40: 5f69 643a 0a20 2020 2020 2020 2020 2020  _id:.           
+00009c50: 2020 2020 2020 2020 2073 7562 7365 6374           subsect
+00009c60: 696f 6e73 2e61 7070 656e 6428 7375 6273  ions.append(subs
+00009c70: 6563 7469 6f6e 5f69 6429 0a20 2020 2020  ection_id).     
+00009c80: 2020 2072 6574 7572 6e20 7365 6374 696f     return sectio
+00009c90: 6e73 2c20 7375 6273 6563 7469 6f6e 730a  ns, subsections.
+00009ca0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00009cb0: 640a 2020 2020 6465 6620 616e 6e6f 7461  d.    def annota
+00009cc0: 7465 5f64 6976 5f73 7061 6e73 5f77 7269  te_div_spans_wri
+00009cd0: 7465 5f66 696e 616c 5f68 746d 6c28 636c  te_final_html(cl
+00009ce0: 732c 2069 6e70 7574 5f68 746d 6c2c 206f  s, input_html, o
+00009cf0: 7574 6669 6c65 2c20 7374 796c 6573 3d4e  utfile, styles=N
+00009d00: 6f6e 6529 3a0a 2020 2020 2020 2020 6966  one):.        if
+00009d10: 206e 6f74 2073 7479 6c65 733a 0a20 2020   not styles:.   
+00009d20: 2020 2020 2020 2020 2073 7479 6c65 7320           styles 
+00009d30: 3d20 4874 6d6c 4772 6f75 702e 4445 4641  = HtmlGroup.DEFA
+00009d40: 554c 545f 5354 594c 4553 0a20 2020 2020  ULT_STYLES.     
+00009d50: 2020 2068 746d 6c5f 656c 656d 203d 2045     html_elem = E
+00009d60: 542e 7061 7273 6528 7374 7228 696e 7075  T.parse(str(inpu
+00009d70: 745f 6874 6d6c 2929 2e67 6574 726f 6f74  t_html)).getroot
+00009d80: 2829 0a20 2020 2020 2020 2061 6e6e 6f74  ().        annot
+00009d90: 6174 6f72 203d 2048 746d 6c41 6e6e 6f74  ator = HtmlAnnot
+00009da0: 6174 6f72 2e63 7265 6174 655f 6970 6363  ator.create_ipcc
+00009db0: 5f61 6e6e 6f74 6174 6f72 2829 0a20 2020  _annotator().   
+00009dc0: 2020 2020 2048 746d 6c53 7479 6c65 2e61       HtmlStyle.a
+00009dd0: 6464 5f68 6561 645f 7374 796c 6573 5f6f  dd_head_styles_o
+00009de0: 7269 6728 6874 6d6c 5f65 6c65 6d2c 2073  rig(html_elem, s
+00009df0: 7479 6c65 7329 0a20 2020 2020 2020 2073  tyles).        s
+00009e00: 7061 6e73 203d 2068 746d 6c5f 656c 656d  pans = html_elem
+00009e10: 2e78 7061 7468 2822 2e2f 2f73 7061 6e22  .xpath(".//span"
+00009e20: 290a 2020 2020 2020 2020 666f 7220 7370  ).        for sp
+00009e30: 616e 2069 6e20 7370 616e 733a 0a20 2020  an in spans:.   
+00009e40: 2020 2020 2020 2020 2061 6e6e 6f74 6174           annotat
+00009e50: 6f72 2e72 756e 5f63 6f6d 6d61 6e64 7328  or.run_commands(
+00009e60: 7370 616e 290a 2020 2020 2020 2020 4874  span).        Ht
+00009e70: 6d6c 4772 6f75 702e 6772 6f75 705f 6e65  mlGroup.group_ne
+00009e80: 7374 6564 5f73 6962 6c69 6e67 7328 6874  sted_siblings(ht
+00009e90: 6d6c 5f65 6c65 6d2c 2073 7479 6c65 733d  ml_elem, styles=
+00009ea0: 4e6f 6e65 290a 2020 2020 2020 2020 4874  None).        Ht
+00009eb0: 6d6c 4c69 622e 7772 6974 655f 6874 6d6c  mlLib.write_html
+00009ec0: 5f66 696c 6528 6874 6d6c 5f65 6c65 6d2c  _file(html_elem,
+00009ed0: 206f 7574 6669 6c65 2c20 6465 6275 673d   outfile, debug=
+00009ee0: 5472 7565 290a 0a20 2020 2040 636c 6173  True)..    @clas
+00009ef0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00009f00: 7370 6c69 745f 7370 616e 7328 636c 732c  split_spans(cls,
+00009f10: 2068 746d 6c2c 2073 706c 6974 5f73 7061   html, split_spa
+00009f20: 6e5f 7265 6765 7829 3a0a 2020 2020 2020  n_regex):.      
+00009f30: 2020 7265 5f73 706c 6974 203d 2072 652e    re_split = re.
+00009f40: 636f 6d70 696c 6528 7370 6c69 745f 7370  compile(split_sp
+00009f50: 616e 5f72 6567 6578 290a 2020 2020 2020  an_regex).      
+00009f60: 2020 7370 616e 7320 3d20 6874 6d6c 2e78    spans = html.x
+00009f70: 7061 7468 2822 2f2f 7370 616e 2229 0a20  path("//span"). 
+00009f80: 2020 2020 2020 206e 7370 616e 7320 3d20         nspans = 
+00009f90: 6c65 6e28 7370 616e 7329 0a0a 2020 2020  len(spans)..    
+00009fa0: 2020 2020 636c 732e 7363 616e 5f72 656d      cls.scan_rem
+00009fb0: 6169 6e69 6e67 5f73 7061 6e73 2872 655f  aining_spans(re_
+00009fc0: 7370 6c69 742c 2073 7061 6e73 290a 0a20  split, spans).. 
+00009fd0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00009fe0: 2020 2020 6465 6620 7363 616e 5f72 656d      def scan_rem
+00009ff0: 6169 6e69 6e67 5f73 7061 6e73 2863 6c73  aining_spans(cls
+0000a000: 2c20 7265 5f73 706c 6974 2c20 7370 616e  , re_split, span
+0000a010: 7329 3a0a 2020 2020 2020 2020 6469 7620  s):.        div 
+0000a020: 3d20 4e6f 6e65 0a20 2020 2020 2020 2077  = None.        w
+0000a030: 6869 6c65 206c 656e 2873 7061 6e73 2920  hile len(spans) 
+0000a040: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
+0000a050: 2066 6f72 2069 2c20 7370 616e 2069 6e20   for i, span in 
+0000a060: 656e 756d 6572 6174 6528 7370 616e 7329  enumerate(spans)
+0000a070: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a080: 2020 6966 2064 6976 2069 7320 6e6f 7420    if div is not 
+0000a090: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000a0a0: 2020 2020 2020 2020 2020 6469 762e 6170            div.ap
+0000a0b0: 7065 6e64 2873 7061 6e29 0a20 2020 2020  pend(span).     
+0000a0c0: 2020 2020 2020 2020 2020 206d 6174 6368             match
+0000a0d0: 203d 2072 655f 7370 6c69 742e 6d61 7463   = re_split.matc
+0000a0e0: 6828 7370 616e 2e74 6578 7429 0a20 2020  h(span.text).   
+0000a0f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000a100: 6d61 7463 683a 0a20 2020 2020 2020 2020  match:.         
+0000a110: 2020 2020 2020 2020 2020 2070 7265 203d             pre =
+0000a120: 206d 6174 6368 2e67 726f 7570 2822 7072   match.group("pr
+0000a130: 6522 290a 2020 2020 2020 2020 2020 2020  e").            
+0000a140: 2020 2020 2020 2020 706f 7374 203d 206d          post = m
+0000a150: 6174 6368 2e67 726f 7570 2822 706f 7374  atch.group("post
+0000a160: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000a170: 2020 2020 2020 2073 7061 6e2e 7465 7874         span.text
+0000a180: 203d 2070 7265 0a20 2020 2020 2020 2020   = pre.         
+0000a190: 2020 2020 2020 2020 2020 2070 6172 656e             paren
+0000a1a0: 745f 6469 7620 3d20 7370 616e 2e67 6574  t_div = span.get
+0000a1b0: 7061 7265 6e74 2829 0a20 2020 2020 2020  parent().       
+0000a1c0: 2020 2020 2020 2020 2020 2020 206e 6578               nex
+0000a1d0: 745f 7370 616e 203d 2045 542e 5375 6245  t_span = ET.SubE
+0000a1e0: 6c65 6d65 6e74 2870 6172 656e 745f 6469  lement(parent_di
+0000a1f0: 762c 2022 7370 616e 2229 0a20 2020 2020  v, "span").     
+0000a200: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000a210: 6f72 2061 7474 2069 6e20 7370 616e 2e61  or att in span.a
+0000a220: 7474 7269 623a 0a20 2020 2020 2020 2020  ttrib:.         
+0000a230: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+0000a240: 6578 745f 7370 616e 2e61 7474 7269 625b  ext_span.attrib[
+0000a250: 6174 745b 305d 5d20 3d20 6174 745b 315d  att[0]] = att[1]
+0000a260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a270: 2020 2020 2020 2020 2073 7061 6e2e 6164           span.ad
+0000a280: 646e 6578 7428 6e65 7874 5f73 7061 6e29  dnext(next_span)
+0000a290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a2a0: 2020 2020 2073 7061 6e73 203d 2073 7061       spans = spa
+0000a2b0: 6e73 5b69 202b 2031 3a5d 0a20 2020 2020  ns[i + 1:].     
+0000a2c0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0000a2d0: 6976 203d 2045 542e 5375 6245 6c65 6d65  iv = ET.SubEleme
+0000a2e0: 6e74 2870 6172 656e 745f 6469 762e 6765  nt(parent_div.ge
+0000a2f0: 7470 6172 656e 7428 292c 2022 6469 7622  tparent(), "div"
+0000a300: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
+0000a310: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+0000a320: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0000a330: 6920 3d3d 206c 656e 2873 7061 6e73 2920  i == len(spans) 
+0000a340: 2d20 313a 0a20 2020 2020 2020 2020 2020  - 1:.           
+0000a350: 2020 2020 2020 2020 2073 7061 6e73 203d           spans =
+0000a360: 205b 5d0a 0a0a 0a63 6c61 7373 2048 746d   []....class Htm
+0000a370: 6c55 7469 6c3a 0a20 2020 2053 4352 4950  lUtil:.    SCRIP
+0000a380: 545f 4641 4354 203d 2030 2e39 2020 2320  T_FACT = 0.9  # 
+0000a390: 6d61 7962 6520 7368 6f6c 646e 2774 2062  maybe sholdn't b
+0000a3a0: 6520 6865 7265 3b20 6176 6f69 6420 6369  e here; avoid ci
+0000a3b0: 7263 756c 6172 0a20 2020 204d 4152 4b45  rcular.    MARKE
+0000a3c0: 5220 3d20 226d 6172 6b65 7222 0a0a 0a20  R = "marker"... 
+0000a3d0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+0000a3e0: 2020 2020 6465 6620 7265 6d6f 7665 5f65      def remove_e
+0000a3f0: 6d70 7479 5f65 6c65 6d65 6e74 7328 636c  mpty_elements(cl
+0000a400: 732c 2065 6c65 6d2c 2074 6167 293a 0a20  s, elem, tag):. 
+0000a410: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000a420: 2020 204d 6179 6265 206d 6f76 6520 746f     Maybe move to
+0000a430: 2048 544d 4c54 6964 790a 2020 2020 2020   HTMLTidy.      
+0000a440: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0000a450: 2074 6167 3a0a 2020 2020 2020 2020 2020   tag:.          
+0000a460: 2020 6966 2074 7970 6528 7461 6729 2069    if type(tag) i
+0000a470: 7320 6c69 7374 3a0a 2020 2020 2020 2020  s list:.        
+0000a480: 2020 2020 2020 2020 666f 7220 7420 696e          for t in
+0000a490: 2074 6167 3a0a 2020 2020 2020 2020 2020   tag:.          
+0000a4a0: 2020 2020 2020 2020 2020 636c 732e 7265            cls.re
+0000a4b0: 6d6f 7665 5f65 6d70 7479 5f65 6c65 6d65  move_empty_eleme
+0000a4c0: 6e74 7328 656c 656d 2c20 7429 0a20 2020  nts(elem, t).   
+0000a4d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000a4e0: 2020 2020 2020 2020 2020 2020 2020 2078                 x
+0000a4f0: 7020 3d20 6622 2e2f 2f7b 7461 677d 5b6e  p = f".//{tag}[n
+0000a500: 6f72 6d61 6c69 7a65 2d73 7061 6365 282e  ormalize-space(.
+0000a510: 293d 2727 2061 6e64 2063 6f75 6e74 287b  )='' and count({
+0000a520: 7461 677d 2f2a 2920 3d20 305d 220a 2020  tag}/*) = 0]".  
+0000a530: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000a540: 656d 7320 3d20 656c 656d 2e78 7061 7468  ems = elem.xpath
+0000a550: 2878 7029 0a20 2020 2020 2020 2020 2020  (xp).           
+0000a560: 2020 2020 2066 6f72 2065 6c20 696e 2065       for el in e
+0000a570: 6c65 6d73 3a0a 2020 2020 2020 2020 2020  lems:.          
+0000a580: 2020 2020 2020 2020 2020 636c 732e 7265            cls.re
+0000a590: 6d6f 7665 5f65 6c65 6d5f 6b65 6570 5f74  move_elem_keep_t
+0000a5a0: 6169 6c28 656c 290a 0a20 2020 2040 636c  ail(el)..    @cl
+0000a5b0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0000a5c0: 6620 7265 6d6f 7665 5f65 6c65 6d5f 6b65  f remove_elem_ke
+0000a5d0: 6570 5f74 6169 6c28 636c 732c 2065 6c29  ep_tail(cls, el)
+0000a5e0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000a5f0: 2020 2020 2020 4d61 7962 6520 6d6f 7665        Maybe move
+0000a600: 2074 6f20 4854 4d4c 5469 6479 0a20 2020   to HTMLTidy.   
+0000a610: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000a620: 2070 6172 656e 7420 3d20 656c 2e67 6574   parent = el.get
+0000a630: 7061 7265 6e74 2829 0a20 2020 2020 2020  parent().       
+0000a640: 2074 6169 6c20 3d20 656c 2e74 6169 6c0a   tail = el.tail.
+0000a650: 2020 2020 2020 2020 6966 2074 6169 6c20          if tail 
+0000a660: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+0000a670: 6c65 6e28 7461 696c 2e73 7472 6970 2829  len(tail.strip()
+0000a680: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
+0000a690: 2020 2070 7265 7620 3d20 656c 2e67 6574     prev = el.get
+0000a6a0: 7072 6576 696f 7573 2829 0a20 2020 2020  previous().     
+0000a6b0: 2020 2020 2020 2069 6620 7072 6576 2069         if prev i
+0000a6c0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000a6d0: 2020 2020 2020 2020 2020 2020 7072 6576              prev
+0000a6e0: 2e74 6169 6c20 3d20 2870 7265 762e 7461  .tail = (prev.ta
+0000a6f0: 696c 206f 7220 2727 2920 2b20 656c 2e74  il or '') + el.t
+0000a700: 6169 6c0a 2020 2020 2020 2020 2020 2020  ail.            
+0000a710: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000a720: 2020 2020 2020 7061 7265 6e74 2e74 6578        parent.tex
+0000a730: 7420 3d20 2870 6172 656e 742e 7465 7874  t = (parent.text
+0000a740: 206f 7220 2727 2920 2b20 656c 2e74 6169   or '') + el.tai
+0000a750: 6c0a 0a20 2020 2020 2020 2070 6172 656e  l..        paren
+0000a760: 742e 7265 6d6f 7665 2865 6c29 0a0a 2020  t.remove(el)..  
+0000a770: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+0000a780: 2020 2064 6566 2073 706c 6974 5f73 7061     def split_spa
+0000a790: 6e5f 6174 5f6d 6174 6368 2863 6c73 2c20  n_at_match(cls, 
+0000a7a0: 656c 656d 782c 2072 6567 6578 2c20 636f  elemx, regex, co
+0000a7b0: 7079 5f61 7474 733d 5472 7565 2c20 7265  py_atts=True, re
+0000a7c0: 6375 7273 653d 5472 7565 2c20 6964 5f72  curse=True, id_r
+0000a7d0: 6f6f 743d 4e6f 6e65 2c20 6964 5f63 6f75  oot=None, id_cou
+0000a7e0: 6e74 6572 3d30 2c0a 2020 2020 2020 2020  nter=0,.        
+0000a7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a800: 2020 2020 6e65 775f 7461 6773 3d4e 6f6e      new_tags=Non
+0000a810: 6529 3a0a 2020 2020 2020 2020 2222 2273  e):.        """s
+0000a820: 706c 6974 7320 616e 2065 6c65 6d20 286e  plits an elem (n
+0000a830: 6f72 6d61 6c6c 7920 7370 616e 2920 696e  ormally span) in
+0000a840: 746f 2033 2063 6f6d 706f 6e65 6e74 7320  to 3 components 
+0000a850: 6279 2072 6567 6578 206d 6174 6368 0a20  by regex match. 
+0000a860: 2020 2020 2020 203a 7061 7261 6d20 656c         :param el
+0000a870: 656d 783a 2065 6c65 6d20 746f 2073 706c  emx: elem to spl
+0000a880: 6974 2028 6e6f 726d 616c 6c79 2068 6173  it (normally has
+0000a890: 2061 2070 6172 656e 7420 2865 2e67 2e20   a parent (e.g. 
+0000a8a0: 6469 7629 0a20 2020 2020 2020 203a 7061  div).        :pa
+0000a8b0: 7261 6d20 7265 6765 783a 2072 6567 6578  ram regex: regex
+0000a8c0: 2074 6f20 7370 6c69 7420 656c 656d 2028   to split elem (
+0000a8d0: 6f66 2066 6f72 6d20 2870 7265 2928 6d61  of form (pre)(ma
+0000a8e0: 7463 6829 2870 6f73 7429 0a20 2020 2020  tch)(post).     
+0000a8f0: 2020 203a 7061 7261 6d20 636f 7079 5f61     :param copy_a
+0000a900: 7474 733a 2069 6620 5472 7565 2063 6f70  tts: if True cop
+0000a910: 7920 6174 7473 2066 726f 6d20 656c 656d  y atts from elem
+0000a920: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000a930: 7265 6375 7273 653a 2069 6620 5472 7565  recurse: if True
+0000a940: 2c20 7265 7365 7473 2065 6c65 6d20 746f  , resets elem to
+0000a950: 2074 7261 696c 696e 6720 656c 656d 2061   trailing elem a
+0000a960: 6e64 2072 6561 6e6c 7973 6573 2075 6e74  nd reanlyses unt
+0000a970: 696c 206e 6f20 6d6f 7265 206d 6174 6368  il no more match
+0000a980: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000a990: 6964 5f72 6f6f 743a 2061 7574 6f2d 6765  id_root: auto-ge
+0000a9a0: 6e65 7261 7465 2069 6473 2062 7569 6c64  nerate ids build
+0000a9b0: 696e 6720 6f6e 2069 645f 726f 6f74 0a20  ing on id_root. 
+0000a9c0: 2020 2020 2020 203a 7061 7261 6d20 6964         :param id
+0000a9d0: 5f63 6f75 6e74 6572 3a20 636f 756e 7465  _counter: counte
+0000a9e0: 7220 666f 7220 6964 730a 2020 2020 2020  r for ids.      
+0000a9f0: 2020 3a70 6172 616d 206e 6577 5f74 6167    :param new_tag
+0000aa00: 733a 206e 6577 5f65 6c65 6d65 6e74 2074  s: new_element t
+0000aa10: 6167 7320 2864 6566 6175 6c74 2073 7061  ags (default spa
+0000aa20: 6e2c 2073 7061 6e2c 2073 7061 6e29 0a20  n, span, span). 
+0000aa30: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+0000aa40: 6c69 7374 206f 6620 3320 656c 656d 733b  list of 3 elems;
+0000aa50: 2069 6620 6e65 775f 656c 656d 735b 325d   if new_elems[2]
+0000aa60: 2069 7320 6e6f 7420 4e6f 6e65 2069 7427   is not None it'
+0000aa70: 7320 6176 6169 6c61 626c 6520 666f 7220  s available for 
+0000aa80: 7265 6375 7273 696f 6e29 0a20 2020 2020  recursion).     
+0000aa90: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+0000aaa0: 6620 6e6f 7420 6e65 775f 7461 6773 3a0a  f not new_tags:.
+0000aab0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000aac0: 7461 6773 203d 205b 485f 5350 414e 2c20  tags = [H_SPAN, 
+0000aad0: 485f 5350 414e 2c20 485f 5350 414e 5d0a  H_SPAN, H_SPAN].
+0000aae0: 2020 2020 2020 2020 6173 7365 7274 2065          assert e
+0000aaf0: 6c65 6d78 2069 7320 6e6f 7420 4e6f 6e65  lemx is not None
+0000ab00: 0a20 2020 2020 2020 2074 6578 7478 203d  .        textx =
+0000ab10: 2048 746d 6c55 7469 6c2e 6765 745f 7465   HtmlUtil.get_te
+0000ab20: 7874 5f63 6f6e 7465 6e74 2865 6c65 6d78  xt_content(elemx
+0000ab30: 290a 2020 2020 2020 2020 7265 6320 3d20  ).        rec = 
+0000ab40: 7265 2e63 6f6d 7069 6c65 2872 6567 6578  re.compile(regex
+0000ab50: 290a 2020 2020 2020 2020 6d61 7463 6820  ).        match 
+0000ab60: 3d20 7265 632e 6d61 7463 6828 7465 7874  = rec.match(text
+0000ab70: 7829 0a20 2020 2020 2020 206e 6577 5f65  x).        new_e
+0000ab80: 6c65 6d73 203d 205b 4e6f 6e65 2c20 4e6f  lems = [None, No
+0000ab90: 6e65 2c20 4e6f 6e65 5d0a 2020 2020 2020  ne, None].      
+0000aba0: 2020 6966 206d 6174 6368 3a0a 2020 2020    if match:.    
+0000abb0: 2020 2020 2020 2020 7061 7265 6e74 203d          parent =
+0000abc0: 2065 6c65 6d78 2e67 6574 7061 7265 6e74   elemx.getparent
+0000abd0: 2829 0a20 2020 2020 2020 2020 2020 2069  ().            i
+0000abe0: 6620 6c65 6e28 6d61 7463 682e 6772 6f75  f len(match.grou
+0000abf0: 7073 2829 2920 213d 2033 3a20 2023 2073  ps()) != 3:  # s
+0000ac00: 6f6d 6520 6d61 7920 6265 2065 6d70 7479  ome may be empty
+0000ac10: 2073 7472 696e 6773 0a20 2020 2020 2020   strings.       
+0000ac20: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
+0000ac30: 2e77 6172 6e69 6e67 2866 2243 616e 6e6f  .warning(f"Canno
+0000ac40: 7420 6d61 7463 6820 7b74 6578 7478 7d20  t match {textx} 
+0000ac50: 6167 6169 6e73 7420 7b72 6567 6578 7d22  against {regex}"
+0000ac60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000ac70: 2020 7265 7475 726e 206e 6577 5f65 6c65    return new_ele
+0000ac80: 6d73 2c20 6964 5f63 6f75 6e74 6572 0a20  ms, id_counter. 
+0000ac90: 2020 2020 2020 2020 2020 2067 726f 7570             group
+0000aca0: 3120 3d20 6d61 7463 682e 6772 6f75 7028  1 = match.group(
+0000acb0: 3129 0a20 2020 2020 2020 2020 2020 2069  1).            i
+0000acc0: 6620 6772 6f75 7031 2021 3d20 2222 3a20  f group1 != "": 
+0000acd0: 2023 2064 6f6e 2774 2061 6464 2065 6d70   # don't add emp
+0000ace0: 7479 2073 7472 696e 670a 2020 2020 2020  ty string.      
+0000acf0: 2020 2020 2020 2020 2020 656c 656d 7820            elemx 
+0000ad00: 3d20 4874 6d6c 5574 696c 2e61 6464 5f73  = HtmlUtil.add_s
+0000ad10: 6962 6c69 6e67 5f61 6674 6572 2865 6c65  ibling_after(ele
+0000ad20: 6d78 2c20 6e65 775f 7461 6773 5b30 5d2c  mx, new_tags[0],
+0000ad30: 2072 6570 6c61 6365 3d54 7275 652c 2063   replace=True, c
+0000ad40: 6f70 795f 6174 7473 3d63 6f70 795f 6174  opy_atts=copy_at
+0000ad50: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
 0000ad60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ad70: 2020 2020 2020 2020 2020 2074 6578 743d             text=
-0000ad80: 6772 6f75 7031 290a 2020 2020 2020 2020  group1).        
-0000ad90: 2020 2020 2020 2020 6e65 775f 656c 656d          new_elem
-0000ada0: 735b 305d 203d 2065 6c65 6d78 0a20 2020  s[0] = elemx.   
-0000adb0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0000adc0: 5f65 6c65 6d73 5b30 5d2e 6174 7472 6962  _elems[0].attrib
-0000add0: 5b41 5f43 4c41 5353 5d20 3d20 2272 655f  [A_CLASS] = "re_
-0000ade0: 7072 6566 220a 2020 2020 2020 2020 2020  pref".          
-0000adf0: 2020 2020 2020 6964 5f63 6f75 6e74 6572        id_counter
-0000ae00: 203d 2063 6c73 2e61 6464 5f69 645f 696e   = cls.add_id_in
-0000ae10: 6372 656d 656e 745f 636f 756e 7465 7228  crement_counter(
-0000ae20: 6964 5f63 6f75 6e74 6572 2c20 6964 5f72  id_counter, id_r
-0000ae30: 6f6f 742c 2065 6c65 6d78 290a 2020 2020  oot, elemx).    
-0000ae40: 2020 2020 2020 2020 6e65 775f 656c 656d          new_elem
-0000ae50: 735b 315d 203d 2048 746d 6c55 7469 6c2e  s[1] = HtmlUtil.
-0000ae60: 6164 645f 7369 626c 696e 675f 6166 7465  add_sibling_afte
-0000ae70: 7228 656c 656d 782c 206e 6577 5f74 6167  r(elemx, new_tag
-0000ae80: 735b 315d 2c20 636f 7079 5f61 7474 733d  s[1], copy_atts=
-0000ae90: 636f 7079 5f61 7474 732c 2074 6578 743d  copy_atts, text=
-0000aea0: 6d61 7463 682e 6772 6f75 7028 3229 290a  match.group(2)).
-0000aeb0: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-0000aec0: 656c 656d 735b 315d 2e61 7474 7269 625b  elems[1].attrib[
-0000aed0: 415f 434c 4153 535d 203d 2022 7265 5f6d  A_CLASS] = "re_m
-0000aee0: 6174 6368 220a 2020 2020 2020 2020 2020  atch".          
-0000aef0: 2020 6964 5f63 6f75 6e74 6572 203d 2063    id_counter = c
-0000af00: 6c73 2e61 6464 5f69 645f 696e 6372 656d  ls.add_id_increm
-0000af10: 656e 745f 636f 756e 7465 7228 6964 5f63  ent_counter(id_c
-0000af20: 6f75 6e74 6572 2c20 6964 5f72 6f6f 742c  ounter, id_root,
-0000af30: 206e 6577 5f65 6c65 6d73 5b31 5d29 0a20   new_elems[1]). 
-0000af40: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
-0000af50: 7463 682e 6772 6f75 7028 3329 2021 3d20  tch.group(3) != 
-0000af60: 2222 3a20 2023 2064 6f6e 2774 2061 6464  "":  # don't add
-0000af70: 2065 6d70 7479 2073 7472 696e 670a 2020   empty string.  
-0000af80: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
-0000af90: 775f 656c 656d 735b 325d 203d 2048 746d  w_elems[2] = Htm
-0000afa0: 6c55 7469 6c2e 6164 645f 7369 626c 696e  lUtil.add_siblin
-0000afb0: 675f 6166 7465 7228 6e65 775f 656c 656d  g_after(new_elem
-0000afc0: 735b 315d 2c20 6e65 775f 7461 6773 5b32  s[1], new_tags[2
-0000afd0: 5d2c 2063 6f70 795f 6174 7473 3d63 6f70  ], copy_atts=cop
-0000afe0: 795f 6174 7473 2c0a 2020 2020 2020 2020  y_atts,.        
-0000aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad80: 2020 2020 2020 2074 6578 743d 6772 6f75         text=grou
+0000ad90: 7031 290a 2020 2020 2020 2020 2020 2020  p1).            
+0000ada0: 2020 2020 6e65 775f 656c 656d 735b 305d      new_elems[0]
+0000adb0: 203d 2065 6c65 6d78 0a20 2020 2020 2020   = elemx.       
+0000adc0: 2020 2020 2020 2020 206e 6577 5f65 6c65           new_ele
+0000add0: 6d73 5b30 5d2e 6174 7472 6962 5b41 5f43  ms[0].attrib[A_C
+0000ade0: 4c41 5353 5d20 3d20 2272 655f 7072 6566  LASS] = "re_pref
+0000adf0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0000ae00: 2020 6964 5f63 6f75 6e74 6572 203d 2063    id_counter = c
+0000ae10: 6c73 2e61 6464 5f69 645f 696e 6372 656d  ls.add_id_increm
+0000ae20: 656e 745f 636f 756e 7465 7228 6964 5f63  ent_counter(id_c
+0000ae30: 6f75 6e74 6572 2c20 6964 5f72 6f6f 742c  ounter, id_root,
+0000ae40: 2065 6c65 6d78 290a 2020 2020 2020 2020   elemx).        
+0000ae50: 2020 2020 6e65 775f 656c 656d 735b 315d      new_elems[1]
+0000ae60: 203d 2048 746d 6c55 7469 6c2e 6164 645f   = HtmlUtil.add_
+0000ae70: 7369 626c 696e 675f 6166 7465 7228 656c  sibling_after(el
+0000ae80: 656d 782c 206e 6577 5f74 6167 735b 315d  emx, new_tags[1]
+0000ae90: 2c20 636f 7079 5f61 7474 733d 636f 7079  , copy_atts=copy
+0000aea0: 5f61 7474 732c 2074 6578 743d 6d61 7463  _atts, text=matc
+0000aeb0: 682e 6772 6f75 7028 3229 290a 2020 2020  h.group(2)).    
+0000aec0: 2020 2020 2020 2020 6e65 775f 656c 656d          new_elem
+0000aed0: 735b 315d 2e61 7474 7269 625b 415f 434c  s[1].attrib[A_CL
+0000aee0: 4153 535d 203d 2022 7265 5f6d 6174 6368  ASS] = "re_match
+0000aef0: 220a 2020 2020 2020 2020 2020 2020 6964  ".            id
+0000af00: 5f63 6f75 6e74 6572 203d 2063 6c73 2e61  _counter = cls.a
+0000af10: 6464 5f69 645f 696e 6372 656d 656e 745f  dd_id_increment_
+0000af20: 636f 756e 7465 7228 6964 5f63 6f75 6e74  counter(id_count
+0000af30: 6572 2c20 6964 5f72 6f6f 742c 206e 6577  er, id_root, new
+0000af40: 5f65 6c65 6d73 5b31 5d29 0a20 2020 2020  _elems[1]).     
+0000af50: 2020 2020 2020 2069 6620 6d61 7463 682e         if match.
+0000af60: 6772 6f75 7028 3329 2021 3d20 2222 3a20  group(3) != "": 
+0000af70: 2023 2064 6f6e 2774 2061 6464 2065 6d70   # don't add emp
+0000af80: 7479 2073 7472 696e 670a 2020 2020 2020  ty string.      
+0000af90: 2020 2020 2020 2020 2020 6e65 775f 656c            new_el
+0000afa0: 656d 735b 325d 203d 2048 746d 6c55 7469  ems[2] = HtmlUti
+0000afb0: 6c2e 6164 645f 7369 626c 696e 675f 6166  l.add_sibling_af
+0000afc0: 7465 7228 6e65 775f 656c 656d 735b 315d  ter(new_elems[1]
+0000afd0: 2c20 6e65 775f 7461 6773 5b32 5d2c 2063  , new_tags[2], c
+0000afe0: 6f70 795f 6174 7473 3d63 6f70 795f 6174  opy_atts=copy_at
+0000aff0: 7473 2c0a 2020 2020 2020 2020 2020 2020  ts,.            
 0000b000: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000b010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b020: 2020 7465 7874 3d6d 6174 6368 2e67 726f    text=match.gro
-0000b030: 7570 2833 2929 0a20 2020 2020 2020 2020  up(3)).         
-0000b040: 2020 2020 2020 206e 6577 5f65 6c65 6d73         new_elems
-0000b050: 5b32 5d2e 6174 7472 6962 5b41 5f43 4c41  [2].attrib[A_CLA
-0000b060: 5353 5d20 3d20 2272 655f 706f 7374 220a  SS] = "re_post".
-0000b070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b080: 2069 645f 636f 756e 7465 7220 3d20 636c   id_counter = cl
-0000b090: 732e 6164 645f 6964 5f69 6e63 7265 6d65  s.add_id_increme
-0000b0a0: 6e74 5f63 6f75 6e74 6572 2869 645f 636f  nt_counter(id_co
-0000b0b0: 756e 7465 722c 2069 645f 726f 6f74 2c20  unter, id_root, 
-0000b0c0: 6e65 775f 656c 656d 735b 325d 290a 2020  new_elems[2]).  
-0000b0d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000b0e0: 2072 6563 7572 7365 3a0a 2020 2020 2020   recurse:.      
-0000b0f0: 2020 2020 2020 2020 2020 2020 2020 5f2c                _,
-0000b100: 2069 645f 636f 756e 7465 7220 3d20 4874   id_counter = Ht
-0000b110: 6d6c 5574 696c 2e73 706c 6974 5f73 7061  mlUtil.split_spa
-0000b120: 6e5f 6174 5f6d 6174 6368 286e 6577 5f65  n_at_match(new_e
-0000b130: 6c65 6d73 5b32 5d2c 2072 6567 6578 2c20  lems[2], regex, 
-0000b140: 636f 7079 5f61 7474 733d 636f 7079 5f61  copy_atts=copy_a
-0000b150: 7474 732c 0a20 2020 2020 2020 2020 2020  tts,.           
-0000b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b020: 2020 2020 2020 2020 2020 2020 2020 7465                te
+0000b030: 7874 3d6d 6174 6368 2e67 726f 7570 2833  xt=match.group(3
+0000b040: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0000b050: 2020 206e 6577 5f65 6c65 6d73 5b32 5d2e     new_elems[2].
+0000b060: 6174 7472 6962 5b41 5f43 4c41 5353 5d20  attrib[A_CLASS] 
+0000b070: 3d20 2272 655f 706f 7374 220a 0a20 2020  = "re_post"..   
+0000b080: 2020 2020 2020 2020 2020 2020 2069 645f               id_
+0000b090: 636f 756e 7465 7220 3d20 636c 732e 6164  counter = cls.ad
+0000b0a0: 645f 6964 5f69 6e63 7265 6d65 6e74 5f63  d_id_increment_c
+0000b0b0: 6f75 6e74 6572 2869 645f 636f 756e 7465  ounter(id_counte
+0000b0c0: 722c 2069 645f 726f 6f74 2c20 6e65 775f  r, id_root, new_
+0000b0d0: 656c 656d 735b 325d 290a 2020 2020 2020  elems[2]).      
+0000b0e0: 2020 2020 2020 2020 2020 6966 2072 6563            if rec
+0000b0f0: 7572 7365 3a0a 2020 2020 2020 2020 2020  urse:.          
+0000b100: 2020 2020 2020 2020 2020 5f2c 2069 645f            _, id_
+0000b110: 636f 756e 7465 7220 3d20 4874 6d6c 5574  counter = HtmlUt
+0000b120: 696c 2e73 706c 6974 5f73 7061 6e5f 6174  il.split_span_at
+0000b130: 5f6d 6174 6368 286e 6577 5f65 6c65 6d73  _match(new_elems
+0000b140: 5b32 5d2c 2072 6567 6578 2c20 636f 7079  [2], regex, copy
+0000b150: 5f61 7474 733d 636f 7079 5f61 7474 732c  _atts=copy_atts,
+0000b160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 0000b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b190: 2020 2020 2020 7265 6375 7273 653d 7265        recurse=re
-0000b1a0: 6375 7273 652c 2069 645f 726f 6f74 3d69  curse, id_root=i
-0000b1b0: 645f 726f 6f74 2c0a 2020 2020 2020 2020  d_root,.        
-0000b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1a0: 2020 7265 6375 7273 653d 7265 6375 7273    recurse=recurs
+0000b1b0: 652c 2069 645f 726f 6f74 3d69 645f 726f  e, id_root=id_ro
+0000b1c0: 6f74 2c0a 2020 2020 2020 2020 2020 2020  ot,.            
 0000b1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1f0: 2020 2020 2020 2020 2069 645f 636f 756e           id_coun
-0000b200: 7465 723d 6964 5f63 6f75 6e74 6572 290a  ter=id_counter).
-0000b210: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-0000b220: 6577 5f65 6c65 6d73 2c20 6964 5f63 6f75  ew_elems, id_cou
-0000b230: 6e74 6572 0a0a 2020 2020 4063 6c61 7373  nter..    @class
-0000b240: 6d65 7468 6f64 0a20 2020 2064 6566 2061  method.    def a
-0000b250: 6464 5f69 645f 696e 6372 656d 656e 745f  dd_id_increment_
-0000b260: 636f 756e 7465 7228 636c 732c 2069 645f  counter(cls, id_
-0000b270: 636f 756e 7465 722c 2069 645f 726f 6f74  counter, id_root
-0000b280: 2c20 6874 6d6c 5f65 6c65 6d29 3a0a 2020  , html_elem):.  
-0000b290: 2020 2020 2020 6966 2069 645f 726f 6f74        if id_root
-0000b2a0: 3a0a 2020 2020 2020 2020 2020 2020 6874  :.            ht
-0000b2b0: 6d6c 5f65 6c65 6d2e 6174 7472 6962 5b41  ml_elem.attrib[A
-0000b2c0: 5f49 445d 203d 2069 645f 726f 6f74 202b  _ID] = id_root +
-0000b2d0: 2073 7472 2869 645f 636f 756e 7465 7229   str(id_counter)
-0000b2e0: 0a20 2020 2020 2020 2020 2020 2069 645f  .            id_
-0000b2f0: 636f 756e 7465 7220 2b3d 2031 0a20 2020  counter += 1.   
-0000b300: 2020 2020 2072 6574 7572 6e20 6964 5f63       return id_c
-0000b310: 6f75 6e74 6572 0a0a 2020 2020 4063 6c61  ounter..    @cla
-0000b320: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-0000b330: 2061 6464 5f73 6962 6c69 6e67 5f61 6674   add_sibling_aft
-0000b340: 6572 2863 6c73 2c20 616e 6368 6f72 5f65  er(cls, anchor_e
-0000b350: 6c65 6d2c 2074 6167 2c20 7265 706c 6163  lem, tag, replac
-0000b360: 653d 4661 6c73 652c 2063 6f70 795f 6174  e=False, copy_at
-0000b370: 7473 3d46 616c 7365 2c20 7465 7874 3d4e  ts=False, text=N
-0000b380: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-0000b390: 2261 6464 7320 6e65 7720 7472 6169 6c69  "adds new traili
-0000b3a0: 6e67 2073 6962 6c69 6e67 206f 6620 616e  ng sibling of an
-0000b3b0: 6368 6f72 5f65 6c65 6d20 7769 7468 2074  chor_elem with t
-0000b3c0: 6167 0a20 2020 2020 2020 203a 7061 7261  ag.        :para
-0000b3d0: 6d20 7461 673a 2074 6167 2066 6f72 206e  m tag: tag for n
-0000b3e0: 6577 2065 6c65 6d65 6e74 0a20 2020 2020  ew element.     
-0000b3f0: 2020 203a 7061 7261 6d20 616e 6368 6f72     :param anchor
-0000b400: 5f65 6c65 6d3a 2072 6566 6572 656e 6365  _elem: reference
-0000b410: 2065 6c65 6d65 6e74 2c20 6d75 7374 2068   element, must h
-0000b420: 6176 6520 6120 7061 7265 6e74 0a20 2020  ave a parent.   
-0000b430: 2020 2020 203a 7061 7261 6d20 7265 706c       :param repl
-0000b440: 6163 653a 2069 6620 5472 7565 2c20 7265  ace: if True, re
-0000b450: 6d6f 7665 2061 6e63 686f 7220 656c 656d  move anchor elem
-0000b460: 656e 740a 2020 2020 2020 2020 3a70 6172  ent.        :par
-0000b470: 616d 2063 6f70 795f 6174 7473 3a20 636f  am copy_atts: co
-0000b480: 7079 2061 7474 7269 6275 7465 7320 6672  py attributes fr
-0000b490: 6f6d 2061 6e63 686f 720a 2020 2020 2020  om anchor.      
-0000b4a0: 2020 3a70 6172 616d 2074 6578 743a 2069    :param text: i
-0000b4b0: 6620 6e6f 7420 4e6f 6e65 2061 6464 2074  f not None add t
-0000b4c0: 6578 7420 746f 206e 6577 2065 6c65 6d65  ext to new eleme
-0000b4d0: 6e74 0a20 2020 2020 2020 203a 7265 7475  nt.        :retu
-0000b4e0: 726e 3a20 6e65 7720 7369 626c 696e 6720  rn: new sibling 
-0000b4f0: 7769 7468 206f 7074 696f 6e61 6c20 6179  with optional ay
-0000b500: 7974 7269 6275 7465 7320 616e 6420 7465  ytributes and te
-0000b510: 7874 0a0a 0a0a 2020 2020 2020 2020 2222  xt....        ""
-0000b520: 220a 0a20 2020 2020 2020 2061 7373 6572  "..        asser
-0000b530: 7420 616e 6368 6f72 5f65 6c65 6d20 6973  t anchor_elem is
-0000b540: 206e 6f74 204e 6f6e 650a 2020 2020 2020   not None.      
-0000b550: 2020 6173 7365 7274 2074 6167 0a20 2020    assert tag.   
-0000b560: 2020 2020 2070 6172 656e 7420 3d20 616e       parent = an
-0000b570: 6368 6f72 5f65 6c65 6d2e 6765 7470 6172  chor_elem.getpar
-0000b580: 656e 7428 290a 2020 2020 2020 2020 6173  ent().        as
-0000b590: 7365 7274 2070 6172 656e 7420 6973 206e  sert parent is n
-0000b5a0: 6f74 204e 6f6e 652c 2066 224e 6f20 7061  ot None, f"No pa
-0000b5b0: 7265 6e74 2066 6f72 2061 6e63 686f 725f  rent for anchor_
-0000b5c0: 656c 656d 220a 2020 2020 2020 2020 7369  elem".        si
-0000b5d0: 626c 696e 6720 3d20 4554 2e53 7562 456c  bling = ET.SubEl
-0000b5e0: 656d 656e 7428 7061 7265 6e74 2c20 7461  ement(parent, ta
-0000b5f0: 6729 0a20 2020 2020 2020 2069 6620 636f  g).        if co
-0000b600: 7079 5f61 7474 733a 0a20 2020 2020 2020  py_atts:.       
-0000b610: 2020 2020 2066 6f72 206b 2c20 7620 696e       for k, v in
-0000b620: 2061 6e63 686f 725f 656c 656d 2e61 7474   anchor_elem.att
-0000b630: 7269 622e 6974 656d 7328 293a 0a20 2020  rib.items():.   
-0000b640: 2020 2020 2020 2020 2020 2020 2073 6962               sib
-0000b650: 6c69 6e67 2e61 7474 7269 625b 6b5d 203d  ling.attrib[k] =
-0000b660: 2076 0a20 2020 2020 2020 2061 6e63 686f   v.        ancho
-0000b670: 725f 656c 656d 2e61 6464 6e65 7874 2873  r_elem.addnext(s
-0000b680: 6962 6c69 6e67 290a 2020 2020 2020 2020  ibling).        
-0000b690: 6966 2074 6578 743a 0a20 2020 2020 2020  if text:.       
-0000b6a0: 2020 2020 2073 6962 6c69 6e67 2e74 6578       sibling.tex
-0000b6b0: 7420 3d20 7465 7874 0a20 2020 2020 2020  t = text.       
-0000b6c0: 2069 6620 7265 706c 6163 653a 0a20 2020   if replace:.   
-0000b6d0: 2020 2020 2020 2020 2070 6172 656e 742e           parent.
-0000b6e0: 7265 6d6f 7665 2861 6e63 686f 725f 656c  remove(anchor_el
-0000b6f0: 656d 290a 2020 2020 2020 2020 7265 7475  em).        retu
-0000b700: 726e 2073 6962 6c69 6e67 0a0a 2020 2020  rn sibling..    
-0000b710: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-0000b720: 2064 6566 2063 7265 6174 655f 6469 765f   def create_div_
-0000b730: 7370 616e 2863 6c73 2c20 7465 7874 2c20  span(cls, text, 
-0000b740: 7374 796c 653d 4e6f 6e65 293a 0a20 2020  style=None):.   
-0000b750: 2020 2020 2022 2222 7574 696c 6974 7920       """utility 
-0000b760: 6d65 7468 6f64 2074 6f20 6372 6561 7465  method to create
-0000b770: 2061 2064 6976 2f73 7061 6e40 7465 7874   a div/span@text
-0000b780: 2028 7072 6f62 6162 6c79 206d 6169 6e6c   (probably mainl
-0000b790: 7920 666f 7220 7465 7374 696e 6729 0a20  y for testing). 
-0000b7a0: 2020 2020 2020 203a 7061 7261 6d20 7465         :param te
-0000b7b0: 7874 3a20 746f 2061 6464 0a20 2020 2020  xt: to add.     
-0000b7c0: 2020 203a 7265 7475 726e 3a20 7468 6520     :return: the 
-0000b7d0: 6469 7622 2222 0a20 2020 2020 2020 2064  div""".        d
-0000b7e0: 6976 203d 2045 542e 456c 656d 656e 7428  iv = ET.Element(
-0000b7f0: 485f 4449 5629 0a20 2020 2020 2020 2073  H_DIV).        s
-0000b800: 7061 6e20 3d20 4554 2e53 7562 456c 656d  pan = ET.SubElem
-0000b810: 656e 7428 6469 762c 2048 5f53 5041 4e29  ent(div, H_SPAN)
-0000b820: 0a20 2020 2020 2020 2069 6620 7374 796c  .        if styl
-0000b830: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-0000b840: 7373 5f73 7479 6c65 203d 2043 5353 5374  ss_style = CSSSt
-0000b850: 796c 652e 6372 6561 7465 5f63 7373 5f73  yle.create_css_s
-0000b860: 7479 6c65 5f66 726f 6d5f 6373 735f 7374  tyle_from_css_st
-0000b870: 7269 6e67 2822 666f 6e74 2d73 697a 653a  ring("font-size:
-0000b880: 3132 3b20 666f 6e74 2d77 6569 6768 743a  12; font-weight:
-0000b890: 2062 6f6c 643b 2229 0a20 2020 2020 2020   bold;").       
-0000b8a0: 2020 2020 2048 746d 6c53 7479 6c65 2e73       HtmlStyle.s
-0000b8b0: 6574 5f73 7479 6c65 2873 7061 6e2c 2063  et_style(span, c
-0000b8c0: 7373 5f73 7479 6c65 2e67 6574 5f63 7373  ss_style.get_css
-0000b8d0: 5f76 616c 7565 2829 290a 2020 2020 2020  _value()).      
-0000b8e0: 2020 7370 616e 2e74 6578 7420 3d20 7465    span.text = te
-0000b8f0: 7874 0a20 2020 2020 2020 2072 6574 7572  xt.        retur
-0000b900: 6e20 6469 762c 2073 7061 6e0a 0a20 2020  n div, span..   
-0000b910: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-0000b920: 2020 6465 6620 6973 5f73 7562 7363 7269    def is_subscri
-0000b930: 7074 2863 6c73 2c20 6c61 7374 5f73 7061  pt(cls, last_spa
-0000b940: 6e2c 2074 6869 735f 7370 616e 2920 2d3e  n, this_span) ->
-0000b950: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
-0000b960: 2222 6973 2074 6869 735f 7370 616e 2061  ""is this_span a
-0000b970: 2073 7562 7363 7269 7074 3f0a 2020 2020   subscript?.    
-0000b980: 2020 2020 7573 6573 2068 6575 7269 7374      uses heurist
-0000b990: 6963 7320 696e 2069 735f 7363 7269 7074  ics in is_script
-0000b9a0: 5f74 7970 650a 2020 2020 2020 2020 3a70  _type.        :p
-0000b9b0: 6172 616d 206c 6173 745f 7370 616e 3a20  aram last_span: 
-0000b9c0: 7072 6563 6564 696e 6720 7370 616e 2028  preceding span (
-0000b9d0: 6966 204e 6f6e 6520 7265 7475 726e 7320  if None returns 
-0000b9e0: 4661 6c73 6529 0a20 2020 2020 2020 203a  False).        :
-0000b9f0: 7061 7261 6d20 7468 6973 5f73 7061 6e3a  param this_span:
-0000ba00: 2073 7061 6e20 746f 2074 6573 740a 2020   span to test.  
-0000ba10: 2020 2020 2020 3a72 6574 7572 6e3a 2054        :return: T
-0000ba20: 7275 6520 6966 2074 6869 7320 7370 616e  rue if this span
-0000ba30: 2069 7320 736d 616c 6c65 7220 616e 6420   is smaller and 
-0000ba40: 226c 6f77 6572 2220 7468 616e 206c 6173  "lower" than las
-0000ba50: 7422 2222 0a20 2020 2020 2020 2072 6574  t""".        ret
-0000ba60: 7572 6e20 636c 732e 6973 5f73 6372 6970  urn cls.is_scrip
-0000ba70: 745f 7479 7065 286c 6173 745f 7370 616e  t_type(last_span
-0000ba80: 2c20 7468 6973 5f73 7061 6e2c 2073 6372  , this_span, scr
-0000ba90: 6970 745f 7479 7065 3d53 5363 7269 7074  ipt_type=SScript
-0000baa0: 2e53 5542 290a 0a20 2020 2040 636c 6173  .SUB)..    @clas
-0000bab0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-0000bac0: 6973 5f73 7570 6572 7363 7269 7074 2863  is_superscript(c
-0000bad0: 6c73 2c20 6c61 7374 5f73 7061 6e2c 2074  ls, last_span, t
-0000bae0: 6869 735f 7370 616e 2920 2d3e 2062 6f6f  his_span) -> boo
-0000baf0: 6c3a 0a20 2020 2020 2020 2022 2222 6973  l:.        """is
-0000bb00: 2074 6869 735f 7370 616e 2061 2073 7570   this_span a sup
-0000bb10: 6572 7363 7269 7074 3f0a 2020 2020 2020  erscript?.      
-0000bb20: 2020 7573 6573 2068 6575 7269 7374 6963    uses heuristic
-0000bb30: 7320 696e 2069 735f 7363 7269 7074 5f74  s in is_script_t
-0000bb40: 7970 650a 2020 2020 2020 2020 3a70 6172  ype.        :par
-0000bb50: 616d 206c 6173 745f 7370 616e 3a20 7072  am last_span: pr
-0000bb60: 6563 6564 696e 6720 7370 616e 2028 6966  eceding span (if
-0000bb70: 204e 6f6e 6520 7265 7475 726e 7320 4661   None returns Fa
-0000bb80: 6c73 6529 0a20 2020 2020 2020 203a 7061  lse).        :pa
-0000bb90: 7261 6d20 7468 6973 5f73 7061 6e3a 2073  ram this_span: s
-0000bba0: 7061 6e20 746f 2074 6573 740a 2020 2020  pan to test.    
-0000bbb0: 2020 2020 3a72 6574 7572 6e3a 2054 7275      :return: Tru
-0000bbc0: 6520 6966 2074 6869 7320 7370 616e 2069  e if this span i
-0000bbd0: 7320 736d 616c 6c65 7220 616e 6420 2268  s smaller and "h
-0000bbe0: 6967 6865 7222 2074 6861 6e20 6c61 7374  igher" than last
-0000bbf0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0000bc00: 726e 2063 6c73 2e69 735f 7363 7269 7074  rn cls.is_script
-0000bc10: 5f74 7970 6528 6c61 7374 5f73 7061 6e2c  _type(last_span,
-0000bc20: 2074 6869 735f 7370 616e 2c20 7363 7269   this_span, scri
-0000bc30: 7074 5f74 7970 653d 5353 6372 6970 742e  pt_type=SScript.
-0000bc40: 5355 5029 0a0a 2020 2020 4063 6c61 7373  SUP)..    @class
-0000bc50: 6d65 7468 6f64 0a20 2020 2064 6566 2069  method.    def i
-0000bc60: 735f 7363 7269 7074 5f74 7970 6528 636c  s_script_type(cl
-0000bc70: 732c 206c 6173 745f 7370 616e 2c20 7468  s, last_span, th
-0000bc80: 6973 5f73 7061 6e2c 2073 6372 6970 745f  is_span, script_
-0000bc90: 7479 7065 2c20 7964 6f77 6e3d 5472 7565  type, ydown=True
-0000bca0: 2c20 7072 6563 6564 696e 673d 4e6f 6e65  , preceding=None
-0000bcb0: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-0000bcc0: 2020 2022 2222 6865 7572 6973 7463 2074     """heuristc t
-0000bcd0: 6f20 6465 7465 726d 696e 6520 7768 6574  o determine whet
-0000bce0: 6865 7220 7468 6973 5f73 7061 6e20 6973  her this_span is
-0000bcf0: 2061 2073 7562 2f73 7570 6572 7363 7269   a sub/superscri
-0000bd00: 7074 206f 6620 6c61 7374 5f73 7061 6e0a  pt of last_span.
-0000bd10: 2020 2020 2020 2020 4e4f 5445 3a20 4946          NOTE: IF
-0000bd20: 2059 2069 7320 444f 574e 2074 6865 2070   Y is DOWN the p
-0000bd30: 6167 652c 2061 2073 7570 6572 7363 7269  age, a superscri
-0000bd40: 7074 2068 6173 2053 4d41 4c4c 4552 2079  pt has SMALLER y
-0000bd50: 2d76 616c 7565 2c20 6574 632e 2028 6c6f  -value, etc. (lo
-0000bd60: 6769 6320 7265 7665 7273 6564 2069 6620  gic reversed if 
-0000bd70: 6e6f 7420 7964 6f77 6e29 0a20 2020 2020  not ydown).     
-0000bd80: 2020 203a 7061 7261 6d20 6c61 7374 5f73     :param last_s
-0000bd90: 7061 6e3a 2069 6620 4e6f 6e65 2c20 7265  pan: if None, re
-0000bda0: 7475 726e 7320 6661 6c73 650a 2020 2020  turns false.    
-0000bdb0: 2020 2020 3a70 6172 616d 2074 6869 735f      :param this_
-0000bdc0: 7370 616e 3a20 6966 206e 6f74 2073 6d61  span: if not sma
-0000bdd0: 6c6c 6572 2062 7920 5343 5249 5054 5f46  ller by SCRIPT_F
-0000bde0: 4143 5420 7265 7475 726e 2046 616c 7365  ACT return False
-0000bdf0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000be00: 7363 7269 7074 5f74 7970 653a 2053 5363  script_type: SSc
-0000be10: 7269 7074 2e53 5542 206f 7220 5353 6372  ript.SUB or SScr
-0000be20: 6970 742e 5355 500a 2020 2020 2020 2020  ipt.SUP.        
-0000be30: 3a70 6172 616d 2079 646f 776e 3a20 5472  :param ydown: Tr
-0000be40: 7565 2069 6620 7920 696e 6372 6561 7365  ue if y increase
-0000be50: 7320 646f 776e 2074 6872 2070 6167 6520  s down thr page 
-0000be60: 2865 2e67 2e20 5356 4729 2028 4445 4641  (e.g. SVG) (DEFA
-0000be70: 554c 5429 2065 6c73 6520 4661 6c73 650a  ULT) else False.
-0000be80: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0000be90: 2054 7275 6520 6966 2073 6d61 6c6c 6572   True if smaller
-0000bea0: 2061 6e64 206d 6f76 6564 2069 6e20 7269   and moved in ri
-0000beb0: 6768 7420 792d 6469 7265 6374 696f 6e0a  ght y-direction.
-0000bec0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000bed0: 2020 2020 6966 2074 6869 735f 7370 616e      if this_span
-0000bee0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-0000bef0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0000bf00: 7365 0a20 2020 2020 2020 2023 2074 7279  se.        # try
-0000bf10: 2074 6f20 6669 6e64 206d 6973 7369 6e67   to find missing
-0000bf20: 206c 6173 745f 7370 616e 0a20 2020 2020   last_span.     
-0000bf30: 2020 2069 6620 6c61 7374 5f73 7061 6e20     if last_span 
-0000bf40: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0000bf50: 2020 2020 206c 6173 745f 7370 616e 203d       last_span =
-0000bf60: 2074 6869 735f 7370 616e 2e78 7061 7468   this_span.xpath
-0000bf70: 2866 227b 585f 5052 4543 4544 494e 477d  (f"{X_PRECEDING}
-0000bf80: 3a3a 7b48 5f53 5041 4e7d 2229 0a20 2020  ::{H_SPAN}").   
-0000bf90: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0000bfa0: 6c61 7374 5f73 7061 6e29 203d 3d20 303a  last_span) == 0:
-0000bfb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bfc0: 2072 6574 7572 6e20 4661 6c73 650a 2020   return False.  
-0000bfd0: 2020 2020 2020 2020 2020 6c61 7374 5f73            last_s
-0000bfe0: 7061 6e20 3d20 6c61 7374 5f73 7061 6e5b  pan = last_span[
-0000bff0: 305d 0a20 2020 2020 2020 2074 7279 3a0a  0].        try:.
-0000c000: 2020 2020 2020 2020 2020 2020 6c61 7374              last
-0000c010: 5f66 6f6e 745f 7369 7a65 203d 204e 6f6e  _font_size = Non
-0000c020: 650a 2020 2020 2020 2020 2020 2020 7468  e.            th
-0000c030: 6973 5f66 6f6e 745f 7369 7a65 203d 204e  is_font_size = N
-0000c040: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0000c050: 6c61 7374 5f66 6f6e 745f 7369 7a65 203d  last_font_size =
-0000c060: 206c 6173 745f 7370 616e 2e74 6578 745f   last_span.text_
-0000c070: 7374 796c 652e 5f66 6f6e 745f 7369 7a65  style._font_size
-0000c080: 0a20 2020 2020 2020 2020 2020 2074 6869  .            thi
-0000c090: 735f 666f 6e74 5f73 697a 6520 3d20 7468  s_font_size = th
-0000c0a0: 6973 5f73 7061 6e2e 7465 7874 5f73 7479  is_span.text_sty
-0000c0b0: 6c65 2e5f 666f 6e74 5f73 697a 650a 2020  le._font_size.  
-0000c0c0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-0000c0d0: 6570 7469 6f6e 2061 7320 653a 0a20 2020  eption as e:.   
-0000c0e0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-0000c0f0: 2020 2020 2020 2020 2020 2320 6e6f 2066            # no f
-0000c100: 6f6e 7420 7374 796c 650a 2020 2020 2020  ont style.      
-0000c110: 2020 6973 5f73 6372 6970 7420 3d20 636c    is_script = cl
-0000c120: 732e 6973 5f72 6571 7569 7265 645f 7363  s.is_required_sc
-0000c130: 7269 7074 5f74 7970 6528 7363 7269 7074  ript_type(script
-0000c140: 5f74 7970 652c 206c 6173 745f 666f 6e74  _type, last_font
-0000c150: 5f73 697a 652c 206c 6173 745f 7370 616e  _size, last_span
-0000c160: 2c20 7468 6973 5f66 6f6e 745f 7369 7a65  , this_font_size
-0000c170: 2c20 7468 6973 5f73 7061 6e2c 0a20 2020  , this_span,.   
-0000c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b200: 2020 2020 2069 645f 636f 756e 7465 723d       id_counter=
+0000b210: 6964 5f63 6f75 6e74 6572 290a 2020 2020  id_counter).    
+0000b220: 2020 2020 7265 7475 726e 206e 6577 5f65      return new_e
+0000b230: 6c65 6d73 2c20 6964 5f63 6f75 6e74 6572  lems, id_counter
+0000b240: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+0000b250: 6f64 0a20 2020 2064 6566 2061 6464 5f69  od.    def add_i
+0000b260: 645f 696e 6372 656d 656e 745f 636f 756e  d_increment_coun
+0000b270: 7465 7228 636c 732c 2069 645f 636f 756e  ter(cls, id_coun
+0000b280: 7465 722c 2069 645f 726f 6f74 2c20 6874  ter, id_root, ht
+0000b290: 6d6c 5f65 6c65 6d29 3a0a 2020 2020 2020  ml_elem):.      
+0000b2a0: 2020 6966 2069 645f 726f 6f74 3a0a 2020    if id_root:.  
+0000b2b0: 2020 2020 2020 2020 2020 6874 6d6c 5f65            html_e
+0000b2c0: 6c65 6d2e 6174 7472 6962 5b41 5f49 445d  lem.attrib[A_ID]
+0000b2d0: 203d 2069 645f 726f 6f74 202b 2073 7472   = id_root + str
+0000b2e0: 2869 645f 636f 756e 7465 7229 0a20 2020  (id_counter).   
+0000b2f0: 2020 2020 2020 2020 2069 645f 636f 756e           id_coun
+0000b300: 7465 7220 2b3d 2031 0a20 2020 2020 2020  ter += 1.       
+0000b310: 2072 6574 7572 6e20 6964 5f63 6f75 6e74   return id_count
+0000b320: 6572 0a0a 2020 2020 4063 6c61 7373 6d65  er..    @classme
+0000b330: 7468 6f64 0a20 2020 2064 6566 2061 6464  thod.    def add
+0000b340: 5f73 6962 6c69 6e67 5f61 6674 6572 2863  _sibling_after(c
+0000b350: 6c73 2c20 616e 6368 6f72 5f65 6c65 6d2c  ls, anchor_elem,
+0000b360: 2074 6167 2c20 7265 706c 6163 653d 4661   tag, replace=Fa
+0000b370: 6c73 652c 2063 6f70 795f 6174 7473 3d46  lse, copy_atts=F
+0000b380: 616c 7365 2c20 7465 7874 3d4e 6f6e 6529  alse, text=None)
+0000b390: 3a0a 2020 2020 2020 2020 2222 2261 6464  :.        """add
+0000b3a0: 7320 6e65 7720 7472 6169 6c69 6e67 2073  s new trailing s
+0000b3b0: 6962 6c69 6e67 206f 6620 616e 6368 6f72  ibling of anchor
+0000b3c0: 5f65 6c65 6d20 7769 7468 2074 6167 0a20  _elem with tag. 
+0000b3d0: 2020 2020 2020 203a 7061 7261 6d20 7461         :param ta
+0000b3e0: 673a 2074 6167 2066 6f72 206e 6577 2065  g: tag for new e
+0000b3f0: 6c65 6d65 6e74 0a20 2020 2020 2020 203a  lement.        :
+0000b400: 7061 7261 6d20 616e 6368 6f72 5f65 6c65  param anchor_ele
+0000b410: 6d3a 2072 6566 6572 656e 6365 2065 6c65  m: reference ele
+0000b420: 6d65 6e74 2c20 6d75 7374 2068 6176 6520  ment, must have 
+0000b430: 6120 7061 7265 6e74 0a20 2020 2020 2020  a parent.       
+0000b440: 203a 7061 7261 6d20 7265 706c 6163 653a   :param replace:
+0000b450: 2069 6620 5472 7565 2c20 7265 6d6f 7665   if True, remove
+0000b460: 2061 6e63 686f 7220 656c 656d 656e 740a   anchor element.
+0000b470: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
+0000b480: 6f70 795f 6174 7473 3a20 636f 7079 2061  opy_atts: copy a
+0000b490: 7474 7269 6275 7465 7320 6672 6f6d 2061  ttributes from a
+0000b4a0: 6e63 686f 720a 2020 2020 2020 2020 3a70  nchor.        :p
+0000b4b0: 6172 616d 2074 6578 743a 2069 6620 6e6f  aram text: if no
+0000b4c0: 7420 4e6f 6e65 2061 6464 2074 6578 7420  t None add text 
+0000b4d0: 746f 206e 6577 2065 6c65 6d65 6e74 0a20  to new element. 
+0000b4e0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
+0000b4f0: 6e65 7720 7369 626c 696e 6720 7769 7468  new sibling with
+0000b500: 206f 7074 696f 6e61 6c20 6179 7974 7269   optional ayytri
+0000b510: 6275 7465 7320 616e 6420 7465 7874 0a0a  butes and text..
+0000b520: 0a0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+0000b530: 2020 2020 2020 2061 7373 6572 7420 616e         assert an
+0000b540: 6368 6f72 5f65 6c65 6d20 6973 206e 6f74  chor_elem is not
+0000b550: 204e 6f6e 650a 2020 2020 2020 2020 6173   None.        as
+0000b560: 7365 7274 2074 6167 0a20 2020 2020 2020  sert tag.       
+0000b570: 2070 6172 656e 7420 3d20 616e 6368 6f72   parent = anchor
+0000b580: 5f65 6c65 6d2e 6765 7470 6172 656e 7428  _elem.getparent(
+0000b590: 290a 2020 2020 2020 2020 6173 7365 7274  ).        assert
+0000b5a0: 2070 6172 656e 7420 6973 206e 6f74 204e   parent is not N
+0000b5b0: 6f6e 652c 2066 224e 6f20 7061 7265 6e74  one, f"No parent
+0000b5c0: 2066 6f72 2061 6e63 686f 725f 656c 656d   for anchor_elem
+0000b5d0: 220a 2020 2020 2020 2020 7369 626c 696e  ".        siblin
+0000b5e0: 6720 3d20 4554 2e53 7562 456c 656d 656e  g = ET.SubElemen
+0000b5f0: 7428 7061 7265 6e74 2c20 7461 6729 0a20  t(parent, tag). 
+0000b600: 2020 2020 2020 2069 6620 636f 7079 5f61         if copy_a
+0000b610: 7474 733a 0a20 2020 2020 2020 2020 2020  tts:.           
+0000b620: 2066 6f72 206b 2c20 7620 696e 2061 6e63   for k, v in anc
+0000b630: 686f 725f 656c 656d 2e61 7474 7269 622e  hor_elem.attrib.
+0000b640: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0000b650: 2020 2020 2020 2020 2073 6962 6c69 6e67           sibling
+0000b660: 2e61 7474 7269 625b 6b5d 203d 2076 0a20  .attrib[k] = v. 
+0000b670: 2020 2020 2020 2061 6e63 686f 725f 656c         anchor_el
+0000b680: 656d 2e61 6464 6e65 7874 2873 6962 6c69  em.addnext(sibli
+0000b690: 6e67 290a 2020 2020 2020 2020 6966 2074  ng).        if t
+0000b6a0: 6578 743a 0a20 2020 2020 2020 2020 2020  ext:.           
+0000b6b0: 2073 6962 6c69 6e67 2e74 6578 7420 3d20   sibling.text = 
+0000b6c0: 7465 7874 0a20 2020 2020 2020 2069 6620  text.        if 
+0000b6d0: 7265 706c 6163 653a 0a20 2020 2020 2020  replace:.       
+0000b6e0: 2020 2020 2070 6172 656e 742e 7265 6d6f       parent.remo
+0000b6f0: 7665 2861 6e63 686f 725f 656c 656d 290a  ve(anchor_elem).
+0000b700: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000b710: 6962 6c69 6e67 0a0a 2020 2020 4063 6c61  ibling..    @cla
+0000b720: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+0000b730: 2063 7265 6174 655f 6469 765f 7370 616e   create_div_span
+0000b740: 2863 6c73 2c20 7465 7874 2c20 7374 796c  (cls, text, styl
+0000b750: 653d 4e6f 6e65 293a 0a20 2020 2020 2020  e=None):.       
+0000b760: 2022 2222 7574 696c 6974 7920 6d65 7468   """utility meth
+0000b770: 6f64 2074 6f20 6372 6561 7465 2061 2064  od to create a d
+0000b780: 6976 2f73 7061 6e40 7465 7874 2028 7072  iv/span@text (pr
+0000b790: 6f62 6162 6c79 206d 6169 6e6c 7920 666f  obably mainly fo
+0000b7a0: 7220 7465 7374 696e 6729 0a20 2020 2020  r testing).     
+0000b7b0: 2020 203a 7061 7261 6d20 7465 7874 3a20     :param text: 
+0000b7c0: 746f 2061 6464 0a20 2020 2020 2020 203a  to add.        :
+0000b7d0: 7265 7475 726e 3a20 7468 6520 6469 7622  return: the div"
+0000b7e0: 2222 0a20 2020 2020 2020 2064 6976 203d  "".        div =
+0000b7f0: 2045 542e 456c 656d 656e 7428 485f 4449   ET.Element(H_DI
+0000b800: 5629 0a20 2020 2020 2020 2073 7061 6e20  V).        span 
+0000b810: 3d20 4554 2e53 7562 456c 656d 656e 7428  = ET.SubElement(
+0000b820: 6469 762c 2048 5f53 5041 4e29 0a20 2020  div, H_SPAN).   
+0000b830: 2020 2020 2069 6620 7374 796c 653a 0a20       if style:. 
+0000b840: 2020 2020 2020 2020 2020 2063 7373 5f73             css_s
+0000b850: 7479 6c65 203d 2043 5353 5374 796c 652e  tyle = CSSStyle.
+0000b860: 6372 6561 7465 5f63 7373 5f73 7479 6c65  create_css_style
+0000b870: 5f66 726f 6d5f 6373 735f 7374 7269 6e67  _from_css_string
+0000b880: 2822 666f 6e74 2d73 697a 653a 3132 3b20  ("font-size:12; 
+0000b890: 666f 6e74 2d77 6569 6768 743a 2062 6f6c  font-weight: bol
+0000b8a0: 643b 2229 0a20 2020 2020 2020 2020 2020  d;").           
+0000b8b0: 2048 746d 6c53 7479 6c65 2e73 6574 5f73   HtmlStyle.set_s
+0000b8c0: 7479 6c65 2873 7061 6e2c 2063 7373 5f73  tyle(span, css_s
+0000b8d0: 7479 6c65 2e67 6574 5f63 7373 5f76 616c  tyle.get_css_val
+0000b8e0: 7565 2829 290a 2020 2020 2020 2020 7370  ue()).        sp
+0000b8f0: 616e 2e74 6578 7420 3d20 7465 7874 0a20  an.text = text. 
+0000b900: 2020 2020 2020 2072 6574 7572 6e20 6469         return di
+0000b910: 762c 2073 7061 6e0a 0a20 2020 2040 636c  v, span..    @cl
+0000b920: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0000b930: 6620 6973 5f73 7562 7363 7269 7074 2863  f is_subscript(c
+0000b940: 6c73 2c20 6c61 7374 5f73 7061 6e2c 2074  ls, last_span, t
+0000b950: 6869 735f 7370 616e 2920 2d3e 2062 6f6f  his_span) -> boo
+0000b960: 6c3a 0a20 2020 2020 2020 2022 2222 6973  l:.        """is
+0000b970: 2074 6869 735f 7370 616e 2061 2073 7562   this_span a sub
+0000b980: 7363 7269 7074 3f0a 2020 2020 2020 2020  script?.        
+0000b990: 7573 6573 2068 6575 7269 7374 6963 7320  uses heuristics 
+0000b9a0: 696e 2069 735f 7363 7269 7074 5f74 7970  in is_script_typ
+0000b9b0: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
+0000b9c0: 206c 6173 745f 7370 616e 3a20 7072 6563   last_span: prec
+0000b9d0: 6564 696e 6720 7370 616e 2028 6966 204e  eding span (if N
+0000b9e0: 6f6e 6520 7265 7475 726e 7320 4661 6c73  one returns Fals
+0000b9f0: 6529 0a20 2020 2020 2020 203a 7061 7261  e).        :para
+0000ba00: 6d20 7468 6973 5f73 7061 6e3a 2073 7061  m this_span: spa
+0000ba10: 6e20 746f 2074 6573 740a 2020 2020 2020  n to test.      
+0000ba20: 2020 3a72 6574 7572 6e3a 2054 7275 6520    :return: True 
+0000ba30: 6966 2074 6869 7320 7370 616e 2069 7320  if this span is 
+0000ba40: 736d 616c 6c65 7220 616e 6420 226c 6f77  smaller and "low
+0000ba50: 6572 2220 7468 616e 206c 6173 7422 2222  er" than last"""
+0000ba60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000ba70: 636c 732e 6973 5f73 6372 6970 745f 7479  cls.is_script_ty
+0000ba80: 7065 286c 6173 745f 7370 616e 2c20 7468  pe(last_span, th
+0000ba90: 6973 5f73 7061 6e2c 2073 6372 6970 745f  is_span, script_
+0000baa0: 7479 7065 3d53 5363 7269 7074 2e53 5542  type=SScript.SUB
+0000bab0: 290a 0a20 2020 2040 636c 6173 736d 6574  )..    @classmet
+0000bac0: 686f 640a 2020 2020 6465 6620 6973 5f73  hod.    def is_s
+0000bad0: 7570 6572 7363 7269 7074 2863 6c73 2c20  uperscript(cls, 
+0000bae0: 6c61 7374 5f73 7061 6e2c 2074 6869 735f  last_span, this_
+0000baf0: 7370 616e 2920 2d3e 2062 6f6f 6c3a 0a20  span) -> bool:. 
+0000bb00: 2020 2020 2020 2022 2222 6973 2074 6869         """is thi
+0000bb10: 735f 7370 616e 2061 2073 7570 6572 7363  s_span a supersc
+0000bb20: 7269 7074 3f0a 2020 2020 2020 2020 7573  ript?.        us
+0000bb30: 6573 2068 6575 7269 7374 6963 7320 696e  es heuristics in
+0000bb40: 2069 735f 7363 7269 7074 5f74 7970 650a   is_script_type.
+0000bb50: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
+0000bb60: 6173 745f 7370 616e 3a20 7072 6563 6564  ast_span: preced
+0000bb70: 696e 6720 7370 616e 2028 6966 204e 6f6e  ing span (if Non
+0000bb80: 6520 7265 7475 726e 7320 4661 6c73 6529  e returns False)
+0000bb90: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000bba0: 7468 6973 5f73 7061 6e3a 2073 7061 6e20  this_span: span 
+0000bbb0: 746f 2074 6573 740a 2020 2020 2020 2020  to test.        
+0000bbc0: 3a72 6574 7572 6e3a 2054 7275 6520 6966  :return: True if
+0000bbd0: 2074 6869 7320 7370 616e 2069 7320 736d   this span is sm
+0000bbe0: 616c 6c65 7220 616e 6420 2268 6967 6865  aller and "highe
+0000bbf0: 7222 2074 6861 6e20 6c61 7374 2222 220a  r" than last""".
+0000bc00: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+0000bc10: 6c73 2e69 735f 7363 7269 7074 5f74 7970  ls.is_script_typ
+0000bc20: 6528 6c61 7374 5f73 7061 6e2c 2074 6869  e(last_span, thi
+0000bc30: 735f 7370 616e 2c20 7363 7269 7074 5f74  s_span, script_t
+0000bc40: 7970 653d 5353 6372 6970 742e 5355 5029  ype=SScript.SUP)
+0000bc50: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+0000bc60: 6f64 0a20 2020 2064 6566 2069 735f 7363  od.    def is_sc
+0000bc70: 7269 7074 5f74 7970 6528 636c 732c 206c  ript_type(cls, l
+0000bc80: 6173 745f 7370 616e 2c20 7468 6973 5f73  ast_span, this_s
+0000bc90: 7061 6e2c 2073 6372 6970 745f 7479 7065  pan, script_type
+0000bca0: 2c20 7964 6f77 6e3d 5472 7565 2c20 7072  , ydown=True, pr
+0000bcb0: 6563 6564 696e 673d 4e6f 6e65 2920 2d3e  eceding=None) ->
+0000bcc0: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
+0000bcd0: 2222 6865 7572 6973 7463 2074 6f20 6465  ""heuristc to de
+0000bce0: 7465 726d 696e 6520 7768 6574 6865 7220  termine whether 
+0000bcf0: 7468 6973 5f73 7061 6e20 6973 2061 2073  this_span is a s
+0000bd00: 7562 2f73 7570 6572 7363 7269 7074 206f  ub/superscript o
+0000bd10: 6620 6c61 7374 5f73 7061 6e0a 2020 2020  f last_span.    
+0000bd20: 2020 2020 4e4f 5445 3a20 4946 2059 2069      NOTE: IF Y i
+0000bd30: 7320 444f 574e 2074 6865 2070 6167 652c  s DOWN the page,
+0000bd40: 2061 2073 7570 6572 7363 7269 7074 2068   a superscript h
+0000bd50: 6173 2053 4d41 4c4c 4552 2079 2d76 616c  as SMALLER y-val
+0000bd60: 7565 2c20 6574 632e 2028 6c6f 6769 6320  ue, etc. (logic 
+0000bd70: 7265 7665 7273 6564 2069 6620 6e6f 7420  reversed if not 
+0000bd80: 7964 6f77 6e29 0a20 2020 2020 2020 203a  ydown).        :
+0000bd90: 7061 7261 6d20 6c61 7374 5f73 7061 6e3a  param last_span:
+0000bda0: 2069 6620 4e6f 6e65 2c20 7265 7475 726e   if None, return
+0000bdb0: 7320 6661 6c73 650a 2020 2020 2020 2020  s false.        
+0000bdc0: 3a70 6172 616d 2074 6869 735f 7370 616e  :param this_span
+0000bdd0: 3a20 6966 206e 6f74 2073 6d61 6c6c 6572  : if not smaller
+0000bde0: 2062 7920 5343 5249 5054 5f46 4143 5420   by SCRIPT_FACT 
+0000bdf0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
+0000be00: 2020 2020 203a 7061 7261 6d20 7363 7269       :param scri
+0000be10: 7074 5f74 7970 653a 2053 5363 7269 7074  pt_type: SScript
+0000be20: 2e53 5542 206f 7220 5353 6372 6970 742e  .SUB or SScript.
+0000be30: 5355 500a 2020 2020 2020 2020 3a70 6172  SUP.        :par
+0000be40: 616d 2079 646f 776e 3a20 5472 7565 2069  am ydown: True i
+0000be50: 6620 7920 696e 6372 6561 7365 7320 646f  f y increases do
+0000be60: 776e 2074 6872 2070 6167 6520 2865 2e67  wn thr page (e.g
+0000be70: 2e20 5356 4729 2028 4445 4641 554c 5429  . SVG) (DEFAULT)
+0000be80: 2065 6c73 6520 4661 6c73 650a 2020 2020   else False.    
+0000be90: 2020 2020 3a72 6574 7572 6e3a 2054 7275      :return: Tru
+0000bea0: 6520 6966 2073 6d61 6c6c 6572 2061 6e64  e if smaller and
+0000beb0: 206d 6f76 6564 2069 6e20 7269 6768 7420   moved in right 
+0000bec0: 792d 6469 7265 6374 696f 6e0a 2020 2020  y-direction.    
+0000bed0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000bee0: 6966 2074 6869 735f 7370 616e 2069 7320  if this_span is 
+0000bef0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0000bf00: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+0000bf10: 2020 2020 2020 2023 2074 7279 2074 6f20         # try to 
+0000bf20: 6669 6e64 206d 6973 7369 6e67 206c 6173  find missing las
+0000bf30: 745f 7370 616e 0a20 2020 2020 2020 2069  t_span.        i
+0000bf40: 6620 6c61 7374 5f73 7061 6e20 6973 204e  f last_span is N
+0000bf50: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0000bf60: 206c 6173 745f 7370 616e 203d 2074 6869   last_span = thi
+0000bf70: 735f 7370 616e 2e78 7061 7468 2866 227b  s_span.xpath(f"{
+0000bf80: 585f 5052 4543 4544 494e 477d 3a3a 7b48  X_PRECEDING}::{H
+0000bf90: 5f53 5041 4e7d 2229 0a20 2020 2020 2020  _SPAN}").       
+0000bfa0: 2020 2020 2069 6620 6c65 6e28 6c61 7374       if len(last
+0000bfb0: 5f73 7061 6e29 203d 3d20 303a 0a20 2020  _span) == 0:.   
+0000bfc0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000bfd0: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
+0000bfe0: 2020 2020 2020 6c61 7374 5f73 7061 6e20        last_span 
+0000bff0: 3d20 6c61 7374 5f73 7061 6e5b 305d 0a20  = last_span[0]. 
+0000c000: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000c010: 2020 2020 2020 2020 6c61 7374 5f66 6f6e          last_fon
+0000c020: 745f 7369 7a65 203d 204e 6f6e 650a 2020  t_size = None.  
+0000c030: 2020 2020 2020 2020 2020 7468 6973 5f66            this_f
+0000c040: 6f6e 745f 7369 7a65 203d 204e 6f6e 650a  ont_size = None.
+0000c050: 2020 2020 2020 2020 2020 2020 6c61 7374              last
+0000c060: 5f66 6f6e 745f 7369 7a65 203d 206c 6173  _font_size = las
+0000c070: 745f 7370 616e 2e74 6578 745f 7374 796c  t_span.text_styl
+0000c080: 652e 5f66 6f6e 745f 7369 7a65 0a20 2020  e._font_size.   
+0000c090: 2020 2020 2020 2020 2074 6869 735f 666f           this_fo
+0000c0a0: 6e74 5f73 697a 6520 3d20 7468 6973 5f73  nt_size = this_s
+0000c0b0: 7061 6e2e 7465 7874 5f73 7479 6c65 2e5f  pan.text_style._
+0000c0c0: 666f 6e74 5f73 697a 650a 2020 2020 2020  font_size.      
+0000c0d0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+0000c0e0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+0000c0f0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0000c100: 2020 2020 2020 2320 6e6f 2066 6f6e 7420        # no font 
+0000c110: 7374 796c 650a 2020 2020 2020 2020 6973  style.        is
+0000c120: 5f73 6372 6970 7420 3d20 636c 732e 6973  _script = cls.is
+0000c130: 5f72 6571 7569 7265 645f 7363 7269 7074  _required_script
+0000c140: 5f74 7970 6528 7363 7269 7074 5f74 7970  _type(script_typ
+0000c150: 652c 206c 6173 745f 666f 6e74 5f73 697a  e, last_font_siz
+0000c160: 652c 206c 6173 745f 7370 616e 2c20 7468  e, last_span, th
+0000c170: 6973 5f66 6f6e 745f 7369 7a65 2c20 7468  is_font_size, th
+0000c180: 6973 5f73 7061 6e2c 0a20 2020 2020 2020  is_span,.       
 0000c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c1a0: 2020 2020 2020 2020 2079 646f 776e 290a           ydown).
-0000c1b0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-0000c1c0: 735f 7363 7269 7074 0a0a 2020 2020 4063  s_script..    @c
-0000c1d0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-0000c1e0: 6566 2069 735f 7265 7175 6972 6564 5f73  ef is_required_s
-0000c1f0: 6372 6970 745f 7479 7065 2863 6c73 2c20  cript_type(cls, 
-0000c200: 7363 7269 7074 5f74 7970 652c 206c 6173  script_type, las
-0000c210: 745f 666f 6e74 5f73 697a 652c 206c 6173  t_font_size, las
-0000c220: 745f 7370 616e 2c20 7468 6973 5f66 6f6e  t_span, this_fon
-0000c230: 745f 7369 7a65 2c20 7468 6973 5f73 7061  t_size, this_spa
-0000c240: 6e2c 2079 646f 776e 3d54 7275 652c 2029  n, ydown=True, )
-0000c250: 3a0a 2020 2020 2020 2020 2222 226f 6c64  :.        """old
-0000c260: 2061 7070 726f 6163 6820 7769 7468 2041   approach with A
-0000c270: 6d69 5370 616e 0a20 2020 2020 2020 2054  miSpan.        T
-0000c280: 6869 7320 6973 206e 6f74 2072 6967 6874  his is not right
-0000c290: 2122 2222 0a20 2020 2020 2020 2059 4641  !""".        YFA
-0000c2a0: 4354 4f52 203d 2033 2023 2070 6978 656c  CTOR = 3 # pixel
-0000c2b0: 730a 2020 2020 2020 2020 6973 5f73 6372  s.        is_scr
-0000c2c0: 6970 7420 3d20 4661 6c73 650a 2020 2020  ipt = False.    
-0000c2d0: 2020 2020 7363 7269 7074 5f66 6163 746f      script_facto
-0000c2e0: 7220 3d20 4874 6d6c 5574 696c 2e53 4352  r = HtmlUtil.SCR
-0000c2f0: 4950 545f 4641 4354 0a20 2020 2020 2020  IPT_FACT.       
-0000c300: 2023 2069 6620 666f 6e74 2073 697a 6573   # if font sizes
-0000c310: 206e 6f74 2067 6976 656e 2061 7373 756d   not given assum
-0000c320: 6520 7468 6579 2064 6f6e 2774 206d 6174  e they don't mat
-0000c330: 7465 720a 2020 2020 2020 2020 6966 206c  ter.        if l
-0000c340: 6173 745f 666f 6e74 5f73 697a 6520 616e  ast_font_size an
-0000c350: 6420 7468 6973 5f66 6f6e 745f 7369 7a65  d this_font_size
-0000c360: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
-0000c370: 7373 6564 5f66 6f6e 745f 7369 7a65 5f63  ssed_font_size_c
-0000c380: 6861 6e67 6520 3d20 7468 6973 5f66 6f6e  hange = this_fon
-0000c390: 745f 7369 7a65 203c 2073 6372 6970 745f  t_size < script_
-0000c3a0: 6661 6374 6f72 202a 206c 6173 745f 666f  factor * last_fo
-0000c3b0: 6e74 5f73 697a 650a 2020 2020 2020 2020  nt_size.        
-0000c3c0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000c3d0: 2020 7061 7373 6564 5f66 6f6e 745f 7369    passed_font_si
-0000c3e0: 7a65 5f63 6861 6e67 6520 3d20 5472 7565  ze_change = True
-0000c3f0: 0a20 2020 2020 2020 2023 2075 7365 2079  .        # use y
-0000c400: 2063 6f6f 7264 730a 2020 2020 2020 2020   coords.        
-0000c410: 6966 2070 6173 7365 645f 666f 6e74 5f73  if passed_font_s
-0000c420: 697a 655f 6368 616e 6765 3a0a 2020 2020  ize_change:.    
-0000c430: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000c440: 2020 2020 2020 2020 2020 2020 206c 6173               las
-0000c450: 745f 7920 3d20 6c61 7374 5f73 7061 6e2e  t_y = last_span.
-0000c460: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
-0000c470: 2020 7468 6973 5f79 203d 2074 6869 735f    this_y = this_
-0000c480: 7370 616e 2e79 0a20 2020 2020 2020 2020  span.y.         
-0000c490: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
-0000c4a0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-0000c4b0: 2020 2020 2020 2020 2020 6c61 7374 5f79            last_y
-0000c4c0: 203d 2048 746d 6c55 7469 6c2e 6765 745f   = HtmlUtil.get_
-0000c4d0: 666c 6f61 7428 6c61 7374 5f73 7061 6e2c  float(last_span,
-0000c4e0: 2022 7930 2229 0a20 2020 2020 2020 2020   "y0").         
-0000c4f0: 2020 2020 2020 2074 6869 735f 7920 3d20         this_y = 
-0000c500: 4874 6d6c 5574 696c 2e67 6574 5f66 6c6f  HtmlUtil.get_flo
-0000c510: 6174 2874 6869 735f 7370 616e 2c20 2279  at(this_span, "y
-0000c520: 3022 290a 2020 2020 2020 2020 2020 2020  0").            
-0000c530: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000c540: 2020 2020 206c 6173 745f 7820 3d20 6c61       last_x = la
-0000c550: 7374 5f73 7061 6e2e 780a 2020 2020 2020  st_span.x.      
-0000c560: 2020 2020 2020 2020 2020 7468 6973 5f78            this_x
-0000c570: 203d 2074 6869 735f 7370 616e 2e78 0a20   = this_span.x. 
-0000c580: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-0000c590: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
-0000c5a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c5b0: 2020 6c61 7374 5f78 203d 2048 746d 6c55    last_x = HtmlU
-0000c5c0: 7469 6c2e 6765 745f 666c 6f61 7428 6c61  til.get_float(la
-0000c5d0: 7374 5f73 7061 6e2c 2022 7830 2229 0a20  st_span, "x0"). 
-0000c5e0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000c5f0: 6869 735f 7820 3d20 4874 6d6c 5574 696c  his_x = HtmlUtil
-0000c600: 2e67 6574 5f66 6c6f 6174 2874 6869 735f  .get_float(this_
-0000c610: 7370 616e 2c20 2278 3022 290a 2020 2020  span, "x0").    
-0000c620: 2020 2020 2020 2020 6966 2073 6372 6970          if scrip
-0000c630: 745f 7479 7065 203d 3d20 5353 6372 6970  t_type == SScrip
-0000c640: 742e 5355 423a 0a20 2020 2020 2020 2020  t.SUB:.         
-0000c650: 2020 2020 2020 2023 2069 7320 6974 206c         # is it l
-0000c660: 6f77 6572 6564 3f20 5920 444f 574e 0a20  owered? Y DOWN. 
-0000c670: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000c680: 735f 7363 7269 7074 203d 2079 646f 776e  s_script = ydown
-0000c690: 2061 6e64 2028 6c61 7374 5f79 203c 2074   and (last_y < t
-0000c6a0: 6869 735f 7929 0a20 2020 2020 2020 2020  his_y).         
-0000c6b0: 2020 2065 6c69 6620 7363 7269 7074 5f74     elif script_t
-0000c6c0: 7970 6520 3d3d 2053 5363 7269 7074 2e53  ype == SScript.S
-0000c6d0: 5550 3a0a 2020 2020 2020 2020 2020 2020  UP:.            
-0000c6e0: 2020 2020 2320 6973 2069 7420 7261 6973      # is it rais
-0000c6f0: 6564 3f20 5920 444f 574e 0a20 2020 2020  ed? Y DOWN.     
-0000c700: 2020 2020 2020 2020 2020 2069 735f 7363             is_sc
-0000c710: 7269 7074 203d 2079 646f 776e 2061 6e64  ript = ydown and
-0000c720: 2028 6c61 7374 5f79 202d 2074 6869 735f   (last_y - this_
-0000c730: 7929 203e 2059 4641 4354 4f52 0a20 2020  y) > YFACTOR.   
-0000c740: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000c750: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000c760: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-0000c770: 2262 6164 2073 6372 6970 7420 7479 7065  "bad script type
-0000c780: 2022 2c20 7363 7269 7074 5f74 7970 6529   ", script_type)
-0000c790: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c7a0: 4661 6c73 653a 0a20 2020 2020 2020 2020  False:.         
-0000c7b0: 2020 2020 2020 2069 6620 6973 5f73 6372         if is_scr
-0000c7c0: 6970 7420 616e 6420 6c61 7374 5f78 2061  ipt and last_x a
-0000c7d0: 6e64 2074 6869 735f 783a 0a20 2020 2020  nd this_x:.     
-0000c7e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000c7f0: 735f 7363 7269 7074 203d 206c 6173 745f  s_script = last_
-0000c800: 7820 3c20 7468 6973 5f78 0a20 2020 2020  x < this_x.     
-0000c810: 2020 2072 6574 7572 6e20 6973 5f73 6372     return is_scr
-0000c820: 6970 740a 0a20 2020 2040 636c 6173 736d  ipt..    @classm
-0000c830: 6574 686f 640a 2020 2020 6465 6620 6578  ethod.    def ex
-0000c840: 7472 6163 745f 666f 6f74 6e6f 7465 7328  tract_footnotes(
-0000c850: 636c 732c 2068 746d 6c5f 656c 656d 2c20  cls, html_elem, 
-0000c860: 666f 6e74 5f73 697a 655f 636f 6e64 6974  font_size_condit
-0000c870: 696f 6e2c 2074 6974 6c65 3d22 466f 6f74  ion, title="Foot
-0000c880: 6e6f 7465 7322 293a 0a20 2020 2020 2020  notes"):.       
-0000c890: 2064 6976 7320 3d20 6874 6d6c 5f65 6c65   divs = html_ele
-0000c8a0: 6d2e 7870 6174 6828 6622 2f2f 6469 765b  m.xpath(f"//div[
-0000c8b0: 7370 616e 5b63 6f6e 7461 696e 7328 4073  span[contains(@s
-0000c8c0: 7479 6c65 2c20 277b 666f 6e74 5f73 697a  tyle, '{font_siz
-0000c8d0: 655f 636f 6e64 6974 696f 6e7d 2729 2061  e_condition}') a
-0000c8e0: 6e64 206e 756d 6265 7228 2e29 3d6e 756d  nd number(.)=num
-0000c8f0: 6265 7228 2e29 5d5d 2229 0a20 2020 2020  ber(.)]]").     
-0000c900: 2020 2066 6f6f 746e 6f74 655f 6469 7620     footnote_div 
-0000c910: 3d20 4874 6d6c 4772 6f75 702e 6765 745f  = HtmlGroup.get_
-0000c920: 6261 636b 5f64 6976 2868 746d 6c5f 656c  back_div(html_el
-0000c930: 656d 290a 2020 2020 2020 2020 666f 6f74  em).        foot
-0000c940: 6e6f 7465 5f74 6974 6c65 203d 2045 542e  note_title = ET.
-0000c950: 5375 6245 6c65 6d65 6e74 2866 6f6f 746e  SubElement(footn
-0000c960: 6f74 655f 6469 762c 2022 6469 7622 290a  ote_div, "div").
-0000c970: 2020 2020 2020 2020 666f 6f74 6e6f 7465          footnote
-0000c980: 5f74 6974 6c65 2e74 6578 7420 3d20 7469  _title.text = ti
-0000c990: 746c 650a 2020 2020 2020 2020 756c 203d  tle.        ul =
-0000c9a0: 2045 542e 5375 6245 6c65 6d65 6e74 2866   ET.SubElement(f
-0000c9b0: 6f6f 746e 6f74 655f 6469 762c 2022 756c  ootnote_div, "ul
-0000c9c0: 2229 0a20 2020 2020 2020 2063 7572 7265  ").        curre
-0000c9d0: 6e74 5f6c 6920 3d20 4e6f 6e65 0a20 2020  nt_li = None.   
-0000c9e0: 2020 2020 2066 6f72 2064 6976 2069 6e20       for div in 
-0000c9f0: 6469 7673 3a0a 2020 2020 2020 2020 2020  divs:.          
-0000ca00: 2020 7370 616e 7320 3d20 6469 762e 7870    spans = div.xp
-0000ca10: 6174 6828 222e 2f73 7061 6e22 290a 2020  ath("./span").  
-0000ca20: 2020 2020 2020 2020 2020 666f 7220 692c            for i,
-0000ca30: 2073 7061 6e20 696e 2065 6e75 6d65 7261   span in enumera
-0000ca40: 7465 2873 7061 6e73 293a 0a20 2020 2020  te(spans):.     
-0000ca50: 2020 2020 2020 2020 2020 2069 6620 586d             if Xm
-0000ca60: 6c4c 6962 2e69 735f 696e 7465 6765 7228  lLib.is_integer(
-0000ca70: 7370 616e 2920 616e 6420 2869 203d 3d20  span) and (i == 
-0000ca80: 3020 6f72 2048 746d 6c55 7469 6c2e 6973  0 or HtmlUtil.is
-0000ca90: 5f73 7570 6572 7363 7269 7074 2873 7061  _superscript(spa
-0000caa0: 6e73 5b69 202d 2031 5d2c 2073 7061 6e29  ns[i - 1], span)
-0000cab0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0000cac0: 2020 2020 2020 2063 7572 7265 6e74 5f6c         current_l
-0000cad0: 6920 3d20 4554 2e53 7562 456c 656d 656e  i = ET.SubElemen
-0000cae0: 7428 756c 2c20 226c 6922 290a 2020 2020  t(ul, "li").    
-0000caf0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-0000cb00: 7572 7265 6e74 5f6c 6920 6973 206e 6f74  urrent_li is not
-0000cb10: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000cb20: 2020 2020 2020 2020 2020 2063 7572 7265             curre
-0000cb30: 6e74 5f6c 692e 6170 7065 6e64 2873 7061  nt_li.append(spa
-0000cb40: 6e29 0a0a 0a20 2020 2040 636c 6173 736d  n)...    @classm
-0000cb50: 6574 686f 640a 2020 2020 6465 6620 616e  ethod.    def an
-0000cb60: 6e6f 7461 7465 5f73 6372 6970 745f 7479  notate_script_ty
-0000cb70: 7065 2863 6c73 2c20 7370 616e 2c20 7363  pe(cls, span, sc
-0000cb80: 7269 7074 5f74 7970 652c 2073 6372 6970  ript_type, scrip
-0000cb90: 745f 6661 6374 6f72 3d4e 6f6e 652c 206c  t_factor=None, l
-0000cba0: 6173 745f 7370 616e 3d4e 6f6e 652c 2079  ast_span=None, y
-0000cbb0: 646f 776e 3d54 7275 6529 3a0a 2020 2020  down=True):.    
-0000cbc0: 2020 2020 2222 2269 7320 6120 7370 616e      """is a span
-0000cbd0: 2061 2073 7562 206f 7220 7375 7065 7273   a sub or supers
-0000cbe0: 6372 6970 743f 0a20 2020 2020 2020 203a  cript?.        :
-0000cbf0: 7061 7261 6d20 7370 616e 3a20 746f 2074  param span: to t
-0000cc00: 6573 740a 2020 2020 2020 2020 3a70 6172  est.        :par
-0000cc10: 616d 2073 6372 6970 745f 7479 7065 3a20  am script_type: 
-0000cc20: 5353 6372 6970 742e 5355 4220 6f72 2053  SScript.SUB or S
-0000cc30: 5363 7269 7074 2e53 5550 4552 0a20 2020  Script.SUPER.   
-0000cc40: 2020 2020 203a 7061 7261 6d20 7363 7269       :param scri
-0000cc50: 7074 5f66 6163 746f 723a 2069 6620 4e6f  pt_factor: if No
-0000cc60: 6e65 2c20 6465 6661 756c 7473 2074 6f20  ne, defaults to 
-0000cc70: 4874 6d6c 5574 696c 2e53 4352 4950 545f  HtmlUtil.SCRIPT_
-0000cc80: 4641 4354 0a20 2020 2020 2020 203a 7061  FACT.        :pa
-0000cc90: 7261 6d20 6c61 7374 5f73 7061 6e3a 2070  ram last_span: p
-0000cca0: 7265 6365 6469 6e67 2073 7061 6e3b 2069  receding span; i
-0000ccb0: 6620 4e6f 6e65 2074 7269 6573 2078 7061  f None tries xpa
-0000ccc0: 7468 2822 7072 6563 6564 696e 673a 3a73  th("preceding::s
-0000ccd0: 7061 6e22 290a 2020 2020 2020 2020 3a70  pan").        :p
-0000cce0: 6172 616d 2079 646f 776e 3a20 6973 2079  aram ydown: is y
-0000ccf0: 2072 756e 6e69 6e67 2064 6f6e 7720 7468   running donw th
-0000cd00: 6520 7061 6765 3f0a 2020 2020 2020 2020  e page?.        
-0000cd10: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
-0000cd20: 7061 6e20 6973 204e 6f6e 6520 6f72 206e  pan is None or n
-0000cd30: 6f74 2073 6372 6970 745f 7479 7065 3a0a  ot script_type:.
-0000cd40: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000cd50: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-0000cd60: 6966 206e 6f74 2073 6372 6970 745f 6661  if not script_fa
-0000cd70: 6374 6f72 3a0a 2020 2020 2020 2020 2020  ctor:.          
-0000cd80: 2020 7363 7269 7074 5f66 6163 746f 7220    script_factor 
-0000cd90: 3d20 4874 6d6c 5574 696c 2e53 4352 4950  = HtmlUtil.SCRIP
-0000cda0: 545f 4641 4354 0a20 2020 2020 2020 2069  T_FACT.        i
-0000cdb0: 6620 6e6f 7420 6c61 7374 5f73 7061 6e3a  f not last_span:
-0000cdc0: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
-0000cdd0: 745f 7370 616e 203d 2073 7061 6e2e 7870  t_span = span.xp
-0000cde0: 6174 6828 2270 7265 6365 6469 6e67 3a3a  ath("preceding::
-0000cdf0: 7370 616e 2229 0a20 2020 2020 2020 2020  span").         
-0000ce00: 2020 2069 6620 6c65 6e28 6c61 7374 5f73     if len(last_s
-0000ce10: 7061 6e29 203d 3d20 303a 0a20 2020 2020  pan) == 0:.     
-0000ce20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000ce30: 6e20 4e6f 6e65 0a20 2020 2020 2020 2020  n None.         
-0000ce40: 2020 206c 6173 745f 7370 616e 203d 206c     last_span = l
-0000ce50: 6173 745f 7370 616e 5b2d 315d 0a20 2020  ast_span[-1].   
-0000ce60: 2020 2020 2063 7373 7320 3d20 4353 5353       csss = CSSS
-0000ce70: 7479 6c65 2e63 7265 6174 655f 6373 735f  tyle.create_css_
-0000ce80: 7374 796c 655f 6672 6f6d 5f61 7474 7269  style_from_attri
-0000ce90: 6275 7465 5f6f 665f 626f 6479 5f65 6c65  bute_of_body_ele
-0000cea0: 6d65 6e74 2873 7061 6e29 0a20 2020 2020  ment(span).     
-0000ceb0: 2020 206c 6173 745f 6373 7373 203d 2043     last_csss = C
-0000cec0: 5353 5374 796c 652e 6372 6561 7465 5f63  SSStyle.create_c
-0000ced0: 7373 5f73 7479 6c65 5f66 726f 6d5f 6174  ss_style_from_at
-0000cee0: 7472 6962 7574 655f 6f66 5f62 6f64 795f  tribute_of_body_
-0000cef0: 656c 656d 656e 7428 6c61 7374 5f73 7061  element(last_spa
-0000cf00: 6e29 0a20 2020 2020 2020 2066 6f6e 745f  n).        font_
-0000cf10: 7369 7a65 203d 2063 7373 732e 666f 6e74  size = csss.font
-0000cf20: 5f73 697a 650a 2020 2020 2020 2020 6c61  _size.        la
-0000cf30: 7374 5f66 6f6e 745f 7369 7a65 203d 206c  st_font_size = l
-0000cf40: 6173 745f 6373 7373 2e66 6f6e 745f 7369  ast_csss.font_si
-0000cf50: 7a65 0a20 2020 2020 2020 2069 735f 7363  ze.        is_sc
-0000cf60: 7269 7074 203d 204e 6f6e 650a 2020 2020  ript = None.    
-0000cf70: 2020 2020 6966 2066 6f6e 745f 7369 7a65      if font_size
-0000cf80: 2061 6e64 2066 6f6e 745f 7369 7a65 203c   and font_size <
-0000cf90: 2073 6372 6970 745f 6661 6374 6f72 202a   script_factor *
-0000cfa0: 206c 6173 745f 666f 6e74 5f73 697a 653a   last_font_size:
-0000cfb0: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
-0000cfc0: 745f 7920 3d20 4353 5353 7479 6c65 2e67  t_y = CSSStyle.g
-0000cfd0: 6574 5f79 3028 6c61 7374 5f73 7061 6e29  et_y0(last_span)
-0000cfe0: 0a20 2020 2020 2020 2020 2020 2074 6869  .            thi
-0000cff0: 735f 7920 3d20 4353 5353 7479 6c65 2e67  s_y = CSSStyle.g
-0000d000: 6574 5f79 3028 7370 616e 290a 2020 2020  et_y0(span).    
-0000d010: 2020 2020 2020 2020 6966 2073 6372 6970          if scrip
-0000d020: 745f 7479 7065 203d 3d20 5353 6372 6970  t_type == SScrip
-0000d030: 742e 5355 423a 0a20 2020 2020 2020 2020  t.SUB:.         
-0000d040: 2020 2020 2020 2023 2069 7320 6974 206c         # is it l
-0000d050: 6f77 6572 6564 3f20 5920 444f 574e 0a20  owered? Y DOWN. 
-0000d060: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000d070: 735f 7363 7269 7074 203d 2079 646f 776e  s_script = ydown
-0000d080: 203d 3d20 286c 6173 745f 7920 3c20 7468   == (last_y < th
-0000d090: 6973 5f79 290a 2020 2020 2020 2020 2020  is_y).          
-0000d0a0: 2020 656c 6966 2073 6372 6970 745f 7479    elif script_ty
-0000d0b0: 7065 203d 3d20 5353 6372 6970 742e 5355  pe == SScript.SU
-0000d0c0: 503a 0a20 2020 2020 2020 2020 2020 2020  P:.             
-0000d0d0: 2020 2023 2069 7320 6974 2072 6169 7365     # is it raise
-0000d0e0: 643f 2059 2044 4f57 4e0a 2020 2020 2020  d? Y DOWN.      
-0000d0f0: 2020 2020 2020 2020 2020 6973 5f73 6372            is_scr
-0000d100: 6970 7420 3d20 7964 6f77 6e20 3d3d 2028  ipt = ydown == (
-0000d110: 6c61 7374 5f79 203e 2074 6869 735f 7929  last_y > this_y)
-0000d120: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d130: 6973 5f73 6372 6970 743a 0a20 2020 2020  is_script:.     
-0000d140: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-0000d150: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-0000d160: 735f 7363 7269 7074 0a0a 0a20 2020 2040  s_script...    @
-0000d170: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-0000d180: 6465 6620 7365 745f 6174 7472 6962 2863  def set_attrib(c
-0000d190: 6c73 2c20 656c 656d 656e 742c 2061 7474  ls, element, att
-0000d1a0: 6e61 6d65 2c20 6174 7476 616c 7565 293a  name, attvalue):
-0000d1b0: 0a20 2020 2020 2020 2022 2222 636f 6e76  .        """conv
-0000d1c0: 656e 6965 6e63 6520 6d65 7468 6f64 2074  enience method t
-0000d1d0: 6f20 7365 7420 6174 7472 6962 7574 6520  o set attribute 
-0000d1e0: 7661 6c75 650a 2020 2020 2020 2020 2222  value.        ""
-0000d1f0: 220a 2020 2020 2020 2020 6966 2065 6c65  ".        if ele
-0000d200: 6d65 6e74 2069 7320 4e6f 6e65 3a0a 2020  ment is None:.  
-0000d210: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000d220: 5661 6c75 6545 7272 6f72 2822 656c 656d  ValueError("elem
-0000d230: 656e 7420 6973 204e 6f6e 6522 290a 2020  ent is None").  
-0000d240: 2020 2020 2020 6966 2061 7474 6e61 6d65        if attname
-0000d250: 2061 6e64 2061 7474 7661 6c75 653a 0a20   and attvalue:. 
-0000d260: 2020 2020 2020 2020 2020 2065 6c65 6d65             eleme
-0000d270: 6e74 2e73 6574 2861 7474 6e61 6d65 2c20  nt.set(attname, 
-0000d280: 7374 7228 6174 7476 616c 7565 2929 0a0a  str(attvalue))..
-0000d290: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-0000d2a0: 0a20 2020 2064 6566 2067 6574 5f74 6578  .    def get_tex
-0000d2b0: 745f 636f 6e74 656e 7428 636c 732c 2065  t_content(cls, e
-0000d2c0: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
-0000d2d0: 220a 2020 2020 2020 2020 636f 6e76 656e  ".        conven
-0000d2e0: 6965 6e63 6520 6d65 7468 6f64 3b20 6176  ience method; av
-0000d2f0: 6f69 6473 2068 6176 696e 6720 746f 2072  oids having to r
-0000d300: 656d 656d 6265 7220 6a6f 696e 2f69 7465  emember join/ite
-0000d310: 7274 6578 740a 2020 2020 2020 2020 2222  rtext.        ""
-0000d320: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-0000d330: 2027 272e 6a6f 696e 2865 6c65 6d2e 6974   ''.join(elem.it
-0000d340: 6572 7465 7874 2829 290a 0a20 2020 2040  ertext())..    @
-0000d350: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-0000d360: 6465 6620 6164 645f 6765 6e65 7261 7465  def add_generate
-0000d370: 645f 6964 7328 636c 732c 2072 6f6f 745f  d_ids(cls, root_
-0000d380: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
-0000d390: 2222 6164 6473 2049 4473 2074 6f20 616c  ""adds IDs to al
-0000d3a0: 6c20 656c 656d 656e 7473 2069 6e20 646f  l elements in do
-0000d3b0: 6375 6d65 6e74 206f 7264 6572 0a20 2020  cument order.   
-0000d3c0: 2020 2020 203a 7061 7261 6d20 726f 6f74       :param root
-0000d3d0: 5f65 6c65 6d3a 2065 6c65 6d65 6e74 2064  _elem: element d
-0000d3e0: 6566 696e 696e 6720 7472 6565 206f 6620  efining tree of 
-0000d3f0: 7375 6265 6c65 6d65 6e74 7322 2222 0a20  subelements""". 
-0000d400: 2020 2020 2020 2078 7061 7468 203d 2022         xpath = "
-0000d410: 2f2f 2a22 0a20 2020 2020 2020 2065 6c65  //*".        ele
-0000d420: 6d73 203d 2072 6f6f 745f 656c 656d 2e78  ms = root_elem.x
-0000d430: 7061 7468 2878 7061 7468 290a 2020 2020  path(xpath).    
-0000d440: 2020 2020 666f 7220 692c 2065 6c20 696e      for i, el in
-0000d450: 2065 6e75 6d65 7261 7465 2865 6c65 6d73   enumerate(elems
-0000d460: 293a 0a20 2020 2020 2020 2020 2020 2065  ):.            e
-0000d470: 6c2e 6174 7472 6962 5b41 5f49 445d 203d  l.attrib[A_ID] =
-0000d480: 2041 5f49 4420 2b20 7374 7228 6929 0a20   A_ID + str(i). 
-0000d490: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-0000d4a0: 2020 2020 6465 6620 6a6f 696e 5f73 7061      def join_spa
-0000d4b0: 6e73 5f69 6e5f 7361 6d65 5f64 6976 2863  ns_in_same_div(c
-0000d4c0: 6c73 2c20 7370 616e 302c 2073 7061 6e31  ls, span0, span1
-0000d4d0: 2c20 6164 6473 7061 6365 3d54 7275 652c  , addspace=True,
-0000d4e0: 2072 656d 6f76 653d 5472 7565 293a 0a20   remove=True):. 
-0000d4f0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000d500: 2020 206a 6f69 6e74 203c 7370 616e 3e2e     joint <span>.
-0000d510: 2e2e 3c2f 7370 616e 3e3c 7370 616e 3e2e  ..</span><span>.
-0000d520: 2e2e 3c2f 7370 616e 3e20 696e 746f 203c  ..</span> into <
-0000d530: 7370 616e 3e2e 2e2e 3c2f 7370 616e 3e0a  span>...</span>.
-0000d540: 2020 2020 2020 2020 7468 6973 2073 7472          this str
-0000d550: 7563 7475 7265 2061 7269 7365 7320 7768  ucture arises wh
-0000d560: 656e 2050 4446 206f 7220 696d 6167 6573  en PDF or images
-0000d570: 2069 7320 7061 7273 6564 2061 6e64 2073   is parsed and s
-0000d580: 7061 6e73 2068 6176 6520 7468 6520 7361  pans have the sa
-0000d590: 6d65 2073 7479 6c65 7320 2873 697a 652f  me styles (size/
-0000d5a0: 7374 796c 652f 7765 6967 6874 2920 616e  style/weight) an
-0000d5b0: 6420 6361 6e20 6265 206d 6572 6765 640a  d can be merged.
-0000d5c0: 2020 2020 2020 2020 7765 2061 7373 756d          we assum
-0000d5d0: 6520 7468 6174 2073 7479 6c65 2061 6e64  e that style and
-0000d5e0: 2067 656f 6d65 7472 7920 6368 656b 696e   geometry chekin
-0000d5f0: 6720 6861 7320 6265 656e 2064 6f6e 650a  g has been done.
-0000d600: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-0000d610: 7061 6e30 3a20 6669 7273 7420 3c73 7061  pan0: first <spa
-0000d620: 6e3e 2c20 7465 7874 2077 696c 6c20 6265  n>, text will be
-0000d630: 2069 6e63 7265 6173 6564 2066 726f 6d20   increased from 
-0000d640: 7370 616e 310a 2020 2020 2020 2020 3a70  span1.        :p
-0000d650: 6172 616d 2073 7061 6e31 3a20 7465 7874  aram span1: text
-0000d660: 2077 696c 6c20 6265 2061 7070 656e 6465   will be appende
-0000d670: 6420 746f 2073 7061 6e30 2074 6578 740a  d to span0 text.
-0000d680: 2020 2020 2020 2020 3a70 6172 616d 2072          :param r
-0000d690: 656d 6f76 653a 2072 656d 6f76 6520 7370  emove: remove sp
-0000d6a0: 616e 3120 2864 6566 6175 6c74 290a 2020  an1 (default).  
-0000d6b0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000d6c0: 2020 6966 2048 746d 6c55 7469 6c2e 6368    if HtmlUtil.ch
-0000d6d0: 6563 6b5f 7461 6728 7370 616e 302c 2022  eck_tag(span0, "
-0000d6e0: 7370 616e 2229 2061 6e64 2048 746d 6c55  span") and HtmlU
-0000d6f0: 7469 6c2e 6368 6563 6b5f 7461 6728 7370  til.check_tag(sp
-0000d700: 616e 312c 2022 7370 616e 2229 3a0a 2020  an1, "span"):.  
-0000d710: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
-0000d720: 3120 3d20 7370 616e 312e 6765 7470 6172  1 = span1.getpar
-0000d730: 656e 7428 290a 2020 2020 2020 2020 2020  ent().          
-0000d740: 2020 6966 2061 6464 7370 6163 653a 0a20    if addspace:. 
-0000d750: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d760: 7061 6e30 5f6e 6f74 5f65 6e64 5f73 7061  pan0_not_end_spa
-0000d770: 6365 203d 206c 656e 2873 7061 6e30 2920  ce = len(span0) 
-0000d780: 3e20 3020 616e 6420 7370 616e 305b 2d31  > 0 and span0[-1
-0000d790: 5d20 213d 2022 2022 0a20 2020 2020 2020  ] != " ".       
-0000d7a0: 2020 2020 2020 2020 2073 7061 6e31 5f6e           span1_n
-0000d7b0: 6f74 5f73 7461 7274 5f73 7061 6365 203d  ot_start_space =
-0000d7c0: 206c 656e 2873 7061 6e31 2920 3e20 3020   len(span1) > 0 
-0000d7d0: 616e 6420 7370 616e 315b 2d31 5d20 213d  and span1[-1] !=
-0000d7e0: 2022 2022 0a20 2020 2020 2020 2020 2020   " ".           
-0000d7f0: 2020 2020 2069 6620 7370 616e 305f 6e6f       if span0_no
-0000d800: 745f 656e 645f 7370 6163 6520 616e 6420  t_end_space and 
-0000d810: 7370 616e 315f 6e6f 745f 7374 6172 745f  span1_not_start_
-0000d820: 7370 6163 653a 0a20 2020 2020 2020 2020  space:.         
-0000d830: 2020 2020 2020 2020 2020 2073 7061 6e30             span0
-0000d840: 2e74 6578 7420 2b3d 2022 2022 0a20 2020  .text += " ".   
-0000d850: 2020 2020 2020 2020 2073 7061 6e30 2e74           span0.t
-0000d860: 6578 7420 2b3d 2073 7061 6e31 2e74 6578  ext += span1.tex
-0000d870: 740a 2020 2020 2020 2020 2020 2020 6966  t.            if
-0000d880: 2072 656d 6f76 653a 0a20 2020 2020 2020   remove:.       
-0000d890: 2020 2020 2020 2020 2070 6172 656e 7431           parent1
-0000d8a0: 2e72 656d 6f76 6528 7370 616e 3129 0a0a  .remove(span1)..
-0000d8b0: 0a0a 0a20 2020 2040 636c 6173 736d 6574  ...    @classmet
-0000d8c0: 686f 640a 2020 2020 6465 6620 6372 6561  hod.    def crea
-0000d8d0: 7465 5f73 6b65 6c65 746f 6e5f 6874 6d6c  te_skeleton_html
-0000d8e0: 2863 6c73 293a 0a20 2020 2020 2020 2022  (cls):.        "
-0000d8f0: 2222 6372 6561 7465 2065 6d70 7479 2068  ""create empty h
-0000d900: 746d 6c20 7472 6565 0a20 2020 2020 2020  tml tree.       
-0000d910: 2068 746d 6c0a 2020 2020 2020 2020 2020   html.          
-0000d920: 2020 6865 6164 0a20 2020 2020 2020 2020    head.         
-0000d930: 2020 2020 2020 206d 6574 610a 2020 2020         meta.    
-0000d940: 2020 2020 2020 2020 2020 2020 2320 7374              # st
-0000d950: 796c 650a 2020 2020 2020 2020 2020 2020  yle.            
-0000d960: 626f 6479 0a0a 2020 2020 2020 2020 3a72  body..        :r
-0000d970: 6574 7572 6e3a 2074 6869 7320 6874 6d6c  eturn: this html
-0000d980: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0000d990: 2020 2020 2020 6874 6d6c 203d 2045 542e        html = ET.
-0000d9a0: 456c 656d 656e 7428 485f 4854 4d4c 290a  Element(H_HTML).
-0000d9b0: 2020 2020 2020 2020 6865 6164 203d 2045          head = E
-0000d9c0: 542e 456c 656d 656e 7428 485f 4845 4144  T.Element(H_HEAD
-0000d9d0: 290a 2020 2020 2020 2020 6874 6d6c 2e61  ).        html.a
-0000d9e0: 7070 656e 6428 6865 6164 290a 2020 2020  ppend(head).    
-0000d9f0: 2020 2020 6d65 7461 203d 2045 542e 456c      meta = ET.El
-0000da00: 656d 656e 7428 485f 4d45 5441 290a 2020  ement(H_META).  
-0000da10: 2020 2020 2020 6865 6164 2e61 7070 656e        head.appen
-0000da20: 6428 6d65 7461 290a 2020 2020 2020 2020  d(meta).        
-0000da30: 7374 796c 6520 3d20 4554 2e45 6c65 6d65  style = ET.Eleme
-0000da40: 6e74 2848 5f53 5459 4c45 2920 2023 2065  nt(H_STYLE)  # e
-0000da50: 6d70 7479 203c 7374 796c 653e 206d 6561  mpty <style> mea
-0000da60: 6e73 206e 6f20 6469 7370 6c61 790a 2020  ns no display.  
-0000da70: 2020 2020 2020 2320 6865 6164 2e61 7070        # head.app
-0000da80: 656e 6428 7374 796c 6529 0a20 2020 2020  end(style).     
-0000da90: 2020 2062 6f64 7920 3d20 4554 2e45 6c65     body = ET.Ele
-0000daa0: 6d65 6e74 2848 5f42 4f44 5929 0a20 2020  ment(H_BODY).   
-0000dab0: 2020 2020 2068 746d 6c2e 6170 7065 6e64       html.append
-0000dac0: 2862 6f64 7929 0a20 2020 2020 2020 2072  (body).        r
-0000dad0: 6574 7572 6e20 6874 6d6c 0a0a 2020 2020  eturn html..    
-0000dae0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-0000daf0: 2064 6566 2066 696e 645f 656c 656d 656e   def find_elemen
-0000db00: 7473 5f77 6974 685f 7374 796c 6528 636c  ts_with_style(cl
-0000db10: 732c 2065 6c65 6d2c 2078 7061 7468 2c20  s, elem, xpath, 
-0000db20: 636f 6e64 6974 696f 6e3d 4e6f 6e65 2c20  condition=None, 
-0000db30: 7265 6d6f 7665 3d46 616c 7365 293a 0a20  remove=False):. 
-0000db40: 2020 2020 2020 2022 2222 7265 6d6f 7665         """remove
-0000db50: 2061 6c6c 2065 6c65 6d65 6e74 7320 7769   all elements wi
-0000db60: 7468 2073 7479 6c65 2066 756c 6669 6c6c  th style fulfill
-0000db70: 696e 6720 636f 6e64 6974 696f 6e0a 2020  ing condition.  
-0000db80: 2020 2020 2020 3a70 6172 616d 2065 6c65        :param ele
-0000db90: 6d3a 2072 6f6f 7420 656c 656d 656e 7420  m: root element 
-0000dba0: 666f 7220 7870 6174 680a 2020 2020 2020  for xpath.      
-0000dbb0: 2020 3a70 6172 616d 2078 7061 7468 3a20    :param xpath: 
-0000dbc0: 656c 656d 656e 7473 2074 6f20 7363 616e  elements to scan
-0000dbd0: 202c 2073 686f 756c 6420 6e6f 726d 616c   , should normal
-0000dbe0: 6c79 2063 6f6e 7461 696e 2074 6865 2040  ly contain the @
-0000dbf0: 7374 796c 6520 636f 6e64 6974 696f 6e0a  style condition.
-0000dc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc10: 2020 2020 2020 2020 2020 6966 204e 6f6e            if Non
-0000dc20: 6520 7573 6573 0a20 2020 2020 2020 203a  e uses.        :
-0000dc30: 7061 7261 6d20 636f 6e64 6974 696f 6e3a  param condition:
-0000dc40: 2073 7479 6c65 2063 6f6e 6469 7469 6f6e   style condition
-0000dc50: 2070 7269 6d69 7469 7665 2061 7420 7072   primitive at pr
-0000dc60: 6573 656e 740a 2020 2020 2020 2020 2020  esent.          
-0000dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dc80: 2876 6172 6961 626c 652c 206f 7220 7661  (variable, or va
-0000dc90: 7269 6162 6c65 2020 6f70 6572 6174 6f72  riable  operator
-0000dca0: 2076 616c 7565 2028 6576 616c 2069 7320   value (eval is 
-0000dcb0: 6576 696c 290a 2020 2020 2020 2020 2020  evil).          
-0000dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dcd0: 6578 616d 706c 6520 225f 666f 6e74 2d73  example "_font-s
-0000dce0: 697a 6520 3e20 3330 2220 6f72 2022 5f70  ize > 30" or "_p
-0000dcf0: 6f73 6974 696f 6e22 2028 6d65 616e 7320  osition" (means 
-0000dd00: 6861 7320 706f 7369 7469 6f6e 290a 2020  has position).  
-0000dd10: 2020 2020 2020 3a70 6172 616d 2072 656d        :param rem
-0000dd20: 6f76 653a 2072 656d 6f76 6520 7468 6573  ove: remove thes
-0000dd30: 6520 656c 656d 656e 7473 2028 6e6f 7420  e elements (not 
-0000dd40: 7468 6569 7220 7461 696c 290a 2020 2020  their tail).    
-0000dd50: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000dd60: 2222 220a 2020 2020 2020 2020 4d61 7962  """.        Mayb
-0000dd70: 6520 6d6f 7665 2074 6f20 4854 4d4c 5469  e move to HTMLTi
-0000dd80: 6479 0a20 2020 2020 2020 2022 2222 0a20  dy.        """. 
-0000dd90: 2020 2020 2020 2061 7373 6572 7420 656c         assert el
-0000dda0: 656d 2069 7320 6e6f 7420 4e6f 6e65 2c20  em is not None, 
-0000ddb0: 6622 6d75 7374 2068 6176 6520 656c 656d  f"must have elem
-0000ddc0: 220a 2020 2020 2020 2020 6966 2078 7061  ".        if xpa
-0000ddd0: 7468 3a0a 2020 2020 2020 2020 2020 2020  th:.            
-0000dde0: 656c 7320 3d20 656c 656d 2e78 7061 7468  els = elem.xpath
-0000ddf0: 2878 7061 7468 290a 2020 2020 2020 2020  (xpath).        
-0000de00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000de10: 2020 656c 7320 3d20 5b65 6c65 6d5d 0a20    els = [elem]. 
-0000de20: 2020 2020 2020 2065 6c65 6d73 203d 205b         elems = [
-0000de30: 5d0a 2020 2020 2020 2020 666f 7220 656c  ].        for el
-0000de40: 2069 6e20 656c 733a 0a20 2020 2020 2020   in els:.       
-0000de50: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
-0000de60: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
-0000de70: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
-0000de80: 6174 7472 6962 7574 655f 6f66 5f62 6f64  attribute_of_bod
-0000de90: 795f 656c 656d 656e 7428 656c 290a 2020  y_element(el).  
-0000dea0: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
-0000deb0: 6469 7469 6f6e 3a0a 2020 2020 2020 2020  dition:.        
-0000dec0: 2020 2020 2020 2020 6966 2063 7373 5f73          if css_s
-0000ded0: 7479 6c65 2e6f 6265 7973 2863 6f6e 6469  tyle.obeys(condi
-0000dee0: 7469 6f6e 293a 0a20 2020 2020 2020 2020  tion):.         
-0000def0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
-0000df00: 6d6f 7665 3a0a 2020 2020 2020 2020 2020  move:.          
-0000df10: 2020 2020 2020 2020 2020 2020 2020 636c                cl
-0000df20: 732e 7265 6d6f 7665 5f65 6c65 6d5f 6b65  s.remove_elem_ke
-0000df30: 6570 5f74 6169 6c28 656c 290a 0a20 2020  ep_tail(el)..   
-0000df40: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-0000df50: 2020 6465 6620 7265 6d6f 7665 5f68 6561    def remove_hea
-0000df60: 6465 7273 5f61 6e64 5f66 6f6f 7465 7273  ders_and_footers
-0000df70: 5f75 7369 6e67 5f70 6466 6d69 6e65 725f  _using_pdfminer_
-0000df80: 636f 6f72 6473 2863 6c73 2c20 7265 665f  coords(cls, ref_
-0000df90: 656c 656d 2c20 7061 6765 7369 7a65 2c20  elem, pagesize, 
-0000dfa0: 6865 6164 6572 5f68 6569 6768 742c 2066  header_height, f
-0000dfb0: 6f6f 7465 725f 6865 6967 6874 2c0a 2020  ooter_height,.  
-0000dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c1b0: 2020 2020 2079 646f 776e 290a 2020 2020       ydown).    
+0000c1c0: 2020 2020 7265 7475 726e 2069 735f 7363      return is_sc
+0000c1d0: 7269 7074 0a0a 2020 2020 4063 6c61 7373  ript..    @class
+0000c1e0: 6d65 7468 6f64 0a20 2020 2064 6566 2069  method.    def i
+0000c1f0: 735f 7265 7175 6972 6564 5f73 6372 6970  s_required_scrip
+0000c200: 745f 7479 7065 2863 6c73 2c20 7363 7269  t_type(cls, scri
+0000c210: 7074 5f74 7970 652c 206c 6173 745f 666f  pt_type, last_fo
+0000c220: 6e74 5f73 697a 652c 206c 6173 745f 7370  nt_size, last_sp
+0000c230: 616e 2c20 7468 6973 5f66 6f6e 745f 7369  an, this_font_si
+0000c240: 7a65 2c20 7468 6973 5f73 7061 6e2c 2079  ze, this_span, y
+0000c250: 646f 776e 3d54 7275 652c 2029 3a0a 2020  down=True, ):.  
+0000c260: 2020 2020 2020 2222 226f 6c64 2061 7070        """old app
+0000c270: 726f 6163 6820 7769 7468 2041 6d69 5370  roach with AmiSp
+0000c280: 616e 0a20 2020 2020 2020 2054 6869 7320  an.        This 
+0000c290: 6973 206e 6f74 2072 6967 6874 2122 2222  is not right!"""
+0000c2a0: 0a20 2020 2020 2020 2059 4641 4354 4f52  .        YFACTOR
+0000c2b0: 203d 2033 2023 2070 6978 656c 730a 2020   = 3 # pixels.  
+0000c2c0: 2020 2020 2020 6973 5f73 6372 6970 7420        is_script 
+0000c2d0: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
+0000c2e0: 7363 7269 7074 5f66 6163 746f 7220 3d20  script_factor = 
+0000c2f0: 4874 6d6c 5574 696c 2e53 4352 4950 545f  HtmlUtil.SCRIPT_
+0000c300: 4641 4354 0a20 2020 2020 2020 2023 2069  FACT.        # i
+0000c310: 6620 666f 6e74 2073 697a 6573 206e 6f74  f font sizes not
+0000c320: 2067 6976 656e 2061 7373 756d 6520 7468   given assume th
+0000c330: 6579 2064 6f6e 2774 206d 6174 7465 720a  ey don't matter.
+0000c340: 2020 2020 2020 2020 6966 206c 6173 745f          if last_
+0000c350: 666f 6e74 5f73 697a 6520 616e 6420 7468  font_size and th
+0000c360: 6973 5f66 6f6e 745f 7369 7a65 3a0a 2020  is_font_size:.  
+0000c370: 2020 2020 2020 2020 2020 7061 7373 6564            passed
+0000c380: 5f66 6f6e 745f 7369 7a65 5f63 6861 6e67  _font_size_chang
+0000c390: 6520 3d20 7468 6973 5f66 6f6e 745f 7369  e = this_font_si
+0000c3a0: 7a65 203c 2073 6372 6970 745f 6661 6374  ze < script_fact
+0000c3b0: 6f72 202a 206c 6173 745f 666f 6e74 5f73  or * last_font_s
+0000c3c0: 697a 650a 2020 2020 2020 2020 656c 7365  ize.        else
+0000c3d0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+0000c3e0: 7373 6564 5f66 6f6e 745f 7369 7a65 5f63  ssed_font_size_c
+0000c3f0: 6861 6e67 6520 3d20 5472 7565 0a20 2020  hange = True.   
+0000c400: 2020 2020 2023 2075 7365 2079 2063 6f6f       # use y coo
+0000c410: 7264 730a 2020 2020 2020 2020 6966 2070  rds.        if p
+0000c420: 6173 7365 645f 666f 6e74 5f73 697a 655f  assed_font_size_
+0000c430: 6368 616e 6765 3a0a 2020 2020 2020 2020  change:.        
+0000c440: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000c450: 2020 2020 2020 2020 206c 6173 745f 7920           last_y 
+0000c460: 3d20 6c61 7374 5f73 7061 6e2e 790a 2020  = last_span.y.  
+0000c470: 2020 2020 2020 2020 2020 2020 2020 7468                th
+0000c480: 6973 5f79 203d 2074 6869 735f 7370 616e  is_y = this_span
+0000c490: 2e79 0a20 2020 2020 2020 2020 2020 2065  .y.            e
+0000c4a0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
+0000c4b0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0000c4c0: 2020 2020 2020 6c61 7374 5f79 203d 2048        last_y = H
+0000c4d0: 746d 6c55 7469 6c2e 6765 745f 666c 6f61  tmlUtil.get_floa
+0000c4e0: 7428 6c61 7374 5f73 7061 6e2c 2022 7930  t(last_span, "y0
+0000c4f0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0000c500: 2020 2074 6869 735f 7920 3d20 4874 6d6c     this_y = Html
+0000c510: 5574 696c 2e67 6574 5f66 6c6f 6174 2874  Util.get_float(t
+0000c520: 6869 735f 7370 616e 2c20 2279 3022 290a  his_span, "y0").
+0000c530: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0000c540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c550: 206c 6173 745f 7820 3d20 6c61 7374 5f73   last_x = last_s
+0000c560: 7061 6e2e 780a 2020 2020 2020 2020 2020  pan.x.          
+0000c570: 2020 2020 2020 7468 6973 5f78 203d 2074        this_x = t
+0000c580: 6869 735f 7370 616e 2e78 0a20 2020 2020  his_span.x.     
+0000c590: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
+0000c5a0: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
+0000c5b0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+0000c5c0: 7374 5f78 203d 2048 746d 6c55 7469 6c2e  st_x = HtmlUtil.
+0000c5d0: 6765 745f 666c 6f61 7428 6c61 7374 5f73  get_float(last_s
+0000c5e0: 7061 6e2c 2022 7830 2229 0a20 2020 2020  pan, "x0").     
+0000c5f0: 2020 2020 2020 2020 2020 2074 6869 735f             this_
+0000c600: 7820 3d20 4874 6d6c 5574 696c 2e67 6574  x = HtmlUtil.get
+0000c610: 5f66 6c6f 6174 2874 6869 735f 7370 616e  _float(this_span
+0000c620: 2c20 2278 3022 290a 2020 2020 2020 2020  , "x0").        
+0000c630: 2020 2020 6966 2073 6372 6970 745f 7479      if script_ty
+0000c640: 7065 203d 3d20 5353 6372 6970 742e 5355  pe == SScript.SU
+0000c650: 423a 0a20 2020 2020 2020 2020 2020 2020  B:.             
+0000c660: 2020 2023 2069 7320 6974 206c 6f77 6572     # is it lower
+0000c670: 6564 3f20 5920 444f 574e 0a20 2020 2020  ed? Y DOWN.     
+0000c680: 2020 2020 2020 2020 2020 2069 735f 7363             is_sc
+0000c690: 7269 7074 203d 2079 646f 776e 2061 6e64  ript = ydown and
+0000c6a0: 2028 6c61 7374 5f79 203c 2074 6869 735f   (last_y < this_
+0000c6b0: 7929 0a20 2020 2020 2020 2020 2020 2065  y).            e
+0000c6c0: 6c69 6620 7363 7269 7074 5f74 7970 6520  lif script_type 
+0000c6d0: 3d3d 2053 5363 7269 7074 2e53 5550 3a0a  == SScript.SUP:.
+0000c6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c6f0: 2320 6973 2069 7420 7261 6973 6564 3f20  # is it raised? 
+0000c700: 5920 444f 574e 0a20 2020 2020 2020 2020  Y DOWN.         
+0000c710: 2020 2020 2020 2069 735f 7363 7269 7074         is_script
+0000c720: 203d 2079 646f 776e 2061 6e64 2028 6c61   = ydown and (la
+0000c730: 7374 5f79 202d 2074 6869 735f 7929 203e  st_y - this_y) >
+0000c740: 2059 4641 4354 4f52 0a20 2020 2020 2020   YFACTOR.       
+0000c750: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000c760: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000c770: 2056 616c 7565 4572 726f 7228 2262 6164   ValueError("bad
+0000c780: 2073 6372 6970 7420 7479 7065 2022 2c20   script type ", 
+0000c790: 7363 7269 7074 5f74 7970 6529 0a20 2020  script_type).   
+0000c7a0: 2020 2020 2020 2020 2069 6620 4661 6c73           if Fals
+0000c7b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000c7c0: 2020 2069 6620 6973 5f73 6372 6970 7420     if is_script 
+0000c7d0: 616e 6420 6c61 7374 5f78 2061 6e64 2074  and last_x and t
+0000c7e0: 6869 735f 783a 0a20 2020 2020 2020 2020  his_x:.         
+0000c7f0: 2020 2020 2020 2020 2020 2069 735f 7363             is_sc
+0000c800: 7269 7074 203d 206c 6173 745f 7820 3c20  ript = last_x < 
+0000c810: 7468 6973 5f78 0a20 2020 2020 2020 2072  this_x.        r
+0000c820: 6574 7572 6e20 6973 5f73 6372 6970 740a  eturn is_script.
+0000c830: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+0000c840: 640a 2020 2020 6465 6620 6578 7472 6163  d.    def extrac
+0000c850: 745f 666f 6f74 6e6f 7465 7328 636c 732c  t_footnotes(cls,
+0000c860: 2068 746d 6c5f 656c 656d 2c20 666f 6e74   html_elem, font
+0000c870: 5f73 697a 655f 636f 6e64 6974 696f 6e2c  _size_condition,
+0000c880: 2074 6974 6c65 3d22 466f 6f74 6e6f 7465   title="Footnote
+0000c890: 7322 293a 0a20 2020 2020 2020 2064 6976  s"):.        div
+0000c8a0: 7320 3d20 6874 6d6c 5f65 6c65 6d2e 7870  s = html_elem.xp
+0000c8b0: 6174 6828 6622 2f2f 6469 765b 7370 616e  ath(f"//div[span
+0000c8c0: 5b63 6f6e 7461 696e 7328 4073 7479 6c65  [contains(@style
+0000c8d0: 2c20 277b 666f 6e74 5f73 697a 655f 636f  , '{font_size_co
+0000c8e0: 6e64 6974 696f 6e7d 2729 2061 6e64 206e  ndition}') and n
+0000c8f0: 756d 6265 7228 2e29 3d6e 756d 6265 7228  umber(.)=number(
+0000c900: 2e29 5d5d 2229 0a20 2020 2020 2020 2066  .)]]").        f
+0000c910: 6f6f 746e 6f74 655f 6469 7620 3d20 4874  ootnote_div = Ht
+0000c920: 6d6c 4772 6f75 702e 6765 745f 6261 636b  mlGroup.get_back
+0000c930: 5f64 6976 2868 746d 6c5f 656c 656d 290a  _div(html_elem).
+0000c940: 2020 2020 2020 2020 666f 6f74 6e6f 7465          footnote
+0000c950: 5f74 6974 6c65 203d 2045 542e 5375 6245  _title = ET.SubE
+0000c960: 6c65 6d65 6e74 2866 6f6f 746e 6f74 655f  lement(footnote_
+0000c970: 6469 762c 2022 6469 7622 290a 2020 2020  div, "div").    
+0000c980: 2020 2020 666f 6f74 6e6f 7465 5f74 6974      footnote_tit
+0000c990: 6c65 2e74 6578 7420 3d20 7469 746c 650a  le.text = title.
+0000c9a0: 2020 2020 2020 2020 756c 203d 2045 542e          ul = ET.
+0000c9b0: 5375 6245 6c65 6d65 6e74 2866 6f6f 746e  SubElement(footn
+0000c9c0: 6f74 655f 6469 762c 2022 756c 2229 0a20  ote_div, "ul"). 
+0000c9d0: 2020 2020 2020 2063 7572 7265 6e74 5f6c         current_l
+0000c9e0: 6920 3d20 4e6f 6e65 0a20 2020 2020 2020  i = None.       
+0000c9f0: 2066 6f72 2064 6976 2069 6e20 6469 7673   for div in divs
+0000ca00: 3a0a 2020 2020 2020 2020 2020 2020 7370  :.            sp
+0000ca10: 616e 7320 3d20 6469 762e 7870 6174 6828  ans = div.xpath(
+0000ca20: 222e 2f73 7061 6e22 290a 2020 2020 2020  "./span").      
+0000ca30: 2020 2020 2020 666f 7220 692c 2073 7061        for i, spa
+0000ca40: 6e20 696e 2065 6e75 6d65 7261 7465 2873  n in enumerate(s
+0000ca50: 7061 6e73 293a 0a20 2020 2020 2020 2020  pans):.         
+0000ca60: 2020 2020 2020 2069 6620 586d 6c4c 6962         if XmlLib
+0000ca70: 2e69 735f 696e 7465 6765 7228 7370 616e  .is_integer(span
+0000ca80: 2920 616e 6420 2869 203d 3d20 3020 6f72  ) and (i == 0 or
+0000ca90: 2048 746d 6c55 7469 6c2e 6973 5f73 7570   HtmlUtil.is_sup
+0000caa0: 6572 7363 7269 7074 2873 7061 6e73 5b69  erscript(spans[i
+0000cab0: 202d 2031 5d2c 2073 7061 6e29 293a 0a20   - 1], span)):. 
+0000cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cad0: 2020 2063 7572 7265 6e74 5f6c 6920 3d20     current_li = 
+0000cae0: 4554 2e53 7562 456c 656d 656e 7428 756c  ET.SubElement(ul
+0000caf0: 2c20 226c 6922 290a 2020 2020 2020 2020  , "li").        
+0000cb00: 2020 2020 2020 2020 6966 2063 7572 7265          if curre
+0000cb10: 6e74 5f6c 6920 6973 206e 6f74 204e 6f6e  nt_li is not Non
+0000cb20: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000cb30: 2020 2020 2020 2063 7572 7265 6e74 5f6c         current_l
+0000cb40: 692e 6170 7065 6e64 2873 7061 6e29 0a0a  i.append(span)..
+0000cb50: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+0000cb60: 640a 2020 2020 6465 6620 616e 6e6f 7461  d.    def annota
+0000cb70: 7465 5f73 6372 6970 745f 7479 7065 2863  te_script_type(c
+0000cb80: 6c73 2c20 7370 616e 2c20 7363 7269 7074  ls, span, script
+0000cb90: 5f74 7970 652c 2073 6372 6970 745f 6661  _type, script_fa
+0000cba0: 6374 6f72 3d4e 6f6e 652c 206c 6173 745f  ctor=None, last_
+0000cbb0: 7370 616e 3d4e 6f6e 652c 2079 646f 776e  span=None, ydown
+0000cbc0: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
+0000cbd0: 2222 2269 7320 6120 7370 616e 2061 2073  """is a span a s
+0000cbe0: 7562 206f 7220 7375 7065 7273 6372 6970  ub or superscrip
+0000cbf0: 743f 0a20 2020 2020 2020 203a 7061 7261  t?.        :para
+0000cc00: 6d20 7370 616e 3a20 746f 2074 6573 740a  m span: to test.
+0000cc10: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+0000cc20: 6372 6970 745f 7479 7065 3a20 5353 6372  cript_type: SScr
+0000cc30: 6970 742e 5355 4220 6f72 2053 5363 7269  ipt.SUB or SScri
+0000cc40: 7074 2e53 5550 4552 0a20 2020 2020 2020  pt.SUPER.       
+0000cc50: 203a 7061 7261 6d20 7363 7269 7074 5f66   :param script_f
+0000cc60: 6163 746f 723a 2069 6620 4e6f 6e65 2c20  actor: if None, 
+0000cc70: 6465 6661 756c 7473 2074 6f20 4874 6d6c  defaults to Html
+0000cc80: 5574 696c 2e53 4352 4950 545f 4641 4354  Util.SCRIPT_FACT
+0000cc90: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0000cca0: 6c61 7374 5f73 7061 6e3a 2070 7265 6365  last_span: prece
+0000ccb0: 6469 6e67 2073 7061 6e3b 2069 6620 4e6f  ding span; if No
+0000ccc0: 6e65 2074 7269 6573 2078 7061 7468 2822  ne tries xpath("
+0000ccd0: 7072 6563 6564 696e 673a 3a73 7061 6e22  preceding::span"
+0000cce0: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
+0000ccf0: 2079 646f 776e 3a20 6973 2079 2072 756e   ydown: is y run
+0000cd00: 6e69 6e67 2064 6f6e 7720 7468 6520 7061  ning donw the pa
+0000cd10: 6765 3f0a 2020 2020 2020 2020 2222 220a  ge?.        """.
+0000cd20: 2020 2020 2020 2020 6966 2073 7061 6e20          if span 
+0000cd30: 6973 204e 6f6e 6520 6f72 206e 6f74 2073  is None or not s
+0000cd40: 6372 6970 745f 7479 7065 3a0a 2020 2020  cript_type:.    
+0000cd50: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+0000cd60: 6f6e 650a 2020 2020 2020 2020 6966 206e  one.        if n
+0000cd70: 6f74 2073 6372 6970 745f 6661 6374 6f72  ot script_factor
+0000cd80: 3a0a 2020 2020 2020 2020 2020 2020 7363  :.            sc
+0000cd90: 7269 7074 5f66 6163 746f 7220 3d20 4874  ript_factor = Ht
+0000cda0: 6d6c 5574 696c 2e53 4352 4950 545f 4641  mlUtil.SCRIPT_FA
+0000cdb0: 4354 0a20 2020 2020 2020 2069 6620 6e6f  CT.        if no
+0000cdc0: 7420 6c61 7374 5f73 7061 6e3a 0a20 2020  t last_span:.   
+0000cdd0: 2020 2020 2020 2020 206c 6173 745f 7370           last_sp
+0000cde0: 616e 203d 2073 7061 6e2e 7870 6174 6828  an = span.xpath(
+0000cdf0: 2270 7265 6365 6469 6e67 3a3a 7370 616e  "preceding::span
+0000ce00: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
+0000ce10: 6620 6c65 6e28 6c61 7374 5f73 7061 6e29  f len(last_span)
+0000ce20: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0000ce30: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+0000ce40: 6e65 0a20 2020 2020 2020 2020 2020 206c  ne.            l
+0000ce50: 6173 745f 7370 616e 203d 206c 6173 745f  ast_span = last_
+0000ce60: 7370 616e 5b2d 315d 0a20 2020 2020 2020  span[-1].       
+0000ce70: 2063 7373 7320 3d20 4353 5353 7479 6c65   csss = CSSStyle
+0000ce80: 2e63 7265 6174 655f 6373 735f 7374 796c  .create_css_styl
+0000ce90: 655f 6672 6f6d 5f61 7474 7269 6275 7465  e_from_attribute
+0000cea0: 5f6f 665f 626f 6479 5f65 6c65 6d65 6e74  _of_body_element
+0000ceb0: 2873 7061 6e29 0a20 2020 2020 2020 206c  (span).        l
+0000cec0: 6173 745f 6373 7373 203d 2043 5353 5374  ast_csss = CSSSt
+0000ced0: 796c 652e 6372 6561 7465 5f63 7373 5f73  yle.create_css_s
+0000cee0: 7479 6c65 5f66 726f 6d5f 6174 7472 6962  tyle_from_attrib
+0000cef0: 7574 655f 6f66 5f62 6f64 795f 656c 656d  ute_of_body_elem
+0000cf00: 656e 7428 6c61 7374 5f73 7061 6e29 0a20  ent(last_span). 
+0000cf10: 2020 2020 2020 2066 6f6e 745f 7369 7a65         font_size
+0000cf20: 203d 2063 7373 732e 666f 6e74 5f73 697a   = csss.font_siz
+0000cf30: 650a 2020 2020 2020 2020 6c61 7374 5f66  e.        last_f
+0000cf40: 6f6e 745f 7369 7a65 203d 206c 6173 745f  ont_size = last_
+0000cf50: 6373 7373 2e66 6f6e 745f 7369 7a65 0a20  csss.font_size. 
+0000cf60: 2020 2020 2020 2069 735f 7363 7269 7074         is_script
+0000cf70: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0000cf80: 6966 2066 6f6e 745f 7369 7a65 2061 6e64  if font_size and
+0000cf90: 2066 6f6e 745f 7369 7a65 203c 2073 6372   font_size < scr
+0000cfa0: 6970 745f 6661 6374 6f72 202a 206c 6173  ipt_factor * las
+0000cfb0: 745f 666f 6e74 5f73 697a 653a 0a20 2020  t_font_size:.   
+0000cfc0: 2020 2020 2020 2020 206c 6173 745f 7920           last_y 
+0000cfd0: 3d20 4353 5353 7479 6c65 2e67 6574 5f79  = CSSStyle.get_y
+0000cfe0: 3028 6c61 7374 5f73 7061 6e29 0a20 2020  0(last_span).   
+0000cff0: 2020 2020 2020 2020 2074 6869 735f 7920           this_y 
+0000d000: 3d20 4353 5353 7479 6c65 2e67 6574 5f79  = CSSStyle.get_y
+0000d010: 3028 7370 616e 290a 2020 2020 2020 2020  0(span).        
+0000d020: 2020 2020 6966 2073 6372 6970 745f 7479      if script_ty
+0000d030: 7065 203d 3d20 5353 6372 6970 742e 5355  pe == SScript.SU
+0000d040: 423a 0a20 2020 2020 2020 2020 2020 2020  B:.             
+0000d050: 2020 2023 2069 7320 6974 206c 6f77 6572     # is it lower
+0000d060: 6564 3f20 5920 444f 574e 0a20 2020 2020  ed? Y DOWN.     
+0000d070: 2020 2020 2020 2020 2020 2069 735f 7363             is_sc
+0000d080: 7269 7074 203d 2079 646f 776e 203d 3d20  ript = ydown == 
+0000d090: 286c 6173 745f 7920 3c20 7468 6973 5f79  (last_y < this_y
+0000d0a0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+0000d0b0: 6966 2073 6372 6970 745f 7479 7065 203d  if script_type =
+0000d0c0: 3d20 5353 6372 6970 742e 5355 503a 0a20  = SScript.SUP:. 
+0000d0d0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000d0e0: 2069 7320 6974 2072 6169 7365 643f 2059   is it raised? Y
+0000d0f0: 2044 4f57 4e0a 2020 2020 2020 2020 2020   DOWN.          
+0000d100: 2020 2020 2020 6973 5f73 6372 6970 7420        is_script 
+0000d110: 3d20 7964 6f77 6e20 3d3d 2028 6c61 7374  = ydown == (last
+0000d120: 5f79 203e 2074 6869 735f 7929 0a20 2020  _y > this_y).   
+0000d130: 2020 2020 2020 2020 2069 6620 6973 5f73           if is_s
+0000d140: 6372 6970 743a 0a20 2020 2020 2020 2020  cript:.         
+0000d150: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
+0000d160: 2020 2020 7265 7475 726e 2069 735f 7363      return is_sc
+0000d170: 7269 7074 0a0a 0a20 2020 2040 636c 6173  ript...    @clas
+0000d180: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+0000d190: 7365 745f 6174 7472 6962 2863 6c73 2c20  set_attrib(cls, 
+0000d1a0: 656c 656d 656e 742c 2061 7474 6e61 6d65  element, attname
+0000d1b0: 2c20 6174 7476 616c 7565 293a 0a20 2020  , attvalue):.   
+0000d1c0: 2020 2020 2022 2222 636f 6e76 656e 6965       """convenie
+0000d1d0: 6e63 6520 6d65 7468 6f64 2074 6f20 7365  nce method to se
+0000d1e0: 7420 6174 7472 6962 7574 6520 7661 6c75  t attribute valu
+0000d1f0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+0000d200: 2020 2020 2020 6966 2065 6c65 6d65 6e74        if element
+0000d210: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000d220: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0000d230: 6545 7272 6f72 2822 656c 656d 656e 7420  eError("element 
+0000d240: 6973 204e 6f6e 6522 290a 2020 2020 2020  is None").      
+0000d250: 2020 6966 2061 7474 6e61 6d65 2061 6e64    if attname and
+0000d260: 2061 7474 7661 6c75 653a 0a20 2020 2020   attvalue:.     
+0000d270: 2020 2020 2020 2065 6c65 6d65 6e74 2e73         element.s
+0000d280: 6574 2861 7474 6e61 6d65 2c20 7374 7228  et(attname, str(
+0000d290: 6174 7476 616c 7565 2929 0a0a 2020 2020  attvalue))..    
+0000d2a0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+0000d2b0: 2064 6566 2067 6574 5f74 6578 745f 636f   def get_text_co
+0000d2c0: 6e74 656e 7428 636c 732c 2065 6c65 6d29  ntent(cls, elem)
+0000d2d0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000d2e0: 2020 2020 2020 636f 6e76 656e 6965 6e63        convenienc
+0000d2f0: 6520 6d65 7468 6f64 3b20 6176 6f69 6473  e method; avoids
+0000d300: 2068 6176 696e 6720 746f 2072 656d 656d   having to remem
+0000d310: 6265 7220 6a6f 696e 2f69 7465 7274 6578  ber join/itertex
+0000d320: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
+0000d330: 2020 2020 2020 7265 7475 726e 2027 272e        return ''.
+0000d340: 6a6f 696e 2865 6c65 6d2e 6974 6572 7465  join(elem.iterte
+0000d350: 7874 2829 290a 0a20 2020 2040 636c 6173  xt())..    @clas
+0000d360: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+0000d370: 6164 645f 6765 6e65 7261 7465 645f 6964  add_generated_id
+0000d380: 7328 636c 732c 2072 6f6f 745f 656c 656d  s(cls, root_elem
+0000d390: 293a 0a20 2020 2020 2020 2022 2222 6164  ):.        """ad
+0000d3a0: 6473 2049 4473 2074 6f20 616c 6c20 656c  ds IDs to all el
+0000d3b0: 656d 656e 7473 2069 6e20 646f 6375 6d65  ements in docume
+0000d3c0: 6e74 206f 7264 6572 0a20 2020 2020 2020  nt order.       
+0000d3d0: 203a 7061 7261 6d20 726f 6f74 5f65 6c65   :param root_ele
+0000d3e0: 6d3a 2065 6c65 6d65 6e74 2064 6566 696e  m: element defin
+0000d3f0: 696e 6720 7472 6565 206f 6620 7375 6265  ing tree of sube
+0000d400: 6c65 6d65 6e74 7322 2222 0a20 2020 2020  lements""".     
+0000d410: 2020 2078 7061 7468 203d 2022 2f2f 2a22     xpath = "//*"
+0000d420: 0a20 2020 2020 2020 2065 6c65 6d73 203d  .        elems =
+0000d430: 2072 6f6f 745f 656c 656d 2e78 7061 7468   root_elem.xpath
+0000d440: 2878 7061 7468 290a 2020 2020 2020 2020  (xpath).        
+0000d450: 666f 7220 692c 2065 6c20 696e 2065 6e75  for i, el in enu
+0000d460: 6d65 7261 7465 2865 6c65 6d73 293a 0a20  merate(elems):. 
+0000d470: 2020 2020 2020 2020 2020 2065 6c2e 6174             el.at
+0000d480: 7472 6962 5b41 5f49 445d 203d 2041 5f49  trib[A_ID] = A_I
+0000d490: 4420 2b20 7374 7228 6929 0a20 2020 2040  D + str(i).    @
+0000d4a0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+0000d4b0: 6465 6620 6a6f 696e 5f73 7061 6e73 5f69  def join_spans_i
+0000d4c0: 6e5f 7361 6d65 5f64 6976 2863 6c73 2c20  n_same_div(cls, 
+0000d4d0: 7370 616e 302c 2073 7061 6e31 2c20 6164  span0, span1, ad
+0000d4e0: 6473 7061 6365 3d54 7275 652c 2072 656d  dspace=True, rem
+0000d4f0: 6f76 653d 5472 7565 293a 0a20 2020 2020  ove=True):.     
+0000d500: 2020 2022 2222 0a20 2020 2020 2020 206a     """.        j
+0000d510: 6f69 6e74 203c 7370 616e 3e2e 2e2e 3c2f  oint <span>...</
+0000d520: 7370 616e 3e3c 7370 616e 3e2e 2e2e 3c2f  span><span>...</
+0000d530: 7370 616e 3e20 696e 746f 203c 7370 616e  span> into <span
+0000d540: 3e2e 2e2e 3c2f 7370 616e 3e0a 2020 2020  >...</span>.    
+0000d550: 2020 2020 7468 6973 2073 7472 7563 7475      this structu
+0000d560: 7265 2061 7269 7365 7320 7768 656e 2050  re arises when P
+0000d570: 4446 206f 7220 696d 6167 6573 2069 7320  DF or images is 
+0000d580: 7061 7273 6564 2061 6e64 2073 7061 6e73  parsed and spans
+0000d590: 2068 6176 6520 7468 6520 7361 6d65 2073   have the same s
+0000d5a0: 7479 6c65 7320 2873 697a 652f 7374 796c  tyles (size/styl
+0000d5b0: 652f 7765 6967 6874 2920 616e 6420 6361  e/weight) and ca
+0000d5c0: 6e20 6265 206d 6572 6765 640a 2020 2020  n be merged.    
+0000d5d0: 2020 2020 7765 2061 7373 756d 6520 7468      we assume th
+0000d5e0: 6174 2073 7479 6c65 2061 6e64 2067 656f  at style and geo
+0000d5f0: 6d65 7472 7920 6368 656b 696e 6720 6861  metry cheking ha
+0000d600: 7320 6265 656e 2064 6f6e 650a 2020 2020  s been done.    
+0000d610: 2020 2020 3a70 6172 616d 2073 7061 6e30      :param span0
+0000d620: 3a20 6669 7273 7420 3c73 7061 6e3e 2c20  : first <span>, 
+0000d630: 7465 7874 2077 696c 6c20 6265 2069 6e63  text will be inc
+0000d640: 7265 6173 6564 2066 726f 6d20 7370 616e  reased from span
+0000d650: 310a 2020 2020 2020 2020 3a70 6172 616d  1.        :param
+0000d660: 2073 7061 6e31 3a20 7465 7874 2077 696c   span1: text wil
+0000d670: 6c20 6265 2061 7070 656e 6465 6420 746f  l be appended to
+0000d680: 2073 7061 6e30 2074 6578 740a 2020 2020   span0 text.    
+0000d690: 2020 2020 3a70 6172 616d 2072 656d 6f76      :param remov
+0000d6a0: 653a 2072 656d 6f76 6520 7370 616e 3120  e: remove span1 
+0000d6b0: 2864 6566 6175 6c74 290a 2020 2020 2020  (default).      
+0000d6c0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0000d6d0: 2048 746d 6c55 7469 6c2e 6368 6563 6b5f   HtmlUtil.check_
+0000d6e0: 7461 6728 7370 616e 302c 2022 7370 616e  tag(span0, "span
+0000d6f0: 2229 2061 6e64 2048 746d 6c55 7469 6c2e  ") and HtmlUtil.
+0000d700: 6368 6563 6b5f 7461 6728 7370 616e 312c  check_tag(span1,
+0000d710: 2022 7370 616e 2229 3a0a 2020 2020 2020   "span"):.      
+0000d720: 2020 2020 2020 7061 7265 6e74 3120 3d20        parent1 = 
+0000d730: 7370 616e 312e 6765 7470 6172 656e 7428  span1.getparent(
+0000d740: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000d750: 2061 6464 7370 6163 653a 0a20 2020 2020   addspace:.     
+0000d760: 2020 2020 2020 2020 2020 2073 7061 6e30             span0
+0000d770: 5f6e 6f74 5f65 6e64 5f73 7061 6365 203d  _not_end_space =
+0000d780: 206c 656e 2873 7061 6e30 2920 3e20 3020   len(span0) > 0 
+0000d790: 616e 6420 7370 616e 305b 2d31 5d20 213d  and span0[-1] !=
+0000d7a0: 2022 2022 0a20 2020 2020 2020 2020 2020   " ".           
+0000d7b0: 2020 2020 2073 7061 6e31 5f6e 6f74 5f73       span1_not_s
+0000d7c0: 7461 7274 5f73 7061 6365 203d 206c 656e  tart_space = len
+0000d7d0: 2873 7061 6e31 2920 3e20 3020 616e 6420  (span1) > 0 and 
+0000d7e0: 7370 616e 315b 2d31 5d20 213d 2022 2022  span1[-1] != " "
+0000d7f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d800: 2069 6620 7370 616e 305f 6e6f 745f 656e   if span0_not_en
+0000d810: 645f 7370 6163 6520 616e 6420 7370 616e  d_space and span
+0000d820: 315f 6e6f 745f 7374 6172 745f 7370 6163  1_not_start_spac
+0000d830: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0000d840: 2020 2020 2020 2073 7061 6e30 2e74 6578         span0.tex
+0000d850: 7420 2b3d 2022 2022 0a20 2020 2020 2020  t += " ".       
+0000d860: 2020 2020 2073 7061 6e30 2e74 6578 7420       span0.text 
+0000d870: 2b3d 2073 7061 6e31 2e74 6578 740a 2020  += span1.text.  
+0000d880: 2020 2020 2020 2020 2020 6966 2072 656d            if rem
+0000d890: 6f76 653a 0a20 2020 2020 2020 2020 2020  ove:.           
+0000d8a0: 2020 2020 2070 6172 656e 7431 2e72 656d       parent1.rem
+0000d8b0: 6f76 6528 7370 616e 3129 0a0a 0a0a 0a20  ove(span1)..... 
+0000d8c0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+0000d8d0: 2020 2020 6465 6620 6372 6561 7465 5f73      def create_s
+0000d8e0: 6b65 6c65 746f 6e5f 6874 6d6c 2863 6c73  keleton_html(cls
+0000d8f0: 293a 0a20 2020 2020 2020 2022 2222 6372  ):.        """cr
+0000d900: 6561 7465 2065 6d70 7479 2068 746d 6c20  eate empty html 
+0000d910: 7472 6565 0a20 2020 2020 2020 2068 746d  tree.        htm
+0000d920: 6c0a 2020 2020 2020 2020 2020 2020 6865  l.            he
+0000d930: 6164 0a20 2020 2020 2020 2020 2020 2020  ad.             
+0000d940: 2020 206d 6574 610a 2020 2020 2020 2020     meta.        
+0000d950: 2020 2020 2020 2020 2320 7374 796c 650a          # style.
+0000d960: 2020 2020 2020 2020 2020 2020 626f 6479              body
+0000d970: 0a0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+0000d980: 6e3a 2074 6869 7320 6874 6d6c 0a20 2020  n: this html.   
+0000d990: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0000d9a0: 2020 6874 6d6c 203d 2045 542e 456c 656d    html = ET.Elem
+0000d9b0: 656e 7428 485f 4854 4d4c 290a 2020 2020  ent(H_HTML).    
+0000d9c0: 2020 2020 6865 6164 203d 2045 542e 456c      head = ET.El
+0000d9d0: 656d 656e 7428 485f 4845 4144 290a 2020  ement(H_HEAD).  
+0000d9e0: 2020 2020 2020 6874 6d6c 2e61 7070 656e        html.appen
+0000d9f0: 6428 6865 6164 290a 2020 2020 2020 2020  d(head).        
+0000da00: 6d65 7461 203d 2045 542e 456c 656d 656e  meta = ET.Elemen
+0000da10: 7428 485f 4d45 5441 290a 2020 2020 2020  t(H_META).      
+0000da20: 2020 6865 6164 2e61 7070 656e 6428 6d65    head.append(me
+0000da30: 7461 290a 2020 2020 2020 2020 7374 796c  ta).        styl
+0000da40: 6520 3d20 4554 2e45 6c65 6d65 6e74 2848  e = ET.Element(H
+0000da50: 5f53 5459 4c45 2920 2023 2065 6d70 7479  _STYLE)  # empty
+0000da60: 203c 7374 796c 653e 206d 6561 6e73 206e   <style> means n
+0000da70: 6f20 6469 7370 6c61 790a 2020 2020 2020  o display.      
+0000da80: 2020 2320 6865 6164 2e61 7070 656e 6428    # head.append(
+0000da90: 7374 796c 6529 0a20 2020 2020 2020 2062  style).        b
+0000daa0: 6f64 7920 3d20 4554 2e45 6c65 6d65 6e74  ody = ET.Element
+0000dab0: 2848 5f42 4f44 5929 0a20 2020 2020 2020  (H_BODY).       
+0000dac0: 2068 746d 6c2e 6170 7065 6e64 2862 6f64   html.append(bod
+0000dad0: 7929 0a20 2020 2020 2020 2072 6574 7572  y).        retur
+0000dae0: 6e20 6874 6d6c 0a0a 2020 2020 4063 6c61  n html..    @cla
+0000daf0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+0000db00: 2066 696e 645f 656c 656d 656e 7473 5f77   find_elements_w
+0000db10: 6974 685f 7374 796c 6528 636c 732c 2065  ith_style(cls, e
+0000db20: 6c65 6d2c 2078 7061 7468 2c20 636f 6e64  lem, xpath, cond
+0000db30: 6974 696f 6e3d 4e6f 6e65 2c20 7265 6d6f  ition=None, remo
+0000db40: 7665 3d46 616c 7365 293a 0a20 2020 2020  ve=False):.     
+0000db50: 2020 2022 2222 7265 6d6f 7665 2061 6c6c     """remove all
+0000db60: 2065 6c65 6d65 6e74 7320 7769 7468 2073   elements with s
+0000db70: 7479 6c65 2066 756c 6669 6c6c 696e 6720  tyle fulfilling 
+0000db80: 636f 6e64 6974 696f 6e0a 2020 2020 2020  condition.      
+0000db90: 2020 3a70 6172 616d 2065 6c65 6d3a 2072    :param elem: r
+0000dba0: 6f6f 7420 656c 656d 656e 7420 666f 7220  oot element for 
+0000dbb0: 7870 6174 680a 2020 2020 2020 2020 3a70  xpath.        :p
+0000dbc0: 6172 616d 2078 7061 7468 3a20 656c 656d  aram xpath: elem
+0000dbd0: 656e 7473 2074 6f20 7363 616e 202c 2073  ents to scan , s
+0000dbe0: 686f 756c 6420 6e6f 726d 616c 6c79 2063  hould normally c
+0000dbf0: 6f6e 7461 696e 2074 6865 2040 7374 796c  ontain the @styl
+0000dc00: 6520 636f 6e64 6974 696f 6e0a 2020 2020  e condition.    
+0000dc10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc20: 2020 2020 2020 6966 204e 6f6e 6520 7573        if None us
+0000dc30: 6573 0a20 2020 2020 2020 203a 7061 7261  es.        :para
+0000dc40: 6d20 636f 6e64 6974 696f 6e3a 2073 7479  m condition: sty
+0000dc50: 6c65 2063 6f6e 6469 7469 6f6e 2070 7269  le condition pri
+0000dc60: 6d69 7469 7665 2061 7420 7072 6573 656e  mitive at presen
+0000dc70: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0000dc80: 2020 2020 2020 2020 2020 2020 2876 6172              (var
+0000dc90: 6961 626c 652c 206f 7220 7661 7269 6162  iable, or variab
+0000dca0: 6c65 2020 6f70 6572 6174 6f72 2076 616c  le  operator val
+0000dcb0: 7565 2028 6576 616c 2069 7320 6576 696c  ue (eval is evil
+0000dcc0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000dcd0: 2020 2020 2020 2020 2020 2020 6578 616d              exam
+0000dce0: 706c 6520 225f 666f 6e74 2d73 697a 6520  ple "_font-size 
+0000dcf0: 3e20 3330 2220 6f72 2022 5f70 6f73 6974  > 30" or "_posit
+0000dd00: 696f 6e22 2028 6d65 616e 7320 6861 7320  ion" (means has 
+0000dd10: 706f 7369 7469 6f6e 290a 2020 2020 2020  position).      
+0000dd20: 2020 3a70 6172 616d 2072 656d 6f76 653a    :param remove:
+0000dd30: 2072 656d 6f76 6520 7468 6573 6520 656c   remove these el
+0000dd40: 656d 656e 7473 2028 6e6f 7420 7468 6569  ements (not thei
+0000dd50: 7220 7461 696c 290a 2020 2020 2020 2020  r tail).        
+0000dd60: 2222 220a 2020 2020 2020 2020 2222 220a  """.        """.
+0000dd70: 2020 2020 2020 2020 4d61 7962 6520 6d6f          Maybe mo
+0000dd80: 7665 2074 6f20 4854 4d4c 5469 6479 0a20  ve to HTMLTidy. 
+0000dd90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000dda0: 2020 2061 7373 6572 7420 656c 656d 2069     assert elem i
+0000ddb0: 7320 6e6f 7420 4e6f 6e65 2c20 6622 6d75  s not None, f"mu
+0000ddc0: 7374 2068 6176 6520 656c 656d 220a 2020  st have elem".  
+0000ddd0: 2020 2020 2020 6966 2078 7061 7468 3a0a        if xpath:.
+0000dde0: 2020 2020 2020 2020 2020 2020 656c 7320              els 
+0000ddf0: 3d20 656c 656d 2e78 7061 7468 2878 7061  = elem.xpath(xpa
+0000de00: 7468 290a 2020 2020 2020 2020 656c 7365  th).        else
+0000de10: 3a0a 2020 2020 2020 2020 2020 2020 656c  :.            el
+0000de20: 7320 3d20 5b65 6c65 6d5d 0a20 2020 2020  s = [elem].     
+0000de30: 2020 2065 6c65 6d73 203d 205b 5d0a 2020     elems = [].  
+0000de40: 2020 2020 2020 666f 7220 656c 2069 6e20        for el in 
+0000de50: 656c 733a 0a20 2020 2020 2020 2020 2020  els:.           
+0000de60: 2063 7373 5f73 7479 6c65 203d 2043 5353   css_style = CSS
+0000de70: 5374 796c 652e 6372 6561 7465 5f63 7373  Style.create_css
+0000de80: 5f73 7479 6c65 5f66 726f 6d5f 6174 7472  _style_from_attr
+0000de90: 6962 7574 655f 6f66 5f62 6f64 795f 656c  ibute_of_body_el
+0000dea0: 656d 656e 7428 656c 290a 2020 2020 2020  ement(el).      
+0000deb0: 2020 2020 2020 6966 2063 6f6e 6469 7469        if conditi
+0000dec0: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+0000ded0: 2020 2020 6966 2063 7373 5f73 7479 6c65      if css_style
+0000dee0: 2e6f 6265 7973 2863 6f6e 6469 7469 6f6e  .obeys(condition
+0000def0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000df00: 2020 2020 2020 2069 6620 7265 6d6f 7665         if remove
+0000df10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000df20: 2020 2020 2020 2020 2020 636c 732e 7265            cls.re
+0000df30: 6d6f 7665 5f65 6c65 6d5f 6b65 6570 5f74  move_elem_keep_t
+0000df40: 6169 6c28 656c 290a 0a20 2020 2040 636c  ail(el)..    @cl
+0000df50: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+0000df60: 6620 7265 6d6f 7665 5f68 6561 6465 7273  f remove_headers
+0000df70: 5f61 6e64 5f66 6f6f 7465 7273 5f75 7369  _and_footers_usi
+0000df80: 6e67 5f70 6466 6d69 6e65 725f 636f 6f72  ng_pdfminer_coor
+0000df90: 6473 2863 6c73 2c20 7265 665f 656c 656d  ds(cls, ref_elem
+0000dfa0: 2c20 7061 6765 7369 7a65 2c20 6865 6164  , pagesize, head
+0000dfb0: 6572 5f68 6569 6768 742c 2066 6f6f 7465  er_height, foote
+0000dfc0: 725f 6865 6967 6874 2c0a 2020 2020 2020  r_height,.      
 0000dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0000dfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dff0: 2020 2020 2020 206d 6172 6b65 725f 7870         marker_xp
-0000e000: 6174 682c 2070 6167 655f 746f 7073 3d4e  ath, page_tops=N
-0000e010: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-0000e020: 220a 2020 2020 2020 2020 4e4f 5420 434f  ".        NOT CO
-0000e030: 4d50 4c45 5445 202d 2074 6865 7265 2061  MPLETE - there a
-0000e040: 7265 206e 6f20 666f 6f74 6572 7320 6265  re no footers be
-0000e050: 6361 7573 6520 6f66 2074 6865 2063 6f6f  cause of the coo
-0000e060: 7264 696e 6174 6520 7379 7374 656d 2e0a  rdinate system..
-0000e070: 0a20 2020 2020 2020 204d 6179 6265 206d  .        Maybe m
-0000e080: 6f76 6520 746f 2048 544d 4c54 6964 790a  ove to HTMLTidy.
-0000e090: 0a20 2020 2020 2020 2074 6865 2040 746f  .        the @to
-0000e0a0: 7020 7265 7072 6573 656e 7473 2074 6865  p represents the
-0000e0b0: 2079 2d63 6f6f 7264 696e 6174 6520 6672   y-coordinate fr
-0000e0c0: 6f6d 2074 6865 2073 7461 7274 206f 6620  om the start of 
-0000e0d0: 7468 6520 646f 6375 6d65 6e74 2028 7064  the document (pd
-0000e0e0: 666d 696e 6572 3f29 2e0a 2020 2020 2020  fminer?)..      
-0000e0f0: 2020 7468 6973 206d 6561 6e73 2077 6520    this means we 
-0000e100: 6861 7665 2074 6f20 7375 6274 7261 6374  have to subtract
-0000e110: 2070 6167 6573 697a 6573 2066 726f 6d20   pagesizes from 
-0000e120: 6974 2e0a 2020 2020 2020 2020 2222 220a  it..        """.
-0000e130: 2020 2020 2020 2020 6465 6275 6720 3d20          debug = 
-0000e140: 4661 6c73 650a 2020 2020 2020 2020 656c  False.        el
-0000e150: 656d 7320 3d20 7265 665f 656c 656d 2e78  ems = ref_elem.x
-0000e160: 7061 7468 286d 6172 6b65 725f 7870 6174  path(marker_xpat
-0000e170: 6829 0a0a 2020 2020 2020 2020 6c61 7374  h)..        last
-0000e180: 5f74 6f70 203d 2030 0a20 2020 2020 2020  _top = 0.       
-0000e190: 2066 6f72 2065 6c65 6d20 696e 2072 6566   for elem in ref
-0000e1a0: 5f65 6c65 6d2e 7870 6174 6828 222f 2f2a  _elem.xpath("//*
-0000e1b0: 5b40 7374 796c 655d 2229 3a0a 2020 2020  [@style]"):.    
-0000e1c0: 2020 2020 2020 2020 7963 6f6f 7264 3020          ycoord0 
-0000e1d0: 3d20 4874 6d6c 5574 696c 2e67 6574 5f79  = HtmlUtil.get_y
-0000e1e0: 3028 656c 656d 290a 2020 2020 2020 2020  0(elem).        
-0000e1f0: 2020 2020 6966 206e 6f74 2079 636f 6f72      if not ycoor
-0000e200: 6430 3a0a 2020 2020 2020 2020 2020 2020  d0:.            
-0000e210: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
-0000e220: 2020 2020 2020 2020 2074 6578 7420 3d20           text = 
-0000e230: 586d 6c4c 6962 2e67 6574 5f74 6578 7428  XmlLib.get_text(
-0000e240: 656c 656d 292e 7374 7269 7028 290a 2020  elem).strip().  
-0000e250: 2020 2020 2020 2020 2020 7061 6765 5f74            page_t
-0000e260: 6f70 5f79 203d 2048 746d 6c55 7469 6c2e  op_y = HtmlUtil.
-0000e270: 6765 745f 6c61 7267 6573 745f 636f 6f72  get_largest_coor
-0000e280: 645f 6c65 7373 5f74 6861 6e28 7061 6765  d_less_than(page
-0000e290: 5f74 6f70 732c 2079 636f 6f72 6430 290a  _tops, ycoord0).
-0000e2a0: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-0000e2b0: 6167 655f 746f 705f 7920 6973 204e 6f6e  age_top_y is Non
-0000e2c0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000e2d0: 2020 2070 7269 6e74 2866 2263 616e 6e6f     print(f"canno
-0000e2e0: 7420 6669 6e64 2070 6167 6520 746f 7020  t find page top 
-0000e2f0: 7b79 636f 6f72 6430 7d22 290a 2020 2020  {ycoord0}").    
-0000e300: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0000e310: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-0000e320: 2070 6167 655f 746f 705f 7920 3d20 666c   page_top_y = fl
-0000e330: 6f61 7428 7061 6765 5f74 6f70 5f79 290a  oat(page_top_y).
-0000e340: 2020 2020 2020 2020 2020 2020 7963 6f6f              ycoo
-0000e350: 7264 203d 2079 636f 6f72 6430 202d 2070  rd = ycoord0 - p
-0000e360: 6167 655f 746f 705f 790a 0a20 2020 2020  age_top_y..     
-0000e370: 2020 2020 2020 2023 2070 7269 6e74 2866         # print(f
-0000e380: 2254 4f50 207b 7963 6f6f 7264 307d 207b  "TOP {ycoord0} {
-0000e390: 7963 6f6f 7264 7d20 7b70 6167 6573 697a  ycoord} {pagesiz
-0000e3a0: 657d 207b 7963 6f6f 7264 2025 2070 6167  e} {ycoord % pag
-0000e3b0: 6573 697a 657d 2229 0a20 2020 2020 2020  esize}").       
-0000e3c0: 2020 2020 2069 6e5f 746f 7020 3d20 7963       in_top = yc
-0000e3d0: 6f6f 7264 203c 2068 6561 6465 725f 6865  oord < header_he
-0000e3e0: 6967 6874 0a20 2020 2020 2020 2020 2020  ight.           
-0000e3f0: 2069 6620 696e 5f74 6f70 3a0a 2020 2020   if in_top:.    
-0000e400: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-0000e410: 6562 7567 3a0a 2020 2020 2020 2020 2020  ebug:.          
-0000e420: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000e430: 6622 544f 5020 207b 7465 7874 7d22 290a  f"TOP  {text}").
-0000e440: 2020 2020 2020 2020 2020 2020 696e 5f62              in_b
-0000e450: 6f74 746f 6d20 3d20 7963 6f6f 7264 203e  ottom = ycoord >
-0000e460: 2070 6167 6573 697a 655b 305d 202d 2066   pagesize[0] - f
-0000e470: 6f6f 7465 725f 6865 6967 6874 0a20 2020  ooter_height.   
-0000e480: 2020 2020 2020 2020 2069 6620 696e 5f62           if in_b
-0000e490: 6f74 746f 6d3a 0a20 2020 2020 2020 2020  ottom:.         
-0000e4a0: 2020 2020 2020 2069 6620 6465 6275 673a         if debug:
-0000e4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e4c0: 2020 2020 2070 7269 6e74 2866 2242 4f54       print(f"BOT
-0000e4d0: 544f 4d20 207b 7465 7874 7d22 290a 2020  TOM  {text}").  
-0000e4e0: 2020 2020 2020 2020 2020 6966 2069 6e5f            if in_
-0000e4f0: 746f 7020 6f72 2069 6e5f 626f 7474 6f6d  top or in_bottom
-0000e500: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000e510: 2020 6966 206c 656e 2874 6578 742e 7374    if len(text.st
-0000e520: 7269 7028 2929 203e 2030 3a0a 2020 2020  rip()) > 0:.    
-0000e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e540: 6c6f 6767 696e 672e 7761 726e 696e 6728  logging.warning(
-0000e550: 6622 7265 6d6f 7669 6e67 2074 6f70 2074  f"removing top t
-0000e560: 6578 7420 7b74 6578 747d 2229 0a20 2020  ext {text}").   
-0000e570: 2020 2020 2020 2020 2020 2020 2063 6c73               cls
-0000e580: 2e72 656d 6f76 655f 656c 656d 5f6b 6565  .remove_elem_kee
-0000e590: 705f 7461 696c 2865 6c65 6d29 0a20 2020  p_tail(elem).   
-0000e5a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000e5b0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0000e5c0: 2073 6b69 7070 6564 0a20 2020 2020 2020   skipped.       
-0000e5d0: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
-0000e5e0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-0000e5f0: 2020 2020 6465 6620 6765 745f 6c61 7267      def get_larg
-0000e600: 6573 745f 636f 6f72 645f 6c65 7373 5f74  est_coord_less_t
-0000e610: 6861 6e28 636c 732c 2070 6167 655f 746f  han(cls, page_to
-0000e620: 7073 2c20 636f 6f72 6429 3a0a 2020 2020  ps, coord):.    
-0000e630: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000e640: 6974 6572 6174 6520 7468 726f 7567 6820  iterate through 
-0000e650: 736f 7274 6564 206c 6973 7420 6f66 2070  sorted list of p
-0000e660: 6167 655f 746f 7073 2061 6e64 2066 696e  age_tops and fin
-0000e670: 6420 7468 6520 6c61 7267 6573 7420 6c65  d the largest le
-0000e680: 7373 2074 6861 6e20 636f 6f72 640a 2020  ss than coord.  
-0000e690: 2020 2020 2020 3a70 6172 616d 2070 6167        :param pag
-0000e6a0: 655f 746f 7073 3a20 736f 7274 6564 2069  e_tops: sorted i
-0000e6b0: 6e63 7265 6173 696e 6720 6c69 7374 206f  ncreasing list o
-0000e6c0: 6620 7061 6765 2074 6f70 730a 2020 2020  f page tops.    
-0000e6d0: 2020 2020 3a70 6172 616d 2063 6f6f 7264      :param coord
-0000e6e0: 3a20 6163 7475 616c 2063 6f6f 7264 696e  : actual coordin
-0000e6f0: 6174 650a 2020 2020 2020 2020 2222 220a  ate.        """.
-0000e700: 2020 2020 2020 2020 6966 2070 6167 655f          if page_
-0000e710: 746f 7073 2069 7320 4e6f 6e65 206f 7220  tops is None or 
-0000e720: 636f 6f72 6420 6973 204e 6f6e 653a 0a20  coord is None:. 
-0000e730: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000e740: 6e20 4e6f 6e65 0a20 2020 2020 2020 2066  n None.        f
-0000e750: 6f72 2069 2c20 7061 6765 5f74 6f70 2069  or i, page_top i
-0000e760: 6e20 656e 756d 6572 6174 6528 7061 6765  n enumerate(page
-0000e770: 5f74 6f70 7329 3a0a 2020 2020 2020 2020  _tops):.        
-0000e780: 2020 2020 6966 2066 6c6f 6174 2870 6167      if float(pag
-0000e790: 655f 746f 7029 203e 2066 6c6f 6174 2863  e_top) > float(c
-0000e7a0: 6f6f 7264 293a 0a20 2020 2020 2020 2020  oord):.         
-0000e7b0: 2020 2020 2020 2069 6620 6920 3d3d 2030         if i == 0
-0000e7c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000e7d0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0000e7e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000e7f0: 2020 7265 7475 726e 2070 6167 655f 746f    return page_to
-0000e800: 7073 5b69 202d 2031 5d0a 2020 2020 2020  ps[i - 1].      
-0000e810: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-0000e820: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-0000e830: 2020 2020 6465 6620 7265 6d6f 7665 5f6c      def remove_l
-0000e840: 685f 6c69 6e65 5f6e 756d 6265 7273 2863  h_line_numbers(c
-0000e850: 6c73 2c20 7265 665f 656c 656d 293a 0a20  ls, ref_elem):. 
-0000e860: 2020 2020 2020 2063 6c73 2e66 696e 645f         cls.find_
-0000e870: 656c 656d 656e 7473 5f77 6974 685f 7374  elements_with_st
-0000e880: 796c 6528 7265 665f 656c 656d 2c20 222e  yle(ref_elem, ".
-0000e890: 2f2f 2a5b 4073 7479 6c65 5d22 2c20 226c  //*[@style]", "l
-0000e8a0: 6566 743c 3439 222c 2072 656d 6f76 653d  eft<49", remove=
-0000e8b0: 5472 7565 290a 2020 2020 2020 2020 2222  True).        ""
-0000e8c0: 220a 2020 2020 2020 2020 4d61 7962 6520  ".        Maybe 
-0000e8d0: 6d6f 7665 2074 6f20 4854 4d4c 5469 6479  move to HTMLTidy
-0000e8e0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0000e8f0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-0000e900: 2020 2064 6566 2072 656d 6f76 655f 6174     def remove_at
-0000e910: 7472 6962 7574 6528 636c 732c 2065 6c65  tribute(cls, ele
-0000e920: 6d2c 2061 7474 5f6e 616d 6529 3a0a 2020  m, att_name):.  
-0000e930: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000e940: 2020 7265 6d6f 7665 7320 6174 7472 6962    removes attrib
-0000e950: 7574 6520 7769 7468 2067 6976 656e 206e  ute with given n
-0000e960: 616d 650a 2020 2020 2020 2020 4966 206e  ame.        If n
-0000e970: 6f74 2070 7265 7365 6e74 2c20 6e6f 2d6f  ot present, no-o
-0000e980: 700a 2020 2020 2020 2020 3a70 6172 616d  p.        :param
-0000e990: 2065 6c65 6d3a 2065 6c65 6d65 6e74 2063   elem: element c
-0000e9a0: 6f6e 7461 696e 696e 6720 6174 7472 6962  ontaining attrib
-0000e9b0: 7574 650a 2020 2020 2020 2020 3a70 6172  ute.        :par
-0000e9c0: 616d 2061 7474 5f6e 616d 653a 206e 616d  am att_name: nam
-0000e9d0: 6520 6f66 2061 7474 7269 6275 7465 0a20  e of attribute. 
-0000e9e0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-0000e9f0: 4e6f 6e65 0a20 2020 2020 2020 2022 2222  None.        """
+0000dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e000: 2020 206d 6172 6b65 725f 7870 6174 682c     marker_xpath,
+0000e010: 2070 6167 655f 746f 7073 3d4e 6f6e 6529   page_tops=None)
+0000e020: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000e030: 2020 2020 2020 4e4f 5420 434f 4d50 4c45        NOT COMPLE
+0000e040: 5445 202d 2074 6865 7265 2061 7265 206e  TE - there are n
+0000e050: 6f20 666f 6f74 6572 7320 6265 6361 7573  o footers becaus
+0000e060: 6520 6f66 2074 6865 2063 6f6f 7264 696e  e of the coordin
+0000e070: 6174 6520 7379 7374 656d 2e0a 0a20 2020  ate system...   
+0000e080: 2020 2020 204d 6179 6265 206d 6f76 6520       Maybe move 
+0000e090: 746f 2048 544d 4c54 6964 790a 0a20 2020  to HTMLTidy..   
+0000e0a0: 2020 2020 2074 6865 2040 746f 7020 7265       the @top re
+0000e0b0: 7072 6573 656e 7473 2074 6865 2079 2d63  presents the y-c
+0000e0c0: 6f6f 7264 696e 6174 6520 6672 6f6d 2074  oordinate from t
+0000e0d0: 6865 2073 7461 7274 206f 6620 7468 6520  he start of the 
+0000e0e0: 646f 6375 6d65 6e74 2028 7064 666d 696e  document (pdfmin
+0000e0f0: 6572 3f29 2e0a 2020 2020 2020 2020 7468  er?)..        th
+0000e100: 6973 206d 6561 6e73 2077 6520 6861 7665  is means we have
+0000e110: 2074 6f20 7375 6274 7261 6374 2070 6167   to subtract pag
+0000e120: 6573 697a 6573 2066 726f 6d20 6974 2e0a  esizes from it..
+0000e130: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000e140: 2020 2020 6465 6275 6720 3d20 4661 6c73      debug = Fals
+0000e150: 650a 2020 2020 2020 2020 656c 656d 7320  e.        elems 
+0000e160: 3d20 7265 665f 656c 656d 2e78 7061 7468  = ref_elem.xpath
+0000e170: 286d 6172 6b65 725f 7870 6174 6829 0a0a  (marker_xpath)..
+0000e180: 2020 2020 2020 2020 6c61 7374 5f74 6f70          last_top
+0000e190: 203d 2030 0a20 2020 2020 2020 2066 6f72   = 0.        for
+0000e1a0: 2065 6c65 6d20 696e 2072 6566 5f65 6c65   elem in ref_ele
+0000e1b0: 6d2e 7870 6174 6828 222f 2f2a 5b40 7374  m.xpath("//*[@st
+0000e1c0: 796c 655d 2229 3a0a 2020 2020 2020 2020  yle]"):.        
+0000e1d0: 2020 2020 7963 6f6f 7264 3020 3d20 4874      ycoord0 = Ht
+0000e1e0: 6d6c 5574 696c 2e67 6574 5f79 3028 656c  mlUtil.get_y0(el
+0000e1f0: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
+0000e200: 6966 206e 6f74 2079 636f 6f72 6430 3a0a  if not ycoord0:.
+0000e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e220: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
+0000e230: 2020 2020 2074 6578 7420 3d20 586d 6c4c       text = XmlL
+0000e240: 6962 2e67 6574 5f74 6578 7428 656c 656d  ib.get_text(elem
+0000e250: 292e 7374 7269 7028 290a 2020 2020 2020  ).strip().      
+0000e260: 2020 2020 2020 7061 6765 5f74 6f70 5f79        page_top_y
+0000e270: 203d 2048 746d 6c55 7469 6c2e 6765 745f   = HtmlUtil.get_
+0000e280: 6c61 7267 6573 745f 636f 6f72 645f 6c65  largest_coord_le
+0000e290: 7373 5f74 6861 6e28 7061 6765 5f74 6f70  ss_than(page_top
+0000e2a0: 732c 2079 636f 6f72 6430 290a 2020 2020  s, ycoord0).    
+0000e2b0: 2020 2020 2020 2020 6966 2070 6167 655f          if page_
+0000e2c0: 746f 705f 7920 6973 204e 6f6e 653a 0a20  top_y is None:. 
+0000e2d0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000e2e0: 7269 6e74 2866 2263 616e 6e6f 7420 6669  rint(f"cannot fi
+0000e2f0: 6e64 2070 6167 6520 746f 7020 7b79 636f  nd page top {yco
+0000e300: 6f72 6430 7d22 290a 2020 2020 2020 2020  ord0}").        
+0000e310: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+0000e320: 0a20 2020 2020 2020 2020 2020 2070 6167  .            pag
+0000e330: 655f 746f 705f 7920 3d20 666c 6f61 7428  e_top_y = float(
+0000e340: 7061 6765 5f74 6f70 5f79 290a 2020 2020  page_top_y).    
+0000e350: 2020 2020 2020 2020 7963 6f6f 7264 203d          ycoord =
+0000e360: 2079 636f 6f72 6430 202d 2070 6167 655f   ycoord0 - page_
+0000e370: 746f 705f 790a 0a20 2020 2020 2020 2020  top_y..         
+0000e380: 2020 2023 2070 7269 6e74 2866 2254 4f50     # print(f"TOP
+0000e390: 207b 7963 6f6f 7264 307d 207b 7963 6f6f   {ycoord0} {ycoo
+0000e3a0: 7264 7d20 7b70 6167 6573 697a 657d 207b  rd} {pagesize} {
+0000e3b0: 7963 6f6f 7264 2025 2070 6167 6573 697a  ycoord % pagesiz
+0000e3c0: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+0000e3d0: 2069 6e5f 746f 7020 3d20 7963 6f6f 7264   in_top = ycoord
+0000e3e0: 203c 2068 6561 6465 725f 6865 6967 6874   < header_height
+0000e3f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000e400: 696e 5f74 6f70 3a0a 2020 2020 2020 2020  in_top:.        
+0000e410: 2020 2020 2020 2020 6966 2064 6562 7567          if debug
+0000e420: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000e430: 2020 2020 2020 7072 696e 7428 6622 544f        print(f"TO
+0000e440: 5020 207b 7465 7874 7d22 290a 2020 2020  P  {text}").    
+0000e450: 2020 2020 2020 2020 696e 5f62 6f74 746f          in_botto
+0000e460: 6d20 3d20 7963 6f6f 7264 203e 2070 6167  m = ycoord > pag
+0000e470: 6573 697a 655b 305d 202d 2066 6f6f 7465  esize[0] - foote
+0000e480: 725f 6865 6967 6874 0a20 2020 2020 2020  r_height.       
+0000e490: 2020 2020 2069 6620 696e 5f62 6f74 746f       if in_botto
+0000e4a0: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
+0000e4b0: 2020 2069 6620 6465 6275 673a 0a20 2020     if debug:.   
+0000e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e4d0: 2070 7269 6e74 2866 2242 4f54 544f 4d20   print(f"BOTTOM 
+0000e4e0: 207b 7465 7874 7d22 290a 2020 2020 2020   {text}").      
+0000e4f0: 2020 2020 2020 6966 2069 6e5f 746f 7020        if in_top 
+0000e500: 6f72 2069 6e5f 626f 7474 6f6d 3a0a 2020  or in_bottom:.  
+0000e510: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000e520: 206c 656e 2874 6578 742e 7374 7269 7028   len(text.strip(
+0000e530: 2929 203e 2030 3a0a 2020 2020 2020 2020  )) > 0:.        
+0000e540: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0000e550: 696e 672e 7761 726e 696e 6728 6622 7265  ing.warning(f"re
+0000e560: 6d6f 7669 6e67 2074 6f70 2074 6578 7420  moving top text 
+0000e570: 7b74 6578 747d 2229 0a20 2020 2020 2020  {text}").       
+0000e580: 2020 2020 2020 2020 2063 6c73 2e72 656d           cls.rem
+0000e590: 6f76 655f 656c 656d 5f6b 6565 705f 7461  ove_elem_keep_ta
+0000e5a0: 696c 2865 6c65 6d29 0a20 2020 2020 2020  il(elem).       
+0000e5b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000e5c0: 2020 2020 2020 2020 2020 2023 2073 6b69             # ski
+0000e5d0: 7070 6564 0a20 2020 2020 2020 2020 2020  pped.           
+0000e5e0: 2020 2020 2070 6173 730a 0a20 2020 2040       pass..    @
+0000e5f0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+0000e600: 6465 6620 6765 745f 6c61 7267 6573 745f  def get_largest_
+0000e610: 636f 6f72 645f 6c65 7373 5f74 6861 6e28  coord_less_than(
+0000e620: 636c 732c 2070 6167 655f 746f 7073 2c20  cls, page_tops, 
+0000e630: 636f 6f72 6429 3a0a 2020 2020 2020 2020  coord):.        
+0000e640: 2222 220a 2020 2020 2020 2020 6974 6572  """.        iter
+0000e650: 6174 6520 7468 726f 7567 6820 736f 7274  ate through sort
+0000e660: 6564 206c 6973 7420 6f66 2070 6167 655f  ed list of page_
+0000e670: 746f 7073 2061 6e64 2066 696e 6420 7468  tops and find th
+0000e680: 6520 6c61 7267 6573 7420 6c65 7373 2074  e largest less t
+0000e690: 6861 6e20 636f 6f72 640a 2020 2020 2020  han coord.      
+0000e6a0: 2020 3a70 6172 616d 2070 6167 655f 746f    :param page_to
+0000e6b0: 7073 3a20 736f 7274 6564 2069 6e63 7265  ps: sorted incre
+0000e6c0: 6173 696e 6720 6c69 7374 206f 6620 7061  asing list of pa
+0000e6d0: 6765 2074 6f70 730a 2020 2020 2020 2020  ge tops.        
+0000e6e0: 3a70 6172 616d 2063 6f6f 7264 3a20 6163  :param coord: ac
+0000e6f0: 7475 616c 2063 6f6f 7264 696e 6174 650a  tual coordinate.
+0000e700: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000e710: 2020 2020 6966 2070 6167 655f 746f 7073      if page_tops
+0000e720: 2069 7320 4e6f 6e65 206f 7220 636f 6f72   is None or coor
+0000e730: 6420 6973 204e 6f6e 653a 0a20 2020 2020  d is None:.     
+0000e740: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+0000e750: 6e65 0a20 2020 2020 2020 2066 6f72 2069  ne.        for i
+0000e760: 2c20 7061 6765 5f74 6f70 2069 6e20 656e  , page_top in en
+0000e770: 756d 6572 6174 6528 7061 6765 5f74 6f70  umerate(page_top
+0000e780: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0000e790: 6966 2066 6c6f 6174 2870 6167 655f 746f  if float(page_to
+0000e7a0: 7029 203e 2066 6c6f 6174 2863 6f6f 7264  p) > float(coord
+0000e7b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000e7c0: 2020 2069 6620 6920 3d3d 2030 3a0a 2020     if i == 0:.  
+0000e7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e7e0: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
+0000e7f0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000e800: 7475 726e 2070 6167 655f 746f 7073 5b69  turn page_tops[i
+0000e810: 202d 2031 5d0a 2020 2020 2020 2020 7265   - 1].        re
+0000e820: 7475 726e 204e 6f6e 650a 0a20 2020 2040  turn None..    @
+0000e830: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+0000e840: 6465 6620 7265 6d6f 7665 5f6c 685f 6c69  def remove_lh_li
+0000e850: 6e65 5f6e 756d 6265 7273 2863 6c73 2c20  ne_numbers(cls, 
+0000e860: 7265 665f 656c 656d 293a 0a20 2020 2020  ref_elem):.     
+0000e870: 2020 2063 6c73 2e66 696e 645f 656c 656d     cls.find_elem
+0000e880: 656e 7473 5f77 6974 685f 7374 796c 6528  ents_with_style(
+0000e890: 7265 665f 656c 656d 2c20 222e 2f2f 2a5b  ref_elem, ".//*[
+0000e8a0: 4073 7479 6c65 5d22 2c20 226c 6566 743c  @style]", "left<
+0000e8b0: 3439 222c 2072 656d 6f76 653d 5472 7565  49", remove=True
+0000e8c0: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
+0000e8d0: 2020 2020 2020 4d61 7962 6520 6d6f 7665        Maybe move
+0000e8e0: 2074 6f20 4854 4d4c 5469 6479 0a20 2020   to HTMLTidy.   
+0000e8f0: 2020 2020 2022 2222 0a0a 2020 2020 4063       """..    @c
+0000e900: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+0000e910: 6566 2072 656d 6f76 655f 6174 7472 6962  ef remove_attrib
+0000e920: 7574 6528 636c 732c 2065 6c65 6d2c 2061  ute(cls, elem, a
+0000e930: 7474 5f6e 616d 6529 3a0a 2020 2020 2020  tt_name):.      
+0000e940: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+0000e950: 6d6f 7665 7320 6174 7472 6962 7574 6520  moves attribute 
+0000e960: 7769 7468 2067 6976 656e 206e 616d 650a  with given name.
+0000e970: 2020 2020 2020 2020 4966 206e 6f74 2070          If not p
+0000e980: 7265 7365 6e74 2c20 6e6f 2d6f 700a 2020  resent, no-op.  
+0000e990: 2020 2020 2020 3a70 6172 616d 2065 6c65        :param ele
+0000e9a0: 6d3a 2065 6c65 6d65 6e74 2063 6f6e 7461  m: element conta
+0000e9b0: 696e 696e 6720 6174 7472 6962 7574 650a  ining attribute.
+0000e9c0: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
+0000e9d0: 7474 5f6e 616d 653a 206e 616d 6520 6f66  tt_name: name of
+0000e9e0: 2061 7474 7269 6275 7465 0a20 2020 2020   attribute.     
+0000e9f0: 2020 203a 7265 7475 726e 3a20 4e6f 6e65     :return: None
 0000ea00: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000ea10: 2020 2020 2072 6f6f 742e 6174 7472 6962       root.attrib
-0000ea20: 2e70 6f70 2822 7879 7a22 2c20 4e6f 6e65  .pop("xyz", None
-0000ea30: 2920 2222 220a 2020 2020 2020 2020 6966  ) """.        if
-0000ea40: 2065 6c65 6d20 6973 204e 6f6e 6520 6f72   elem is None or
-0000ea50: 2061 7474 5f6e 616d 6520 6973 204e 6f6e   att_name is Non
-0000ea60: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000ea70: 6574 7572 6e0a 2020 2020 2020 2020 656c  eturn.        el
-0000ea80: 656d 2e61 7474 7269 622e 706f 7028 6174  em.attrib.pop(at
-0000ea90: 745f 6e61 6d65 2c20 4e6f 6e65 290a 0a20  t_name, None).. 
-0000eaa0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-0000eab0: 2020 2020 6465 6620 7265 6d6f 7665 5f73      def remove_s
-0000eac0: 7479 6c65 5f61 7474 7269 6275 7465 2863  tyle_attribute(c
-0000ead0: 6c73 2c20 7265 665f 656c 656d 2c20 7374  ls, ref_elem, st
-0000eae0: 796c 655f 6e61 6d65 293a 0a20 2020 2020  yle_name):.     
-0000eaf0: 2020 2022 2222 0a20 2020 2020 2020 204d     """.        M
-0000eb00: 6179 6265 206d 6f76 6520 746f 2048 544d  aybe move to HTM
-0000eb10: 4c54 6964 790a 2020 2020 2020 2020 2222  LTidy.        ""
-0000eb20: 220a 0a20 2020 2020 2020 2065 6c65 6d73  "..        elems
-0000eb30: 203d 2072 6566 5f65 6c65 6d2e 7870 6174   = ref_elem.xpat
-0000eb40: 6828 222e 2f2f 2a22 290a 2020 2020 2020  h(".//*").      
-0000eb50: 2020 666f 7220 656c 2069 6e20 656c 656d    for el in elem
-0000eb60: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-0000eb70: 7373 5f73 7479 6c65 203d 2043 5353 5374  ss_style = CSSSt
-0000eb80: 796c 652e 6372 6561 7465 5f63 7373 5f73  yle.create_css_s
-0000eb90: 7479 6c65 5f66 726f 6d5f 6174 7472 6962  tyle_from_attrib
-0000eba0: 7574 655f 6f66 5f62 6f64 795f 656c 656d  ute_of_body_elem
-0000ebb0: 656e 7428 656c 290a 2020 2020 2020 2020  ent(el).        
-0000ebc0: 2020 2020 6966 2063 7373 5f73 7479 6c65      if css_style
-0000ebd0: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
-0000ebe0: 2e67 6574 2873 7479 6c65 5f6e 616d 6529  .get(style_name)
-0000ebf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ec00: 2020 6373 735f 7374 796c 652e 6e61 6d65    css_style.name
-0000ec10: 5f76 616c 7565 5f64 6963 742e 706f 7028  _value_dict.pop(
-0000ec20: 7374 796c 655f 6e61 6d65 290a 2020 2020  style_name).    
-0000ec30: 2020 2020 2020 2020 2020 2020 6373 735f              css_
-0000ec40: 7374 796c 652e 6170 706c 795f 746f 2865  style.apply_to(e
-0000ec50: 6c29 0a0a 2020 2020 4063 6c61 7373 6d65  l)..    @classme
-0000ec60: 7468 6f64 0a20 2020 2064 6566 2072 656d  thod.    def rem
-0000ec70: 6f76 655f 6c61 7267 655f 666f 6e74 6564  ove_large_fonted
-0000ec80: 5f65 6c65 6d65 6e74 7328 636c 732c 2072  _elements(cls, r
-0000ec90: 6566 5f65 6c65 6d29 3a0a 2020 2020 2020  ef_elem):.      
-0000eca0: 2020 2222 220a 2020 2020 2020 2020 4d61    """.        Ma
-0000ecb0: 7962 6520 6d6f 7665 2074 6f20 4854 4d4c  ybe move to HTML
-0000ecc0: 5469 6479 0a20 2020 2020 2020 2022 2222  Tidy.        """
-0000ecd0: 0a20 2020 2020 2020 2063 6c73 2e66 696e  .        cls.fin
-0000ece0: 645f 656c 656d 656e 7473 5f77 6974 685f  d_elements_with_
-0000ecf0: 7374 796c 6528 7265 665f 656c 656d 2c20  style(ref_elem, 
-0000ed00: 222e 2f2f 2a5b 4073 7479 6c65 5d22 2c20  ".//*[@style]", 
-0000ed10: 2266 6f6e 742d 7369 7a65 3e33 3022 2c20  "font-size>30", 
-0000ed20: 7265 6d6f 7665 3d54 7275 6529 0a0a 2020  remove=True)..  
-0000ed30: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-0000ed40: 2020 2064 6566 2066 696e 645f 636f 6e73     def find_cons
-0000ed50: 7461 6e74 5f63 6f6f 7264 696e 6174 655f  tant_coordinate_
-0000ed60: 6d61 726b 6572 7328 636c 732c 2072 6566  markers(cls, ref
-0000ed70: 5f65 6c65 6d2c 2078 7061 7468 2c20 7374  _elem, xpath, st
-0000ed80: 796c 653d 2274 6f70 2229 3a0a 2020 2020  yle="top"):.    
-0000ed90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000eda0: 6669 6e64 7320 6120 6c69 6e65 2077 6974  finds a line wit
-0000edb0: 6820 636f 6e73 7461 6e74 2064 6966 6665  h constant diffe
-0000edc0: 7265 6e63 6520 6672 6f6d 2074 6f70 206f  rence from top o
-0000edd0: 6620 7061 6765 0a3c 6469 7620 7374 796c  f page.<div styl
-0000ede0: 653d 2274 6f70 3a20 3530 7078 3b22 3e3c  e="top: 50px;"><
-0000edf0: 6120 6e61 6d65 3d22 3122 3e50 6167 6520  a name="1">Page 
-0000ee00: 313c 2f61 3e3c 2f64 6976 3e0a 2020 2020  1</a></div>.    
-0000ee10: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000ee20: 2222 220a 2020 2020 2020 2020 4d61 7962  """.        Mayb
-0000ee30: 6520 6d6f 7665 2074 6f20 4854 4d4c 5469  e move to HTMLTi
-0000ee40: 6479 0a20 2020 2020 2020 2022 2222 0a0a  dy.        """..
-0000ee50: 2020 2020 2020 2020 656c 656d 7320 3d20          elems = 
-0000ee60: 7265 665f 656c 656d 2e78 7061 7468 2878  ref_elem.xpath(x
-0000ee70: 7061 7468 290a 2020 2020 2020 2020 636f  path).        co
-0000ee80: 6f72 6473 203d 205b 5d0a 2020 2020 2020  ords = [].      
-0000ee90: 2020 666f 7220 656c 656d 2069 6e20 656c    for elem in el
-0000eea0: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
-0000eeb0: 2063 7373 5f73 7479 6c65 203d 2043 5353   css_style = CSS
-0000eec0: 5374 796c 652e 6372 6561 7465 5f63 7373  Style.create_css
-0000eed0: 5f73 7479 6c65 5f66 726f 6d5f 6174 7472  _style_from_attr
-0000eee0: 6962 7574 655f 6f66 5f62 6f64 795f 656c  ibute_of_body_el
-0000eef0: 656d 656e 7428 656c 656d 290a 2020 2020  ement(elem).    
-0000ef00: 2020 2020 2020 2020 636f 6f72 6420 3d20          coord = 
-0000ef10: 6373 735f 7374 796c 652e 6e61 6d65 5f76  css_style.name_v
-0000ef20: 616c 7565 5f64 6963 742e 6765 7428 7374  alue_dict.get(st
-0000ef30: 796c 6529 0a20 2020 2020 2020 2020 2020  yle).           
-0000ef40: 2069 6620 636f 6f72 643a 0a20 2020 2020   if coord:.     
-0000ef50: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0000ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef70: 2020 2020 636f 6f72 6473 2e61 7070 656e      coords.appen
-0000ef80: 6428 666c 6f61 7428 636f 6f72 645b 3a2d  d(float(coord[:-
-0000ef90: 325d 2929 0a20 2020 2020 2020 2020 2020  2])).           
-0000efa0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-0000efb0: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-0000efc0: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
-0000efd0: 6e67 2e77 6172 6e69 6e67 2866 2263 616e  ng.warning(f"can
-0000efe0: 6e6f 7420 7061 7273 6520 7b63 6f6f 7264  not parse {coord
-0000eff0: 7d20 666f 7220 7b73 7479 6c65 7d22 290a  } for {style}").
-0000f000: 2020 2020 2020 2020 6966 206e 6f74 2063          if not c
-0000f010: 6f6f 7264 733a 0a20 2020 2020 2020 2020  oords:.         
-0000f020: 2020 2072 6574 7572 6e20 4e6f 6e65 2c20     return None, 
-0000f030: 4e6f 6e65 2c20 5b5d 0a20 2020 2020 2020  None, [].       
-0000f040: 206e 705f 636f 6f72 6473 203d 206e 702e   np_coords = np.
-0000f050: 6172 7261 7928 636f 6f72 6473 290a 0a20  array(coords).. 
-0000f060: 2020 2020 2020 2078 203d 206e 702e 6172         x = np.ar
-0000f070: 7261 7928 7261 6e67 6528 6e70 5f63 6f6f  ray(range(np_coo
-0000f080: 7264 732e 7369 7a65 2929 2e72 6573 6861  rds.size)).resha
-0000f090: 7065 2828 2d31 2c20 3129 290a 2020 2020  pe((-1, 1)).    
-0000f0a0: 2020 2020 6d6f 6465 6c20 3d20 4c69 6e65      model = Line
-0000f0b0: 6172 5265 6772 6573 7369 6f6e 2829 2e66  arRegression().f
-0000f0c0: 6974 2878 2c20 636f 6f72 6473 290a 2020  it(x, coords).  
-0000f0d0: 2020 2020 2020 725f 7371 203d 206d 6f64        r_sq = mod
-0000f0e0: 656c 2e73 636f 7265 2878 2c20 636f 6f72  el.score(x, coor
-0000f0f0: 6473 290a 2020 2020 2020 2020 6966 2072  ds).        if r
-0000f100: 5f73 7120 3c20 302e 3938 3a0a 2020 2020  _sq < 0.98:.    
-0000f110: 2020 2020 2020 2020 6c6f 6767 696e 672e          logging.
-0000f120: 7761 726e 696e 6728 6622 6361 6e6e 6f74  warning(f"cannot
-0000f130: 2063 616c 6375 6c61 7465 206f 6666 7365   calculate offse
-0000f140: 7420 7265 6c69 6162 6c79 2229 0a20 2020  t reliably").   
-0000f150: 2020 2020 2072 6574 7572 6e20 6d6f 6465       return mode
-0000f160: 6c2e 696e 7465 7263 6570 745f 2c20 6d6f  l.intercept_, mo
-0000f170: 6465 6c2e 636f 6566 5f2c 206e 705f 636f  del.coef_, np_co
-0000f180: 6f72 6473 0a0a 2020 2020 4063 6c61 7373  ords..    @class
-0000f190: 6d65 7468 6f64 0a20 2020 2064 6566 2072  method.    def r
-0000f1a0: 656d 6f76 655f 756e 7761 6e74 6564 7328  emove_unwanteds(
-0000f1b0: 636c 732c 2074 6f70 5f65 6c65 6d2c 2075  cls, top_elem, u
-0000f1c0: 6e77 616e 7465 6473 293a 0a20 2020 2020  nwanteds):.     
-0000f1d0: 2020 2022 2222 0a20 2020 2020 2020 204d     """.        M
-0000f1e0: 6179 6265 206d 6f76 6520 746f 2048 544d  aybe move to HTM
-0000f1f0: 4c54 6964 790a 2020 2020 2020 2020 2222  LTidy.        ""
-0000f200: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-0000f210: 2075 6e77 616e 7465 6473 3a0a 2020 2020   unwanteds:.    
-0000f220: 2020 2020 2020 2020 6c6f 6767 696e 672e          logging.
-0000f230: 7761 726e 696e 6728 6622 6e6f 2075 6e77  warning(f"no unw
-0000f240: 616e 7465 6473 2074 6f20 7265 6d6f 7665  anteds to remove
-0000f250: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-0000f260: 6574 7572 6e0a 2020 2020 2020 2020 666f  eturn.        fo
-0000f270: 7220 6b65 7920 696e 2075 6e77 616e 7465  r key in unwante
-0000f280: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
-0000f290: 756e 7761 6e74 6564 203d 2075 6e77 616e  unwanted = unwan
-0000f2a0: 7465 6473 5b6b 6579 5d0a 2020 2020 2020  teds[key].      
-0000f2b0: 2020 2020 2020 7870 6174 6820 3d20 756e        xpath = un
-0000f2c0: 7761 6e74 6564 5b55 5f58 5041 5448 5d0a  wanted[U_XPATH].
-0000f2d0: 2020 2020 2020 2020 2020 2020 6966 2078              if x
-0000f2e0: 7061 7468 3a0a 2020 2020 2020 2020 2020  path:.          
-0000f2f0: 2020 2020 2020 7265 6765 7820 3d20 756e        regex = un
-0000f300: 7761 6e74 6564 5b55 5f52 4547 4558 5d0a  wanted[U_REGEX].
-0000f310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f320: 7265 6765 785f 636f 6d70 203d 2072 652e  regex_comp = re.
-0000f330: 636f 6d70 696c 6528 7265 6765 7829 2069  compile(regex) i
-0000f340: 6620 7265 6765 7820 656c 7365 204e 6f6e  f regex else Non
-0000f350: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000f360: 2020 656c 656d 7320 3d20 746f 705f 656c    elems = top_el
-0000f370: 656d 2e78 7061 7468 2878 7061 7468 290a  em.xpath(xpath).
-0000f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f390: 666f 7220 656c 656d 2069 6e20 656c 656d  for elem in elem
-0000f3a0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0000f3b0: 2020 2020 2020 2074 6578 7420 3d20 4874         text = Ht
-0000f3c0: 6d6c 5574 696c 2e67 6574 5f74 6578 745f  mlUtil.get_text_
-0000f3d0: 636f 6e74 656e 7428 656c 656d 290a 2020  content(elem).  
-0000f3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f3f0: 2020 6d61 7463 6865 6420 3d20 7265 6765    matched = rege
-0000f400: 785f 636f 6d70 2e73 6561 7263 6828 7465  x_comp.search(te
-0000f410: 7874 2920 6966 2072 6567 6578 5f63 6f6d  xt) if regex_com
-0000f420: 7020 656c 7365 2054 7275 650a 2020 2020  p else True.    
-0000f430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f440: 6966 206d 6174 6368 6564 3a0a 2020 2020  if matched:.    
-0000f450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f460: 2020 2020 636c 732e 7265 6d6f 7665 5f65      cls.remove_e
-0000f470: 6c65 6d5f 6b65 6570 5f74 6169 6c28 656c  lem_keep_tail(el
-0000f480: 656d 290a 0a20 2020 2040 636c 6173 736d  em)..    @classm
-0000f490: 6574 686f 640a 2020 2020 6465 6620 7265  ethod.    def re
-0000f4a0: 6d6f 7665 5f6e 6577 6c69 6e65 7328 636c  move_newlines(cl
-0000f4b0: 732c 2065 6c65 6d29 3a0a 2020 2020 2020  s, elem):.      
-0000f4c0: 2020 2222 2272 656d 6f76 6520 5c6e 2222    """remove \n""
-0000f4d0: 220a 2020 2020 2020 2020 2222 220a 2020  ".        """.  
-0000f4e0: 2020 2020 2020 4d61 7962 6520 6d6f 7665        Maybe move
-0000f4f0: 2074 6f20 4854 4d4c 5469 6479 0a20 2020   to HTMLTidy.   
-0000f500: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0000f510: 2020 666f 7220 656c 2069 6e20 656c 656d    for el in elem
-0000f520: 2e78 7061 7468 2822 2e2f 2f2a 5b6e 6f74  .xpath(".//*[not
-0000f530: 282a 295d 2229 3a0a 2020 2020 2020 2020  (*)]"):.        
-0000f540: 2020 2020 7465 7874 203d 2048 746d 6c55      text = HtmlU
-0000f550: 7469 6c2e 6765 745f 7465 7874 5f63 6f6e  til.get_text_con
-0000f560: 7465 6e74 2865 6c29 0a20 2020 2020 2020  tent(el).       
-0000f570: 2020 2020 2074 6578 7431 203d 2074 6578       text1 = tex
-0000f580: 742e 7265 706c 6163 6528 275c 6e27 2c20  t.replace('\n', 
-0000f590: 2727 290a 2020 2020 2020 2020 2020 2020  '').            
-0000f5a0: 6966 2074 6578 7431 2021 3d20 7465 7874  if text1 != text
-0000f5b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000f5c0: 2020 656c 2e74 6578 7420 3d20 7465 7874    el.text = text
-0000f5d0: 310a 0a20 2020 2040 636c 6173 736d 6574  1..    @classmet
-0000f5e0: 686f 640a 2020 2020 6465 6620 7265 6d6f  hod.    def remo
-0000f5f0: 7665 5f73 7479 6c65 2863 6c73 2c20 7870  ve_style(cls, xp
-0000f600: 6174 685f 726f 6f74 5f65 6c65 6d2c 206e  ath_root_elem, n
-0000f610: 616d 6573 293a 0a20 2020 2020 2020 2022  ames):.        "
-0000f620: 2222 0a20 2020 2020 2020 2072 656d 6f76  "".        remov
-0000f630: 6573 206e 616d 652d 7661 6c75 6520 7061  es name-value pa
-0000f640: 6972 7320 6672 6f6d 2063 7373 2d73 7479  irs from css-sty
-0000f650: 6c65 2061 6e64 2072 6561 7070 6c79 2074  le and reapply t
-0000f660: 6f20 7870 6174 6827 6564 2065 6c65 6d65  o xpath'ed eleme
-0000f670: 6e74 7322 2222 0a20 2020 2020 2020 2022  nts""".        "
-0000f680: 2222 0a20 2020 2020 2020 204d 6179 6265  "".        Maybe
-0000f690: 206d 6f76 6520 746f 2048 544d 4c54 6964   move to HTMLTid
-0000f6a0: 790a 2020 2020 2020 2020 2222 220a 0a20  y.        """.. 
-0000f6b0: 2020 2020 2020 2078 7061 7468 203d 2066         xpath = f
-0000f6c0: 222e 2f2f 2a5b 4073 7479 6c65 5d22 0a20  ".//*[@style]". 
-0000f6d0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000f6e0: 2020 2020 2020 2020 7374 796c 6564 5f65          styled_e
-0000f6f0: 6c65 6d73 203d 2078 7061 7468 5f72 6f6f  lems = xpath_roo
-0000f700: 745f 656c 656d 2e78 7061 7468 2878 7061  t_elem.xpath(xpa
-0000f710: 7468 290a 2020 2020 2020 2020 6578 6365  th).        exce
-0000f720: 7074 2045 542e 5850 6174 6845 7661 6c45  pt ET.XPathEvalE
-0000f730: 7272 6f72 2061 7320 7870 6565 3a0a 2020  rror as xpee:.  
-0000f740: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000f750: 5661 6c75 6545 7272 6f72 2866 2242 6164  ValueError(f"Bad
-0000f760: 2078 7061 7468 207b 7870 6174 687d 2229   xpath {xpath}")
-0000f770: 0a0a 2020 2020 2020 2020 666f 7220 7374  ..        for st
-0000f780: 796c 6564 5f65 6c65 6d20 696e 2073 7479  yled_elem in sty
-0000f790: 6c65 645f 656c 656d 733a 0a20 2020 2020  led_elems:.     
-0000f7a0: 2020 2020 2020 2063 7373 5f73 7479 6c65         css_style
-0000f7b0: 203d 2043 5353 5374 796c 652e 6372 6561   = CSSStyle.crea
-0000f7c0: 7465 5f63 7373 5f73 7479 6c65 5f66 726f  te_css_style_fro
-0000f7d0: 6d5f 6174 7472 6962 7574 655f 6f66 5f62  m_attribute_of_b
-0000f7e0: 6f64 795f 656c 656d 656e 7428 7374 796c  ody_element(styl
-0000f7f0: 6564 5f65 6c65 6d29 0a20 2020 2020 2020  ed_elem).       
-0000f800: 2020 2020 2063 7373 5f73 7479 6c65 2e72       css_style.r
-0000f810: 656d 6f76 6528 6e61 6d65 7329 0a20 2020  emove(names).   
-0000f820: 2020 2020 2020 2020 2063 7373 5f73 7479           css_sty
-0000f830: 6c65 2e61 7070 6c79 5f74 6f28 7374 796c  le.apply_to(styl
-0000f840: 6564 5f65 6c65 6d29 0a20 2020 2020 2020  ed_elem).       
-0000f850: 2020 2020 2073 7479 6c65 203d 2048 746d       style = Htm
-0000f860: 6c53 7479 6c65 2e67 6574 5f63 7373 7374  lStyle.get_cssst
-0000f870: 796c 655f 7374 7269 6e67 2873 7479 6c65  yle_string(style
-0000f880: 645f 656c 656d 290a 0a20 2020 2040 636c  d_elem)..    @cl
-0000f890: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-0000f8a0: 6620 6578 7472 6163 745f 7375 6273 7472  f extract_substr
-0000f8b0: 696e 6773 2863 6c73 2c20 656c 656d 2c20  ings(cls, elem, 
-0000f8c0: 7870 6174 683d 4e6f 6e65 2c20 7265 6765  xpath=None, rege
-0000f8d0: 783d 4e6f 6e65 2c20 7265 6d6f 7665 3d46  x=None, remove=F
-0000f8e0: 616c 7365 2c20 696e 636c 7564 655f 6e6f  alse, include_no
-0000f8f0: 6e65 3d46 616c 7365 2c20 6164 645f 6964  ne=False, add_id
-0000f900: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-0000f910: 2022 2222 6765 7473 2073 7562 7374 7269   """gets substri
-0000f920: 6e67 2066 726f 6d20 626f 6479 206f 6620  ng from body of 
-0000f930: 7465 7874 2069 6e20 656c 656d 0a20 2020  text in elem.   
-0000f940: 2020 2020 2072 6567 6578 206f 6620 666f       regex of fo
-0000f950: 726d 2028 3f50 3c70 7265 3e29 283f 503c  rm (?P<pre>)(?P<
-0000f960: 626f 6479 3e29 283f 503c 706f 7374 3e29  body>)(?P<post>)
-0000f970: 0a20 2020 2020 2020 2070 7265 2061 6e64  .        pre and
-0000f980: 206f 7220 706f 7374 2063 616e 2062 6520   or post can be 
-0000f990: 6d69 7373 696e 670a 2020 2020 2020 2020  missing.        
-0000f9a0: 2854 6865 7265 2077 696c 6c20 6265 2062  (There will be b
-0000f9b0: 6574 7465 7220 7761 7973 206f 6620 646f  etter ways of do
-0000f9c0: 696e 6720 7468 6973 2129 0a20 2020 2020  ing this!).     
-0000f9d0: 2020 203a 7061 7261 6d20 656c 656d 3a74     :param elem:t
-0000f9e0: 6f20 7175 6572 790a 2020 2020 2020 2020  o query.        
-0000f9f0: 3a70 6172 616d 2078 7061 7468 3a20 746f  :param xpath: to
-0000fa00: 2066 696e 6420 6465 7363 656e 6461 6e74   find descendant
-0000fa10: 2073 7562 656c 656d 656e 740a 2020 2020   subelement.    
-0000fa20: 2020 2020 3a70 6172 616d 2072 6567 6578      :param regex
-0000fa30: 3a20 746f 2066 696e 6420 7374 7269 6e67  : to find string
-0000fa40: 2069 6e20 7375 6265 6c65 6d65 6e74 2028   in subelement (
-0000fa50: 6d75 7374 2068 6176 6520 3320 6361 7074  must have 3 capt
-0000fa60: 7572 6520 6772 6f75 7073 290a 2020 2020  ure groups).    
-0000fa70: 2020 2020 3a70 6172 616d 2072 656d 6f76      :param remov
-0000fa80: 653a 2072 656d 6f76 6573 2062 6f64 7920  e: removes body 
-0000fa90: 7465 7874 2061 6e64 206a 6f69 6e73 2070  text and joins p
-0000faa0: 7265 2074 6f20 706f 7374 2028 7573 6520  re to post (use 
-0000fab0: 7769 7468 2063 6172 652c 2064 6566 6175  with care, defau
-0000fac0: 6c74 2046 616c 7365 290a 2020 2020 2020  lt False).      
-0000fad0: 2020 3a70 6172 616d 2069 6e63 6c75 6465    :param include
-0000fae0: 5f6e 6f6e 653a 2049 6620 7472 7565 2069  _none: If true i
-0000faf0: 6e63 6c75 6465 2066 6169 6c65 6420 6d61  nclude failed ma
-0000fb00: 7463 6865 7320 6173 204e 6f6e 653b 2064  tches as None; d
-0000fb10: 6566 6175 6c74 2046 616c 7365 0a20 2020  efault False.   
-0000fb20: 2020 2020 203a 7061 7261 6d5f 6164 645f       :param_add_
-0000fb30: 6964 3a20 6164 6420 6578 7472 6163 7465  id: add extracte
-0000fb40: 6420 7465 7874 2061 7320 6174 7472 6962  d text as attrib
-0000fb50: 7574 6520 6f6e 2073 7562 656c 656d 656e  ute on subelemen
-0000fb60: 740a 2020 2020 2020 2020 6966 2070 7265  t.        if pre
-0000fb70: 2061 6e64 2074 6169 6c20 6172 6520 7072   and tail are pr
-0000fb80: 6573 656e 742c 2065 6c65 6d2e 7465 7874  esent, elem.text
-0000fb90: 203d 3c20 7072 652b 706f 7374 0a20 2020   =< pre+post.   
-0000fba0: 2020 2020 2069 6620 7072 6520 6973 206d       if pre is m
-0000fbb0: 6973 7369 6e67 2065 6c65 6d2e 7465 7874  issing elem.text
-0000fbc0: 203d 3e20 706f 7374 0a20 2020 2020 2020   => post.       
-0000fbd0: 2069 6620 7461 696c 2069 7320 6d69 7373   if tail is miss
-0000fbe0: 696e 6720 656c 656d 2e74 6578 7420 3d3e  ing elem.text =>
-0000fbf0: 2070 7265 0a20 2020 2020 2020 2069 6620   pre.        if 
-0000fc00: 626f 7468 2061 7265 206d 6973 7369 6e67  both are missing
-0000fc10: 206e 6f20 7265 6d6f 7661 6c0a 2020 2020   no removal.    
-0000fc20: 2020 2020 3a72 6574 7572 6e3a 2072 6567      :return: reg
-0000fc30: 6578 2e6d 6174 6368 2e67 726f 7570 696e  ex.match.groupin
-0000fc40: 6465 7828 3f50 3c62 6f64 793e 2920 6966  dex(?P<body>) if
-0000fc50: 206d 6174 6368 6564 2065 6c73 6520 4e6f   matched else No
-0000fc60: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
-0000fc70: 2020 2020 2020 2073 7562 5f65 6c65 6d73         sub_elems
-0000fc80: 203d 2065 6c65 6d2e 7870 6174 6828 7870   = elem.xpath(xp
-0000fc90: 6174 6829 0a20 2020 2020 2020 2073 7562  ath).        sub
-0000fca0: 5f65 6c65 6d20 3d20 7375 625f 656c 656d  _elem = sub_elem
-0000fcb0: 735b 305d 2069 6620 6c65 6e28 7375 625f  s[0] if len(sub_
-0000fcc0: 656c 656d 7329 203e 2030 2065 6c73 6520  elems) > 0 else 
-0000fcd0: 4e6f 6e65 0a20 2020 2020 2020 2073 7562  None.        sub
-0000fce0: 7374 7269 6e67 7320 3d20 5b5d 0a20 2020  strings = [].   
-0000fcf0: 2020 2020 2072 6530 203d 2072 652e 636f       re0 = re.co
-0000fd00: 6d70 696c 6528 7265 6765 7829 0a20 2020  mpile(regex).   
-0000fd10: 2020 2020 2066 6f72 2073 7562 5f65 6c65       for sub_ele
-0000fd20: 6d20 696e 2073 7562 5f65 6c65 6d73 3a0a  m in sub_elems:.
-0000fd30: 2020 2020 2020 2020 2020 2020 7375 6273              subs
-0000fd40: 7472 696e 6720 3d20 636c 732e 6578 7472  tring = cls.extr
-0000fd50: 6163 745f 7375 6273 7472 696e 6728 7265  act_substring(re
-0000fd60: 302c 2072 656d 6f76 652c 2073 7562 5f65  0, remove, sub_e
-0000fd70: 6c65 6d29 0a20 2020 2020 2020 2020 2020  lem).           
-0000fd80: 2069 6620 7375 6273 7472 696e 6720 616e   if substring an
-0000fd90: 6420 6164 645f 6964 3a0a 2020 2020 2020  d add_id:.      
-0000fda0: 2020 2020 2020 2020 2020 7375 625f 656c            sub_el
-0000fdb0: 656d 2e61 7474 7269 625b 2269 6422 5d20  em.attrib["id"] 
-0000fdc0: 3d20 7375 6273 7472 696e 670a 2020 2020  = substring.    
-0000fdd0: 2020 2020 2020 2020 6966 2073 7562 7374          if subst
-0000fde0: 7269 6e67 206f 7220 696e 636c 7564 655f  ring or include_
-0000fdf0: 6e6f 6e65 3a0a 2020 2020 2020 2020 2020  none:.          
-0000fe00: 2020 2020 2020 7375 6273 7472 696e 6773        substrings
-0000fe10: 2e61 7070 656e 6428 7375 6273 7472 696e  .append(substrin
-0000fe20: 6729 0a20 2020 2020 2020 2072 6574 7572  g).        retur
-0000fe30: 6e20 7375 6273 7472 696e 6773 0a0a 2020  n substrings..  
-0000fe40: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-0000fe50: 2020 2064 6566 2065 7874 7261 6374 5f73     def extract_s
-0000fe60: 7562 7374 7269 6e67 2863 6c73 2c20 7265  ubstring(cls, re
-0000fe70: 302c 2072 656d 6f76 652c 2073 7562 5f65  0, remove, sub_e
-0000fe80: 6c65 6d29 3a0a 2020 2020 2020 2020 6d61  lem):.        ma
-0000fe90: 7463 6820 3d20 7265 302e 6d61 7463 6828  tch = re0.match(
-0000fea0: 7375 625f 656c 656d 2e74 6578 7429 0a20  sub_elem.text). 
-0000feb0: 2020 2020 2020 2073 7562 7374 7269 6e67         substring
-0000fec0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-0000fed0: 6966 206d 6174 6368 3a0a 2020 2020 2020  if match:.      
-0000fee0: 2020 2020 2020 7375 6273 7472 696e 6720        substring 
-0000fef0: 3d20 6d61 7463 682e 6772 6f75 7028 2262  = match.group("b
-0000ff00: 6f64 7922 290a 2020 2020 2020 2020 2020  ody").          
-0000ff10: 2020 6966 2072 656d 6f76 653a 0a20 2020    if remove:.   
-0000ff20: 2020 2020 2020 2020 2020 2020 2074 7279               try
-0000ff30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000ff40: 2020 2020 2020 7072 6520 3d20 6d61 7463        pre = matc
-0000ff50: 682e 6772 6f75 7028 2270 7265 2229 0a20  h.group("pre"). 
-0000ff60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ff70: 2020 2070 6f73 7420 3d20 6d61 7463 682e     post = match.
-0000ff80: 6772 6f75 7028 2270 6f73 7422 290a 2020  group("post").  
-0000ff90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ffa0: 2020 7375 625f 656c 656d 2e74 6578 7420    sub_elem.text 
-0000ffb0: 3d20 7072 6520 2b20 706f 7374 0a20 2020  = pre + post.   
-0000ffc0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-0000ffd0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
-0000ffe0: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-0000fff0: 2020 2020 2020 7265 7475 726e 2073 7562        return sub
-00010000: 7374 7269 6e67 0a0a 2020 2020 4063 6c61  string..    @cla
-00010010: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00010020: 2067 6574 5f66 6c6f 6174 2863 6c73 2c20   get_float(cls, 
-00010030: 656c 656d 2c20 6174 7472 6962 5f6e 616d  elem, attrib_nam
-00010040: 6529 3a0a 2020 2020 2020 2020 7472 793a  e):.        try:
-00010050: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00010060: 203d 2065 6c65 6d2e 6174 7472 6962 5b61   = elem.attrib[a
-00010070: 7474 7269 625f 6e61 6d65 5d0a 2020 2020  ttrib_name].    
-00010080: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-00010090: 6c6f 6174 2876 616c 290a 2020 2020 2020  loat(val).      
-000100a0: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-000100b0: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-000100c0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-000100d0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-000100e0: 6f64 0a20 2020 2064 6566 2063 6865 636b  od.    def check
-000100f0: 5f74 6167 2863 6c73 2c20 656c 656d 2c20  _tag(cls, elem, 
-00010100: 7461 6729 3a0a 2020 2020 2020 2020 2222  tag):.        ""
-00010110: 2263 6865 636b 7320 7468 6174 2065 6c65  "checks that ele
-00010120: 6d20 6973 2061 6e20 456c 656d 656e 7420  m is an Element 
-00010130: 7769 7468 2067 6976 656e 2074 6167 2222  with given tag""
-00010140: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
-00010150: 2074 7970 6528 656c 656d 2920 6973 2045   type(elem) is E
-00010160: 542e 5f45 6c65 6d65 6e74 2061 6e64 2065  T._Element and e
-00010170: 6c65 6d2e 7461 6720 3d3d 2074 6167 0a0a  lem.tag == tag..
-00010180: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00010190: 0a20 2020 2064 6566 2067 6574 5f69 6428  .    def get_id(
-000101a0: 636c 732c 2064 6976 293a 0a20 2020 2020  cls, div):.     
-000101b0: 2020 2022 2222 6765 7473 2076 616c 7565     """gets value
-000101c0: 206f 6620 2269 6422 2061 7474 7269 6275   of "id" attribu
-000101d0: 7465 0a20 2020 2020 2020 2022 2222 0a20  te.        """. 
-000101e0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-000101f0: 6e65 2069 6620 6469 7620 6973 204e 6f6e  ne if div is Non
-00010200: 6520 656c 7365 2064 6976 2e61 7474 7269  e else div.attri
-00010210: 622e 6765 7428 2269 6422 290a 0a20 2020  b.get("id")..   
-00010220: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00010230: 2020 6465 6620 616e 616c 797a 655f 7374    def analyze_st
-00010240: 796c 6573 2863 6c73 2c20 656c 656d 293a  yles(cls, elem):
-00010250: 0a20 2020 2020 2020 2068 6561 645f 7374  .        head_st
-00010260: 796c 655f 656c 656d 7320 3d20 4874 6d6c  yle_elems = Html
-00010270: 5374 796c 652e 6765 745f 6865 6164 5f73  Style.get_head_s
-00010280: 7479 6c65 7328 656c 656d 290a 2020 2020  tyles(elem).    
-00010290: 2020 2020 7072 696e 7428 6622 6865 6164      print(f"head
-000102a0: 2073 7479 6c65 2065 6c65 6d73 207b 6c65   style elems {le
-000102b0: 6e28 6865 6164 5f73 7479 6c65 5f65 6c65  n(head_style_ele
-000102c0: 6d73 297d 2229 0a20 2020 2020 2020 2062  ms)}").        b
-000102d0: 6f64 795f 636c 6173 7372 6566 7320 3d20  ody_classrefs = 
-000102e0: 4874 6d6c 5374 796c 652e 6765 745f 626f  HtmlStyle.get_bo
-000102f0: 6479 5f63 6c61 7373 7265 6673 2865 6c65  dy_classrefs(ele
-00010300: 6d29 0a20 2020 2020 2020 2070 7269 6e74  m).        print
-00010310: 2866 2262 6f64 7920 636c 6173 7372 6566  (f"body classref
-00010320: 7320 7b6c 656e 2862 6f64 795f 636c 6173  s {len(body_clas
-00010330: 7372 6566 7329 7d22 290a 2020 2020 2020  srefs)}").      
-00010340: 2020 666f 6e74 5f73 697a 655f 6469 6374    font_size_dict
-00010350: 203d 2064 6566 6175 6c74 6469 6374 286c   = defaultdict(l
-00010360: 6973 7429 0a20 2020 2020 2020 2066 616d  ist).        fam
-00010370: 696c 795f 6469 6374 203d 2064 6566 6175  ily_dict = defau
-00010380: 6c74 6469 6374 286c 6973 7429 0a20 2020  ltdict(list).   
-00010390: 2020 2020 2066 6f72 2068 6561 645f 7374       for head_st
-000103a0: 796c 655f 656c 656d 2069 6e20 6865 6164  yle_elem in head
-000103b0: 5f73 7479 6c65 5f65 6c65 6d73 3a0a 2020  _style_elems:.  
-000103c0: 2020 2020 2020 2020 2020 6865 6164 5f73            head_s
-000103d0: 7479 6c65 2c20 6373 7373 7472 203d 2048  tyle, cssstr = H
-000103e0: 746d 6c53 7479 6c65 2e65 7874 7261 6374  tmlStyle.extract
-000103f0: 5f63 6c61 7373 7265 665f 616e 645f 6373  _classref_and_cs
-00010400: 7373 7472 696e 675f 6672 6f6d 5f68 746d  sstring_from_htm
-00010410: 6c5f 7374 796c 6528 6865 6164 5f73 7479  l_style(head_sty
-00010420: 6c65 5f65 6c65 6d29 0a20 2020 2020 2020  le_elem).       
-00010430: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
-00010440: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
-00010450: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
-00010460: 6373 735f 7374 7269 6e67 2863 7373 7374  css_string(cssst
-00010470: 7229 0a20 2020 2020 2020 2020 2020 2066  r).            f
-00010480: 6f6e 745f 7369 7a65 203d 2063 7373 5f73  ont_size = css_s
-00010490: 7479 6c65 2e66 6f6e 745f 7369 7a65 0a20  tyle.font_size. 
-000104a0: 2020 2020 2020 2020 2020 2066 6f6e 745f             font_
-000104b0: 7369 7a65 5f64 6963 745b 7374 7228 666f  size_dict[str(fo
-000104c0: 6e74 5f73 697a 6529 5d2e 6170 7065 6e64  nt_size)].append
-000104d0: 2863 7373 7374 7229 0a20 2020 2020 2020  (cssstr).       
-000104e0: 2020 2020 2066 6f6e 745f 6661 6d69 6c79       font_family
-000104f0: 203d 2063 7373 5f73 7479 6c65 2e66 6f6e   = css_style.fon
-00010500: 745f 6661 6d69 6c79 0a20 2020 2020 2020  t_family.       
-00010510: 2020 2020 2066 616d 696c 795f 6469 6374       family_dict
-00010520: 5b66 6f6e 745f 6661 6d69 6c79 5d2e 6170  [font_family].ap
-00010530: 7065 6e64 2863 7373 7374 7229 0a0a 2020  pend(cssstr)..  
-00010540: 2020 2020 2020 2020 2020 626f 6479 5f65            body_e
-00010550: 6c65 6d73 203d 2063 6c73 2e67 6574 5f62  lems = cls.get_b
-00010560: 6f64 795f 656c 656d 656e 7473 5f62 795f  ody_elements_by_
-00010570: 636c 6173 7328 656c 656d 2c20 6865 6164  class(elem, head
-00010580: 5f73 7479 6c65 290a 2020 2020 2020 2020  _style).        
-00010590: 2020 2020 626f 6479 5f65 6c65 6d73 5f73      body_elems_s
-000105a0: 7472 203d 2027 5c6e 2020 2020 2027 2e6a  tr = '\n     '.j
-000105b0: 6f69 6e28 5b65 6c65 6d2e 7465 7874 2066  oin([elem.text f
-000105c0: 6f72 2065 6c65 6d20 696e 2062 6f64 795f  or elem in body_
-000105d0: 656c 656d 735b 3a33 5d5d 290a 2020 2020  elems[:3]]).    
-000105e0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-000105f0: 7b68 6561 645f 7374 796c 657d 3a20 7b6c  {head_style}: {l
-00010600: 656e 2862 6f64 795f 656c 656d 7329 7d20  en(body_elems)} 
-00010610: 7b63 7373 7374 727d 5c6e 2020 2020 207b  {cssstr}\n     {
-00010620: 626f 6479 5f65 6c65 6d73 5f73 7472 7d22  body_elems_str}"
-00010630: 290a 2020 2020 2020 2020 7070 7269 6e74  ).        pprint
-00010640: 2866 2273 697a 6520 7b66 6f6e 745f 7369  (f"size {font_si
-00010650: 7a65 5f64 6963 747d 2229 0a20 2020 2020  ze_dict}").     
-00010660: 2020 2070 7269 6e74 2829 0a20 2020 2020     print().     
-00010670: 2020 2066 6f72 2073 697a 6520 696e 2066     for size in f
-00010680: 6f6e 745f 7369 7a65 5f64 6963 743a 0a20  ont_size_dict:. 
-00010690: 2020 2020 2020 2020 2020 2066 6f6e 7473             fonts
-000106a0: 203d 2066 6f6e 745f 7369 7a65 5f64 6963   = font_size_dic
-000106b0: 745b 7369 7a65 5d0a 2020 2020 2020 2020  t[size].        
-000106c0: 2020 2020 6966 2074 7970 6528 666f 6e74      if type(font
-000106d0: 7329 2069 7320 6c69 7374 3a0a 2020 2020  s) is list:.    
-000106e0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-000106f0: 7428 6622 7369 7a65 207b 6c65 6e28 666f  t(f"size {len(fo
-00010700: 6e74 7329 7d20 2229 0a20 2020 2020 2020  nts)} ").       
-00010710: 2020 2020 2020 2020 2066 6f6e 7473 7a20           fontsz 
-00010720: 3d20 275c 6e27 2e6a 6f69 6e28 666f 6e74  = '\n'.join(font
-00010730: 7329 0a20 2020 2020 2020 2020 2020 2065  s).            e
-00010740: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00010750: 2020 2020 2066 6f6e 7473 7a20 3d20 666f       fontsz = fo
-00010760: 6e74 730a 2020 2020 2020 2020 2020 2020  nts.            
-00010770: 7072 696e 7428 6622 2020 7b73 697a 657d  print(f"  {size}
-00010780: 203d 3e20 207b 666f 6e74 737a 7d22 290a   =>  {fontsz}").
-00010790: 2020 2020 2020 2020 7072 696e 7428 290a          print().
-000107a0: 2020 2020 2020 2020 7070 7269 6e74 2866          pprint(f
-000107b0: 2266 616d 696c 7920 7b66 616d 696c 795f  "family {family_
-000107c0: 6469 6374 7d22 290a 0a20 2020 2040 636c  dict}")..    @cl
-000107d0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-000107e0: 6620 616e 616c 797a 655f 636f 6f72 6469  f analyze_coordi
-000107f0: 6e61 7465 7328 636c 732c 2065 6c65 6d29  nates(cls, elem)
-00010800: 3a0a 2020 2020 2020 2020 2320 6865 6164  :.        # head
-00010810: 5f73 7479 6c65 5f65 6c65 6d73 203d 2048  _style_elems = H
-00010820: 746d 6c53 7479 6c65 2e67 6574 5f68 6561  tmlStyle.get_hea
-00010830: 645f 7374 796c 6573 2865 6c65 6d29 0a20  d_styles(elem). 
-00010840: 2020 2020 2020 2023 2070 7269 6e74 2866         # print(f
-00010850: 2268 6561 6420 7374 796c 6520 656c 656d  "head style elem
-00010860: 7320 7b6c 656e 2868 6561 645f 7374 796c  s {len(head_styl
-00010870: 655f 656c 656d 7329 7d22 290a 2020 2020  e_elems)}").    
-00010880: 2020 2020 2320 626f 6479 5f73 7479 6c65      # body_style
-00010890: 7320 3d20 4874 6d6c 5374 796c 652e 6765  s = HtmlStyle.ge
-000108a0: 745f 626f 6479 5f63 6c61 7373 7265 6673  t_body_classrefs
-000108b0: 2865 6c65 6d29 0a20 2020 2020 2020 2023  (elem).        #
-000108c0: 2070 7269 6e74 2866 2262 6f64 7920 7374   print(f"body st
-000108d0: 796c 6573 207b 6c65 6e28 626f 6479 5f73  yles {len(body_s
-000108e0: 7479 6c65 7329 7d22 290a 2020 2020 2020  tyles)}").      
-000108f0: 2020 6d61 7863 6861 7220 3d20 3530 0a0a    maxchar = 50..
-00010900: 2020 2020 2020 2020 636c 732e 6765 745f          cls.get_
-00010910: 6c72 7462 2865 6c65 6d2c 2022 6c65 6674  lrtb(elem, "left
-00010920: 2229 0a20 2020 2020 2020 2063 6c73 2e67  ").        cls.g
-00010930: 6574 5f6c 7274 6228 656c 656d 2c20 2272  et_lrtb(elem, "r
-00010940: 6967 6874 2229 0a20 2020 2020 2020 2063  ight").        c
-00010950: 6c73 2e67 6574 5f6c 7274 6228 656c 656d  ls.get_lrtb(elem
-00010960: 2c20 2279 3022 2c20 636f 6c3d 3029 0a20  , "y0", col=0). 
-00010970: 2020 2020 2020 2063 6c73 2e67 6574 5f6c         cls.get_l
-00010980: 7274 6228 656c 656d 2c20 2274 6f70 222c  rtb(elem, "top",
-00010990: 206d 6172 6769 6e3d 3830 290a 0a20 2020   margin=80)..   
-000109a0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-000109b0: 2020 6465 6620 6765 745f 6c72 7462 2863    def get_lrtb(c
-000109c0: 6c73 2c20 656c 656d 2c20 6469 7265 6374  ls, elem, direct
-000109d0: 696f 6e2c 206d 6178 6368 6172 3d35 302c  ion, maxchar=50,
-000109e0: 206d 696e 5f63 6f75 6e74 3d31 302c 206d   min_count=10, m
-000109f0: 6178 5f74 6578 7473 3d33 2c20 6d61 7267  ax_texts=3, marg
-00010a00: 696e 3d38 302c 206d 6564 6961 626f 783d  in=80, mediabox=
-00010a10: 5b5b 302c 3130 3030 5d2c 205b 302c 3130  [[0,1000], [0,10
-00010a20: 3030 5d5d 2c20 636f 6c3d 3120 293a 0a20  00]], col=1 ):. 
-00010a30: 2020 2020 2020 2065 6c65 6d73 203d 2048         elems = H
-00010a40: 746d 6c4c 6962 2e67 6574 5f62 6f64 7928  tmlLib.get_body(
-00010a50: 656c 656d 292e 7870 6174 6828 6622 2e2f  elem).xpath(f"./
-00010a60: 2f2a 5b40 7b64 6972 6563 7469 6f6e 7d5d  /*[@{direction}]
-00010a70: 2229 0a20 2020 2020 2020 2064 6963 7478  ").        dictx
-00010a80: 203d 2064 6566 6175 6c74 6469 6374 286c   = defaultdict(l
-00010a90: 6973 7429 0a20 2020 2020 2020 2066 6f72  ist).        for
-00010aa0: 2065 6c65 6d20 696e 2065 6c65 6d73 3a0a   elem in elems:.
-00010ab0: 2020 2020 2020 2020 2020 2020 6c65 6674              left
-00010ac0: 203d 2048 746d 6c55 7469 6c2e 6765 745f   = HtmlUtil.get_
-00010ad0: 666c 6f61 7428 656c 656d 2c20 6469 7265  float(elem, dire
-00010ae0: 6374 696f 6e29 0a20 2020 2020 2020 2020  ction).         
-00010af0: 2020 2069 6620 6c65 6674 3a0a 2020 2020     if left:.    
-00010b00: 2020 2020 2020 2020 2020 2020 6469 6374              dict
-00010b10: 785b 6c65 6674 5d2e 6170 7065 6e64 2865  x[left].append(e
-00010b20: 6c65 6d29 0a20 2020 2020 2020 2070 7269  lem).        pri
-00010b30: 6e74 2866 225c 6e7b 6469 7265 6374 696f  nt(f"\n{directio
-00010b40: 6e7d 2229 0a20 2020 2020 2020 2072 6f77  n}").        row
-00010b50: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
-00010b60: 6f72 206b 6579 2069 6e20 6469 6374 782e  or key in dictx.
-00010b70: 6b65 7973 2829 3a0a 2020 2020 2020 2020  keys():.        
-00010b80: 2020 2020 656c 656d 7320 3d20 6469 6374      elems = dict
-00010b90: 785b 6b65 795d 0a20 2020 2020 2020 2020  x[key].         
-00010ba0: 2020 2074 6578 7473 203d 205b 656c 656d     texts = [elem
-00010bb0: 2e78 7061 7468 2822 2e2f 2f74 6578 7428  .xpath(".//text(
-00010bc0: 2922 295b 305d 5b3a 6d61 7863 6861 725d  )")[0][:maxchar]
-00010bd0: 2066 6f72 2065 6c65 6d20 696e 2065 6c65   for elem in ele
-00010be0: 6d73 5d0a 2020 2020 2020 2020 2020 2020  ms].            
-00010bf0: 656c 656d 636f 756e 7420 3d20 6c65 6e28  elemcount = len(
-00010c00: 656c 656d 7329 0a20 2020 2020 2020 2020  elems).         
-00010c10: 2020 2069 6620 656c 656d 636f 756e 7420     if elemcount 
-00010c20: 3e20 6d69 6e5f 636f 756e 743a 0a20 2020  > min_count:.   
-00010c30: 2020 2020 2020 2020 2020 2020 2074 6578               tex
-00010c40: 7473 5f20 3d20 7465 7874 735b 3a6d 6178  ts_ = texts[:max
-00010c50: 5f74 6578 7473 5d0a 2020 2020 2020 2020  _texts].        
-00010c60: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-00010c70: 7b6b 6579 7d3a 207b 656c 656d 636f 756e  {key}: {elemcoun
-00010c80: 747d 207b 7465 7874 735f 7d22 290a 2020  t} {texts_}").  
-00010c90: 2020 2020 2020 2020 2020 2020 2020 726f                ro
-00010ca0: 7773 2e61 7070 656e 6428 5b6b 6579 2c20  ws.append([key, 
-00010cb0: 656c 656d 636f 756e 742c 2074 6578 7473  elemcount, texts
-00010cc0: 5f5d 290a 2020 2020 2020 2020 726f 7773  _]).        rows
-00010cd0: 5f20 3d20 736f 7274 6564 2872 6f77 732c  _ = sorted(rows,
-00010ce0: 206b 6579 3d6c 616d 6264 6120 633a 2063   key=lambda c: c
-00010cf0: 5b63 6f6c 5d29 0a20 2020 2020 2020 2070  [col]).        p
-00010d00: 7269 6e74 2866 2272 6f77 735c 6e7b 726f  rint(f"rows\n{ro
-00010d10: 7773 5f7d 2229 0a0a 2020 2020 2020 2020  ws_}")..        
-00010d20: 2020 2020 2020 2020 2320 736f 7274 6564          # sorted
-00010d30: 2873 7475 6465 6e74 5f74 7570 6c65 732c  (student_tuples,
-00010d40: 206b 6579 3d6c 616d 6264 6120 7374 7564   key=lambda stud
-00010d50: 656e 743a 2073 7475 6465 6e74 5b32 5d29  ent: student[2])
-00010d60: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00010d70: 6f64 0a20 2020 2064 6566 2067 6574 5f62  od.    def get_b
-00010d80: 6f64 795f 656c 656d 656e 7473 5f62 795f  ody_elements_by_
-00010d90: 636c 6173 7328 636c 732c 2065 6c65 6d2c  class(cls, elem,
-00010da0: 2068 6561 645f 7374 796c 6529 3a0a 2020   head_style):.  
-00010db0: 2020 2020 2020 6966 2068 6561 645f 7374        if head_st
-00010dc0: 796c 652e 7374 6172 7473 7769 7468 2827  yle.startswith('
-00010dd0: 2e27 293a 0a20 2020 2020 2020 2020 2020  .'):.           
-00010de0: 2068 6561 645f 7374 796c 6520 3d20 6865   head_style = he
-00010df0: 6164 5f73 7479 6c65 5b31 3a5d 0a20 2020  ad_style[1:].   
-00010e00: 2020 2020 2062 6f64 795f 656c 656d 7320       body_elems 
-00010e10: 3d20 656c 656d 2e78 7061 7468 2866 222e  = elem.xpath(f".
-00010e20: 2f62 6f64 792f 2f2a 5b40 636c 6173 733d  /body//*[@class=
-00010e30: 277b 6865 6164 5f73 7479 6c65 7d27 5d22  '{head_style}']"
-00010e40: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00010e50: 2062 6f64 795f 656c 656d 730a 0a20 2020   body_elems..   
-00010e60: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00010e70: 2020 6465 6620 636c 6561 6e5f 7772 6974    def clean_writ
-00010e80: 655f 6874 6d6c 2863 6c73 2c20 696e 5f68  e_html(cls, in_h
-00010e90: 746d 6c2c 206f 7574 5f68 746d 6c2c 2070  tml, out_html, p
-00010ea0: 7265 7474 795f 7072 696e 743d 5472 7565  retty_print=True
-00010eb0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00010ec0: 2020 2020 2020 2050 6172 7365 2072 6177         Parse raw
-00010ed0: 2048 544d 4c20 286e 6f74 2061 6c77 6179   HTML (not alway
-00010ee0: 7320 7765 6c6c 2d66 6f72 6d65 6429 202c  s well-formed) ,
-00010ef0: 206d 616b 6520 7765 6c6c 666f 726d 6564   make wellformed
-00010f00: 2061 6e64 206f 7074 696f 6e61 6c6c 7920   and optionally 
-00010f10: 7072 6574 7479 2070 7269 6e74 0a20 2020  pretty print.   
-00010f20: 2020 2020 203a 7061 7261 6d20 696e 5f68       :param in_h
-00010f30: 746d 6c3a 2069 6e70 7574 2068 746d 6c20  tml: input html 
-00010f40: 6669 6c65 0a20 2020 2020 2020 203a 7061  file.        :pa
-00010f50: 7261 6d20 6f75 745f 6874 6d6c 3a20 6f75  ram out_html: ou
-00010f60: 7470 7574 2066 696c 650a 2020 2020 2020  tput file.      
-00010f70: 2020 3a70 6172 616d 2070 7265 7474 795f    :param pretty_
-00010f80: 7072 696e 743a 206f 7574 7075 7420 666f  print: output fo
-00010f90: 726d 6174 0a20 2020 2020 2020 203a 7265  rmat.        :re
-00010fa0: 7475 726e 3a20 7061 7273 6564 2068 746d  turn: parsed htm
-00010fb0: 6c20 656c 656d 656e 740a 2020 2020 2020  l element.      
-00010fc0: 2020 2222 220a 2020 2020 2020 2020 6874    """.        ht
-00010fd0: 6d6c 5f65 6c65 6d20 3d20 636c 732e 7061  ml_elem = cls.pa
-00010fe0: 7273 655f 6874 6d6c 5f66 696c 655f 746f  rse_html_file_to
-00010ff0: 5f78 6d6c 2869 6e5f 6874 6d6c 290a 2020  _xml(in_html).  
-00011000: 2020 2020 2020 636c 732e 7772 6974 655f        cls.write_
-00011010: 6874 6d6c 5f65 6c65 6d28 6874 6d6c 5f65  html_elem(html_e
-00011020: 6c65 6d2c 206f 7574 5f68 746d 6c2c 2070  lem, out_html, p
-00011030: 7265 7474 795f 7072 696e 743d 7072 6574  retty_print=pret
-00011040: 7479 5f70 7269 6e74 290a 2020 2020 2020  ty_print).      
-00011050: 2020 7265 7475 726e 2068 746d 6c5f 656c    return html_el
-00011060: 656d 0a0a 2020 2020 4063 6c61 7373 6d65  em..    @classme
-00011070: 7468 6f64 0a20 2020 2064 6566 2070 6172  thod.    def par
-00011080: 7365 5f68 746d 6c5f 6669 6c65 5f74 6f5f  se_html_file_to_
-00011090: 786d 6c28 636c 732c 2069 6e5f 6874 6d6c  xml(cls, in_html
-000110a0: 293a 0a20 2020 2020 2020 2022 2222 7265  ):.        """re
-000110b0: 6164 2075 6e74 6964 7920 4854 4d4c 2069  ad untidy HTML i
-000110c0: 6e74 6f20 584d 4c0a 2020 2020 2020 2020  nto XML.        
-000110d0: 7573 6573 2048 544d 4c50 6172 7365 720a  uses HTMLParser.
-000110e0: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
-000110f0: 6e5f 6874 6d6c 3a20 4854 4d4c 2066 696c  n_html: HTML fil
-00011100: 650a 2020 2020 2020 2020 3a72 6574 7572  e.        :retur
-00011110: 6e3a 2077 656c 6c5f 666f 726d 6564 2058  n: well_formed X
-00011120: 4854 4d4c 0a20 2020 2020 2020 2022 2222  HTML.        """
-00011130: 0a20 2020 2020 2020 2068 746d 6c5f 656c  .        html_el
-00011140: 656d 203d 2045 542e 7061 7273 6528 7374  em = ET.parse(st
-00011150: 7228 696e 5f68 746d 6c29 2c20 4554 2e48  r(in_html), ET.H
-00011160: 544d 4c50 6172 7365 7228 2929 2e78 7061  TMLParser()).xpa
-00011170: 7468 2822 2f2a 2229 5b30 5d0a 2020 2020  th("/*")[0].    
-00011180: 2020 2020 7265 7475 726e 2068 746d 6c5f      return html_
-00011190: 656c 656d 0a0a 2020 2020 4063 6c61 7373  elem..    @class
-000111a0: 6d65 7468 6f64 0a20 2020 2064 6566 2077  method.    def w
-000111b0: 7269 7465 5f68 746d 6c5f 656c 656d 2863  rite_html_elem(c
-000111c0: 6c73 2c20 656c 656d 2c20 6f75 745f 6874  ls, elem, out_ht
-000111d0: 6d6c 2c20 7072 6574 7479 5f70 7269 6e74  ml, pretty_print
-000111e0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-000111f0: 2022 2222 7772 6974 6520 4854 4d4c 2077   """write HTML w
-00011200: 6974 6820 6f70 7469 6f6e 616c 2070 7265  ith optional pre
-00011210: 7474 795f 7072 696e 740a 2020 2020 2020  tty_print.      
-00011220: 2020 3a70 6172 616d 2065 6c65 6d3a 2048    :param elem: H
-00011230: 544d 4c20 656c 656d 656e 740a 2020 2020  TML element.    
-00011240: 2020 2020 3a70 6172 616d 206f 7574 5f68      :param out_h
-00011250: 746d 6c3a 2065 6974 6865 7220 6120 6669  tml: either a fi
-00011260: 6c65 206f 7220 7379 732e 7374 646f 7574  le or sys.stdout
-00011270: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00011280: 7072 6574 7479 5f70 7269 6e74 3a0a 2020  pretty_print:.  
-00011290: 2020 2020 2020 2272 6574 7572 6e3a 204e        "return: N
-000112a0: 6f6e 650a 2020 2020 2020 2020 2222 220a  one.        """.
-000112b0: 2020 2020 2020 2020 6966 206f 7574 5f68          if out_h
-000112c0: 746d 6c20 3d3d 2073 7973 2e73 7464 6f75  tml == sys.stdou
-000112d0: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
-000112e0: 7269 6e74 2028 4554 2e74 6f73 7472 696e  rint (ET.tostrin
-000112f0: 6728 656c 656d 2c20 7072 6574 7479 5f70  g(elem, pretty_p
-00011300: 7269 6e74 3d54 7275 652c 2065 6e63 6f64  rint=True, encod
-00011310: 696e 673d 2275 6e69 636f 6465 2229 290a  ing="unicode")).
-00011320: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00011330: 2020 2020 2020 2020 2020 7373 203d 2045            ss = E
-00011340: 542e 746f 7374 7269 6e67 2865 6c65 6d2c  T.tostring(elem,
-00011350: 2070 7265 7474 795f 7072 696e 743d 7072   pretty_print=pr
-00011360: 6574 7479 5f70 7269 6e74 290a 2020 2020  etty_print).    
-00011370: 2020 2020 2020 2020 5061 7468 286f 7574          Path(out
-00011380: 5f68 746d 6c29 2e70 6172 656e 742e 6d6b  _html).parent.mk
-00011390: 6469 7228 7061 7265 6e74 733d 5472 7565  dir(parents=True
-000113a0: 2c20 6578 6973 745f 6f6b 3d54 7275 6529  , exist_ok=True)
-000113b0: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-000113c0: 6820 6f70 656e 286f 7574 5f68 746d 6c2c  h open(out_html,
-000113d0: 2022 7762 2229 2061 7320 663a 0a20 2020   "wb") as f:.   
-000113e0: 2020 2020 2020 2020 2020 2020 2066 2e77               f.w
-000113f0: 7269 7465 2873 7329 0a0a 2020 2020 4063  rite(ss)..    @c
-00011400: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00011410: 6566 2072 656d 6f76 655f 7374 796c 655f  ef remove_style_
-00011420: 6174 7472 6962 7574 6573 2863 6c73 2c20  attributes(cls, 
-00011430: 6874 6d6c 5f65 6c65 6d29 3a0a 2020 2020  html_elem):.    
-00011440: 2020 2020 2222 2272 656d 6f76 6520 4073      """remove @s
-00011450: 7479 6c65 2061 7474 7269 6275 7465 7320  tyle attributes 
-00011460: 6672 6f6d 2065 6c65 6d65 6e74 7320 696e  from elements in
-00011470: 2068 746d 6c5f 656c 656d 0a20 2020 2020   html_elem.     
-00011480: 2020 203a 7061 7261 6d20 6874 6d6c 5f65     :param html_e
-00011490: 6c65 6d3a 2065 6c65 6d65 6e74 2074 6f20  lem: element to 
-000114a0: 7374 7269 700a 2020 2020 2020 2020 2222  strip.        ""
-000114b0: 220a 2020 2020 2020 2020 6966 2068 746d  ".        if htm
-000114c0: 6c5f 656c 656d 2069 7320 4e6f 6e65 3a0a  l_elem is None:.
-000114d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000114e0: 726e 0a20 2020 2020 2020 2073 7479 6c65  rn.        style
-000114f0: 5f65 6c65 6d73 203d 2068 746d 6c5f 656c  _elems = html_el
-00011500: 656d 2e78 7061 7468 2822 2e2f 2f2a 5b40  em.xpath(".//*[@
-00011510: 7374 796c 655d 2229 0a20 2020 2020 2020  style]").       
-00011520: 2066 6f72 2073 7479 6c65 5f65 6c65 6d20   for style_elem 
-00011530: 696e 2073 7479 6c65 5f65 6c65 6d73 3a0a  in style_elems:.
-00011540: 2020 2020 2020 2020 2020 2020 4874 6d6c              Html
-00011550: 5574 696c 2e72 656d 6f76 655f 6174 7472  Util.remove_attr
-00011560: 6962 7574 6528 7374 796c 655f 656c 656d  ibute(style_elem
-00011570: 2c20 2273 7479 6c65 2229 0a0a 2020 2020  , "style")..    
-00011580: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00011590: 2064 6566 2072 656d 6f76 655f 656c 656d   def remove_elem
-000115a0: 7328 636c 732c 2068 746d 6c5f 656c 656d  s(cls, html_elem
-000115b0: 2c20 7870 6174 683d 4e6f 6e65 293a 0a20  , xpath=None):. 
-000115c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000115d0: 2020 2072 656d 6f76 6520 656c 656d 656e     remove elemen
-000115e0: 7473 2062 7920 7870 6174 680a 2020 2020  ts by xpath.    
-000115f0: 2020 2020 3a70 6172 616d 2068 746d 6c5f      :param html_
-00011600: 656c 656d 3a20 656c 656d 656e 7420 746f  elem: element to
-00011610: 2072 656d 6f76 6520 656c 656d 656e 7420   remove element 
-00011620: 6672 6f6d 0a20 2020 2020 2020 203a 7061  from.        :pa
-00011630: 7261 6d20 7870 6174 683a 0a20 2020 2020  ram xpath:.     
-00011640: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00011650: 6620 6874 6d6c 5f65 6c65 6d20 6973 204e  f html_elem is N
-00011660: 6f6e 6520 6f72 2078 7061 7468 2069 7320  one or xpath is 
-00011670: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00011680: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-00011690: 2065 6c65 6d73 203d 2068 746d 6c5f 656c   elems = html_el
-000116a0: 656d 2e78 7061 7468 2878 7061 7468 290a  em.xpath(xpath).
-000116b0: 2020 2020 2020 2020 666f 7220 656c 656d          for elem
-000116c0: 2069 6e20 656c 656d 733a 0a20 2020 2020   in elems:.     
-000116d0: 2020 2020 2020 2048 746d 6c55 7469 6c2e         HtmlUtil.
-000116e0: 7265 6d6f 7665 5f65 6c65 6d5f 6b65 6570  remove_elem_keep
-000116f0: 5f74 6169 6c28 656c 656d 290a 0a20 2020  _tail(elem)..   
-00011700: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00011710: 2020 6465 6620 7265 6d6f 7665 5f65 6c65    def remove_ele
-00011720: 6d65 6e74 5f69 6e5f 6869 6572 6172 6368  ment_in_hierarch
-00011730: 7928 636c 732c 2065 6c65 6d29 3a0a 2020  y(cls, elem):.  
-00011740: 2020 2020 2020 2222 2272 656d 6f76 6573        """removes
-00011750: 2064 6976 7320 6672 6f6d 206e 6573 7469   divs from nesti
-00011760: 6e67 0a20 2020 2020 2020 2045 7861 6d70  ng.        Examp
-00011770: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-00011780: 3c64 6976 2069 643d 2264 3122 3e0a 2020  <div id="d1">.  
-00011790: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
-000117a0: 2069 643d 2264 3222 3e0a 2020 2020 2020   id="d2">.      
-000117b0: 2020 2020 2020 2020 2020 3c73 7061 6e20            <span 
-000117c0: 6964 3d22 7331 223e 626c 6168 3c2f 7370  id="s1">blah</sp
-000117d0: 616e 3e0a 2020 2020 2020 2020 2020 2020  an>.            
-000117e0: 2020 3c2f 6469 763e 0a20 2020 2020 2020    </div>.       
-000117f0: 2020 2020 203c 2f64 6976 3e0a 2020 2020       </div>.    
-00011800: 2020 2020 2020 2020 6132 2069 7320 706c          a2 is pl
-00011810: 6179 696e 6720 6e6f 2072 6f6c 6520 696e  aying no role in
-00011820: 2067 726f 7570 696e 672c 2073 6f20 6361   grouping, so ca
-00011830: 6e20 6265 2072 656d 6f76 6564 2074 6f20  n be removed to 
-00011840: 6769 7665 3a0a 2020 2020 2020 2020 2020  give:.          
-00011850: 2020 3c64 6976 2069 643d 2264 3122 3e0a    <div id="d1">.
-00011860: 2020 2020 2020 2020 2020 2020 2020 3c73                <s
-00011870: 7061 6e20 6964 3d22 7331 223e 626c 6168  pan id="s1">blah
-00011880: 3c2f 7370 616e 3e0a 2020 2020 2020 2020  </span>.        
-00011890: 2020 2020 3c2f 6469 763e 0a20 2020 2020      </div>.     
-000118a0: 2020 2020 2020 2054 6869 7320 6361 6e20         This can 
-000118b0: 6265 2072 6563 7572 7369 7665 2062 7574  be recursive but
-000118c0: 2073 7061 6e73 2073 686f 756c 6420 616c   spans should al
-000118d0: 7761 7973 2068 6176 6520 6469 7620 7061  ways have div pa
-000118e0: 7265 6e74 730a 2020 2020 2020 2020 2020  rents.          
-000118f0: 2020 3a70 6172 616d 2065 6c65 6d3a 2065    :param elem: e
-00011900: 6c65 6d20 746f 2072 656d 6f76 652e 2049  lem to remove. I
-00011910: 7473 2063 6869 6c64 7265 6e20 6172 6520  ts children are 
-00011920: 7472 616e 7366 6572 6564 2074 6f20 7061  transfered to pa
-00011930: 7265 6e74 0a20 2020 2020 2020 2020 2020  rent.           
-00011940: 2065 2e67 2e0a 2020 2020 2020 2020 2020   e.g..          
-00011950: 2020 7028 612c 656c 656d 286c 2c6d 2c6e    p(a,elem(l,m,n
-00011960: 292c 7a29 203d 3e20 7028 612c 6c2c 6d2c  ),z) => p(a,l,m,
-00011970: 6e2c 7a29 0a20 2020 2020 2020 2020 2020  n,z).           
-00011980: 203a 7265 7475 726e 3a4e 6f6e 650a 2020   :return:None.  
-00011990: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000119a0: 2020 7061 7265 6e74 203d 2065 6c65 6d2e    parent = elem.
-000119b0: 6765 7470 6172 656e 7428 290a 2020 2020  getparent().    
-000119c0: 2020 2020 6966 2070 6172 656e 7420 6973      if parent is
-000119d0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-000119e0: 2020 2070 7269 6e74 2866 2265 6c65 6d20     print(f"elem 
-000119f0: 6861 7320 6e6f 2070 6172 656e 7422 290a  has no parent").
-00011a00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00011a10: 726e 0a20 2020 2020 2020 2069 6478 203d  rn.        idx =
-00011a20: 2070 6172 656e 742e 696e 6465 7828 656c   parent.index(el
-00011a30: 656d 290a 2020 2020 2020 2020 6368 696c  em).        chil
-00011a40: 645f 656c 656d 7320 3d20 656c 656d 2e78  d_elems = elem.x
-00011a50: 7061 7468 2822 2a22 290a 2020 2020 2020  path("*").      
-00011a60: 2020 666f 7220 6368 696c 645f 656c 656d    for child_elem
-00011a70: 2069 6e20 6368 696c 645f 656c 656d 733a   in child_elems:
-00011a80: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-00011a90: 656e 742e 696e 7365 7274 2869 6478 2c20  ent.insert(idx, 
-00011aa0: 6368 696c 645f 656c 656d 290a 2020 2020  child_elem).    
-00011ab0: 2020 2020 7061 7265 6e74 2e72 656d 6f76      parent.remov
-00011ac0: 6528 656c 656d 290a 0a20 2020 2040 636c  e(elem)..    @cl
-00011ad0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-00011ae0: 6620 7265 6d6f 7665 5f65 6c65 6d65 6e74  f remove_element
-00011af0: 735f 696e 5f68 6965 7261 7263 6879 5f62  s_in_hierarchy_b
-00011b00: 795f 7870 6174 6828 636c 732c 2068 746d  y_xpath(cls, htm
-00011b10: 6c2c 2078 7061 7468 293a 0a20 2020 2020  l, xpath):.     
-00011b20: 2020 2022 2222 6669 6e64 7320 656c 656d     """finds elem
-00011b30: 656e 7473 2062 7920 7870 6174 6820 616e  ents by xpath an
-00011b40: 6420 6465 6c65 7465 7320 7468 656d 2075  d deletes them u
-00011b50: 7369 6e67 2072 656d 6f76 655f 656c 656d  sing remove_elem
-00011b60: 656e 7473 5f69 6e5f 6869 6572 6172 6368  ents_in_hierarch
-00011b70: 7928 290a 2020 2020 2020 2020 3a70 6172  y().        :par
-00011b80: 616d 2068 746d 6c3a 2065 6c65 6d65 6e74  am html: element
-00011b90: 7320 746f 2064 656c 6574 6520 6672 6f6d  s to delete from
-00011ba0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00011bb0: 7870 6174 683a 2078 7061 7468 2074 6f20  xpath: xpath to 
-00011bc0: 7365 6172 6368 2077 6974 680a 2020 2020  search with.    
-00011bd0: 2020 2020 3a72 6574 7572 6e3a 2065 6c65      :return: ele
-00011be0: 6d73 2074 6861 7420 6861 7665 2062 6565  ms that have bee
-00011bf0: 6e20 6465 6c65 7465 640a 2020 2020 2020  n deleted.      
-00011c00: 2020 2222 220a 2020 2020 2020 2020 656c    """.        el
-00011c10: 656d 7320 3d20 6874 6d6c 2e78 7061 7468  ems = html.xpath
-00011c20: 2878 7061 7468 290a 2020 2020 2020 2020  (xpath).        
-00011c30: 666f 7220 656c 656d 2069 6e20 656c 656d  for elem in elem
-00011c40: 733a 0a20 2020 2020 2020 2020 2020 2048  s:.            H
-00011c50: 746d 6c55 7469 6c2e 7265 6d6f 7665 5f65  tmlUtil.remove_e
-00011c60: 6c65 6d65 6e74 5f69 6e5f 6869 6572 6172  lement_in_hierar
-00011c70: 6368 7928 656c 656d 290a 2020 2020 2020  chy(elem).      
-00011c80: 2020 7265 7475 726e 2065 6c65 6d73 0a0a    return elems..
-00011c90: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00011ca0: 0a20 2020 2064 6566 2070 6172 7365 5f68  .    def parse_h
-00011cb0: 746d 6c5f 6c78 6d6c 2863 6c73 2c20 696e  tml_lxml(cls, in
-00011cc0: 6669 6c65 293a 0a20 2020 2020 2020 2022  file):.        "
-00011cd0: 2222 0a20 2020 2020 2020 2070 6172 7365  "".        parse
-00011ce0: 2048 544d 4c20 7769 7468 206c 786d 6c20   HTML with lxml 
-00011cf0: 636f 6e76 656e 6965 6e63 6520 6d65 7468  convenience meth
-00011d00: 6f64 0a20 2020 2020 2020 203a 7061 7261  od.        :para
-00011d10: 6d20 696e 6669 6c65 3a20 7374 7220 6f72  m infile: str or
-00011d20: 2070 6174 680a 2020 2020 2020 2020 3a72   path.        :r
-00011d30: 6574 7572 6e3a 2048 544d 4c20 7472 6565  eturn: HTML tree
-00011d40: 0a20 2020 2020 2020 203a 6578 6365 7074  .        :except
-00011d50: 3a20 6361 6e6e 6f74 2066 696e 642f 7061  : cannot find/pa
-00011d60: 7273 650a 2020 2020 2020 2020 2222 220a  rse.        """.
-00011d70: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00011d80: 2020 2020 2020 2020 2068 746d 6c78 203d           htmlx =
-00011d90: 2045 542e 7061 7273 6528 7374 7228 696e   ET.parse(str(in
-00011da0: 6669 6c65 292c 2048 544d 4c50 6172 7365  file), HTMLParse
-00011db0: 7228 2929 0a20 2020 2020 2020 2065 7863  r()).        exc
-00011dc0: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
-00011dd0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-00011de0: 7261 6973 6520 650a 2020 2020 2020 2020  raise e.        
-00011df0: 7265 7475 726e 2068 746d 6c78 0a0a 0a0a  return htmlx....
-00011e00: 636c 6173 7320 4874 6d6c 416e 6e6f 7461  class HtmlAnnota
-00011e10: 746f 723a 0a20 2020 2022 2222 696e 6c69  tor:.    """inli
-00011e20: 6e65 2061 6e6e 6f74 6174 6f72 2066 6f72  ne annotator for
-00011e30: 2048 544d 4c20 656c 656d 656e 7473 0a20   HTML elements. 
-00011e40: 2020 2073 746f 7265 7320 616e 6420 7275     stores and ru
-00011e50: 6e73 2041 6e6e 6f74 6174 6f72 436f 6d6d  ns AnnotatorComm
-00011e60: 616e 6473 0a0a 2020 2020 616e 6e6f 7461  ands..    annota
-00011e70: 746f 7220 3d20 416e 6e6f 7461 746f 7228  tor = Annotator(
-00011e80: 290a 2020 2020 636f 6d6d 616e 6420 3d20  ).    command = 
-00011e90: 416e 6e6f 7461 746f 7243 6f6d 6d61 6e64  AnnotatorCommand
-00011ea0: 2868 746d 6c5f 636c 6173 733d 2273 6563  (html_class="sec
-00011eb0: 7469 6f6e 5f74 6974 6c65 222c 2072 6567  tion_title", reg
-00011ec0: 6578 3d22 5365 6374 696f 6e5c 5c73 2b28  ex="Section\\s+(
-00011ed0: 3f50 3c69 643e 5c5c 642b 293a 5c5c 732b  ?P<id>\\d+):\\s+
-00011ee0: 283f 503c 7469 746c 653e 2e2a 2922 2c20  (?P<title>.*)", 
-00011ef0: 6164 645f 6964 3d54 7275 652c 2061 6464  add_id=True, add
-00011f00: 5f74 6974 6c65 3d54 7275 6529 0a20 2020  _title=True).   
-00011f10: 2061 6e6e 6f74 6174 6f72 2e61 6464 5f63   annotator.add_c
-00011f20: 6f6d 6d61 6e64 2863 6f6d 6d61 6e64 290a  ommand(command).
-00011f30: 2020 2020 616e 6e6f 7461 746f 722e 7275      annotator.ru
-00011f40: 6e5f 636f 6d6d 616e 6473 2865 6c65 6d29  n_commands(elem)
-00011f50: 0a0a 2020 2020 2222 220a 0a20 2020 2064  ..    """..    d
-00011f60: 6566 205f 5f69 6e69 745f 5f28 7365 6c66  ef __init__(self
-00011f70: 293a 0a20 2020 2020 2020 2073 656c 662e  ):.        self.
-00011f80: 636f 6d6d 616e 6473 203d 205b 5d0a 0a20  commands = [].. 
-00011f90: 2020 2064 6566 2061 6464 5f63 6f6d 6d61     def add_comma
-00011fa0: 6e64 2873 656c 662c 2063 6f6d 6d61 6e64  nd(self, command
-00011fb0: 293a 0a20 2020 2020 2020 2069 6620 636f  ):.        if co
-00011fc0: 6d6d 616e 643a 0a20 2020 2020 2020 2020  mmand:.         
-00011fd0: 2020 2073 656c 662e 636f 6d6d 616e 6473     self.commands
-00011fe0: 2e61 7070 656e 6428 636f 6d6d 616e 6429  .append(command)
-00011ff0: 0a0a 2020 2020 6465 6620 7275 6e5f 636f  ..    def run_co
-00012000: 6d6d 616e 6473 2873 656c 662c 2074 6172  mmands(self, tar
-00012010: 6765 745f 656c 656d 293a 0a20 2020 2020  get_elem):.     
-00012020: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00012030: 7465 7261 7465 2063 6f6d 6d61 6e64 7320  terate commands 
-00012040: 286f 7264 6572 2069 7320 6f72 6465 7220  (order is order 
-00012050: 6f66 2074 6865 6972 2061 6464 6974 696f  of their additio
-00012060: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
-00012070: 2020 2020 2020 666f 7220 636f 6d6d 616e        for comman
-00012080: 6420 696e 2073 656c 662e 636f 6d6d 616e  d in self.comman
-00012090: 6473 3a0a 2020 2020 2020 2020 2020 2020  ds:.            
-000120a0: 636f 6d6d 616e 642e 7275 6e5f 636f 6d6d  command.run_comm
-000120b0: 616e 6428 7461 7267 6574 5f65 6c65 6d29  and(target_elem)
-000120c0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-000120d0: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
-000120e0: 655f 6970 6363 5f61 6e6e 6f74 6174 6f72  e_ipcc_annotator
-000120f0: 2863 6c73 293a 0a20 2020 2020 2020 2022  (cls):.        "
-00012100: 2222 6120 7365 7420 6f66 2067 656e 6572  ""a set of gener
-00012110: 616c 206f 7065 7261 7469 6f6e 7320 666f  al operations fo
-00012120: 7220 4950 4343 2222 220a 2020 2020 2020  r IPCC""".      
-00012130: 2020 616e 6e6f 7461 746f 7220 3d20 4874    annotator = Ht
-00012140: 6d6c 416e 6e6f 7461 746f 7228 290a 2020  mlAnnotator().  
-00012150: 2020 2020 2020 616e 6e6f 7461 746f 722e        annotator.
-00012160: 6164 645f 636f 6d6d 616e 6428 0a20 2020  add_command(.   
-00012170: 2020 2020 2020 2020 2041 6e6e 6f74 6174           Annotat
-00012180: 6f72 436f 6d6d 616e 6428 6874 6d6c 5f63  orCommand(html_c
-00012190: 6c61 7373 3d22 7365 6374 696f 6e5f 7469  lass="section_ti
-000121a0: 746c 6522 2c20 7265 6765 783d 2253 6563  tle", regex="Sec
-000121b0: 7469 6f6e 5c5c 732b 283f 503c 6964 3e5c  tion\\s+(?P<id>\
-000121c0: 5c64 2b29 3a5c 5c73 2b28 3f50 3c74 6974  \d+):\\s+(?P<tit
-000121d0: 6c65 3e2e 2a29 222c 0a20 2020 2020 2020  le>.*)",.       
-000121e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000121f0: 2020 2020 2020 6164 645f 6964 3d22 7365        add_id="se
-00012200: 6374 696f 6e5f 7c22 2c20 6164 645f 7469  ction_|", add_ti
-00012210: 746c 653d 227c 222c 2073 7479 6c65 3d22  tle="|", style="
-00012220: 7b63 6f6c 6f72 203a 2062 6c75 653b 2062  {color : blue; b
-00012230: 6163 6b67 726f 756e 6420 3a20 7069 6e6b  ackground : pink
-00012240: 3b7d 222c 0a20 2020 2020 2020 2020 2020  ;}",.           
-00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012260: 2064 6573 633d 2261 6464 2069 6420 616e   desc="add id an
-00012270: 6420 7469 746c 6520 666f 7220 2753 6563  d title for 'Sec
-00012280: 7469 6f6e 3a20 2e2e 2e27 2229 0a20 2020  tion: ...'").   
-00012290: 2020 2020 2029 0a20 2020 2020 2020 2061       ).        a
-000122a0: 6e6e 6f74 6174 6f72 2e61 6464 5f63 6f6d  nnotator.add_com
-000122b0: 6d61 6e64 280a 2020 2020 2020 2020 2020  mand(.          
-000122c0: 2020 416e 6e6f 7461 746f 7243 6f6d 6d61    AnnotatorComma
-000122d0: 6e64 2868 746d 6c5f 636c 6173 733d 2273  nd(html_class="s
-000122e0: 7562 5f73 6563 7469 6f6e 5f74 6974 6c65  ub_section_title
-000122f0: 222c 2072 6567 6578 3d22 5c5c 732a 283f  ", regex="\\s*(?
-00012300: 503c 6964 3e5c 5c64 2b5c 5c2e 5c5c 642b  P<id>\\d+\\.\\d+
-00012310: 295c 5c73 2b28 3f50 3c74 6974 6c65 3e2e  )\\s+(?P<title>.
-00012320: 2a29 222c 0a20 2020 2020 2020 2020 2020  *)",.           
-00012330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012340: 2020 6164 645f 6964 3d22 7375 6273 6563    add_id="subsec
-00012350: 7469 6f6e 5f7c 222c 2061 6464 5f74 6974  tion_|", add_tit
-00012360: 6c65 3d22 7c22 2c20 7374 796c 653d 227b  le="|", style="{
-00012370: 636f 6c6f 7220 3a20 6772 6565 6e3b 2062  color : green; b
-00012380: 6163 6b67 726f 756e 6420 3a20 7965 6c6c  ackground : yell
-00012390: 6f77 3b7d 2229 290a 2020 2020 2020 2020  ow;}")).        
-000123a0: 616e 6e6f 7461 746f 722e 6164 645f 636f  annotator.add_co
-000123b0: 6d6d 616e 6428 0a20 2020 2020 2020 2020  mmand(.         
-000123c0: 2020 2041 6e6e 6f74 6174 6f72 436f 6d6d     AnnotatorComm
-000123d0: 616e 6428 6874 6d6c 5f63 6c61 7373 3d22  and(html_class="
-000123e0: 7375 625f 7375 625f 7365 6374 696f 6e5f  sub_sub_section_
-000123f0: 7469 746c 6522 2c20 7265 6765 783d 225e  title", regex="^
-00012400: 5c5c 732a 283f 503c 6964 3e5c 5c64 2b5c  \\s*(?P<id>\\d+\
-00012410: 5c2e 5c5c 642b 5c5c 2e5c 5c64 2b29 5c5c  \.\\d+\\.\\d+)\\
-00012420: 732b 283f 503c 7469 746c 653e 2e2a 2922  s+(?P<title>.*)"
-00012430: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00012440: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00012450: 6464 5f69 643d 2273 7562 7365 6374 696f  dd_id="subsectio
-00012460: 6e5f 7c22 2c20 6164 645f 7469 746c 653d  n_|", add_title=
-00012470: 227c 222c 2073 7479 6c65 3d22 7b63 6f6c  "|", style="{col
-00012480: 6f72 203a 2062 6c61 636b 3b20 6261 636b  or : black; back
-00012490: 6772 6f75 6e64 203a 2023 6464 6464 6464  ground : #dddddd
-000124a0: 3b7d 2229 290a 2020 2020 2020 2020 616e  ;}")).        an
-000124b0: 6e6f 7461 746f 722e 6164 645f 636f 6d6d  notator.add_comm
-000124c0: 616e 6428 0a20 2020 2020 2020 2020 2020  and(.           
-000124d0: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
-000124e0: 6428 6874 6d6c 5f63 6c61 7373 3d22 636f  d(html_class="co
-000124f0: 6e66 6964 656e 6365 222c 0a20 2020 2020  nfidence",.     
-00012500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012510: 2020 2020 2020 2020 7265 6765 783d 225e          regex="^
-00012520: 5c5c 732a 5c5c 283f 283f 503c 7469 746c  \\s*\\(?(?P<titl
-00012530: 653e 2876 6572 7920 6869 6768 7c68 6967  e>(very high|hig
-00012540: 687c 6d65 6469 756d 7c6c 6f77 2920 636f  h|medium|low) co
-00012550: 6e66 6964 656e 6365 295c 5c29 3f22 2c0a  nfidence)\\)?",.
-00012560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012570: 2020 2020 2020 2020 2020 2020 2061 6464               add
-00012580: 5f69 643d 2263 6f6e 6669 6465 6e63 655f  _id="confidence_
-00012590: 7c22 2c20 6164 645f 7469 746c 653d 227c  |", add_title="|
-000125a0: 222c 2073 7479 6c65 3d22 7b63 6f6c 6f72  ", style="{color
-000125b0: 203a 2062 6c61 636b 3b20 6261 636b 6772   : black; backgr
-000125c0: 6f75 6e64 203a 2023 6464 3838 6464 3b7d  ound : #dd88dd;}
-000125d0: 2229 290a 2020 2020 2020 2020 616e 6e6f  ")).        anno
-000125e0: 7461 746f 722e 6164 645f 636f 6d6d 616e  tator.add_comman
-000125f0: 6428 0a20 2020 2020 2020 2020 2020 2041  d(.            A
-00012600: 6e6e 6f74 6174 6f72 436f 6d6d 616e 6428  nnotatorCommand(
-00012610: 6874 6d6c 5f63 6c61 7373 3d22 7072 6f62  html_class="prob
-00012620: 6162 696c 6974 7922 2c0a 2020 2020 2020  ability",.      
-00012630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012640: 2020 2020 2020 2072 6567 6578 3d22 5e5c         regex="^\
-00012650: 5c73 2a5c 5c28 3f28 3f50 3c74 6974 6c65  \s*\\(?(?P<title
-00012660: 3e28 6c69 6b65 6c79 7c76 6572 7920 6c69  >(likely|very li
-00012670: 6b65 6c79 7c65 7874 7265 6d65 6c79 206c  kely|extremely l
-00012680: 696b 656c 797c 7669 7274 7561 6c6c 7920  ikely|virtually 
-00012690: 6365 7274 6169 6e29 295c 5c29 3f22 2c0a  certain))\\)?",.
-000126a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000126b0: 2020 2020 2020 2020 2020 2020 2061 6464               add
-000126c0: 5f69 643d 2270 726f 6261 6269 6c69 7479  _id="probability
-000126d0: 5f7c 222c 2061 6464 5f74 6974 6c65 3d22  _|", add_title="
-000126e0: 7c22 2c20 7374 796c 653d 227b 636f 6c6f  |", style="{colo
-000126f0: 7220 3a20 6379 616e 3b20 6261 636b 6772  r : cyan; backgr
-00012700: 6f75 6e64 203a 2023 6464 3838 3838 3b7d  ound : #dd8888;}
-00012710: 2229 290a 2020 2020 2020 2020 616e 6e6f  ")).        anno
-00012720: 7461 746f 722e 6164 645f 636f 6d6d 616e  tator.add_comman
-00012730: 6428 0a20 2020 2020 2020 2020 2020 2041  d(.            A
-00012740: 6e6e 6f74 6174 6f72 436f 6d6d 616e 6428  nnotatorCommand(
-00012750: 6874 6d6c 5f63 6c61 7373 3d22 7375 7065  html_class="supe
-00012760: 7273 6372 6970 7422 2c20 7363 7269 7074  rscript", script
-00012770: 3d22 7375 7065 7222 2c20 6164 645f 6964  ="super", add_id
-00012780: 3d22 7375 7065 725f 7c22 2c20 6164 645f  ="super_|", add_
-00012790: 7469 746c 653d 227c 222c 0a20 2020 2020  title="|",.     
-000127a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000127b0: 2020 2020 2020 2020 7374 796c 653d 227b          style="{
-000127c0: 636f 6c6f 7220 3a20 626c 7565 3b20 6261  color : blue; ba
-000127d0: 636b 6772 6f6f 756e 643a 2079 656c 6c6f  ckgroound: yello
-000127e0: 777d 2229 290a 2020 2020 2020 2020 616e  w}")).        an
-000127f0: 6e6f 7461 746f 722e 6164 645f 636f 6d6d  notator.add_comm
-00012800: 616e 6428 0a20 2020 2020 2020 2020 2020  and(.           
-00012810: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
-00012820: 6428 6874 6d6c 5f63 6c61 7373 3d22 7374  d(html_class="st
-00012830: 6172 7422 2c20 7265 6765 783d 225c 5c73  art", regex="\\s
-00012840: 2a5c 5c5b 3f53 5441 5254 5c5c 732a 283f  *\\[?START\\s*(?
-00012850: 503c 7469 746c 653e 4649 4755 5245 7c54  P<title>FIGURE|T
-00012860: 4142 4c45 295c 5c73 2a28 3f50 3c69 643e  ABLE)\\s*(?P<id>
-00012870: 5c5c 642b 5c5c 2e5c 5c64 2b29 5c5c 732a  \\d+\\.\\d+)\\s*
-00012880: 2848 4552 4529 3f5c 5c5d 3f22 2c0a 2020  (HERE)?\\]?",.  
-00012890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000128a0: 2020 2020 2020 2020 2020 2061 6464 5f69             add_i
-000128b0: 643d 2273 7461 7274 5f7c 222c 2061 6464  d="start_|", add
-000128c0: 5f74 6974 6c65 3d22 7374 6172 745f 7c22  _title="start_|"
-000128d0: 2c20 7374 796c 653d 227b 636f 6c6f 7220  , style="{color 
-000128e0: 3a20 6772 6565 6e3b 2062 6163 6b67 726f  : green; backgro
-000128f0: 756e 643a 2070 696e 6b7d 2229 290a 2020  und: pink}")).  
-00012900: 2020 2020 2020 616e 6e6f 7461 746f 722e        annotator.
-00012910: 6164 645f 636f 6d6d 616e 6428 0a20 2020  add_command(.   
-00012920: 2020 2020 2020 2020 2041 6e6e 6f74 6174           Annotat
-00012930: 6f72 436f 6d6d 616e 6428 6874 6d6c 5f63  orCommand(html_c
-00012940: 6c61 7373 3d22 656e 6422 2c20 7265 6765  lass="end", rege
-00012950: 783d 225c 5c73 2a5c 5c5b 3f45 4e44 5c5c  x="\\s*\\[?END\\
-00012960: 732a 283f 503c 7469 746c 653e 4649 4755  s*(?P<title>FIGU
-00012970: 5245 7c54 4142 4c45 295c 5c73 2a28 3f50  RE|TABLE)\\s*(?P
-00012980: 3c69 643e 5c5c 642b 5c5c 2e5c 5c64 2b29  <id>\\d+\\.\\d+)
-00012990: 5c5c 732a 2848 4552 4529 3f5c 5c5d 3f22  \\s*(HERE)?\\]?"
-000129a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000129b0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-000129c0: 6464 5f69 643d 2265 6e64 5f7c 222c 2061  dd_id="end_|", a
-000129d0: 6464 5f74 6974 6c65 3d22 656e 645f 7c22  dd_title="end_|"
-000129e0: 2c20 7374 796c 653d 227b 636f 6c6f 7220  , style="{color 
-000129f0: 3a20 6772 6565 6e3b 2062 6163 6b67 726f  : green; backgro
-00012a00: 756e 643a 2062 6c75 657d 2229 290a 2020  und: blue}")).  
-00012a10: 2020 2020 2020 616e 6e6f 7461 746f 722e        annotator.
-00012a20: 6164 645f 636f 6d6d 616e 6428 0a20 2020  add_command(.   
-00012a30: 2020 2020 2020 2020 2041 6e6e 6f74 6174           Annotat
-00012a40: 6f72 436f 6d6d 616e 6428 6874 6d6c 5f63  orCommand(html_c
-00012a50: 6c61 7373 3d22 7461 7267 6574 7322 2c20  lass="targets", 
-00012a60: 7265 6765 783d 222e 2a5c 5c7b 283f 503c  regex=".*\\{(?P<
-00012a70: 7469 746c 653e 2e2b 295c 5c7d 2e2a 222c  title>.+)\\}.*",
-00012a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012a90: 2020 2020 2020 2020 2020 2020 2020 6164                ad
-00012aa0: 645f 6964 3d22 6368 756e 6b5f 7c22 2c20  d_id="chunk_|", 
-00012ab0: 6164 645f 7469 746c 653d 227c 222c 2073  add_title="|", s
-00012ac0: 7479 6c65 3d22 7b63 6f6c 6f72 203a 2067  tyle="{color : g
-00012ad0: 7265 656e 3b20 6261 636b 6772 6f75 6e64  reen; background
-00012ae0: 3a20 6f72 616e 6765 7d22 2c0a 2020 2020  : orange}",.    
-00012af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b00: 2020 2020 2020 2020 6465 7363 3d22 4950          desc="IP
-00012b10: 4343 2074 6172 6765 7420 4944 7320 696e  CC target IDs in
-00012b20: 2063 7572 6c79 2062 7261 636b 6574 7320   curly brackets 
-00012b30: 7b57 4731 2053 504d 2041 2e31 2e32 2c20  {WG1 SPM A.1.2, 
-00012b40: 5747 4949 2053 504d 2042 2e32 2e33 7d22  WGII SPM B.2.3}"
-00012b50: 2929 0a20 2020 2020 2020 2061 6e6e 6f74  )).        annot
-00012b60: 6174 6f72 2e61 6464 5f63 6f6d 6d61 6e64  ator.add_command
-00012b70: 280a 2020 2020 2020 2020 2020 2020 416e  (.            An
-00012b80: 6e6f 7461 746f 7243 6f6d 6d61 6e64 2868  notatorCommand(h
-00012b90: 746d 6c5f 636c 6173 733d 2263 7275 6674  tml_class="cruft
-00012ba0: 222c 2072 6567 6578 3d22 5e2e 2a28 5375  ", regex="^.*(Su
-00012bb0: 626a 6563 7420 746f 2043 6f70 7920 4564  bject to Copy Ed
-00012bc0: 6974 207c 4164 6f70 7465 6420 4c6f 6e67  it |Adopted Long
-00012bd0: 6572 2052 6570 6f72 7420 4950 4343 2041  er Report IPCC A
-00012be0: 5236 2053 5952 292e 2a24 222c 0a20 2020  R6 SYR).*$",.   
-00012bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c00: 2020 2020 2020 2020 2020 6164 645f 6964            add_id
-00012c10: 3d22 6372 7566 745f 7c22 2c20 6164 645f  ="cruft_|", add_
-00012c20: 7469 746c 653d 227c 222c 2064 656c 6574  title="|", delet
-00012c30: 653d 5472 7565 2c20 7374 796c 653d 227b  e=True, style="{
-00012c40: 636f 6c6f 7220 3a20 6772 6565 6e3b 2062  color : green; b
-00012c50: 6163 6b67 726f 756e 643a 2062 6c61 636b  ackground: black
-00012c60: 7d22 2929 0a20 2020 2020 2020 2061 6e6e  }")).        ann
-00012c70: 6f74 6174 6f72 2e61 6464 5f63 6f6d 6d61  otator.add_comma
-00012c80: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
-00012c90: 416e 6e6f 7461 746f 7243 6f6d 6d61 6e64  AnnotatorCommand
-00012ca0: 2868 746d 6c5f 636c 6173 733d 2270 6167  (html_class="pag
-00012cb0: 6522 2c20 7265 6765 783d 225e 283f 503c  e", regex="^(?P<
-00012cc0: 7469 746c 653e 705c 5c2e 5c5c 642b 2922  title>p\\.\\d+)"
-00012cd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000ea10: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000ea20: 2072 6f6f 742e 6174 7472 6962 2e70 6f70   root.attrib.pop
+0000ea30: 2822 7879 7a22 2c20 4e6f 6e65 2920 2222  ("xyz", None) ""
+0000ea40: 220a 2020 2020 2020 2020 6966 2065 6c65  ".        if ele
+0000ea50: 6d20 6973 204e 6f6e 6520 6f72 2061 7474  m is None or att
+0000ea60: 5f6e 616d 6520 6973 204e 6f6e 653a 0a20  _name is None:. 
+0000ea70: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000ea80: 6e0a 2020 2020 2020 2020 656c 656d 2e61  n.        elem.a
+0000ea90: 7474 7269 622e 706f 7028 6174 745f 6e61  ttrib.pop(att_na
+0000eaa0: 6d65 2c20 4e6f 6e65 290a 0a20 2020 2040  me, None)..    @
+0000eab0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+0000eac0: 6465 6620 7265 6d6f 7665 5f73 7479 6c65  def remove_style
+0000ead0: 5f61 7474 7269 6275 7465 2863 6c73 2c20  _attribute(cls, 
+0000eae0: 7265 665f 656c 656d 2c20 7374 796c 655f  ref_elem, style_
+0000eaf0: 6e61 6d65 293a 0a20 2020 2020 2020 2022  name):.        "
+0000eb00: 2222 0a20 2020 2020 2020 204d 6179 6265  "".        Maybe
+0000eb10: 206d 6f76 6520 746f 2048 544d 4c54 6964   move to HTMLTid
+0000eb20: 790a 2020 2020 2020 2020 2222 220a 0a20  y.        """.. 
+0000eb30: 2020 2020 2020 2065 6c65 6d73 203d 2072         elems = r
+0000eb40: 6566 5f65 6c65 6d2e 7870 6174 6828 222e  ef_elem.xpath(".
+0000eb50: 2f2f 2a22 290a 2020 2020 2020 2020 666f  //*").        fo
+0000eb60: 7220 656c 2069 6e20 656c 656d 733a 0a20  r el in elems:. 
+0000eb70: 2020 2020 2020 2020 2020 2063 7373 5f73             css_s
+0000eb80: 7479 6c65 203d 2043 5353 5374 796c 652e  tyle = CSSStyle.
+0000eb90: 6372 6561 7465 5f63 7373 5f73 7479 6c65  create_css_style
+0000eba0: 5f66 726f 6d5f 6174 7472 6962 7574 655f  _from_attribute_
+0000ebb0: 6f66 5f62 6f64 795f 656c 656d 656e 7428  of_body_element(
+0000ebc0: 656c 290a 2020 2020 2020 2020 2020 2020  el).            
+0000ebd0: 6966 2063 7373 5f73 7479 6c65 2e6e 616d  if css_style.nam
+0000ebe0: 655f 7661 6c75 655f 6469 6374 2e67 6574  e_value_dict.get
+0000ebf0: 2873 7479 6c65 5f6e 616d 6529 3a0a 2020  (style_name):.  
+0000ec00: 2020 2020 2020 2020 2020 2020 2020 6373                cs
+0000ec10: 735f 7374 796c 652e 6e61 6d65 5f76 616c  s_style.name_val
+0000ec20: 7565 5f64 6963 742e 706f 7028 7374 796c  ue_dict.pop(styl
+0000ec30: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
+0000ec40: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
+0000ec50: 652e 6170 706c 795f 746f 2865 6c29 0a0a  e.apply_to(el)..
+0000ec60: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+0000ec70: 0a20 2020 2064 6566 2072 656d 6f76 655f  .    def remove_
+0000ec80: 6c61 7267 655f 666f 6e74 6564 5f65 6c65  large_fonted_ele
+0000ec90: 6d65 6e74 7328 636c 732c 2072 6566 5f65  ments(cls, ref_e
+0000eca0: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
+0000ecb0: 220a 2020 2020 2020 2020 4d61 7962 6520  ".        Maybe 
+0000ecc0: 6d6f 7665 2074 6f20 4854 4d4c 5469 6479  move to HTMLTidy
+0000ecd0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000ece0: 2020 2020 2063 6c73 2e66 696e 645f 656c       cls.find_el
+0000ecf0: 656d 656e 7473 5f77 6974 685f 7374 796c  ements_with_styl
+0000ed00: 6528 7265 665f 656c 656d 2c20 222e 2f2f  e(ref_elem, ".//
+0000ed10: 2a5b 4073 7479 6c65 5d22 2c20 2266 6f6e  *[@style]", "fon
+0000ed20: 742d 7369 7a65 3e33 3022 2c20 7265 6d6f  t-size>30", remo
+0000ed30: 7665 3d54 7275 6529 0a0a 2020 2020 4063  ve=True)..    @c
+0000ed40: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+0000ed50: 6566 2066 696e 645f 636f 6e73 7461 6e74  ef find_constant
+0000ed60: 5f63 6f6f 7264 696e 6174 655f 6d61 726b  _coordinate_mark
+0000ed70: 6572 7328 636c 732c 2072 6566 5f65 6c65  ers(cls, ref_ele
+0000ed80: 6d2c 2078 7061 7468 2c20 7374 796c 653d  m, xpath, style=
+0000ed90: 2274 6f70 2229 3a0a 2020 2020 2020 2020  "top"):.        
+0000eda0: 2222 220a 2020 2020 2020 2020 6669 6e64  """.        find
+0000edb0: 7320 6120 6c69 6e65 2077 6974 6820 636f  s a line with co
+0000edc0: 6e73 7461 6e74 2064 6966 6665 7265 6e63  nstant differenc
+0000edd0: 6520 6672 6f6d 2074 6f70 206f 6620 7061  e from top of pa
+0000ede0: 6765 0a3c 6469 7620 7374 796c 653d 2274  ge.<div style="t
+0000edf0: 6f70 3a20 3530 7078 3b22 3e3c 6120 6e61  op: 50px;"><a na
+0000ee00: 6d65 3d22 3122 3e50 6167 6520 313c 2f61  me="1">Page 1</a
+0000ee10: 3e3c 2f64 6976 3e0a 2020 2020 2020 2020  ></div>.        
+0000ee20: 2222 220a 2020 2020 2020 2020 2222 220a  """.        """.
+0000ee30: 2020 2020 2020 2020 4d61 7962 6520 6d6f          Maybe mo
+0000ee40: 7665 2074 6f20 4854 4d4c 5469 6479 0a20  ve to HTMLTidy. 
+0000ee50: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0000ee60: 2020 2020 656c 656d 7320 3d20 7265 665f      elems = ref_
+0000ee70: 656c 656d 2e78 7061 7468 2878 7061 7468  elem.xpath(xpath
+0000ee80: 290a 2020 2020 2020 2020 636f 6f72 6473  ).        coords
+0000ee90: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+0000eea0: 7220 656c 656d 2069 6e20 656c 656d 733a  r elem in elems:
+0000eeb0: 0a20 2020 2020 2020 2020 2020 2063 7373  .            css
+0000eec0: 5f73 7479 6c65 203d 2043 5353 5374 796c  _style = CSSStyl
+0000eed0: 652e 6372 6561 7465 5f63 7373 5f73 7479  e.create_css_sty
+0000eee0: 6c65 5f66 726f 6d5f 6174 7472 6962 7574  le_from_attribut
+0000eef0: 655f 6f66 5f62 6f64 795f 656c 656d 656e  e_of_body_elemen
+0000ef00: 7428 656c 656d 290a 2020 2020 2020 2020  t(elem).        
+0000ef10: 2020 2020 636f 6f72 6420 3d20 6373 735f      coord = css_
+0000ef20: 7374 796c 652e 6e61 6d65 5f76 616c 7565  style.name_value
+0000ef30: 5f64 6963 742e 6765 7428 7374 796c 6529  _dict.get(style)
+0000ef40: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000ef50: 636f 6f72 643a 0a20 2020 2020 2020 2020  coord:.         
+0000ef60: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ef80: 636f 6f72 6473 2e61 7070 656e 6428 666c  coords.append(fl
+0000ef90: 6f61 7428 636f 6f72 645b 3a2d 325d 2929  oat(coord[:-2]))
+0000efa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000efb0: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
+0000efc0: 6e3a 0a20 2020 2020 2020 2020 2020 2020  n:.             
+0000efd0: 2020 2020 2020 206c 6f67 6769 6e67 2e77         logging.w
+0000efe0: 6172 6e69 6e67 2866 2263 616e 6e6f 7420  arning(f"cannot 
+0000eff0: 7061 7273 6520 7b63 6f6f 7264 7d20 666f  parse {coord} fo
+0000f000: 7220 7b73 7479 6c65 7d22 290a 2020 2020  r {style}").    
+0000f010: 2020 2020 6966 206e 6f74 2063 6f6f 7264      if not coord
+0000f020: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+0000f030: 6574 7572 6e20 4e6f 6e65 2c20 4e6f 6e65  eturn None, None
+0000f040: 2c20 5b5d 0a20 2020 2020 2020 206e 705f  , [].        np_
+0000f050: 636f 6f72 6473 203d 206e 702e 6172 7261  coords = np.arra
+0000f060: 7928 636f 6f72 6473 290a 0a20 2020 2020  y(coords)..     
+0000f070: 2020 2078 203d 206e 702e 6172 7261 7928     x = np.array(
+0000f080: 7261 6e67 6528 6e70 5f63 6f6f 7264 732e  range(np_coords.
+0000f090: 7369 7a65 2929 2e72 6573 6861 7065 2828  size)).reshape((
+0000f0a0: 2d31 2c20 3129 290a 2020 2020 2020 2020  -1, 1)).        
+0000f0b0: 6d6f 6465 6c20 3d20 4c69 6e65 6172 5265  model = LinearRe
+0000f0c0: 6772 6573 7369 6f6e 2829 2e66 6974 2878  gression().fit(x
+0000f0d0: 2c20 636f 6f72 6473 290a 2020 2020 2020  , coords).      
+0000f0e0: 2020 725f 7371 203d 206d 6f64 656c 2e73    r_sq = model.s
+0000f0f0: 636f 7265 2878 2c20 636f 6f72 6473 290a  core(x, coords).
+0000f100: 2020 2020 2020 2020 6966 2072 5f73 7120          if r_sq 
+0000f110: 3c20 302e 3938 3a0a 2020 2020 2020 2020  < 0.98:.        
+0000f120: 2020 2020 6c6f 6767 696e 672e 7761 726e      logging.warn
+0000f130: 696e 6728 6622 6361 6e6e 6f74 2063 616c  ing(f"cannot cal
+0000f140: 6375 6c61 7465 206f 6666 7365 7420 7265  culate offset re
+0000f150: 6c69 6162 6c79 2229 0a20 2020 2020 2020  liably").       
+0000f160: 2072 6574 7572 6e20 6d6f 6465 6c2e 696e   return model.in
+0000f170: 7465 7263 6570 745f 2c20 6d6f 6465 6c2e  tercept_, model.
+0000f180: 636f 6566 5f2c 206e 705f 636f 6f72 6473  coef_, np_coords
+0000f190: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+0000f1a0: 6f64 0a20 2020 2064 6566 2072 656d 6f76  od.    def remov
+0000f1b0: 655f 756e 7761 6e74 6564 7328 636c 732c  e_unwanteds(cls,
+0000f1c0: 2074 6f70 5f65 6c65 6d2c 2075 6e77 616e   top_elem, unwan
+0000f1d0: 7465 6473 293a 0a20 2020 2020 2020 2022  teds):.        "
+0000f1e0: 2222 0a20 2020 2020 2020 204d 6179 6265  "".        Maybe
+0000f1f0: 206d 6f76 6520 746f 2048 544d 4c54 6964   move to HTMLTid
+0000f200: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
+0000f210: 2020 2020 2020 6966 206e 6f74 2075 6e77        if not unw
+0000f220: 616e 7465 6473 3a0a 2020 2020 2020 2020  anteds:.        
+0000f230: 2020 2020 6c6f 6767 696e 672e 7761 726e      logging.warn
+0000f240: 696e 6728 6622 6e6f 2075 6e77 616e 7465  ing(f"no unwante
+0000f250: 6473 2074 6f20 7265 6d6f 7665 2229 0a20  ds to remove"). 
+0000f260: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000f270: 6e0a 2020 2020 2020 2020 666f 7220 6b65  n.        for ke
+0000f280: 7920 696e 2075 6e77 616e 7465 6473 3a0a  y in unwanteds:.
+0000f290: 2020 2020 2020 2020 2020 2020 756e 7761              unwa
+0000f2a0: 6e74 6564 203d 2075 6e77 616e 7465 6473  nted = unwanteds
+0000f2b0: 5b6b 6579 5d0a 2020 2020 2020 2020 2020  [key].          
+0000f2c0: 2020 7870 6174 6820 3d20 756e 7761 6e74    xpath = unwant
+0000f2d0: 6564 5b55 5f58 5041 5448 5d0a 2020 2020  ed[U_XPATH].    
+0000f2e0: 2020 2020 2020 2020 6966 2078 7061 7468          if xpath
+0000f2f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f300: 2020 7265 6765 7820 3d20 756e 7761 6e74    regex = unwant
+0000f310: 6564 5b55 5f52 4547 4558 5d0a 2020 2020  ed[U_REGEX].    
+0000f320: 2020 2020 2020 2020 2020 2020 7265 6765              rege
+0000f330: 785f 636f 6d70 203d 2072 652e 636f 6d70  x_comp = re.comp
+0000f340: 696c 6528 7265 6765 7829 2069 6620 7265  ile(regex) if re
+0000f350: 6765 7820 656c 7365 204e 6f6e 650a 2020  gex else None.  
+0000f360: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000f370: 656d 7320 3d20 746f 705f 656c 656d 2e78  ems = top_elem.x
+0000f380: 7061 7468 2878 7061 7468 290a 2020 2020  path(xpath).    
+0000f390: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000f3a0: 656c 656d 2069 6e20 656c 656d 733a 0a20  elem in elems:. 
+0000f3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f3c0: 2020 2074 6578 7420 3d20 4874 6d6c 5574     text = HtmlUt
+0000f3d0: 696c 2e67 6574 5f74 6578 745f 636f 6e74  il.get_text_cont
+0000f3e0: 656e 7428 656c 656d 290a 2020 2020 2020  ent(elem).      
+0000f3f0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0000f400: 7463 6865 6420 3d20 7265 6765 785f 636f  tched = regex_co
+0000f410: 6d70 2e73 6561 7263 6828 7465 7874 2920  mp.search(text) 
+0000f420: 6966 2072 6567 6578 5f63 6f6d 7020 656c  if regex_comp el
+0000f430: 7365 2054 7275 650a 2020 2020 2020 2020  se True.        
+0000f440: 2020 2020 2020 2020 2020 2020 6966 206d              if m
+0000f450: 6174 6368 6564 3a0a 2020 2020 2020 2020  atched:.        
+0000f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f470: 636c 732e 7265 6d6f 7665 5f65 6c65 6d5f  cls.remove_elem_
+0000f480: 6b65 6570 5f74 6169 6c28 656c 656d 290a  keep_tail(elem).
+0000f490: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+0000f4a0: 640a 2020 2020 6465 6620 7265 6d6f 7665  d.    def remove
+0000f4b0: 5f6e 6577 6c69 6e65 7328 636c 732c 2065  _newlines(cls, e
+0000f4c0: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
+0000f4d0: 2272 656d 6f76 6520 5c6e 2222 220a 2020  "remove \n""".  
+0000f4e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000f4f0: 2020 4d61 7962 6520 6d6f 7665 2074 6f20    Maybe move to 
+0000f500: 4854 4d4c 5469 6479 0a20 2020 2020 2020  HTMLTidy.       
+0000f510: 2022 2222 0a0a 2020 2020 2020 2020 666f   """..        fo
+0000f520: 7220 656c 2069 6e20 656c 656d 2e78 7061  r el in elem.xpa
+0000f530: 7468 2822 2e2f 2f2a 5b6e 6f74 282a 295d  th(".//*[not(*)]
+0000f540: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+0000f550: 7465 7874 203d 2048 746d 6c55 7469 6c2e  text = HtmlUtil.
+0000f560: 6765 745f 7465 7874 5f63 6f6e 7465 6e74  get_text_content
+0000f570: 2865 6c29 0a20 2020 2020 2020 2020 2020  (el).           
+0000f580: 2074 6578 7431 203d 2074 6578 742e 7265   text1 = text.re
+0000f590: 706c 6163 6528 275c 6e27 2c20 2727 290a  place('\n', '').
+0000f5a0: 2020 2020 2020 2020 2020 2020 6966 2074              if t
+0000f5b0: 6578 7431 2021 3d20 7465 7874 3a0a 2020  ext1 != text:.  
+0000f5c0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+0000f5d0: 2e74 6578 7420 3d20 7465 7874 310a 0a20  .text = text1.. 
+0000f5e0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+0000f5f0: 2020 2020 6465 6620 7265 6d6f 7665 5f73      def remove_s
+0000f600: 7479 6c65 2863 6c73 2c20 7870 6174 685f  tyle(cls, xpath_
+0000f610: 726f 6f74 5f65 6c65 6d2c 206e 616d 6573  root_elem, names
+0000f620: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+0000f630: 2020 2020 2020 2072 656d 6f76 6573 206e         removes n
+0000f640: 616d 652d 7661 6c75 6520 7061 6972 7320  ame-value pairs 
+0000f650: 6672 6f6d 2063 7373 2d73 7479 6c65 2061  from css-style a
+0000f660: 6e64 2072 6561 7070 6c79 2074 6f20 7870  nd reapply to xp
+0000f670: 6174 6827 6564 2065 6c65 6d65 6e74 7322  ath'ed elements"
+0000f680: 2222 0a20 2020 2020 2020 2022 2222 0a20  "".        """. 
+0000f690: 2020 2020 2020 204d 6179 6265 206d 6f76         Maybe mov
+0000f6a0: 6520 746f 2048 544d 4c54 6964 790a 2020  e to HTMLTidy.  
+0000f6b0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+0000f6c0: 2020 2078 7061 7468 203d 2066 222e 2f2f     xpath = f".//
+0000f6d0: 2a5b 4073 7479 6c65 5d22 0a20 2020 2020  *[@style]".     
+0000f6e0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000f6f0: 2020 2020 7374 796c 6564 5f65 6c65 6d73      styled_elems
+0000f700: 203d 2078 7061 7468 5f72 6f6f 745f 656c   = xpath_root_el
+0000f710: 656d 2e78 7061 7468 2878 7061 7468 290a  em.xpath(xpath).
+0000f720: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+0000f730: 542e 5850 6174 6845 7661 6c45 7272 6f72  T.XPathEvalError
+0000f740: 2061 7320 7870 6565 3a0a 2020 2020 2020   as xpee:.      
+0000f750: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+0000f760: 6545 7272 6f72 2866 2242 6164 2078 7061  eError(f"Bad xpa
+0000f770: 7468 207b 7870 6174 687d 2229 0a0a 2020  th {xpath}")..  
+0000f780: 2020 2020 2020 666f 7220 7374 796c 6564        for styled
+0000f790: 5f65 6c65 6d20 696e 2073 7479 6c65 645f  _elem in styled_
+0000f7a0: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
+0000f7b0: 2020 2063 7373 5f73 7479 6c65 203d 2043     css_style = C
+0000f7c0: 5353 5374 796c 652e 6372 6561 7465 5f63  SSStyle.create_c
+0000f7d0: 7373 5f73 7479 6c65 5f66 726f 6d5f 6174  ss_style_from_at
+0000f7e0: 7472 6962 7574 655f 6f66 5f62 6f64 795f  tribute_of_body_
+0000f7f0: 656c 656d 656e 7428 7374 796c 6564 5f65  element(styled_e
+0000f800: 6c65 6d29 0a20 2020 2020 2020 2020 2020  lem).           
+0000f810: 2063 7373 5f73 7479 6c65 2e72 656d 6f76   css_style.remov
+0000f820: 6528 6e61 6d65 7329 0a20 2020 2020 2020  e(names).       
+0000f830: 2020 2020 2063 7373 5f73 7479 6c65 2e61       css_style.a
+0000f840: 7070 6c79 5f74 6f28 7374 796c 6564 5f65  pply_to(styled_e
+0000f850: 6c65 6d29 0a20 2020 2020 2020 2020 2020  lem).           
+0000f860: 2073 7479 6c65 203d 2048 746d 6c53 7479   style = HtmlSty
+0000f870: 6c65 2e67 6574 5f63 7373 7374 796c 655f  le.get_cssstyle_
+0000f880: 7374 7269 6e67 2873 7479 6c65 645f 656c  string(styled_el
+0000f890: 656d 290a 0a20 2020 2040 636c 6173 736d  em)..    @classm
+0000f8a0: 6574 686f 640a 2020 2020 6465 6620 6578  ethod.    def ex
+0000f8b0: 7472 6163 745f 7375 6273 7472 696e 6773  tract_substrings
+0000f8c0: 2863 6c73 2c20 656c 656d 2c20 7870 6174  (cls, elem, xpat
+0000f8d0: 683d 4e6f 6e65 2c20 7265 6765 783d 4e6f  h=None, regex=No
+0000f8e0: 6e65 2c20 7265 6d6f 7665 3d46 616c 7365  ne, remove=False
+0000f8f0: 2c20 696e 636c 7564 655f 6e6f 6e65 3d46  , include_none=F
+0000f900: 616c 7365 2c20 6164 645f 6964 3d46 616c  alse, add_id=Fal
+0000f910: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
+0000f920: 6765 7473 2073 7562 7374 7269 6e67 2066  gets substring f
+0000f930: 726f 6d20 626f 6479 206f 6620 7465 7874  rom body of text
+0000f940: 2069 6e20 656c 656d 0a20 2020 2020 2020   in elem.       
+0000f950: 2072 6567 6578 206f 6620 666f 726d 2028   regex of form (
+0000f960: 3f50 3c70 7265 3e29 283f 503c 626f 6479  ?P<pre>)(?P<body
+0000f970: 3e29 283f 503c 706f 7374 3e29 0a20 2020  >)(?P<post>).   
+0000f980: 2020 2020 2070 7265 2061 6e64 206f 7220       pre and or 
+0000f990: 706f 7374 2063 616e 2062 6520 6d69 7373  post can be miss
+0000f9a0: 696e 670a 2020 2020 2020 2020 2854 6865  ing.        (The
+0000f9b0: 7265 2077 696c 6c20 6265 2062 6574 7465  re will be bette
+0000f9c0: 7220 7761 7973 206f 6620 646f 696e 6720  r ways of doing 
+0000f9d0: 7468 6973 2129 0a20 2020 2020 2020 203a  this!).        :
+0000f9e0: 7061 7261 6d20 656c 656d 3a74 6f20 7175  param elem:to qu
+0000f9f0: 6572 790a 2020 2020 2020 2020 3a70 6172  ery.        :par
+0000fa00: 616d 2078 7061 7468 3a20 746f 2066 696e  am xpath: to fin
+0000fa10: 6420 6465 7363 656e 6461 6e74 2073 7562  d descendant sub
+0000fa20: 656c 656d 656e 740a 2020 2020 2020 2020  element.        
+0000fa30: 3a70 6172 616d 2072 6567 6578 3a20 746f  :param regex: to
+0000fa40: 2066 696e 6420 7374 7269 6e67 2069 6e20   find string in 
+0000fa50: 7375 6265 6c65 6d65 6e74 2028 6d75 7374  subelement (must
+0000fa60: 2068 6176 6520 3320 6361 7074 7572 6520   have 3 capture 
+0000fa70: 6772 6f75 7073 290a 2020 2020 2020 2020  groups).        
+0000fa80: 3a70 6172 616d 2072 656d 6f76 653a 2072  :param remove: r
+0000fa90: 656d 6f76 6573 2062 6f64 7920 7465 7874  emoves body text
+0000faa0: 2061 6e64 206a 6f69 6e73 2070 7265 2074   and joins pre t
+0000fab0: 6f20 706f 7374 2028 7573 6520 7769 7468  o post (use with
+0000fac0: 2063 6172 652c 2064 6566 6175 6c74 2046   care, default F
+0000fad0: 616c 7365 290a 2020 2020 2020 2020 3a70  alse).        :p
+0000fae0: 6172 616d 2069 6e63 6c75 6465 5f6e 6f6e  aram include_non
+0000faf0: 653a 2049 6620 7472 7565 2069 6e63 6c75  e: If true inclu
+0000fb00: 6465 2066 6169 6c65 6420 6d61 7463 6865  de failed matche
+0000fb10: 7320 6173 204e 6f6e 653b 2064 6566 6175  s as None; defau
+0000fb20: 6c74 2046 616c 7365 0a20 2020 2020 2020  lt False.       
+0000fb30: 203a 7061 7261 6d5f 6164 645f 6964 3a20   :param_add_id: 
+0000fb40: 6164 6420 6578 7472 6163 7465 6420 7465  add extracted te
+0000fb50: 7874 2061 7320 6174 7472 6962 7574 6520  xt as attribute 
+0000fb60: 6f6e 2073 7562 656c 656d 656e 740a 2020  on subelement.  
+0000fb70: 2020 2020 2020 6966 2070 7265 2061 6e64        if pre and
+0000fb80: 2074 6169 6c20 6172 6520 7072 6573 656e   tail are presen
+0000fb90: 742c 2065 6c65 6d2e 7465 7874 203d 3c20  t, elem.text =< 
+0000fba0: 7072 652b 706f 7374 0a20 2020 2020 2020  pre+post.       
+0000fbb0: 2069 6620 7072 6520 6973 206d 6973 7369   if pre is missi
+0000fbc0: 6e67 2065 6c65 6d2e 7465 7874 203d 3e20  ng elem.text => 
+0000fbd0: 706f 7374 0a20 2020 2020 2020 2069 6620  post.        if 
+0000fbe0: 7461 696c 2069 7320 6d69 7373 696e 6720  tail is missing 
+0000fbf0: 656c 656d 2e74 6578 7420 3d3e 2070 7265  elem.text => pre
+0000fc00: 0a20 2020 2020 2020 2069 6620 626f 7468  .        if both
+0000fc10: 2061 7265 206d 6973 7369 6e67 206e 6f20   are missing no 
+0000fc20: 7265 6d6f 7661 6c0a 2020 2020 2020 2020  removal.        
+0000fc30: 3a72 6574 7572 6e3a 2072 6567 6578 2e6d  :return: regex.m
+0000fc40: 6174 6368 2e67 726f 7570 696e 6465 7828  atch.groupindex(
+0000fc50: 3f50 3c62 6f64 793e 2920 6966 206d 6174  ?P<body>) if mat
+0000fc60: 6368 6564 2065 6c73 6520 4e6f 6e65 0a20  ched else None. 
+0000fc70: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000fc80: 2020 2073 7562 5f65 6c65 6d73 203d 2065     sub_elems = e
+0000fc90: 6c65 6d2e 7870 6174 6828 7870 6174 6829  lem.xpath(xpath)
+0000fca0: 0a20 2020 2020 2020 2073 7562 5f65 6c65  .        sub_ele
+0000fcb0: 6d20 3d20 7375 625f 656c 656d 735b 305d  m = sub_elems[0]
+0000fcc0: 2069 6620 6c65 6e28 7375 625f 656c 656d   if len(sub_elem
+0000fcd0: 7329 203e 2030 2065 6c73 6520 4e6f 6e65  s) > 0 else None
+0000fce0: 0a20 2020 2020 2020 2073 7562 7374 7269  .        substri
+0000fcf0: 6e67 7320 3d20 5b5d 0a20 2020 2020 2020  ngs = [].       
+0000fd00: 2072 6530 203d 2072 652e 636f 6d70 696c   re0 = re.compil
+0000fd10: 6528 7265 6765 7829 0a20 2020 2020 2020  e(regex).       
+0000fd20: 2066 6f72 2073 7562 5f65 6c65 6d20 696e   for sub_elem in
+0000fd30: 2073 7562 5f65 6c65 6d73 3a0a 2020 2020   sub_elems:.    
+0000fd40: 2020 2020 2020 2020 7375 6273 7472 696e          substrin
+0000fd50: 6720 3d20 636c 732e 6578 7472 6163 745f  g = cls.extract_
+0000fd60: 7375 6273 7472 696e 6728 7265 302c 2072  substring(re0, r
+0000fd70: 656d 6f76 652c 2073 7562 5f65 6c65 6d29  emove, sub_elem)
+0000fd80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000fd90: 7375 6273 7472 696e 6720 616e 6420 6164  substring and ad
+0000fda0: 645f 6964 3a0a 2020 2020 2020 2020 2020  d_id:.          
+0000fdb0: 2020 2020 2020 7375 625f 656c 656d 2e61        sub_elem.a
+0000fdc0: 7474 7269 625b 2269 6422 5d20 3d20 7375  ttrib["id"] = su
+0000fdd0: 6273 7472 696e 670a 2020 2020 2020 2020  bstring.        
+0000fde0: 2020 2020 6966 2073 7562 7374 7269 6e67      if substring
+0000fdf0: 206f 7220 696e 636c 7564 655f 6e6f 6e65   or include_none
+0000fe00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000fe10: 2020 7375 6273 7472 696e 6773 2e61 7070    substrings.app
+0000fe20: 656e 6428 7375 6273 7472 696e 6729 0a20  end(substring). 
+0000fe30: 2020 2020 2020 2072 6574 7572 6e20 7375         return su
+0000fe40: 6273 7472 696e 6773 0a0a 2020 2020 4063  bstrings..    @c
+0000fe50: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+0000fe60: 6566 2065 7874 7261 6374 5f73 7562 7374  ef extract_subst
+0000fe70: 7269 6e67 2863 6c73 2c20 7265 302c 2072  ring(cls, re0, r
+0000fe80: 656d 6f76 652c 2073 7562 5f65 6c65 6d29  emove, sub_elem)
+0000fe90: 3a0a 2020 2020 2020 2020 6d61 7463 6820  :.        match 
+0000fea0: 3d20 7265 302e 6d61 7463 6828 7375 625f  = re0.match(sub_
+0000feb0: 656c 656d 2e74 6578 7429 0a20 2020 2020  elem.text).     
+0000fec0: 2020 2073 7562 7374 7269 6e67 203d 204e     substring = N
+0000fed0: 6f6e 650a 2020 2020 2020 2020 6966 206d  one.        if m
+0000fee0: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
+0000fef0: 2020 7375 6273 7472 696e 6720 3d20 6d61    substring = ma
+0000ff00: 7463 682e 6772 6f75 7028 2262 6f64 7922  tch.group("body"
+0000ff10: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000ff20: 2072 656d 6f76 653a 0a20 2020 2020 2020   remove:.       
+0000ff30: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0000ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ff50: 2020 7072 6520 3d20 6d61 7463 682e 6772    pre = match.gr
+0000ff60: 6f75 7028 2270 7265 2229 0a20 2020 2020  oup("pre").     
+0000ff70: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000ff80: 6f73 7420 3d20 6d61 7463 682e 6772 6f75  ost = match.grou
+0000ff90: 7028 2270 6f73 7422 290a 2020 2020 2020  p("post").      
+0000ffa0: 2020 2020 2020 2020 2020 2020 2020 7375                su
+0000ffb0: 625f 656c 656d 2e74 6578 7420 3d20 7072  b_elem.text = pr
+0000ffc0: 6520 2b20 706f 7374 0a20 2020 2020 2020  e + post.       
+0000ffd0: 2020 2020 2020 2020 2065 7863 6570 743a           except:
+0000ffe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fff0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+00010000: 2020 7265 7475 726e 2073 7562 7374 7269    return substri
+00010010: 6e67 0a0a 2020 2020 4063 6c61 7373 6d65  ng..    @classme
+00010020: 7468 6f64 0a20 2020 2064 6566 2067 6574  thod.    def get
+00010030: 5f66 6c6f 6174 2863 6c73 2c20 656c 656d  _float(cls, elem
+00010040: 2c20 6174 7472 6962 5f6e 616d 6529 3a0a  , attrib_name):.
+00010050: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00010060: 2020 2020 2020 2020 2076 616c 203d 2065           val = e
+00010070: 6c65 6d2e 6174 7472 6962 5b61 7474 7269  lem.attrib[attri
+00010080: 625f 6e61 6d65 5d0a 2020 2020 2020 2020  b_name].        
+00010090: 2020 2020 7265 7475 726e 2066 6c6f 6174      return float
+000100a0: 2876 616c 290a 2020 2020 2020 2020 6578  (val).        ex
+000100b0: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+000100c0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+000100d0: 2072 6574 7572 6e20 4e6f 6e65 0a0a 2020   return None..  
+000100e0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+000100f0: 2020 2064 6566 2063 6865 636b 5f74 6167     def check_tag
+00010100: 2863 6c73 2c20 656c 656d 2c20 7461 6729  (cls, elem, tag)
+00010110: 3a0a 2020 2020 2020 2020 2222 2263 6865  :.        """che
+00010120: 636b 7320 7468 6174 2065 6c65 6d20 6973  cks that elem is
+00010130: 2061 6e20 456c 656d 656e 7420 7769 7468   an Element with
+00010140: 2067 6976 656e 2074 6167 2222 220a 2020   given tag""".  
+00010150: 2020 2020 2020 7265 7475 726e 2074 7970        return typ
+00010160: 6528 656c 656d 2920 6973 2045 542e 5f45  e(elem) is ET._E
+00010170: 6c65 6d65 6e74 2061 6e64 2065 6c65 6d2e  lement and elem.
+00010180: 7461 6720 3d3d 2074 6167 0a0a 2020 2020  tag == tag..    
+00010190: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+000101a0: 2064 6566 2067 6574 5f69 6428 636c 732c   def get_id(cls,
+000101b0: 2064 6976 293a 0a20 2020 2020 2020 2022   div):.        "
+000101c0: 2222 6765 7473 2076 616c 7565 206f 6620  ""gets value of 
+000101d0: 2269 6422 2061 7474 7269 6275 7465 0a20  "id" attribute. 
+000101e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000101f0: 2020 2072 6574 7572 6e20 4e6f 6e65 2069     return None i
+00010200: 6620 6469 7620 6973 204e 6f6e 6520 656c  f div is None el
+00010210: 7365 2064 6976 2e61 7474 7269 622e 6765  se div.attrib.ge
+00010220: 7428 2269 6422 290a 0a20 2020 2040 636c  t("id")..    @cl
+00010230: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00010240: 6620 616e 616c 797a 655f 7374 796c 6573  f analyze_styles
+00010250: 2863 6c73 2c20 656c 656d 293a 0a20 2020  (cls, elem):.   
+00010260: 2020 2020 2068 6561 645f 7374 796c 655f       head_style_
+00010270: 656c 656d 7320 3d20 4874 6d6c 5374 796c  elems = HtmlStyl
+00010280: 652e 6765 745f 6865 6164 5f73 7479 6c65  e.get_head_style
+00010290: 7328 656c 656d 290a 2020 2020 2020 2020  s(elem).        
+000102a0: 7072 696e 7428 6622 6865 6164 2073 7479  print(f"head sty
+000102b0: 6c65 2065 6c65 6d73 207b 6c65 6e28 6865  le elems {len(he
+000102c0: 6164 5f73 7479 6c65 5f65 6c65 6d73 297d  ad_style_elems)}
+000102d0: 2229 0a20 2020 2020 2020 2062 6f64 795f  ").        body_
+000102e0: 636c 6173 7372 6566 7320 3d20 4874 6d6c  classrefs = Html
+000102f0: 5374 796c 652e 6765 745f 626f 6479 5f63  Style.get_body_c
+00010300: 6c61 7373 7265 6673 2865 6c65 6d29 0a20  lassrefs(elem). 
+00010310: 2020 2020 2020 2070 7269 6e74 2866 2262         print(f"b
+00010320: 6f64 7920 636c 6173 7372 6566 7320 7b6c  ody classrefs {l
+00010330: 656e 2862 6f64 795f 636c 6173 7372 6566  en(body_classref
+00010340: 7329 7d22 290a 2020 2020 2020 2020 666f  s)}").        fo
+00010350: 6e74 5f73 697a 655f 6469 6374 203d 2064  nt_size_dict = d
+00010360: 6566 6175 6c74 6469 6374 286c 6973 7429  efaultdict(list)
+00010370: 0a20 2020 2020 2020 2066 616d 696c 795f  .        family_
+00010380: 6469 6374 203d 2064 6566 6175 6c74 6469  dict = defaultdi
+00010390: 6374 286c 6973 7429 0a20 2020 2020 2020  ct(list).       
+000103a0: 2066 6f72 2068 6561 645f 7374 796c 655f   for head_style_
+000103b0: 656c 656d 2069 6e20 6865 6164 5f73 7479  elem in head_sty
+000103c0: 6c65 5f65 6c65 6d73 3a0a 2020 2020 2020  le_elems:.      
+000103d0: 2020 2020 2020 6865 6164 5f73 7479 6c65        head_style
+000103e0: 2c20 6373 7373 7472 203d 2048 746d 6c53  , cssstr = HtmlS
+000103f0: 7479 6c65 2e65 7874 7261 6374 5f63 6c61  tyle.extract_cla
+00010400: 7373 7265 665f 616e 645f 6373 7373 7472  ssref_and_cssstr
+00010410: 696e 675f 6672 6f6d 5f68 746d 6c5f 7374  ing_from_html_st
+00010420: 796c 6528 6865 6164 5f73 7479 6c65 5f65  yle(head_style_e
+00010430: 6c65 6d29 0a20 2020 2020 2020 2020 2020  lem).           
+00010440: 2063 7373 5f73 7479 6c65 203d 2043 5353   css_style = CSS
+00010450: 5374 796c 652e 6372 6561 7465 5f63 7373  Style.create_css
+00010460: 5f73 7479 6c65 5f66 726f 6d5f 6373 735f  _style_from_css_
+00010470: 7374 7269 6e67 2863 7373 7374 7229 0a20  string(cssstr). 
+00010480: 2020 2020 2020 2020 2020 2066 6f6e 745f             font_
+00010490: 7369 7a65 203d 2063 7373 5f73 7479 6c65  size = css_style
+000104a0: 2e66 6f6e 745f 7369 7a65 0a20 2020 2020  .font_size.     
+000104b0: 2020 2020 2020 2066 6f6e 745f 7369 7a65         font_size
+000104c0: 5f64 6963 745b 7374 7228 666f 6e74 5f73  _dict[str(font_s
+000104d0: 697a 6529 5d2e 6170 7065 6e64 2863 7373  ize)].append(css
+000104e0: 7374 7229 0a20 2020 2020 2020 2020 2020  str).           
+000104f0: 2066 6f6e 745f 6661 6d69 6c79 203d 2063   font_family = c
+00010500: 7373 5f73 7479 6c65 2e66 6f6e 745f 6661  ss_style.font_fa
+00010510: 6d69 6c79 0a20 2020 2020 2020 2020 2020  mily.           
+00010520: 2066 616d 696c 795f 6469 6374 5b66 6f6e   family_dict[fon
+00010530: 745f 6661 6d69 6c79 5d2e 6170 7065 6e64  t_family].append
+00010540: 2863 7373 7374 7229 0a0a 2020 2020 2020  (cssstr)..      
+00010550: 2020 2020 2020 626f 6479 5f65 6c65 6d73        body_elems
+00010560: 203d 2063 6c73 2e67 6574 5f62 6f64 795f   = cls.get_body_
+00010570: 656c 656d 656e 7473 5f62 795f 636c 6173  elements_by_clas
+00010580: 7328 656c 656d 2c20 6865 6164 5f73 7479  s(elem, head_sty
+00010590: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
+000105a0: 626f 6479 5f65 6c65 6d73 5f73 7472 203d  body_elems_str =
+000105b0: 2027 5c6e 2020 2020 2027 2e6a 6f69 6e28   '\n     '.join(
+000105c0: 5b65 6c65 6d2e 7465 7874 2066 6f72 2065  [elem.text for e
+000105d0: 6c65 6d20 696e 2062 6f64 795f 656c 656d  lem in body_elem
+000105e0: 735b 3a33 5d5d 290a 2020 2020 2020 2020  s[:3]]).        
+000105f0: 2020 2020 7072 696e 7428 6622 7b68 6561      print(f"{hea
+00010600: 645f 7374 796c 657d 3a20 7b6c 656e 2862  d_style}: {len(b
+00010610: 6f64 795f 656c 656d 7329 7d20 7b63 7373  ody_elems)} {css
+00010620: 7374 727d 5c6e 2020 2020 207b 626f 6479  str}\n     {body
+00010630: 5f65 6c65 6d73 5f73 7472 7d22 290a 2020  _elems_str}").  
+00010640: 2020 2020 2020 7070 7269 6e74 2866 2273        pprint(f"s
+00010650: 697a 6520 7b66 6f6e 745f 7369 7a65 5f64  ize {font_size_d
+00010660: 6963 747d 2229 0a20 2020 2020 2020 2070  ict}").        p
+00010670: 7269 6e74 2829 0a20 2020 2020 2020 2066  rint().        f
+00010680: 6f72 2073 697a 6520 696e 2066 6f6e 745f  or size in font_
+00010690: 7369 7a65 5f64 6963 743a 0a20 2020 2020  size_dict:.     
+000106a0: 2020 2020 2020 2066 6f6e 7473 203d 2066         fonts = f
+000106b0: 6f6e 745f 7369 7a65 5f64 6963 745b 7369  ont_size_dict[si
+000106c0: 7a65 5d0a 2020 2020 2020 2020 2020 2020  ze].            
+000106d0: 6966 2074 7970 6528 666f 6e74 7329 2069  if type(fonts) i
+000106e0: 7320 6c69 7374 3a0a 2020 2020 2020 2020  s list:.        
+000106f0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+00010700: 7369 7a65 207b 6c65 6e28 666f 6e74 7329  size {len(fonts)
+00010710: 7d20 2229 0a20 2020 2020 2020 2020 2020  } ").           
+00010720: 2020 2020 2066 6f6e 7473 7a20 3d20 275c       fontsz = '\
+00010730: 6e27 2e6a 6f69 6e28 666f 6e74 7329 0a20  n'.join(fonts). 
+00010740: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00010750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010760: 2066 6f6e 7473 7a20 3d20 666f 6e74 730a   fontsz = fonts.
+00010770: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00010780: 7428 6622 2020 7b73 697a 657d 203d 3e20  t(f"  {size} => 
+00010790: 207b 666f 6e74 737a 7d22 290a 2020 2020   {fontsz}").    
+000107a0: 2020 2020 7072 696e 7428 290a 2020 2020      print().    
+000107b0: 2020 2020 7070 7269 6e74 2866 2266 616d      pprint(f"fam
+000107c0: 696c 7920 7b66 616d 696c 795f 6469 6374  ily {family_dict
+000107d0: 7d22 290a 0a20 2020 2040 636c 6173 736d  }")..    @classm
+000107e0: 6574 686f 640a 2020 2020 6465 6620 616e  ethod.    def an
+000107f0: 616c 797a 655f 636f 6f72 6469 6e61 7465  alyze_coordinate
+00010800: 7328 636c 732c 2065 6c65 6d29 3a0a 2020  s(cls, elem):.  
+00010810: 2020 2020 2020 2320 6865 6164 5f73 7479        # head_sty
+00010820: 6c65 5f65 6c65 6d73 203d 2048 746d 6c53  le_elems = HtmlS
+00010830: 7479 6c65 2e67 6574 5f68 6561 645f 7374  tyle.get_head_st
+00010840: 796c 6573 2865 6c65 6d29 0a20 2020 2020  yles(elem).     
+00010850: 2020 2023 2070 7269 6e74 2866 2268 6561     # print(f"hea
+00010860: 6420 7374 796c 6520 656c 656d 7320 7b6c  d style elems {l
+00010870: 656e 2868 6561 645f 7374 796c 655f 656c  en(head_style_el
+00010880: 656d 7329 7d22 290a 2020 2020 2020 2020  ems)}").        
+00010890: 2320 626f 6479 5f73 7479 6c65 7320 3d20  # body_styles = 
+000108a0: 4874 6d6c 5374 796c 652e 6765 745f 626f  HtmlStyle.get_bo
+000108b0: 6479 5f63 6c61 7373 7265 6673 2865 6c65  dy_classrefs(ele
+000108c0: 6d29 0a20 2020 2020 2020 2023 2070 7269  m).        # pri
+000108d0: 6e74 2866 2262 6f64 7920 7374 796c 6573  nt(f"body styles
+000108e0: 207b 6c65 6e28 626f 6479 5f73 7479 6c65   {len(body_style
+000108f0: 7329 7d22 290a 2020 2020 2020 2020 6d61  s)}").        ma
+00010900: 7863 6861 7220 3d20 3530 0a0a 2020 2020  xchar = 50..    
+00010910: 2020 2020 636c 732e 6765 745f 6c72 7462      cls.get_lrtb
+00010920: 2865 6c65 6d2c 2022 6c65 6674 2229 0a20  (elem, "left"). 
+00010930: 2020 2020 2020 2063 6c73 2e67 6574 5f6c         cls.get_l
+00010940: 7274 6228 656c 656d 2c20 2272 6967 6874  rtb(elem, "right
+00010950: 2229 0a20 2020 2020 2020 2063 6c73 2e67  ").        cls.g
+00010960: 6574 5f6c 7274 6228 656c 656d 2c20 2279  et_lrtb(elem, "y
+00010970: 3022 2c20 636f 6c3d 3029 0a20 2020 2020  0", col=0).     
+00010980: 2020 2063 6c73 2e67 6574 5f6c 7274 6228     cls.get_lrtb(
+00010990: 656c 656d 2c20 2274 6f70 222c 206d 6172  elem, "top", mar
+000109a0: 6769 6e3d 3830 290a 0a20 2020 2040 636c  gin=80)..    @cl
+000109b0: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+000109c0: 6620 6765 745f 6c72 7462 2863 6c73 2c20  f get_lrtb(cls, 
+000109d0: 656c 656d 2c20 6469 7265 6374 696f 6e2c  elem, direction,
+000109e0: 206d 6178 6368 6172 3d35 302c 206d 696e   maxchar=50, min
+000109f0: 5f63 6f75 6e74 3d31 302c 206d 6178 5f74  _count=10, max_t
+00010a00: 6578 7473 3d33 2c20 6d61 7267 696e 3d38  exts=3, margin=8
+00010a10: 302c 206d 6564 6961 626f 783d 5b5b 302c  0, mediabox=[[0,
+00010a20: 3130 3030 5d2c 205b 302c 3130 3030 5d5d  1000], [0,1000]]
+00010a30: 2c20 636f 6c3d 3120 293a 0a20 2020 2020  , col=1 ):.     
+00010a40: 2020 2065 6c65 6d73 203d 2048 746d 6c4c     elems = HtmlL
+00010a50: 6962 2e67 6574 5f62 6f64 7928 656c 656d  ib.get_body(elem
+00010a60: 292e 7870 6174 6828 6622 2e2f 2f2a 5b40  ).xpath(f".//*[@
+00010a70: 7b64 6972 6563 7469 6f6e 7d5d 2229 0a20  {direction}]"). 
+00010a80: 2020 2020 2020 2064 6963 7478 203d 2064         dictx = d
+00010a90: 6566 6175 6c74 6469 6374 286c 6973 7429  efaultdict(list)
+00010aa0: 0a20 2020 2020 2020 2066 6f72 2065 6c65  .        for ele
+00010ab0: 6d20 696e 2065 6c65 6d73 3a0a 2020 2020  m in elems:.    
+00010ac0: 2020 2020 2020 2020 6c65 6674 203d 2048          left = H
+00010ad0: 746d 6c55 7469 6c2e 6765 745f 666c 6f61  tmlUtil.get_floa
+00010ae0: 7428 656c 656d 2c20 6469 7265 6374 696f  t(elem, directio
+00010af0: 6e29 0a20 2020 2020 2020 2020 2020 2069  n).            i
+00010b00: 6620 6c65 6674 3a0a 2020 2020 2020 2020  f left:.        
+00010b10: 2020 2020 2020 2020 6469 6374 785b 6c65          dictx[le
+00010b20: 6674 5d2e 6170 7065 6e64 2865 6c65 6d29  ft].append(elem)
+00010b30: 0a20 2020 2020 2020 2070 7269 6e74 2866  .        print(f
+00010b40: 225c 6e7b 6469 7265 6374 696f 6e7d 2229  "\n{direction}")
+00010b50: 0a20 2020 2020 2020 2072 6f77 7320 3d20  .        rows = 
+00010b60: 5b5d 0a20 2020 2020 2020 2066 6f72 206b  [].        for k
+00010b70: 6579 2069 6e20 6469 6374 782e 6b65 7973  ey in dictx.keys
+00010b80: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+00010b90: 656c 656d 7320 3d20 6469 6374 785b 6b65  elems = dictx[ke
+00010ba0: 795d 0a20 2020 2020 2020 2020 2020 2074  y].            t
+00010bb0: 6578 7473 203d 205b 656c 656d 2e78 7061  exts = [elem.xpa
+00010bc0: 7468 2822 2e2f 2f74 6578 7428 2922 295b  th(".//text()")[
+00010bd0: 305d 5b3a 6d61 7863 6861 725d 2066 6f72  0][:maxchar] for
+00010be0: 2065 6c65 6d20 696e 2065 6c65 6d73 5d0a   elem in elems].
+00010bf0: 2020 2020 2020 2020 2020 2020 656c 656d              elem
+00010c00: 636f 756e 7420 3d20 6c65 6e28 656c 656d  count = len(elem
+00010c10: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
+00010c20: 6620 656c 656d 636f 756e 7420 3e20 6d69  f elemcount > mi
+00010c30: 6e5f 636f 756e 743a 0a20 2020 2020 2020  n_count:.       
+00010c40: 2020 2020 2020 2020 2074 6578 7473 5f20           texts_ 
+00010c50: 3d20 7465 7874 735b 3a6d 6178 5f74 6578  = texts[:max_tex
+00010c60: 7473 5d0a 2020 2020 2020 2020 2020 2020  ts].            
+00010c70: 2020 2020 7072 696e 7428 6622 7b6b 6579      print(f"{key
+00010c80: 7d3a 207b 656c 656d 636f 756e 747d 207b  }: {elemcount} {
+00010c90: 7465 7874 735f 7d22 290a 2020 2020 2020  texts_}").      
+00010ca0: 2020 2020 2020 2020 2020 726f 7773 2e61            rows.a
+00010cb0: 7070 656e 6428 5b6b 6579 2c20 656c 656d  ppend([key, elem
+00010cc0: 636f 756e 742c 2074 6578 7473 5f5d 290a  count, texts_]).
+00010cd0: 2020 2020 2020 2020 726f 7773 5f20 3d20          rows_ = 
+00010ce0: 736f 7274 6564 2872 6f77 732c 206b 6579  sorted(rows, key
+00010cf0: 3d6c 616d 6264 6120 633a 2063 5b63 6f6c  =lambda c: c[col
+00010d00: 5d29 0a20 2020 2020 2020 2070 7269 6e74  ]).        print
+00010d10: 2866 2272 6f77 735c 6e7b 726f 7773 5f7d  (f"rows\n{rows_}
+00010d20: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+00010d30: 2020 2020 2320 736f 7274 6564 2873 7475      # sorted(stu
+00010d40: 6465 6e74 5f74 7570 6c65 732c 206b 6579  dent_tuples, key
+00010d50: 3d6c 616d 6264 6120 7374 7564 656e 743a  =lambda student:
+00010d60: 2073 7475 6465 6e74 5b32 5d29 0a0a 2020   student[2])..  
+00010d70: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00010d80: 2020 2064 6566 2067 6574 5f62 6f64 795f     def get_body_
+00010d90: 656c 656d 656e 7473 5f62 795f 636c 6173  elements_by_clas
+00010da0: 7328 636c 732c 2065 6c65 6d2c 2068 6561  s(cls, elem, hea
+00010db0: 645f 7374 796c 6529 3a0a 2020 2020 2020  d_style):.      
+00010dc0: 2020 6966 2068 6561 645f 7374 796c 652e    if head_style.
+00010dd0: 7374 6172 7473 7769 7468 2827 2e27 293a  startswith('.'):
+00010de0: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
+00010df0: 645f 7374 796c 6520 3d20 6865 6164 5f73  d_style = head_s
+00010e00: 7479 6c65 5b31 3a5d 0a20 2020 2020 2020  tyle[1:].       
+00010e10: 2062 6f64 795f 656c 656d 7320 3d20 656c   body_elems = el
+00010e20: 656d 2e78 7061 7468 2866 222e 2f62 6f64  em.xpath(f"./bod
+00010e30: 792f 2f2a 5b40 636c 6173 733d 277b 6865  y//*[@class='{he
+00010e40: 6164 5f73 7479 6c65 7d27 5d22 290a 2020  ad_style}']").  
+00010e50: 2020 2020 2020 7265 7475 726e 2062 6f64        return bod
+00010e60: 795f 656c 656d 730a 0a20 2020 2040 636c  y_elems..    @cl
+00010e70: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00010e80: 6620 636c 6561 6e5f 7772 6974 655f 6874  f clean_write_ht
+00010e90: 6d6c 2863 6c73 2c20 696e 5f68 746d 6c2c  ml(cls, in_html,
+00010ea0: 206f 7574 5f68 746d 6c2c 2070 7265 7474   out_html, prett
+00010eb0: 795f 7072 696e 743d 5472 7565 293a 0a20  y_print=True):. 
+00010ec0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00010ed0: 2020 2050 6172 7365 2072 6177 2048 544d     Parse raw HTM
+00010ee0: 4c20 286e 6f74 2061 6c77 6179 7320 7765  L (not always we
+00010ef0: 6c6c 2d66 6f72 6d65 6429 202c 206d 616b  ll-formed) , mak
+00010f00: 6520 7765 6c6c 666f 726d 6564 2061 6e64  e wellformed and
+00010f10: 206f 7074 696f 6e61 6c6c 7920 7072 6574   optionally pret
+00010f20: 7479 2070 7269 6e74 0a20 2020 2020 2020  ty print.       
+00010f30: 203a 7061 7261 6d20 696e 5f68 746d 6c3a   :param in_html:
+00010f40: 2069 6e70 7574 2068 746d 6c20 6669 6c65   input html file
+00010f50: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00010f60: 6f75 745f 6874 6d6c 3a20 6f75 7470 7574  out_html: output
+00010f70: 2066 696c 650a 2020 2020 2020 2020 3a70   file.        :p
+00010f80: 6172 616d 2070 7265 7474 795f 7072 696e  aram pretty_prin
+00010f90: 743a 206f 7574 7075 7420 666f 726d 6174  t: output format
+00010fa0: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00010fb0: 3a20 7061 7273 6564 2068 746d 6c20 656c  : parsed html el
+00010fc0: 656d 656e 740a 2020 2020 2020 2020 2222  ement.        ""
+00010fd0: 220a 2020 2020 2020 2020 6874 6d6c 5f65  ".        html_e
+00010fe0: 6c65 6d20 3d20 636c 732e 7061 7273 655f  lem = cls.parse_
+00010ff0: 6874 6d6c 5f66 696c 655f 746f 5f78 6d6c  html_file_to_xml
+00011000: 2869 6e5f 6874 6d6c 290a 2020 2020 2020  (in_html).      
+00011010: 2020 636c 732e 7772 6974 655f 6874 6d6c    cls.write_html
+00011020: 5f65 6c65 6d28 6874 6d6c 5f65 6c65 6d2c  _elem(html_elem,
+00011030: 206f 7574 5f68 746d 6c2c 2070 7265 7474   out_html, prett
+00011040: 795f 7072 696e 743d 7072 6574 7479 5f70  y_print=pretty_p
+00011050: 7269 6e74 290a 2020 2020 2020 2020 7265  rint).        re
+00011060: 7475 726e 2068 746d 6c5f 656c 656d 0a0a  turn html_elem..
+00011070: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00011080: 0a20 2020 2064 6566 2070 6172 7365 5f68  .    def parse_h
+00011090: 746d 6c5f 6669 6c65 5f74 6f5f 786d 6c28  tml_file_to_xml(
+000110a0: 636c 732c 2069 6e5f 6874 6d6c 293a 0a20  cls, in_html):. 
+000110b0: 2020 2020 2020 2022 2222 7265 6164 2075         """read u
+000110c0: 6e74 6964 7920 4854 4d4c 2069 6e74 6f20  ntidy HTML into 
+000110d0: 584d 4c0a 2020 2020 2020 2020 7573 6573  XML.        uses
+000110e0: 2048 544d 4c50 6172 7365 720a 2020 2020   HTMLParser.    
+000110f0: 2020 2020 3a70 6172 616d 2069 6e5f 6874      :param in_ht
+00011100: 6d6c 3a20 4854 4d4c 2066 696c 650a 2020  ml: HTML file.  
+00011110: 2020 2020 2020 3a72 6574 7572 6e3a 2077        :return: w
+00011120: 656c 6c5f 666f 726d 6564 2058 4854 4d4c  ell_formed XHTML
+00011130: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00011140: 2020 2020 2068 746d 6c5f 656c 656d 203d       html_elem =
+00011150: 2045 542e 7061 7273 6528 7374 7228 696e   ET.parse(str(in
+00011160: 5f68 746d 6c29 2c20 4554 2e48 544d 4c50  _html), ET.HTMLP
+00011170: 6172 7365 7228 2929 2e78 7061 7468 2822  arser()).xpath("
+00011180: 2f2a 2229 5b30 5d0a 2020 2020 2020 2020  /*")[0].        
+00011190: 7265 7475 726e 2068 746d 6c5f 656c 656d  return html_elem
+000111a0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+000111b0: 6f64 0a20 2020 2064 6566 2077 7269 7465  od.    def write
+000111c0: 5f68 746d 6c5f 656c 656d 2863 6c73 2c20  _html_elem(cls, 
+000111d0: 656c 656d 2c20 6f75 745f 6874 6d6c 2c20  elem, out_html, 
+000111e0: 7072 6574 7479 5f70 7269 6e74 3d46 616c  pretty_print=Fal
+000111f0: 7365 293a 0a20 2020 2020 2020 2022 2222  se):.        """
+00011200: 7772 6974 6520 4854 4d4c 2077 6974 6820  write HTML with 
+00011210: 6f70 7469 6f6e 616c 2070 7265 7474 795f  optional pretty_
+00011220: 7072 696e 740a 2020 2020 2020 2020 3a70  print.        :p
+00011230: 6172 616d 2065 6c65 6d3a 2048 544d 4c20  aram elem: HTML 
+00011240: 656c 656d 656e 740a 2020 2020 2020 2020  element.        
+00011250: 3a70 6172 616d 206f 7574 5f68 746d 6c3a  :param out_html:
+00011260: 2065 6974 6865 7220 6120 6669 6c65 206f   either a file o
+00011270: 7220 7379 732e 7374 646f 7574 0a20 2020  r sys.stdout.   
+00011280: 2020 2020 203a 7061 7261 6d20 7072 6574       :param pret
+00011290: 7479 5f70 7269 6e74 3a0a 2020 2020 2020  ty_print:.      
+000112a0: 2020 2272 6574 7572 6e3a 204e 6f6e 650a    "return: None.
+000112b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000112c0: 2020 2020 6966 206f 7574 5f68 746d 6c20      if out_html 
+000112d0: 3d3d 2073 7973 2e73 7464 6f75 743a 0a20  == sys.stdout:. 
+000112e0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+000112f0: 2028 4554 2e74 6f73 7472 696e 6728 656c   (ET.tostring(el
+00011300: 656d 2c20 7072 6574 7479 5f70 7269 6e74  em, pretty_print
+00011310: 3d54 7275 652c 2065 6e63 6f64 696e 673d  =True, encoding=
+00011320: 2275 6e69 636f 6465 2229 290a 2020 2020  "unicode")).    
+00011330: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00011340: 2020 2020 2020 7373 203d 2045 542e 746f        ss = ET.to
+00011350: 7374 7269 6e67 2865 6c65 6d2c 2070 7265  string(elem, pre
+00011360: 7474 795f 7072 696e 743d 7072 6574 7479  tty_print=pretty
+00011370: 5f70 7269 6e74 290a 2020 2020 2020 2020  _print).        
+00011380: 2020 2020 5061 7468 286f 7574 5f68 746d      Path(out_htm
+00011390: 6c29 2e70 6172 656e 742e 6d6b 6469 7228  l).parent.mkdir(
+000113a0: 7061 7265 6e74 733d 5472 7565 2c20 6578  parents=True, ex
+000113b0: 6973 745f 6f6b 3d54 7275 6529 0a20 2020  ist_ok=True).   
+000113c0: 2020 2020 2020 2020 2077 6974 6820 6f70           with op
+000113d0: 656e 286f 7574 5f68 746d 6c2c 2022 7762  en(out_html, "wb
+000113e0: 2229 2061 7320 663a 0a20 2020 2020 2020  ") as f:.       
+000113f0: 2020 2020 2020 2020 2066 2e77 7269 7465           f.write
+00011400: 2873 7329 0a0a 2020 2020 4063 6c61 7373  (ss)..    @class
+00011410: 6d65 7468 6f64 0a20 2020 2064 6566 2072  method.    def r
+00011420: 656d 6f76 655f 7374 796c 655f 6174 7472  emove_style_attr
+00011430: 6962 7574 6573 2863 6c73 2c20 6874 6d6c  ibutes(cls, html
+00011440: 5f65 6c65 6d29 3a0a 2020 2020 2020 2020  _elem):.        
+00011450: 2222 2272 656d 6f76 6520 4073 7479 6c65  """remove @style
+00011460: 2061 7474 7269 6275 7465 7320 6672 6f6d   attributes from
+00011470: 2065 6c65 6d65 6e74 7320 696e 2068 746d   elements in htm
+00011480: 6c5f 656c 656d 0a20 2020 2020 2020 203a  l_elem.        :
+00011490: 7061 7261 6d20 6874 6d6c 5f65 6c65 6d3a  param html_elem:
+000114a0: 2065 6c65 6d65 6e74 2074 6f20 7374 7269   element to stri
+000114b0: 700a 2020 2020 2020 2020 2222 220a 2020  p.        """.  
+000114c0: 2020 2020 2020 6966 2068 746d 6c5f 656c        if html_el
+000114d0: 656d 2069 7320 4e6f 6e65 3a0a 2020 2020  em is None:.    
+000114e0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+000114f0: 2020 2020 2020 2073 7479 6c65 5f65 6c65         style_ele
+00011500: 6d73 203d 2068 746d 6c5f 656c 656d 2e78  ms = html_elem.x
+00011510: 7061 7468 2822 2e2f 2f2a 5b40 7374 796c  path(".//*[@styl
+00011520: 655d 2229 0a20 2020 2020 2020 2066 6f72  e]").        for
+00011530: 2073 7479 6c65 5f65 6c65 6d20 696e 2073   style_elem in s
+00011540: 7479 6c65 5f65 6c65 6d73 3a0a 2020 2020  tyle_elems:.    
+00011550: 2020 2020 2020 2020 4874 6d6c 5574 696c          HtmlUtil
+00011560: 2e72 656d 6f76 655f 6174 7472 6962 7574  .remove_attribut
+00011570: 6528 7374 796c 655f 656c 656d 2c20 2273  e(style_elem, "s
+00011580: 7479 6c65 2229 0a0a 2020 2020 4063 6c61  tyle")..    @cla
+00011590: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+000115a0: 2072 656d 6f76 655f 656c 656d 7328 636c   remove_elems(cl
+000115b0: 732c 2068 746d 6c5f 656c 656d 2c20 7870  s, html_elem, xp
+000115c0: 6174 683d 4e6f 6e65 293a 0a20 2020 2020  ath=None):.     
+000115d0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+000115e0: 656d 6f76 6520 656c 656d 656e 7473 2062  emove elements b
+000115f0: 7920 7870 6174 680a 2020 2020 2020 2020  y xpath.        
+00011600: 3a70 6172 616d 2068 746d 6c5f 656c 656d  :param html_elem
+00011610: 3a20 656c 656d 656e 7420 746f 2072 656d  : element to rem
+00011620: 6f76 6520 656c 656d 656e 7420 6672 6f6d  ove element from
+00011630: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00011640: 7870 6174 683a 0a20 2020 2020 2020 2022  xpath:.        "
+00011650: 2222 0a20 2020 2020 2020 2069 6620 6874  "".        if ht
+00011660: 6d6c 5f65 6c65 6d20 6973 204e 6f6e 6520  ml_elem is None 
+00011670: 6f72 2078 7061 7468 2069 7320 4e6f 6e65  or xpath is None
+00011680: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00011690: 7475 726e 0a20 2020 2020 2020 2065 6c65  turn.        ele
+000116a0: 6d73 203d 2068 746d 6c5f 656c 656d 2e78  ms = html_elem.x
+000116b0: 7061 7468 2878 7061 7468 290a 2020 2020  path(xpath).    
+000116c0: 2020 2020 666f 7220 656c 656d 2069 6e20      for elem in 
+000116d0: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
+000116e0: 2020 2048 746d 6c55 7469 6c2e 7265 6d6f     HtmlUtil.remo
+000116f0: 7665 5f65 6c65 6d5f 6b65 6570 5f74 6169  ve_elem_keep_tai
+00011700: 6c28 656c 656d 290a 0a20 2020 2040 636c  l(elem)..    @cl
+00011710: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00011720: 6620 7265 6d6f 7665 5f65 6c65 6d65 6e74  f remove_element
+00011730: 5f69 6e5f 6869 6572 6172 6368 7928 636c  _in_hierarchy(cl
+00011740: 732c 2065 6c65 6d29 3a0a 2020 2020 2020  s, elem):.      
+00011750: 2020 2222 2272 656d 6f76 6573 2064 6976    """removes div
+00011760: 7320 6672 6f6d 206e 6573 7469 6e67 0a20  s from nesting. 
+00011770: 2020 2020 2020 2045 7861 6d70 6c65 3a0a         Example:.
+00011780: 2020 2020 2020 2020 2020 2020 3c64 6976              <div
+00011790: 2069 643d 2264 3122 3e0a 2020 2020 2020   id="d1">.      
+000117a0: 2020 2020 2020 2020 3c64 6976 2069 643d          <div id=
+000117b0: 2264 3222 3e0a 2020 2020 2020 2020 2020  "d2">.          
+000117c0: 2020 2020 2020 3c73 7061 6e20 6964 3d22        <span id="
+000117d0: 7331 223e 626c 6168 3c2f 7370 616e 3e0a  s1">blah</span>.
+000117e0: 2020 2020 2020 2020 2020 2020 2020 3c2f                </
+000117f0: 6469 763e 0a20 2020 2020 2020 2020 2020  div>.           
+00011800: 203c 2f64 6976 3e0a 2020 2020 2020 2020   </div>.        
+00011810: 2020 2020 6132 2069 7320 706c 6179 696e      a2 is playin
+00011820: 6720 6e6f 2072 6f6c 6520 696e 2067 726f  g no role in gro
+00011830: 7570 696e 672c 2073 6f20 6361 6e20 6265  uping, so can be
+00011840: 2072 656d 6f76 6564 2074 6f20 6769 7665   removed to give
+00011850: 3a0a 2020 2020 2020 2020 2020 2020 3c64  :.            <d
+00011860: 6976 2069 643d 2264 3122 3e0a 2020 2020  iv id="d1">.    
+00011870: 2020 2020 2020 2020 2020 3c73 7061 6e20            <span 
+00011880: 6964 3d22 7331 223e 626c 6168 3c2f 7370  id="s1">blah</sp
+00011890: 616e 3e0a 2020 2020 2020 2020 2020 2020  an>.            
+000118a0: 3c2f 6469 763e 0a20 2020 2020 2020 2020  </div>.         
+000118b0: 2020 2054 6869 7320 6361 6e20 6265 2072     This can be r
+000118c0: 6563 7572 7369 7665 2062 7574 2073 7061  ecursive but spa
+000118d0: 6e73 2073 686f 756c 6420 616c 7761 7973  ns should always
+000118e0: 2068 6176 6520 6469 7620 7061 7265 6e74   have div parent
+000118f0: 730a 2020 2020 2020 2020 2020 2020 3a70  s.            :p
+00011900: 6172 616d 2065 6c65 6d3a 2065 6c65 6d20  aram elem: elem 
+00011910: 746f 2072 656d 6f76 652e 2049 7473 2063  to remove. Its c
+00011920: 6869 6c64 7265 6e20 6172 6520 7472 616e  hildren are tran
+00011930: 7366 6572 6564 2074 6f20 7061 7265 6e74  sfered to parent
+00011940: 0a20 2020 2020 2020 2020 2020 2065 2e67  .            e.g
+00011950: 2e0a 2020 2020 2020 2020 2020 2020 7028  ..            p(
+00011960: 612c 656c 656d 286c 2c6d 2c6e 292c 7a29  a,elem(l,m,n),z)
+00011970: 203d 3e20 7028 612c 6c2c 6d2c 6e2c 7a29   => p(a,l,m,n,z)
+00011980: 0a20 2020 2020 2020 2020 2020 203a 7265  .            :re
+00011990: 7475 726e 3a4e 6f6e 650a 2020 2020 2020  turn:None.      
+000119a0: 2020 2222 220a 2020 2020 2020 2020 7061    """.        pa
+000119b0: 7265 6e74 203d 2065 6c65 6d2e 6765 7470  rent = elem.getp
+000119c0: 6172 656e 7428 290a 2020 2020 2020 2020  arent().        
+000119d0: 6966 2070 6172 656e 7420 6973 204e 6f6e  if parent is Non
+000119e0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+000119f0: 7269 6e74 2866 2265 6c65 6d20 6861 7320  rint(f"elem has 
+00011a00: 6e6f 2070 6172 656e 7422 290a 2020 2020  no parent").    
+00011a10: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+00011a20: 2020 2020 2020 2069 6478 203d 2070 6172         idx = par
+00011a30: 656e 742e 696e 6465 7828 656c 656d 290a  ent.index(elem).
+00011a40: 2020 2020 2020 2020 6368 696c 645f 656c          child_el
+00011a50: 656d 7320 3d20 656c 656d 2e78 7061 7468  ems = elem.xpath
+00011a60: 2822 2a22 290a 2020 2020 2020 2020 666f  ("*").        fo
+00011a70: 7220 6368 696c 645f 656c 656d 2069 6e20  r child_elem in 
+00011a80: 6368 696c 645f 656c 656d 733a 0a20 2020  child_elems:.   
+00011a90: 2020 2020 2020 2020 2070 6172 656e 742e           parent.
+00011aa0: 696e 7365 7274 2869 6478 2c20 6368 696c  insert(idx, chil
+00011ab0: 645f 656c 656d 290a 2020 2020 2020 2020  d_elem).        
+00011ac0: 7061 7265 6e74 2e72 656d 6f76 6528 656c  parent.remove(el
+00011ad0: 656d 290a 0a20 2020 2040 636c 6173 736d  em)..    @classm
+00011ae0: 6574 686f 640a 2020 2020 6465 6620 7265  ethod.    def re
+00011af0: 6d6f 7665 5f65 6c65 6d65 6e74 735f 696e  move_elements_in
+00011b00: 5f68 6965 7261 7263 6879 5f62 795f 7870  _hierarchy_by_xp
+00011b10: 6174 6828 636c 732c 2068 746d 6c2c 2078  ath(cls, html, x
+00011b20: 7061 7468 293a 0a20 2020 2020 2020 2022  path):.        "
+00011b30: 2222 6669 6e64 7320 656c 656d 656e 7473  ""finds elements
+00011b40: 2062 7920 7870 6174 6820 616e 6420 6465   by xpath and de
+00011b50: 6c65 7465 7320 7468 656d 2075 7369 6e67  letes them using
+00011b60: 2072 656d 6f76 655f 656c 656d 656e 7473   remove_elements
+00011b70: 5f69 6e5f 6869 6572 6172 6368 7928 290a  _in_hierarchy().
+00011b80: 2020 2020 2020 2020 3a70 6172 616d 2068          :param h
+00011b90: 746d 6c3a 2065 6c65 6d65 6e74 7320 746f  tml: elements to
+00011ba0: 2064 656c 6574 6520 6672 6f6d 0a20 2020   delete from.   
+00011bb0: 2020 2020 203a 7061 7261 6d20 7870 6174       :param xpat
+00011bc0: 683a 2078 7061 7468 2074 6f20 7365 6172  h: xpath to sear
+00011bd0: 6368 2077 6974 680a 2020 2020 2020 2020  ch with.        
+00011be0: 3a72 6574 7572 6e3a 2065 6c65 6d73 2074  :return: elems t
+00011bf0: 6861 7420 6861 7665 2062 6565 6e20 6465  hat have been de
+00011c00: 6c65 7465 640a 2020 2020 2020 2020 2222  leted.        ""
+00011c10: 220a 2020 2020 2020 2020 656c 656d 7320  ".        elems 
+00011c20: 3d20 6874 6d6c 2e78 7061 7468 2878 7061  = html.xpath(xpa
+00011c30: 7468 290a 2020 2020 2020 2020 666f 7220  th).        for 
+00011c40: 656c 656d 2069 6e20 656c 656d 733a 0a20  elem in elems:. 
+00011c50: 2020 2020 2020 2020 2020 2048 746d 6c55             HtmlU
+00011c60: 7469 6c2e 7265 6d6f 7665 5f65 6c65 6d65  til.remove_eleme
+00011c70: 6e74 5f69 6e5f 6869 6572 6172 6368 7928  nt_in_hierarchy(
+00011c80: 656c 656d 290a 2020 2020 2020 2020 7265  elem).        re
+00011c90: 7475 726e 2065 6c65 6d73 0a0a 2020 2020  turn elems..    
+00011ca0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00011cb0: 2064 6566 2070 6172 7365 5f68 746d 6c5f   def parse_html_
+00011cc0: 6c78 6d6c 2863 6c73 2c20 696e 6669 6c65  lxml(cls, infile
+00011cd0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00011ce0: 2020 2020 2020 2070 6172 7365 2048 544d         parse HTM
+00011cf0: 4c20 7769 7468 206c 786d 6c20 636f 6e76  L with lxml conv
+00011d00: 656e 6965 6e63 6520 6d65 7468 6f64 0a20  enience method. 
+00011d10: 2020 2020 2020 203a 7061 7261 6d20 696e         :param in
+00011d20: 6669 6c65 3a20 7374 7220 6f72 2070 6174  file: str or pat
+00011d30: 680a 2020 2020 2020 2020 3a72 6574 7572  h.        :retur
+00011d40: 6e3a 2048 544d 4c20 7472 6565 0a20 2020  n: HTML tree.   
+00011d50: 2020 2020 203a 6578 6365 7074 3a20 6361       :except: ca
+00011d60: 6e6e 6f74 2066 696e 642f 7061 7273 650a  nnot find/parse.
+00011d70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00011d80: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00011d90: 2020 2020 2068 746d 6c78 203d 2045 542e       htmlx = ET.
+00011da0: 7061 7273 6528 7374 7228 696e 6669 6c65  parse(str(infile
+00011db0: 292c 2048 544d 4c50 6172 7365 7228 2929  ), HTMLParser())
+00011dc0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00011dd0: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
+00011de0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00011df0: 6520 650a 2020 2020 2020 2020 7265 7475  e e.        retu
+00011e00: 726e 2068 746d 6c78 0a0a 0a0a 636c 6173  rn htmlx....clas
+00011e10: 7320 4874 6d6c 416e 6e6f 7461 746f 723a  s HtmlAnnotator:
+00011e20: 0a20 2020 2022 2222 696e 6c69 6e65 2061  .    """inline a
+00011e30: 6e6e 6f74 6174 6f72 2066 6f72 2048 544d  nnotator for HTM
+00011e40: 4c20 656c 656d 656e 7473 0a20 2020 2073  L elements.    s
+00011e50: 746f 7265 7320 616e 6420 7275 6e73 2041  tores and runs A
+00011e60: 6e6e 6f74 6174 6f72 436f 6d6d 616e 6473  nnotatorCommands
+00011e70: 0a0a 2020 2020 616e 6e6f 7461 746f 7220  ..    annotator 
+00011e80: 3d20 416e 6e6f 7461 746f 7228 290a 2020  = Annotator().  
+00011e90: 2020 636f 6d6d 616e 6420 3d20 416e 6e6f    command = Anno
+00011ea0: 7461 746f 7243 6f6d 6d61 6e64 2868 746d  tatorCommand(htm
+00011eb0: 6c5f 636c 6173 733d 2273 6563 7469 6f6e  l_class="section
+00011ec0: 5f74 6974 6c65 222c 2072 6567 6578 3d22  _title", regex="
+00011ed0: 5365 6374 696f 6e5c 5c73 2b28 3f50 3c69  Section\\s+(?P<i
+00011ee0: 643e 5c5c 642b 293a 5c5c 732b 283f 503c  d>\\d+):\\s+(?P<
+00011ef0: 7469 746c 653e 2e2a 2922 2c20 6164 645f  title>.*)", add_
+00011f00: 6964 3d54 7275 652c 2061 6464 5f74 6974  id=True, add_tit
+00011f10: 6c65 3d54 7275 6529 0a20 2020 2061 6e6e  le=True).    ann
+00011f20: 6f74 6174 6f72 2e61 6464 5f63 6f6d 6d61  otator.add_comma
+00011f30: 6e64 2863 6f6d 6d61 6e64 290a 2020 2020  nd(command).    
+00011f40: 616e 6e6f 7461 746f 722e 7275 6e5f 636f  annotator.run_co
+00011f50: 6d6d 616e 6473 2865 6c65 6d29 0a0a 2020  mmands(elem)..  
+00011f60: 2020 2222 220a 0a20 2020 2064 6566 205f    """..    def _
+00011f70: 5f69 6e69 745f 5f28 7365 6c66 293a 0a20  _init__(self):. 
+00011f80: 2020 2020 2020 2073 656c 662e 636f 6d6d         self.comm
+00011f90: 616e 6473 203d 205b 5d0a 0a20 2020 2064  ands = []..    d
+00011fa0: 6566 2061 6464 5f63 6f6d 6d61 6e64 2873  ef add_command(s
+00011fb0: 656c 662c 2063 6f6d 6d61 6e64 293a 0a20  elf, command):. 
+00011fc0: 2020 2020 2020 2069 6620 636f 6d6d 616e         if comman
+00011fd0: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
+00011fe0: 656c 662e 636f 6d6d 616e 6473 2e61 7070  elf.commands.app
+00011ff0: 656e 6428 636f 6d6d 616e 6429 0a0a 2020  end(command)..  
+00012000: 2020 6465 6620 7275 6e5f 636f 6d6d 616e    def run_comman
+00012010: 6473 2873 656c 662c 2074 6172 6765 745f  ds(self, target_
+00012020: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
+00012030: 2222 0a20 2020 2020 2020 2069 7465 7261  "".        itera
+00012040: 7465 2063 6f6d 6d61 6e64 7320 286f 7264  te commands (ord
+00012050: 6572 2069 7320 6f72 6465 7220 6f66 2074  er is order of t
+00012060: 6865 6972 2061 6464 6974 696f 6e0a 2020  heir addition.  
+00012070: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00012080: 2020 666f 7220 636f 6d6d 616e 6420 696e    for command in
+00012090: 2073 656c 662e 636f 6d6d 616e 6473 3a0a   self.commands:.
+000120a0: 2020 2020 2020 2020 2020 2020 636f 6d6d              comm
+000120b0: 616e 642e 7275 6e5f 636f 6d6d 616e 6428  and.run_command(
+000120c0: 7461 7267 6574 5f65 6c65 6d29 0a0a 2020  target_elem)..  
+000120d0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+000120e0: 2020 2064 6566 2063 7265 6174 655f 6970     def create_ip
+000120f0: 6363 5f61 6e6e 6f74 6174 6f72 2863 6c73  cc_annotator(cls
+00012100: 293a 0a20 2020 2020 2020 2022 2222 6120  ):.        """a 
+00012110: 7365 7420 6f66 2067 656e 6572 616c 206f  set of general o
+00012120: 7065 7261 7469 6f6e 7320 666f 7220 4950  perations for IP
+00012130: 4343 2222 220a 2020 2020 2020 2020 616e  CC""".        an
+00012140: 6e6f 7461 746f 7220 3d20 4874 6d6c 416e  notator = HtmlAn
+00012150: 6e6f 7461 746f 7228 290a 2020 2020 2020  notator().      
+00012160: 2020 616e 6e6f 7461 746f 722e 6164 645f    annotator.add_
+00012170: 636f 6d6d 616e 6428 0a20 2020 2020 2020  command(.       
+00012180: 2020 2020 2041 6e6e 6f74 6174 6f72 436f       AnnotatorCo
+00012190: 6d6d 616e 6428 6874 6d6c 5f63 6c61 7373  mmand(html_class
+000121a0: 3d22 7365 6374 696f 6e5f 7469 746c 6522  ="section_title"
+000121b0: 2c20 7265 6765 783d 2253 6563 7469 6f6e  , regex="Section
+000121c0: 5c5c 732b 283f 503c 6964 3e5c 5c64 2b29  \\s+(?P<id>\\d+)
+000121d0: 3a5c 5c73 2b28 3f50 3c74 6974 6c65 3e2e  :\\s+(?P<title>.
+000121e0: 2a29 222c 0a20 2020 2020 2020 2020 2020  *)",.           
+000121f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012200: 2020 6164 645f 6964 3d22 7365 6374 696f    add_id="sectio
+00012210: 6e5f 7c22 2c20 6164 645f 7469 746c 653d  n_|", add_title=
+00012220: 227c 222c 2073 7479 6c65 3d22 7b63 6f6c  "|", style="{col
+00012230: 6f72 203a 2062 6c75 653b 2062 6163 6b67  or : blue; backg
+00012240: 726f 756e 6420 3a20 7069 6e6b 3b7d 222c  round : pink;}",
+00012250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012260: 2020 2020 2020 2020 2020 2020 2064 6573               des
+00012270: 633d 2261 6464 2069 6420 616e 6420 7469  c="add id and ti
+00012280: 746c 6520 666f 7220 2753 6563 7469 6f6e  tle for 'Section
+00012290: 3a20 2e2e 2e27 2229 0a20 2020 2020 2020  : ...'").       
+000122a0: 2029 0a20 2020 2020 2020 2061 6e6e 6f74   ).        annot
+000122b0: 6174 6f72 2e61 6464 5f63 6f6d 6d61 6e64  ator.add_command
+000122c0: 280a 2020 2020 2020 2020 2020 2020 416e  (.            An
+000122d0: 6e6f 7461 746f 7243 6f6d 6d61 6e64 2868  notatorCommand(h
+000122e0: 746d 6c5f 636c 6173 733d 2273 7562 5f73  tml_class="sub_s
+000122f0: 6563 7469 6f6e 5f74 6974 6c65 222c 2072  ection_title", r
+00012300: 6567 6578 3d22 5c5c 732a 283f 503c 6964  egex="\\s*(?P<id
+00012310: 3e5c 5c64 2b5c 5c2e 5c5c 642b 295c 5c73  >\\d+\\.\\d+)\\s
+00012320: 2b28 3f50 3c74 6974 6c65 3e2e 2a29 222c  +(?P<title>.*)",
+00012330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012340: 2020 2020 2020 2020 2020 2020 2020 6164                ad
+00012350: 645f 6964 3d22 7375 6273 6563 7469 6f6e  d_id="subsection
+00012360: 5f7c 222c 2061 6464 5f74 6974 6c65 3d22  _|", add_title="
+00012370: 7c22 2c20 7374 796c 653d 227b 636f 6c6f  |", style="{colo
+00012380: 7220 3a20 6772 6565 6e3b 2062 6163 6b67  r : green; backg
+00012390: 726f 756e 6420 3a20 7965 6c6c 6f77 3b7d  round : yellow;}
+000123a0: 2229 290a 2020 2020 2020 2020 616e 6e6f  ")).        anno
+000123b0: 7461 746f 722e 6164 645f 636f 6d6d 616e  tator.add_comman
+000123c0: 6428 0a20 2020 2020 2020 2020 2020 2041  d(.            A
+000123d0: 6e6e 6f74 6174 6f72 436f 6d6d 616e 6428  nnotatorCommand(
+000123e0: 6874 6d6c 5f63 6c61 7373 3d22 7375 625f  html_class="sub_
+000123f0: 7375 625f 7365 6374 696f 6e5f 7469 746c  sub_section_titl
+00012400: 6522 2c20 7265 6765 783d 225e 5c5c 732a  e", regex="^\\s*
+00012410: 283f 503c 6964 3e5c 5c64 2b5c 5c2e 5c5c  (?P<id>\\d+\\.\\
+00012420: 642b 5c5c 2e5c 5c64 2b29 5c5c 732b 283f  d+\\.\\d+)\\s+(?
+00012430: 503c 7469 746c 653e 2e2a 2922 2c0a 2020  P<title>.*)",.  
+00012440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012450: 2020 2020 2020 2020 2020 2061 6464 5f69             add_i
+00012460: 643d 2273 7562 7365 6374 696f 6e5f 7c22  d="subsection_|"
+00012470: 2c20 6164 645f 7469 746c 653d 227c 222c  , add_title="|",
+00012480: 2073 7479 6c65 3d22 7b63 6f6c 6f72 203a   style="{color :
+00012490: 2062 6c61 636b 3b20 6261 636b 6772 6f75   black; backgrou
+000124a0: 6e64 203a 2023 6464 6464 6464 3b7d 2229  nd : #dddddd;}")
+000124b0: 290a 2020 2020 2020 2020 616e 6e6f 7461  ).        annota
+000124c0: 746f 722e 6164 645f 636f 6d6d 616e 6428  tor.add_command(
+000124d0: 0a20 2020 2020 2020 2020 2020 2041 6e6e  .            Ann
+000124e0: 6f74 6174 6f72 436f 6d6d 616e 6428 6874  otatorCommand(ht
+000124f0: 6d6c 5f63 6c61 7373 3d22 636f 6e66 6964  ml_class="confid
+00012500: 656e 6365 222c 0a20 2020 2020 2020 2020  ence",.         
+00012510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012520: 2020 2020 7265 6765 783d 225e 5c5c 732a      regex="^\\s*
+00012530: 5c5c 283f 283f 503c 7469 746c 653e 2876  \\(?(?P<title>(v
+00012540: 6572 7920 6869 6768 7c68 6967 687c 6d65  ery high|high|me
+00012550: 6469 756d 7c6c 6f77 2920 636f 6e66 6964  dium|low) confid
+00012560: 656e 6365 295c 5c29 3f22 2c0a 2020 2020  ence)\\)?",.    
+00012570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012580: 2020 2020 2020 2020 2061 6464 5f69 643d           add_id=
+00012590: 2263 6f6e 6669 6465 6e63 655f 7c22 2c20  "confidence_|", 
+000125a0: 6164 645f 7469 746c 653d 227c 222c 2073  add_title="|", s
+000125b0: 7479 6c65 3d22 7b63 6f6c 6f72 203a 2062  tyle="{color : b
+000125c0: 6c61 636b 3b20 6261 636b 6772 6f75 6e64  lack; background
+000125d0: 203a 2023 6464 3838 6464 3b7d 2229 290a   : #dd88dd;}")).
+000125e0: 2020 2020 2020 2020 616e 6e6f 7461 746f          annotato
+000125f0: 722e 6164 645f 636f 6d6d 616e 6428 0a20  r.add_command(. 
+00012600: 2020 2020 2020 2020 2020 2041 6e6e 6f74             Annot
+00012610: 6174 6f72 436f 6d6d 616e 6428 6874 6d6c  atorCommand(html
+00012620: 5f63 6c61 7373 3d22 7072 6f62 6162 696c  _class="probabil
+00012630: 6974 7922 2c0a 2020 2020 2020 2020 2020  ity",.          
+00012640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012650: 2020 2072 6567 6578 3d22 5e5c 5c73 2a5c     regex="^\\s*\
+00012660: 5c28 3f28 3f50 3c74 6974 6c65 3e28 6c69  \(?(?P<title>(li
+00012670: 6b65 6c79 7c76 6572 7920 6c69 6b65 6c79  kely|very likely
+00012680: 7c65 7874 7265 6d65 6c79 206c 696b 656c  |extremely likel
+00012690: 797c 7669 7274 7561 6c6c 7920 6365 7274  y|virtually cert
+000126a0: 6169 6e29 295c 5c29 3f22 2c0a 2020 2020  ain))\\)?",.    
+000126b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126c0: 2020 2020 2020 2020 2061 6464 5f69 643d           add_id=
+000126d0: 2270 726f 6261 6269 6c69 7479 5f7c 222c  "probability_|",
+000126e0: 2061 6464 5f74 6974 6c65 3d22 7c22 2c20   add_title="|", 
+000126f0: 7374 796c 653d 227b 636f 6c6f 7220 3a20  style="{color : 
+00012700: 6379 616e 3b20 6261 636b 6772 6f75 6e64  cyan; background
+00012710: 203a 2023 6464 3838 3838 3b7d 2229 290a   : #dd8888;}")).
+00012720: 2020 2020 2020 2020 616e 6e6f 7461 746f          annotato
+00012730: 722e 6164 645f 636f 6d6d 616e 6428 0a20  r.add_command(. 
+00012740: 2020 2020 2020 2020 2020 2041 6e6e 6f74             Annot
+00012750: 6174 6f72 436f 6d6d 616e 6428 6874 6d6c  atorCommand(html
+00012760: 5f63 6c61 7373 3d22 7375 7065 7273 6372  _class="superscr
+00012770: 6970 7422 2c20 7363 7269 7074 3d22 7375  ipt", script="su
+00012780: 7065 7222 2c20 6164 645f 6964 3d22 7375  per", add_id="su
+00012790: 7065 725f 7c22 2c20 6164 645f 7469 746c  per_|", add_titl
+000127a0: 653d 227c 222c 0a20 2020 2020 2020 2020  e="|",.         
+000127b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127c0: 2020 2020 7374 796c 653d 227b 636f 6c6f      style="{colo
+000127d0: 7220 3a20 626c 7565 3b20 6261 636b 6772  r : blue; backgr
+000127e0: 6f6f 756e 643a 2079 656c 6c6f 777d 2229  oound: yellow}")
+000127f0: 290a 2020 2020 2020 2020 616e 6e6f 7461  ).        annota
+00012800: 746f 722e 6164 645f 636f 6d6d 616e 6428  tor.add_command(
+00012810: 0a20 2020 2020 2020 2020 2020 2041 6e6e  .            Ann
+00012820: 6f74 6174 6f72 436f 6d6d 616e 6428 6874  otatorCommand(ht
+00012830: 6d6c 5f63 6c61 7373 3d22 7374 6172 7422  ml_class="start"
+00012840: 2c20 7265 6765 783d 225c 5c73 2a5c 5c5b  , regex="\\s*\\[
+00012850: 3f53 5441 5254 5c5c 732a 283f 503c 7469  ?START\\s*(?P<ti
+00012860: 746c 653e 4649 4755 5245 7c54 4142 4c45  tle>FIGURE|TABLE
+00012870: 295c 5c73 2a28 3f50 3c69 643e 5c5c 642b  )\\s*(?P<id>\\d+
+00012880: 5c5c 2e5c 5c64 2b29 5c5c 732a 2848 4552  \\.\\d+)\\s*(HER
+00012890: 4529 3f5c 5c5d 3f22 2c0a 2020 2020 2020  E)?\\]?",.      
+000128a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000128b0: 2020 2020 2020 2061 6464 5f69 643d 2273         add_id="s
+000128c0: 7461 7274 5f7c 222c 2061 6464 5f74 6974  tart_|", add_tit
+000128d0: 6c65 3d22 7374 6172 745f 7c22 2c20 7374  le="start_|", st
+000128e0: 796c 653d 227b 636f 6c6f 7220 3a20 6772  yle="{color : gr
+000128f0: 6565 6e3b 2062 6163 6b67 726f 756e 643a  een; background:
+00012900: 2070 696e 6b7d 2229 290a 2020 2020 2020   pink}")).      
+00012910: 2020 616e 6e6f 7461 746f 722e 6164 645f    annotator.add_
+00012920: 636f 6d6d 616e 6428 0a20 2020 2020 2020  command(.       
+00012930: 2020 2020 2041 6e6e 6f74 6174 6f72 436f       AnnotatorCo
+00012940: 6d6d 616e 6428 6874 6d6c 5f63 6c61 7373  mmand(html_class
+00012950: 3d22 656e 6422 2c20 7265 6765 783d 225c  ="end", regex="\
+00012960: 5c73 2a5c 5c5b 3f45 4e44 5c5c 732a 283f  \s*\\[?END\\s*(?
+00012970: 503c 7469 746c 653e 4649 4755 5245 7c54  P<title>FIGURE|T
+00012980: 4142 4c45 295c 5c73 2a28 3f50 3c69 643e  ABLE)\\s*(?P<id>
+00012990: 5c5c 642b 5c5c 2e5c 5c64 2b29 5c5c 732a  \\d+\\.\\d+)\\s*
+000129a0: 2848 4552 4529 3f5c 5c5d 3f22 2c0a 2020  (HERE)?\\]?",.  
+000129b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129c0: 2020 2020 2020 2020 2020 2061 6464 5f69             add_i
+000129d0: 643d 2265 6e64 5f7c 222c 2061 6464 5f74  d="end_|", add_t
+000129e0: 6974 6c65 3d22 656e 645f 7c22 2c20 7374  itle="end_|", st
+000129f0: 796c 653d 227b 636f 6c6f 7220 3a20 6772  yle="{color : gr
+00012a00: 6565 6e3b 2062 6163 6b67 726f 756e 643a  een; background:
+00012a10: 2062 6c75 657d 2229 290a 2020 2020 2020   blue}")).      
+00012a20: 2020 616e 6e6f 7461 746f 722e 6164 645f    annotator.add_
+00012a30: 636f 6d6d 616e 6428 0a20 2020 2020 2020  command(.       
+00012a40: 2020 2020 2041 6e6e 6f74 6174 6f72 436f       AnnotatorCo
+00012a50: 6d6d 616e 6428 6874 6d6c 5f63 6c61 7373  mmand(html_class
+00012a60: 3d22 7461 7267 6574 7322 2c20 7265 6765  ="targets", rege
+00012a70: 783d 222e 2a5c 5c7b 283f 503c 7469 746c  x=".*\\{(?P<titl
+00012a80: 653e 2e2b 295c 5c7d 2e2a 222c 0a20 2020  e>.+)\\}.*",.   
+00012a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012aa0: 2020 2020 2020 2020 2020 6164 645f 6964            add_id
+00012ab0: 3d22 6368 756e 6b5f 7c22 2c20 6164 645f  ="chunk_|", add_
+00012ac0: 7469 746c 653d 227c 222c 2073 7479 6c65  title="|", style
+00012ad0: 3d22 7b63 6f6c 6f72 203a 2067 7265 656e  ="{color : green
+00012ae0: 3b20 6261 636b 6772 6f75 6e64 3a20 6f72  ; background: or
+00012af0: 616e 6765 7d22 2c0a 2020 2020 2020 2020  ange}",.        
+00012b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012b10: 2020 2020 6465 7363 3d22 4950 4343 2074      desc="IPCC t
+00012b20: 6172 6765 7420 4944 7320 696e 2063 7572  arget IDs in cur
+00012b30: 6c79 2062 7261 636b 6574 7320 7b57 4731  ly brackets {WG1
+00012b40: 2053 504d 2041 2e31 2e32 2c20 5747 4949   SPM A.1.2, WGII
+00012b50: 2053 504d 2042 2e32 2e33 7d22 2929 0a20   SPM B.2.3}")). 
+00012b60: 2020 2020 2020 2061 6e6e 6f74 6174 6f72         annotator
+00012b70: 2e61 6464 5f63 6f6d 6d61 6e64 280a 2020  .add_command(.  
+00012b80: 2020 2020 2020 2020 2020 416e 6e6f 7461            Annota
+00012b90: 746f 7243 6f6d 6d61 6e64 2868 746d 6c5f  torCommand(html_
+00012ba0: 636c 6173 733d 2263 7275 6674 222c 2072  class="cruft", r
+00012bb0: 6567 6578 3d22 5e2e 2a28 5375 626a 6563  egex="^.*(Subjec
+00012bc0: 7420 746f 2043 6f70 7920 4564 6974 207c  t to Copy Edit |
+00012bd0: 4164 6f70 7465 6420 4c6f 6e67 6572 2052  Adopted Longer R
+00012be0: 6570 6f72 7420 4950 4343 2041 5236 2053  eport IPCC AR6 S
+00012bf0: 5952 292e 2a24 222c 0a20 2020 2020 2020  YR).*$",.       
+00012c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012c10: 2020 2020 2020 6164 645f 6964 3d22 6372        add_id="cr
+00012c20: 7566 745f 7c22 2c20 6164 645f 7469 746c  uft_|", add_titl
+00012c30: 653d 227c 222c 2064 656c 6574 653d 5472  e="|", delete=Tr
+00012c40: 7565 2c20 7374 796c 653d 227b 636f 6c6f  ue, style="{colo
+00012c50: 7220 3a20 6772 6565 6e3b 2062 6163 6b67  r : green; backg
+00012c60: 726f 756e 643a 2062 6c61 636b 7d22 2929  round: black}"))
+00012c70: 0a20 2020 2020 2020 2061 6e6e 6f74 6174  .        annotat
+00012c80: 6f72 2e61 6464 5f63 6f6d 6d61 6e64 280a  or.add_command(.
+00012c90: 2020 2020 2020 2020 2020 2020 416e 6e6f              Anno
+00012ca0: 7461 746f 7243 6f6d 6d61 6e64 2868 746d  tatorCommand(htm
+00012cb0: 6c5f 636c 6173 733d 2270 6167 6522 2c20  l_class="page", 
+00012cc0: 7265 6765 783d 225e 283f 503c 7469 746c  regex="^(?P<titl
+00012cd0: 653e 705c 5c2e 5c5c 642b 2922 2c0a 2020  e>p\\.\\d+)",.  
 00012ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012cf0: 6164 645f 7469 746c 653d 227c 222c 2073  add_title="|", s
-00012d00: 7479 6c65 3d22 7b63 6f6c 6f72 203a 2070  tyle="{color : p
-00012d10: 7572 706c 657d 2229 290a 2020 2020 2020  urple}")).      
-00012d20: 2020 616e 6e6f 7461 746f 722e 6164 645f    annotator.add_
-00012d30: 636f 6d6d 616e 6428 0a20 2020 2020 2020  command(.       
-00012d40: 2020 2020 2041 6e6e 6f74 6174 6f72 436f       AnnotatorCo
-00012d50: 6d6d 616e 6428 6874 6d6c 5f63 6c61 7373  mmand(html_class
-00012d60: 3d22 6661 6374 222c 2078 7061 7468 3d22  ="fact", xpath="
-00012d70: 7365 6c66 3a3a 7370 616e 5b63 6f6e 7461  self::span[conta
-00012d80: 696e 7328 4063 6c61 7373 2c20 2763 6f6e  ins(@class, 'con
-00012d90: 6669 6465 6e63 6527 295d 2f70 7265 6365  fidence')]/prece
-00012da0: 6469 6e67 2d73 6962 6c69 6e67 3a3a 7370  ding-sibling::sp
-00012db0: 616e 5b31 5d22 2c0a 2020 2020 2020 2020  an[1]",.        
-00012dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012dd0: 2020 2020 2020 7374 796c 653d 227b 636f        style="{co
-00012de0: 6c6f 7220 3a20 7075 7270 6c65 7d22 2929  lor : purple}"))
-00012df0: 0a20 2020 2020 2020 2061 6e6e 6f74 6174  .        annotat
-00012e00: 6f72 2e61 6464 5f63 6f6d 6d61 6e64 280a  or.add_command(.
-00012e10: 2020 2020 2020 2020 2020 2020 416e 6e6f              Anno
-00012e20: 7461 746f 7243 6f6d 6d61 6e64 2868 746d  tatorCommand(htm
-00012e30: 6c5f 636c 6173 733d 2267 726f 7570 222c  l_class="group",
-00012e40: 2067 726f 7570 5f78 7061 7468 3d22 6469   group_xpath="di
-00012e50: 765b 7370 616e 5b63 6f6e 7461 696e 7328  v[span[contains(
-00012e60: 4063 6c61 7373 2c20 2773 7461 7274 2729  @class, 'start')
-00012e70: 5d5d 222c 0a20 2020 2020 2020 2020 2020  ]]",.           
-00012e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e90: 2020 656e 645f 7870 6174 683d 2273 656c    end_xpath="sel
-00012ea0: 663a 3a64 6976 5b73 7061 6e5b 636f 6e74  f::div[span[cont
-00012eb0: 6169 6e73 2874 6578 7428 292c 2745 4e44  ains(text(),'END
-00012ec0: 2729 5d5d 222c 0a20 2020 2020 2020 2020  ')]]",.         
-00012ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012ee0: 2020 2064 6573 633d 223f 6578 7472 6163     desc="?extrac
-00012ef0: 7473 2067 726f 7570 7320 616e 6420 6d6d  ts groups and mm
-00012f00: 6f76 6573 2074 6f20 656e 6422 2929 0a20  oves to end")). 
-00012f10: 2020 2020 2020 2061 6e6e 6f74 6174 6f72         annotator
-00012f20: 2e61 6464 5f63 6f6d 6d61 6e64 280a 2020  .add_command(.  
-00012f30: 2020 2020 2020 2020 2020 416e 6e6f 7461            Annota
-00012f40: 746f 7243 6f6d 6d61 6e64 2868 746d 6c5f  torCommand(html_
-00012f50: 636c 6173 733d 2273 7562 7375 6273 6563  class="subsubsec
-00012f60: 7469 6f6e 222c 2067 726f 7570 5f78 7061  tion", group_xpa
-00012f70: 7468 3d22 6469 765b 7370 616e 5b63 6f6e  th="div[span[con
-00012f80: 7461 696e 7328 4063 6c61 7373 2c20 2773  tains(@class, 's
-00012f90: 7562 7375 6273 6563 7469 6f6e 5f74 6974  ubsubsection_tit
-00012fa0: 6c65 2729 5d5d 222c 0a20 2020 2020 2020  le')]]",.       
-00012fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fc0: 2020 2020 2020 656e 645f 7870 6174 683d        end_xpath=
-00012fd0: 2273 656c 663a 3a64 6976 5b73 7061 6e5b  "self::div[span[
-00012fe0: 636f 6e74 6169 6e73 2874 6578 7428 292c  contains(text(),
-00012ff0: 2773 6563 7469 6f6e 5f74 6974 6c65 2729  'section_title')
-00013000: 5d5d 2229 290a 2020 2020 2020 2020 616e  ]]")).        an
-00013010: 6e6f 7461 746f 722e 6164 645f 636f 6d6d  notator.add_comm
-00013020: 616e 6428 0a20 2020 2020 2020 2020 2020  and(.           
-00013030: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
-00013040: 6428 6874 6d6c 5f63 6c61 7373 3d22 666f  d(html_class="fo
-00013050: 6f74 6e6f 7465 222c 2078 7061 7468 3d22  otnote", xpath="
-00013060: 2f2f 6469 765b 7370 616e 5b63 6f6e 7461  //div[span[conta
-00013070: 696e 7328 4073 7479 6c65 2c20 2766 6f6e  ins(@style, 'fon
-00013080: 742d 7369 7a65 3a20 362e 3027 2920 616e  t-size: 6.0') an
-00013090: 6420 6e75 6d62 6572 282e 293d 6e75 6d62  d number(.)=numb
-000130a0: 6572 282e 295d 5d22 2c0a 2020 2020 2020  er(.)]]",.      
-000130b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000130c0: 2020 2020 2020 2064 6573 633d 2268 6f72         desc="hor
-000130d0: 7269 626c 6520 6861 636b 2074 6573 7469  rible hack testi
-000130e0: 6e67 2066 6f6e 742d 7369 7a65 2229 290a  ng font-size")).
-000130f0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00013100: 2061 6e6e 6f74 6174 6f72 0a0a 0a41 4e4e   annotator...ANN
-00013110: 5f53 504c 4954 203d 2022 7c22 0a4c 454e  _SPLIT = "|".LEN
-00013120: 5f54 4954 4c45 203d 2035 300a 636c 6173  _TITLE = 50.clas
-00013130: 7320 416e 6e6f 7461 746f 7243 6f6d 6d61  s AnnotatorComma
-00013140: 6e64 3a0a 2020 2020 2222 2261 6e20 616e  nd:.    """an an
-00013150: 6e6f 7461 7469 6f6e 2063 6f6d 6d61 6e64  notation command
-00013160: 0a20 2020 2065 2e67 2e0a 2020 2020 636f  .    e.g..    co
-00013170: 6d6d 616e 6420 3d20 416e 6e6f 7461 746f  mmand = Annotato
-00013180: 7243 6f6d 6d61 6e64 2868 746d 6c5f 636c  rCommand(html_cl
-00013190: 6173 733d 2273 6563 7469 6f6e 5f74 6974  ass="section_tit
-000131a0: 6c65 222c 2072 6567 6578 3d22 5365 6374  le", regex="Sect
-000131b0: 696f 6e5c 5c73 2b28 3f50 3c69 643e 5c5c  ion\\s+(?P<id>\\
-000131c0: 642b 293a 5c5c 732b 283f 503c 7469 746c  d+):\\s+(?P<titl
-000131d0: 653e 2e2a 2922 2c20 6164 645f 6964 3d54  e>.*)", add_id=T
-000131e0: 7275 652c 2061 6464 5f74 6974 6c65 3d54  rue, add_title=T
-000131f0: 7275 6529 0a20 2020 2061 6e6e 6f74 6174  rue).    annotat
-00013200: 6f72 2e61 6464 5f63 6f6d 6d61 6e64 2863  or.add_command(c
-00013210: 6f6d 6d61 6e64 290a 2020 2020 616e 6e6f  ommand).    anno
-00013220: 7461 746f 722e 7275 6e5f 636f 6d6d 616e  tator.run_comman
-00013230: 6473 0a0a 2020 2020 2222 220a 0a20 2020  ds..    """..   
-00013240: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
-00013250: 6c66 2c20 6874 6d6c 5f63 6c61 7373 3d4e  lf, html_class=N
-00013260: 6f6e 652c 2072 6567 6578 3d4e 6f6e 652c  one, regex=None,
-00013270: 2061 6464 5f69 643d 4e6f 6e65 2c20 6164   add_id=None, ad
-00013280: 645f 7469 746c 653d 4e6f 6e65 2c20 7363  d_title=None, sc
-00013290: 7269 7074 3d4e 6f6e 652c 2073 7479 6c65  ript=None, style
-000132a0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-000132b0: 2020 2020 2020 2020 6465 6c65 7465 3d46          delete=F
-000132c0: 616c 7365 2c20 7870 6174 683d 4e6f 6e65  alse, xpath=None
-000132d0: 2c20 6772 6f75 705f 7870 6174 683d 4e6f  , group_xpath=No
-000132e0: 6e65 2c20 656e 645f 7870 6174 683d 4e6f  ne, end_xpath=No
-000132f0: 6e65 2c20 6465 7363 3d4e 6f6e 6529 3a0a  ne, desc=None):.
-00013300: 2020 2020 2020 2020 7365 6c66 2e68 746d          self.htm
-00013310: 6c5f 636c 6173 7320 3d20 6874 6d6c 5f63  l_class = html_c
-00013320: 6c61 7373 0a20 2020 2020 2020 2073 656c  lass.        sel
-00013330: 662e 7265 203d 204e 6f6e 650a 2020 2020  f.re = None.    
-00013340: 2020 2020 6966 2072 6567 6578 3a0a 2020      if regex:.  
-00013350: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00013360: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00013370: 656c 662e 7265 203d 2072 652e 636f 6d70  elf.re = re.comp
-00013380: 696c 6528 7265 6765 7829 0a20 2020 2020  ile(regex).     
-00013390: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-000133a0: 6365 7074 696f 6e20 6173 2065 3a0a 2020  ception as e:.  
-000133b0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000133c0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-000133d0: 2243 616e 6e6f 7420 636f 6d70 696c 6520  "Cannot compile 
-000133e0: 7265 6765 7820 7b72 6567 6578 7d20 6265  regex {regex} be
-000133f0: 6361 7573 6520 7b65 7d22 290a 0a20 2020  cause {e}")..   
-00013400: 2020 2020 2023 2061 6464 5f69 6420 616e       # add_id an
-00013410: 6420 6164 645f 7469 746c 6520 6172 6520  d add_title are 
-00013420: 6f66 2066 6f72 6d20 666f 6f7c 6261 7220  of form foo|bar 
-00013430: 7768 6572 6520 6578 7472 6163 7465 6420  where extracted 
-00013440: 6964 2072 6570 6c61 6365 7320 7c0a 2020  id replaces |.  
-00013450: 2020 2020 2020 6966 2061 6464 5f69 643a        if add_id:
-00013460: 0a20 2020 2020 2020 2020 2020 2061 6464  .            add
-00013470: 5f69 6420 3d20 6164 645f 6964 2e73 706c  _id = add_id.spl
-00013480: 6974 2841 4e4e 5f53 504c 4954 290a 2020  it(ANN_SPLIT).  
-00013490: 2020 2020 2020 7365 6c66 2e61 6464 5f69        self.add_i
-000134a0: 6420 3d20 4e6f 6e65 2069 6620 6e6f 7420  d = None if not 
-000134b0: 6164 645f 6964 206f 7220 6c65 6e28 6164  add_id or len(ad
-000134c0: 645f 6964 2920 213d 2032 2065 6c73 6520  d_id) != 2 else 
-000134d0: 6164 645f 6964 0a20 2020 2020 2020 2069  add_id.        i
-000134e0: 6620 6164 645f 7469 746c 653a 0a20 2020  f add_title:.   
-000134f0: 2020 2020 2020 2020 2061 6464 5f74 6974           add_tit
-00013500: 6c65 203d 2061 6464 5f74 6974 6c65 2e73  le = add_title.s
-00013510: 706c 6974 2841 4e4e 5f53 504c 4954 290a  plit(ANN_SPLIT).
-00013520: 2020 2020 2020 2020 7365 6c66 2e61 6464          self.add
-00013530: 5f74 6974 6c65 3d20 4e6f 6e65 2069 6620  _title= None if 
-00013540: 6e6f 7420 6164 645f 7469 746c 6520 6f72  not add_title or
-00013550: 206c 656e 2861 6464 5f74 6974 6c65 2920   len(add_title) 
-00013560: 213d 2032 2065 6c73 6520 6164 645f 7469  != 2 else add_ti
-00013570: 746c 650a 0a20 2020 2020 2020 2073 656c  tle..        sel
-00013580: 662e 6874 6d6c 5f63 6c61 7373 203d 2068  f.html_class = h
-00013590: 746d 6c5f 636c 6173 730a 2020 2020 2020  tml_class.      
-000135a0: 2020 7365 6c66 2e73 6372 6970 7420 3d20    self.script = 
-000135b0: 7363 7269 7074 0a20 2020 2020 2020 2073  script.        s
-000135c0: 656c 662e 7374 796c 6520 3d20 7374 796c  elf.style = styl
-000135d0: 650a 2020 2020 2020 2020 7365 6c66 2e64  e.        self.d
-000135e0: 656c 6574 6520 3d20 6465 6c65 7465 0a20  elete = delete. 
-000135f0: 2020 2020 2020 2073 656c 662e 7870 6174         self.xpat
-00013600: 6820 3d20 7870 6174 680a 2020 2020 2020  h = xpath.      
-00013610: 2020 7365 6c66 2e67 726f 7570 5f78 7061    self.group_xpa
-00013620: 7468 203d 2067 726f 7570 5f78 7061 7468  th = group_xpath
-00013630: 0a20 2020 2020 2020 2073 656c 662e 656e  .        self.en
-00013640: 645f 7870 6174 6820 3d20 656e 645f 7870  d_xpath = end_xp
-00013650: 6174 680a 2020 2020 2020 2020 7365 6c66  ath.        self
-00013660: 2e64 6573 6320 3d20 6465 7363 0a0a 2320  .desc = desc..# 
-00013670: 636c 6173 7320 416e 6e6f 7461 746f 7243  class AnnotatorC
-00013680: 6f6d 6d61 6e64 0a0a 2020 2020 6465 6620  ommand..    def 
-00013690: 7275 6e5f 636f 6d6d 616e 6428 7365 6c66  run_command(self
-000136a0: 2c20 656c 656d 293a 0a20 2020 2020 2020  , elem):.       
-000136b0: 2023 2070 7269 6e74 2866 2272 756e 5f63   # print(f"run_c
-000136c0: 6f6d 6d61 6e64 202c 2074 6167 2c20 7b65  ommand , tag, {e
-000136d0: 6c65 6d2e 7461 677d 2070 6172 656e 743a  lem.tag} parent:
-000136e0: 207b 656c 656d 2e67 6574 7061 7265 6e74   {elem.getparent
-000136f0: 2829 7d22 290a 2020 2020 2020 2020 6966  ()}").        if
-00013700: 2073 656c 662e 7265 3a0a 2020 2020 2020   self.re:.      
-00013710: 2020 2020 2020 7365 6c66 2e72 756e 5f72        self.run_r
-00013720: 6567 6578 2865 6c65 6d29 0a20 2020 2020  egex(elem).     
-00013730: 2020 2023 2065 6c69 6620 7365 6c66 2e65     # elif self.e
-00013740: 7874 7261 6374 3a0a 2020 2020 2020 2020  xtract:.        
-00013750: 2320 2020 2020 7365 6c66 2e72 756e 5f65  #     self.run_e
-00013760: 7874 7261 6374 2865 6c65 6d29 0a20 2020  xtract(elem).   
-00013770: 2020 2020 2065 6c69 6620 7365 6c66 2e78       elif self.x
-00013780: 7061 7468 203a 0a20 2020 2020 2020 2020  path :.         
-00013790: 2020 2073 656c 662e 7275 6e5f 7870 6174     self.run_xpat
-000137a0: 6828 656c 656d 290a 2020 2020 2020 2020  h(elem).        
-000137b0: 656c 6966 2073 656c 662e 7363 7269 7074  elif self.script
-000137c0: 203d 3d20 2273 7562 223a 0a20 2020 2020   == "sub":.     
-000137d0: 2020 2020 2020 2073 656c 662e 7275 6e5f         self.run_
-000137e0: 7375 6273 6372 6970 7428 656c 656d 290a  subscript(elem).
-000137f0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-00013800: 662e 7363 7269 7074 203d 3d20 2273 7570  f.script == "sup
-00013810: 6572 223a 0a20 2020 2020 2020 2020 2020  er":.           
-00013820: 2073 656c 662e 7275 6e5f 7375 7065 7273   self.run_supers
-00013830: 6372 6970 7428 656c 656d 290a 2020 2020  cript(elem).    
-00013840: 2020 2020 656c 6966 2073 656c 662e 6772      elif self.gr
-00013850: 6f75 705f 7870 6174 6820 6973 206e 6f74  oup_xpath is not
-00013860: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00013870: 2020 2073 656c 662e 7275 6e5f 6772 6f75     self.run_grou
-00013880: 705f 7870 6174 6828 656c 656d 290a 0a20  p_xpath(elem).. 
-00013890: 2020 2023 2063 6c61 7373 2041 6e6e 6f74     # class Annot
-000138a0: 6174 6f72 436f 6d6d 616e 640a 0a20 2020  atorCommand..   
-000138b0: 2064 6566 2072 756e 5f72 6567 6578 2873   def run_regex(s
-000138c0: 656c 662c 2065 6c65 6d29 3a0a 2020 2020  elf, elem):.    
-000138d0: 2020 2020 7465 7874 203d 2065 6c65 6d2e      text = elem.
-000138e0: 7465 7874 0a20 2020 2020 2020 2069 6620  text.        if 
-000138f0: 7465 7874 2069 7320 4e6f 6e65 3a0a 2020  text is None:.  
-00013900: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00013910: 6622 7265 6765 783a 204e 6f6e 6520 7465  f"regex: None te
-00013920: 7874 2069 6e20 7b65 6c65 6d7d 207b 656c  xt in {elem} {el
-00013930: 656d 2e74 6167 7d22 290a 2020 2020 2020  em.tag}").      
-00013940: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
-00013950: 2020 2020 206d 6174 6368 203d 204e 6f6e       match = Non
-00013960: 650a 2020 2020 2020 2020 7472 793a 0a20  e.        try:. 
-00013970: 2020 2020 2020 2020 2020 206d 6174 6368             match
-00013980: 203d 2073 656c 662e 7265 2e6d 6174 6368   = self.re.match
-00013990: 2874 6578 7429 0a20 2020 2020 2020 2065  (text).        e
-000139a0: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-000139b0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-000139c0: 2020 7072 696e 7428 6622 6d61 7463 6820    print(f"match 
-000139d0: 6661 696c 207b 657d 2229 0a20 2020 2020  fail {e}").     
-000139e0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-000139f0: 2020 2020 2020 6966 206d 6174 6368 3a0a        if match:.
-00013a00: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00013a10: 656c 662e 6465 6c65 7465 3a0a 2020 2020  elf.delete:.    
-00013a20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00013a30: 2e72 656d 6f76 655f 656c 656d 2865 6c65  .remove_elem(ele
-00013a40: 6d29 0a20 2020 2020 2020 2020 2020 2020  m).             
-00013a50: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
-00013a60: 2020 2020 2020 6966 2073 656c 662e 6164        if self.ad
-00013a70: 645f 6964 2061 6e64 2022 6964 2220 696e  d_id and "id" in
-00013a80: 206d 6174 6368 2e67 726f 7570 6469 6374   match.groupdict
-00013a90: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-00013aa0: 2020 2020 656c 656d 2e61 7474 7269 625b      elem.attrib[
-00013ab0: 2269 6422 5d20 3d20 7365 6c66 2e61 6464  "id"] = self.add
-00013ac0: 5f69 645b 305d 202b 206d 6174 6368 2e67  _id[0] + match.g
-00013ad0: 726f 7570 2822 6964 2229 202b 2073 656c  roup("id") + sel
-00013ae0: 662e 6164 645f 6964 5b31 5d0a 2020 2020  f.add_id[1].    
-00013af0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00013b00: 6164 645f 7469 746c 6520 616e 6420 2274  add_title and "t
-00013b10: 6974 6c65 2220 696e 206d 6174 6368 2e67  itle" in match.g
-00013b20: 726f 7570 6469 6374 2829 3a0a 2020 2020  roupdict():.    
-00013b30: 2020 2020 2020 2020 2020 2020 656c 656d              elem
-00013b40: 2e61 7474 7269 625b 2274 6974 6c65 225d  .attrib["title"]
-00013b50: 203d 2073 656c 662e 6164 645f 7469 746c   = self.add_titl
-00013b60: 655b 305d 202b 206d 6174 6368 2e67 726f  e[0] + match.gro
-00013b70: 7570 2822 7469 746c 6522 2920 2b20 7365  up("title") + se
-00013b80: 6c66 2e61 6464 5f74 6974 6c65 5b31 5d5b  lf.add_title[1][
-00013b90: 3a4c 454e 5f54 4954 4c45 5d0a 2020 2020  :LEN_TITLE].    
-00013ba0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00013bb0: 6874 6d6c 5f63 6c61 7373 3a0a 2020 2020  html_class:.    
-00013bc0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00013bd0: 2e75 7064 6174 655f 636c 6173 7328 656c  .update_class(el
-00013be0: 656d 2c20 7365 6c66 2e68 746d 6c5f 636c  em, self.html_cl
-00013bf0: 6173 7329 0a0a 2020 2020 2320 636c 6173  ass)..    # clas
-00013c00: 7320 416e 6e6f 7461 746f 7243 6f6d 6d61  s AnnotatorComma
-00013c10: 6e64 0a0a 2020 2020 6465 6620 7275 6e5f  nd..    def run_
-00013c20: 7870 6174 6828 7365 6c66 2c20 656c 656d  xpath(self, elem
-00013c30: 293a 0a20 2020 2020 2020 2078 705f 656c  ):.        xp_el
-00013c40: 656d 7320 3d20 656c 656d 2e78 7061 7468  ems = elem.xpath
-00013c50: 2873 656c 662e 7870 6174 6829 0a20 2020  (self.xpath).   
-00013c60: 2020 2020 2069 6620 6e6f 7420 7870 5f65       if not xp_e
-00013c70: 6c65 6d73 3a0a 2020 2020 2020 2020 2020  lems:.          
-00013c80: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
-00013c90: 2066 6f72 2078 705f 656c 656d 2069 6e20   for xp_elem in 
-00013ca0: 7870 5f65 6c65 6d73 3a0a 2020 2020 2020  xp_elems:.      
-00013cb0: 2020 2020 2020 6966 2073 656c 662e 6465        if self.de
-00013cc0: 6c65 7465 3a0a 2020 2020 2020 2020 2020  lete:.          
-00013cd0: 2020 2020 2020 7870 5f65 6c65 6d2e 6765        xp_elem.ge
-00013ce0: 7470 6172 656e 7428 292e 7265 6d6f 7665  tparent().remove
-00013cf0: 2878 705f 656c 656d 290a 2020 2020 2020  (xp_elem).      
-00013d00: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00013d10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00013d20: 7365 6c66 2e68 746d 6c5f 636c 6173 733a  self.html_class:
-00013d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013d40: 2073 656c 662e 7570 6461 7465 5f63 6c61   self.update_cla
-00013d50: 7373 2878 705f 656c 656d 2c20 7365 6c66  ss(xp_elem, self
-00013d60: 2e68 746d 6c5f 636c 6173 7329 0a20 2020  .html_class).   
-00013d70: 2020 2020 2020 2020 2020 2020 2074 6f73               tos
-00013d80: 7472 696e 6720 3d20 4554 2e74 6f73 7472  tring = ET.tostr
-00013d90: 696e 6728 7870 5f65 6c65 6d29 0a20 2020  ing(xp_elem).   
-00013da0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
-00013db0: 730a 0a20 2020 2023 2063 6c61 7373 2041  s..    # class A
-00013dc0: 6e6e 6f74 6174 6f72 436f 6d6d 616e 640a  nnotatorCommand.
-00013dd0: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
-00013de0: 636c 6173 7328 7365 6c66 2c20 656c 656d  class(self, elem
-00013df0: 2c20 6874 6d6c 5f63 6c61 7373 293a 0a20  , html_class):. 
-00013e00: 2020 2020 2020 2063 6c61 7373 6573 203d         classes =
-00013e10: 205b 5d0a 2020 2020 2020 2020 4874 6d6c   [].        Html
-00013e20: 436c 6173 732e 7365 745f 636c 6173 735f  Class.set_class_
-00013e30: 6f6e 5f65 6c65 6d65 6e74 2865 6c65 6d2c  on_element(elem,
-00013e40: 2068 746d 6c5f 636c 6173 7329 0a20 2020   html_class).   
-00013e50: 2020 2020 2069 6620 4661 6c73 653a 0a20       if False:. 
-00013e60: 2020 2020 2020 2020 2020 2069 6620 656c             if el
-00013e70: 656d 2e61 7474 7269 622e 6765 7428 2263  em.attrib.get("c
-00013e80: 6c61 7373 2229 3a0a 2020 2020 2020 2020  lass"):.        
-00013e90: 2020 2020 2020 2020 636c 6173 7365 7320          classes 
-00013ea0: 3d20 656c 656d 2e61 7474 7269 625b 2263  = elem.attrib["c
-00013eb0: 6c61 7373 225d 2e73 706c 6974 2822 2022  lass"].split(" "
-00013ec0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00013ed0: 2068 746d 6c5f 636c 6173 7320 6e6f 7420   html_class not 
-00013ee0: 696e 2063 6c61 7373 6573 3a0a 2020 2020  in classes:.    
-00013ef0: 2020 2020 2020 2020 2020 2020 636c 6173              clas
-00013f00: 7365 732e 6170 7065 6e64 2868 746d 6c5f  ses.append(html_
-00013f10: 636c 6173 7329 0a20 2020 2020 2020 2020  class).         
-00013f20: 2020 2020 2020 2065 6c65 6d2e 6174 7472         elem.attr
-00013f30: 6962 5b22 636c 6173 7322 5d20 3d20 2220  ib["class"] = " 
-00013f40: 222e 6a6f 696e 2863 6c61 7373 6573 290a  ".join(classes).
-00013f50: 0a20 2020 2064 6566 2072 756e 5f73 7562  .    def run_sub
-00013f60: 7363 7269 7074 2873 656c 662c 2073 7061  script(self, spa
-00013f70: 6e29 3a0a 2020 2020 2020 2020 6973 5f73  n):.        is_s
-00013f80: 7562 203d 2048 746d 6c55 7469 6c2e 616e  ub = HtmlUtil.an
-00013f90: 6e6f 7461 7465 5f73 6372 6970 745f 7479  notate_script_ty
-00013fa0: 7065 2873 7061 6e2c 2053 5363 7269 7074  pe(span, SScript
-00013fb0: 2e53 5542 2c20 7964 6f77 6e3d 4661 6c73  .SUB, ydown=Fals
-00013fc0: 6529 0a20 2020 2020 2020 2069 6620 6973  e).        if is
-00013fd0: 5f73 7562 3a0a 2020 2020 2020 2020 2020  _sub:.          
-00013fe0: 2020 7370 616e 2e61 7474 7269 625b 2274    span.attrib["t
-00013ff0: 6974 6c65 225d 203d 2022 7375 6273 6372  itle"] = "subscr
-00014000: 6970 745f 7b73 7061 6e2e 7465 7874 7d22  ipt_{span.text}"
-00014010: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00014020: 6e74 2866 2253 5542 207b 7370 616e 2e74  nt(f"SUB {span.t
-00014030: 6578 747d 2229 0a0a 2020 2020 2320 636c  ext}")..    # cl
-00014040: 6173 7320 416e 6e6f 7461 746f 7243 6f6d  ass AnnotatorCom
-00014050: 6d61 6e64 0a0a 2020 2020 6465 6620 7275  mand..    def ru
-00014060: 6e5f 7375 7065 7273 6372 6970 7428 7365  n_superscript(se
-00014070: 6c66 2c20 7370 616e 293a 0a20 2020 2020  lf, span):.     
-00014080: 2020 2069 735f 7375 7065 7220 3d20 4874     is_super = Ht
-00014090: 6d6c 5574 696c 2e61 6e6e 6f74 6174 655f  mlUtil.annotate_
-000140a0: 7363 7269 7074 5f74 7970 6528 7370 616e  script_type(span
-000140b0: 2c20 5353 6372 6970 742e 5355 502c 2079  , SScript.SUP, y
-000140c0: 646f 776e 3d46 616c 7365 290a 2020 2020  down=False).    
-000140d0: 2020 2020 6966 2069 735f 7375 7065 723a      if is_super:
-000140e0: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
-000140f0: 6e2e 6174 7472 6962 5b22 7469 746c 6522  n.attrib["title"
-00014100: 5d20 3d20 6622 7375 7065 7273 6372 6970  ] = f"superscrip
-00014110: 745f 7b73 7061 6e2e 7465 7874 7d22 0a0a  t_{span.text}"..
-00014120: 2020 2020 2320 636c 6173 7320 416e 6e6f      # class Anno
-00014130: 7461 746f 7243 6f6d 6d61 6e64 0a0a 2020  tatorCommand..  
-00014140: 2020 6465 6620 7275 6e5f 6772 6f75 705f    def run_group_
-00014150: 7870 6174 6828 7365 6c66 2c20 6368 696c  xpath(self, chil
-00014160: 645f 656c 656d 293a 0a20 2020 2020 2020  d_elem):.       
-00014170: 2022 2222 6772 6f75 7020 666f 6c6c 6f77   """group follow
-00014180: 696e 6720 7369 626c 696e 6773 206f 6620  ing siblings of 
-00014190: 656c 656d 2222 220a 0a20 2020 2020 2020  elem"""..       
-000141a0: 2072 6573 756c 7420 3d20 4e6f 6e65 0a20   result = None. 
-000141b0: 2020 2020 2020 2069 6620 6368 696c 645f         if child_
-000141c0: 656c 656d 2069 7320 4e6f 6e65 3a0a 2020  elem is None:.  
-000141d0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000141e0: 204e 6f6e 650a 2020 2020 2020 2020 7061   None.        pa
-000141f0: 7265 6e74 5f65 6c65 6d20 3d20 6368 696c  rent_elem = chil
-00014200: 645f 656c 656d 2e67 6574 7061 7265 6e74  d_elem.getparent
-00014210: 2829 0a20 2020 2020 2020 2069 6620 7061  ().        if pa
-00014220: 7265 6e74 5f65 6c65 6d20 6973 204e 6f6e  rent_elem is Non
-00014230: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00014240: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
-00014250: 2020 2067 726f 7570 5f6c 6561 6473 203d     group_leads =
-00014260: 2070 6172 656e 745f 656c 656d 2e78 7061   parent_elem.xpa
-00014270: 7468 2873 656c 662e 6772 6f75 705f 7870  th(self.group_xp
-00014280: 6174 6829 0a20 2020 2020 2020 2069 6620  ath).        if 
-00014290: 6c65 6e28 6772 6f75 705f 6c65 6164 7329  len(group_leads)
-000142a0: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
-000142b0: 2020 7072 696e 7428 6622 6772 6f75 7020    print(f"group 
-000142c0: 6c65 6164 2063 6f75 6e74 207b 6c65 6e28  lead count {len(
-000142d0: 6772 6f75 705f 6c65 6164 7329 7d20 7b73  group_leads)} {s
-000142e0: 656c 662e 6772 6f75 705f 7870 6174 687d  elf.group_xpath}
-000142f0: 2229 0a20 2020 2020 2020 2065 6c73 653a  ").        else:
-00014300: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-00014310: 730a 2020 2020 2020 2020 666f 7220 692c  s.        for i,
-00014320: 2067 726f 7570 5f6c 6561 6420 696e 2065   group_lead in e
-00014330: 6e75 6d65 7261 7465 2867 726f 7570 5f6c  numerate(group_l
-00014340: 6561 6473 293a 0a20 2020 2020 2020 2020  eads):.         
-00014350: 2020 2023 2070 7269 6e74 2866 2267 726f     # print(f"gro
-00014360: 7570 206c 6561 6420 7b45 542e 746f 7374  up lead {ET.tost
-00014370: 7269 6e67 2867 726f 7570 5f6c 6561 6429  ring(group_lead)
-00014380: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00014390: 2320 656e 645f 6772 6f75 6f20 3d20 6772  # end_grouo = gr
-000143a0: 6f75 705f 6c65 6164 735b 6920 2b20 315d  oup_leads[i + 1]
-000143b0: 2069 6620 6920 3c20 6c65 6e28 6772 6f75   if i < len(grou
-000143c0: 705f 6c65 6164 7329 202d 2031 2065 6c73  p_leads) - 1 els
-000143d0: 6520 4e6f 6e65 0a20 2020 2020 2020 2020  e None.         
-000143e0: 2020 2073 656c 662e 6d61 6b65 5f67 726f     self.make_gro
-000143f0: 7570 2870 6172 656e 745f 656c 656d 2c20  up(parent_elem, 
-00014400: 6772 6f75 705f 6c65 6164 290a 0a20 2020  group_lead)..   
-00014410: 2023 2063 6c61 7373 2041 6e6e 6f74 6174   # class Annotat
-00014420: 6f72 436f 6d6d 616e 640a 0a20 2020 2064  orCommand..    d
-00014430: 6566 206d 616b 655f 6772 6f75 7028 7365  ef make_group(se
-00014440: 6c66 2c20 656c 656d 2c20 6772 6f75 705f  lf, elem, group_
-00014450: 6c65 6164 2c20 656e 645f 6772 6f75 703d  lead, end_group=
-00014460: 4e6f 6e65 293a 0a20 2020 2020 2020 2070  None):.        p
-00014470: 6172 656e 7420 3d20 586d 6c4c 6962 2e67  arent = XmlLib.g
-00014480: 6574 7061 7265 6e74 2865 6c65 6d2c 2064  etparent(elem, d
-00014490: 6562 7567 3d54 7275 6529 0a20 2020 2020  ebug=True).     
-000144a0: 2020 2069 6620 7061 7265 6e74 2069 7320     if parent is 
-000144b0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000144c0: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-000144d0: 6f72 2822 6e75 6c6c 2070 6172 656e 7422  or("null parent"
-000144e0: 290a 2020 2020 2020 2020 7369 626c 696e  ).        siblin
-000144f0: 6773 203d 2067 726f 7570 5f6c 6561 642e  gs = group_lead.
-00014500: 7870 6174 6828 2266 6f6c 6c6f 7769 6e67  xpath("following
-00014510: 2d73 6962 6c69 6e67 3a3a 2a22 290a 2020  -sibling::*").  
-00014520: 2020 2020 2020 6966 206c 656e 2873 6962        if len(sib
-00014530: 6c69 6e67 7329 203d 3d20 303a 0a20 2020  lings) == 0:.   
-00014540: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-00014550: 226e 6f20 7369 626c 696e 6773 3a20 7b67  "no siblings: {g
-00014560: 726f 7570 5f6c 6561 642e 7465 7874 7d22  roup_lead.text}"
-00014570: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
-00014580: 7373 0a20 2020 2020 2020 2065 6c73 653a  ss.        else:
-00014590: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-000145a0: 6e74 2866 2273 6962 6c69 6e67 7320 7b6c  nt(f"siblings {l
-000145b0: 656e 2873 6962 6c69 6e67 7329 7d21 2121  en(siblings)}!!!
-000145c0: 2229 0a20 2020 2020 2020 2064 6976 203d  ").        div =
-000145d0: 2045 542e 5375 6245 6c65 6d65 6e74 2870   ET.SubElement(p
-000145e0: 6172 656e 742c 2022 6469 7622 290a 2020  arent, "div").  
-000145f0: 2020 2020 2020 6469 762e 6170 7065 6e64        div.append
-00014600: 2867 726f 7570 5f6c 6561 6429 0a20 2020  (group_lead).   
-00014610: 2020 2020 2064 6976 2e61 7474 7269 625b       div.attrib[
-00014620: 2274 6974 6c65 225d 203d 2067 726f 7570  "title"] = group
-00014630: 5f6c 6561 642e 7465 7874 2069 6620 6772  _lead.text if gr
-00014640: 6f75 705f 6c65 6164 2e74 6578 7420 656c  oup_lead.text el
-00014650: 7365 2022 3f22 0a20 2020 2020 2020 2064  se "?".        d
-00014660: 6976 2e61 7474 7269 625b 2273 7479 6c65  iv.attrib["style
-00014670: 225d 203d 2022 626f 7264 6572 3a62 6c61  "] = "border:bla
-00014680: 636b 2064 6173 6865 6420 3270 783b 220a  ck dashed 2px;".
-00014690: 2020 2020 2020 2020 7870 203d 2073 656c          xp = sel
-000146a0: 662e 656e 645f 7870 6174 680a 2020 2020  f.end_xpath.    
-000146b0: 2020 2020 7870 203d 2022 7365 6c66 3a3a      xp = "self::
-000146c0: 6469 765b 7370 616e 5b63 6f6e 7461 696e  div[span[contain
-000146d0: 7328 7465 7874 2829 2c27 454e 4427 295d  s(text(),'END')]
-000146e0: 5d22 0a20 2020 2020 2020 2023 2070 7269  ]".        # pri
-000146f0: 6e74 2866 2265 6e64 5f78 7061 7468 207b  nt(f"end_xpath {
-00014700: 7870 7d22 290a 2020 2020 2020 2020 666f  xp}").        fo
-00014710: 7220 7369 626c 696e 6720 696e 2073 6962  r sibling in sib
-00014720: 6c69 6e67 733a 0a20 2020 2020 2020 2020  lings:.         
-00014730: 2020 2070 7269 6e74 2866 2273 6962 6c69     print(f"sibli
-00014740: 6e67 3a20 7b27 272e 6a6f 696e 2873 6962  ng: {''.join(sib
-00014750: 6c69 6e67 2e69 7465 7274 6578 7428 2929  ling.itertext())
-00014760: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00014770: 656e 645f 7369 6220 3d20 4e6f 6e65 0a20  end_sib = None. 
-00014780: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00014790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147a0: 656e 645f 7369 6220 3d20 7369 626c 696e  end_sib = siblin
-000147b0: 672e 7870 6174 6828 7870 290a 2020 2020  g.xpath(xp).    
-000147c0: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-000147d0: 7863 6570 7469 6f6e 2061 7320 653a 0a20  xception as e:. 
-000147e0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000147f0: 7269 6e74 2866 2266 6169 6c65 6420 7870  rint(f"failed xp
-00014800: 6174 6820 7b78 707d 207b 657d 2229 0a20  ath {xp} {e}"). 
-00014810: 2020 2020 2020 2020 2020 2069 6620 656e             if en
-00014820: 645f 7369 6220 616e 6420 6c65 6e28 656e  d_sib and len(en
-00014830: 645f 7369 6229 203e 2030 3a0a 2020 2020  d_sib) > 0:.    
-00014840: 2020 2020 2020 2020 2320 6966 2073 6962          # if sib
-00014850: 6c69 6e67 2021 3d20 656e 645f 6772 6f75  ling != end_grou
-00014860: 703a 0a20 2020 2020 2020 2020 2020 2023  p:.            #
-00014870: 2020 2020 2070 7269 6e74 2866 2273 6962       print(f"sib
-00014880: 6c69 6e67 207b 7369 626c 696e 677d 2229  ling {sibling}")
-00014890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000148a0: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-000148b0: 2020 2064 6976 2e61 7070 656e 6428 7369     div.append(si
-000148c0: 626c 696e 6729 0a20 2020 2020 2020 2072  bling).        r
-000148d0: 6574 7572 6e20 6469 760a 0a20 2020 2023  eturn div..    #
-000148e0: 2063 6c61 7373 2041 6e6e 6f74 6174 6f72   class Annotator
-000148f0: 436f 6d6d 616e 640a 0a20 2020 2064 6566  Command..    def
-00014900: 2072 756e 5f65 7874 7261 6374 2873 656c   run_extract(sel
-00014910: 662c 2065 6c65 6d29 3a0a 0a20 2020 2020  f, elem):..     
-00014920: 2020 2022 2222 6578 7472 6163 7420 6772     """extract gr
-00014930: 6f75 702e 206f 7074 696e 616c 6c79 2077  oup. optinally w
-00014940: 7269 7465 2074 6f20 6669 6c65 2e20 6375  rite to file. cu
-00014950: 7272 656e 746c 7920 4e4f 2d4f 5022 2222  rrently NO-OP"""
-00014960: 0a20 2020 2020 2020 2070 7269 6e74 2866  .        print(f
-00014970: 2272 756e 5f65 7874 7261 6374 2069 7320  "run_extract is 
-00014980: 4e4f 2d4f 5022 290a 2020 2020 2020 2020  NO-OP").        
-00014990: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
-000149a0: 2023 2063 6c61 7373 2041 6e6e 6f74 6174   # class Annotat
-000149b0: 6f72 436f 6d6d 616e 640a 0a20 2020 2064  orCommand..    d
-000149c0: 6566 2072 656d 6f76 655f 656c 656d 2873  ef remove_elem(s
-000149d0: 656c 662c 2065 6c65 6d2c 2064 6562 7567  elf, elem, debug
-000149e0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-000149f0: 2069 6620 656c 656d 2069 7320 4e6f 6e65   if elem is None
-00014a00: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00014a10: 7475 726e 0a20 2020 2020 2020 2070 6172  turn.        par
-00014a20: 656e 7420 3d20 656c 656d 2e67 6574 7061  ent = elem.getpa
-00014a30: 7265 6e74 2829 0a20 2020 2020 2020 2069  rent().        i
-00014a40: 6620 7061 7265 6e74 2069 7320 4e6f 6e65  f parent is None
-00014a50: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00014a60: 2064 6562 7567 3a0a 2020 2020 2020 2020   debug:.        
-00014a70: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
-00014a80: 656c 656d 656e 7420 7b65 6c65 6d7d 2068  element {elem} h
-00014a90: 6173 206e 6f20 7061 7265 6e74 2229 0a20  as no parent"). 
-00014aa0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00014ab0: 6e0a 2020 2020 2020 2020 7061 7265 6e74  n.        parent
-00014ac0: 2e72 656d 6f76 6528 656c 656d 290a 0a0a  .remove(elem)...
-00014ad0: 0a53 5459 4c45 5f43 5552 4c59 5f52 4520  .STYLE_CURLY_RE 
-00014ae0: 3d20 7265 2e63 6f6d 7069 6c65 2822 283f  = re.compile("(?
-00014af0: 503c 7072 653e 2e2a 297b 283f 503c 7661  P<pre>.*){(?P<va
-00014b00: 6c75 653e 5b5e 7d5d 2a29 7d28 3f50 3c70  lue>[^}]*)}(?P<p
-00014b10: 6f73 743e 2e2a 2922 290a 636c 6173 7320  ost>.*)").class 
-00014b20: 4874 6d6c 5374 796c 653a 0a20 2020 2022  HtmlStyle:.    "
-00014b30: 2222 0a20 2020 206d 6574 686f 6473 2074  "".    methods t
-00014b40: 6f20 7072 6f63 6573 7320 7374 796c 6520  o process style 
-00014b50: 6174 7472 6962 7574 6573 2061 6e64 203c  attributes and <
-00014b60: 7374 796c 653e 2065 6c65 6d65 6e74 730a  style> elements.
-00014b70: 2020 2020 6e6f 2069 6e73 7461 6e63 6520      no instance 
-00014b80: 6461 7461 0a20 2020 2022 2222 0a0a 2020  data.    """..  
-00014b90: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00014ba0: 656c 662c 6373 735f 7374 7269 6e67 3d4e  elf,css_string=N
-00014bb0: 6f6e 6529 3a0a 2020 2020 2020 2020 7365  one):.        se
-00014bc0: 6c66 2e63 7373 5f73 7472 696e 6720 3d20  lf.css_string = 
-00014bd0: 6373 735f 7374 7269 6e67 0a0a 0a0a 2020  css_string....  
-00014be0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00014bf0: 2020 2064 6566 2067 6574 5f63 7373 7374     def get_cssst
-00014c00: 796c 655f 7374 7269 6e67 2863 6c73 2c20  yle_string(cls, 
-00014c10: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
-00014c20: 2222 0a20 2020 2020 2020 2063 6f6e 7665  "".        conve
-00014c30: 6e69 656e 6365 206d 6574 686f 6420 746f  nience method to
-00014c40: 2067 6574 2065 6c65 6d65 6e74 2073 7479   get element sty
-00014c50: 6c65 0a20 2020 2020 2020 203a 7061 7261  le.        :para
-00014c60: 6d20 656c 656d 3a20 746f 2067 6574 2073  m elem: to get s
-00014c70: 7479 6c65 2066 726f 6d0a 2020 2020 2020  tyle from.      
-00014c80: 2020 3a72 6574 7572 6e3a 2073 7479 6c65    :return: style
-00014c90: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
-00014ca0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-00014cb0: 7572 6e20 656c 656d 2e61 7474 7269 622e  urn elem.attrib.
-00014cc0: 6765 7428 2273 7479 6c65 2229 0a0a 2320  get("style")..# 
-00014cd0: 636c 6173 7320 4874 6d6c 5374 796c 650a  class HtmlStyle.
-00014ce0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00014cf0: 640a 2020 2020 6465 6620 7365 745f 7374  d.    def set_st
-00014d00: 796c 6528 636c 732c 2065 6c65 6d2c 2076  yle(cls, elem, v
-00014d10: 616c 7565 293a 0a20 2020 2020 2020 2022  alue):.        "
-00014d20: 2222 0a20 2020 2020 2020 2063 6f6e 7665  "".        conve
-00014d30: 6e69 656e 6365 206d 6574 686f 6420 746f  nience method to
-00014d40: 2073 6574 2073 7479 6c65 206f 6e20 656c   set style on el
-00014d50: 656d 656e 740a 2020 2020 2020 2020 3a70  ement.        :p
-00014d60: 6172 616d 2065 6c65 6d3a 656c 656d 656e  aram elem:elemen
-00014d70: 7420 746f 2073 6574 2073 7479 6c65 206f  t to set style o
-00014d80: 6e0a 2020 2020 2020 2020 3a70 6172 616d  n.        :param
-00014d90: 2076 616c 7565 3a20 6373 7320 7374 7269   value: css stri
-00014da0: 6e67 3b20 6966 2022 2220 6f72 204e 6f6e  ng; if "" or Non
-00014db0: 6520 7265 6d6c 7665 7320 6174 7472 6962  e remlves attrib
-00014dc0: 7574 650a 2020 2020 2020 2020 2222 220a  ute.        """.
-00014dd0: 2020 2020 2020 2020 6966 2065 6c65 6d20          if elem 
-00014de0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00014df0: 2020 2020 2020 2020 2058 6d6c 4c69 622e           XmlLib.
-00014e00: 7365 745f 6174 746e 616d 655f 7661 6c75  set_attname_valu
-00014e10: 6528 656c 656d 2c20 2273 7479 6c65 222c  e(elem, "style",
-00014e20: 2076 616c 7565 290a 0a20 2020 2023 2063   value)..    # c
-00014e30: 6c61 7373 2048 746d 6c53 7479 6c65 0a0a  lass HtmlStyle..
-00014e40: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00014e50: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
-00014e60: 5f61 6c6c 5f73 7479 6c65 5f61 7474 7269  _all_style_attri
-00014e70: 6275 7465 735f 746f 5f68 6561 6428 636c  butes_to_head(cl
-00014e80: 732c 2068 746d 6c5f 656c 656d 293a 0a20  s, html_elem):. 
-00014e90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00014ea0: 2020 2046 696e 6473 2061 6c6c 2065 6c65     Finds all ele
-00014eb0: 6d65 6e74 7320 7769 7468 2040 7374 796c  ments with @styl
-00014ec0: 6520 6174 7472 6962 7574 6520 616e 6420  e attribute and 
-00014ed0: 6578 7461 6374 7320 7468 6520 7464 7874  extacts the tdxt
-00014ee0: 2073 7479 6c65 7320 746f 203c 6865 6164   styles to <head
-00014ef0: 3e0a 2020 2020 2020 2020 416c 736f 2073  >.        Also s
-00014f00: 6574 7320 626f 6479 2073 7479 6c65 7320  ets body styles 
-00014f10: 746f 206e 6f72 6d61 6c0a 2020 2020 2020  to normal.      
-00014f20: 2020 3a70 6172 616d 2068 746d 6c5f 656c    :param html_el
-00014f30: 656d 3a20 746f 7461 6c20 6874 6d6c 206f  em: total html o
-00014f40: 626a 6563 7420 746f 206e 6f72 6d61 6c69  bject to normali
-00014f50: 7a65 2e20 4d75 7374 2068 6176 6520 3c68  ze. Must have <h
-00014f60: 6561 643e 2061 6e64 203c 626f 6479 3e0a  ead> and <body>.
-00014f70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00014f80: 2020 2020 4874 6d6c 5374 796c 652e 7265      HtmlStyle.re
-00014f90: 6d6f 7665 5f65 6d70 7479 5f73 7479 6c65  move_empty_style
-00014fa0: 7328 6874 6d6c 5f65 6c65 6d29 0a20 2020  s(html_elem).   
-00014fb0: 2020 2020 2073 7479 6c65 645f 656c 656d       styled_elem
-00014fc0: 7320 3d20 6874 6d6c 5f65 6c65 6d2e 7870  s = html_elem.xp
-00014fd0: 6174 6828 222e 2f2f 2a5b 4073 7479 6c65  ath(".//*[@style
-00014fe0: 5d22 290a 2020 2020 2020 2020 666f 7220  ]").        for 
-00014ff0: 692c 2073 7479 6c65 645f 656c 656d 2069  i, styled_elem i
-00015000: 6e20 656e 756d 6572 6174 6528 7374 796c  n enumerate(styl
-00015010: 6564 5f65 6c65 6d73 293a 0a20 2020 2020  ed_elems):.     
-00015020: 2020 2020 2020 2063 6c61 7373 7265 6620         classref 
-00015030: 3d20 6622 737b 697d 220a 2020 2020 2020  = f"s{i}".      
-00015040: 2020 2020 2020 4874 6d6c 5374 796c 652e        HtmlStyle.
-00015050: 6164 645f 656c 656d 656e 745f 7769 7468  add_element_with
-00015060: 5f73 7479 6c65 2863 6c61 7373 7265 662c  _style(classref,
-00015070: 2068 746d 6c5f 656c 656d 2c20 7374 796c   html_elem, styl
-00015080: 6564 5f65 6c65 6d29 0a20 2020 2020 2020  ed_elem).       
-00015090: 2023 2064 6f65 7320 7468 6973 2064 6f20   # does this do 
-000150a0: 616e 7974 6869 6e67 3f3f 3f0a 2020 2020  anything???.    
-000150b0: 2020 2020 626f 6479 203d 2068 746d 6c5f      body = html_
-000150c0: 656c 656d 2e78 7061 7468 2822 2f68 746d  elem.xpath("/htm
-000150d0: 6c2f 626f 6479 2229 0a20 2020 2020 2020  l/body").       
-000150e0: 2069 6620 6c65 6e28 626f 6479 2920 213d   if len(body) !=
-000150f0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00015100: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00015110: 2866 2264 6f63 756d 656e 7420 7368 6f75  (f"document shou
-00015120: 6c64 2068 6176 6520 6578 6163 746c 7920  ld have exactly 
-00015130: 3120 626f 6479 2074 6167 2229 0a20 2020  1 body tag").   
-00015140: 2020 2020 2073 7479 6c65 203d 2043 5353       style = CSS
-00015150: 5374 796c 6528 290a 2020 2020 2020 2020  Style().        
-00015160: 7374 796c 652e 6372 6561 7465 5f63 7373  style.create_css
-00015170: 5f73 7479 6c65 5f66 726f 6d5f 6373 735f  _style_from_css_
-00015180: 7374 7269 6e67 280a 2020 2020 2020 2020  string(.        
-00015190: 2020 2020 2266 6f6e 742d 7374 796c 653a      "font-style:
-000151a0: 206e 6f72 6d61 6c3b 2022 0a20 2020 2020   normal; ".     
-000151b0: 2020 2020 2020 2022 666f 6e74 2d77 6569         "font-wei
-000151c0: 6768 743a 206e 6f72 6d61 6c3b 2022 0a20  ght: normal; ". 
-000151d0: 2020 2020 2020 2020 2020 2022 666f 6e74             "font
-000151e0: 2d73 7472 6574 6368 6564 3a20 6e6f 726d  -stretched: norm
-000151f0: 616c 3b20 220a 2020 2020 2020 2020 2020  al; ".          
-00015200: 2020 226f 7061 6369 7479 3a20 313b 2022    "opacity: 1; "
-00015210: 0a20 2020 2020 2020 2020 2020 2022 636f  .            "co
-00015220: 6c6f 723a 2062 6c61 636b 3b22 0a20 2020  lor: black;".   
-00015230: 2020 2020 2029 0a0a 2020 2020 2320 636c       )..    # cl
-00015240: 6173 7320 4874 6d6c 5374 796c 650a 0a20  ass HtmlStyle.. 
-00015250: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00015260: 2020 2020 6465 6620 6164 645f 656c 656d      def add_elem
-00015270: 656e 745f 7769 7468 5f73 7479 6c65 2863  ent_with_style(c
-00015280: 6c73 2c20 636c 6173 7372 6566 2c20 6874  ls, classref, ht
-00015290: 6d6c 5f65 6c65 6d2c 2073 7479 6c65 645f  ml_elem, styled_
-000152a0: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
-000152b0: 2222 0a20 2020 2020 2020 2061 6464 730a  "".        adds.
-000152c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000152d0: 2020 2020 6865 6164 203d 2068 746d 6c5f      head = html_
-000152e0: 656c 656d 2e78 7061 7468 2822 2f68 746d  elem.xpath("/htm
-000152f0: 6c2f 6865 6164 2229 5b30 5d0a 2020 2020  l/head")[0].    
-00015300: 2020 2020 656c 656d 5f73 7479 6c65 203d      elem_style =
-00015310: 2048 746d 6c53 7479 6c65 2e67 6574 5f63   HtmlStyle.get_c
-00015320: 7373 7374 796c 655f 7374 7269 6e67 2873  ssstyle_string(s
-00015330: 7479 6c65 645f 656c 656d 290a 2020 2020  tyled_elem).    
-00015340: 2020 2020 6966 2065 6c65 6d5f 7374 796c      if elem_styl
-00015350: 6520 6973 204e 6f6e 6520 6f72 2065 6c65  e is None or ele
-00015360: 6d5f 7374 796c 6520 3d3d 2022 223a 0a20  m_style == "":. 
-00015370: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00015380: 6e0a 2020 2020 2020 2020 6373 7320 3d20  n.        css = 
-00015390: 4353 5353 7479 6c65 2e63 7265 6174 655f  CSSStyle.create_
-000153a0: 6373 735f 7374 796c 655f 6672 6f6d 5f63  css_style_from_c
-000153b0: 7373 5f73 7472 696e 6728 656c 656d 5f73  ss_string(elem_s
-000153c0: 7479 6c65 290a 2020 2020 2020 2020 6966  tyle).        if
-000153d0: 2063 7373 2069 7320 4e6f 6e65 3a0a 2020   css is None:.  
-000153e0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000153f0: 5661 6c75 6545 7272 6f72 2866 2263 7373  ValueError(f"css
-00015400: 2069 7320 4e6f 6e65 2229 0a0a 2020 2020   is None")..    
-00015410: 2020 2020 6578 7472 6163 7465 645f 7374      extracted_st
-00015420: 796c 655f 656c 656d 2c20 7265 6d61 696e  yle_elem, remain
-00015430: 696e 675f 7374 796c 652c 206e 6577 5f63  ing_style, new_c
-00015440: 6c61 7373 203d 2063 7373 2e65 7874 7261  lass = css.extra
-00015450: 6374 5f74 6578 745f 7374 796c 6573 5f69  ct_text_styles_i
-00015460: 6e74 6f5f 636c 6173 7328 636c 6173 7372  nto_class(classr
-00015470: 6566 290a 2020 2020 2020 2020 6966 2065  ef).        if e
-00015480: 7874 7261 6374 6564 5f73 7479 6c65 5f65  xtracted_style_e
-00015490: 6c65 6d20 6973 206e 6f74 204e 6f6e 653a  lem is not None:
-000154a0: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
-000154b0: 6c53 7479 6c65 2e73 6574 5f73 7479 6c65  lStyle.set_style
-000154c0: 2873 7479 6c65 645f 656c 656d 2c20 7265  (styled_elem, re
-000154d0: 6d61 696e 696e 675f 7374 796c 6529 0a20  maining_style). 
-000154e0: 2020 2020 2020 2020 2020 2048 746d 6c43             HtmlC
-000154f0: 6c61 7373 2e73 6574 5f63 6c61 7373 5f6f  lass.set_class_o
-00015500: 6e5f 656c 656d 656e 7428 7374 796c 6564  n_element(styled
-00015510: 5f65 6c65 6d2c 2063 6c61 7373 7265 662c  _elem, classref,
-00015520: 2072 6570 6c61 6365 3d46 616c 7365 290a   replace=False).
-00015530: 2020 2020 2020 2020 2020 2020 6865 6164              head
-00015540: 2e61 7070 656e 6428 6578 7472 6163 7465  .append(extracte
-00015550: 645f 7374 796c 655f 656c 656d 290a 0a20  d_style_elem).. 
-00015560: 2020 2023 2063 6c61 7373 2048 746d 6c53     # class HtmlS
-00015570: 7479 6c65 0a0a 2020 2020 4063 6c61 7373  tyle..    @class
-00015580: 6d65 7468 6f64 0a20 2020 2064 6566 2072  method.    def r
-00015590: 656d 6f76 655f 656d 7074 795f 7374 796c  emove_empty_styl
-000155a0: 6573 2863 6c73 2c20 6874 6d6c 5f65 6c65  es(cls, html_ele
-000155b0: 6d29 3a0a 2020 2020 2020 2020 2222 220a  m):.        """.
-000155c0: 2020 2020 2020 2020 7265 6d6f 7665 7320          removes 
-000155d0: 616c 6c20 656d 7074 7920 7374 796c 6520  all empty style 
-000155e0: 6174 7472 6962 7574 6573 2028 7374 796c  attributes (styl
-000155f0: 653d 2222 290a 2020 2020 2020 2020 2222  e="").        ""
-00015600: 220a 2020 2020 2020 2020 656d 7074 795f  ".        empty_
-00015610: 7374 796c 6564 5f65 6c65 6d73 203d 2068  styled_elems = h
-00015620: 746d 6c5f 656c 656d 2e78 7061 7468 2822  tml_elem.xpath("
-00015630: 2e2f 2f2a 5b6e 6f72 6d61 6c69 7a65 2d73  .//*[normalize-s
-00015640: 7061 6365 2840 7374 796c 6529 3d27 275d  pace(@style)='']
-00015650: 2229 0a20 2020 2020 2020 2066 6f72 2065  ").        for e
-00015660: 6c65 6d20 696e 2065 6d70 7479 5f73 7479  lem in empty_sty
-00015670: 6c65 645f 656c 656d 733a 0a20 2020 2020  led_elems:.     
-00015680: 2020 2020 2020 2048 746d 6c53 7479 6c65         HtmlStyle
-00015690: 2e64 656c 6574 655f 7374 796c 6528 656c  .delete_style(el
-000156a0: 656d 290a 0a20 2020 2023 2063 6c61 7373  em)..    # class
-000156b0: 2048 746d 6c53 7479 6c65 0a0a 2020 2020   HtmlStyle..    
-000156c0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-000156d0: 2064 6566 2064 656c 6574 655f 7374 796c   def delete_styl
-000156e0: 6528 636c 732c 2065 6c65 6d29 3a0a 2020  e(cls, elem):.  
-000156f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00015700: 2020 636f 6e76 656e 6965 6e6e 6365 206d    conveniennce m
-00015710: 6574 686f 6420 746f 2064 656c 6574 6520  ethod to delete 
-00015720: 7374 796c 6520 6174 7472 6962 7574 650a  style attribute.
-00015730: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00015740: 2020 2020 586d 6c4c 6962 2e72 656d 6f76      XmlLib.remov
-00015750: 655f 6174 7472 6962 7574 6528 656c 656d  e_attribute(elem
-00015760: 2c20 2273 7479 6c65 2229 0a0a 2020 2020  , "style")..    
-00015770: 2320 5448 4553 4520 4341 4e20 4245 434f  # THESE CAN BECO
-00015780: 4d45 2049 4e53 5441 4e43 4520 4d45 5448  ME INSTANCE METH
-00015790: 4f44 530a 0a20 2020 2023 2063 6c61 7373  ODS..    # class
-000157a0: 2048 746d 6c53 7479 6c65 0a0a 2020 2020   HtmlStyle..    
-000157b0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-000157c0: 2064 6566 206e 6f72 6d61 6c69 7a65 5f68   def normalize_h
-000157d0: 6561 645f 7374 796c 6573 2863 6c73 2c20  ead_styles(cls, 
-000157e0: 656c 656d 2c20 6974 616c 6963 5f62 6f6c  elem, italic_bol
-000157f0: 643d 5472 7565 2c20 6f75 7464 6972 3d4e  d=True, outdir=N
-00015800: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-00015810: 220a 2020 2020 2020 2020 6372 6561 7465  ".        create
-00015820: 7320 6d75 6c74 6964 6963 7420 666f 7420  s multidict fot 
-00015830: 6865 6164 2073 7479 6c65 730a 2020 2020  head styles.    
-00015840: 2020 2020 3a70 6172 616d 2065 6c65 6d3a      :param elem:
-00015850: 2064 6f63 756d 656e 7420 746f 2061 6e61   document to ana
-00015860: 6c79 7365 0a20 2020 2020 2020 203a 7265  lyse.        :re
-00015870: 7475 726e 3a20 6469 6374 206f 6620 636c  turn: dict of cl
-00015880: 6173 7372 6566 5f73 6574 7320 696e 6465  assref_sets inde
-00015890: 7865 6420 6279 2073 7479 6c65 2073 7472  xed by style str
-000158a0: 696e 6773 0a0a 2020 2020 2020 2020 652e  ings..        e.
-000158b0: 672e 2069 7465 6d20 7b66 6f6e 742d 6661  g. item {font-fa
-000158c0: 6d69 6c79 3a20 5469 6d65 734e 6577 526f  mily: TimesNewRo
-000158d0: 6d61 6e50 534d 543b 2066 6f6e 742d 7369  manPSMT; font-si
-000158e0: 7a65 3a20 3670 783b 7d3a 205b 272e 7331  ze: 6px;}: ['.s1
-000158f0: 3727 2c20 272e 7331 3927 2c20 272e 7332  7', '.s19', '.s2
-00015900: 3127 2c20 272e 7332 3727 2c20 272e 7335  1', '.s27', '.s5
-00015910: 272c 2027 2e73 3727 5d0a 2020 2020 2020  ', '.s7'].      
-00015920: 2020 2222 220a 2020 2020 2020 2020 7374    """.        st
-00015930: 796c 655f 746f 5f63 6c61 7373 7265 665f  yle_to_classref_
-00015940: 7365 7420 3d20 6465 6661 756c 7464 6963  set = defaultdic
-00015950: 7428 7365 7429 0a20 2020 2020 2020 2068  t(set).        h
-00015960: 6561 645f 7374 796c 6573 203d 2048 746d  ead_styles = Htm
-00015970: 6c53 7479 6c65 2e67 6574 5f68 6561 645f  lStyle.get_head_
-00015980: 7374 796c 6573 2865 6c65 6d29 0a20 2020  styles(elem).   
-00015990: 2020 2020 2023 2077 6520 7573 6520 6f6e       # we use on
-000159a0: 6520 636c 6173 7372 6566 202d 2073 7479  e classref - sty
-000159b0: 6c65 2070 6572 2048 544d 4c20 7374 796c  le per HTML styl
-000159c0: 650a 2020 2020 2020 2020 666f 7220 6874  e.        for ht
-000159d0: 6d6c 5f73 7479 6c65 2069 6e20 6865 6164  ml_style in head
-000159e0: 5f73 7479 6c65 733a 0a20 2020 2020 2020  _styles:.       
-000159f0: 2020 2020 2023 2063 6f6e 7369 7374 7320       # consists 
-00015a00: 6f66 2063 6c61 7373 7265 6620 736e 6420  of classref snd 
-00015a10: 7374 796c 655f 7374 7269 6e67 0a20 2020  style_string.   
-00015a20: 2020 2020 2020 2020 2063 6c61 7373 7265           classre
-00015a30: 662c 2073 7479 6c65 5f73 203d 2063 6c73  f, style_s = cls
-00015a40: 2e65 7874 7261 6374 5f63 6c61 7373 7265  .extract_classre
-00015a50: 665f 616e 645f 6373 7373 7472 696e 675f  f_and_cssstring_
-00015a60: 6672 6f6d 5f68 746d 6c5f 7374 796c 6528  from_html_style(
-00015a70: 6874 6d6c 5f73 7479 6c65 290a 2020 2020  html_style).    
-00015a80: 2020 2020 2020 2020 7374 796c 655f 7661          style_va
-00015a90: 6c75 6520 3d20 7374 796c 655f 730a 2020  lue = style_s.  
-00015aa0: 2020 2020 2020 2020 2020 6966 2069 7461            if ita
-00015ab0: 6c69 635f 626f 6c64 3a0a 2020 2020 2020  lic_bold:.      
-00015ac0: 2020 2020 2020 2020 2020 6e65 775f 6373            new_cs
-00015ad0: 735f 7320 3d20 416d 6946 6f6e 742e 6372  s_s = AmiFont.cr
-00015ae0: 6561 7465 5f66 6f6e 745f 6564 6974 6564  eate_font_edited
-00015af0: 5f73 7479 6c65 5f66 726f 6d5f 6373 735f  _style_from_css_
-00015b00: 7374 796c 655f 6f62 6a65 6374 2873 7479  style_object(sty
-00015b10: 6c65 5f73 290a 2020 2020 2020 2020 2020  le_s).          
-00015b20: 2020 2020 2020 6373 735f 7374 796c 6520        css_style 
-00015b30: 3d20 4353 5353 7479 6c65 2e63 7265 6174  = CSSStyle.creat
-00015b40: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
-00015b50: 5f63 7373 5f73 7472 696e 6728 6e65 775f  _css_string(new_
-00015b60: 6373 735f 7329 0a20 2020 2020 2020 2020  css_s).         
-00015b70: 2020 2020 2020 2069 6620 6373 735f 7374         if css_st
-00015b80: 796c 6520 6973 206e 6f74 204e 6f6e 653a  yle is not None:
-00015b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015ba0: 2020 2020 2063 7373 5f73 7479 6c65 2e65       css_style.e
-00015bb0: 7874 7261 6374 5f62 6f6c 645f 6974 616c  xtract_bold_ital
-00015bc0: 6963 5f66 726f 6d5f 666f 6e74 5f66 616d  ic_from_font_fam
-00015bd0: 696c 7928 290a 2020 2020 2020 2020 2020  ily().          
-00015be0: 2020 2020 2020 2020 2020 7374 796c 655f            style_
-00015bf0: 7661 6c75 6520 3d20 6373 735f 7374 796c  value = css_styl
-00015c00: 652e 6765 745f 6373 735f 7661 6c75 6528  e.get_css_value(
-00015c10: 7772 6170 5f77 6974 685f 6375 726c 793d  wrap_with_curly=
-00015c20: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00015c30: 2020 2020 2020 2020 2020 4874 6d6c 5374            HtmlSt
-00015c40: 796c 652e 7265 706c 6163 655f 6375 726c  yle.replace_curl
-00015c50: 7928 6874 6d6c 5f73 7479 6c65 2c20 7374  y(html_style, st
-00015c60: 796c 655f 7661 6c75 6529 0a20 2020 2020  yle_value).     
-00015c70: 2020 2020 2020 2068 746d 6c5f 7374 796c         html_styl
-00015c80: 652e 6174 7472 6962 5b43 4c41 5353 5245  e.attrib[CLASSRE
-00015c90: 465d 203d 2063 6c61 7373 7265 660a 2020  F] = classref.  
-00015ca0: 2020 2020 2020 2020 2020 7374 796c 655f            style_
-00015cb0: 746f 5f63 6c61 7373 7265 665f 7365 745b  to_classref_set[
-00015cc0: 7374 796c 655f 7661 6c75 655d 2e61 6464  style_value].add
-00015cd0: 2863 6c61 7373 7265 6629 0a20 2020 2020  (classref).     
-00015ce0: 2020 2069 6620 6f75 7464 6972 3a0a 2020     if outdir:.  
-00015cf0: 2020 2020 2020 2020 2020 4874 6d6c 4c69            HtmlLi
-00015d00: 622e 7772 6974 655f 6874 6d6c 5f66 696c  b.write_html_fil
-00015d10: 6528 656c 656d 2c20 5061 7468 286f 7574  e(elem, Path(out
-00015d20: 6469 722c 2022 6e6f 726d 616c 697a 6564  dir, "normalized
-00015d30: 2e68 746d 6c22 2929 0a20 2020 2020 2020  .html")).       
-00015d40: 2072 6574 7572 6e20 7374 796c 655f 746f   return style_to
-00015d50: 5f63 6c61 7373 7265 665f 7365 740a 0a20  _classref_set.. 
-00015d60: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00015d70: 2020 2020 6465 6620 6765 745f 6865 6164      def get_head
-00015d80: 5f73 7479 6c65 7328 636c 732c 2065 6c65  _styles(cls, ele
-00015d90: 6d29 3a0a 2020 2020 2020 2020 2222 2267  m):.        """g
-00015da0: 6574 2061 6c6c 203c 7374 796c 653e 2065  et all <style> e
-00015db0: 6c65 6d65 6e74 7320 6666 726f 6d20 3c68  lements ffrom <h
-00015dc0: 6561 643e 0a20 2020 2020 2020 203a 7061  ead>.        :pa
-00015dd0: 7461 6d20 656c 656d 3a20 6874 6d6c 2065  tam elem: html e
-00015de0: 6c65 6d6e 656e 7420 746f 2073 6561 7263  lemnent to searc
-00015df0: 680a 2020 2020 2020 2020 3a72 6574 7572  h.        :retur
-00015e00: 6e3a 2073 7479 6c65 2065 6c65 6d65 6e74  n: style element
-00015e10: 7320 656c 7365 205b 5d20 6966 2065 6c65  s else [] if ele
-00015e20: 6d20 6973 204e 6f6e 650a 2020 2020 2020  m is None.      
-00015e30: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00015e40: 7475 726e 205b 5d20 6966 2065 6c65 6d20  turn [] if elem 
-00015e50: 6973 204e 6f6e 6520 656c 7365 2065 6c65  is None else ele
-00015e60: 6d2e 7870 6174 6828 222f 6874 6d6c 2f68  m.xpath("/html/h
-00015e70: 6561 642f 7374 796c 6522 290a 0a20 2020  ead/style")..   
-00015e80: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00015e90: 2020 6465 6620 6578 7472 6163 745f 636c    def extract_cl
-00015ea0: 6173 7372 6566 5f61 6e64 5f63 7373 7374  assref_and_cssst
-00015eb0: 7269 6e67 5f66 726f 6d5f 7374 796c 655f  ring_from_style_
-00015ec0: 7465 7874 2863 6c73 2c20 6874 6d6c 5f73  text(cls, html_s
-00015ed0: 7479 6c65 5f73 7472 696e 6729 3a0a 2020  tyle_string):.  
-00015ee0: 2020 2020 2020 2222 2270 6172 7365 7320        """parses 
-00015ef0: 7465 7874 2069 6e20 6874 6d6c 203c 7374  text in html <st
-00015f00: 796c 653e 2069 6e74 6f20 636c 6173 7372  yle> into classr
-00015f10: 6566 2061 6e64 2063 7373 7374 7269 6e67  ef and cssstring
-00015f20: 0a20 2020 2020 2020 206f 6e6c 7920 6f6e  .        only on
-00015f30: 6520 7374 796c 6520 7065 7220 6874 6d6c  e style per html
-00015f40: 2065 6c65 6d65 6e74 0a20 2020 2020 2020   element.       
-00015f50: 203a 7061 7261 6d20 6874 6d6c 5f73 7479   :param html_sty
-00015f60: 6c65 5f73 7472 696e 673a 206f 6620 666f  le_string: of fo
-00015f70: 726d 203c 7365 6c65 6374 6f72 3e20 7b3c  rm <selector> {<
-00015f80: 7661 6c75 653e 7d0a 2020 2020 2020 2020  value>}.        
-00015f90: 3a72 6574 7572 6e20 7365 6c65 6374 6f72  :return selector
-00015fa0: 202c 2076 616c 7565 0a20 2020 2020 2020   , value.       
-00015fb0: 2022 2222 0a0a 2020 2020 2020 2020 7374   """..        st
-00015fc0: 796c 655f 7265 203d 2072 652e 636f 6d70  yle_re = re.comp
-00015fd0: 696c 6528 225c 5c73 2a28 3f50 3c63 6c61  ile("\\s*(?P<cla
-00015fe0: 7373 7265 663e 5b5e 5c5c 735d 2a29 5c5c  ssref>[^\\s]*)\\
-00015ff0: 732b 7b5c 5c73 2a28 3f50 3c63 7373 7374  s+{\\s*(?P<cssst
-00016000: 7269 6e67 3e2e 2a29 7d5c 5c73 2a22 290a  ring>.*)}\\s*").
-00016010: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
-00016020: 7374 796c 655f 7265 2e6d 6174 6368 2868  style_re.match(h
-00016030: 746d 6c5f 7374 796c 655f 7374 7269 6e67  tml_style_string
-00016040: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-00016050: 206d 6174 6368 3a0a 2020 2020 2020 2020   match:.        
-00016060: 2020 2020 7265 7475 726e 204e 6f6e 652c      return None,
-00016070: 204e 6f6e 650a 2020 2020 2020 2020 7265   None.        re
-00016080: 7475 726e 206d 6174 6368 2e67 726f 7570  turn match.group
-00016090: 2822 636c 6173 7372 6566 2229 2c20 6d61  ("classref"), ma
-000160a0: 7463 682e 6772 6f75 7028 2263 7373 7374  tch.group("cssst
-000160b0: 7269 6e67 2229 0a0a 2020 2020 2320 636c  ring")..    # cl
-000160c0: 6173 7320 4874 6d6c 5374 796c 650a 0a20  ass HtmlStyle.. 
-000160d0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-000160e0: 2020 2020 6465 6620 6578 7472 6163 745f      def extract_
-000160f0: 7374 796c 6573 5f61 6e64 5f6e 6f72 6d61  styles_and_norma
-00016100: 6c69 7a65 5f63 6c61 7373 7265 6673 2863  lize_classrefs(c
-00016110: 6c73 2c20 6874 6d6c 5f65 6c65 6d2c 2066  ls, html_elem, f
-00016120: 6f6e 745f 7374 796c 6573 3d46 616c 7365  ont_styles=False
-00016130: 2c20 6f75 7464 6972 3d4e 6f6e 6529 3a0a  , outdir=None):.
-00016140: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00016150: 2020 2020 4578 7472 6163 7420 7374 796c      Extract styl
-00016160: 6573 2066 726f 6d20 646f 6375 6d65 6e74  es from document
-00016170: 0a20 2020 2020 2020 206d 6f76 6520 746f  .        move to
-00016180: 2068 6561 6420 616e 6420 6e6f 726d 616c   head and normal
-00016190: 697a 6520 636c 6173 7372 6566 730a 2020  ize classrefs.  
-000161a0: 2020 2020 2020 6465 6c65 7465 2072 6564        delete red
-000161b0: 756e 6461 6e74 2063 6c61 7373 7265 6673  undant classrefs
-000161c0: 2061 6e64 2073 7479 6c65 730a 2020 2020   and styles.    
-000161d0: 2020 2020 6d61 7020 646f 6375 6d65 6e74      map document
-000161e0: 2069 6e73 7461 6d63 6573 206f 6620 7374   instamces of st
-000161f0: 796c 6573 206f 6e74 6f20 6e6f 726d 616c  yles onto normal
-00016200: 697a 6564 2063 6c61 7373 7265 6673 0a20  ized classrefs. 
-00016210: 2020 2020 2020 203a 7061 7261 6d20 6874         :param ht
-00016220: 6d6c 5f65 6c65 6d3a 2068 746d 6c20 646f  ml_elem: html do
-00016230: 6375 6d65 6e74 2074 6f20 6e6f 726d 616c  cument to normal
-00016240: 697a 650a 0a20 2020 2020 2020 2053 686f  ize..        Sho
-00016250: 756c 6420 6265 2069 6e20 616e 206f 626a  uld be in an obj
-00016260: 6563 740a 2020 2020 2020 2020 544f 444f  ect.        TODO
-00016270: 0a53 6f6d 6520 7370 616e 7320 6172 6520  .Some spans are 
-00016280: 6e6f 7420 6a6f 696e 6564 2c20 7831 206f  not joined, x1 o
-00016290: 6e20 6f6e 6520 7370 616e 2061 6e64 2078  n one span and x
-000162a0: 3020 6f6e 2066 6f6c 6c6f 7769 6e67 2061  0 on following a
-000162b0: 7265 2065 7175 616c 0a20 2020 2020 2020  re equal.       
-000162c0: 203c 6469 7620 6c65 6674 3d22 3134 312e   <div left="141.
-000162d0: 3732 2220 7269 6768 743d 2231 3933 2e33  72" right="193.3
-000162e0: 2220 746f 703d 2236 3332 2e32 3222 3e3c  " top="632.22"><
-000162f0: 7370 616e 2078 303d 2231 3431 2e37 3222  span x0="141.72"
-00016300: 2079 303d 2236 3332 2e32 3222 2078 313d   y0="632.22" x1=
-00016310: 2231 3933 2e33 2220 7374 796c 653d 2278  "193.3" style="x
-00016320: 303a 2031 3431 2e37 323b 2078 313a 2031  0: 141.72; x1: 1
-00016330: 3435 2e30 333b 2079 303a 2036 3332 2e32  45.03; y0: 632.2
-00016340: 323b 2079 313a 2036 3432 2e31 383b 2077  2; y1: 642.18; w
-00016350: 6964 7468 3a20 332e 3332 3b22 2063 6c61  idth: 3.32;" cla
-00016360: 7373 3d22 7331 3022 3e28 6129 416e 20e2  ss="s10">(a)An .
-00016370: 809c 3c2f 7370 616e 3e0a 2020 2020 2020  ..</span>.      
-00016380: 2020 3c73 7061 6e20 7830 3d22 3232 342e    <span x0="224.
-00016390: 3034 2220 7930 3d22 3632 302e 3232 2220  04" y0="620.22" 
-000163a0: 7831 3d22 3338 372e 3934 2220 7374 796c  x1="387.94" styl
-000163b0: 653d 2278 303a 2032 3234 2e30 343b 2078  e="x0: 224.04; x
-000163c0: 313a 2032 3239 2e30 323b 2079 303a 2036  1: 229.02; y0: 6
-000163d0: 3230 2e32 323b 2079 313a 2036 3330 2e31  20.22; y1: 630.1
-000163e0: 383b 2077 6964 7468 3a20 342e 3938 3b22  8; width: 4.98;"
-000163f0: 2063 6c61 7373 3d22 7331 3022 3e70 6172   class="s10">par
-00016400: 6167 7261 7068 7320 34e2 8092 362c 2074  agraphs 4...6, t
-00016410: 6865 7365 2072 756c 6573 2c20 6d6f 6461  hese rules, moda
-00016420: 6c69 7469 6573 2061 3c2f 7370 616e 3e0a  lities a</span>.
-00016430: 2020 2020 2020 2020 3c73 7061 6e20 7830          <span x0
-00016440: 3d22 3338 372e 3936 2220 7930 3d22 3632  ="387.96" y0="62
-00016450: 302e 3232 2220 7831 3d22 3438 342e 3238  0.22" x1="484.28
-00016460: 2220 7374 796c 653d 2278 303a 2033 3837  " style="x0: 387
-00016470: 2e39 363b 2078 313a 2033 3932 2e39 343b  .96; x1: 392.94;
-00016480: 2079 303a 2036 3230 2e32 323b 2079 313a   y0: 620.22; y1:
-00016490: 2036 3330 2e31 383b 2077 6964 7468 3a20   630.18; width: 
-000164a0: 342e 3938 3b22 2063 6c61 7373 3d22 7331  4.98;" class="s1
-000164b0: 3022 3e6e 6420 7072 6f63 6564 7572 6573  0">nd procedures
-000164c0: 2c20 616e 6420 616e 7920 6675 7274 6865  , and any furthe
-000164d0: 7220 7265 6c65 7661 6e74 2064 6563 6973  r relevant decis
-000164e0: 696f 6e73 206f 6620 7468 6520 436f 6e66  ions of the Conf
-000164f0: 6572 656e 6365 206f 6620 7468 6520 5061  erence of the Pa
-00016500: 7274 6965 7320 7365 7276 696e 6720 6173  rties serving as
-00016510: 2074 6865 206d 6565 7469 6e67 206f 6620   the meeting of 
-00016520: 7468 6520 5061 7274 6965 7320 746f 2074  the Parties to t
-00016530: 6865 2050 6172 6973 2041 6772 6565 6d65  he Paris Agreeme
-00016540: 6e74 2028 434d 4129 3b20 3c2f 7370 616e  nt (CMA); </span
-00016550: 3e3c 2f64 6976 3e0a 2020 2020 2020 2020  ></div>.        
-00016560: 2222 220a 0a20 2020 2020 2020 2023 2068  """..        # h
-00016570: 746d 6c5f 656c 656d 203d 2068 746d 6c5f  tml_elem = html_
-00016580: 656c 656d 2e78 7061 7468 2822 2f2a 2229  elem.xpath("/*")
-00016590: 5b30 5d20 6966 2074 7970 6528 6874 6d6c  [0] if type(html
-000165a0: 5f65 6c65 6d29 2069 7320 5f45 6c65 6d65  _elem) is _Eleme
-000165b0: 6e74 5472 6565 2065 6c73 6520 6874 6d6c  ntTree else html
-000165c0: 5f65 6c65 6d0a 2020 2020 2020 2020 636c  _elem.        cl
-000165d0: 732e 6578 7472 6163 745f 616c 6c5f 7374  s.extract_all_st
-000165e0: 796c 655f 6174 7472 6962 7574 6573 5f74  yle_attributes_t
-000165f0: 6f5f 6865 6164 2868 746d 6c5f 656c 656d  o_head(html_elem
-00016600: 290a 2020 2020 2020 2020 6966 206f 7574  ).        if out
-00016610: 6469 723a 0a20 2020 2020 2020 2020 2020  dir:.           
-00016620: 2048 746d 6c4c 6962 2e77 7269 7465 5f68   HtmlLib.write_h
-00016630: 746d 6c5f 6669 6c65 2868 746d 6c5f 656c  tml_file(html_el
-00016640: 656d 2c20 5061 7468 286f 7574 6469 722c  em, Path(outdir,
-00016650: 2022 7374 796c 6573 312e 6874 6d6c 2229   "styles1.html")
-00016660: 2c20 6465 6275 673d 5472 7565 290a 2020  , debug=True).  
-00016670: 2020 2020 2020 7374 796c 655f 746f 5f63        style_to_c
-00016680: 6c61 7373 7265 665f 7365 7420 3d20 636c  lassref_set = cl
-00016690: 732e 6e6f 726d 616c 697a 655f 6865 6164  s.normalize_head
-000166a0: 5f73 7479 6c65 7328 6874 6d6c 5f65 6c65  _styles(html_ele
-000166b0: 6d2c 206f 7574 6469 723d 6f75 7464 6972  m, outdir=outdir
-000166c0: 290a 2020 2020 2020 2020 636c 6173 7372  ).        classr
-000166d0: 6566 5f69 6e64 6578 203d 2063 6c73 2e63  ef_index = cls.c
-000166e0: 7265 6174 655f 636c 6173 7372 6566 5f69  reate_classref_i
-000166f0: 6e64 6578 2873 7479 6c65 5f74 6f5f 636c  ndex(style_to_cl
-00016700: 6173 7372 6566 5f73 6574 290a 2020 2020  assref_set).    
-00016710: 2020 2020 6465 6c65 7461 626c 655f 636c      deletable_cl
-00016720: 6173 7372 6566 7320 3d20 636c 732e 6765  assrefs = cls.ge
-00016730: 745f 7265 6475 6e64 616e 745f 636c 6173  t_redundant_clas
-00016740: 7372 6566 7328 636c 6173 7372 6566 5f69  srefs(classref_i
-00016750: 6e64 6578 290a 2020 2020 2020 2020 636c  ndex).        cl
-00016760: 732e 6465 6c65 7465 5f72 6564 756e 6461  s.delete_redunda
-00016770: 6e74 5f73 7479 6c65 7328 6465 6c65 7461  nt_styles(deleta
-00016780: 626c 655f 636c 6173 7372 6566 732c 2068  ble_classrefs, h
-00016790: 746d 6c5f 656c 656d 290a 2020 2020 2020  tml_elem).      
-000167a0: 2020 636c 732e 6e6f 726d 616c 697a 655f    cls.normalize_
-000167b0: 636c 6173 7372 6566 735f 6f6e 5f65 6c65  classrefs_on_ele
-000167c0: 6d65 6e74 7328 6874 6d6c 5f65 6c65 6d2c  ments(html_elem,
-000167d0: 2063 6c61 7373 7265 665f 696e 6465 7829   classref_index)
-000167e0: 0a20 2020 2020 2020 2069 6620 666f 6e74  .        if font
-000167f0: 5f73 7479 6c65 733a 0a20 2020 2020 2020  _styles:.       
-00016800: 2020 2020 2063 6c73 2e63 7265 6174 655f       cls.create_
-00016810: 6162 6272 6576 6961 7465 645f 666f 6e74  abbreviated_font
-00016820: 5f73 7479 6c65 7328 6874 6d6c 5f65 6c65  _styles(html_ele
-00016830: 6d29 0a0a 2020 2020 2320 636c 6173 7320  m)..    # class 
-00016840: 4874 6d6c 5374 796c 650a 0a20 2020 2040  HtmlStyle..    @
-00016850: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00016860: 6465 6620 6e6f 726d 616c 697a 655f 636c  def normalize_cl
-00016870: 6173 7372 6566 735f 6f6e 5f65 6c65 6d65  assrefs_on_eleme
-00016880: 6e74 7328 636c 732c 2068 746d 6c5f 656c  nts(cls, html_el
-00016890: 656d 2c20 636c 6173 7372 6566 5f69 6e64  em, classref_ind
-000168a0: 6578 293a 0a20 2020 2020 2020 2022 2222  ex):.        """
-000168b0: 0a20 2020 2020 2020 2046 696e 6473 2061  .        Finds a
-000168c0: 6c6c 2065 6c6d 656e 7473 2077 6974 6820  ll elments with 
-000168d0: 4063 6c61 7373 2061 7474 7269 6275 7465  @class attribute
-000168e0: 2061 6e64 206e 6f72 6d61 6c69 7a65 2074   and normalize t
-000168f0: 6f20 6d69 6e69 6d61 6c20 7365 740a 2020  o minimal set.  
-00016900: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00016910: 2020 636c 6173 7365 645f 656c 656d 7320    classed_elems 
-00016920: 3d20 6874 6d6c 5f65 6c65 6d2e 7870 6174  = html_elem.xpat
-00016930: 6828 222f 2f2a 5b40 636c 6173 735d 2229  h("//*[@class]")
-00016940: 0a20 2020 2020 2020 2066 6f72 2063 6c61  .        for cla
-00016950: 7373 6564 5f65 6c65 6d20 696e 2063 6c61  ssed_elem in cla
-00016960: 7373 6564 5f65 6c65 6d73 3a0a 2020 2020  ssed_elems:.    
-00016970: 2020 2020 2020 2020 6874 6d6c 5f63 6c61          html_cla
-00016980: 7373 203d 2048 746d 6c43 6c61 7373 2e63  ss = HtmlClass.c
-00016990: 7265 6174 655f 6672 6f6d 5f63 6c61 7373  reate_from_class
-000169a0: 6564 5f65 6c65 6d65 6e74 2863 6c61 7373  ed_element(class
-000169b0: 6564 5f65 6c65 6d29 0a20 2020 2020 2020  ed_elem).       
-000169c0: 2020 2020 2063 6c61 7373 7265 6620 3d20       classref = 
-000169d0: 6874 6d6c 5f63 6c61 7373 2e63 7265 6174  html_class.creat
-000169e0: 655f 636c 6173 7372 6566 2829 0a20 2020  e_classref().   
-000169f0: 2020 2020 2020 2020 206e 6f72 6d61 6c69           normali
-00016a00: 7a65 645f 636c 6173 7372 6566 203d 2048  zed_classref = H
-00016a10: 746d 6c43 6c61 7373 2e72 656d 6f76 655f  tmlClass.remove_
-00016a20: 646f 7428 636c 6173 7372 6566 5f69 6e64  dot(classref_ind
-00016a30: 6578 2e67 6574 2863 6c61 7373 7265 6629  ex.get(classref)
-00016a40: 290a 2020 2020 2020 2020 2020 2020 636c  ).            cl
-00016a50: 6173 7372 6566 203d 2048 746d 6c43 6c61  assref = HtmlCla
-00016a60: 7373 2e72 656d 6f76 655f 646f 7428 636c  ss.remove_dot(cl
-00016a70: 6173 7372 6566 290a 2020 2020 2020 2020  assref).        
-00016a80: 2020 2020 6966 206e 6f72 6d61 6c69 7a65      if normalize
-00016a90: 645f 636c 6173 7372 6566 2021 3d20 636c  d_classref != cl
-00016aa0: 6173 7372 6566 3a0a 2020 2020 2020 2020  assref:.        
-00016ab0: 2020 2020 2020 2020 6874 6d6c 5f63 6c61          html_cla
-00016ac0: 7373 2e72 6570 6c61 6365 5f63 6c61 7373  ss.replace_class
-00016ad0: 2863 6c61 7373 7265 662c 206e 6f72 6d61  (classref, norma
-00016ae0: 6c69 7a65 645f 636c 6173 7372 6566 290a  lized_classref).
-00016af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b00: 6966 2068 746d 6c5f 636c 6173 732e 636c  if html_class.cl
-00016b10: 6173 735f 7374 7269 6e67 3a0a 2020 2020  ass_string:.    
-00016b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b30: 4874 6d6c 436c 6173 732e 7365 745f 636c  HtmlClass.set_cl
-00016b40: 6173 735f 6f6e 5f65 6c65 6d65 6e74 2863  ass_on_element(c
-00016b50: 6c61 7373 6564 5f65 6c65 6d2c 2068 746d  lassed_elem, htm
-00016b60: 6c5f 636c 6173 732e 636c 6173 735f 7374  l_class.class_st
-00016b70: 7269 6e67 290a 0a20 2020 2023 2063 6c61  ring)..    # cla
-00016b80: 7373 2048 746d 6c53 7479 6c65 0a0a 2020  ss HtmlStyle..  
-00016b90: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00016ba0: 2020 2064 6566 2064 656c 6574 655f 7265     def delete_re
-00016bb0: 6475 6e64 616e 745f 7374 796c 6573 2863  dundant_styles(c
-00016bc0: 6c73 2c20 6465 6c65 7461 626c 655f 636c  ls, deletable_cl
-00016bd0: 6173 7372 6566 732c 2068 746d 6c5f 656c  assrefs, html_el
-00016be0: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-00016bf0: 0a20 2020 2020 2020 2064 656c 6574 6573  .        deletes
-00016c00: 2072 6564 756e 6461 6e74 203c 7374 796c   redundant <styl
-00016c10: 653e 7320 696e 2068 6561 640a 2020 2020  e>s in head.    
-00016c20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00016c30: 7374 796c 6573 5f77 6974 685f 636c 6173  styles_with_clas
-00016c40: 7372 6566 7320 3d20 6874 6d6c 5f65 6c65  srefs = html_ele
-00016c50: 6d2e 7870 6174 6828 222f 6874 6d6c 2f68  m.xpath("/html/h
-00016c60: 6561 642f 7374 796c 655b 4063 6c61 7373  ead/style[@class
-00016c70: 7265 665d 2229 0a20 2020 2020 2020 2066  ref]").        f
-00016c80: 6f72 2073 7479 6c65 2069 6e20 7374 796c  or style in styl
-00016c90: 6573 5f77 6974 685f 636c 6173 7372 6566  es_with_classref
-00016ca0: 733a 0a20 2020 2020 2020 2020 2020 2063  s:.            c
-00016cb0: 6c61 7373 7265 6620 3d20 7374 796c 652e  lassref = style.
-00016cc0: 6174 7472 6962 2e67 6574 2843 4c41 5353  attrib.get(CLASS
-00016cd0: 5245 4629 0a20 2020 2020 2020 2020 2020  REF).           
-00016ce0: 2069 6620 636c 6173 7372 6566 2069 6e20   if classref in 
-00016cf0: 6465 6c65 7461 626c 655f 636c 6173 7372  deletable_classr
-00016d00: 6566 733a 0a20 2020 2020 2020 2020 2020  efs:.           
-00016d10: 2020 2020 2058 6d6c 4c69 622e 7265 6d6f       XmlLib.remo
-00016d20: 7665 5f65 6c65 6d65 6e74 2873 7479 6c65  ve_element(style
-00016d30: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
-00016d40: 746d 6c53 7479 6c65 0a0a 2020 2020 4063  tmlStyle..    @c
-00016d50: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00016d60: 6566 2067 6574 5f72 6564 756e 6461 6e74  ef get_redundant
-00016d70: 5f63 6c61 7373 7265 6673 2863 6c73 2c20  _classrefs(cls, 
-00016d80: 636c 6173 7372 6566 5f69 6e64 6578 293a  classref_index):
-00016d90: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00016da0: 2020 2020 206d 616b 6573 206c 6973 7420       makes list 
-00016db0: 6f66 2072 6564 756e 6461 6e74 2063 6c61  of redundant cla
-00016dc0: 7373 7265 6673 0a20 2020 2020 2020 203a  ssrefs.        :
-00016dd0: 7061 7261 6d20 636c 6173 7372 6566 5f69  param classref_i
-00016de0: 6e64 6578 3a20 6469 6374 696f 6e61 7279  ndex: dictionary
-00016df0: 206d 6170 7069 6e67 2063 6c61 7373 7265   mapping classre
-00016e00: 6673 206f 6e74 6f20 6e6f 726d 616c 697a  fs onto normaliz
-00016e10: 6564 2063 6c61 7373 7265 660a 2020 2020  ed classref.    
-00016e20: 2020 2020 3a72 6574 7572 6e3a 206c 6973      :return: lis
-00016e30: 7420 6f66 2072 6564 756e 6461 6e74 2063  t of redundant c
-00016e40: 6c61 7373 7265 6673 0a20 2020 2020 2020  lassrefs.       
-00016e50: 2022 2222 0a20 2020 2020 2020 2072 6564   """.        red
-00016e60: 756e 6461 6e74 5f63 6c61 7373 7265 6673  undant_classrefs
-00016e70: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
-00016e80: 7220 6974 656d 2069 6e20 636c 6173 7372  r item in classr
-00016e90: 6566 5f69 6e64 6578 2e69 7465 6d73 2829  ef_index.items()
-00016ea0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00016eb0: 2069 7465 6d5b 305d 2021 3d20 6974 656d   item[0] != item
-00016ec0: 5b31 5d3a 0a20 2020 2020 2020 2020 2020  [1]:.           
-00016ed0: 2020 2020 2072 6564 756e 6461 6e74 5f63       redundant_c
-00016ee0: 6c61 7373 7265 6673 2e61 7070 656e 6428  lassrefs.append(
-00016ef0: 6974 656d 5b30 5d29 0a20 2020 2020 2020  item[0]).       
-00016f00: 2072 6574 7572 6e20 7265 6475 6e64 616e   return redundan
-00016f10: 745f 636c 6173 7372 6566 730a 0a20 2020  t_classrefs..   
-00016f20: 2023 2063 6c61 7373 2048 746d 6c53 7479   # class HtmlSty
-00016f30: 6c65 0a0a 2020 2020 4063 6c61 7373 6d65  le..    @classme
-00016f40: 7468 6f64 0a20 2020 2064 6566 2063 7265  thod.    def cre
-00016f50: 6174 655f 636c 6173 7372 6566 5f69 6e64  ate_classref_ind
-00016f60: 6578 2863 6c73 2c20 7374 796c 655f 746f  ex(cls, style_to
-00016f70: 5f63 6c61 7373 7265 665f 7365 7429 3a0a  _classref_set):.
-00016f80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00016f90: 2020 2020 6d61 7073 2061 6c6c 2069 7465      maps all ite
-00016fa0: 6d73 2069 6e20 636c 6173 7372 6566 2073  ms in classref s
-00016fb0: 6574 7320 6f6e 746f 2028 6172 6269 7472  ets onto (arbitr
-00016fc0: 6172 696c 7929 2074 6865 2066 6972 7374  arily) the first
-00016fd0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00016fe0: 7374 796c 655f 746f 5f63 6c61 7373 7265  style_to_classre
-00016ff0: 665f 7365 743a 2063 6c61 7373 7265 665f  f_set: classref_
-00017000: 7365 7473 206d 6d61 7070 6564 2062 7920  sets mmapped by 
-00017010: 7374 796c 6520 7661 6c75 650a 2020 2020  style value.    
-00017020: 2020 2020 3a72 6574 7572 6e3a 6469 6374      :return:dict
-00017030: 206d 6170 7069 6e67 2072 6564 756e 6461   mapping redunda
-00017040: 6e74 2063 6c61 7373 7265 6673 206f 6e74  nt classrefs ont
-00017050: 6f20 6e6f 726d 616c 697a 6564 2063 6c61  o normalized cla
-00017060: 7373 7265 660a 2020 2020 2020 2020 4d61  ssref.        Ma
-00017070: 7920 6265 6e65 6669 7420 6672 6f6d 2062  y benefit from b
-00017080: 6569 6e67 2069 6e20 6120 636c 6173 730a  eing in a class.
-00017090: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000170a0: 2020 2020 636c 6173 7372 6566 5f69 6e64      classref_ind
-000170b0: 6578 203d 2064 6963 7428 290a 2020 2020  ex = dict().    
-000170c0: 2020 2020 666f 7220 6974 656d 2069 6e20      for item in 
-000170d0: 7374 796c 655f 746f 5f63 6c61 7373 7265  style_to_classre
-000170e0: 665f 7365 742e 6974 656d 7328 293a 0a20  f_set.items():. 
-000170f0: 2020 2020 2020 2020 2020 2063 6c61 7373             class
-00017100: 7265 665f 6c69 7374 203d 206c 6973 7428  ref_list = list(
-00017110: 736f 7274 6564 2869 7465 6d5b 315d 2929  sorted(item[1]))
-00017120: 0a20 2020 2020 2020 2020 2020 2063 6c61  .            cla
-00017130: 7373 7265 6630 203d 206c 6973 7428 636c  ssref0 = list(cl
-00017140: 6173 7372 6566 5f6c 6973 7429 5b30 5d0a  assref_list)[0].
-00017150: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00017160: 636c 6173 7372 6566 2069 6e20 636c 6173  classref in clas
-00017170: 7372 6566 5f6c 6973 743a 0a20 2020 2020  sref_list:.     
-00017180: 2020 2020 2020 2020 2020 2063 6c61 7373             class
-00017190: 7265 665f 696e 6465 785b 636c 6173 7372  ref_index[classr
-000171a0: 6566 5d20 3d20 636c 6173 7372 6566 300a  ef] = classref0.
-000171b0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-000171c0: 6c61 7373 7265 665f 696e 6465 780a 0a20  lassref_index.. 
-000171d0: 2020 2023 2063 6c61 7373 2048 746d 6c53     # class HtmlS
-000171e0: 7479 6c65 0a0a 2020 2020 4063 6c61 7373  tyle..    @class
-000171f0: 6d65 7468 6f64 0a20 2020 2064 6566 2061  method.    def a
-00017200: 6464 5f68 6561 645f 7374 796c 6573 5f6f  dd_head_styles_o
-00017210: 7269 6728 636c 732c 2068 746d 6c5f 656c  rig(cls, html_el
-00017220: 656d 2c20 7374 796c 6573 2c20 6e6f 726d  em, styles, norm
-00017230: 616c 697a 655f 666f 6e74 3d54 7275 6529  alize_font=True)
-00017240: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00017250: 2020 2020 2020 7468 6973 2069 7320 6372        this is cr
-00017260: 7564 650a 2020 2020 2020 2020 2773 7479  ude.        'sty
-00017270: 6c65 206f 6620 666f 726d 0a20 2020 2020  le of form.     
-00017280: 2020 2020 2020 2022 6469 7622 2c20 5b28         "div", [(
-00017290: 2262 6f72 6465 7222 2c20 2272 6564 2073  "border", "red s
-000172a0: 6f6c 6964 2030 2e35 7078 2229 2c20 2822  olid 0.5px"), ("
-000172b0: 6261 636b 6772 6f75 6e64 222c 2022 7965  background", "ye
-000172c0: 6c6c 6f77 295d 290a 2020 2020 2020 2020  llow)]).        
-000172d0: 2222 220a 2020 2020 2020 2020 666f 7220  """.        for 
-000172e0: 7374 796c 6520 696e 2073 7479 6c65 733a  style in styles:
-000172f0: 0a20 2020 2020 2020 2020 2020 2023 2070  .            # p
-00017300: 7269 6e74 2866 2273 7479 6c65 207b 7374  rint(f"style {st
-00017310: 796c 657d 2229 0a20 2020 2020 2020 2020  yle}").         
-00017320: 2020 2048 746d 6c4c 6962 2e61 6464 5f68     HtmlLib.add_h
-00017330: 6561 645f 7374 796c 6528 6874 6d6c 5f65  ead_style(html_e
-00017340: 6c65 6d2c 2073 7479 6c65 5b30 5d2c 2073  lem, style[0], s
-00017350: 7479 6c65 5b31 5d29 0a0a 2020 2020 4063  tyle[1])..    @c
-00017360: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00017370: 6566 2061 6464 5f68 6561 645f 7374 796c  ef add_head_styl
-00017380: 6573 2863 6c73 2c20 6874 6d6c 5f65 6c65  es(cls, html_ele
-00017390: 6d2c 2073 7479 6c65 5f74 6578 7473 2c20  m, style_texts, 
-000173a0: 6e6f 726d 616c 697a 655f 666f 6e74 3d54  normalize_font=T
-000173b0: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
-000173c0: 220a 2020 2020 2020 2020 6164 6473 2074  ".        adds t
-000173d0: 6578 7420 6f66 2066 6f72 6d0a 2020 2020  ext of form.    
-000173e0: 2020 2020 6c6f 6361 746f 7220 6373 730a      locator css.
-000173f0: 2020 2020 2020 2020 652e 672e 2073 7061          e.g. spa
-00017400: 6e2e 7465 6d70 207b 6261 636b 6772 6f75  n.temp {backgrou
-00017410: 6e64 3a20 7265 643b 2066 6f6e 742d 7369  nd: red; font-si
-00017420: 7a65 3a20 3132 7078 3b7d 0a20 2020 2020  ze: 12px;}.     
-00017430: 2020 2022 2222 0a20 2020 2020 2020 2068     """.        h
-00017440: 746d 6c5f 6865 6164 203d 2048 746d 6c4c  tml_head = HtmlL
-00017450: 6962 2e67 6574 5f68 6561 6428 6874 6d6c  ib.get_head(html
-00017460: 5f65 6c65 6d29 0a20 2020 2020 2020 2066  _elem).        f
-00017470: 6f72 2073 7479 6c65 5f74 2069 6e20 7374  or style_t in st
-00017480: 796c 655f 7465 7874 733a 0a20 2020 2020  yle_texts:.     
-00017490: 2020 2020 2020 2073 7479 6c65 203d 2045         style = E
-000174a0: 542e 5375 6245 6c65 6d65 6e74 2868 746d  T.SubElement(htm
-000174b0: 6c5f 6865 6164 2c20 2273 7479 6c65 2229  l_head, "style")
-000174c0: 0a20 2020 2020 2020 2020 2020 2073 7479  .            sty
-000174d0: 6c65 2e74 6578 7420 3d20 7374 796c 655f  le.text = style_
-000174e0: 740a 0a23 2054 4f44 4f0a 2320 6372 6561  t..# TODO.# crea
-000174f0: 7465 5f66 6f6e 745f 6564 6974 6564 5f73  te_font_edited_s
-00017500: 7479 6c65 5f66 726f 6d5f 6373 735f 7374  tyle_from_css_st
-00017510: 796c 655f 6f62 6a65 6374 0a0a 2020 2020  yle_object..    
-00017520: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00017530: 2064 6566 2074 7261 6e73 6665 725f 6865   def transfer_he
-00017540: 6164 5f73 7479 6c65 7328 636c 732c 2068  ad_styles(cls, h
-00017550: 746d 6c5f 656c 656d 2c20 6e65 775f 6874  tml_elem, new_ht
-00017560: 6d6c 293a 0a20 2020 2020 2020 2022 2222  ml):.        """
-00017570: 636f 7069 6573 2068 746d 6c2f 6865 6164  copies html/head
-00017580: 2f22 2222 0a20 2020 2020 2020 206e 6577  /""".        new
-00017590: 5f73 7479 6c65 5f65 6c65 6d20 3d20 4874  _style_elem = Ht
-000175a0: 6d6c 4772 6f75 702e 6372 6561 7465 5f68  mlGroup.create_h
-000175b0: 6561 645f 7374 796c 655f 656c 656d 286e  ead_style_elem(n
-000175c0: 6577 5f68 746d 6c2c 2074 6169 6c3d 225c  ew_html, tail="\
-000175d0: 6e22 290a 2020 2020 2020 2020 7374 796c  n").        styl
-000175e0: 6573 203d 2048 746d 6c53 7479 6c65 2e67  es = HtmlStyle.g
-000175f0: 6574 5f68 6561 645f 7374 796c 6573 2868  et_head_styles(h
-00017600: 746d 6c5f 656c 656d 290a 2020 2020 2020  tml_elem).      
-00017610: 2020 666f 7220 7374 796c 6520 696e 2073    for style in s
-00017620: 7479 6c65 733a 0a20 2020 2020 2020 2020  tyles:.         
-00017630: 2020 206e 6577 5f73 7479 6c65 5f65 6c65     new_style_ele
-00017640: 6d2e 6765 7470 6172 656e 7428 292e 6170  m.getparent().ap
-00017650: 7065 6e64 2863 6f70 792e 6465 6570 636f  pend(copy.deepco
-00017660: 7079 2873 7479 6c65 2929 0a0a 2020 2020  py(style))..    
-00017670: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
-00017680: 2064 6566 2065 7874 7261 6374 5f63 6c61   def extract_cla
-00017690: 7373 7265 665f 616e 645f 6373 7373 7472  ssref_and_cssstr
-000176a0: 696e 675f 6672 6f6d 5f68 746d 6c5f 7374  ing_from_html_st
-000176b0: 796c 6528 636c 732c 2068 746d 6c5f 7374  yle(cls, html_st
-000176c0: 796c 655f 656c 656d 293a 0a20 2020 2020  yle_elem):.     
-000176d0: 2020 2069 6620 6874 6d6c 5f73 7479 6c65     if html_style
-000176e0: 5f65 6c65 6d20 6973 204e 6f6e 653a 0a20  _elem is None:. 
-000176f0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017700: 6e20 4e6f 6e65 2c20 4e6f 6e65 0a20 2020  n None, None.   
-00017710: 2020 2020 2072 6574 7572 6e20 636c 732e       return cls.
-00017720: 6578 7472 6163 745f 636c 6173 7372 6566  extract_classref
-00017730: 5f61 6e64 5f63 7373 7374 7269 6e67 5f66  _and_cssstring_f
-00017740: 726f 6d5f 7374 796c 655f 7465 7874 2868  rom_style_text(h
-00017750: 746d 6c5f 7374 796c 655f 656c 656d 2e74  tml_style_elem.t
-00017760: 6578 7429 0a0a 2020 2020 4063 6c61 7373  ext)..    @class
-00017770: 6d65 7468 6f64 0a20 2020 2064 6566 2063  method.    def c
-00017780: 7265 6174 655f 636c 6173 7372 6566 5f63  reate_classref_c
-00017790: 7373 7374 7269 6e67 5f74 6162 6c65 2863  ssstring_table(c
-000177a0: 6c73 2c20 6874 6d6c 5f73 7479 6c65 7329  ls, html_styles)
-000177b0: 3a0a 2020 2020 2020 2020 7461 626c 6520  :.        table 
-000177c0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-000177d0: 2068 746d 6c5f 7374 796c 6520 696e 2068   html_style in h
-000177e0: 746d 6c5f 7374 796c 6573 3a0a 2020 2020  tml_styles:.    
-000177f0: 2020 2020 2020 2020 7461 626c 652e 6170          table.ap
-00017800: 7065 6e64 2848 746d 6c53 7479 6c65 2e65  pend(HtmlStyle.e
-00017810: 7874 7261 6374 5f63 6c61 7373 7265 665f  xtract_classref_
-00017820: 616e 645f 6373 7373 7472 696e 675f 6672  and_cssstring_fr
-00017830: 6f6d 5f68 746d 6c5f 7374 796c 6528 6874  om_html_style(ht
-00017840: 6d6c 5f73 7479 6c65 2929 0a20 2020 2020  ml_style)).     
-00017850: 2020 2072 6574 7572 6e20 7461 626c 650a     return table.
-00017860: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00017870: 640a 2020 2020 6465 6620 7265 706c 6163  d.    def replac
-00017880: 655f 6375 726c 7928 636c 732c 2065 6c65  e_curly(cls, ele
-00017890: 6d2c 206e 6577 5f63 7572 6c79 293a 0a20  m, new_curly):. 
-000178a0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000178b0: 2020 2072 6570 6c61 6365 2063 6f6e 7465     replace conte
-000178c0: 6e74 7320 6f66 207b 2e2e 2e7d 0a20 2020  nts of {...}.   
-000178d0: 2020 2020 203a 7061 7261 6d20 656c 656d       :param elem
-000178e0: 3a20 6874 6d6c 203c 7374 796c 653e 2065  : html <style> e
-000178f0: 6c65 6d65 6e74 0a20 2020 2020 2020 203a  lement.        :
-00017900: 7061 7261 6d20 656c 656d 3a20 6e65 7720  param elem: new 
-00017910: 636f 6e74 656e 740a 2020 2020 2020 2020  content.        
-00017920: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-00017930: 656c 656d 2069 7320 6e6f 7420 4e6f 6e65  elem is not None
-00017940: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-00017950: 7463 6820 3d20 5354 594c 455f 4355 524c  tch = STYLE_CURL
-00017960: 595f 5245 2e6d 6174 6368 2865 6c65 6d2e  Y_RE.match(elem.
-00017970: 7465 7874 290a 2020 2020 2020 2020 2020  text).          
-00017980: 2020 6966 206d 6174 6368 3a0a 2020 2020    if match:.    
-00017990: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
-000179a0: 7465 7874 203d 206d 6174 6368 2e67 726f  text = match.gro
-000179b0: 7570 2822 7072 6522 2920 2b20 6e65 775f  up("pre") + new_
-000179c0: 6375 726c 7920 2b20 6d61 7463 682e 6772  curly + match.gr
-000179d0: 6f75 7028 2270 6f73 7422 290a 2020 2020  oup("post").    
-000179e0: 2020 2020 2020 2020 2020 2020 656c 656d              elem
-000179f0: 2e74 6578 7420 3d20 6e65 775f 7465 7874  .text = new_text
-00017a00: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00017a10: 6f64 0a20 2020 2064 6566 206c 6f6f 6b75  od.    def looku
-00017a20: 705f 6865 6164 5f73 7479 6c65 5f62 795f  p_head_style_by_
-00017a30: 636c 6173 7372 6566 2863 6c73 2c20 656c  classref(cls, el
-00017a40: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-00017a50: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00017a60: 656c 656d 3a20 656c 656d 656e 7473 2077  elem: elements w
-00017a70: 6974 6820 4063 6c61 7373 2061 7474 7269  ith @class attri
-00017a80: 6275 7465 0a20 2020 2020 2020 203a 7265  bute.        :re
-00017a90: 7475 726e 3a20 4353 5353 7479 6c65 206f  turn: CSSStyle o
-00017aa0: 626a 6563 7420 7769 7468 2048 746d 6c53  bject with HtmlS
-00017ab0: 7479 6c65 0a20 2020 2020 2020 2022 2222  tyle.        """
-00017ac0: 0a20 2020 2020 2020 2063 6c61 7a7a 203d  .        clazz =
-00017ad0: 2065 6c65 6d2e 6765 7428 2263 6c61 7373   elem.get("class
-00017ae0: 2229 0a20 2020 2020 2020 2063 7373 5f73  ").        css_s
-00017af0: 7479 6c65 203d 2048 746d 6c53 7479 6c65  tyle = HtmlStyle
-00017b00: 2e6c 6f6f 6b75 705f 6865 6164 5f73 7479  .lookup_head_sty
-00017b10: 6c65 5f62 795f 636c 6173 7328 656c 656d  le_by_class(elem
-00017b20: 2c20 636c 617a 7a29 0a20 2020 2020 2020  , clazz).       
-00017b30: 2072 6574 7572 6e20 6373 735f 7374 796c   return css_styl
-00017b40: 650a 0a20 2020 2040 636c 6173 736d 6574  e..    @classmet
-00017b50: 686f 640a 2020 2020 6465 6620 6c6f 6f6b  hod.    def look
-00017b60: 7570 5f68 6561 645f 7374 796c 655f 6279  up_head_style_by
-00017b70: 5f63 6c61 7373 2863 6c73 2c20 6874 6d6c  _class(cls, html
-00017b80: 2c20 636c 617a 7a29 3a0a 2020 2020 2020  , clazz):.      
-00017b90: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
-00017ba0: 6172 616d 2068 746d 6c3a 2048 544d 4c20  aram html: HTML 
-00017bb0: 656c 656d 656e 7420 7769 7468 2068 6561  element with hea
-00017bc0: 642f 7374 796c 650a 2020 2020 2020 2020  d/style.        
-00017bd0: 3a70 6172 616d 2063 6c61 7a7a 3a20 636c  :param clazz: cl
-00017be0: 6173 7320 746f 2072 6574 6972 7665 2073  ass to retirve s
-00017bf0: 7479 6c65 2065 6c65 6d65 6e74 0a20 2020  tyle element.   
-00017c00: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00017c10: 2073 7479 6c65 7320 3d20 6874 6d6c 2e78   styles = html.x
-00017c20: 7061 7468 2866 222f 6874 6d6c 2f68 6561  path(f"/html/hea
-00017c30: 642f 7374 796c 655b 636f 6e74 6169 6e73  d/style[contains
-00017c40: 282e 2c27 2e7b 636c 617a 7a7d 2027 295d  (.,'.{clazz} ')]
-00017c50: 2229 0a20 2020 2020 2020 2069 6620 6c65  ").        if le
-00017c60: 6e28 7374 796c 6573 2920 3d3d 2030 3a0a  n(styles) == 0:.
-00017c70: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00017c80: 7428 6622 6e6f 2073 7479 6c65 7320 666f  t(f"no styles fo
-00017c90: 7220 7b63 6c61 7a7a 7d22 290a 2020 2020  r {clazz}").    
-00017ca0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00017cb0: 6f6e 650a 2020 2020 2020 2020 6865 6164  one.        head
-00017cc0: 5f73 7479 6c65 203d 2073 7479 6c65 735b  _style = styles[
-00017cd0: 305d 0a20 2020 2020 2020 205f 2c20 6373  0].        _, cs
-00017ce0: 735f 7374 796c 6520 3d20 4353 5353 7479  s_style = CSSSty
-00017cf0: 6c65 2e63 7265 6174 655f 6373 735f 7374  le.create_css_st
-00017d00: 796c 655f 6672 6f6d 5f68 746d 6c5f 6865  yle_from_html_he
-00017d10: 6164 5f73 7479 6c65 5f65 6c65 6d28 6865  ad_style_elem(he
-00017d20: 6164 5f73 7479 6c65 290a 2020 2020 2020  ad_style).      
-00017d30: 2020 7265 7475 726e 2063 7373 5f73 7479    return css_sty
-00017d40: 6c65 0a0a 2020 2020 4063 6c61 7373 6d65  le..    @classme
-00017d50: 7468 6f64 0a20 2020 2064 6566 2069 735f  thod.    def is_
-00017d60: 626f 6c64 2863 6c73 2c20 656c 656d 293a  bold(cls, elem):
-00017d70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00017d80: 2020 2020 2066 696e 6473 2040 636c 6173       finds @clas
-00017d90: 7320 696e 2065 6c65 6d20 616e 6420 6c6f  s in elem and lo
-00017da0: 6f6b 7320 7570 2073 7479 6c65 2069 6e20  oks up style in 
-00017db0: 6874 6d6c 2f68 6561 640a 2020 2020 2020  html/head.      
-00017dc0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-00017dd0: 2065 6c65 6d20 6973 204e 6f6e 653a 0a20   elem is None:. 
-00017de0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00017df0: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
-00017e00: 6373 735f 7374 796c 6520 3d20 4874 6d6c  css_style = Html
-00017e10: 5374 796c 652e 6c6f 6f6b 7570 5f68 6561  Style.lookup_hea
-00017e20: 645f 7374 796c 655f 6279 5f63 6c61 7373  d_style_by_class
-00017e30: 7265 6628 656c 656d 290a 2020 2020 2020  ref(elem).      
-00017e40: 2020 6966 206e 6f74 2063 7373 5f73 7479    if not css_sty
-00017e50: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-00017e60: 7072 696e 7428 6622 6e6f 2073 7479 6c65  print(f"no style
-00017e70: 2072 6573 6f6c 7665 6420 666f 7220 7b45   resolved for {E
-00017e80: 542e 746f 7374 7269 6e67 2865 6c65 6d29  T.tostring(elem)
-00017e90: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-00017ea0: 7265 7475 726e 2046 616c 7365 0a20 2020  return False.   
-00017eb0: 2020 2020 2072 6574 7572 6e20 6373 735f       return css_
-00017ec0: 7374 796c 652e 6973 5f62 6f6c 640a 0a20  style.is_bold.. 
-00017ed0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00017ee0: 2020 2020 6465 6620 6973 5f69 7461 6c69      def is_itali
-00017ef0: 6328 636c 732c 2065 6c65 6d29 3a0a 2020  c(cls, elem):.  
-00017f00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00017f10: 2020 6669 6e64 7320 4063 6c61 7373 2069    finds @class i
-00017f20: 6e20 656c 656d 2061 6e64 206c 6f6f 6b73  n elem and looks
-00017f30: 2075 7020 7374 796c 6520 696e 2068 746d   up style in htm
-00017f40: 6c2f 6865 6164 0a20 2020 2020 2020 2022  l/head.        "
-00017f50: 2222 0a20 2020 2020 2020 2069 6620 656c  "".        if el
-00017f60: 656d 2069 7320 4e6f 6e65 3a0a 2020 2020  em is None:.    
-00017f70: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00017f80: 616c 7365 0a20 2020 2020 2020 2063 7373  alse.        css
-00017f90: 5f73 7479 6c65 203d 2048 746d 6c53 7479  _style = HtmlSty
-00017fa0: 6c65 2e6c 6f6f 6b75 705f 6865 6164 5f73  le.lookup_head_s
-00017fb0: 7479 6c65 5f62 795f 636c 6173 7372 6566  tyle_by_classref
-00017fc0: 2865 6c65 6d29 0a20 2020 2020 2020 2069  (elem).        i
-00017fd0: 6620 6e6f 7420 6373 735f 7374 796c 653a  f not css_style:
-00017fe0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00017ff0: 6e74 2866 226e 6f20 7374 796c 6520 7265  nt(f"no style re
-00018000: 736f 6c76 6564 2066 6f72 207b 4554 2e74  solved for {ET.t
-00018010: 6f73 7472 696e 6728 656c 656d 297d 2229  ostring(elem)}")
-00018020: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00018030: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
-00018040: 2020 7265 7475 726e 2063 7373 5f73 7479    return css_sty
-00018050: 6c65 2e69 735f 6974 616c 6963 0a0a 2020  le.is_italic..  
-00018060: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00018070: 2020 2064 6566 2067 6574 5f62 6f64 795f     def get_body_
-00018080: 636c 6173 7372 6566 7328 636c 732c 2068  classrefs(cls, h
-00018090: 746d 6c5f 656c 656d 293a 0a20 2020 2020  tml_elem):.     
-000180a0: 2020 2022 2222 7365 6172 6368 6573 2061     """searches a
-000180b0: 6c6c 2062 6f64 7920 656c 656d 656e 7473  ll body elements
-000180c0: 2066 6f72 2040 636c 6173 7320 6174 7472   for @class attr
-000180d0: 6962 7574 6573 0a20 2020 2020 2020 203a  ibutes.        :
-000180e0: 7061 7261 6d20 6874 6d6c 5f65 6c65 6d3a  param html_elem:
-000180f0: 2068 746d 6c20 656c 656d 656e 740a 2020   html element.  
-00018100: 2020 2020 2020 3a72 6574 7572 6e3a 2061        :return: a
-00018110: 6c6c 2062 6f64 7920 656c 656d 656e 7473  ll body elements
-00018120: 2077 6974 6820 4063 6c61 7373 2061 7474   with @class att
-00018130: 7269 6275 7465 730a 2020 2020 2020 2020  ributes.        
-00018140: 2222 220a 2020 2020 2020 2020 626f 6479  """.        body
-00018150: 203d 2048 746d 6c4c 6962 2e67 6574 5f62   = HtmlLib.get_b
-00018160: 6f64 7928 6874 6d6c 5f65 6c65 6d29 0a20  ody(html_elem). 
-00018170: 2020 2020 2020 2072 6574 7572 6e20 5b5d         return []
-00018180: 2069 6620 626f 6479 2069 7320 4e6f 6e65   if body is None
-00018190: 2065 6c73 6520 626f 6479 2e78 7061 7468   else body.xpath
-000181a0: 2822 2e2f 2f2a 5b40 636c 6173 735d 2229  (".//*[@class]")
-000181b0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-000181c0: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
-000181d0: 655f 6162 6272 6576 6961 7465 645f 666f  e_abbreviated_fo
-000181e0: 6e74 5f73 7479 6c65 7328 636c 732c 2068  nt_styles(cls, h
-000181f0: 746d 6c5f 656c 656d 293a 0a20 2020 2020  tml_elem):.     
-00018200: 2020 2022 2222 6372 6561 7465 7320 7265     """creates re
-00018210: 6164 6162 6c65 2073 7479 6c65 6e61 6d65  adable stylename
-00018220: 730a 2020 2020 2020 2020 2e73 3020 7b66  s.        .s0 {f
-00018230: 6f6e 742d 6661 6d69 6c79 3a20 5469 6d65  ont-family: Time
-00018240: 734e 6577 526f 6d61 6e50 534d 543b 2066  sNewRomanPSMT; f
-00018250: 6f6e 742d 7369 7a65 3a20 3132 2e30 3b20  ont-size: 12.0; 
-00018260: 666f 6e74 2d77 6569 6768 743a 2062 6f6c  font-weight: bol
-00018270: 643b 2066 6f6e 742d 6e61 6d65 3a20 5469  d; font-name: Ti
-00018280: 6d65 734e 6577 526f 6d61 6e50 534d 543b  mesNewRomanPSMT;
-00018290: 0a20 2020 2020 2020 2069 7320 7472 616e  .        is tran
-000182a0: 7366 6f72 6d65 6420 746f 0a20 2020 2020  sformed to.     
-000182b0: 2020 202e 7469 6d65 736e 6577 726f 6d61     .timesnewroma
-000182c0: 6e70 736d 745f 3132 7e30 5f62 6f6c 640a  npsmt_12~0_bold.
-000182d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000182e0: 2020 2020 7374 796c 655f 636f 6e76 6572      style_conver
-000182f0: 7465 7220 3d20 636c 732e 6372 6561 7465  ter = cls.create
-00018300: 5f73 7479 6c65 5f63 6f6e 7665 7274 6572  _style_converter
-00018310: 2868 746d 6c5f 656c 656d 290a 2020 2020  (html_elem).    
-00018320: 2020 2020 7374 796c 6564 5f65 6c65 6d73      styled_elems
-00018330: 203d 2068 746d 6c5f 656c 656d 2e78 7061   = html_elem.xpa
-00018340: 7468 2822 2e2f 2f2a 5b40 636c 6173 735d  th(".//*[@class]
-00018350: 2229 0a20 2020 2020 2020 2066 6f72 2065  ").        for e
-00018360: 6c65 6d20 696e 2073 7479 6c65 645f 656c  lem in styled_el
-00018370: 656d 733a 0a20 2020 2020 2020 2020 2020  ems:.           
-00018380: 2063 6c61 7a7a 203d 2065 6c65 6d2e 6174   clazz = elem.at
-00018390: 7472 6962 5b22 636c 6173 7322 5d0a 2020  trib["class"].  
-000183a0: 2020 2020 2020 2020 2020 6e65 775f 636c            new_cl
-000183b0: 6173 7320 3d20 7374 796c 655f 636f 6e76  ass = style_conv
-000183c0: 6572 7465 722e 6765 7428 636c 617a 7a29  erter.get(clazz)
-000183d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000183e0: 6e65 775f 636c 6173 7320 6973 204e 6f6e  new_class is Non
-000183f0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00018400: 2020 2070 7269 6e74 2866 2263 616e 6e6f     print(f"canno
-00018410: 7420 6669 6e64 2072 6570 6c61 6365 2066  t find replace f
-00018420: 6f72 207b 636c 617a 7a7d 2229 0a20 2020  or {clazz}").   
-00018430: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00018440: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00018450: 2020 6874 6d6c 5f63 6c61 7373 203d 2048    html_class = H
-00018460: 746d 6c43 6c61 7373 2863 6c61 7a7a 290a  tmlClass(clazz).
-00018470: 2020 2020 2020 2020 2020 2020 6874 6d6c              html
-00018480: 5f63 6c61 7373 2e72 6570 6c61 6365 5f63  _class.replace_c
-00018490: 6c61 7373 2863 6c61 7a7a 2c20 6e65 775f  lass(clazz, new_
-000184a0: 636c 6173 7329 0a20 2020 2020 2020 2020  class).         
-000184b0: 2020 2065 6c65 6d2e 6174 7472 6962 5b22     elem.attrib["
-000184c0: 636c 6173 7322 5d20 3d20 6e65 775f 636c  class"] = new_cl
-000184d0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-000184e0: 2320 7072 696e 7428 6622 7265 706c 6163  # print(f"replac
-000184f0: 6564 207b 636c 617a 7a7d 2062 7920 7b6e  ed {clazz} by {n
-00018500: 6577 5f63 6c61 7373 7d22 290a 0a20 2020  ew_class}")..   
-00018510: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00018520: 2020 6465 6620 6372 6561 7465 5f73 7479    def create_sty
-00018530: 6c65 5f63 6f6e 7665 7274 6572 2863 6c73  le_converter(cls
-00018540: 2c20 6874 6d6c 5f65 6c65 6d29 3a0a 2020  , html_elem):.  
-00018550: 2020 2020 2020 7374 796c 6573 203d 2048        styles = H
-00018560: 746d 6c53 7479 6c65 2e67 6574 5f68 6561  tmlStyle.get_hea
-00018570: 645f 7374 796c 6573 2868 746d 6c5f 656c  d_styles(html_el
-00018580: 656d 290a 2020 2020 2020 2020 7374 796c  em).        styl
-00018590: 655f 636f 6e76 6572 7465 7220 3d20 6469  e_converter = di
-000185a0: 6374 2829 0a20 2020 2020 2020 2066 6f72  ct().        for
-000185b0: 2073 7479 6c65 2069 6e20 7374 796c 6573   style in styles
-000185c0: 3a0a 2020 2020 2020 2020 2020 2020 646f  :.            do
-000185d0: 745f 7374 796c 652c 2063 7373 203d 2048  t_style, css = H
-000185e0: 746d 6c53 7479 6c65 2e65 7874 7261 6374  tmlStyle.extract
-000185f0: 5f63 6c61 7373 7265 665f 616e 645f 6373  _classref_and_cs
-00018600: 7373 7472 696e 675f 6672 6f6d 5f68 746d  sstring_from_htm
-00018610: 6c5f 7374 796c 6528 7374 796c 6529 0a20  l_style(style). 
-00018620: 2020 2020 2020 2020 2020 2023 2070 7269             # pri
-00018630: 6e74 2866 227b 646f 745f 7374 796c 657d  nt(f"{dot_style}
-00018640: 207b 6373 737d 2229 0a20 2020 2020 2020   {css}").       
-00018650: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
-00018660: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
-00018670: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
-00018680: 6373 735f 7374 7269 6e67 2863 7373 290a  css_string(css).
-00018690: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-000186a0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
-000186b0: 2023 2020 2020 2066 2266 6f6e 743a 207b   #     f"font: {
-000186c0: 6373 735f 7374 796c 652e 666f 6e74 5f66  css_style.font_f
-000186d0: 616d 696c 797d 2073 697a 6520 7b63 7373  amily} size {css
-000186e0: 5f73 7479 6c65 2e66 6f6e 745f 7369 7a65  _style.font_size
-000186f0: 7d20 626f 6c64 207b 6373 735f 7374 796c  } bold {css_styl
-00018700: 652e 6973 5f62 6f6c 647d 2069 7461 6c69  e.is_bold} itali
-00018710: 6320 7b63 7373 5f73 7479 6c65 2e69 735f  c {css_style.is_
-00018720: 6974 616c 6963 7d22 290a 2020 2020 2020  italic}").      
-00018730: 2020 2020 2020 635f 7374 796c 6520 3d20        c_style = 
-00018740: 2222 0a20 2020 2020 2020 2020 2020 2069  "".            i
-00018750: 6620 6373 735f 7374 796c 652e 666f 6e74  f css_style.font
-00018760: 5f66 616d 696c 793a 0a20 2020 2020 2020  _family:.       
-00018770: 2020 2020 2020 2020 2063 5f73 7479 6c65           c_style
-00018780: 202b 3d20 6373 735f 7374 796c 652e 666f   += css_style.fo
-00018790: 6e74 5f66 616d 696c 792e 6c6f 7765 7228  nt_family.lower(
-000187a0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000187b0: 2063 7373 5f73 7479 6c65 2e66 6f6e 745f   css_style.font_
-000187c0: 7369 7a65 3a0a 2020 2020 2020 2020 2020  size:.          
-000187d0: 2020 2020 2020 635f 7374 796c 6520 2b3d        c_style +=
-000187e0: 2022 5f22 202b 2073 7472 2863 7373 5f73   "_" + str(css_s
-000187f0: 7479 6c65 2e66 6f6e 745f 7369 7a65 292e  tyle.font_size).
-00018800: 7265 706c 6163 6528 222e 222c 2022 5f22  replace(".", "_"
-00018810: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00018820: 2063 7373 5f73 7479 6c65 2e69 735f 626f   css_style.is_bo
-00018830: 6c64 3a0a 2020 2020 2020 2020 2020 2020  ld:.            
-00018840: 2020 2020 635f 7374 796c 6520 2b3d 2022      c_style += "
-00018850: 5f22 202b 2022 6222 0a20 2020 2020 2020  _" + "b".       
-00018860: 2020 2020 2069 6620 6373 735f 7374 796c       if css_styl
-00018870: 652e 6973 5f69 7461 6c69 633a 0a20 2020  e.is_italic:.   
-00018880: 2020 2020 2020 2020 2020 2020 2063 5f73               c_s
-00018890: 7479 6c65 202b 3d20 225f 2220 2b20 2269  tyle += "_" + "i
-000188a0: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
-000188b0: 2063 5f73 7479 6c65 2e73 7461 7274 7377   c_style.startsw
-000188c0: 6974 6828 225f 2229 3a0a 2020 2020 2020  ith("_"):.      
-000188d0: 2020 2020 2020 2020 2020 635f 7374 796c            c_styl
-000188e0: 6520 3d20 635f 7374 796c 655b 313a 5d0a  e = c_style[1:].
-000188f0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
-00018900: 696e 7428 6622 635f 7374 796c 6520 7b63  int(f"c_style {c
-00018910: 5f73 7479 6c65 7d22 290a 2020 2020 2020  _style}").      
-00018920: 2020 2020 2020 6966 2063 5f73 7479 6c65        if c_style
-00018930: 2021 3d20 2222 3a0a 2020 2020 2020 2020   != "":.        
-00018940: 2020 2020 2020 2020 7374 796c 655f 636f          style_co
-00018950: 6e76 6572 7465 725b 646f 745f 7374 796c  nverter[dot_styl
-00018960: 655b 313a 5d5d 203d 2063 5f73 7479 6c65  e[1:]] = c_style
-00018970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018980: 2063 6c73 2e73 6574 5f63 6c61 7373 7265   cls.set_classre
-00018990: 665f 616e 645f 6373 7328 7374 796c 652c  f_and_css(style,
-000189a0: 2063 5f73 7479 6c65 2c20 6373 7329 0a0a   c_style, css)..
-000189b0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000189c0: 7479 6c65 5f63 6f6e 7665 7274 6572 0a0a  tyle_converter..
-000189d0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-000189e0: 0a20 2020 2064 6566 2073 6574 5f63 6c61  .    def set_cla
-000189f0: 7373 7265 665f 616e 645f 6373 7328 636c  ssref_and_css(cl
-00018a00: 732c 2073 7479 6c65 5f65 6c65 6d2c 2063  s, style_elem, c
-00018a10: 5f73 7479 6c65 2c20 6373 7329 3a0a 2020  _style, css):.  
-00018a20: 2020 2020 2020 7374 796c 655f 656c 656d        style_elem
-00018a30: 2e61 7474 7269 625b 2263 6c61 7373 7265  .attrib["classre
-00018a40: 6622 5d20 3d20 222e 2220 2b20 635f 7374  f"] = "." + c_st
-00018a50: 796c 650a 2020 2020 2020 2020 7374 796c  yle.        styl
-00018a60: 655f 656c 656d 2e74 6578 7420 3d20 222e  e_elem.text = ".
-00018a70: 2220 2b20 635f 7374 796c 6520 2b20 2220  " + c_style + " 
-00018a80: 7b22 202b 2063 7373 202b 2022 7d22 0a0a  {" + css + "}"..
-00018a90: 0a63 6c61 7373 2048 746d 6c43 6c61 7373  .class HtmlClass
-00018aa0: 3a0a 2020 2020 2222 220a 2020 2020 6d65  :.    """.    me
-00018ab0: 7468 6f64 7320 746f 2070 726f 6365 7373  thods to process
-00018ac0: 2063 6c61 7373 202a 6174 7472 6962 7574   class *attribut
-00018ad0: 6573 2a20 6f6e 2048 544d 4c20 656c 656d  es* on HTML elem
-00018ae0: 6e74 7320 616e 6420 7379 6e63 2077 6974  nts and sync wit
-00018af0: 6820 7374 796c 650a 2020 2020 496e 6974  h style.    Init
-00018b00: 6961 6c6c 7920 6d61 696e 6c79 2040 636c  ially mainly @cl
-00018b10: 6173 736d 6574 686f 6420 6275 7420 6164  assmethod but ad
-00018b20: 6469 6e67 2069 6e73 7461 6d63 6573 2074  ding instamces t
-00018b30: 6f20 6d61 6e61 6765 2065 6469 7469 6e67  o manage editing
-00018b40: 0a20 2020 2074 6865 2040 636c 6173 7320  .    the @class 
-00018b50: 6174 7472 6962 7574 650a 2020 2020 2222  attribute.    ""
-00018b60: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-00018b70: 745f 5f28 7365 6c66 2c20 636c 6173 7373  t__(self, classs
-00018b80: 7472 3d4e 6f6e 6529 3a0a 0a20 2020 2020  tr=None):..     
-00018b90: 2020 2073 656c 662e 636c 6173 7365 7320     self.classes 
-00018ba0: 3d20 7365 7428 290a 2020 2020 2020 2020  = set().        
-00018bb0: 6966 2063 6c61 7373 7374 723a 0a20 2020  if classstr:.   
-00018bc0: 2020 2020 2020 2020 2069 6620 7479 7065           if type
-00018bd0: 2863 6c61 7373 7374 7229 2069 7320 7374  (classstr) is st
-00018be0: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00018bf0: 2020 2073 656c 662e 636c 6173 7365 732e     self.classes.
-00018c00: 7570 6461 7465 2863 6c61 7373 7374 722e  update(classstr.
-00018c10: 7370 6c69 7428 2929 0a20 2020 2020 2020  split()).       
-00018c20: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00018c30: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00018c40: 2056 616c 7565 4572 726f 7228 6622 6361   ValueError(f"ca
-00018c50: 6e20 6f6e 6c79 2063 7265 6174 6520 4874  n only create Ht
-00018c60: 6d6c 436c 6173 7320 6672 6f6d 2073 7472  mlClass from str
-00018c70: 696e 6773 2c20 666f 756e 6420 7b74 7970  ings, found {typ
-00018c80: 6528 636c 6173 7373 7472 297d 203a 207b  e(classstr)} : {
-00018c90: 636c 6173 7373 7472 7d22 290a 0a23 2063  classstr}")..# c
-00018ca0: 6c61 7373 2048 746d 6c43 6c61 7373 3a0a  lass HtmlClass:.
-00018cb0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00018cc0: 640a 2020 2020 6465 6620 6372 6561 7465  d.    def create
-00018cd0: 5f66 726f 6d5f 636c 6173 7365 645f 656c  _from_classed_el
-00018ce0: 656d 656e 7428 636c 732c 2065 6c65 6d29  ement(cls, elem)
-00018cf0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00018d00: 2020 2020 2020 6765 7420 636c 6173 7320        get class 
-00018d10: 7661 6c75 6520 6672 6f6d 2065 6c65 6d65  value from eleme
-00018d20: 6e74 2061 6e64 2063 6372 6561 7465 2048  nt and ccreate H
-00018d30: 746d 6c43 6c61 7373 0a20 2020 2020 2020  tmlClass.       
-00018d40: 203a 7061 7261 6d20 656c 656d 3a20 656c   :param elem: el
-00018d50: 656d 656e 7473 2077 6974 6820 4063 6c61  ements with @cla
-00018d60: 7373 2061 7474 7269 6275 7465 0a20 2020  ss attribute.   
-00018d70: 2020 2020 203a 7265 7475 726e 3a20 4874       :return: Ht
-00018d80: 6d6c 436c 6173 7320 656c 656d 656e 7420  mlClass element 
-00018d90: 6f72 204e 6f6e 650a 2020 2020 2020 2020  or None.        
-00018da0: 2222 220a 2020 2020 2020 2020 636c 617a  """.        claz
-00018db0: 7a20 3d20 4874 6d6c 436c 6173 732e 6765  z = HtmlClass.ge
-00018dc0: 745f 636c 6173 735f 7374 7269 6e67 5f6f  t_class_string_o
-00018dd0: 6e5f 656c 656d 656e 7428 656c 656d 290a  n_element(elem).
-00018de0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00018df0: 6f6e 6520 6966 206e 6f74 2063 6c61 7a7a  one if not clazz
-00018e00: 2065 6c73 6520 4874 6d6c 436c 6173 7328   else HtmlClass(
-00018e10: 636c 617a 7a29 0a0a 2020 2020 2320 636c  clazz)..    # cl
-00018e20: 6173 7320 4874 6d6c 436c 6173 733a 0a0a  ass HtmlClass:..
-00018e30: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-00018e40: 2020 6465 6620 636c 6173 735f 7374 7269    def class_stri
-00018e50: 6e67 2873 656c 6629 3a0a 2020 2020 2020  ng(self):.      
-00018e60: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
-00018e70: 7475 726e 2074 6865 2063 6c61 7373 5f73  turn the class_s
-00018e80: 7472 696e 6720 2863 7265 6174 6573 2066  tring (creates f
-00018e90: 726f 6d20 6c61 7465 7374 2073 656c 662e  rom latest self.
-00018ea0: 636c 6173 7365 7329 0a20 2020 2020 2020  classes).       
-00018eb0: 203a 7265 7475 726e 3a20 7374 7269 6e67   :return: string
-00018ec0: 206f 6620 616c 7068 6162 6574 6963 6361   of alphabeticca
-00018ed0: 6c6c 7920 736f 7274 6564 2073 7065 6365  lly sorted spece
-00018ee0: 2d73 6570 6172 6174 6564 2063 6c61 7373  -separated class
-00018ef0: 6573 0a20 2020 2020 2020 2022 2222 0a20  es.        """. 
-00018f00: 2020 2020 2020 2072 6574 7572 6e20 2222         return ""
-00018f10: 2069 6620 6e6f 7420 7365 6c66 2e63 6c61   if not self.cla
-00018f20: 7373 6573 2065 6c73 6520 2220 222e 6a6f  sses else " ".jo
-00018f30: 696e 2873 6f72 7465 6428 6c69 7374 2873  in(sorted(list(s
-00018f40: 656c 662e 636c 6173 7365 7329 2929 0a0a  elf.classes)))..
-00018f50: 2020 2020 6465 6620 6164 645f 636c 6173      def add_clas
-00018f60: 7328 7365 6c66 2c20 636c 617a 7a29 3a0a  s(self, clazz):.
-00018f70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00018f80: 2020 2020 6164 6420 636c 6173 7320 746f      add class to
-00018f90: 2063 6c61 7373 5f73 7472 696e 670a 2020   class_string.  
-00018fa0: 2020 2020 2020 3a70 6172 616d 2063 6c61        :param cla
-00018fb0: 7a7a 3a20 636c 6173 7320 746f 2061 6464  zz: class to add
-00018fc0: 2028 6d75 7374 2062 6520 6e6f 6e2d 656d   (must be non-em
-00018fd0: 7074 7920 7374 7269 6e67 0a20 2020 2020  pty string.     
-00018fe0: 2020 2069 6620 636c 617a 7a20 6973 0a20     if clazz is. 
-00018ff0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00019000: 2020 2069 6620 636c 617a 7a20 616e 6420     if clazz and 
-00019010: 6c65 6e28 636c 617a 7a2e 7374 7269 7028  len(clazz.strip(
-00019020: 2929 203e 2030 2061 6e64 2063 6c61 7a7a  )) > 0 and clazz
-00019030: 206e 6f74 2069 6e20 7365 6c66 2e63 6c61   not in self.cla
-00019040: 7373 6573 3a0a 2020 2020 2020 2020 2020  sses:.          
-00019050: 2020 7365 6c66 2e63 6c61 7373 6573 2e61    self.classes.a
-00019060: 6464 2863 6c61 7a7a 2e73 7472 6970 2829  dd(clazz.strip()
-00019070: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
-00019080: 746d 6c43 6c61 7373 3a0a 0a20 2020 2064  tmlClass:..    d
-00019090: 6566 2068 6173 5f63 6c61 7373 2873 656c  ef has_class(sel
-000190a0: 662c 2063 6c61 7a7a 293a 0a20 2020 2020  f, clazz):.     
-000190b0: 2020 2022 2222 0a20 2020 2020 2020 2064     """.        d
-000190c0: 6f65 7320 636c 6173 7320 6578 6973 7420  oes class exist 
-000190d0: 696e 2063 6c61 7373 6573 0a20 2020 2020  in classes.     
-000190e0: 2020 203a 7061 7261 6d20 636c 617a 7a3a     :param clazz:
-000190f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00019100: 2020 2020 2072 6574 7572 6e20 636c 617a       return claz
-00019110: 7a20 696e 2073 656c 662e 636c 6173 7365  z in self.classe
-00019120: 730a 0a20 2020 2023 2063 6c61 7373 2048  s..    # class H
-00019130: 746d 6c43 6c61 7373 3a0a 0a20 2020 2064  tmlClass:..    d
-00019140: 6566 2072 6570 6c61 6365 5f63 6c61 7373  ef replace_class
-00019150: 2873 656c 662c 2063 6c61 7a7a 5f6f 6c64  (self, clazz_old
-00019160: 2c20 636c 617a 7a3d 4e6f 6e65 293a 0a20  , clazz=None):. 
-00019170: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00019180: 2020 2072 656d 6f76 6520 636c 617a 7a5f     remove clazz_
-00019190: 6f6c 6420 3b20 6966 2063 6c61 7a7a 2069  old ; if clazz i
-000191a0: 7320 6e6f 7420 4e6f 6e65 2061 6464 2069  s not None add i
-000191b0: 7420 6173 206e 6577 2063 6c61 7373 0a20  t as new class. 
-000191c0: 2020 2020 2020 2028 6966 2063 6c61 7a7a         (if clazz
-000191d0: 2069 7320 616c 7265 6164 7920 7072 6573   is already pres
-000191e0: 656e 742c 206e 6f2d 6f70 290a 2020 2020  ent, no-op).    
-000191f0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00019200: 6966 2063 6c61 7a7a 5f6f 6c64 2069 6e20  if clazz_old in 
-00019210: 7365 6c66 2e63 6c61 7373 6573 3a0a 2020  self.classes:.  
-00019220: 2020 2020 2020 2020 2020 7365 6c66 2e72            self.r
-00019230: 656d 6f76 6528 636c 617a 7a5f 6f6c 6429  emove(clazz_old)
-00019240: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00019250: 636c 617a 7a3a 0a20 2020 2020 2020 2020  clazz:.         
-00019260: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-00019270: 636c 6173 7328 636c 617a 7a29 0a0a 2020  class(clazz)..  
-00019280: 2020 2320 636c 6173 7320 4874 6d6c 436c    # class HtmlCl
-00019290: 6173 733a 0a0a 2020 2020 6465 6620 7265  ass:..    def re
-000192a0: 6d6f 7665 2873 656c 662c 2063 6c61 7a7a  move(self, clazz
-000192b0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-000192c0: 2020 2020 2020 2072 656d 6f76 6520 636c         remove cl
-000192d0: 6173 7320 6672 6f6d 2073 7472 696e 670a  ass from string.
-000192e0: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
-000192f0: 6c61 7a7a 3a20 636c 6173 7320 7374 7269  lazz: class stri
-00019300: 6e67 2074 6f20 7265 6d6f 7665 0a20 2020  ng to remove.   
-00019310: 2020 2020 2069 6620 206e 6f74 2070 7265       if  not pre
-00019320: 7365 6e74 2c20 6e6f 2d6f 700a 2020 2020  sent, no-op.    
-00019330: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00019340: 6966 2063 6c61 7a7a 2069 6e20 7365 6c66  if clazz in self
-00019350: 2e63 6c61 7373 6573 3a0a 2020 2020 2020  .classes:.      
-00019360: 2020 2020 2020 7365 6c66 2e63 6c61 7373        self.class
-00019370: 6573 2e72 656d 6f76 6528 636c 617a 7a29  es.remove(clazz)
-00019380: 0a0a 2020 2020 2320 636c 6173 7320 4874  ..    # class Ht
-00019390: 6d6c 436c 6173 733a 0a0a 2020 2020 4063  mlClass:..    @c
-000193a0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-000193b0: 6566 2067 6574 5f63 6c61 7373 5f73 7472  ef get_class_str
-000193c0: 696e 675f 6f6e 5f65 6c65 6d65 6e74 2863  ing_on_element(c
-000193d0: 6c73 2c20 656c 656d 293a 0a20 2020 2020  ls, elem):.     
-000193e0: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
-000193f0: 6f6e 7665 6e69 656e 6365 206d 6574 686f  onvenience metho
-00019400: 6420 746f 2067 6574 2065 6c65 6d65 6e74  d to get element
-00019410: 2073 7479 6c65 0a20 2020 2020 2020 203a   style.        :
-00019420: 7061 7261 6d20 656c 656d 3a20 746f 2067  param elem: to g
-00019430: 6574 2073 7479 6c65 2066 726f 6d0a 2020  et style from.  
-00019440: 2020 2020 2020 3a72 6574 7572 6e3a 2073        :return: s
-00019450: 7479 6c65 206f 7220 4e6f 6e65 0a20 2020  tyle or None.   
-00019460: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-00019470: 2020 7265 7475 726e 2065 6c65 6d2e 6174    return elem.at
-00019480: 7472 6962 2e67 6574 2822 636c 6173 7322  trib.get("class"
-00019490: 2920 6966 2074 7970 6528 656c 656d 2920  ) if type(elem) 
-000194a0: 6973 205f 456c 656d 656e 7420 656c 7365  is _Element else
-000194b0: 204e 6f6e 650a 0a20 2020 2023 2063 6c61   None..    # cla
-000194c0: 7373 2048 746d 6c43 6c61 7373 3a0a 0a20  ss HtmlClass:.. 
-000194d0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-000194e0: 2020 2020 6465 6620 7365 745f 636c 6173      def set_clas
-000194f0: 735f 6f6e 5f65 6c65 6d65 6e74 2863 6c73  s_on_element(cls
-00019500: 2c20 656c 656d 2c20 7661 6c75 652c 2072  , elem, value, r
-00019510: 6570 6c61 6365 3d54 7275 6529 3a0a 2020  eplace=True):.  
-00019520: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00019530: 2020 636f 6e76 656e 6965 6e63 6520 6d65    convenience me
-00019540: 7468 6f64 2074 6f20 7365 7420 636c 6173  thod to set clas
-00019550: 7320 6f6e 2065 6c65 6d65 6e74 0a20 2020  s on element.   
-00019560: 2020 2020 203a 7061 7261 6d20 656c 656d       :param elem
-00019570: 3a65 6c65 6d65 6e74 2074 6f20 7365 7420  :element to set 
-00019580: 636c 6173 7320 6f6e 0a20 2020 2020 2020  class on.       
-00019590: 203a 7061 7261 6d20 7661 6c75 653a 2068   :param value: h
-000195a0: 746d 6c20 636c 6173 730a 2020 2020 2020  tml class.      
-000195b0: 2020 3a70 6172 616d 2072 6570 6c61 6365    :param replace
-000195c0: 3a69 6620 5472 7565 2072 6570 6c61 6365  :if True replace
-000195d0: 2c20 656c 7365 2061 6464 2074 6f20 6578  , else add to ex
-000195e0: 6973 7469 6e67 2061 7474 7269 6275 7465  isting attribute
-000195f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00019600: 2020 2020 2069 6620 656c 656d 2069 7320       if elem is 
-00019610: 6e6f 7420 4e6f 6e65 2061 6e64 2076 616c  not None and val
-00019620: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
-00019630: 6966 206e 6f74 2072 6570 6c61 6365 3a0a  if not replace:.
-00019640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019650: 6f6c 645f 636c 6173 7320 3d20 4874 6d6c  old_class = Html
-00019660: 436c 6173 732e 6765 745f 636c 6173 735f  Class.get_class_
-00019670: 7374 7269 6e67 5f6f 6e5f 656c 656d 656e  string_on_elemen
-00019680: 7428 656c 656d 290a 2020 2020 2020 2020  t(elem).        
-00019690: 2020 2020 2020 2020 6966 206f 6c64 5f63          if old_c
-000196a0: 6c61 7373 3a0a 2020 2020 2020 2020 2020  lass:.          
-000196b0: 2020 2020 2020 2020 2020 6966 2076 616c            if val
-000196c0: 7565 206e 6f74 2069 6e20 6f6c 645f 636c  ue not in old_cl
-000196d0: 6173 733a 0a20 2020 2020 2020 2020 2020  ass:.           
-000196e0: 2020 2020 2020 2020 2020 2020 206f 6c64               old
-000196f0: 5f63 6c61 7373 202b 3d20 2220 2220 2b20  _class += " " + 
-00019700: 7661 6c75 650a 2020 2020 2020 2020 2020  value.          
-00019710: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00019720: 2020 2020 2020 2020 6f6c 645f 636c 6173          old_clas
-00019730: 7320 3d20 7661 6c75 650a 2020 2020 2020  s = value.      
-00019740: 2020 2020 2020 656c 656d 2e61 7474 7269        elem.attri
-00019750: 625b 2263 6c61 7373 225d 203d 2076 616c  b["class"] = val
-00019760: 7565 0a0a 2020 2020 2320 636c 6173 7320  ue..    # class 
-00019770: 4874 6d6c 436c 6173 733a 0a0a 2020 2020  HtmlClass:..    
-00019780: 6465 6620 6372 6561 7465 5f63 6c61 7373  def create_class
-00019790: 7265 6628 7365 6c66 293a 0a20 2020 2020  ref(self):.     
-000197a0: 2020 2022 2222 0a20 2020 2020 2020 2063     """.        c
-000197b0: 7265 6174 6520 636c 6173 7372 6566 2073  reate classref s
-000197c0: 7472 696e 6720 2870 7265 7065 6e64 2022  tring (prepend "
-000197d0: 2e22 290a 2020 2020 2020 2020 2222 220a  .").        """.
-000197e0: 2020 2020 2020 2020 7265 7475 726e 2022          return "
-000197f0: 2e22 202b 2073 656c 662e 636c 6173 735f  ." + self.class_
-00019800: 7374 7269 6e67 0a0a 2020 2020 2320 636c  string..    # cl
-00019810: 6173 7320 4874 6d6c 436c 6173 733a 0a0a  ass HtmlClass:..
-00019820: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00019830: 0a20 2020 2064 6566 2072 656d 6f76 655f  .    def remove_
-00019840: 646f 7428 7365 6c66 2c20 7374 7269 6e67  dot(self, string
-00019850: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00019860: 2020 2020 2020 2072 656d 6f76 6520 646f         remove do
-00019870: 7420 2822 2e22 2920 2d20 696e 2068 746d  t (".") - in htm
-00019880: 6c2f 6865 6164 2f73 7479 6c65 2065 6c65  l/head/style ele
-00019890: 6d65 6e74 0a20 2020 2020 2020 2022 2222  ment.        """
-000198a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000198b0: 7374 7269 6e67 5b31 3a5d 2069 6620 7374  string[1:] if st
-000198c0: 7269 6e67 2061 6e64 2073 7472 696e 675b  ring and string[
-000198d0: 3a31 5d20 3d3d 2022 2e22 2065 6c73 6520  :1] == "." else 
-000198e0: 7374 7269 6e67 0a0a 0a63 6c61 7373 2048  string...class H
-000198f0: 746d 6c54 7265 653a 0a20 2020 2022 2222  tmlTree:.    """
-00019900: 6275 696c 6473 2061 2074 7265 6520 6672  builds a tree fr
-00019910: 6f6d 2061 2066 6c61 7420 7365 7420 6f66  om a flat set of
-00019920: 2048 746d 6c20 656c 656d 6e65 7473 2222   Html elemnets""
-00019930: 220a 0a20 2020 2023 2066 6f72 2074 6865  "..    # for the
-00019940: 2073 6563 7469 6f6e 5f72 6563 730a 2020   section_recs.  
-00019950: 2020 4348 4150 5f54 4f50 203d 2022 4348    CHAP_TOP = "CH
-00019960: 4150 5f54 4f50 220a 2020 2020 4348 4150  AP_TOP".    CHAP
-00019970: 5f53 4543 5449 4f4e 5320 3d20 2243 4841  _SECTIONS = "CHA
-00019980: 505f 5345 4354 494f 4e53 220a 2020 2020  P_SECTIONS".    
-00019990: 4348 4150 5f53 5542 5345 4354 5320 3d20  CHAP_SUBSECTS = 
-000199a0: 2243 4841 505f 5355 4253 4543 5453 220a  "CHAP_SUBSECTS".
-000199b0: 0a20 2020 2023 2043 6861 7074 6572 0a20  .    # Chapter. 
-000199c0: 2020 2054 5245 455f 524f 4f54 203d 2022     TREE_ROOT = "
-000199d0: 7472 6565 5f72 6f6f 7422 0a20 2020 2043  tree_root".    C
-000199e0: 4c41 5353 203d 2022 636c 6173 7322 0a20  LASS = "class". 
-000199f0: 2020 2050 5245 5f43 4841 5053 4543 203d     PRE_CHAPSEC =
-00019a00: 2022 7072 655f 6368 6170 7365 6322 0a0a   "pre_chapsec"..
-00019a10: 2020 2020 2320 7365 6374 696f 6e73 0a20      # sections. 
-00019a20: 2020 2043 4841 5053 4543 203d 2022 6368     CHAPSEC = "ch
-00019a30: 6170 7365 6322 0a20 2020 2054 4f50 5f44  apsec".    TOP_D
-00019a40: 4956 203d 2022 746f 705f 6469 7622 0a0a  IV = "top_div"..
-00019a50: 2020 2020 2320 5850 6174 6873 0a20 2020      # XPaths.   
-00019a60: 2041 4c4c 5f44 4956 5f58 5041 5448 5320   ALL_DIV_XPATHS 
-00019a70: 3d20 222e 2f2f 6469 7622 0a0a 2320 636c  = ".//div"..# cl
-00019a80: 6173 7320 4874 6d6c 5472 6565 0a0a 2020  ass HtmlTree..  
-00019a90: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00019aa0: 2020 2064 6566 206d 616b 655f 7365 6374     def make_sect
-00019ab0: 696f 6e73 5f61 6e64 5f6f 7574 7075 7428  ions_and_output(
-00019ac0: 636c 732c 2065 6c65 6d2c 206f 7574 7075  cls, elem, outpu
-00019ad0: 745f 6469 722c 2072 6563 735f 6279 5f73  t_dir, recs_by_s
-00019ae0: 6563 7469 6f6e 3d4e 6f6e 6529 3a0a 2020  ection=None):.  
-00019af0: 2020 2020 2020 2222 2266 696e 6420 6465        """find de
-00019b00: 6369 6d61 6c20 6e75 6d62 6572 2066 6f72  cimal number for
-00019b10: 2074 7265 650a 2020 2020 2020 2020 5468   tree.        Th
-00019b20: 6953 2069 7320 4845 4156 494c 5920 6261  iS is HEAVILY ba
-00019b30: 7365 6420 6f6e 2049 5043 430a 2020 2020  sed on IPCC.    
-00019b40: 2020 2020 6375 7272 656e 746c 7920 6361      currently ca
-00019b50: 6c6c 6564 2069 6e20 7469 6479 5f66 6c6f  lled in tidy_flo
-00019b60: 7728 290a 2020 2020 2020 2020 2222 220a  w().        """.
-00019b70: 2020 2020 2020 2020 6d61 726b 6572 7320          markers 
-00019b80: 3d20 5b22 4368 6170 7465 7222 2c0a 2020  = ["Chapter",.  
-00019b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ba0: 2023 2022 5461 626c 6520 6f66 2043 6f6e   # "Table of Con
-00019bb0: 7465 6e74 7322 2c0a 2020 2020 2020 2020  tents",.        
-00019bc0: 2020 2020 2020 2020 2020 2022 5461 626c             "Tabl
-00019bd0: 6520 6f66 222c 2020 2320 6f6e 6520 6973  e of",  # one is
-00019be0: 2063 6f6e 6361 7465 6e61 7465 6420 2843   concatenated (C
-00019bf0: 6861 7074 6572 3031 2920 736f 2061 6262  hapter01) so abb
-00019c00: 7265 7669 6174 652c 2075 6e77 6569 6768  reviate, unweigh
-00019c10: 7465 6420 4368 6170 3136 0a20 2020 2020  ted Chap16.     
-00019c20: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00019c30: 2245 7865 6375 7469 7665 2053 756d 6d61  "Executive Summa
-00019c40: 7279 222c 0a20 2020 2020 2020 2020 2020  ry",.           
-00019c50: 2020 2020 2020 2020 2245 7865 6375 7469          "Executi
-00019c60: 7665 222c 2020 2320 6361 7365 2076 6172  ve",  # case var
-00019c70: 6961 7469 6f6e 0a20 2020 2020 2020 2020  iation.         
-00019c80: 2020 2020 2020 2020 2020 2320 2246 7265            # "Fre
-00019c90: 7175 656e 746c 7920 4173 6b65 6420 5175  quently Asked Qu
-00019ca0: 6573 7469 6f6e 7322 2c20 2320 6e6f 7420  estions", # not 
-00019cb0: 696e 2043 6861 7074 6572 3031 0a20 2020  in Chapter01.   
-00019cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019cd0: 2246 7265 7175 656e 746c 7922 2c20 2023  "Frequently",  #
-00019ce0: 2063 6173 6520 7661 7269 6174 696f 6e0a   case variation.
-00019cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019d00: 2020 2022 5265 6665 7265 6e63 6573 222c     "References",
-00019d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019d20: 2020 2020 5d0a 2020 2020 2020 2020 6973      ].        is
-00019d30: 5f62 6f6c 6420 3d20 5472 7565 0a20 2020  _bold = True.   
-00019d40: 2020 2020 2066 6f6e 745f 7369 7a65 5f72       font_size_r
-00019d50: 616e 6765 203d 2028 3132 2c20 3939 3929  ange = (12, 999)
-00019d60: 0a20 2020 2020 2020 2066 6f72 206d 6172  .        for mar
-00019d70: 6b65 7220 696e 206d 6172 6b65 7273 3a0a  ker in markers:.
-00019d80: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
-00019d90: 6564 5f64 6976 2c20 6469 7673 203d 2063  ed_div, divs = c
-00019da0: 6c73 2e67 6574 5f64 6976 5f73 7061 6e5f  ls.get_div_span_
-00019db0: 7374 6172 7469 6e67 5f77 6974 6828 656c  starting_with(el
-00019dc0: 656d 2c20 6d61 726b 6572 2c20 6973 5f62  em, marker, is_b
-00019dd0: 6f6c 642c 2066 6f6e 745f 7369 7a65 5f72  old, font_size_r
-00019de0: 616e 6765 3d66 6f6e 745f 7369 7a65 5f72  ange=font_size_r
-00019df0: 616e 6765 290a 2020 2020 2020 2020 2020  ange).          
-00019e00: 2020 6966 206d 6172 6b65 645f 6469 7620    if marked_div 
-00019e10: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00019e20: 2020 2020 2020 2020 2020 2020 206c 6420               ld 
-00019e30: 3d20 6c65 6e28 6469 7673 2920 6966 2064  = len(divs) if d
-00019e40: 6976 7320 656c 7365 2030 0a20 2020 2020  ivs else 0.     
-00019e50: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
-00019e60: 6e67 2e77 6172 6e69 6e67 2866 2243 616e  ng.warning(f"Can
-00019e70: 6e6f 7420 6669 6e64 206d 6172 6b65 7220  not find marker 
-00019e80: 5b7b 6d61 726b 6572 7d5d 2066 6f75 6e64  [{marker}] found
-00019e90: 207b 6c64 7d20 6d61 726b 6572 7322 290a   {ld} markers").
-00019ea0: 0a20 2020 2020 2020 2063 6c61 7373 5f64  .        class_d
-00019eb0: 6963 7420 3d20 7b63 6c73 2e43 4841 5053  ict = {cls.CHAPS
-00019ec0: 4543 3a20 636c 732e 5052 455f 4348 4150  EC: cls.PRE_CHAP
-00019ed0: 5345 432c 0a20 2020 2020 2020 2020 2020  SEC,.           
-00019ee0: 2020 2020 2020 2020 2020 2063 6c73 2e54             cls.T
-00019ef0: 4f50 5f44 4956 3a20 636c 732e 5452 4545  OP_DIV: cls.TREE
-00019f00: 5f52 4f4f 542c 207d 0a20 2020 2020 2020  _ROOT, }.       
-00019f10: 2072 6563 203d 2072 6563 735f 6279 5f73   rec = recs_by_s
-00019f20: 6563 7469 6f6e 2e67 6574 2863 6c73 2e43  ection.get(cls.C
-00019f30: 4841 505f 544f 5029 0a20 2020 2020 2020  HAP_TOP).       
-00019f40: 2061 7373 6572 7420 7265 6320 6973 206e   assert rec is n
-00019f50: 6f74 204e 6f6e 652c 2066 2277 616e 7465  ot None, f"wante
-00019f60: 6420 6e6f 6e2d 4e6f 6e65 207b 636c 732e  d non-None {cls.
-00019f70: 4348 4150 5f54 4f50 7d20 7265 6322 0a20  CHAP_TOP} rec". 
-00019f80: 2020 2020 2020 2064 6563 696d 616c 5f64         decimal_d
-00019f90: 6976 7320 3d20 636c 732e 6765 745f 6469  ivs = cls.get_di
-00019fa0: 765f 7370 616e 735f 7769 7468 5f64 6563  v_spans_with_dec
-00019fb0: 696d 616c 7328 656c 656d 2c0a 2020 2020  imals(elem,.    
-00019fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012cf0: 2020 2020 2020 2020 2020 2020 6164 645f              add_
+00012d00: 7469 746c 653d 227c 222c 2073 7479 6c65  title="|", style
+00012d10: 3d22 7b63 6f6c 6f72 203a 2070 7572 706c  ="{color : purpl
+00012d20: 657d 2229 290a 2020 2020 2020 2020 616e  e}")).        an
+00012d30: 6e6f 7461 746f 722e 6164 645f 636f 6d6d  notator.add_comm
+00012d40: 616e 6428 0a20 2020 2020 2020 2020 2020  and(.           
+00012d50: 2041 6e6e 6f74 6174 6f72 436f 6d6d 616e   AnnotatorComman
+00012d60: 6428 6874 6d6c 5f63 6c61 7373 3d22 6661  d(html_class="fa
+00012d70: 6374 222c 2078 7061 7468 3d22 7365 6c66  ct", xpath="self
+00012d80: 3a3a 7370 616e 5b63 6f6e 7461 696e 7328  ::span[contains(
+00012d90: 4063 6c61 7373 2c20 2763 6f6e 6669 6465  @class, 'confide
+00012da0: 6e63 6527 295d 2f70 7265 6365 6469 6e67  nce')]/preceding
+00012db0: 2d73 6962 6c69 6e67 3a3a 7370 616e 5b31  -sibling::span[1
+00012dc0: 5d22 2c0a 2020 2020 2020 2020 2020 2020  ]",.            
+00012dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012de0: 2020 7374 796c 653d 227b 636f 6c6f 7220    style="{color 
+00012df0: 3a20 7075 7270 6c65 7d22 2929 0a20 2020  : purple}")).   
+00012e00: 2020 2020 2061 6e6e 6f74 6174 6f72 2e61       annotator.a
+00012e10: 6464 5f63 6f6d 6d61 6e64 280a 2020 2020  dd_command(.    
+00012e20: 2020 2020 2020 2020 416e 6e6f 7461 746f          Annotato
+00012e30: 7243 6f6d 6d61 6e64 2868 746d 6c5f 636c  rCommand(html_cl
+00012e40: 6173 733d 2267 726f 7570 222c 2067 726f  ass="group", gro
+00012e50: 7570 5f78 7061 7468 3d22 6469 765b 7370  up_xpath="div[sp
+00012e60: 616e 5b63 6f6e 7461 696e 7328 4063 6c61  an[contains(@cla
+00012e70: 7373 2c20 2773 7461 7274 2729 5d5d 222c  ss, 'start')]]",
+00012e80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012e90: 2020 2020 2020 2020 2020 2020 2020 656e                en
+00012ea0: 645f 7870 6174 683d 2273 656c 663a 3a64  d_xpath="self::d
+00012eb0: 6976 5b73 7061 6e5b 636f 6e74 6169 6e73  iv[span[contains
+00012ec0: 2874 6578 7428 292c 2745 4e44 2729 5d5d  (text(),'END')]]
+00012ed0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+00012ee0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00012ef0: 6573 633d 223f 6578 7472 6163 7473 2067  esc="?extracts g
+00012f00: 726f 7570 7320 616e 6420 6d6d 6f76 6573  roups and mmoves
+00012f10: 2074 6f20 656e 6422 2929 0a20 2020 2020   to end")).     
+00012f20: 2020 2061 6e6e 6f74 6174 6f72 2e61 6464     annotator.add
+00012f30: 5f63 6f6d 6d61 6e64 280a 2020 2020 2020  _command(.      
+00012f40: 2020 2020 2020 416e 6e6f 7461 746f 7243        AnnotatorC
+00012f50: 6f6d 6d61 6e64 2868 746d 6c5f 636c 6173  ommand(html_clas
+00012f60: 733d 2273 7562 7375 6273 6563 7469 6f6e  s="subsubsection
+00012f70: 222c 2067 726f 7570 5f78 7061 7468 3d22  ", group_xpath="
+00012f80: 6469 765b 7370 616e 5b63 6f6e 7461 696e  div[span[contain
+00012f90: 7328 4063 6c61 7373 2c20 2773 7562 7375  s(@class, 'subsu
+00012fa0: 6273 6563 7469 6f6e 5f74 6974 6c65 2729  bsection_title')
+00012fb0: 5d5d 222c 0a20 2020 2020 2020 2020 2020  ]]",.           
+00012fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012fd0: 2020 656e 645f 7870 6174 683d 2273 656c    end_xpath="sel
+00012fe0: 663a 3a64 6976 5b73 7061 6e5b 636f 6e74  f::div[span[cont
+00012ff0: 6169 6e73 2874 6578 7428 292c 2773 6563  ains(text(),'sec
+00013000: 7469 6f6e 5f74 6974 6c65 2729 5d5d 2229  tion_title')]]")
+00013010: 290a 2020 2020 2020 2020 616e 6e6f 7461  ).        annota
+00013020: 746f 722e 6164 645f 636f 6d6d 616e 6428  tor.add_command(
+00013030: 0a20 2020 2020 2020 2020 2020 2041 6e6e  .            Ann
+00013040: 6f74 6174 6f72 436f 6d6d 616e 6428 6874  otatorCommand(ht
+00013050: 6d6c 5f63 6c61 7373 3d22 666f 6f74 6e6f  ml_class="footno
+00013060: 7465 222c 2078 7061 7468 3d22 2f2f 6469  te", xpath="//di
+00013070: 765b 7370 616e 5b63 6f6e 7461 696e 7328  v[span[contains(
+00013080: 4073 7479 6c65 2c20 2766 6f6e 742d 7369  @style, 'font-si
+00013090: 7a65 3a20 362e 3027 2920 616e 6420 6e75  ze: 6.0') and nu
+000130a0: 6d62 6572 282e 293d 6e75 6d62 6572 282e  mber(.)=number(.
+000130b0: 295d 5d22 2c0a 2020 2020 2020 2020 2020  )]]",.          
+000130c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000130d0: 2020 2064 6573 633d 2268 6f72 7269 626c     desc="horribl
+000130e0: 6520 6861 636b 2074 6573 7469 6e67 2066  e hack testing f
+000130f0: 6f6e 742d 7369 7a65 2229 290a 0a0a 2020  ont-size"))...  
+00013100: 2020 2020 2020 7265 7475 726e 2061 6e6e        return ann
+00013110: 6f74 6174 6f72 0a0a 0a41 4e4e 5f53 504c  otator...ANN_SPL
+00013120: 4954 203d 2022 7c22 0a4c 454e 5f54 4954  IT = "|".LEN_TIT
+00013130: 4c45 203d 2035 300a 636c 6173 7320 416e  LE = 50.class An
+00013140: 6e6f 7461 746f 7243 6f6d 6d61 6e64 3a0a  notatorCommand:.
+00013150: 2020 2020 2222 2261 6e20 616e 6e6f 7461      """an annota
+00013160: 7469 6f6e 2063 6f6d 6d61 6e64 0a20 2020  tion command.   
+00013170: 2065 2e67 2e0a 2020 2020 636f 6d6d 616e   e.g..    comman
+00013180: 6420 3d20 416e 6e6f 7461 746f 7243 6f6d  d = AnnotatorCom
+00013190: 6d61 6e64 2868 746d 6c5f 636c 6173 733d  mand(html_class=
+000131a0: 2273 6563 7469 6f6e 5f74 6974 6c65 222c  "section_title",
+000131b0: 2072 6567 6578 3d22 5365 6374 696f 6e5c   regex="Section\
+000131c0: 5c73 2b28 3f50 3c69 643e 5c5c 642b 293a  \s+(?P<id>\\d+):
+000131d0: 5c5c 732b 283f 503c 7469 746c 653e 2e2a  \\s+(?P<title>.*
+000131e0: 2922 2c20 6164 645f 6964 3d54 7275 652c  )", add_id=True,
+000131f0: 2061 6464 5f74 6974 6c65 3d54 7275 6529   add_title=True)
+00013200: 0a20 2020 2061 6e6e 6f74 6174 6f72 2e61  .    annotator.a
+00013210: 6464 5f63 6f6d 6d61 6e64 2863 6f6d 6d61  dd_command(comma
+00013220: 6e64 290a 2020 2020 616e 6e6f 7461 746f  nd).    annotato
+00013230: 722e 7275 6e5f 636f 6d6d 616e 6473 0a0a  r.run_commands..
+00013240: 2020 2020 2222 220a 0a20 2020 2064 6566      """..    def
+00013250: 205f 5f69 6e69 745f 5f28 7365 6c66 2c20   __init__(self, 
+00013260: 6874 6d6c 5f63 6c61 7373 3d4e 6f6e 652c  html_class=None,
+00013270: 2072 6567 6578 3d4e 6f6e 652c 2061 6464   regex=None, add
+00013280: 5f69 643d 4e6f 6e65 2c20 6164 645f 7469  _id=None, add_ti
+00013290: 746c 653d 4e6f 6e65 2c20 7363 7269 7074  tle=None, script
+000132a0: 3d4e 6f6e 652c 2073 7479 6c65 3d4e 6f6e  =None, style=Non
+000132b0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+000132c0: 2020 2020 6465 6c65 7465 3d46 616c 7365      delete=False
+000132d0: 2c20 7870 6174 683d 4e6f 6e65 2c20 6772  , xpath=None, gr
+000132e0: 6f75 705f 7870 6174 683d 4e6f 6e65 2c20  oup_xpath=None, 
+000132f0: 656e 645f 7870 6174 683d 4e6f 6e65 2c20  end_xpath=None, 
+00013300: 6465 7363 3d4e 6f6e 6529 3a0a 2020 2020  desc=None):.    
+00013310: 2020 2020 7365 6c66 2e68 746d 6c5f 636c      self.html_cl
+00013320: 6173 7320 3d20 6874 6d6c 5f63 6c61 7373  ass = html_class
+00013330: 0a20 2020 2020 2020 2073 656c 662e 7265  .        self.re
+00013340: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+00013350: 6966 2072 6567 6578 3a0a 2020 2020 2020  if regex:.      
+00013360: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00013370: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00013380: 7265 203d 2072 652e 636f 6d70 696c 6528  re = re.compile(
+00013390: 7265 6765 7829 0a20 2020 2020 2020 2020  regex).         
+000133a0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+000133b0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+000133c0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000133d0: 5661 6c75 6545 7272 6f72 2866 2243 616e  ValueError(f"Can
+000133e0: 6e6f 7420 636f 6d70 696c 6520 7265 6765  not compile rege
+000133f0: 7820 7b72 6567 6578 7d20 6265 6361 7573  x {regex} becaus
+00013400: 6520 7b65 7d22 290a 0a20 2020 2020 2020  e {e}")..       
+00013410: 2023 2061 6464 5f69 6420 616e 6420 6164   # add_id and ad
+00013420: 645f 7469 746c 6520 6172 6520 6f66 2066  d_title are of f
+00013430: 6f72 6d20 666f 6f7c 6261 7220 7768 6572  orm foo|bar wher
+00013440: 6520 6578 7472 6163 7465 6420 6964 2072  e extracted id r
+00013450: 6570 6c61 6365 7320 7c0a 2020 2020 2020  eplaces |.      
+00013460: 2020 6966 2061 6464 5f69 643a 0a20 2020    if add_id:.   
+00013470: 2020 2020 2020 2020 2061 6464 5f69 6420           add_id 
+00013480: 3d20 6164 645f 6964 2e73 706c 6974 2841  = add_id.split(A
+00013490: 4e4e 5f53 504c 4954 290a 2020 2020 2020  NN_SPLIT).      
+000134a0: 2020 7365 6c66 2e61 6464 5f69 6420 3d20    self.add_id = 
+000134b0: 4e6f 6e65 2069 6620 6e6f 7420 6164 645f  None if not add_
+000134c0: 6964 206f 7220 6c65 6e28 6164 645f 6964  id or len(add_id
+000134d0: 2920 213d 2032 2065 6c73 6520 6164 645f  ) != 2 else add_
+000134e0: 6964 0a20 2020 2020 2020 2069 6620 6164  id.        if ad
+000134f0: 645f 7469 746c 653a 0a20 2020 2020 2020  d_title:.       
+00013500: 2020 2020 2061 6464 5f74 6974 6c65 203d       add_title =
+00013510: 2061 6464 5f74 6974 6c65 2e73 706c 6974   add_title.split
+00013520: 2841 4e4e 5f53 504c 4954 290a 2020 2020  (ANN_SPLIT).    
+00013530: 2020 2020 7365 6c66 2e61 6464 5f74 6974      self.add_tit
+00013540: 6c65 3d20 4e6f 6e65 2069 6620 6e6f 7420  le= None if not 
+00013550: 6164 645f 7469 746c 6520 6f72 206c 656e  add_title or len
+00013560: 2861 6464 5f74 6974 6c65 2920 213d 2032  (add_title) != 2
+00013570: 2065 6c73 6520 6164 645f 7469 746c 650a   else add_title.
+00013580: 0a20 2020 2020 2020 2073 656c 662e 6874  .        self.ht
+00013590: 6d6c 5f63 6c61 7373 203d 2068 746d 6c5f  ml_class = html_
+000135a0: 636c 6173 730a 2020 2020 2020 2020 7365  class.        se
+000135b0: 6c66 2e73 6372 6970 7420 3d20 7363 7269  lf.script = scri
+000135c0: 7074 0a20 2020 2020 2020 2073 656c 662e  pt.        self.
+000135d0: 7374 796c 6520 3d20 7374 796c 650a 2020  style = style.  
+000135e0: 2020 2020 2020 7365 6c66 2e64 656c 6574        self.delet
+000135f0: 6520 3d20 6465 6c65 7465 0a20 2020 2020  e = delete.     
+00013600: 2020 2073 656c 662e 7870 6174 6820 3d20     self.xpath = 
+00013610: 7870 6174 680a 2020 2020 2020 2020 7365  xpath.        se
+00013620: 6c66 2e67 726f 7570 5f78 7061 7468 203d  lf.group_xpath =
+00013630: 2067 726f 7570 5f78 7061 7468 0a20 2020   group_xpath.   
+00013640: 2020 2020 2073 656c 662e 656e 645f 7870       self.end_xp
+00013650: 6174 6820 3d20 656e 645f 7870 6174 680a  ath = end_xpath.
+00013660: 2020 2020 2020 2020 7365 6c66 2e64 6573          self.des
+00013670: 6320 3d20 6465 7363 0a0a 2320 636c 6173  c = desc..# clas
+00013680: 7320 416e 6e6f 7461 746f 7243 6f6d 6d61  s AnnotatorComma
+00013690: 6e64 0a0a 2020 2020 6465 6620 7275 6e5f  nd..    def run_
+000136a0: 636f 6d6d 616e 6428 7365 6c66 2c20 656c  command(self, el
+000136b0: 656d 293a 0a20 2020 2020 2020 2023 2070  em):.        # p
+000136c0: 7269 6e74 2866 2272 756e 5f63 6f6d 6d61  rint(f"run_comma
+000136d0: 6e64 202c 2074 6167 2c20 7b65 6c65 6d2e  nd , tag, {elem.
+000136e0: 7461 677d 2070 6172 656e 743a 207b 656c  tag} parent: {el
+000136f0: 656d 2e67 6574 7061 7265 6e74 2829 7d22  em.getparent()}"
+00013700: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
+00013710: 662e 7265 3a0a 2020 2020 2020 2020 2020  f.re:.          
+00013720: 2020 7365 6c66 2e72 756e 5f72 6567 6578    self.run_regex
+00013730: 2865 6c65 6d29 0a20 2020 2020 2020 2023  (elem).        #
+00013740: 2065 6c69 6620 7365 6c66 2e65 7874 7261   elif self.extra
+00013750: 6374 3a0a 2020 2020 2020 2020 2320 2020  ct:.        #   
+00013760: 2020 7365 6c66 2e72 756e 5f65 7874 7261    self.run_extra
+00013770: 6374 2865 6c65 6d29 0a20 2020 2020 2020  ct(elem).       
+00013780: 2065 6c69 6620 7365 6c66 2e78 7061 7468   elif self.xpath
+00013790: 203a 0a20 2020 2020 2020 2020 2020 2073   :.            s
+000137a0: 656c 662e 7275 6e5f 7870 6174 6828 656c  elf.run_xpath(el
+000137b0: 656d 290a 2020 2020 2020 2020 656c 6966  em).        elif
+000137c0: 2073 656c 662e 7363 7269 7074 203d 3d20   self.script == 
+000137d0: 2273 7562 223a 0a20 2020 2020 2020 2020  "sub":.         
+000137e0: 2020 2073 656c 662e 7275 6e5f 7375 6273     self.run_subs
+000137f0: 6372 6970 7428 656c 656d 290a 2020 2020  cript(elem).    
+00013800: 2020 2020 656c 6966 2073 656c 662e 7363      elif self.sc
+00013810: 7269 7074 203d 3d20 2273 7570 6572 223a  ript == "super":
+00013820: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00013830: 662e 7275 6e5f 7375 7065 7273 6372 6970  f.run_superscrip
+00013840: 7428 656c 656d 290a 2020 2020 2020 2020  t(elem).        
+00013850: 656c 6966 2073 656c 662e 6772 6f75 705f  elif self.group_
+00013860: 7870 6174 6820 6973 206e 6f74 204e 6f6e  xpath is not Non
+00013870: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00013880: 656c 662e 7275 6e5f 6772 6f75 705f 7870  elf.run_group_xp
+00013890: 6174 6828 656c 656d 290a 0a20 2020 2023  ath(elem)..    #
+000138a0: 2063 6c61 7373 2041 6e6e 6f74 6174 6f72   class Annotator
+000138b0: 436f 6d6d 616e 640a 0a20 2020 2064 6566  Command..    def
+000138c0: 2072 756e 5f72 6567 6578 2873 656c 662c   run_regex(self,
+000138d0: 2065 6c65 6d29 3a0a 2020 2020 2020 2020   elem):.        
+000138e0: 7465 7874 203d 2065 6c65 6d2e 7465 7874  text = elem.text
+000138f0: 0a20 2020 2020 2020 2069 6620 7465 7874  .        if text
+00013900: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00013910: 2020 2020 2020 7072 696e 7428 6622 7265        print(f"re
+00013920: 6765 783a 204e 6f6e 6520 7465 7874 2069  gex: None text i
+00013930: 6e20 7b65 6c65 6d7d 207b 656c 656d 2e74  n {elem} {elem.t
+00013940: 6167 7d22 290a 2020 2020 2020 2020 2020  ag}").          
+00013950: 2020 7265 7475 726e 0a20 2020 2020 2020    return.       
+00013960: 206d 6174 6368 203d 204e 6f6e 650a 2020   match = None.  
+00013970: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00013980: 2020 2020 2020 206d 6174 6368 203d 2073         match = s
+00013990: 656c 662e 7265 2e6d 6174 6368 2874 6578  elf.re.match(tex
+000139a0: 7429 0a20 2020 2020 2020 2065 7863 6570  t).        excep
+000139b0: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+000139c0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+000139d0: 696e 7428 6622 6d61 7463 6820 6661 696c  int(f"match fail
+000139e0: 207b 657d 2229 0a20 2020 2020 2020 2020   {e}").         
+000139f0: 2020 2072 6574 7572 6e0a 2020 2020 2020     return.      
+00013a00: 2020 6966 206d 6174 6368 3a0a 2020 2020    if match:.    
+00013a10: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00013a20: 6465 6c65 7465 3a0a 2020 2020 2020 2020  delete:.        
+00013a30: 2020 2020 2020 2020 7365 6c66 2e72 656d          self.rem
+00013a40: 6f76 655f 656c 656d 2865 6c65 6d29 0a20  ove_elem(elem). 
+00013a50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00013a60: 6574 7572 6e0a 2020 2020 2020 2020 2020  eturn.          
+00013a70: 2020 6966 2073 656c 662e 6164 645f 6964    if self.add_id
+00013a80: 2061 6e64 2022 6964 2220 696e 206d 6174   and "id" in mat
+00013a90: 6368 2e67 726f 7570 6469 6374 2829 3a0a  ch.groupdict():.
+00013aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013ab0: 656c 656d 2e61 7474 7269 625b 2269 6422  elem.attrib["id"
+00013ac0: 5d20 3d20 7365 6c66 2e61 6464 5f69 645b  ] = self.add_id[
+00013ad0: 305d 202b 206d 6174 6368 2e67 726f 7570  0] + match.group
+00013ae0: 2822 6964 2229 202b 2073 656c 662e 6164  ("id") + self.ad
+00013af0: 645f 6964 5b31 5d0a 2020 2020 2020 2020  d_id[1].        
+00013b00: 2020 2020 6966 2073 656c 662e 6164 645f      if self.add_
+00013b10: 7469 746c 6520 616e 6420 2274 6974 6c65  title and "title
+00013b20: 2220 696e 206d 6174 6368 2e67 726f 7570  " in match.group
+00013b30: 6469 6374 2829 3a0a 2020 2020 2020 2020  dict():.        
+00013b40: 2020 2020 2020 2020 656c 656d 2e61 7474          elem.att
+00013b50: 7269 625b 2274 6974 6c65 225d 203d 2073  rib["title"] = s
+00013b60: 656c 662e 6164 645f 7469 746c 655b 305d  elf.add_title[0]
+00013b70: 202b 206d 6174 6368 2e67 726f 7570 2822   + match.group("
+00013b80: 7469 746c 6522 2920 2b20 7365 6c66 2e61  title") + self.a
+00013b90: 6464 5f74 6974 6c65 5b31 5d5b 3a4c 454e  dd_title[1][:LEN
+00013ba0: 5f54 4954 4c45 5d0a 2020 2020 2020 2020  _TITLE].        
+00013bb0: 2020 2020 6966 2073 656c 662e 6874 6d6c      if self.html
+00013bc0: 5f63 6c61 7373 3a0a 2020 2020 2020 2020  _class:.        
+00013bd0: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+00013be0: 6174 655f 636c 6173 7328 656c 656d 2c20  ate_class(elem, 
+00013bf0: 7365 6c66 2e68 746d 6c5f 636c 6173 7329  self.html_class)
+00013c00: 0a0a 2020 2020 2320 636c 6173 7320 416e  ..    # class An
+00013c10: 6e6f 7461 746f 7243 6f6d 6d61 6e64 0a0a  notatorCommand..
+00013c20: 2020 2020 6465 6620 7275 6e5f 7870 6174      def run_xpat
+00013c30: 6828 7365 6c66 2c20 656c 656d 293a 0a20  h(self, elem):. 
+00013c40: 2020 2020 2020 2078 705f 656c 656d 7320         xp_elems 
+00013c50: 3d20 656c 656d 2e78 7061 7468 2873 656c  = elem.xpath(sel
+00013c60: 662e 7870 6174 6829 0a20 2020 2020 2020  f.xpath).       
+00013c70: 2069 6620 6e6f 7420 7870 5f65 6c65 6d73   if not xp_elems
+00013c80: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00013c90: 7475 726e 0a20 2020 2020 2020 2066 6f72  turn.        for
+00013ca0: 2078 705f 656c 656d 2069 6e20 7870 5f65   xp_elem in xp_e
+00013cb0: 6c65 6d73 3a0a 2020 2020 2020 2020 2020  lems:.          
+00013cc0: 2020 6966 2073 656c 662e 6465 6c65 7465    if self.delete
+00013cd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013ce0: 2020 7870 5f65 6c65 6d2e 6765 7470 6172    xp_elem.getpar
+00013cf0: 656e 7428 292e 7265 6d6f 7665 2878 705f  ent().remove(xp_
+00013d00: 656c 656d 290a 2020 2020 2020 2020 2020  elem).          
+00013d10: 2020 2020 2020 7265 7475 726e 0a20 2020        return.   
+00013d20: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00013d30: 2e68 746d 6c5f 636c 6173 733a 0a20 2020  .html_class:.   
+00013d40: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00013d50: 662e 7570 6461 7465 5f63 6c61 7373 2878  f.update_class(x
+00013d60: 705f 656c 656d 2c20 7365 6c66 2e68 746d  p_elem, self.htm
+00013d70: 6c5f 636c 6173 7329 0a20 2020 2020 2020  l_class).       
+00013d80: 2020 2020 2020 2020 2074 6f73 7472 696e           tostrin
+00013d90: 6720 3d20 4554 2e74 6f73 7472 696e 6728  g = ET.tostring(
+00013da0: 7870 5f65 6c65 6d29 0a20 2020 2020 2020  xp_elem).       
+00013db0: 2020 2020 2020 2020 2070 6173 730a 0a20           pass.. 
+00013dc0: 2020 2023 2063 6c61 7373 2041 6e6e 6f74     # class Annot
+00013dd0: 6174 6f72 436f 6d6d 616e 640a 0a20 2020  atorCommand..   
+00013de0: 2064 6566 2075 7064 6174 655f 636c 6173   def update_clas
+00013df0: 7328 7365 6c66 2c20 656c 656d 2c20 6874  s(self, elem, ht
+00013e00: 6d6c 5f63 6c61 7373 293a 0a20 2020 2020  ml_class):.     
+00013e10: 2020 2063 6c61 7373 6573 203d 205b 5d0a     classes = [].
+00013e20: 2020 2020 2020 2020 4874 6d6c 436c 6173          HtmlClas
+00013e30: 732e 7365 745f 636c 6173 735f 6f6e 5f65  s.set_class_on_e
+00013e40: 6c65 6d65 6e74 2865 6c65 6d2c 2068 746d  lement(elem, htm
+00013e50: 6c5f 636c 6173 7329 0a20 2020 2020 2020  l_class).       
+00013e60: 2069 6620 4661 6c73 653a 0a20 2020 2020   if False:.     
+00013e70: 2020 2020 2020 2069 6620 656c 656d 2e61         if elem.a
+00013e80: 7474 7269 622e 6765 7428 2263 6c61 7373  ttrib.get("class
+00013e90: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+00013ea0: 2020 2020 636c 6173 7365 7320 3d20 656c      classes = el
+00013eb0: 656d 2e61 7474 7269 625b 2263 6c61 7373  em.attrib["class
+00013ec0: 225d 2e73 706c 6974 2822 2022 290a 2020  "].split(" ").  
+00013ed0: 2020 2020 2020 2020 2020 6966 2068 746d            if htm
+00013ee0: 6c5f 636c 6173 7320 6e6f 7420 696e 2063  l_class not in c
+00013ef0: 6c61 7373 6573 3a0a 2020 2020 2020 2020  lasses:.        
+00013f00: 2020 2020 2020 2020 636c 6173 7365 732e          classes.
+00013f10: 6170 7065 6e64 2868 746d 6c5f 636c 6173  append(html_clas
+00013f20: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00013f30: 2020 2065 6c65 6d2e 6174 7472 6962 5b22     elem.attrib["
+00013f40: 636c 6173 7322 5d20 3d20 2220 222e 6a6f  class"] = " ".jo
+00013f50: 696e 2863 6c61 7373 6573 290a 0a20 2020  in(classes)..   
+00013f60: 2064 6566 2072 756e 5f73 7562 7363 7269   def run_subscri
+00013f70: 7074 2873 656c 662c 2073 7061 6e29 3a0a  pt(self, span):.
+00013f80: 2020 2020 2020 2020 6973 5f73 7562 203d          is_sub =
+00013f90: 2048 746d 6c55 7469 6c2e 616e 6e6f 7461   HtmlUtil.annota
+00013fa0: 7465 5f73 6372 6970 745f 7479 7065 2873  te_script_type(s
+00013fb0: 7061 6e2c 2053 5363 7269 7074 2e53 5542  pan, SScript.SUB
+00013fc0: 2c20 7964 6f77 6e3d 4661 6c73 6529 0a20  , ydown=False). 
+00013fd0: 2020 2020 2020 2069 6620 6973 5f73 7562         if is_sub
+00013fe0: 3a0a 2020 2020 2020 2020 2020 2020 7370  :.            sp
+00013ff0: 616e 2e61 7474 7269 625b 2274 6974 6c65  an.attrib["title
+00014000: 225d 203d 2022 7375 6273 6372 6970 745f  "] = "subscript_
+00014010: 7b73 7061 6e2e 7465 7874 7d22 0a20 2020  {span.text}".   
+00014020: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+00014030: 2253 5542 207b 7370 616e 2e74 6578 747d  "SUB {span.text}
+00014040: 2229 0a0a 2020 2020 2320 636c 6173 7320  ")..    # class 
+00014050: 416e 6e6f 7461 746f 7243 6f6d 6d61 6e64  AnnotatorCommand
+00014060: 0a0a 2020 2020 6465 6620 7275 6e5f 7375  ..    def run_su
+00014070: 7065 7273 6372 6970 7428 7365 6c66 2c20  perscript(self, 
+00014080: 7370 616e 293a 0a20 2020 2020 2020 2069  span):.        i
+00014090: 735f 7375 7065 7220 3d20 4874 6d6c 5574  s_super = HtmlUt
+000140a0: 696c 2e61 6e6e 6f74 6174 655f 7363 7269  il.annotate_scri
+000140b0: 7074 5f74 7970 6528 7370 616e 2c20 5353  pt_type(span, SS
+000140c0: 6372 6970 742e 5355 502c 2079 646f 776e  cript.SUP, ydown
+000140d0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+000140e0: 6966 2069 735f 7375 7065 723a 0a20 2020  if is_super:.   
+000140f0: 2020 2020 2020 2020 2073 7061 6e2e 6174           span.at
+00014100: 7472 6962 5b22 7469 746c 6522 5d20 3d20  trib["title"] = 
+00014110: 6622 7375 7065 7273 6372 6970 745f 7b73  f"superscript_{s
+00014120: 7061 6e2e 7465 7874 7d22 0a0a 2020 2020  pan.text}"..    
+00014130: 2320 636c 6173 7320 416e 6e6f 7461 746f  # class Annotato
+00014140: 7243 6f6d 6d61 6e64 0a0a 2020 2020 6465  rCommand..    de
+00014150: 6620 7275 6e5f 6772 6f75 705f 7870 6174  f run_group_xpat
+00014160: 6828 7365 6c66 2c20 6368 696c 645f 656c  h(self, child_el
+00014170: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
+00014180: 6772 6f75 7020 666f 6c6c 6f77 696e 6720  group following 
+00014190: 7369 626c 696e 6773 206f 6620 656c 656d  siblings of elem
+000141a0: 2222 220a 0a20 2020 2020 2020 2072 6573  """..        res
+000141b0: 756c 7420 3d20 4e6f 6e65 0a20 2020 2020  ult = None.     
+000141c0: 2020 2069 6620 6368 696c 645f 656c 656d     if child_elem
+000141d0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000141e0: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+000141f0: 650a 2020 2020 2020 2020 7061 7265 6e74  e.        parent
+00014200: 5f65 6c65 6d20 3d20 6368 696c 645f 656c  _elem = child_el
+00014210: 656d 2e67 6574 7061 7265 6e74 2829 0a20  em.getparent(). 
+00014220: 2020 2020 2020 2069 6620 7061 7265 6e74         if parent
+00014230: 5f65 6c65 6d20 6973 204e 6f6e 653a 0a20  _elem is None:. 
+00014240: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00014250: 6e20 4e6f 6e65 0a20 2020 2020 2020 2067  n None.        g
+00014260: 726f 7570 5f6c 6561 6473 203d 2070 6172  roup_leads = par
+00014270: 656e 745f 656c 656d 2e78 7061 7468 2873  ent_elem.xpath(s
+00014280: 656c 662e 6772 6f75 705f 7870 6174 6829  elf.group_xpath)
+00014290: 0a20 2020 2020 2020 2069 6620 6c65 6e28  .        if len(
+000142a0: 6772 6f75 705f 6c65 6164 7329 203e 2030  group_leads) > 0
+000142b0: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+000142c0: 696e 7428 6622 6772 6f75 7020 6c65 6164  int(f"group lead
+000142d0: 2063 6f75 6e74 207b 6c65 6e28 6772 6f75   count {len(grou
+000142e0: 705f 6c65 6164 7329 7d20 7b73 656c 662e  p_leads)} {self.
+000142f0: 6772 6f75 705f 7870 6174 687d 2229 0a20  group_xpath}"). 
+00014300: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00014310: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
+00014320: 2020 2020 2020 666f 7220 692c 2067 726f        for i, gro
+00014330: 7570 5f6c 6561 6420 696e 2065 6e75 6d65  up_lead in enume
+00014340: 7261 7465 2867 726f 7570 5f6c 6561 6473  rate(group_leads
+00014350: 293a 0a20 2020 2020 2020 2020 2020 2023  ):.            #
+00014360: 2070 7269 6e74 2866 2267 726f 7570 206c   print(f"group l
+00014370: 6561 6420 7b45 542e 746f 7374 7269 6e67  ead {ET.tostring
+00014380: 2867 726f 7570 5f6c 6561 6429 7d22 290a  (group_lead)}").
+00014390: 2020 2020 2020 2020 2020 2020 2320 656e              # en
+000143a0: 645f 6772 6f75 6f20 3d20 6772 6f75 705f  d_grouo = group_
+000143b0: 6c65 6164 735b 6920 2b20 315d 2069 6620  leads[i + 1] if 
+000143c0: 6920 3c20 6c65 6e28 6772 6f75 705f 6c65  i < len(group_le
+000143d0: 6164 7329 202d 2031 2065 6c73 6520 4e6f  ads) - 1 else No
+000143e0: 6e65 0a20 2020 2020 2020 2020 2020 2073  ne.            s
+000143f0: 656c 662e 6d61 6b65 5f67 726f 7570 2870  elf.make_group(p
+00014400: 6172 656e 745f 656c 656d 2c20 6772 6f75  arent_elem, grou
+00014410: 705f 6c65 6164 290a 0a20 2020 2023 2063  p_lead)..    # c
+00014420: 6c61 7373 2041 6e6e 6f74 6174 6f72 436f  lass AnnotatorCo
+00014430: 6d6d 616e 640a 0a20 2020 2064 6566 206d  mmand..    def m
+00014440: 616b 655f 6772 6f75 7028 7365 6c66 2c20  ake_group(self, 
+00014450: 656c 656d 2c20 6772 6f75 705f 6c65 6164  elem, group_lead
+00014460: 2c20 656e 645f 6772 6f75 703d 4e6f 6e65  , end_group=None
+00014470: 293a 0a20 2020 2020 2020 2070 6172 656e  ):.        paren
+00014480: 7420 3d20 586d 6c4c 6962 2e67 6574 7061  t = XmlLib.getpa
+00014490: 7265 6e74 2865 6c65 6d2c 2064 6562 7567  rent(elem, debug
+000144a0: 3d54 7275 6529 0a20 2020 2020 2020 2069  =True).        i
+000144b0: 6620 7061 7265 6e74 2069 7320 4e6f 6e65  f parent is None
+000144c0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+000144d0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+000144e0: 6e75 6c6c 2070 6172 656e 7422 290a 2020  null parent").  
+000144f0: 2020 2020 2020 7369 626c 696e 6773 203d        siblings =
+00014500: 2067 726f 7570 5f6c 6561 642e 7870 6174   group_lead.xpat
+00014510: 6828 2266 6f6c 6c6f 7769 6e67 2d73 6962  h("following-sib
+00014520: 6c69 6e67 3a3a 2a22 290a 2020 2020 2020  ling::*").      
+00014530: 2020 6966 206c 656e 2873 6962 6c69 6e67    if len(sibling
+00014540: 7329 203d 3d20 303a 0a20 2020 2020 2020  s) == 0:.       
+00014550: 2020 2020 2070 7269 6e74 2866 226e 6f20       print(f"no 
+00014560: 7369 626c 696e 6773 3a20 7b67 726f 7570  siblings: {group
+00014570: 5f6c 6561 642e 7465 7874 7d22 290a 2020  _lead.text}").  
+00014580: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+00014590: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+000145a0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+000145b0: 2273 6962 6c69 6e67 7320 7b6c 656e 2873  "siblings {len(s
+000145c0: 6962 6c69 6e67 7329 7d21 2121 2229 0a20  iblings)}!!!"). 
+000145d0: 2020 2020 2020 2064 6976 203d 2045 542e         div = ET.
+000145e0: 5375 6245 6c65 6d65 6e74 2870 6172 656e  SubElement(paren
+000145f0: 742c 2022 6469 7622 290a 2020 2020 2020  t, "div").      
+00014600: 2020 6469 762e 6170 7065 6e64 2867 726f    div.append(gro
+00014610: 7570 5f6c 6561 6429 0a20 2020 2020 2020  up_lead).       
+00014620: 2064 6976 2e61 7474 7269 625b 2274 6974   div.attrib["tit
+00014630: 6c65 225d 203d 2067 726f 7570 5f6c 6561  le"] = group_lea
+00014640: 642e 7465 7874 2069 6620 6772 6f75 705f  d.text if group_
+00014650: 6c65 6164 2e74 6578 7420 656c 7365 2022  lead.text else "
+00014660: 3f22 0a20 2020 2020 2020 2064 6976 2e61  ?".        div.a
+00014670: 7474 7269 625b 2273 7479 6c65 225d 203d  ttrib["style"] =
+00014680: 2022 626f 7264 6572 3a62 6c61 636b 2064   "border:black d
+00014690: 6173 6865 6420 3270 783b 220a 2020 2020  ashed 2px;".    
+000146a0: 2020 2020 7870 203d 2073 656c 662e 656e      xp = self.en
+000146b0: 645f 7870 6174 680a 2020 2020 2020 2020  d_xpath.        
+000146c0: 7870 203d 2022 7365 6c66 3a3a 6469 765b  xp = "self::div[
+000146d0: 7370 616e 5b63 6f6e 7461 696e 7328 7465  span[contains(te
+000146e0: 7874 2829 2c27 454e 4427 295d 5d22 0a20  xt(),'END')]]". 
+000146f0: 2020 2020 2020 2023 2070 7269 6e74 2866         # print(f
+00014700: 2265 6e64 5f78 7061 7468 207b 7870 7d22  "end_xpath {xp}"
+00014710: 290a 2020 2020 2020 2020 666f 7220 7369  ).        for si
+00014720: 626c 696e 6720 696e 2073 6962 6c69 6e67  bling in sibling
+00014730: 733a 0a20 2020 2020 2020 2020 2020 2070  s:.            p
+00014740: 7269 6e74 2866 2273 6962 6c69 6e67 3a20  rint(f"sibling: 
+00014750: 7b27 272e 6a6f 696e 2873 6962 6c69 6e67  {''.join(sibling
+00014760: 2e69 7465 7274 6578 7428 2929 7d22 290a  .itertext())}").
+00014770: 2020 2020 2020 2020 2020 2020 656e 645f              end_
+00014780: 7369 6220 3d20 4e6f 6e65 0a20 2020 2020  sib = None.     
+00014790: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+000147a0: 2020 2020 2020 2020 2020 2020 656e 645f              end_
+000147b0: 7369 6220 3d20 7369 626c 696e 672e 7870  sib = sibling.xp
+000147c0: 6174 6828 7870 290a 2020 2020 2020 2020  ath(xp).        
+000147d0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+000147e0: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+000147f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00014800: 2866 2266 6169 6c65 6420 7870 6174 6820  (f"failed xpath 
+00014810: 7b78 707d 207b 657d 2229 0a20 2020 2020  {xp} {e}").     
+00014820: 2020 2020 2020 2069 6620 656e 645f 7369         if end_si
+00014830: 6220 616e 6420 6c65 6e28 656e 645f 7369  b and len(end_si
+00014840: 6229 203e 2030 3a0a 2020 2020 2020 2020  b) > 0:.        
+00014850: 2020 2020 2320 6966 2073 6962 6c69 6e67      # if sibling
+00014860: 2021 3d20 656e 645f 6772 6f75 703a 0a20   != end_group:. 
+00014870: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00014880: 2070 7269 6e74 2866 2273 6962 6c69 6e67   print(f"sibling
+00014890: 207b 7369 626c 696e 677d 2229 0a20 2020   {sibling}").   
+000148a0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+000148b0: 616b 0a20 2020 2020 2020 2020 2020 2064  ak.            d
+000148c0: 6976 2e61 7070 656e 6428 7369 626c 696e  iv.append(siblin
+000148d0: 6729 0a20 2020 2020 2020 2072 6574 7572  g).        retur
+000148e0: 6e20 6469 760a 0a20 2020 2023 2063 6c61  n div..    # cla
+000148f0: 7373 2041 6e6e 6f74 6174 6f72 436f 6d6d  ss AnnotatorComm
+00014900: 616e 640a 0a20 2020 2064 6566 2072 756e  and..    def run
+00014910: 5f65 7874 7261 6374 2873 656c 662c 2065  _extract(self, e
+00014920: 6c65 6d29 3a0a 0a20 2020 2020 2020 2022  lem):..        "
+00014930: 2222 6578 7472 6163 7420 6772 6f75 702e  ""extract group.
+00014940: 206f 7074 696e 616c 6c79 2077 7269 7465   optinally write
+00014950: 2074 6f20 6669 6c65 2e20 6375 7272 656e   to file. curren
+00014960: 746c 7920 4e4f 2d4f 5022 2222 0a20 2020  tly NO-OP""".   
+00014970: 2020 2020 2070 7269 6e74 2866 2272 756e       print(f"run
+00014980: 5f65 7874 7261 6374 2069 7320 4e4f 2d4f  _extract is NO-O
+00014990: 5022 290a 2020 2020 2020 2020 7265 7475  P").        retu
+000149a0: 726e 204e 6f6e 650a 0a20 2020 2023 2063  rn None..    # c
+000149b0: 6c61 7373 2041 6e6e 6f74 6174 6f72 436f  lass AnnotatorCo
+000149c0: 6d6d 616e 640a 0a20 2020 2064 6566 2072  mmand..    def r
+000149d0: 656d 6f76 655f 656c 656d 2873 656c 662c  emove_elem(self,
+000149e0: 2065 6c65 6d2c 2064 6562 7567 3d46 616c   elem, debug=Fal
+000149f0: 7365 293a 0a20 2020 2020 2020 2069 6620  se):.        if 
+00014a00: 656c 656d 2069 7320 4e6f 6e65 3a0a 2020  elem is None:.  
+00014a10: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00014a20: 0a20 2020 2020 2020 2070 6172 656e 7420  .        parent 
+00014a30: 3d20 656c 656d 2e67 6574 7061 7265 6e74  = elem.getparent
+00014a40: 2829 0a20 2020 2020 2020 2069 6620 7061  ().        if pa
+00014a50: 7265 6e74 2069 7320 4e6f 6e65 3a0a 2020  rent is None:.  
+00014a60: 2020 2020 2020 2020 2020 6966 2064 6562            if deb
+00014a70: 7567 3a0a 2020 2020 2020 2020 2020 2020  ug:.            
+00014a80: 2020 2020 7072 696e 7428 6622 656c 656d      print(f"elem
+00014a90: 656e 7420 7b65 6c65 6d7d 2068 6173 206e  ent {elem} has n
+00014aa0: 6f20 7061 7265 6e74 2229 0a20 2020 2020  o parent").     
+00014ab0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+00014ac0: 2020 2020 2020 7061 7265 6e74 2e72 656d        parent.rem
+00014ad0: 6f76 6528 656c 656d 290a 0a0a 0a53 5459  ove(elem)....STY
+00014ae0: 4c45 5f43 5552 4c59 5f52 4520 3d20 7265  LE_CURLY_RE = re
+00014af0: 2e63 6f6d 7069 6c65 2822 283f 503c 7072  .compile("(?P<pr
+00014b00: 653e 2e2a 297b 283f 503c 7661 6c75 653e  e>.*){(?P<value>
+00014b10: 5b5e 7d5d 2a29 7d28 3f50 3c70 6f73 743e  [^}]*)}(?P<post>
+00014b20: 2e2a 2922 290a 636c 6173 7320 4874 6d6c  .*)").class Html
+00014b30: 5374 796c 653a 0a20 2020 2022 2222 0a20  Style:.    """. 
+00014b40: 2020 206d 6574 686f 6473 2074 6f20 7072     methods to pr
+00014b50: 6f63 6573 7320 7374 796c 6520 6174 7472  ocess style attr
+00014b60: 6962 7574 6573 2061 6e64 203c 7374 796c  ibutes and <styl
+00014b70: 653e 2065 6c65 6d65 6e74 730a 2020 2020  e> elements.    
+00014b80: 6e6f 2069 6e73 7461 6e63 6520 6461 7461  no instance data
+00014b90: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
+00014ba0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
+00014bb0: 6373 735f 7374 7269 6e67 3d4e 6f6e 6529  css_string=None)
+00014bc0: 3a0a 2020 2020 2020 2020 7365 6c66 2e63  :.        self.c
+00014bd0: 7373 5f73 7472 696e 6720 3d20 6373 735f  ss_string = css_
+00014be0: 7374 7269 6e67 0a0a 0a0a 2020 2020 4063  string....    @c
+00014bf0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00014c00: 6566 2067 6574 5f63 7373 7374 796c 655f  ef get_cssstyle_
+00014c10: 7374 7269 6e67 2863 6c73 2c20 656c 656d  string(cls, elem
+00014c20: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00014c30: 2020 2020 2020 2063 6f6e 7665 6e69 656e         convenien
+00014c40: 6365 206d 6574 686f 6420 746f 2067 6574  ce method to get
+00014c50: 2065 6c65 6d65 6e74 2073 7479 6c65 0a20   element style. 
+00014c60: 2020 2020 2020 203a 7061 7261 6d20 656c         :param el
+00014c70: 656d 3a20 746f 2067 6574 2073 7479 6c65  em: to get style
+00014c80: 2066 726f 6d0a 2020 2020 2020 2020 3a72   from.        :r
+00014c90: 6574 7572 6e3a 2073 7479 6c65 206f 7220  eturn: style or 
+00014ca0: 4e6f 6e65 0a20 2020 2020 2020 2022 2222  None.        """
+00014cb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00014cc0: 656c 656d 2e61 7474 7269 622e 6765 7428  elem.attrib.get(
+00014cd0: 2273 7479 6c65 2229 0a0a 2320 636c 6173  "style")..# clas
+00014ce0: 7320 4874 6d6c 5374 796c 650a 0a20 2020  s HtmlStyle..   
+00014cf0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00014d00: 2020 6465 6620 7365 745f 7374 796c 6528    def set_style(
+00014d10: 636c 732c 2065 6c65 6d2c 2076 616c 7565  cls, elem, value
+00014d20: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00014d30: 2020 2020 2020 2063 6f6e 7665 6e69 656e         convenien
+00014d40: 6365 206d 6574 686f 6420 746f 2073 6574  ce method to set
+00014d50: 2073 7479 6c65 206f 6e20 656c 656d 656e   style on elemen
+00014d60: 740a 2020 2020 2020 2020 3a70 6172 616d  t.        :param
+00014d70: 2065 6c65 6d3a 656c 656d 656e 7420 746f   elem:element to
+00014d80: 2073 6574 2073 7479 6c65 206f 6e0a 2020   set style on.  
+00014d90: 2020 2020 2020 3a70 6172 616d 2076 616c        :param val
+00014da0: 7565 3a20 6373 7320 7374 7269 6e67 3b20  ue: css string; 
+00014db0: 6966 2022 2220 6f72 204e 6f6e 6520 7265  if "" or None re
+00014dc0: 6d6c 7665 7320 6174 7472 6962 7574 650a  mlves attribute.
+00014dd0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00014de0: 2020 2020 6966 2065 6c65 6d20 6973 206e      if elem is n
+00014df0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00014e00: 2020 2020 2058 6d6c 4c69 622e 7365 745f       XmlLib.set_
+00014e10: 6174 746e 616d 655f 7661 6c75 6528 656c  attname_value(el
+00014e20: 656d 2c20 2273 7479 6c65 222c 2076 616c  em, "style", val
+00014e30: 7565 290a 0a20 2020 2023 2063 6c61 7373  ue)..    # class
+00014e40: 2048 746d 6c53 7479 6c65 0a0a 2020 2020   HtmlStyle..    
+00014e50: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00014e60: 2064 6566 2065 7874 7261 6374 5f61 6c6c   def extract_all
+00014e70: 5f73 7479 6c65 5f61 7474 7269 6275 7465  _style_attribute
+00014e80: 735f 746f 5f68 6561 6428 636c 732c 2068  s_to_head(cls, h
+00014e90: 746d 6c5f 656c 656d 293a 0a20 2020 2020  tml_elem):.     
+00014ea0: 2020 2022 2222 0a20 2020 2020 2020 2046     """.        F
+00014eb0: 696e 6473 2061 6c6c 2065 6c65 6d65 6e74  inds all element
+00014ec0: 7320 7769 7468 2040 7374 796c 6520 6174  s with @style at
+00014ed0: 7472 6962 7574 6520 616e 6420 6578 7461  tribute and exta
+00014ee0: 6374 7320 7468 6520 7464 7874 2073 7479  cts the tdxt sty
+00014ef0: 6c65 7320 746f 203c 6865 6164 3e0a 2020  les to <head>.  
+00014f00: 2020 2020 2020 416c 736f 2073 6574 7320        Also sets 
+00014f10: 626f 6479 2073 7479 6c65 7320 746f 206e  body styles to n
+00014f20: 6f72 6d61 6c0a 2020 2020 2020 2020 3a70  ormal.        :p
+00014f30: 6172 616d 2068 746d 6c5f 656c 656d 3a20  aram html_elem: 
+00014f40: 746f 7461 6c20 6874 6d6c 206f 626a 6563  total html objec
+00014f50: 7420 746f 206e 6f72 6d61 6c69 7a65 2e20  t to normalize. 
+00014f60: 4d75 7374 2068 6176 6520 3c68 6561 643e  Must have <head>
+00014f70: 2061 6e64 203c 626f 6479 3e0a 2020 2020   and <body>.    
+00014f80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00014f90: 4874 6d6c 5374 796c 652e 7265 6d6f 7665  HtmlStyle.remove
+00014fa0: 5f65 6d70 7479 5f73 7479 6c65 7328 6874  _empty_styles(ht
+00014fb0: 6d6c 5f65 6c65 6d29 0a20 2020 2020 2020  ml_elem).       
+00014fc0: 2073 7479 6c65 645f 656c 656d 7320 3d20   styled_elems = 
+00014fd0: 6874 6d6c 5f65 6c65 6d2e 7870 6174 6828  html_elem.xpath(
+00014fe0: 222e 2f2f 2a5b 4073 7479 6c65 5d22 290a  ".//*[@style]").
+00014ff0: 2020 2020 2020 2020 666f 7220 692c 2073          for i, s
+00015000: 7479 6c65 645f 656c 656d 2069 6e20 656e  tyled_elem in en
+00015010: 756d 6572 6174 6528 7374 796c 6564 5f65  umerate(styled_e
+00015020: 6c65 6d73 293a 0a20 2020 2020 2020 2020  lems):.         
+00015030: 2020 2063 6c61 7373 7265 6620 3d20 6622     classref = f"
+00015040: 737b 697d 220a 2020 2020 2020 2020 2020  s{i}".          
+00015050: 2020 4874 6d6c 5374 796c 652e 6164 645f    HtmlStyle.add_
+00015060: 656c 656d 656e 745f 7769 7468 5f73 7479  element_with_sty
+00015070: 6c65 2863 6c61 7373 7265 662c 2068 746d  le(classref, htm
+00015080: 6c5f 656c 656d 2c20 7374 796c 6564 5f65  l_elem, styled_e
+00015090: 6c65 6d29 0a20 2020 2020 2020 2023 2064  lem).        # d
+000150a0: 6f65 7320 7468 6973 2064 6f20 616e 7974  oes this do anyt
+000150b0: 6869 6e67 3f3f 3f0a 2020 2020 2020 2020  hing???.        
+000150c0: 626f 6479 203d 2068 746d 6c5f 656c 656d  body = html_elem
+000150d0: 2e78 7061 7468 2822 2f68 746d 6c2f 626f  .xpath("/html/bo
+000150e0: 6479 2229 0a20 2020 2020 2020 2069 6620  dy").        if 
+000150f0: 6c65 6e28 626f 6479 2920 213d 2031 3a0a  len(body) != 1:.
+00015100: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00015110: 6520 5661 6c75 6545 7272 6f72 2866 2264  e ValueError(f"d
+00015120: 6f63 756d 656e 7420 7368 6f75 6c64 2068  ocument should h
+00015130: 6176 6520 6578 6163 746c 7920 3120 626f  ave exactly 1 bo
+00015140: 6479 2074 6167 2229 0a20 2020 2020 2020  dy tag").       
+00015150: 2073 7479 6c65 203d 2043 5353 5374 796c   style = CSSStyl
+00015160: 6528 290a 2020 2020 2020 2020 7374 796c  e().        styl
+00015170: 652e 6372 6561 7465 5f63 7373 5f73 7479  e.create_css_sty
+00015180: 6c65 5f66 726f 6d5f 6373 735f 7374 7269  le_from_css_stri
+00015190: 6e67 280a 2020 2020 2020 2020 2020 2020  ng(.            
+000151a0: 2266 6f6e 742d 7374 796c 653a 206e 6f72  "font-style: nor
+000151b0: 6d61 6c3b 2022 0a20 2020 2020 2020 2020  mal; ".         
+000151c0: 2020 2022 666f 6e74 2d77 6569 6768 743a     "font-weight:
+000151d0: 206e 6f72 6d61 6c3b 2022 0a20 2020 2020   normal; ".     
+000151e0: 2020 2020 2020 2022 666f 6e74 2d73 7472         "font-str
+000151f0: 6574 6368 6564 3a20 6e6f 726d 616c 3b20  etched: normal; 
+00015200: 220a 2020 2020 2020 2020 2020 2020 226f  ".            "o
+00015210: 7061 6369 7479 3a20 313b 2022 0a20 2020  pacity: 1; ".   
+00015220: 2020 2020 2020 2020 2022 636f 6c6f 723a           "color:
+00015230: 2062 6c61 636b 3b22 0a20 2020 2020 2020   black;".       
+00015240: 2029 0a0a 2020 2020 2320 636c 6173 7320   )..    # class 
+00015250: 4874 6d6c 5374 796c 650a 0a20 2020 2040  HtmlStyle..    @
+00015260: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00015270: 6465 6620 6164 645f 656c 656d 656e 745f  def add_element_
+00015280: 7769 7468 5f73 7479 6c65 2863 6c73 2c20  with_style(cls, 
+00015290: 636c 6173 7372 6566 2c20 6874 6d6c 5f65  classref, html_e
+000152a0: 6c65 6d2c 2073 7479 6c65 645f 656c 656d  lem, styled_elem
+000152b0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+000152c0: 2020 2020 2020 2061 6464 730a 2020 2020         adds.    
+000152d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000152e0: 6865 6164 203d 2068 746d 6c5f 656c 656d  head = html_elem
+000152f0: 2e78 7061 7468 2822 2f68 746d 6c2f 6865  .xpath("/html/he
+00015300: 6164 2229 5b30 5d0a 2020 2020 2020 2020  ad")[0].        
+00015310: 656c 656d 5f73 7479 6c65 203d 2048 746d  elem_style = Htm
+00015320: 6c53 7479 6c65 2e67 6574 5f63 7373 7374  lStyle.get_cssst
+00015330: 796c 655f 7374 7269 6e67 2873 7479 6c65  yle_string(style
+00015340: 645f 656c 656d 290a 2020 2020 2020 2020  d_elem).        
+00015350: 6966 2065 6c65 6d5f 7374 796c 6520 6973  if elem_style is
+00015360: 204e 6f6e 6520 6f72 2065 6c65 6d5f 7374   None or elem_st
+00015370: 796c 6520 3d3d 2022 223a 0a20 2020 2020  yle == "":.     
+00015380: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
+00015390: 2020 2020 2020 6373 7320 3d20 4353 5353        css = CSSS
+000153a0: 7479 6c65 2e63 7265 6174 655f 6373 735f  tyle.create_css_
+000153b0: 7374 796c 655f 6672 6f6d 5f63 7373 5f73  style_from_css_s
+000153c0: 7472 696e 6728 656c 656d 5f73 7479 6c65  tring(elem_style
+000153d0: 290a 2020 2020 2020 2020 6966 2063 7373  ).        if css
+000153e0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000153f0: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00015400: 6545 7272 6f72 2866 2263 7373 2069 7320  eError(f"css is 
+00015410: 4e6f 6e65 2229 0a0a 2020 2020 2020 2020  None")..        
+00015420: 6578 7472 6163 7465 645f 7374 796c 655f  extracted_style_
+00015430: 656c 656d 2c20 7265 6d61 696e 696e 675f  elem, remaining_
+00015440: 7374 796c 652c 206e 6577 5f63 6c61 7373  style, new_class
+00015450: 203d 2063 7373 2e65 7874 7261 6374 5f74   = css.extract_t
+00015460: 6578 745f 7374 796c 6573 5f69 6e74 6f5f  ext_styles_into_
+00015470: 636c 6173 7328 636c 6173 7372 6566 290a  class(classref).
+00015480: 2020 2020 2020 2020 6966 2065 7874 7261          if extra
+00015490: 6374 6564 5f73 7479 6c65 5f65 6c65 6d20  cted_style_elem 
+000154a0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+000154b0: 2020 2020 2020 2020 2048 746d 6c53 7479           HtmlSty
+000154c0: 6c65 2e73 6574 5f73 7479 6c65 2873 7479  le.set_style(sty
+000154d0: 6c65 645f 656c 656d 2c20 7265 6d61 696e  led_elem, remain
+000154e0: 696e 675f 7374 796c 6529 0a20 2020 2020  ing_style).     
+000154f0: 2020 2020 2020 2048 746d 6c43 6c61 7373         HtmlClass
+00015500: 2e73 6574 5f63 6c61 7373 5f6f 6e5f 656c  .set_class_on_el
+00015510: 656d 656e 7428 7374 796c 6564 5f65 6c65  ement(styled_ele
+00015520: 6d2c 2063 6c61 7373 7265 662c 2072 6570  m, classref, rep
+00015530: 6c61 6365 3d46 616c 7365 290a 2020 2020  lace=False).    
+00015540: 2020 2020 2020 2020 6865 6164 2e61 7070          head.app
+00015550: 656e 6428 6578 7472 6163 7465 645f 7374  end(extracted_st
+00015560: 796c 655f 656c 656d 290a 0a20 2020 2023  yle_elem)..    #
+00015570: 2063 6c61 7373 2048 746d 6c53 7479 6c65   class HtmlStyle
+00015580: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00015590: 6f64 0a20 2020 2064 6566 2072 656d 6f76  od.    def remov
+000155a0: 655f 656d 7074 795f 7374 796c 6573 2863  e_empty_styles(c
+000155b0: 6c73 2c20 6874 6d6c 5f65 6c65 6d29 3a0a  ls, html_elem):.
+000155c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000155d0: 2020 2020 7265 6d6f 7665 7320 616c 6c20      removes all 
+000155e0: 656d 7074 7920 7374 796c 6520 6174 7472  empty style attr
+000155f0: 6962 7574 6573 2028 7374 796c 653d 2222  ibutes (style=""
+00015600: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
+00015610: 2020 2020 2020 656d 7074 795f 7374 796c        empty_styl
+00015620: 6564 5f65 6c65 6d73 203d 2068 746d 6c5f  ed_elems = html_
+00015630: 656c 656d 2e78 7061 7468 2822 2e2f 2f2a  elem.xpath(".//*
+00015640: 5b6e 6f72 6d61 6c69 7a65 2d73 7061 6365  [normalize-space
+00015650: 2840 7374 796c 6529 3d27 275d 2229 0a20  (@style)='']"). 
+00015660: 2020 2020 2020 2066 6f72 2065 6c65 6d20         for elem 
+00015670: 696e 2065 6d70 7479 5f73 7479 6c65 645f  in empty_styled_
+00015680: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
+00015690: 2020 2048 746d 6c53 7479 6c65 2e64 656c     HtmlStyle.del
+000156a0: 6574 655f 7374 796c 6528 656c 656d 290a  ete_style(elem).
+000156b0: 0a20 2020 2023 2063 6c61 7373 2048 746d  .    # class Htm
+000156c0: 6c53 7479 6c65 0a0a 2020 2020 4063 6c61  lStyle..    @cla
+000156d0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+000156e0: 2064 656c 6574 655f 7374 796c 6528 636c   delete_style(cl
+000156f0: 732c 2065 6c65 6d29 3a0a 2020 2020 2020  s, elem):.      
+00015700: 2020 2222 220a 2020 2020 2020 2020 636f    """.        co
+00015710: 6e76 656e 6965 6e6e 6365 206d 6574 686f  nveniennce metho
+00015720: 6420 746f 2064 656c 6574 6520 7374 796c  d to delete styl
+00015730: 6520 6174 7472 6962 7574 650a 2020 2020  e attribute.    
+00015740: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00015750: 586d 6c4c 6962 2e72 656d 6f76 655f 6174  XmlLib.remove_at
+00015760: 7472 6962 7574 6528 656c 656d 2c20 2273  tribute(elem, "s
+00015770: 7479 6c65 2229 0a0a 2020 2020 2320 5448  tyle")..    # TH
+00015780: 4553 4520 4341 4e20 4245 434f 4d45 2049  ESE CAN BECOME I
+00015790: 4e53 5441 4e43 4520 4d45 5448 4f44 530a  NSTANCE METHODS.
+000157a0: 0a20 2020 2023 2063 6c61 7373 2048 746d  .    # class Htm
+000157b0: 6c53 7479 6c65 0a0a 2020 2020 4063 6c61  lStyle..    @cla
+000157c0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+000157d0: 206e 6f72 6d61 6c69 7a65 5f68 6561 645f   normalize_head_
+000157e0: 7374 796c 6573 2863 6c73 2c20 656c 656d  styles(cls, elem
+000157f0: 2c20 6974 616c 6963 5f62 6f6c 643d 5472  , italic_bold=Tr
+00015800: 7565 2c20 6f75 7464 6972 3d4e 6f6e 6529  ue, outdir=None)
+00015810: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00015820: 2020 2020 2020 6372 6561 7465 7320 6d75        creates mu
+00015830: 6c74 6964 6963 7420 666f 7420 6865 6164  ltidict fot head
+00015840: 2073 7479 6c65 730a 2020 2020 2020 2020   styles.        
+00015850: 3a70 6172 616d 2065 6c65 6d3a 2064 6f63  :param elem: doc
+00015860: 756d 656e 7420 746f 2061 6e61 6c79 7365  ument to analyse
+00015870: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00015880: 3a20 6469 6374 206f 6620 636c 6173 7372  : dict of classr
+00015890: 6566 5f73 6574 7320 696e 6465 7865 6420  ef_sets indexed 
+000158a0: 6279 2073 7479 6c65 2073 7472 696e 6773  by style strings
+000158b0: 0a0a 2020 2020 2020 2020 652e 672e 2069  ..        e.g. i
+000158c0: 7465 6d20 7b66 6f6e 742d 6661 6d69 6c79  tem {font-family
+000158d0: 3a20 5469 6d65 734e 6577 526f 6d61 6e50  : TimesNewRomanP
+000158e0: 534d 543b 2066 6f6e 742d 7369 7a65 3a20  SMT; font-size: 
+000158f0: 3670 783b 7d3a 205b 272e 7331 3727 2c20  6px;}: ['.s17', 
+00015900: 272e 7331 3927 2c20 272e 7332 3127 2c20  '.s19', '.s21', 
+00015910: 272e 7332 3727 2c20 272e 7335 272c 2027  '.s27', '.s5', '
+00015920: 2e73 3727 5d0a 2020 2020 2020 2020 2222  .s7'].        ""
+00015930: 220a 2020 2020 2020 2020 7374 796c 655f  ".        style_
+00015940: 746f 5f63 6c61 7373 7265 665f 7365 7420  to_classref_set 
+00015950: 3d20 6465 6661 756c 7464 6963 7428 7365  = defaultdict(se
+00015960: 7429 0a20 2020 2020 2020 2068 6561 645f  t).        head_
+00015970: 7374 796c 6573 203d 2048 746d 6c53 7479  styles = HtmlSty
+00015980: 6c65 2e67 6574 5f68 6561 645f 7374 796c  le.get_head_styl
+00015990: 6573 2865 6c65 6d29 0a20 2020 2020 2020  es(elem).       
+000159a0: 2023 2077 6520 7573 6520 6f6e 6520 636c   # we use one cl
+000159b0: 6173 7372 6566 202d 2073 7479 6c65 2070  assref - style p
+000159c0: 6572 2048 544d 4c20 7374 796c 650a 2020  er HTML style.  
+000159d0: 2020 2020 2020 666f 7220 6874 6d6c 5f73        for html_s
+000159e0: 7479 6c65 2069 6e20 6865 6164 5f73 7479  tyle in head_sty
+000159f0: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+00015a00: 2023 2063 6f6e 7369 7374 7320 6f66 2063   # consists of c
+00015a10: 6c61 7373 7265 6620 736e 6420 7374 796c  lassref snd styl
+00015a20: 655f 7374 7269 6e67 0a20 2020 2020 2020  e_string.       
+00015a30: 2020 2020 2063 6c61 7373 7265 662c 2073       classref, s
+00015a40: 7479 6c65 5f73 203d 2063 6c73 2e65 7874  tyle_s = cls.ext
+00015a50: 7261 6374 5f63 6c61 7373 7265 665f 616e  ract_classref_an
+00015a60: 645f 6373 7373 7472 696e 675f 6672 6f6d  d_cssstring_from
+00015a70: 5f68 746d 6c5f 7374 796c 6528 6874 6d6c  _html_style(html
+00015a80: 5f73 7479 6c65 290a 2020 2020 2020 2020  _style).        
+00015a90: 2020 2020 7374 796c 655f 7661 6c75 6520      style_value 
+00015aa0: 3d20 7374 796c 655f 730a 2020 2020 2020  = style_s.      
+00015ab0: 2020 2020 2020 6966 2069 7461 6c69 635f        if italic_
+00015ac0: 626f 6c64 3a0a 2020 2020 2020 2020 2020  bold:.          
+00015ad0: 2020 2020 2020 6e65 775f 6373 735f 7320        new_css_s 
+00015ae0: 3d20 416d 6946 6f6e 742e 6372 6561 7465  = AmiFont.create
+00015af0: 5f66 6f6e 745f 6564 6974 6564 5f73 7479  _font_edited_sty
+00015b00: 6c65 5f66 726f 6d5f 6373 735f 7374 796c  le_from_css_styl
+00015b10: 655f 6f62 6a65 6374 2873 7479 6c65 5f73  e_object(style_s
+00015b20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015b30: 2020 6373 735f 7374 796c 6520 3d20 4353    css_style = CS
+00015b40: 5353 7479 6c65 2e63 7265 6174 655f 6373  SStyle.create_cs
+00015b50: 735f 7374 796c 655f 6672 6f6d 5f63 7373  s_style_from_css
+00015b60: 5f73 7472 696e 6728 6e65 775f 6373 735f  _string(new_css_
+00015b70: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00015b80: 2020 2069 6620 6373 735f 7374 796c 6520     if css_style 
+00015b90: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00015ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015bb0: 2063 7373 5f73 7479 6c65 2e65 7874 7261   css_style.extra
+00015bc0: 6374 5f62 6f6c 645f 6974 616c 6963 5f66  ct_bold_italic_f
+00015bd0: 726f 6d5f 666f 6e74 5f66 616d 696c 7928  rom_font_family(
+00015be0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015bf0: 2020 2020 2020 7374 796c 655f 7661 6c75        style_valu
+00015c00: 6520 3d20 6373 735f 7374 796c 652e 6765  e = css_style.ge
+00015c10: 745f 6373 735f 7661 6c75 6528 7772 6170  t_css_value(wrap
+00015c20: 5f77 6974 685f 6375 726c 793d 5472 7565  _with_curly=True
+00015c30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00015c40: 2020 2020 2020 4874 6d6c 5374 796c 652e        HtmlStyle.
+00015c50: 7265 706c 6163 655f 6375 726c 7928 6874  replace_curly(ht
+00015c60: 6d6c 5f73 7479 6c65 2c20 7374 796c 655f  ml_style, style_
+00015c70: 7661 6c75 6529 0a20 2020 2020 2020 2020  value).         
+00015c80: 2020 2068 746d 6c5f 7374 796c 652e 6174     html_style.at
+00015c90: 7472 6962 5b43 4c41 5353 5245 465d 203d  trib[CLASSREF] =
+00015ca0: 2063 6c61 7373 7265 660a 2020 2020 2020   classref.      
+00015cb0: 2020 2020 2020 7374 796c 655f 746f 5f63        style_to_c
+00015cc0: 6c61 7373 7265 665f 7365 745b 7374 796c  lassref_set[styl
+00015cd0: 655f 7661 6c75 655d 2e61 6464 2863 6c61  e_value].add(cla
+00015ce0: 7373 7265 6629 0a20 2020 2020 2020 2069  ssref).        i
+00015cf0: 6620 6f75 7464 6972 3a0a 2020 2020 2020  f outdir:.      
+00015d00: 2020 2020 2020 4874 6d6c 4c69 622e 7772        HtmlLib.wr
+00015d10: 6974 655f 6874 6d6c 5f66 696c 6528 656c  ite_html_file(el
+00015d20: 656d 2c20 5061 7468 286f 7574 6469 722c  em, Path(outdir,
+00015d30: 2022 6e6f 726d 616c 697a 6564 2e68 746d   "normalized.htm
+00015d40: 6c22 2929 0a20 2020 2020 2020 2072 6574  l")).        ret
+00015d50: 7572 6e20 7374 796c 655f 746f 5f63 6c61  urn style_to_cla
+00015d60: 7373 7265 665f 7365 740a 0a20 2020 2040  ssref_set..    @
+00015d70: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00015d80: 6465 6620 6765 745f 6865 6164 5f73 7479  def get_head_sty
+00015d90: 6c65 7328 636c 732c 2065 6c65 6d29 3a0a  les(cls, elem):.
+00015da0: 2020 2020 2020 2020 2222 2267 6574 2061          """get a
+00015db0: 6c6c 203c 7374 796c 653e 2065 6c65 6d65  ll <style> eleme
+00015dc0: 6e74 7320 6666 726f 6d20 3c68 6561 643e  nts ffrom <head>
+00015dd0: 0a20 2020 2020 2020 203a 7061 7461 6d20  .        :patam 
+00015de0: 656c 656d 3a20 6874 6d6c 2065 6c65 6d6e  elem: html elemn
+00015df0: 656e 7420 746f 2073 6561 7263 680a 2020  ent to search.  
+00015e00: 2020 2020 2020 3a72 6574 7572 6e3a 2073        :return: s
+00015e10: 7479 6c65 2065 6c65 6d65 6e74 7320 656c  tyle elements el
+00015e20: 7365 205b 5d20 6966 2065 6c65 6d20 6973  se [] if elem is
+00015e30: 204e 6f6e 650a 2020 2020 2020 2020 2222   None.        ""
+00015e40: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00015e50: 205b 5d20 6966 2065 6c65 6d20 6973 204e   [] if elem is N
+00015e60: 6f6e 6520 656c 7365 2065 6c65 6d2e 7870  one else elem.xp
+00015e70: 6174 6828 222f 6874 6d6c 2f68 6561 642f  ath("/html/head/
+00015e80: 7374 796c 6522 290a 0a20 2020 2040 636c  style")..    @cl
+00015e90: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00015ea0: 6620 6578 7472 6163 745f 636c 6173 7372  f extract_classr
+00015eb0: 6566 5f61 6e64 5f63 7373 7374 7269 6e67  ef_and_cssstring
+00015ec0: 5f66 726f 6d5f 7374 796c 655f 7465 7874  _from_style_text
+00015ed0: 2863 6c73 2c20 6874 6d6c 5f73 7479 6c65  (cls, html_style
+00015ee0: 5f73 7472 696e 6729 3a0a 2020 2020 2020  _string):.      
+00015ef0: 2020 2222 2270 6172 7365 7320 7465 7874    """parses text
+00015f00: 2069 6e20 6874 6d6c 203c 7374 796c 653e   in html <style>
+00015f10: 2069 6e74 6f20 636c 6173 7372 6566 2061   into classref a
+00015f20: 6e64 2063 7373 7374 7269 6e67 0a20 2020  nd cssstring.   
+00015f30: 2020 2020 206f 6e6c 7920 6f6e 6520 7374       only one st
+00015f40: 796c 6520 7065 7220 6874 6d6c 2065 6c65  yle per html ele
+00015f50: 6d65 6e74 0a20 2020 2020 2020 203a 7061  ment.        :pa
+00015f60: 7261 6d20 6874 6d6c 5f73 7479 6c65 5f73  ram html_style_s
+00015f70: 7472 696e 673a 206f 6620 666f 726d 203c  tring: of form <
+00015f80: 7365 6c65 6374 6f72 3e20 7b3c 7661 6c75  selector> {<valu
+00015f90: 653e 7d0a 2020 2020 2020 2020 3a72 6574  e>}.        :ret
+00015fa0: 7572 6e20 7365 6c65 6374 6f72 202c 2076  urn selector , v
+00015fb0: 616c 7565 0a20 2020 2020 2020 2022 2222  alue.        """
+00015fc0: 0a0a 2020 2020 2020 2020 7374 796c 655f  ..        style_
+00015fd0: 7265 203d 2072 652e 636f 6d70 696c 6528  re = re.compile(
+00015fe0: 225c 5c73 2a28 3f50 3c63 6c61 7373 7265  "\\s*(?P<classre
+00015ff0: 663e 5b5e 5c5c 735d 2a29 5c5c 732b 7b5c  f>[^\\s]*)\\s+{\
+00016000: 5c73 2a28 3f50 3c63 7373 7374 7269 6e67  \s*(?P<cssstring
+00016010: 3e2e 2a29 7d5c 5c73 2a22 290a 2020 2020  >.*)}\\s*").    
+00016020: 2020 2020 6d61 7463 6820 3d20 7374 796c      match = styl
+00016030: 655f 7265 2e6d 6174 6368 2868 746d 6c5f  e_re.match(html_
+00016040: 7374 796c 655f 7374 7269 6e67 290a 2020  style_string).  
+00016050: 2020 2020 2020 6966 206e 6f74 206d 6174        if not mat
+00016060: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
+00016070: 7265 7475 726e 204e 6f6e 652c 204e 6f6e  return None, Non
+00016080: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+00016090: 206d 6174 6368 2e67 726f 7570 2822 636c   match.group("cl
+000160a0: 6173 7372 6566 2229 2c20 6d61 7463 682e  assref"), match.
+000160b0: 6772 6f75 7028 2263 7373 7374 7269 6e67  group("cssstring
+000160c0: 2229 0a0a 2020 2020 2320 636c 6173 7320  ")..    # class 
+000160d0: 4874 6d6c 5374 796c 650a 0a20 2020 2040  HtmlStyle..    @
+000160e0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+000160f0: 6465 6620 6578 7472 6163 745f 7374 796c  def extract_styl
+00016100: 6573 5f61 6e64 5f6e 6f72 6d61 6c69 7a65  es_and_normalize
+00016110: 5f63 6c61 7373 7265 6673 2863 6c73 2c20  _classrefs(cls, 
+00016120: 6874 6d6c 5f65 6c65 6d2c 2066 6f6e 745f  html_elem, font_
+00016130: 7374 796c 6573 3d46 616c 7365 2c20 6f75  styles=False, ou
+00016140: 7464 6972 3d4e 6f6e 6529 3a0a 2020 2020  tdir=None):.    
+00016150: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00016160: 4578 7472 6163 7420 7374 796c 6573 2066  Extract styles f
+00016170: 726f 6d20 646f 6375 6d65 6e74 0a20 2020  rom document.   
+00016180: 2020 2020 206d 6f76 6520 746f 2068 6561       move to hea
+00016190: 6420 616e 6420 6e6f 726d 616c 697a 6520  d and normalize 
+000161a0: 636c 6173 7372 6566 730a 2020 2020 2020  classrefs.      
+000161b0: 2020 6465 6c65 7465 2072 6564 756e 6461    delete redunda
+000161c0: 6e74 2063 6c61 7373 7265 6673 2061 6e64  nt classrefs and
+000161d0: 2073 7479 6c65 730a 2020 2020 2020 2020   styles.        
+000161e0: 6d61 7020 646f 6375 6d65 6e74 2069 6e73  map document ins
+000161f0: 7461 6d63 6573 206f 6620 7374 796c 6573  tamces of styles
+00016200: 206f 6e74 6f20 6e6f 726d 616c 697a 6564   onto normalized
+00016210: 2063 6c61 7373 7265 6673 0a20 2020 2020   classrefs.     
+00016220: 2020 203a 7061 7261 6d20 6874 6d6c 5f65     :param html_e
+00016230: 6c65 6d3a 2068 746d 6c20 646f 6375 6d65  lem: html docume
+00016240: 6e74 2074 6f20 6e6f 726d 616c 697a 650a  nt to normalize.
+00016250: 0a20 2020 2020 2020 2053 686f 756c 6420  .        Should 
+00016260: 6265 2069 6e20 616e 206f 626a 6563 740a  be in an object.
+00016270: 2020 2020 2020 2020 544f 444f 0a53 6f6d          TODO.Som
+00016280: 6520 7370 616e 7320 6172 6520 6e6f 7420  e spans are not 
+00016290: 6a6f 696e 6564 2c20 7831 206f 6e20 6f6e  joined, x1 on on
+000162a0: 6520 7370 616e 2061 6e64 2078 3020 6f6e  e span and x0 on
+000162b0: 2066 6f6c 6c6f 7769 6e67 2061 7265 2065   following are e
+000162c0: 7175 616c 0a20 2020 2020 2020 203c 6469  qual.        <di
+000162d0: 7620 6c65 6674 3d22 3134 312e 3732 2220  v left="141.72" 
+000162e0: 7269 6768 743d 2231 3933 2e33 2220 746f  right="193.3" to
+000162f0: 703d 2236 3332 2e32 3222 3e3c 7370 616e  p="632.22"><span
+00016300: 2078 303d 2231 3431 2e37 3222 2079 303d   x0="141.72" y0=
+00016310: 2236 3332 2e32 3222 2078 313d 2231 3933  "632.22" x1="193
+00016320: 2e33 2220 7374 796c 653d 2278 303a 2031  .3" style="x0: 1
+00016330: 3431 2e37 323b 2078 313a 2031 3435 2e30  41.72; x1: 145.0
+00016340: 333b 2079 303a 2036 3332 2e32 323b 2079  3; y0: 632.22; y
+00016350: 313a 2036 3432 2e31 383b 2077 6964 7468  1: 642.18; width
+00016360: 3a20 332e 3332 3b22 2063 6c61 7373 3d22  : 3.32;" class="
+00016370: 7331 3022 3e28 6129 416e 20e2 809c 3c2f  s10">(a)An ...</
+00016380: 7370 616e 3e0a 2020 2020 2020 2020 3c73  span>.        <s
+00016390: 7061 6e20 7830 3d22 3232 342e 3034 2220  pan x0="224.04" 
+000163a0: 7930 3d22 3632 302e 3232 2220 7831 3d22  y0="620.22" x1="
+000163b0: 3338 372e 3934 2220 7374 796c 653d 2278  387.94" style="x
+000163c0: 303a 2032 3234 2e30 343b 2078 313a 2032  0: 224.04; x1: 2
+000163d0: 3239 2e30 323b 2079 303a 2036 3230 2e32  29.02; y0: 620.2
+000163e0: 323b 2079 313a 2036 3330 2e31 383b 2077  2; y1: 630.18; w
+000163f0: 6964 7468 3a20 342e 3938 3b22 2063 6c61  idth: 4.98;" cla
+00016400: 7373 3d22 7331 3022 3e70 6172 6167 7261  ss="s10">paragra
+00016410: 7068 7320 34e2 8092 362c 2074 6865 7365  phs 4...6, these
+00016420: 2072 756c 6573 2c20 6d6f 6461 6c69 7469   rules, modaliti
+00016430: 6573 2061 3c2f 7370 616e 3e0a 2020 2020  es a</span>.    
+00016440: 2020 2020 3c73 7061 6e20 7830 3d22 3338      <span x0="38
+00016450: 372e 3936 2220 7930 3d22 3632 302e 3232  7.96" y0="620.22
+00016460: 2220 7831 3d22 3438 342e 3238 2220 7374  " x1="484.28" st
+00016470: 796c 653d 2278 303a 2033 3837 2e39 363b  yle="x0: 387.96;
+00016480: 2078 313a 2033 3932 2e39 343b 2079 303a   x1: 392.94; y0:
+00016490: 2036 3230 2e32 323b 2079 313a 2036 3330   620.22; y1: 630
+000164a0: 2e31 383b 2077 6964 7468 3a20 342e 3938  .18; width: 4.98
+000164b0: 3b22 2063 6c61 7373 3d22 7331 3022 3e6e  ;" class="s10">n
+000164c0: 6420 7072 6f63 6564 7572 6573 2c20 616e  d procedures, an
+000164d0: 6420 616e 7920 6675 7274 6865 7220 7265  d any further re
+000164e0: 6c65 7661 6e74 2064 6563 6973 696f 6e73  levant decisions
+000164f0: 206f 6620 7468 6520 436f 6e66 6572 656e   of the Conferen
+00016500: 6365 206f 6620 7468 6520 5061 7274 6965  ce of the Partie
+00016510: 7320 7365 7276 696e 6720 6173 2074 6865  s serving as the
+00016520: 206d 6565 7469 6e67 206f 6620 7468 6520   meeting of the 
+00016530: 5061 7274 6965 7320 746f 2074 6865 2050  Parties to the P
+00016540: 6172 6973 2041 6772 6565 6d65 6e74 2028  aris Agreement (
+00016550: 434d 4129 3b20 3c2f 7370 616e 3e3c 2f64  CMA); </span></d
+00016560: 6976 3e0a 2020 2020 2020 2020 2222 220a  iv>.        """.
+00016570: 0a20 2020 2020 2020 2023 2068 746d 6c5f  .        # html_
+00016580: 656c 656d 203d 2068 746d 6c5f 656c 656d  elem = html_elem
+00016590: 2e78 7061 7468 2822 2f2a 2229 5b30 5d20  .xpath("/*")[0] 
+000165a0: 6966 2074 7970 6528 6874 6d6c 5f65 6c65  if type(html_ele
+000165b0: 6d29 2069 7320 5f45 6c65 6d65 6e74 5472  m) is _ElementTr
+000165c0: 6565 2065 6c73 6520 6874 6d6c 5f65 6c65  ee else html_ele
+000165d0: 6d0a 2020 2020 2020 2020 636c 732e 6578  m.        cls.ex
+000165e0: 7472 6163 745f 616c 6c5f 7374 796c 655f  tract_all_style_
+000165f0: 6174 7472 6962 7574 6573 5f74 6f5f 6865  attributes_to_he
+00016600: 6164 2868 746d 6c5f 656c 656d 290a 2020  ad(html_elem).  
+00016610: 2020 2020 2020 6966 206f 7574 6469 723a        if outdir:
+00016620: 0a20 2020 2020 2020 2020 2020 2048 746d  .            Htm
+00016630: 6c4c 6962 2e77 7269 7465 5f68 746d 6c5f  lLib.write_html_
+00016640: 6669 6c65 2868 746d 6c5f 656c 656d 2c20  file(html_elem, 
+00016650: 5061 7468 286f 7574 6469 722c 2022 7374  Path(outdir, "st
+00016660: 796c 6573 312e 6874 6d6c 2229 2c20 6465  yles1.html"), de
+00016670: 6275 673d 5472 7565 290a 2020 2020 2020  bug=True).      
+00016680: 2020 7374 796c 655f 746f 5f63 6c61 7373    style_to_class
+00016690: 7265 665f 7365 7420 3d20 636c 732e 6e6f  ref_set = cls.no
+000166a0: 726d 616c 697a 655f 6865 6164 5f73 7479  rmalize_head_sty
+000166b0: 6c65 7328 6874 6d6c 5f65 6c65 6d2c 206f  les(html_elem, o
+000166c0: 7574 6469 723d 6f75 7464 6972 290a 2020  utdir=outdir).  
+000166d0: 2020 2020 2020 636c 6173 7372 6566 5f69        classref_i
+000166e0: 6e64 6578 203d 2063 6c73 2e63 7265 6174  ndex = cls.creat
+000166f0: 655f 636c 6173 7372 6566 5f69 6e64 6578  e_classref_index
+00016700: 2873 7479 6c65 5f74 6f5f 636c 6173 7372  (style_to_classr
+00016710: 6566 5f73 6574 290a 2020 2020 2020 2020  ef_set).        
+00016720: 6465 6c65 7461 626c 655f 636c 6173 7372  deletable_classr
+00016730: 6566 7320 3d20 636c 732e 6765 745f 7265  efs = cls.get_re
+00016740: 6475 6e64 616e 745f 636c 6173 7372 6566  dundant_classref
+00016750: 7328 636c 6173 7372 6566 5f69 6e64 6578  s(classref_index
+00016760: 290a 2020 2020 2020 2020 636c 732e 6465  ).        cls.de
+00016770: 6c65 7465 5f72 6564 756e 6461 6e74 5f73  lete_redundant_s
+00016780: 7479 6c65 7328 6465 6c65 7461 626c 655f  tyles(deletable_
+00016790: 636c 6173 7372 6566 732c 2068 746d 6c5f  classrefs, html_
+000167a0: 656c 656d 290a 2020 2020 2020 2020 636c  elem).        cl
+000167b0: 732e 6e6f 726d 616c 697a 655f 636c 6173  s.normalize_clas
+000167c0: 7372 6566 735f 6f6e 5f65 6c65 6d65 6e74  srefs_on_element
+000167d0: 7328 6874 6d6c 5f65 6c65 6d2c 2063 6c61  s(html_elem, cla
+000167e0: 7373 7265 665f 696e 6465 7829 0a20 2020  ssref_index).   
+000167f0: 2020 2020 2069 6620 666f 6e74 5f73 7479       if font_sty
+00016800: 6c65 733a 0a20 2020 2020 2020 2020 2020  les:.           
+00016810: 2063 6c73 2e63 7265 6174 655f 6162 6272   cls.create_abbr
+00016820: 6576 6961 7465 645f 666f 6e74 5f73 7479  eviated_font_sty
+00016830: 6c65 7328 6874 6d6c 5f65 6c65 6d29 0a0a  les(html_elem)..
+00016840: 2020 2020 2320 636c 6173 7320 4874 6d6c      # class Html
+00016850: 5374 796c 650a 0a20 2020 2040 636c 6173  Style..    @clas
+00016860: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00016870: 6e6f 726d 616c 697a 655f 636c 6173 7372  normalize_classr
+00016880: 6566 735f 6f6e 5f65 6c65 6d65 6e74 7328  efs_on_elements(
+00016890: 636c 732c 2068 746d 6c5f 656c 656d 2c20  cls, html_elem, 
+000168a0: 636c 6173 7372 6566 5f69 6e64 6578 293a  classref_index):
+000168b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000168c0: 2020 2020 2046 696e 6473 2061 6c6c 2065       Finds all e
+000168d0: 6c6d 656e 7473 2077 6974 6820 4063 6c61  lments with @cla
+000168e0: 7373 2061 7474 7269 6275 7465 2061 6e64  ss attribute and
+000168f0: 206e 6f72 6d61 6c69 7a65 2074 6f20 6d69   normalize to mi
+00016900: 6e69 6d61 6c20 7365 740a 2020 2020 2020  nimal set.      
+00016910: 2020 2222 220a 2020 2020 2020 2020 636c    """.        cl
+00016920: 6173 7365 645f 656c 656d 7320 3d20 6874  assed_elems = ht
+00016930: 6d6c 5f65 6c65 6d2e 7870 6174 6828 222f  ml_elem.xpath("/
+00016940: 2f2a 5b40 636c 6173 735d 2229 0a20 2020  /*[@class]").   
+00016950: 2020 2020 2066 6f72 2063 6c61 7373 6564       for classed
+00016960: 5f65 6c65 6d20 696e 2063 6c61 7373 6564  _elem in classed
+00016970: 5f65 6c65 6d73 3a0a 2020 2020 2020 2020  _elems:.        
+00016980: 2020 2020 6874 6d6c 5f63 6c61 7373 203d      html_class =
+00016990: 2048 746d 6c43 6c61 7373 2e63 7265 6174   HtmlClass.creat
+000169a0: 655f 6672 6f6d 5f63 6c61 7373 6564 5f65  e_from_classed_e
+000169b0: 6c65 6d65 6e74 2863 6c61 7373 6564 5f65  lement(classed_e
+000169c0: 6c65 6d29 0a20 2020 2020 2020 2020 2020  lem).           
+000169d0: 2063 6c61 7373 7265 6620 3d20 6874 6d6c   classref = html
+000169e0: 5f63 6c61 7373 2e63 7265 6174 655f 636c  _class.create_cl
+000169f0: 6173 7372 6566 2829 0a20 2020 2020 2020  assref().       
+00016a00: 2020 2020 206e 6f72 6d61 6c69 7a65 645f       normalized_
+00016a10: 636c 6173 7372 6566 203d 2048 746d 6c43  classref = HtmlC
+00016a20: 6c61 7373 2e72 656d 6f76 655f 646f 7428  lass.remove_dot(
+00016a30: 636c 6173 7372 6566 5f69 6e64 6578 2e67  classref_index.g
+00016a40: 6574 2863 6c61 7373 7265 6629 290a 2020  et(classref)).  
+00016a50: 2020 2020 2020 2020 2020 636c 6173 7372            classr
+00016a60: 6566 203d 2048 746d 6c43 6c61 7373 2e72  ef = HtmlClass.r
+00016a70: 656d 6f76 655f 646f 7428 636c 6173 7372  emove_dot(classr
+00016a80: 6566 290a 2020 2020 2020 2020 2020 2020  ef).            
+00016a90: 6966 206e 6f72 6d61 6c69 7a65 645f 636c  if normalized_cl
+00016aa0: 6173 7372 6566 2021 3d20 636c 6173 7372  assref != classr
+00016ab0: 6566 3a0a 2020 2020 2020 2020 2020 2020  ef:.            
+00016ac0: 2020 2020 6874 6d6c 5f63 6c61 7373 2e72      html_class.r
+00016ad0: 6570 6c61 6365 5f63 6c61 7373 2863 6c61  eplace_class(cla
+00016ae0: 7373 7265 662c 206e 6f72 6d61 6c69 7a65  ssref, normalize
+00016af0: 645f 636c 6173 7372 6566 290a 2020 2020  d_classref).    
+00016b00: 2020 2020 2020 2020 2020 2020 6966 2068              if h
+00016b10: 746d 6c5f 636c 6173 732e 636c 6173 735f  tml_class.class_
+00016b20: 7374 7269 6e67 3a0a 2020 2020 2020 2020  string:.        
+00016b30: 2020 2020 2020 2020 2020 2020 4874 6d6c              Html
+00016b40: 436c 6173 732e 7365 745f 636c 6173 735f  Class.set_class_
+00016b50: 6f6e 5f65 6c65 6d65 6e74 2863 6c61 7373  on_element(class
+00016b60: 6564 5f65 6c65 6d2c 2068 746d 6c5f 636c  ed_elem, html_cl
+00016b70: 6173 732e 636c 6173 735f 7374 7269 6e67  ass.class_string
+00016b80: 290a 0a20 2020 2023 2063 6c61 7373 2048  )..    # class H
+00016b90: 746d 6c53 7479 6c65 0a0a 2020 2020 4063  tmlStyle..    @c
+00016ba0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00016bb0: 6566 2064 656c 6574 655f 7265 6475 6e64  ef delete_redund
+00016bc0: 616e 745f 7374 796c 6573 2863 6c73 2c20  ant_styles(cls, 
+00016bd0: 6465 6c65 7461 626c 655f 636c 6173 7372  deletable_classr
+00016be0: 6566 732c 2068 746d 6c5f 656c 656d 293a  efs, html_elem):
+00016bf0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00016c00: 2020 2020 2064 656c 6574 6573 2072 6564       deletes red
+00016c10: 756e 6461 6e74 203c 7374 796c 653e 7320  undant <style>s 
+00016c20: 696e 2068 6561 640a 2020 2020 2020 2020  in head.        
+00016c30: 2222 220a 2020 2020 2020 2020 7374 796c  """.        styl
+00016c40: 6573 5f77 6974 685f 636c 6173 7372 6566  es_with_classref
+00016c50: 7320 3d20 6874 6d6c 5f65 6c65 6d2e 7870  s = html_elem.xp
+00016c60: 6174 6828 222f 6874 6d6c 2f68 6561 642f  ath("/html/head/
+00016c70: 7374 796c 655b 4063 6c61 7373 7265 665d  style[@classref]
+00016c80: 2229 0a20 2020 2020 2020 2066 6f72 2073  ").        for s
+00016c90: 7479 6c65 2069 6e20 7374 796c 6573 5f77  tyle in styles_w
+00016ca0: 6974 685f 636c 6173 7372 6566 733a 0a20  ith_classrefs:. 
+00016cb0: 2020 2020 2020 2020 2020 2063 6c61 7373             class
+00016cc0: 7265 6620 3d20 7374 796c 652e 6174 7472  ref = style.attr
+00016cd0: 6962 2e67 6574 2843 4c41 5353 5245 4629  ib.get(CLASSREF)
+00016ce0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016cf0: 636c 6173 7372 6566 2069 6e20 6465 6c65  classref in dele
+00016d00: 7461 626c 655f 636c 6173 7372 6566 733a  table_classrefs:
+00016d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016d20: 2058 6d6c 4c69 622e 7265 6d6f 7665 5f65   XmlLib.remove_e
+00016d30: 6c65 6d65 6e74 2873 7479 6c65 290a 0a20  lement(style).. 
+00016d40: 2020 2023 2063 6c61 7373 2048 746d 6c53     # class HtmlS
+00016d50: 7479 6c65 0a0a 2020 2020 4063 6c61 7373  tyle..    @class
+00016d60: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
+00016d70: 6574 5f72 6564 756e 6461 6e74 5f63 6c61  et_redundant_cla
+00016d80: 7373 7265 6673 2863 6c73 2c20 636c 6173  ssrefs(cls, clas
+00016d90: 7372 6566 5f69 6e64 6578 293a 0a20 2020  sref_index):.   
+00016da0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00016db0: 206d 616b 6573 206c 6973 7420 6f66 2072   makes list of r
+00016dc0: 6564 756e 6461 6e74 2063 6c61 7373 7265  edundant classre
+00016dd0: 6673 0a20 2020 2020 2020 203a 7061 7261  fs.        :para
+00016de0: 6d20 636c 6173 7372 6566 5f69 6e64 6578  m classref_index
+00016df0: 3a20 6469 6374 696f 6e61 7279 206d 6170  : dictionary map
+00016e00: 7069 6e67 2063 6c61 7373 7265 6673 206f  ping classrefs o
+00016e10: 6e74 6f20 6e6f 726d 616c 697a 6564 2063  nto normalized c
+00016e20: 6c61 7373 7265 660a 2020 2020 2020 2020  lassref.        
+00016e30: 3a72 6574 7572 6e3a 206c 6973 7420 6f66  :return: list of
+00016e40: 2072 6564 756e 6461 6e74 2063 6c61 7373   redundant class
+00016e50: 7265 6673 0a20 2020 2020 2020 2022 2222  refs.        """
+00016e60: 0a20 2020 2020 2020 2072 6564 756e 6461  .        redunda
+00016e70: 6e74 5f63 6c61 7373 7265 6673 203d 205b  nt_classrefs = [
+00016e80: 5d0a 2020 2020 2020 2020 666f 7220 6974  ].        for it
+00016e90: 656d 2069 6e20 636c 6173 7372 6566 5f69  em in classref_i
+00016ea0: 6e64 6578 2e69 7465 6d73 2829 3a0a 2020  ndex.items():.  
+00016eb0: 2020 2020 2020 2020 2020 6966 2069 7465            if ite
+00016ec0: 6d5b 305d 2021 3d20 6974 656d 5b31 5d3a  m[0] != item[1]:
+00016ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016ee0: 2072 6564 756e 6461 6e74 5f63 6c61 7373   redundant_class
+00016ef0: 7265 6673 2e61 7070 656e 6428 6974 656d  refs.append(item
+00016f00: 5b30 5d29 0a20 2020 2020 2020 2072 6574  [0]).        ret
+00016f10: 7572 6e20 7265 6475 6e64 616e 745f 636c  urn redundant_cl
+00016f20: 6173 7372 6566 730a 0a20 2020 2023 2063  assrefs..    # c
+00016f30: 6c61 7373 2048 746d 6c53 7479 6c65 0a0a  lass HtmlStyle..
+00016f40: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00016f50: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
+00016f60: 636c 6173 7372 6566 5f69 6e64 6578 2863  classref_index(c
+00016f70: 6c73 2c20 7374 796c 655f 746f 5f63 6c61  ls, style_to_cla
+00016f80: 7373 7265 665f 7365 7429 3a0a 2020 2020  ssref_set):.    
+00016f90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00016fa0: 6d61 7073 2061 6c6c 2069 7465 6d73 2069  maps all items i
+00016fb0: 6e20 636c 6173 7372 6566 2073 6574 7320  n classref sets 
+00016fc0: 6f6e 746f 2028 6172 6269 7472 6172 696c  onto (arbitraril
+00016fd0: 7929 2074 6865 2066 6972 7374 0a20 2020  y) the first.   
+00016fe0: 2020 2020 203a 7061 7261 6d20 7374 796c       :param styl
+00016ff0: 655f 746f 5f63 6c61 7373 7265 665f 7365  e_to_classref_se
+00017000: 743a 2063 6c61 7373 7265 665f 7365 7473  t: classref_sets
+00017010: 206d 6d61 7070 6564 2062 7920 7374 796c   mmapped by styl
+00017020: 6520 7661 6c75 650a 2020 2020 2020 2020  e value.        
+00017030: 3a72 6574 7572 6e3a 6469 6374 206d 6170  :return:dict map
+00017040: 7069 6e67 2072 6564 756e 6461 6e74 2063  ping redundant c
+00017050: 6c61 7373 7265 6673 206f 6e74 6f20 6e6f  lassrefs onto no
+00017060: 726d 616c 697a 6564 2063 6c61 7373 7265  rmalized classre
+00017070: 660a 2020 2020 2020 2020 4d61 7920 6265  f.        May be
+00017080: 6e65 6669 7420 6672 6f6d 2062 6569 6e67  nefit from being
+00017090: 2069 6e20 6120 636c 6173 730a 2020 2020   in a class.    
+000170a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000170b0: 636c 6173 7372 6566 5f69 6e64 6578 203d  classref_index =
+000170c0: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
+000170d0: 666f 7220 6974 656d 2069 6e20 7374 796c  for item in styl
+000170e0: 655f 746f 5f63 6c61 7373 7265 665f 7365  e_to_classref_se
+000170f0: 742e 6974 656d 7328 293a 0a20 2020 2020  t.items():.     
+00017100: 2020 2020 2020 2063 6c61 7373 7265 665f         classref_
+00017110: 6c69 7374 203d 206c 6973 7428 736f 7274  list = list(sort
+00017120: 6564 2869 7465 6d5b 315d 2929 0a20 2020  ed(item[1])).   
+00017130: 2020 2020 2020 2020 2063 6c61 7373 7265           classre
+00017140: 6630 203d 206c 6973 7428 636c 6173 7372  f0 = list(classr
+00017150: 6566 5f6c 6973 7429 5b30 5d0a 2020 2020  ef_list)[0].    
+00017160: 2020 2020 2020 2020 666f 7220 636c 6173          for clas
+00017170: 7372 6566 2069 6e20 636c 6173 7372 6566  sref in classref
+00017180: 5f6c 6973 743a 0a20 2020 2020 2020 2020  _list:.         
+00017190: 2020 2020 2020 2063 6c61 7373 7265 665f         classref_
+000171a0: 696e 6465 785b 636c 6173 7372 6566 5d20  index[classref] 
+000171b0: 3d20 636c 6173 7372 6566 300a 2020 2020  = classref0.    
+000171c0: 2020 2020 7265 7475 726e 2063 6c61 7373      return class
+000171d0: 7265 665f 696e 6465 780a 0a20 2020 2023  ref_index..    #
+000171e0: 2063 6c61 7373 2048 746d 6c53 7479 6c65   class HtmlStyle
+000171f0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00017200: 6f64 0a20 2020 2064 6566 2061 6464 5f68  od.    def add_h
+00017210: 6561 645f 7374 796c 6573 5f6f 7269 6728  ead_styles_orig(
+00017220: 636c 732c 2068 746d 6c5f 656c 656d 2c20  cls, html_elem, 
+00017230: 7374 796c 6573 2c20 6e6f 726d 616c 697a  styles, normaliz
+00017240: 655f 666f 6e74 3d54 7275 6529 3a0a 2020  e_font=True):.  
+00017250: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00017260: 2020 7468 6973 2069 7320 6372 7564 650a    this is crude.
+00017270: 2020 2020 2020 2020 2773 7479 6c65 206f          'style o
+00017280: 6620 666f 726d 0a20 2020 2020 2020 2020  f form.         
+00017290: 2020 2022 6469 7622 2c20 5b28 2262 6f72     "div", [("bor
+000172a0: 6465 7222 2c20 2272 6564 2073 6f6c 6964  der", "red solid
+000172b0: 2030 2e35 7078 2229 2c20 2822 6261 636b   0.5px"), ("back
+000172c0: 6772 6f75 6e64 222c 2022 7965 6c6c 6f77  ground", "yellow
+000172d0: 295d 290a 2020 2020 2020 2020 2222 220a  )]).        """.
+000172e0: 2020 2020 2020 2020 666f 7220 7374 796c          for styl
+000172f0: 6520 696e 2073 7479 6c65 733a 0a20 2020  e in styles:.   
+00017300: 2020 2020 2020 2020 2023 2070 7269 6e74           # print
+00017310: 2866 2273 7479 6c65 207b 7374 796c 657d  (f"style {style}
+00017320: 2229 0a20 2020 2020 2020 2020 2020 2048  ").            H
+00017330: 746d 6c4c 6962 2e61 6464 5f68 6561 645f  tmlLib.add_head_
+00017340: 7374 796c 6528 6874 6d6c 5f65 6c65 6d2c  style(html_elem,
+00017350: 2073 7479 6c65 5b30 5d2c 2073 7479 6c65   style[0], style
+00017360: 5b31 5d29 0a0a 2020 2020 4063 6c61 7373  [1])..    @class
+00017370: 6d65 7468 6f64 0a20 2020 2064 6566 2061  method.    def a
+00017380: 6464 5f68 6561 645f 7374 796c 6573 2863  dd_head_styles(c
+00017390: 6c73 2c20 6874 6d6c 5f65 6c65 6d2c 2073  ls, html_elem, s
+000173a0: 7479 6c65 5f74 6578 7473 2c20 6e6f 726d  tyle_texts, norm
+000173b0: 616c 697a 655f 666f 6e74 3d54 7275 6529  alize_font=True)
+000173c0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000173d0: 2020 2020 2020 6164 6473 2074 6578 7420        adds text 
+000173e0: 6f66 2066 6f72 6d0a 2020 2020 2020 2020  of form.        
+000173f0: 6c6f 6361 746f 7220 6373 730a 2020 2020  locator css.    
+00017400: 2020 2020 652e 672e 2073 7061 6e2e 7465      e.g. span.te
+00017410: 6d70 207b 6261 636b 6772 6f75 6e64 3a20  mp {background: 
+00017420: 7265 643b 2066 6f6e 742d 7369 7a65 3a20  red; font-size: 
+00017430: 3132 7078 3b7d 0a20 2020 2020 2020 2022  12px;}.        "
+00017440: 2222 0a20 2020 2020 2020 2068 746d 6c5f  "".        html_
+00017450: 6865 6164 203d 2048 746d 6c4c 6962 2e67  head = HtmlLib.g
+00017460: 6574 5f68 6561 6428 6874 6d6c 5f65 6c65  et_head(html_ele
+00017470: 6d29 0a20 2020 2020 2020 2066 6f72 2073  m).        for s
+00017480: 7479 6c65 5f74 2069 6e20 7374 796c 655f  tyle_t in style_
+00017490: 7465 7874 733a 0a20 2020 2020 2020 2020  texts:.         
+000174a0: 2020 2073 7479 6c65 203d 2045 542e 5375     style = ET.Su
+000174b0: 6245 6c65 6d65 6e74 2868 746d 6c5f 6865  bElement(html_he
+000174c0: 6164 2c20 2273 7479 6c65 2229 0a20 2020  ad, "style").   
+000174d0: 2020 2020 2020 2020 2073 7479 6c65 2e74           style.t
+000174e0: 6578 7420 3d20 7374 796c 655f 740a 0a23  ext = style_t..#
+000174f0: 2054 4f44 4f0a 2320 6372 6561 7465 5f66   TODO.# create_f
+00017500: 6f6e 745f 6564 6974 6564 5f73 7479 6c65  ont_edited_style
+00017510: 5f66 726f 6d5f 6373 735f 7374 796c 655f  _from_css_style_
+00017520: 6f62 6a65 6374 0a0a 2020 2020 4063 6c61  object..    @cla
+00017530: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00017540: 2074 7261 6e73 6665 725f 6865 6164 5f73   transfer_head_s
+00017550: 7479 6c65 7328 636c 732c 2068 746d 6c5f  tyles(cls, html_
+00017560: 656c 656d 2c20 6e65 775f 6874 6d6c 293a  elem, new_html):
+00017570: 0a20 2020 2020 2020 2022 2222 636f 7069  .        """copi
+00017580: 6573 2068 746d 6c2f 6865 6164 2f22 2222  es html/head/"""
+00017590: 0a20 2020 2020 2020 206e 6577 5f73 7479  .        new_sty
+000175a0: 6c65 5f65 6c65 6d20 3d20 4874 6d6c 4772  le_elem = HtmlGr
+000175b0: 6f75 702e 6372 6561 7465 5f68 6561 645f  oup.create_head_
+000175c0: 7374 796c 655f 656c 656d 286e 6577 5f68  style_elem(new_h
+000175d0: 746d 6c2c 2074 6169 6c3d 225c 6e22 290a  tml, tail="\n").
+000175e0: 2020 2020 2020 2020 7374 796c 6573 203d          styles =
+000175f0: 2048 746d 6c53 7479 6c65 2e67 6574 5f68   HtmlStyle.get_h
+00017600: 6561 645f 7374 796c 6573 2868 746d 6c5f  ead_styles(html_
+00017610: 656c 656d 290a 2020 2020 2020 2020 666f  elem).        fo
+00017620: 7220 7374 796c 6520 696e 2073 7479 6c65  r style in style
+00017630: 733a 0a20 2020 2020 2020 2020 2020 206e  s:.            n
+00017640: 6577 5f73 7479 6c65 5f65 6c65 6d2e 6765  ew_style_elem.ge
+00017650: 7470 6172 656e 7428 292e 6170 7065 6e64  tparent().append
+00017660: 2863 6f70 792e 6465 6570 636f 7079 2873  (copy.deepcopy(s
+00017670: 7479 6c65 2929 0a0a 2020 2020 4063 6c61  tyle))..    @cla
+00017680: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
+00017690: 2065 7874 7261 6374 5f63 6c61 7373 7265   extract_classre
+000176a0: 665f 616e 645f 6373 7373 7472 696e 675f  f_and_cssstring_
+000176b0: 6672 6f6d 5f68 746d 6c5f 7374 796c 6528  from_html_style(
+000176c0: 636c 732c 2068 746d 6c5f 7374 796c 655f  cls, html_style_
+000176d0: 656c 656d 293a 0a20 2020 2020 2020 2069  elem):.        i
+000176e0: 6620 6874 6d6c 5f73 7479 6c65 5f65 6c65  f html_style_ele
+000176f0: 6d20 6973 204e 6f6e 653a 0a20 2020 2020  m is None:.     
+00017700: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
+00017710: 6e65 2c20 4e6f 6e65 0a20 2020 2020 2020  ne, None.       
+00017720: 2072 6574 7572 6e20 636c 732e 6578 7472   return cls.extr
+00017730: 6163 745f 636c 6173 7372 6566 5f61 6e64  act_classref_and
+00017740: 5f63 7373 7374 7269 6e67 5f66 726f 6d5f  _cssstring_from_
+00017750: 7374 796c 655f 7465 7874 2868 746d 6c5f  style_text(html_
+00017760: 7374 796c 655f 656c 656d 2e74 6578 7429  style_elem.text)
+00017770: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00017780: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
+00017790: 655f 636c 6173 7372 6566 5f63 7373 7374  e_classref_cssst
+000177a0: 7269 6e67 5f74 6162 6c65 2863 6c73 2c20  ring_table(cls, 
+000177b0: 6874 6d6c 5f73 7479 6c65 7329 3a0a 2020  html_styles):.  
+000177c0: 2020 2020 2020 7461 626c 6520 3d20 5b5d        table = []
+000177d0: 0a20 2020 2020 2020 2066 6f72 2068 746d  .        for htm
+000177e0: 6c5f 7374 796c 6520 696e 2068 746d 6c5f  l_style in html_
+000177f0: 7374 796c 6573 3a0a 2020 2020 2020 2020  styles:.        
+00017800: 2020 2020 7461 626c 652e 6170 7065 6e64      table.append
+00017810: 2848 746d 6c53 7479 6c65 2e65 7874 7261  (HtmlStyle.extra
+00017820: 6374 5f63 6c61 7373 7265 665f 616e 645f  ct_classref_and_
+00017830: 6373 7373 7472 696e 675f 6672 6f6d 5f68  cssstring_from_h
+00017840: 746d 6c5f 7374 796c 6528 6874 6d6c 5f73  tml_style(html_s
+00017850: 7479 6c65 2929 0a20 2020 2020 2020 2072  tyle)).        r
+00017860: 6574 7572 6e20 7461 626c 650a 0a20 2020  eturn table..   
+00017870: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00017880: 2020 6465 6620 7265 706c 6163 655f 6375    def replace_cu
+00017890: 726c 7928 636c 732c 2065 6c65 6d2c 206e  rly(cls, elem, n
+000178a0: 6577 5f63 7572 6c79 293a 0a20 2020 2020  ew_curly):.     
+000178b0: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+000178c0: 6570 6c61 6365 2063 6f6e 7465 6e74 7320  eplace contents 
+000178d0: 6f66 207b 2e2e 2e7d 0a20 2020 2020 2020  of {...}.       
+000178e0: 203a 7061 7261 6d20 656c 656d 3a20 6874   :param elem: ht
+000178f0: 6d6c 203c 7374 796c 653e 2065 6c65 6d65  ml <style> eleme
+00017900: 6e74 0a20 2020 2020 2020 203a 7061 7261  nt.        :para
+00017910: 6d20 656c 656d 3a20 6e65 7720 636f 6e74  m elem: new cont
+00017920: 656e 740a 2020 2020 2020 2020 2222 220a  ent.        """.
+00017930: 0a20 2020 2020 2020 2069 6620 656c 656d  .        if elem
+00017940: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00017950: 2020 2020 2020 2020 2020 6d61 7463 6820            match 
+00017960: 3d20 5354 594c 455f 4355 524c 595f 5245  = STYLE_CURLY_RE
+00017970: 2e6d 6174 6368 2865 6c65 6d2e 7465 7874  .match(elem.text
+00017980: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00017990: 206d 6174 6368 3a0a 2020 2020 2020 2020   match:.        
+000179a0: 2020 2020 2020 2020 6e65 775f 7465 7874          new_text
+000179b0: 203d 206d 6174 6368 2e67 726f 7570 2822   = match.group("
+000179c0: 7072 6522 2920 2b20 6e65 775f 6375 726c  pre") + new_curl
+000179d0: 7920 2b20 6d61 7463 682e 6772 6f75 7028  y + match.group(
+000179e0: 2270 6f73 7422 290a 2020 2020 2020 2020  "post").        
+000179f0: 2020 2020 2020 2020 656c 656d 2e74 6578          elem.tex
+00017a00: 7420 3d20 6e65 775f 7465 7874 0a0a 2020  t = new_text..  
+00017a10: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00017a20: 2020 2064 6566 206c 6f6f 6b75 705f 6865     def lookup_he
+00017a30: 6164 5f73 7479 6c65 5f62 795f 636c 6173  ad_style_by_clas
+00017a40: 7372 6566 2863 6c73 2c20 656c 656d 293a  sref(cls, elem):
+00017a50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00017a60: 2020 2020 203a 7061 7261 6d20 656c 656d       :param elem
+00017a70: 3a20 656c 656d 656e 7473 2077 6974 6820  : elements with 
+00017a80: 4063 6c61 7373 2061 7474 7269 6275 7465  @class attribute
+00017a90: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+00017aa0: 3a20 4353 5353 7479 6c65 206f 626a 6563  : CSSStyle objec
+00017ab0: 7420 7769 7468 2048 746d 6c53 7479 6c65  t with HtmlStyle
+00017ac0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00017ad0: 2020 2020 2063 6c61 7a7a 203d 2065 6c65       clazz = ele
+00017ae0: 6d2e 6765 7428 2263 6c61 7373 2229 0a20  m.get("class"). 
+00017af0: 2020 2020 2020 2063 7373 5f73 7479 6c65         css_style
+00017b00: 203d 2048 746d 6c53 7479 6c65 2e6c 6f6f   = HtmlStyle.loo
+00017b10: 6b75 705f 6865 6164 5f73 7479 6c65 5f62  kup_head_style_b
+00017b20: 795f 636c 6173 7328 656c 656d 2c20 636c  y_class(elem, cl
+00017b30: 617a 7a29 0a20 2020 2020 2020 2072 6574  azz).        ret
+00017b40: 7572 6e20 6373 735f 7374 796c 650a 0a20  urn css_style.. 
+00017b50: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00017b60: 2020 2020 6465 6620 6c6f 6f6b 7570 5f68      def lookup_h
+00017b70: 6561 645f 7374 796c 655f 6279 5f63 6c61  ead_style_by_cla
+00017b80: 7373 2863 6c73 2c20 6874 6d6c 2c20 636c  ss(cls, html, cl
+00017b90: 617a 7a29 3a0a 2020 2020 2020 2020 2222  azz):.        ""
+00017ba0: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
+00017bb0: 2068 746d 6c3a 2048 544d 4c20 656c 656d   html: HTML elem
+00017bc0: 656e 7420 7769 7468 2068 6561 642f 7374  ent with head/st
+00017bd0: 796c 650a 2020 2020 2020 2020 3a70 6172  yle.        :par
+00017be0: 616d 2063 6c61 7a7a 3a20 636c 6173 7320  am clazz: class 
+00017bf0: 746f 2072 6574 6972 7665 2073 7479 6c65  to retirve style
+00017c00: 2065 6c65 6d65 6e74 0a20 2020 2020 2020   element.       
+00017c10: 2022 2222 0a20 2020 2020 2020 2073 7479   """.        sty
+00017c20: 6c65 7320 3d20 6874 6d6c 2e78 7061 7468  les = html.xpath
+00017c30: 2866 222f 6874 6d6c 2f68 6561 642f 7374  (f"/html/head/st
+00017c40: 796c 655b 636f 6e74 6169 6e73 282e 2c27  yle[contains(.,'
+00017c50: 2e7b 636c 617a 7a7d 2027 295d 2229 0a20  .{clazz} ')]"). 
+00017c60: 2020 2020 2020 2069 6620 6c65 6e28 7374         if len(st
+00017c70: 796c 6573 2920 3d3d 2030 3a0a 2020 2020  yles) == 0:.    
+00017c80: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+00017c90: 6e6f 2073 7479 6c65 7320 666f 7220 7b63  no styles for {c
+00017ca0: 6c61 7a7a 7d22 290a 2020 2020 2020 2020  lazz}").        
+00017cb0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+00017cc0: 2020 2020 2020 2020 6865 6164 5f73 7479          head_sty
+00017cd0: 6c65 203d 2073 7479 6c65 735b 305d 0a20  le = styles[0]. 
+00017ce0: 2020 2020 2020 205f 2c20 6373 735f 7374         _, css_st
+00017cf0: 796c 6520 3d20 4353 5353 7479 6c65 2e63  yle = CSSStyle.c
+00017d00: 7265 6174 655f 6373 735f 7374 796c 655f  reate_css_style_
+00017d10: 6672 6f6d 5f68 746d 6c5f 6865 6164 5f73  from_html_head_s
+00017d20: 7479 6c65 5f65 6c65 6d28 6865 6164 5f73  tyle_elem(head_s
+00017d30: 7479 6c65 290a 2020 2020 2020 2020 7265  tyle).        re
+00017d40: 7475 726e 2063 7373 5f73 7479 6c65 0a0a  turn css_style..
+00017d50: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
+00017d60: 0a20 2020 2064 6566 2069 735f 626f 6c64  .    def is_bold
+00017d70: 2863 6c73 2c20 656c 656d 293a 0a20 2020  (cls, elem):.   
+00017d80: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00017d90: 2066 696e 6473 2040 636c 6173 7320 696e   finds @class in
+00017da0: 2065 6c65 6d20 616e 6420 6c6f 6f6b 7320   elem and looks 
+00017db0: 7570 2073 7479 6c65 2069 6e20 6874 6d6c  up style in html
+00017dc0: 2f68 6561 640a 2020 2020 2020 2020 2222  /head.        ""
+00017dd0: 220a 2020 2020 2020 2020 6966 2065 6c65  ".        if ele
+00017de0: 6d20 6973 204e 6f6e 653a 0a20 2020 2020  m is None:.     
+00017df0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
+00017e00: 6c73 650a 2020 2020 2020 2020 6373 735f  lse.        css_
+00017e10: 7374 796c 6520 3d20 4874 6d6c 5374 796c  style = HtmlStyl
+00017e20: 652e 6c6f 6f6b 7570 5f68 6561 645f 7374  e.lookup_head_st
+00017e30: 796c 655f 6279 5f63 6c61 7373 7265 6628  yle_by_classref(
+00017e40: 656c 656d 290a 2020 2020 2020 2020 6966  elem).        if
+00017e50: 206e 6f74 2063 7373 5f73 7479 6c65 3a0a   not css_style:.
+00017e60: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00017e70: 7428 6622 6e6f 2073 7479 6c65 2072 6573  t(f"no style res
+00017e80: 6f6c 7665 6420 666f 7220 7b45 542e 746f  olved for {ET.to
+00017e90: 7374 7269 6e67 2865 6c65 6d29 7d22 290a  string(elem)}").
+00017ea0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00017eb0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
+00017ec0: 2072 6574 7572 6e20 6373 735f 7374 796c   return css_styl
+00017ed0: 652e 6973 5f62 6f6c 640a 0a20 2020 2040  e.is_bold..    @
+00017ee0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00017ef0: 6465 6620 6973 5f69 7461 6c69 6328 636c  def is_italic(cl
+00017f00: 732c 2065 6c65 6d29 3a0a 2020 2020 2020  s, elem):.      
+00017f10: 2020 2222 220a 2020 2020 2020 2020 6669    """.        fi
+00017f20: 6e64 7320 4063 6c61 7373 2069 6e20 656c  nds @class in el
+00017f30: 656d 2061 6e64 206c 6f6f 6b73 2075 7020  em and looks up 
+00017f40: 7374 796c 6520 696e 2068 746d 6c2f 6865  style in html/he
+00017f50: 6164 0a20 2020 2020 2020 2022 2222 0a20  ad.        """. 
+00017f60: 2020 2020 2020 2069 6620 656c 656d 2069         if elem i
+00017f70: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00017f80: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+00017f90: 0a20 2020 2020 2020 2063 7373 5f73 7479  .        css_sty
+00017fa0: 6c65 203d 2048 746d 6c53 7479 6c65 2e6c  le = HtmlStyle.l
+00017fb0: 6f6f 6b75 705f 6865 6164 5f73 7479 6c65  ookup_head_style
+00017fc0: 5f62 795f 636c 6173 7372 6566 2865 6c65  _by_classref(ele
+00017fd0: 6d29 0a20 2020 2020 2020 2069 6620 6e6f  m).        if no
+00017fe0: 7420 6373 735f 7374 796c 653a 0a20 2020  t css_style:.   
+00017ff0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
+00018000: 226e 6f20 7374 796c 6520 7265 736f 6c76  "no style resolv
+00018010: 6564 2066 6f72 207b 4554 2e74 6f73 7472  ed for {ET.tostr
+00018020: 696e 6728 656c 656d 297d 2229 0a20 2020  ing(elem)}").   
+00018030: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00018040: 4661 6c73 650a 2020 2020 2020 2020 7265  False.        re
+00018050: 7475 726e 2063 7373 5f73 7479 6c65 2e69  turn css_style.i
+00018060: 735f 6974 616c 6963 0a0a 2020 2020 4063  s_italic..    @c
+00018070: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00018080: 6566 2067 6574 5f62 6f64 795f 636c 6173  ef get_body_clas
+00018090: 7372 6566 7328 636c 732c 2068 746d 6c5f  srefs(cls, html_
+000180a0: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
+000180b0: 2222 7365 6172 6368 6573 2061 6c6c 2062  ""searches all b
+000180c0: 6f64 7920 656c 656d 656e 7473 2066 6f72  ody elements for
+000180d0: 2040 636c 6173 7320 6174 7472 6962 7574   @class attribut
+000180e0: 6573 0a20 2020 2020 2020 203a 7061 7261  es.        :para
+000180f0: 6d20 6874 6d6c 5f65 6c65 6d3a 2068 746d  m html_elem: htm
+00018100: 6c20 656c 656d 656e 740a 2020 2020 2020  l element.      
+00018110: 2020 3a72 6574 7572 6e3a 2061 6c6c 2062    :return: all b
+00018120: 6f64 7920 656c 656d 656e 7473 2077 6974  ody elements wit
+00018130: 6820 4063 6c61 7373 2061 7474 7269 6275  h @class attribu
+00018140: 7465 730a 2020 2020 2020 2020 2222 220a  tes.        """.
+00018150: 2020 2020 2020 2020 626f 6479 203d 2048          body = H
+00018160: 746d 6c4c 6962 2e67 6574 5f62 6f64 7928  tmlLib.get_body(
+00018170: 6874 6d6c 5f65 6c65 6d29 0a20 2020 2020  html_elem).     
+00018180: 2020 2072 6574 7572 6e20 5b5d 2069 6620     return [] if 
+00018190: 626f 6479 2069 7320 4e6f 6e65 2065 6c73  body is None els
+000181a0: 6520 626f 6479 2e78 7061 7468 2822 2e2f  e body.xpath("./
+000181b0: 2f2a 5b40 636c 6173 735d 2229 0a0a 2020  /*[@class]")..  
+000181c0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+000181d0: 2020 2064 6566 2063 7265 6174 655f 6162     def create_ab
+000181e0: 6272 6576 6961 7465 645f 666f 6e74 5f73  breviated_font_s
+000181f0: 7479 6c65 7328 636c 732c 2068 746d 6c5f  tyles(cls, html_
+00018200: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
+00018210: 2222 6372 6561 7465 7320 7265 6164 6162  ""creates readab
+00018220: 6c65 2073 7479 6c65 6e61 6d65 730a 2020  le stylenames.  
+00018230: 2020 2020 2020 2e73 3020 7b66 6f6e 742d        .s0 {font-
+00018240: 6661 6d69 6c79 3a20 5469 6d65 734e 6577  family: TimesNew
+00018250: 526f 6d61 6e50 534d 543b 2066 6f6e 742d  RomanPSMT; font-
+00018260: 7369 7a65 3a20 3132 2e30 3b20 666f 6e74  size: 12.0; font
+00018270: 2d77 6569 6768 743a 2062 6f6c 643b 2066  -weight: bold; f
+00018280: 6f6e 742d 6e61 6d65 3a20 5469 6d65 734e  ont-name: TimesN
+00018290: 6577 526f 6d61 6e50 534d 543b 0a20 2020  ewRomanPSMT;.   
+000182a0: 2020 2020 2069 7320 7472 616e 7366 6f72       is transfor
+000182b0: 6d65 6420 746f 0a20 2020 2020 2020 202e  med to.        .
+000182c0: 7469 6d65 736e 6577 726f 6d61 6e70 736d  timesnewromanpsm
+000182d0: 745f 3132 7e30 5f62 6f6c 640a 2020 2020  t_12~0_bold.    
+000182e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000182f0: 7374 796c 655f 636f 6e76 6572 7465 7220  style_converter 
+00018300: 3d20 636c 732e 6372 6561 7465 5f73 7479  = cls.create_sty
+00018310: 6c65 5f63 6f6e 7665 7274 6572 2868 746d  le_converter(htm
+00018320: 6c5f 656c 656d 290a 2020 2020 2020 2020  l_elem).        
+00018330: 7374 796c 6564 5f65 6c65 6d73 203d 2068  styled_elems = h
+00018340: 746d 6c5f 656c 656d 2e78 7061 7468 2822  tml_elem.xpath("
+00018350: 2e2f 2f2a 5b40 636c 6173 735d 2229 0a20  .//*[@class]"). 
+00018360: 2020 2020 2020 2066 6f72 2065 6c65 6d20         for elem 
+00018370: 696e 2073 7479 6c65 645f 656c 656d 733a  in styled_elems:
+00018380: 0a20 2020 2020 2020 2020 2020 2063 6c61  .            cla
+00018390: 7a7a 203d 2065 6c65 6d2e 6174 7472 6962  zz = elem.attrib
+000183a0: 5b22 636c 6173 7322 5d0a 2020 2020 2020  ["class"].      
+000183b0: 2020 2020 2020 6e65 775f 636c 6173 7320        new_class 
+000183c0: 3d20 7374 796c 655f 636f 6e76 6572 7465  = style_converte
+000183d0: 722e 6765 7428 636c 617a 7a29 0a20 2020  r.get(clazz).   
+000183e0: 2020 2020 2020 2020 2069 6620 6e65 775f           if new_
+000183f0: 636c 6173 7320 6973 204e 6f6e 653a 0a20  class is None:. 
+00018400: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00018410: 7269 6e74 2866 2263 616e 6e6f 7420 6669  rint(f"cannot fi
+00018420: 6e64 2072 6570 6c61 6365 2066 6f72 207b  nd replace for {
+00018430: 636c 617a 7a7d 2229 0a20 2020 2020 2020  clazz}").       
+00018440: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
+00018450: 650a 2020 2020 2020 2020 2020 2020 6874  e.            ht
+00018460: 6d6c 5f63 6c61 7373 203d 2048 746d 6c43  ml_class = HtmlC
+00018470: 6c61 7373 2863 6c61 7a7a 290a 2020 2020  lass(clazz).    
+00018480: 2020 2020 2020 2020 6874 6d6c 5f63 6c61          html_cla
+00018490: 7373 2e72 6570 6c61 6365 5f63 6c61 7373  ss.replace_class
+000184a0: 2863 6c61 7a7a 2c20 6e65 775f 636c 6173  (clazz, new_clas
+000184b0: 7329 0a20 2020 2020 2020 2020 2020 2065  s).            e
+000184c0: 6c65 6d2e 6174 7472 6962 5b22 636c 6173  lem.attrib["clas
+000184d0: 7322 5d20 3d20 6e65 775f 636c 6173 730a  s"] = new_class.
+000184e0: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
+000184f0: 696e 7428 6622 7265 706c 6163 6564 207b  int(f"replaced {
+00018500: 636c 617a 7a7d 2062 7920 7b6e 6577 5f63  clazz} by {new_c
+00018510: 6c61 7373 7d22 290a 0a20 2020 2040 636c  lass}")..    @cl
+00018520: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00018530: 6620 6372 6561 7465 5f73 7479 6c65 5f63  f create_style_c
+00018540: 6f6e 7665 7274 6572 2863 6c73 2c20 6874  onverter(cls, ht
+00018550: 6d6c 5f65 6c65 6d29 3a0a 2020 2020 2020  ml_elem):.      
+00018560: 2020 7374 796c 6573 203d 2048 746d 6c53    styles = HtmlS
+00018570: 7479 6c65 2e67 6574 5f68 6561 645f 7374  tyle.get_head_st
+00018580: 796c 6573 2868 746d 6c5f 656c 656d 290a  yles(html_elem).
+00018590: 2020 2020 2020 2020 7374 796c 655f 636f          style_co
+000185a0: 6e76 6572 7465 7220 3d20 6469 6374 2829  nverter = dict()
+000185b0: 0a20 2020 2020 2020 2066 6f72 2073 7479  .        for sty
+000185c0: 6c65 2069 6e20 7374 796c 6573 3a0a 2020  le in styles:.  
+000185d0: 2020 2020 2020 2020 2020 646f 745f 7374            dot_st
+000185e0: 796c 652c 2063 7373 203d 2048 746d 6c53  yle, css = HtmlS
+000185f0: 7479 6c65 2e65 7874 7261 6374 5f63 6c61  tyle.extract_cla
+00018600: 7373 7265 665f 616e 645f 6373 7373 7472  ssref_and_cssstr
+00018610: 696e 675f 6672 6f6d 5f68 746d 6c5f 7374  ing_from_html_st
+00018620: 796c 6528 7374 796c 6529 0a20 2020 2020  yle(style).     
+00018630: 2020 2020 2020 2023 2070 7269 6e74 2866         # print(f
+00018640: 227b 646f 745f 7374 796c 657d 207b 6373  "{dot_style} {cs
+00018650: 737d 2229 0a20 2020 2020 2020 2020 2020  s}").           
+00018660: 2063 7373 5f73 7479 6c65 203d 2043 5353   css_style = CSS
+00018670: 5374 796c 652e 6372 6561 7465 5f63 7373  Style.create_css
+00018680: 5f73 7479 6c65 5f66 726f 6d5f 6373 735f  _style_from_css_
+00018690: 7374 7269 6e67 2863 7373 290a 2020 2020  string(css).    
+000186a0: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+000186b0: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
+000186c0: 2020 2066 2266 6f6e 743a 207b 6373 735f     f"font: {css_
+000186d0: 7374 796c 652e 666f 6e74 5f66 616d 696c  style.font_famil
+000186e0: 797d 2073 697a 6520 7b63 7373 5f73 7479  y} size {css_sty
+000186f0: 6c65 2e66 6f6e 745f 7369 7a65 7d20 626f  le.font_size} bo
+00018700: 6c64 207b 6373 735f 7374 796c 652e 6973  ld {css_style.is
+00018710: 5f62 6f6c 647d 2069 7461 6c69 6320 7b63  _bold} italic {c
+00018720: 7373 5f73 7479 6c65 2e69 735f 6974 616c  ss_style.is_ital
+00018730: 6963 7d22 290a 2020 2020 2020 2020 2020  ic}").          
+00018740: 2020 635f 7374 796c 6520 3d20 2222 0a20    c_style = "". 
+00018750: 2020 2020 2020 2020 2020 2069 6620 6373             if cs
+00018760: 735f 7374 796c 652e 666f 6e74 5f66 616d  s_style.font_fam
+00018770: 696c 793a 0a20 2020 2020 2020 2020 2020  ily:.           
+00018780: 2020 2020 2063 5f73 7479 6c65 202b 3d20       c_style += 
+00018790: 6373 735f 7374 796c 652e 666f 6e74 5f66  css_style.font_f
+000187a0: 616d 696c 792e 6c6f 7765 7228 290a 2020  amily.lower().  
+000187b0: 2020 2020 2020 2020 2020 6966 2063 7373            if css
+000187c0: 5f73 7479 6c65 2e66 6f6e 745f 7369 7a65  _style.font_size
+000187d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000187e0: 2020 635f 7374 796c 6520 2b3d 2022 5f22    c_style += "_"
+000187f0: 202b 2073 7472 2863 7373 5f73 7479 6c65   + str(css_style
+00018800: 2e66 6f6e 745f 7369 7a65 292e 7265 706c  .font_size).repl
+00018810: 6163 6528 222e 222c 2022 5f22 290a 2020  ace(".", "_").  
+00018820: 2020 2020 2020 2020 2020 6966 2063 7373            if css
+00018830: 5f73 7479 6c65 2e69 735f 626f 6c64 3a0a  _style.is_bold:.
+00018840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018850: 635f 7374 796c 6520 2b3d 2022 5f22 202b  c_style += "_" +
+00018860: 2022 6222 0a20 2020 2020 2020 2020 2020   "b".           
+00018870: 2069 6620 6373 735f 7374 796c 652e 6973   if css_style.is
+00018880: 5f69 7461 6c69 633a 0a20 2020 2020 2020  _italic:.       
+00018890: 2020 2020 2020 2020 2063 5f73 7479 6c65           c_style
+000188a0: 202b 3d20 225f 2220 2b20 2269 220a 2020   += "_" + "i".  
+000188b0: 2020 2020 2020 2020 2020 6966 2063 5f73            if c_s
+000188c0: 7479 6c65 2e73 7461 7274 7377 6974 6828  tyle.startswith(
+000188d0: 225f 2229 3a0a 2020 2020 2020 2020 2020  "_"):.          
+000188e0: 2020 2020 2020 635f 7374 796c 6520 3d20        c_style = 
+000188f0: 635f 7374 796c 655b 313a 5d0a 2020 2020  c_style[1:].    
+00018900: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
+00018910: 6622 635f 7374 796c 6520 7b63 5f73 7479  f"c_style {c_sty
+00018920: 6c65 7d22 290a 2020 2020 2020 2020 2020  le}").          
+00018930: 2020 6966 2063 5f73 7479 6c65 2021 3d20    if c_style != 
+00018940: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
+00018950: 2020 2020 7374 796c 655f 636f 6e76 6572      style_conver
+00018960: 7465 725b 646f 745f 7374 796c 655b 313a  ter[dot_style[1:
+00018970: 5d5d 203d 2063 5f73 7479 6c65 0a20 2020  ]] = c_style.   
+00018980: 2020 2020 2020 2020 2020 2020 2063 6c73               cls
+00018990: 2e73 6574 5f63 6c61 7373 7265 665f 616e  .set_classref_an
+000189a0: 645f 6373 7328 7374 796c 652c 2063 5f73  d_css(style, c_s
+000189b0: 7479 6c65 2c20 6373 7329 0a0a 2020 2020  tyle, css)..    
+000189c0: 2020 2020 7265 7475 726e 2073 7479 6c65      return style
+000189d0: 5f63 6f6e 7665 7274 6572 0a0a 2020 2020  _converter..    
+000189e0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+000189f0: 2064 6566 2073 6574 5f63 6c61 7373 7265   def set_classre
+00018a00: 665f 616e 645f 6373 7328 636c 732c 2073  f_and_css(cls, s
+00018a10: 7479 6c65 5f65 6c65 6d2c 2063 5f73 7479  tyle_elem, c_sty
+00018a20: 6c65 2c20 6373 7329 3a0a 2020 2020 2020  le, css):.      
+00018a30: 2020 7374 796c 655f 656c 656d 2e61 7474    style_elem.att
+00018a40: 7269 625b 2263 6c61 7373 7265 6622 5d20  rib["classref"] 
+00018a50: 3d20 222e 2220 2b20 635f 7374 796c 650a  = "." + c_style.
+00018a60: 2020 2020 2020 2020 7374 796c 655f 656c          style_el
+00018a70: 656d 2e74 6578 7420 3d20 222e 2220 2b20  em.text = "." + 
+00018a80: 635f 7374 796c 6520 2b20 2220 7b22 202b  c_style + " {" +
+00018a90: 2063 7373 202b 2022 7d22 0a0a 0a63 6c61   css + "}"...cla
+00018aa0: 7373 2048 746d 6c43 6c61 7373 3a0a 2020  ss HtmlClass:.  
+00018ab0: 2020 2222 220a 2020 2020 6d65 7468 6f64    """.    method
+00018ac0: 7320 746f 2070 726f 6365 7373 2063 6c61  s to process cla
+00018ad0: 7373 202a 6174 7472 6962 7574 6573 2a20  ss *attributes* 
+00018ae0: 6f6e 2048 544d 4c20 656c 656d 6e74 7320  on HTML elemnts 
+00018af0: 616e 6420 7379 6e63 2077 6974 6820 7374  and sync with st
+00018b00: 796c 650a 2020 2020 496e 6974 6961 6c6c  yle.    Initiall
+00018b10: 7920 6d61 696e 6c79 2040 636c 6173 736d  y mainly @classm
+00018b20: 6574 686f 6420 6275 7420 6164 6469 6e67  ethod but adding
+00018b30: 2069 6e73 7461 6d63 6573 2074 6f20 6d61   instamces to ma
+00018b40: 6e61 6765 2065 6469 7469 6e67 0a20 2020  nage editing.   
+00018b50: 2074 6865 2040 636c 6173 7320 6174 7472   the @class attr
+00018b60: 6962 7574 650a 2020 2020 2222 220a 0a20  ibute.    """.. 
+00018b70: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00018b80: 7365 6c66 2c20 636c 6173 7373 7472 3d4e  self, classstr=N
+00018b90: 6f6e 6529 3a0a 0a20 2020 2020 2020 2073  one):..        s
+00018ba0: 656c 662e 636c 6173 7365 7320 3d20 7365  elf.classes = se
+00018bb0: 7428 290a 2020 2020 2020 2020 6966 2063  t().        if c
+00018bc0: 6c61 7373 7374 723a 0a20 2020 2020 2020  lassstr:.       
+00018bd0: 2020 2020 2069 6620 7479 7065 2863 6c61       if type(cla
+00018be0: 7373 7374 7229 2069 7320 7374 723a 0a20  ssstr) is str:. 
+00018bf0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00018c00: 656c 662e 636c 6173 7365 732e 7570 6461  elf.classes.upda
+00018c10: 7465 2863 6c61 7373 7374 722e 7370 6c69  te(classstr.spli
+00018c20: 7428 2929 0a20 2020 2020 2020 2020 2020  t()).           
+00018c30: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00018c40: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00018c50: 7565 4572 726f 7228 6622 6361 6e20 6f6e  ueError(f"can on
+00018c60: 6c79 2063 7265 6174 6520 4874 6d6c 436c  ly create HtmlCl
+00018c70: 6173 7320 6672 6f6d 2073 7472 696e 6773  ass from strings
+00018c80: 2c20 666f 756e 6420 7b74 7970 6528 636c  , found {type(cl
+00018c90: 6173 7373 7472 297d 203a 207b 636c 6173  assstr)} : {clas
+00018ca0: 7373 7472 7d22 290a 0a23 2063 6c61 7373  sstr}")..# class
+00018cb0: 2048 746d 6c43 6c61 7373 3a0a 0a20 2020   HtmlClass:..   
+00018cc0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00018cd0: 2020 6465 6620 6372 6561 7465 5f66 726f    def create_fro
+00018ce0: 6d5f 636c 6173 7365 645f 656c 656d 656e  m_classed_elemen
+00018cf0: 7428 636c 732c 2065 6c65 6d29 3a0a 2020  t(cls, elem):.  
+00018d00: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00018d10: 2020 6765 7420 636c 6173 7320 7661 6c75    get class valu
+00018d20: 6520 6672 6f6d 2065 6c65 6d65 6e74 2061  e from element a
+00018d30: 6e64 2063 6372 6561 7465 2048 746d 6c43  nd ccreate HtmlC
+00018d40: 6c61 7373 0a20 2020 2020 2020 203a 7061  lass.        :pa
+00018d50: 7261 6d20 656c 656d 3a20 656c 656d 656e  ram elem: elemen
+00018d60: 7473 2077 6974 6820 4063 6c61 7373 2061  ts with @class a
+00018d70: 7474 7269 6275 7465 0a20 2020 2020 2020  ttribute.       
+00018d80: 203a 7265 7475 726e 3a20 4874 6d6c 436c   :return: HtmlCl
+00018d90: 6173 7320 656c 656d 656e 7420 6f72 204e  ass element or N
+00018da0: 6f6e 650a 2020 2020 2020 2020 2222 220a  one.        """.
+00018db0: 2020 2020 2020 2020 636c 617a 7a20 3d20          clazz = 
+00018dc0: 4874 6d6c 436c 6173 732e 6765 745f 636c  HtmlClass.get_cl
+00018dd0: 6173 735f 7374 7269 6e67 5f6f 6e5f 656c  ass_string_on_el
+00018de0: 656d 656e 7428 656c 656d 290a 2020 2020  ement(elem).    
+00018df0: 2020 2020 7265 7475 726e 204e 6f6e 6520      return None 
+00018e00: 6966 206e 6f74 2063 6c61 7a7a 2065 6c73  if not clazz els
+00018e10: 6520 4874 6d6c 436c 6173 7328 636c 617a  e HtmlClass(claz
+00018e20: 7a29 0a0a 2020 2020 2320 636c 6173 7320  z)..    # class 
+00018e30: 4874 6d6c 436c 6173 733a 0a0a 2020 2020  HtmlClass:..    
+00018e40: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00018e50: 6620 636c 6173 735f 7374 7269 6e67 2873  f class_string(s
+00018e60: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00018e70: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00018e80: 2074 6865 2063 6c61 7373 5f73 7472 696e   the class_strin
+00018e90: 6720 2863 7265 6174 6573 2066 726f 6d20  g (creates from 
+00018ea0: 6c61 7465 7374 2073 656c 662e 636c 6173  latest self.clas
+00018eb0: 7365 7329 0a20 2020 2020 2020 203a 7265  ses).        :re
+00018ec0: 7475 726e 3a20 7374 7269 6e67 206f 6620  turn: string of 
+00018ed0: 616c 7068 6162 6574 6963 6361 6c6c 7920  alphabeticcally 
+00018ee0: 736f 7274 6564 2073 7065 6365 2d73 6570  sorted spece-sep
+00018ef0: 6172 6174 6564 2063 6c61 7373 6573 0a20  arated classes. 
+00018f00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00018f10: 2020 2072 6574 7572 6e20 2222 2069 6620     return "" if 
+00018f20: 6e6f 7420 7365 6c66 2e63 6c61 7373 6573  not self.classes
+00018f30: 2065 6c73 6520 2220 222e 6a6f 696e 2873   else " ".join(s
+00018f40: 6f72 7465 6428 6c69 7374 2873 656c 662e  orted(list(self.
+00018f50: 636c 6173 7365 7329 2929 0a0a 2020 2020  classes)))..    
+00018f60: 6465 6620 6164 645f 636c 6173 7328 7365  def add_class(se
+00018f70: 6c66 2c20 636c 617a 7a29 3a0a 2020 2020  lf, clazz):.    
+00018f80: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00018f90: 6164 6420 636c 6173 7320 746f 2063 6c61  add class to cla
+00018fa0: 7373 5f73 7472 696e 670a 2020 2020 2020  ss_string.      
+00018fb0: 2020 3a70 6172 616d 2063 6c61 7a7a 3a20    :param clazz: 
+00018fc0: 636c 6173 7320 746f 2061 6464 2028 6d75  class to add (mu
+00018fd0: 7374 2062 6520 6e6f 6e2d 656d 7074 7920  st be non-empty 
+00018fe0: 7374 7269 6e67 0a20 2020 2020 2020 2069  string.        i
+00018ff0: 6620 636c 617a 7a20 6973 0a20 2020 2020  f clazz is.     
+00019000: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+00019010: 6620 636c 617a 7a20 616e 6420 6c65 6e28  f clazz and len(
+00019020: 636c 617a 7a2e 7374 7269 7028 2929 203e  clazz.strip()) >
+00019030: 2030 2061 6e64 2063 6c61 7a7a 206e 6f74   0 and clazz not
+00019040: 2069 6e20 7365 6c66 2e63 6c61 7373 6573   in self.classes
+00019050: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00019060: 6c66 2e63 6c61 7373 6573 2e61 6464 2863  lf.classes.add(c
+00019070: 6c61 7a7a 2e73 7472 6970 2829 290a 0a20  lazz.strip()).. 
+00019080: 2020 2023 2063 6c61 7373 2048 746d 6c43     # class HtmlC
+00019090: 6c61 7373 3a0a 0a20 2020 2064 6566 2068  lass:..    def h
+000190a0: 6173 5f63 6c61 7373 2873 656c 662c 2063  as_class(self, c
+000190b0: 6c61 7a7a 293a 0a20 2020 2020 2020 2022  lazz):.        "
+000190c0: 2222 0a20 2020 2020 2020 2064 6f65 7320  "".        does 
+000190d0: 636c 6173 7320 6578 6973 7420 696e 2063  class exist in c
+000190e0: 6c61 7373 6573 0a20 2020 2020 2020 203a  lasses.        :
+000190f0: 7061 7261 6d20 636c 617a 7a3a 0a20 2020  param clazz:.   
+00019100: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00019110: 2072 6574 7572 6e20 636c 617a 7a20 696e   return clazz in
+00019120: 2073 656c 662e 636c 6173 7365 730a 0a20   self.classes.. 
+00019130: 2020 2023 2063 6c61 7373 2048 746d 6c43     # class HtmlC
+00019140: 6c61 7373 3a0a 0a20 2020 2064 6566 2072  lass:..    def r
+00019150: 6570 6c61 6365 5f63 6c61 7373 2873 656c  eplace_class(sel
+00019160: 662c 2063 6c61 7a7a 5f6f 6c64 2c20 636c  f, clazz_old, cl
+00019170: 617a 7a3d 4e6f 6e65 293a 0a20 2020 2020  azz=None):.     
+00019180: 2020 2022 2222 0a20 2020 2020 2020 2072     """.        r
+00019190: 656d 6f76 6520 636c 617a 7a5f 6f6c 6420  emove clazz_old 
+000191a0: 3b20 6966 2063 6c61 7a7a 2069 7320 6e6f  ; if clazz is no
+000191b0: 7420 4e6f 6e65 2061 6464 2069 7420 6173  t None add it as
+000191c0: 206e 6577 2063 6c61 7373 0a20 2020 2020   new class.     
+000191d0: 2020 2028 6966 2063 6c61 7a7a 2069 7320     (if clazz is 
+000191e0: 616c 7265 6164 7920 7072 6573 656e 742c  already present,
+000191f0: 206e 6f2d 6f70 290a 2020 2020 2020 2020   no-op).        
+00019200: 2222 220a 2020 2020 2020 2020 6966 2063  """.        if c
+00019210: 6c61 7a7a 5f6f 6c64 2069 6e20 7365 6c66  lazz_old in self
+00019220: 2e63 6c61 7373 6573 3a0a 2020 2020 2020  .classes:.      
+00019230: 2020 2020 2020 7365 6c66 2e72 656d 6f76        self.remov
+00019240: 6528 636c 617a 7a5f 6f6c 6429 0a20 2020  e(clazz_old).   
+00019250: 2020 2020 2020 2020 2069 6620 636c 617a           if claz
+00019260: 7a3a 0a20 2020 2020 2020 2020 2020 2020  z:.             
+00019270: 2020 2073 656c 662e 6164 645f 636c 6173     self.add_clas
+00019280: 7328 636c 617a 7a29 0a0a 2020 2020 2320  s(clazz)..    # 
+00019290: 636c 6173 7320 4874 6d6c 436c 6173 733a  class HtmlClass:
+000192a0: 0a0a 2020 2020 6465 6620 7265 6d6f 7665  ..    def remove
+000192b0: 2873 656c 662c 2063 6c61 7a7a 293a 0a20  (self, clazz):. 
+000192c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000192d0: 2020 2072 656d 6f76 6520 636c 6173 7320     remove class 
+000192e0: 6672 6f6d 2073 7472 696e 670a 2020 2020  from string.    
+000192f0: 2020 2020 3a70 6172 616d 2063 6c61 7a7a      :param clazz
+00019300: 3a20 636c 6173 7320 7374 7269 6e67 2074  : class string t
+00019310: 6f20 7265 6d6f 7665 0a20 2020 2020 2020  o remove.       
+00019320: 2069 6620 206e 6f74 2070 7265 7365 6e74   if  not present
+00019330: 2c20 6e6f 2d6f 700a 2020 2020 2020 2020  , no-op.        
+00019340: 2222 220a 2020 2020 2020 2020 6966 2063  """.        if c
+00019350: 6c61 7a7a 2069 6e20 7365 6c66 2e63 6c61  lazz in self.cla
+00019360: 7373 6573 3a0a 2020 2020 2020 2020 2020  sses:.          
+00019370: 2020 7365 6c66 2e63 6c61 7373 6573 2e72    self.classes.r
+00019380: 656d 6f76 6528 636c 617a 7a29 0a0a 2020  emove(clazz)..  
+00019390: 2020 2320 636c 6173 7320 4874 6d6c 436c    # class HtmlCl
+000193a0: 6173 733a 0a0a 2020 2020 4063 6c61 7373  ass:..    @class
+000193b0: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
+000193c0: 6574 5f63 6c61 7373 5f73 7472 696e 675f  et_class_string_
+000193d0: 6f6e 5f65 6c65 6d65 6e74 2863 6c73 2c20  on_element(cls, 
+000193e0: 656c 656d 293a 0a20 2020 2020 2020 2022  elem):.        "
+000193f0: 2222 0a20 2020 2020 2020 2063 6f6e 7665  "".        conve
+00019400: 6e69 656e 6365 206d 6574 686f 6420 746f  nience method to
+00019410: 2067 6574 2065 6c65 6d65 6e74 2073 7479   get element sty
+00019420: 6c65 0a20 2020 2020 2020 203a 7061 7261  le.        :para
+00019430: 6d20 656c 656d 3a20 746f 2067 6574 2073  m elem: to get s
+00019440: 7479 6c65 2066 726f 6d0a 2020 2020 2020  tyle from.      
+00019450: 2020 3a72 6574 7572 6e3a 2073 7479 6c65    :return: style
+00019460: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
+00019470: 2022 2222 0a0a 2020 2020 2020 2020 7265   """..        re
+00019480: 7475 726e 2065 6c65 6d2e 6174 7472 6962  turn elem.attrib
+00019490: 2e67 6574 2822 636c 6173 7322 2920 6966  .get("class") if
+000194a0: 2074 7970 6528 656c 656d 2920 6973 205f   type(elem) is _
+000194b0: 456c 656d 656e 7420 656c 7365 204e 6f6e  Element else Non
+000194c0: 650a 0a20 2020 2023 2063 6c61 7373 2048  e..    # class H
+000194d0: 746d 6c43 6c61 7373 3a0a 0a20 2020 2040  tmlClass:..    @
+000194e0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+000194f0: 6465 6620 7365 745f 636c 6173 735f 6f6e  def set_class_on
+00019500: 5f65 6c65 6d65 6e74 2863 6c73 2c20 656c  _element(cls, el
+00019510: 656d 2c20 7661 6c75 652c 2072 6570 6c61  em, value, repla
+00019520: 6365 3d54 7275 6529 3a0a 2020 2020 2020  ce=True):.      
+00019530: 2020 2222 220a 2020 2020 2020 2020 636f    """.        co
+00019540: 6e76 656e 6965 6e63 6520 6d65 7468 6f64  nvenience method
+00019550: 2074 6f20 7365 7420 636c 6173 7320 6f6e   to set class on
+00019560: 2065 6c65 6d65 6e74 0a20 2020 2020 2020   element.       
+00019570: 203a 7061 7261 6d20 656c 656d 3a65 6c65   :param elem:ele
+00019580: 6d65 6e74 2074 6f20 7365 7420 636c 6173  ment to set clas
+00019590: 7320 6f6e 0a20 2020 2020 2020 203a 7061  s on.        :pa
+000195a0: 7261 6d20 7661 6c75 653a 2068 746d 6c20  ram value: html 
+000195b0: 636c 6173 730a 2020 2020 2020 2020 3a70  class.        :p
+000195c0: 6172 616d 2072 6570 6c61 6365 3a69 6620  aram replace:if 
+000195d0: 5472 7565 2072 6570 6c61 6365 2c20 656c  True replace, el
+000195e0: 7365 2061 6464 2074 6f20 6578 6973 7469  se add to existi
+000195f0: 6e67 2061 7474 7269 6275 7465 0a20 2020  ng attribute.   
+00019600: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00019610: 2069 6620 656c 656d 2069 7320 6e6f 7420   if elem is not 
+00019620: 4e6f 6e65 2061 6e64 2076 616c 7565 3a0a  None and value:.
+00019630: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00019640: 6f74 2072 6570 6c61 6365 3a0a 2020 2020  ot replace:.    
+00019650: 2020 2020 2020 2020 2020 2020 6f6c 645f              old_
+00019660: 636c 6173 7320 3d20 4874 6d6c 436c 6173  class = HtmlClas
+00019670: 732e 6765 745f 636c 6173 735f 7374 7269  s.get_class_stri
+00019680: 6e67 5f6f 6e5f 656c 656d 656e 7428 656c  ng_on_element(el
+00019690: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
+000196a0: 2020 2020 6966 206f 6c64 5f63 6c61 7373      if old_class
+000196b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000196c0: 2020 2020 2020 6966 2076 616c 7565 206e        if value n
+000196d0: 6f74 2069 6e20 6f6c 645f 636c 6173 733a  ot in old_class:
+000196e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000196f0: 2020 2020 2020 2020 206f 6c64 5f63 6c61           old_cla
+00019700: 7373 202b 3d20 2220 2220 2b20 7661 6c75  ss += " " + valu
+00019710: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+00019720: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00019730: 2020 2020 6f6c 645f 636c 6173 7320 3d20      old_class = 
+00019740: 7661 6c75 650a 2020 2020 2020 2020 2020  value.          
+00019750: 2020 656c 656d 2e61 7474 7269 625b 2263    elem.attrib["c
+00019760: 6c61 7373 225d 203d 2076 616c 7565 0a0a  lass"] = value..
+00019770: 2020 2020 2320 636c 6173 7320 4874 6d6c      # class Html
+00019780: 436c 6173 733a 0a0a 2020 2020 6465 6620  Class:..    def 
+00019790: 6372 6561 7465 5f63 6c61 7373 7265 6628  create_classref(
+000197a0: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
+000197b0: 2222 0a20 2020 2020 2020 2063 7265 6174  "".        creat
+000197c0: 6520 636c 6173 7372 6566 2073 7472 696e  e classref strin
+000197d0: 6720 2870 7265 7065 6e64 2022 2e22 290a  g (prepend ".").
+000197e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000197f0: 2020 2020 7265 7475 726e 2022 2e22 202b      return "." +
+00019800: 2073 656c 662e 636c 6173 735f 7374 7269   self.class_stri
+00019810: 6e67 0a0a 2020 2020 2320 636c 6173 7320  ng..    # class 
+00019820: 4874 6d6c 436c 6173 733a 0a0a 2020 2020  HtmlClass:..    
+00019830: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00019840: 2064 6566 2072 656d 6f76 655f 646f 7428   def remove_dot(
+00019850: 7365 6c66 2c20 7374 7269 6e67 293a 0a20  self, string):. 
+00019860: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00019870: 2020 2072 656d 6f76 6520 646f 7420 2822     remove dot ("
+00019880: 2e22 2920 2d20 696e 2068 746d 6c2f 6865  .") - in html/he
+00019890: 6164 2f73 7479 6c65 2065 6c65 6d65 6e74  ad/style element
+000198a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000198b0: 2020 2020 2072 6574 7572 6e20 7374 7269       return stri
+000198c0: 6e67 5b31 3a5d 2069 6620 7374 7269 6e67  ng[1:] if string
+000198d0: 2061 6e64 2073 7472 696e 675b 3a31 5d20   and string[:1] 
+000198e0: 3d3d 2022 2e22 2065 6c73 6520 7374 7269  == "." else stri
+000198f0: 6e67 0a0a 0a63 6c61 7373 2048 746d 6c54  ng...class HtmlT
+00019900: 7265 653a 0a20 2020 2022 2222 6275 696c  ree:.    """buil
+00019910: 6473 2061 2074 7265 6520 6672 6f6d 2061  ds a tree from a
+00019920: 2066 6c61 7420 7365 7420 6f66 2048 746d   flat set of Htm
+00019930: 6c20 656c 656d 6e65 7473 2222 220a 0a20  l elemnets""".. 
+00019940: 2020 2023 2066 6f72 2074 6865 2073 6563     # for the sec
+00019950: 7469 6f6e 5f72 6563 730a 2020 2020 4348  tion_recs.    CH
+00019960: 4150 5f54 4f50 203d 2022 4348 4150 5f54  AP_TOP = "CHAP_T
+00019970: 4f50 220a 2020 2020 4348 4150 5f53 4543  OP".    CHAP_SEC
+00019980: 5449 4f4e 5320 3d20 2243 4841 505f 5345  TIONS = "CHAP_SE
+00019990: 4354 494f 4e53 220a 2020 2020 4348 4150  CTIONS".    CHAP
+000199a0: 5f53 5542 5345 4354 5320 3d20 2243 4841  _SUBSECTS = "CHA
+000199b0: 505f 5355 4253 4543 5453 220a 0a20 2020  P_SUBSECTS"..   
+000199c0: 2023 2043 6861 7074 6572 0a20 2020 2054   # Chapter.    T
+000199d0: 5245 455f 524f 4f54 203d 2022 7472 6565  REE_ROOT = "tree
+000199e0: 5f72 6f6f 7422 0a20 2020 2043 4c41 5353  _root".    CLASS
+000199f0: 203d 2022 636c 6173 7322 0a20 2020 2050   = "class".    P
+00019a00: 5245 5f43 4841 5053 4543 203d 2022 7072  RE_CHAPSEC = "pr
+00019a10: 655f 6368 6170 7365 6322 0a0a 2020 2020  e_chapsec"..    
+00019a20: 2320 7365 6374 696f 6e73 0a20 2020 2043  # sections.    C
+00019a30: 4841 5053 4543 203d 2022 6368 6170 7365  HAPSEC = "chapse
+00019a40: 6322 0a20 2020 2054 4f50 5f44 4956 203d  c".    TOP_DIV =
+00019a50: 2022 746f 705f 6469 7622 0a0a 2020 2020   "top_div"..    
+00019a60: 2320 5850 6174 6873 0a20 2020 2041 4c4c  # XPaths.    ALL
+00019a70: 5f44 4956 5f58 5041 5448 5320 3d20 222e  _DIV_XPATHS = ".
+00019a80: 2f2f 6469 7622 0a0a 2320 636c 6173 7320  //div"..# class 
+00019a90: 4874 6d6c 5472 6565 0a0a 2020 2020 4063  HtmlTree..    @c
+00019aa0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00019ab0: 6566 206d 616b 655f 7365 6374 696f 6e73  ef make_sections
+00019ac0: 5f61 6e64 5f6f 7574 7075 7428 636c 732c  _and_output(cls,
+00019ad0: 2065 6c65 6d2c 206f 7574 7075 745f 6469   elem, output_di
+00019ae0: 722c 2072 6563 735f 6279 5f73 6563 7469  r, recs_by_secti
+00019af0: 6f6e 3d4e 6f6e 6529 3a0a 2020 2020 2020  on=None):.      
+00019b00: 2020 2222 2266 696e 6420 6465 6369 6d61    """find decima
+00019b10: 6c20 6e75 6d62 6572 2066 6f72 2074 7265  l number for tre
+00019b20: 650a 2020 2020 2020 2020 5468 6953 2069  e.        ThiS i
+00019b30: 7320 4845 4156 494c 5920 6261 7365 6420  s HEAVILY based 
+00019b40: 6f6e 2049 5043 430a 2020 2020 2020 2020  on IPCC.        
+00019b50: 6375 7272 656e 746c 7920 6361 6c6c 6564  currently called
+00019b60: 2069 6e20 7469 6479 5f66 6c6f 7728 290a   in tidy_flow().
+00019b70: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00019b80: 2020 2020 6d61 726b 6572 7320 3d20 5b22      markers = ["
+00019b90: 4368 6170 7465 7222 2c0a 2020 2020 2020  Chapter",.      
+00019ba0: 2020 2020 2020 2020 2020 2020 2023 2022               # "
+00019bb0: 5461 626c 6520 6f66 2043 6f6e 7465 6e74  Table of Content
+00019bc0: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
+00019bd0: 2020 2020 2020 2022 5461 626c 6520 6f66         "Table of
+00019be0: 222c 2020 2320 6f6e 6520 6973 2063 6f6e  ",  # one is con
+00019bf0: 6361 7465 6e61 7465 6420 2843 6861 7074  catenated (Chapt
+00019c00: 6572 3031 2920 736f 2061 6262 7265 7669  er01) so abbrevi
+00019c10: 6174 652c 2075 6e77 6569 6768 7465 6420  ate, unweighted 
+00019c20: 4368 6170 3136 0a20 2020 2020 2020 2020  Chap16.         
+00019c30: 2020 2020 2020 2020 2020 2320 2245 7865            # "Exe
+00019c40: 6375 7469 7665 2053 756d 6d61 7279 222c  cutive Summary",
+00019c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019c60: 2020 2020 2245 7865 6375 7469 7665 222c      "Executive",
+00019c70: 2020 2320 6361 7365 2076 6172 6961 7469    # case variati
+00019c80: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
+00019c90: 2020 2020 2020 2320 2246 7265 7175 656e        # "Frequen
+00019ca0: 746c 7920 4173 6b65 6420 5175 6573 7469  tly Asked Questi
+00019cb0: 6f6e 7322 2c20 2320 6e6f 7420 696e 2043  ons", # not in C
+00019cc0: 6861 7074 6572 3031 0a20 2020 2020 2020  hapter01.       
+00019cd0: 2020 2020 2020 2020 2020 2020 2246 7265              "Fre
+00019ce0: 7175 656e 746c 7922 2c20 2023 2063 6173  quently",  # cas
+00019cf0: 6520 7661 7269 6174 696f 6e0a 2020 2020  e variation.    
+00019d00: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00019d10: 5265 6665 7265 6e63 6573 222c 0a20 2020  References",.   
+00019d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d30: 5d0a 2020 2020 2020 2020 6973 5f62 6f6c  ].        is_bol
+00019d40: 6420 3d20 5472 7565 0a20 2020 2020 2020  d = True.       
+00019d50: 2066 6f6e 745f 7369 7a65 5f72 616e 6765   font_size_range
+00019d60: 203d 2028 3132 2c20 3939 3929 0a20 2020   = (12, 999).   
+00019d70: 2020 2020 2066 6f72 206d 6172 6b65 7220       for marker 
+00019d80: 696e 206d 6172 6b65 7273 3a0a 2020 2020  in markers:.    
+00019d90: 2020 2020 2020 2020 6d61 726b 6564 5f64          marked_d
+00019da0: 6976 2c20 6469 7673 203d 2063 6c73 2e67  iv, divs = cls.g
+00019db0: 6574 5f64 6976 5f73 7061 6e5f 7374 6172  et_div_span_star
+00019dc0: 7469 6e67 5f77 6974 6828 656c 656d 2c20  ting_with(elem, 
+00019dd0: 6d61 726b 6572 2c20 6973 5f62 6f6c 642c  marker, is_bold,
+00019de0: 2066 6f6e 745f 7369 7a65 5f72 616e 6765   font_size_range
+00019df0: 3d66 6f6e 745f 7369 7a65 5f72 616e 6765  =font_size_range
+00019e00: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00019e10: 206d 6172 6b65 645f 6469 7620 6973 206e   marked_div is n
+00019e20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00019e30: 2020 2020 2020 2020 206c 6420 3d20 6c65           ld = le
+00019e40: 6e28 6469 7673 2920 6966 2064 6976 7320  n(divs) if divs 
+00019e50: 656c 7365 2030 0a20 2020 2020 2020 2020  else 0.         
+00019e60: 2020 2020 2020 206c 6f67 6769 6e67 2e77         logging.w
+00019e70: 6172 6e69 6e67 2866 2243 616e 6e6f 7420  arning(f"Cannot 
+00019e80: 6669 6e64 206d 6172 6b65 7220 5b7b 6d61  find marker [{ma
+00019e90: 726b 6572 7d5d 2066 6f75 6e64 207b 6c64  rker}] found {ld
+00019ea0: 7d20 6d61 726b 6572 7322 290a 0a20 2020  } markers")..   
+00019eb0: 2020 2020 2063 6c61 7373 5f64 6963 7420       class_dict 
+00019ec0: 3d20 7b63 6c73 2e43 4841 5053 4543 3a20  = {cls.CHAPSEC: 
+00019ed0: 636c 732e 5052 455f 4348 4150 5345 432c  cls.PRE_CHAPSEC,
+00019ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019ef0: 2020 2020 2020 2063 6c73 2e54 4f50 5f44         cls.TOP_D
+00019f00: 4956 3a20 636c 732e 5452 4545 5f52 4f4f  IV: cls.TREE_ROO
+00019f10: 542c 207d 0a20 2020 2020 2020 2072 6563  T, }.        rec
+00019f20: 203d 2072 6563 735f 6279 5f73 6563 7469   = recs_by_secti
+00019f30: 6f6e 2e67 6574 2863 6c73 2e43 4841 505f  on.get(cls.CHAP_
+00019f40: 544f 5029 0a20 2020 2020 2020 2061 7373  TOP).        ass
+00019f50: 6572 7420 7265 6320 6973 206e 6f74 204e  ert rec is not N
+00019f60: 6f6e 652c 2066 2277 616e 7465 6420 6e6f  one, f"wanted no
+00019f70: 6e2d 4e6f 6e65 207b 636c 732e 4348 4150  n-None {cls.CHAP
+00019f80: 5f54 4f50 7d20 7265 6322 0a20 2020 2020  _TOP} rec".     
+00019f90: 2020 2064 6563 696d 616c 5f64 6976 7320     decimal_divs 
+00019fa0: 3d20 636c 732e 6765 745f 6469 765f 7370  = cls.get_div_sp
+00019fb0: 616e 735f 7769 7468 5f64 6563 696d 616c  ans_with_decimal
+00019fc0: 7328 656c 656d 2c0a 2020 2020 2020 2020  s(elem,.        
 00019fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00019fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019ff0: 2020 2069 735f 626f 6c64 2c0a 2020 2020     is_bold,.    
-0001a000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ff0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001a000: 735f 626f 6c64 2c0a 2020 2020 2020 2020  s_bold,.        
 0001a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a030: 2020 2066 6f6e 745f 7369 7a65 5f72 616e     font_size_ran
-0001a040: 6765 3d66 6f6e 745f 7369 7a65 5f72 616e  ge=font_size_ran
-0001a050: 6765 2c0a 2020 2020 2020 2020 2020 2020  ge,.            
+0001a030: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001a040: 6f6e 745f 7369 7a65 5f72 616e 6765 3d66  ont_size_range=f
+0001a050: 6f6e 745f 7369 7a65 5f72 616e 6765 2c0a  ont_size_range,.
 0001a060: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001a070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a080: 2020 2020 2020 2020 2020 2073 6563 7469             secti
-0001a090: 6f6e 5f72 6563 3d72 6563 2c20 636c 6173  on_rec=rec, clas
-0001a0a0: 735f 6469 6374 3d63 6c61 7373 5f64 6963  s_dict=class_dic
-0001a0b0: 7429 0a20 2020 2020 2020 2063 6c73 2e63  t).        cls.c
-0001a0c0: 7265 6174 655f 6669 6c65 6e61 6d65 5f61  reate_filename_a
-0001a0d0: 6e64 5f6f 7574 7075 7428 6465 6369 6d61  nd_output(decima
-0001a0e0: 6c5f 6469 7673 2c20 6f75 7470 7574 5f64  l_divs, output_d
-0001a0f0: 6972 290a 0a20 2020 2023 2063 6c61 7373  ir)..    # class
-0001a100: 2048 746d 6c54 7265 650a 0a20 2020 2040   HtmlTree..    @
-0001a110: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-0001a120: 6465 6620 6372 6561 7465 5f66 696c 656e  def create_filen
-0001a130: 616d 655f 616e 645f 6f75 7470 7574 2863  ame_and_output(c
-0001a140: 6c73 2c20 6465 6369 6d61 6c5f 6469 7673  ls, decimal_divs
-0001a150: 2c20 6f75 7470 7574 5f64 6972 2c0a 2020  , output_dir,.  
-0001a160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a090: 2020 2020 2020 2073 6563 7469 6f6e 5f72         section_r
+0001a0a0: 6563 3d72 6563 2c20 636c 6173 735f 6469  ec=rec, class_di
+0001a0b0: 6374 3d63 6c61 7373 5f64 6963 7429 0a20  ct=class_dict). 
+0001a0c0: 2020 2020 2020 2063 6c73 2e63 7265 6174         cls.creat
+0001a0d0: 655f 6669 6c65 6e61 6d65 5f61 6e64 5f6f  e_filename_and_o
+0001a0e0: 7574 7075 7428 6465 6369 6d61 6c5f 6469  utput(decimal_di
+0001a0f0: 7673 2c20 6f75 7470 7574 5f64 6972 290a  vs, output_dir).
+0001a100: 0a20 2020 2023 2063 6c61 7373 2048 746d  .    # class Htm
+0001a110: 6c54 7265 650a 0a20 2020 2040 636c 6173  lTree..    @clas
+0001a120: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+0001a130: 6372 6561 7465 5f66 696c 656e 616d 655f  create_filename_
+0001a140: 616e 645f 6f75 7470 7574 2863 6c73 2c20  and_output(cls, 
+0001a150: 6465 6369 6d61 6c5f 6469 7673 2c20 6f75  decimal_divs, ou
+0001a160: 7470 7574 5f64 6972 2c0a 2020 2020 2020  tput_dir,.      
 0001a170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a180: 206f 7269 673d 2220 215c 2223 2425 2627   orig=" !\"#$%&'
-0001a190: 2829 2a2b 2c2f 3a3b 3c3d 3e3f 405b 5c5c  ()*+,/:;<=>?@[\\
-0001a1a0: 5d5e 607b 7c7d 7e22 2c20 7265 703d 225f  ]^`{|}~", rep="_
-0001a1b0: 2229 3a0a 2020 2020 2020 2020 2222 220a  "):.        """.
-0001a1c0: 2020 2020 2020 2020 6372 6561 7465 2066          create f
-0001a1d0: 696c 656e 616d 6520 6672 6f6d 2073 6563  ilename from sec
-0001a1e0: 7469 6f6e 206e 616d 652c 2072 6570 6c61  tion name, repla
-0001a1f0: 6365 2070 756e 6374 2063 6861 7261 6374  ce punct charact
-0001a200: 6572 730a 2020 2020 2020 2020 2222 220a  ers.        """.
-0001a210: 2020 2020 2020 2020 6966 206f 7574 7075          if outpu
-0001a220: 745f 6469 723a 0a20 2020 2020 2020 2020  t_dir:.         
-0001a230: 2020 206f 7574 7075 745f 6469 7220 3d20     output_dir = 
-0001a240: 5061 7468 286f 7574 7075 745f 6469 7229  Path(output_dir)
-0001a250: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-0001a260: 7075 745f 6469 722e 6d6b 6469 7228 6578  put_dir.mkdir(ex
-0001a270: 6973 745f 6f6b 3d54 7275 6529 0a0a 2020  ist_ok=True)..  
-0001a280: 2020 2020 2020 2020 2020 7075 6e63 745f            punct_
-0001a290: 6d61 736b 203d 2055 7469 6c2e 6d61 6b65  mask = Util.make
-0001a2a0: 5f74 7261 6e73 6c61 7465 5f6d 6173 6b5f  _translate_mask_
-0001a2b0: 746f 5f63 6861 7228 6f72 6967 2c20 7265  to_char(orig, re
-0001a2c0: 7029 0a20 2020 2020 2020 2020 2020 2066  p).            f
-0001a2d0: 6f72 2069 2c20 6368 696c 645f 6469 7620  or i, child_div 
-0001a2e0: 696e 2065 6e75 6d65 7261 7465 2864 6563  in enumerate(dec
-0001a2f0: 696d 616c 5f64 6976 7329 3a0a 2020 2020  imal_divs):.    
-0001a300: 2020 2020 2020 2020 2020 2020 636c 732e              cls.
-0001a310: 6372 6561 7465 5f66 696c 656e 616d 655f  create_filename_
-0001a320: 7265 6d6f 7665 5f70 756e 6374 5f61 6e64  remove_punct_and
-0001a330: 5f6f 7574 7075 7428 6368 696c 645f 6469  _output(child_di
-0001a340: 762c 206f 7574 7075 745f 6469 722c 2070  v, output_dir, p
-0001a350: 756e 6374 5f6d 6173 6b29 0a0a 2020 2020  unct_mask)..    
-0001a360: 2320 636c 6173 7320 4874 6d6c 5472 6565  # class HtmlTree
-0001a370: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-0001a380: 6f64 0a20 2020 2064 6566 2063 7265 6174  od.    def creat
-0001a390: 655f 6669 6c65 6e61 6d65 5f72 656d 6f76  e_filename_remov
-0001a3a0: 655f 7075 6e63 745f 616e 645f 6f75 7470  e_punct_and_outp
-0001a3b0: 7574 2863 6c73 2c20 6368 696c 645f 6469  ut(cls, child_di
-0001a3c0: 762c 206f 7574 7075 745f 6469 722c 2070  v, output_dir, p
-0001a3d0: 756e 6374 5f6d 6173 6b29 3a0a 2020 2020  unct_mask):.    
-0001a3e0: 2020 2020 2222 226e 6f74 2073 7572 6520      """not sure 
-0001a3f0: 7768 6174 2074 6869 7320 646f 6573 203f  what this does ?
-0001a400: 4874 6d6c 5574 696c 2e4d 4152 4b45 5220  HtmlUtil.MARKER 
-0001a410: 2222 220a 2020 2020 2020 2020 6966 2048  """.        if H
-0001a420: 746d 6c55 7469 6c2e 4d41 524b 4552 2069  tmlUtil.MARKER i
-0001a430: 6e20 6368 696c 645f 6469 762e 6174 7472  n child_div.attr
-0001a440: 6962 3a0a 2020 2020 2020 2020 2020 2020  ib:.            
-0001a450: 6d61 726b 6572 203d 2063 6869 6c64 5f64  marker = child_d
-0001a460: 6976 2e61 7474 7269 625b 4874 6d6c 5574  iv.attrib[HtmlUt
-0001a470: 696c 2e4d 4152 4b45 525d 0a20 2020 2020  il.MARKER].     
-0001a480: 2020 2020 2020 206d 6172 6b65 7220 3d20         marker = 
-0001a490: 6d61 726b 6572 2e73 7472 6970 2829 2e6c  marker.strip().l
-0001a4a0: 6f77 6572 2829 2020 2320 6e61 6d65 2066  ower()  # name f
-0001a4b0: 726f 6d20 7465 7874 2063 6f6e 7465 6e74  rom text content
-0001a4c0: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
-0001a4d0: 6b65 722e 7472 616e 736c 6174 6528 7075  ker.translate(pu
-0001a4e0: 6e63 745f 6d61 736b 290a 2020 2020 2020  nct_mask).      
-0001a4f0: 2020 2020 2020 7061 7468 203d 2050 6174        path = Pat
-0001a500: 6828 6f75 7470 7574 5f64 6972 2c20 6622  h(output_dir, f"
-0001a510: 7b6d 6172 6b65 727d 2e68 746d 6c22 290a  {marker}.html").
-0001a520: 2020 2020 2020 2020 2020 2020 7769 7468              with
-0001a530: 206f 7065 6e28 7061 7468 2c20 2277 6222   open(path, "wb"
-0001a540: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
-0001a550: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
-0001a560: 4554 2e74 6f73 7472 696e 6728 6368 696c  ET.tostring(chil
-0001a570: 645f 6469 762c 2070 7265 7474 795f 7072  d_div, pretty_pr
-0001a580: 696e 743d 5472 7565 2929 0a0a 2020 2020  int=True))..    
-0001a590: 2320 636c 6173 7320 4874 6d6c 5472 6565  # class HtmlTree
-0001a5a0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-0001a5b0: 6f64 0a20 2020 2064 6566 2067 6574 5f64  od.    def get_d
-0001a5c0: 6976 5f73 7061 6e5f 7374 6172 7469 6e67  iv_span_starting
-0001a5d0: 5f77 6974 6828 636c 732c 2065 6c65 6d2c  _with(cls, elem,
-0001a5e0: 2073 7472 672c 2069 735f 626f 6c64 3d46   strg, is_bold=F
-0001a5f0: 616c 7365 2c20 666f 6e74 5f73 697a 655f  alse, font_size_
-0001a600: 7261 6e67 653d 4e6f 6e65 293a 0a20 2020  range=None):.   
-0001a610: 2020 2020 2072 6573 756c 7420 3d20 4e6f       result = No
-0001a620: 6e65 0a20 2020 2020 2020 2078 7061 7468  ne.        xpath
-0001a630: 203d 2066 222e 2f2f 6469 765b 7370 616e   = f".//div[span
-0001a640: 5b73 7461 7274 732d 7769 7468 282e 2c27  [starts-with(.,'
-0001a650: 7b73 7472 677d 2729 5d5d 220a 2020 2020  {strg}')]]".    
-0001a660: 2020 2020 6469 7673 203d 2065 6c65 6d2e      divs = elem.
-0001a670: 7870 6174 6828 7870 6174 6829 0a20 2020  xpath(xpath).   
-0001a680: 2020 2020 2069 6620 6c65 6e28 6469 7673       if len(divs
-0001a690: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-0001a6a0: 2020 2020 6c6f 6767 696e 672e 7761 726e      logging.warn
-0001a6b0: 696e 6728 6622 4e6f 2064 6976 7320 7769  ing(f"No divs wi
-0001a6c0: 7468 207b 7374 7267 7d22 290a 2020 2020  th {strg}").    
-0001a6d0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-0001a6e0: 6573 756c 742c 204e 6f6e 650a 2020 2020  esult, None.    
-0001a6f0: 2020 2020 6e65 775f 6469 7673 203d 205b      new_divs = [
-0001a700: 5d0a 2020 2020 2020 2020 666f 7220 6469  ].        for di
-0001a710: 7620 696e 2064 6976 733a 0a20 2020 2020  v in divs:.     
-0001a720: 2020 2020 2020 2073 7061 6e73 203d 2064         spans = d
-0001a730: 6976 2e78 7061 7468 2822 2e2f 7370 616e  iv.xpath("./span
-0001a740: 2229 0a20 2020 2020 2020 2020 2020 2069  ").            i
-0001a750: 6620 7370 616e 733a 0a20 2020 2020 2020  f spans:.       
-0001a760: 2020 2020 2020 2020 2063 7373 5f73 7479           css_sty
-0001a770: 6c65 203d 2043 5353 5374 796c 652e 6372  le = CSSStyle.cr
-0001a780: 6561 7465 5f63 7373 5f73 7479 6c65 5f66  eate_css_style_f
-0001a790: 726f 6d5f 6174 7472 6962 7574 655f 6f66  rom_attribute_of
-0001a7a0: 5f62 6f64 795f 656c 656d 656e 7428 7370  _body_element(sp
-0001a7b0: 616e 735b 305d 290a 2020 2020 2020 2020  ans[0]).        
-0001a7c0: 2020 2020 2020 2020 6966 206e 6f74 2028          if not (
-0001a7d0: 6973 5f62 6f6c 6420 616e 6420 6373 735f  is_bold and css_
-0001a7e0: 7374 796c 652e 6973 5f62 6f6c 645f 6e61  style.is_bold_na
-0001a7f0: 6d65 2829 293a 0a20 2020 2020 2020 2020  me()):.         
-0001a800: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
-0001a810: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
-0001a820: 2020 2020 6966 206e 6f74 2028 666f 6e74      if not (font
-0001a830: 5f73 697a 655f 7261 6e67 6520 616e 6420  _size_range and 
-0001a840: 636c 732e 696e 5f72 616e 6765 2863 7373  cls.in_range(css
-0001a850: 5f73 7479 6c65 2e66 6f6e 745f 7369 7a65  _style.font_size
-0001a860: 2c20 666f 6e74 5f73 697a 655f 7261 6e67  , font_size_rang
-0001a870: 6529 293a 0a20 2020 2020 2020 2020 2020  e)):.           
-0001a880: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-0001a890: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001a8a0: 2020 6e65 775f 6469 7673 2e61 7070 656e    new_divs.appen
-0001a8b0: 6428 6469 7629 0a20 2020 2020 2020 2020  d(div).         
-0001a8c0: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-0001a8d0: 2020 2020 6469 7673 203d 206e 6577 5f64      divs = new_d
-0001a8e0: 6976 730a 2020 2020 2020 2020 2320 616c  ivs.        # al
-0001a8f0: 736f 2074 6573 7420 666f 6e74 2068 6572  so test font her
-0001a900: 6520 4e59 490a 2020 2020 2020 2020 6966  e NYI.        if
-0001a910: 206c 656e 2864 6976 7329 203d 3d20 303a   len(divs) == 0:
-0001a920: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-0001a930: 6769 6e67 2e77 6172 6e69 6e67 2866 2263  ging.warning(f"c
-0001a940: 616e 6e6f 7420 6669 6e64 2064 6976 3a20  annot find div: 
-0001a950: 6c65 6e3d 7b6c 656e 2864 6976 7329 7d22  len={len(divs)}"
-0001a960: 290a 2020 2020 2020 2020 656c 6966 206c  ).        elif l
-0001a970: 656e 2864 6976 7329 203e 2031 3a0a 2020  en(divs) > 1:.  
-0001a980: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
-0001a990: 672e 7761 726e 696e 6728 6622 746f 6f20  g.warning(f"too 
-0001a9a0: 6d61 6e79 2064 6976 733a 206c 656e 3d7b  many divs: len={
-0001a9b0: 6c65 6e28 6469 7673 297d 2229 0a20 2020  len(divs)}").   
-0001a9c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001a9d0: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0001a9e0: 6469 7673 5b30 5d0a 2020 2020 2020 2020  divs[0].        
-0001a9f0: 2020 2020 7265 7375 6c74 2e61 7474 7269      result.attri
-0001aa00: 625b 226d 6172 6b65 7222 5d20 3d20 7374  b["marker"] = st
-0001aa10: 7267 0a20 2020 2020 2020 2072 6574 7572  rg.        retur
-0001aa20: 6e20 7265 7375 6c74 2c20 6469 7673 0a0a  n result, divs..
-0001aa30: 2020 2020 2320 636c 6173 7320 4874 6d6c      # class Html
-0001aa40: 5472 6565 0a0a 2020 2020 4063 6c61 7373  Tree..    @class
-0001aa50: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
-0001aa60: 6574 5f64 6976 5f73 7061 6e73 5f77 6974  et_div_spans_wit
-0001aa70: 685f 6465 6369 6d61 6c73 2863 6c73 2c20  h_decimals(cls, 
-0001aa80: 656c 656d 2c20 6973 5f62 6f6c 643d 4e6f  elem, is_bold=No
-0001aa90: 6e65 2c20 666f 6e74 5f73 697a 655f 7261  ne, font_size_ra
-0001aaa0: 6e67 653d 4e6f 6e65 2c20 636c 6173 735f  nge=None, class_
-0001aab0: 6469 6374 3d4e 6f6e 652c 2073 6563 7469  dict=None, secti
-0001aac0: 6f6e 5f72 6563 3d4e 6f6e 6529 3a0a 2020  on_rec=None):.  
-0001aad0: 2020 2020 2020 2222 224d 6174 6368 6573        """Matches
-0001aae0: 2064 6976 2f73 7061 6e20 7374 6172 7469   div/span starti
-0001aaf0: 6e67 2077 6974 6820 6120 6465 6369 6d61  ng with a decima
-0001ab00: 6c20 696e 6465 780a 2020 2020 2020 2020  l index.        
-0001ab10: 642e 6420 6f72 2064 2e64 2e64 0a20 2020  d.d or d.d.d.   
-0001ab20: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001ab30: 2072 6573 756c 7420 3d20 4e6f 6e65 0a20   result = None. 
-0001ab40: 2020 2020 2020 2023 2066 6972 7374 2061         # first a
-0001ab50: 6464 2061 6c6c 206d 6174 6368 696e 6720  dd all matching 
-0001ab60: 6e75 6d62 6572 6564 2064 6976 7320 746f  numbered divs to
-0001ab70: 2070 7265 5f63 6861 7073 6563 0a20 2020   pre_chapsec.   
-0001ab80: 2020 2020 2069 6620 6e6f 7420 636c 6173       if not clas
-0001ab90: 735f 6469 6374 3a0a 2020 2020 2020 2020  s_dict:.        
-0001aba0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0001abb0: 7272 6f72 2866 226d 6973 7369 6e67 2063  rror(f"missing c
-0001abc0: 6c61 7373 5f64 6963 7422 290a 2020 2020  lass_dict").    
-0001abd0: 2020 2020 746f 705f 6469 7620 3d20 4554      top_div = ET
-0001abe0: 2e53 7562 456c 656d 656e 7428 656c 656d  .SubElement(elem
-0001abf0: 2c20 485f 4449 5629 0a20 2020 2020 2020  , H_DIV).       
-0001ac00: 2074 6f70 5f64 6976 2e61 7474 7269 625b   top_div.attrib[
-0001ac10: 636c 732e 434c 4153 535d 203d 2063 6c61  cls.CLASS] = cla
-0001ac20: 7373 5f64 6963 742e 6765 7428 4874 6d6c  ss_dict.get(Html
-0001ac30: 5472 6565 2e54 4f50 5f44 4956 290a 2020  Tree.TOP_DIV).  
-0001ac40: 2020 2020 2020 7072 655f 6368 6170 7365        pre_chapse
-0001ac50: 6320 3d20 4554 2e53 7562 456c 656d 656e  c = ET.SubElemen
-0001ac60: 7428 746f 705f 6469 762c 2048 5f44 4956  t(top_div, H_DIV
-0001ac70: 290a 2020 2020 2020 2020 7072 655f 6368  ).        pre_ch
-0001ac80: 6170 7365 632e 6174 7472 6962 5b63 6c73  apsec.attrib[cls
-0001ac90: 2e43 4c41 5353 5d20 3d20 636c 6173 735f  .CLASS] = class_
-0001aca0: 6469 6374 2e67 6574 2848 746d 6c54 7265  dict.get(HtmlTre
-0001acb0: 652e 4348 4150 5345 4329 0a20 2020 2020  e.CHAPSEC).     
-0001acc0: 2020 2063 7572 7265 6e74 5f64 6976 203d     current_div =
-0001acd0: 2070 7265 5f63 6861 7073 6563 0a0a 2020   pre_chapsec..  
-0001ace0: 2020 2020 2020 2320 6974 6572 6174 6520        # iterate 
-0001acf0: 6f76 6572 2061 6c6c 2064 6976 732c 206f  over all divs, o
-0001ad00: 6e6c 7920 6170 7065 6e64 2074 686f 7365  nly append those
-0001ad10: 2077 6974 6820 6465 6369 6d61 6c0a 2020   with decimal.  
-0001ad20: 2020 2020 2020 6469 7673 203d 2065 6c65        divs = ele
-0001ad30: 6d2e 7870 6174 6828 636c 732e 414c 4c5f  m.xpath(cls.ALL_
-0001ad40: 4449 565f 5850 4154 4853 290a 2020 2020  DIV_XPATHS).    
-0001ad50: 2020 2020 6465 6369 6d61 6c5f 636f 756e      decimal_coun
-0001ad60: 7420 3d20 300a 2020 2020 2020 2020 7465  t = 0.        te
-0001ad70: 7874 7320 3d20 5b5d 2020 2320 6a75 7374  xts = []  # just
-0001ad80: 2061 2063 6865 636b 2061 7420 7072 6573   a check at pres
-0001ad90: 656e 740a 2020 2020 2020 2020 666f 7220  ent.        for 
-0001ada0: 6469 7620 696e 2064 6976 733a 0a20 2020  div in divs:.   
-0001adb0: 2020 2020 2020 2020 2073 7061 6e73 203d           spans =
-0001adc0: 2064 6976 2e78 7061 7468 2822 2e2f 7370   div.xpath("./sp
-0001add0: 616e 2229 0a20 2020 2020 2020 2020 2020  an").           
-0001ade0: 2069 6620 6e6f 7420 7370 616e 733a 0a20   if not spans:. 
-0001adf0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001ae00: 206e 6f20 7370 616e 732c 2063 6f6e 6361   no spans, conca
-0001ae10: 7465 6e61 7465 2077 6974 6820 7369 626c  tenate with sibl
-0001ae20: 696e 6773 0a20 2020 2020 2020 2020 2020  ings.           
-0001ae30: 2020 2020 2069 6620 6469 7620 3d3d 2063       if div == c
-0001ae40: 7572 7265 6e74 5f64 6976 3a0a 2020 2020  urrent_div:.    
-0001ae50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ae60: 6c6f 6767 696e 672e 7761 726e 696e 6728  logging.warning(
-0001ae70: 2266 2063 616e 6e6f 7420 6170 7065 6e64  "f cannot append
-0001ae80: 2064 6976 207b 6469 767d 2074 6f20 6974   div {div} to it
-0001ae90: 7365 6c66 2229 0a20 2020 2020 2020 2020  self").         
-0001aea0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001aeb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aec0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0001aed0: 2020 2020 2020 2020 2020 2020 2020 6375                cu
-0001aee0: 7272 656e 745f 6469 762e 6170 7065 6e64  rrent_div.append
-0001aef0: 2864 6976 290a 2020 2020 2020 2020 2020  (div).          
-0001af00: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0001af10: 2056 616c 7565 4572 726f 7220 6173 2076   ValueError as v
-0001af20: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001af30: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
-0001af40: 6e67 2e65 7272 6f72 2866 2245 7272 6f72  ng.error(f"Error
-0001af50: 207b 7665 7d22 290a 2020 2020 2020 2020   {ve}").        
-0001af60: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0001af70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af80: 2063 7572 7265 6e74 5f64 6976 2e61 7070   current_div.app
-0001af90: 656e 6428 6469 7629 0a20 2020 2020 2020  end(div).       
-0001afa0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-0001afb0: 4578 6365 7074 696f 6e20 6173 2065 3a0a  Exception as e:.
-0001afc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afd0: 2020 2020 6c6f 6767 696e 672e 6572 726f      logging.erro
-0001afe0: 7228 6622 4255 4720 736b 6970 7065 6422  r(f"BUG skipped"
-0001aff0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001b000: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0001b010: 2020 2020 2020 2063 7373 5f73 7479 6c65         css_style
-0001b020: 203d 2043 5353 5374 796c 652e 6372 6561   = CSSStyle.crea
-0001b030: 7465 5f63 7373 5f73 7479 6c65 5f66 726f  te_css_style_fro
-0001b040: 6d5f 6174 7472 6962 7574 655f 6f66 5f62  m_attribute_of_b
-0001b050: 6f64 795f 656c 656d 656e 7428 7370 616e  ody_element(span
-0001b060: 735b 305d 2920 2023 206e 6f72 6d61 6c6c  s[0])  # normall
-0001b070: 7920 636f 6d65 7320 6669 7273 740a 2020  y comes first.  
-0001b080: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
-0001b090: 6b20 7765 6967 6874 2c20 6966 206e 6f6e  k weight, if non
-0001b0a0: 6520 6170 7065 6e64 2074 6f20 7369 626c  e append to sibl
-0001b0b0: 696e 6773 0a20 2020 2020 2020 2020 2020  ings.           
-0001b0c0: 2069 6620 6e6f 7420 2869 735f 626f 6c64   if not (is_bold
-0001b0d0: 2061 6e64 2063 7373 5f73 7479 6c65 2e69   and css_style.i
-0001b0e0: 735f 626f 6c64 5f6e 616d 6528 2929 3a0a  s_bold_name()):.
-0001b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b100: 6375 7272 656e 745f 6469 762e 6170 7065  current_div.appe
-0001b110: 6e64 2864 6976 290a 2020 2020 2020 2020  nd(div).        
-0001b120: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-0001b130: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
-0001b140: 6865 636b 2066 6f6e 742d 7369 7a65 2c20  heck font-size, 
-0001b150: 6966 206e 6f6e 6520 6170 7065 6e64 2074  if none append t
-0001b160: 6f20 7369 626c 696e 6773 0a20 2020 2020  o siblings.     
-0001b170: 2020 2020 2020 2069 6620 6e6f 7420 2866         if not (f
-0001b180: 6f6e 745f 7369 7a65 5f72 616e 6765 2061  ont_size_range a
-0001b190: 6e64 2063 6c73 2e69 6e5f 7261 6e67 6528  nd cls.in_range(
-0001b1a0: 6373 735f 7374 796c 652e 666f 6e74 5f73  css_style.font_s
-0001b1b0: 697a 652c 2066 6f6e 745f 7369 7a65 5f72  ize, font_size_r
-0001b1c0: 616e 6765 2929 3a0a 2020 2020 2020 2020  ange)):.        
-0001b1d0: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-0001b1e0: 6469 762e 6170 7065 6e64 2864 6976 290a  div.append(div).
-0001b1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b200: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-0001b210: 2020 2020 2023 2073 7061 6e20 636f 6e74       # span cont
-0001b220: 656e 740a 2020 2020 2020 2020 2020 2020  ent.            
-0001b230: 7465 7874 203d 2048 746d 6c55 7469 6c2e  text = HtmlUtil.
-0001b240: 6765 745f 7465 7874 5f63 6f6e 7465 6e74  get_text_content
-0001b250: 2873 7061 6e73 5b30 5d29 0a20 2020 2020  (spans[0]).     
-0001b260: 2020 2020 2020 206d 6174 6368 6564 203d         matched =
-0001b270: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-0001b280: 2020 2069 6620 7365 6374 696f 6e5f 7265     if section_re
-0001b290: 632e 6d61 7463 6828 7465 7874 293a 0a20  c.match(text):. 
-0001b2a0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001b2b0: 6f70 5f64 6976 2e61 7070 656e 6428 6375  op_div.append(cu
-0001b2c0: 7272 656e 745f 6469 7629 0a20 2020 2020  rrent_div).     
-0001b2d0: 2020 2020 2020 2020 2020 2074 6578 7473             texts
-0001b2e0: 2e61 7070 656e 6428 7465 7874 290a 2020  .append(text).  
-0001b2f0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-0001b300: 762e 6174 7472 6962 5b48 746d 6c55 7469  v.attrib[HtmlUti
-0001b310: 6c2e 4d41 524b 4552 5d20 3d20 7465 7874  l.MARKER] = text
-0001b320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b330: 2063 7572 7265 6e74 5f64 6976 203d 2064   current_div = d
-0001b340: 6976 0a20 2020 2020 2020 2020 2020 2020  iv.             
-0001b350: 2020 2064 6563 696d 616c 5f63 6f75 6e74     decimal_count
-0001b360: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
-0001b370: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001b380: 2020 2020 2020 2020 6375 7272 656e 745f          current_
-0001b390: 6469 762e 6170 7065 6e64 2864 6976 290a  div.append(div).
-0001b3a0: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-0001b3b0: 6f70 5f64 6976 0a0a 2020 2020 2320 636c  op_div..    # cl
-0001b3c0: 6173 7320 4874 6d6c 5472 6565 0a0a 2020  ass HtmlTree..  
-0001b3d0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-0001b3e0: 2020 2064 6566 2069 6e5f 7261 6e67 6528     def in_range(
-0001b3f0: 636c 732c 206e 756d 2c20 6e75 6d5f 7261  cls, num, num_ra
-0001b400: 6e67 6529 3a0a 2020 2020 2020 2020 2222  nge):.        ""
-0001b410: 2269 7320 6120 6e75 6d62 6572 2069 6e20  "is a number in 
-0001b420: 6120 6e75 6d65 7269 6320 7261 6e67 6522  a numeric range"
-0001b430: 2222 0a20 2020 2020 2020 2061 7373 6572  "".        asser
-0001b440: 7420 6e75 6d5f 7261 6e67 6520 6f72 206c  t num_range or l
-0001b450: 656e 286e 756d 5f72 616e 6765 2920 3d3d  en(num_range) ==
-0001b460: 2032 2c20 6622 7261 6e67 6520 6d75 7374   2, f"range must
-0001b470: 2068 6176 6520 3220 656c 656d 656e 7473   have 2 elements
-0001b480: 220a 2020 2020 2020 2020 6173 7365 7274  ".        assert
-0001b490: 206e 756d 5f72 616e 6765 5b30 5d20 3c3d   num_range[0] <=
-0001b4a0: 206e 756d 5f72 616e 6765 5b31 5d2c 2066   num_range[1], f
-0001b4b0: 2266 6f6e 745f 7369 7a65 5f72 616e 6765  "font_size_range
-0001b4c0: 206d 7573 7420 6265 2028 6c6f 7765 722c   must be (lower,
-0001b4d0: 6869 6768 6572 2922 0a20 2020 2020 2020  higher)".       
-0001b4e0: 2061 7373 6572 7420 666c 6f61 7428 6e75   assert float(nu
-0001b4f0: 6d5f 7261 6e67 655b 305d 290a 2020 2020  m_range[0]).    
-0001b500: 2020 2020 7265 7375 6c74 203d 206e 756d      result = num
-0001b510: 5f72 616e 6765 5b30 5d20 3c3d 206e 756d  _range[0] <= num
-0001b520: 203c 3d20 6e75 6d5f 7261 6e67 655b 315d   <= num_range[1]
-0001b530: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001b540: 7265 7375 6c74 0a0a 2020 2020 2320 636c  result..    # cl
-0001b550: 6173 7320 4874 6d6c 5472 6565 0a0a 2020  ass HtmlTree..  
-0001b560: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-0001b570: 2020 2064 6566 2067 6574 5f64 6563 696d     def get_decim
-0001b580: 616c 5f73 6563 7469 6f6e 7328 636c 732c  al_sections(cls,
-0001b590: 2068 746d 6c5f 656c 656d 2c20 7870 6174   html_elem, xpat
-0001b5a0: 683d 4e6f 6e65 2c20 7265 6765 783d 4e6f  h=None, regex=No
-0001b5b0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
-0001b5c0: 0a20 2020 2020 2020 2067 6574 7320 6465  .        gets de
-0001b5d0: 6369 6d61 6c20 7365 6374 696f 6e73 2069  cimal sections i
-0001b5e0: 6e20 656c 656d 7320 6f66 2066 6f72 6d20  n elems of form 
-0001b5f0: 312e 322c 2065 7463 0a20 2020 2020 2020  1.2, etc.       
-0001b600: 203a 7061 7261 6d20 6874 6d6c 5f65 6c65   :param html_ele
-0001b610: 6d3a 2065 6c65 6d65 6e74 2074 6f20 7365  m: element to se
-0001b620: 6172 6368 2066 6f72 2073 6563 7469 6f6e  arch for section
-0001b630: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
-0001b640: 2078 7061 7468 3a20 7365 6374 696e 7320   xpath: sectins 
-0001b650: 6d61 7920 6861 7665 2062 6565 6e20 6c61  may have been la
-0001b660: 6265 6c6c 6564 2077 6974 6820 4063 6c61  belled with @cla
-0001b670: 7373 206f 7220 7369 6d69 6c61 720a 2020  ss or similar.  
-0001b680: 2020 2020 2020 3a70 6172 616d 2072 6567        :param reg
-0001b690: 6578 3a20 7365 6374 696f 6e73 206d 6179  ex: sections may
-0001b6a0: 2062 6520 6469 7363 6f76 6572 6162 6c65   be discoverable
-0001b6b0: 2062 7920 7265 6765 782b 636f 6e74 656e   by regex+conten
-0001b6c0: 740a 2020 2020 2020 2020 3a72 6574 7572  t.        :retur
-0001b6d0: 6e3a 206c 6973 7420 6f66 2073 6563 7469  n: list of secti
-0001b6e0: 6f6e 7320 286d 6179 2062 6520 656d 7074  ons (may be empt
-0001b6f0: 7929 206f 7220 4e6f 6e65 0a20 2020 2020  y) or None.     
-0001b700: 2020 2049 7420 6973 206c 696b 656c 7920     It is likely 
-0001b710: 7468 6174 2061 2063 6f6d 6269 6e61 7469  that a combinati
-0001b720: 6f6e 206f 6620 7870 6174 6820 616e 6420  on of xpath and 
-0001b730: 7265 6765 7820 7769 6c6c 2062 6520 7573  regex will be us
-0001b740: 6564 2061 7320 7870 6174 680a 2020 2020  ed as xpath.    
-0001b750: 2020 2020 6d61 7920 6e6f 7420 6861 7665      may not have
-0001b760: 2072 6567 6578 0a20 2020 2020 2020 2022   regex.        "
-0001b770: 2222 0a20 2020 2020 2020 2069 6620 6874  "".        if ht
-0001b780: 6d6c 5f65 6c65 6d20 6973 204e 6f6e 653a  ml_elem is None:
-0001b790: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0001b7a0: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-0001b7b0: 2073 6563 7469 6f6e 7320 3d20 5b5d 0a20   sections = []. 
-0001b7c0: 2020 2020 2020 2069 6620 7870 6174 683a         if xpath:
-0001b7d0: 0a20 2020 2020 2020 2020 2020 2073 6563  .            sec
-0001b7e0: 7469 6f6e 7320 3d20 6874 6d6c 5f65 6c65  tions = html_ele
-0001b7f0: 6d2e 7870 6174 6828 7870 6174 6829 0a20  m.xpath(xpath). 
-0001b800: 2020 2020 2020 2069 6620 7265 6765 783a         if regex:
-0001b810: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-0001b820: 6769 6e67 2e77 6172 6e69 6e67 2866 2272  ging.warning(f"r
-0001b830: 6567 6578 206e 6f74 2079 6574 2064 6576  egex not yet dev
-0001b840: 656c 6f70 6564 2066 6f72 2073 6563 7469  eloped for secti
-0001b850: 6f6e 7322 290a 2020 2020 2020 2020 7265  ons").        re
-0001b860: 7475 726e 2073 6563 7469 6f6e 730a 0a0a  turn sections...
-0001b870: 5245 4353 5f42 595f 5345 4354 494f 4e20  RECS_BY_SECTION 
-0001b880: 3d20 7b0a 2020 2020 2320 4874 6d6c 5472  = {.    # HtmlTr
-0001b890: 6565 2e43 4841 505f 544f 503a 2049 5043  ee.CHAP_TOP: IPC
-0001b8a0: 435f 4348 4150 5f54 4f50 5f52 4543 2c20  C_CHAP_TOP_REC, 
-0001b8b0: 2320 7368 6f75 6c64 2062 6520 696e 6a65  # should be inje
-0001b8c0: 6374 6564 2062 7920 7573 6572 0a20 2020  cted by user.   
-0001b8d0: 2048 746d 6c54 7265 652e 4348 4150 5f54   HtmlTree.CHAP_T
-0001b8e0: 4f50 3a20 4348 4150 5f54 4f50 5f52 4543  OP: CHAP_TOP_REC
-0001b8f0: 2c20 2320 7368 6f75 6c64 2062 6520 696e  , # should be in
-0001b900: 6a65 6374 6564 2062 7920 7573 6572 0a20  jected by user. 
-0001b910: 2020 2048 746d 6c54 7265 652e 4348 4150     HtmlTree.CHAP
-0001b920: 5f53 4543 5449 4f4e 533a 2053 4543 5449  _SECTIONS: SECTI
-0001b930: 4f4e 535f 4445 4349 4d41 4c5f 5245 432c  ONS_DECIMAL_REC,
-0001b940: 0a20 2020 2048 746d 6c54 7265 652e 4348  .    HtmlTree.CH
-0001b950: 4150 5f53 5542 5345 4354 533a 2053 5542  AP_SUBSECTS: SUB
-0001b960: 5345 4354 535f 4445 4349 4d41 4c5f 5245  SECTS_DECIMAL_RE
-0001b970: 432c 0a7d 0a0a 0a63 6c61 7373 2048 544d  C,.}...class HTM
-0001b980: 4c53 6561 7263 6865 723a 0a20 2020 2022  LSearcher:.    "
-0001b990: 2222 0a20 2020 2049 2074 6869 6e6b 2074  "".    I think t
-0001b9a0: 6869 7320 6475 706c 6963 6174 6573 2073  his duplicates s
-0001b9b0: 6f6d 6520 6f66 204e 6f64 6545 7874 7261  ome of NodeExtra
-0001b9c0: 6374 6f72 2e0a 2020 2020 2222 220a 2020  ctor..    """.  
-0001b9d0: 2020 2222 220a 2020 2020 6d65 7468 6f64    """.    method
-0001b9e0: 7320 666f 7220 6669 6e64 696e 6720 6368  s for finding ch
-0001b9f0: 756e 6b73 2061 6e64 2073 7472 696e 6773  unks and strings
-0001ba00: 2069 6e20 4854 4d4c 2065 6c65 6d65 6e74   in HTML element
-0001ba10: 730a 0a20 2020 2045 7861 6d70 6c65 2074  s..    Example t
-0001ba20: 6578 743a 0a20 2020 203c 7370 616e 3e6f  ext:.    <span>o
-0001ba30: 6273 6572 7665 6420 696e 6372 6561 7365  bserved increase
-0001ba40: 7320 696e 2074 6865 206d 6f73 7420 7265  s in the most re
-0001ba50: 6365 6e74 2079 6561 7273 2028 4d69 6e78  cent years (Minx
-0001ba60: 2065 7420 616c 2e2c 2032 3032 313b 2055   et al., 2021; U
-0001ba70: 4e45 502c 2032 3032 3061 292e 0a20 2020  NEP, 2020a)..   
-0001ba80: 2032 3031 3920 4748 4720 656d 6973 7369   2019 GHG emissi
-0001ba90: 6f6e 7320 6c65 7665 6c73 2077 6572 6520  ons levels were 
-0001baa0: 6869 6768 6572 2063 6f6d 7061 7265 6420  higher compared 
-0001bab0: 746f 2031 3020 616e 6420 3330 2079 6561  to 10 and 30 yea
-0001bac0: 7273 2061 676f 2028 6869 6768 2063 6f6e  rs ago (high con
-0001bad0: 6669 6465 6e63 6529 3a20 6162 6f75 7420  fidence): about 
-0001bae0: 3132 2520 2836 2e35 2047 7443 4f32 6571  12% (6.5 GtCO2eq
-0001baf0: 290a 2020 2020 6869 6768 6572 2074 6861  ).    higher tha
-0001bb00: 6e20 696e 2032 3031 3020 2835 33c2 b135  n in 2010 (53..5
-0001bb10: 2e37 2047 7443 4f32 6571 2920 2841 5235  .7 GtCO2eq) (AR5
-0001bb20: 2072 6566 6572 656e 6365 2079 6561 7229   reference year)
-0001bb30: 2061 6e64 2061 626f 7574 2035 3425 2028   and about 54% (
-0001bb40: 3231 2047 7443 4f32 6571 2920 6869 6768  21 GtCO2eq) high
-0001bb50: 6572 2074 6861 6e20 696e 2031 3939 300a  er than in 1990.
-0001bb60: 2020 2020 2833 38c2 b134 2e38 2047 7443      (38..4.8 GtC
-0001bb70: 4f32 6571 2920 284b 796f 746f 2050 726f  O2eq) (Kyoto Pro
-0001bb80: 746f 636f 6c20 7265 6665 7265 6e63 6520  tocol reference 
-0001bb90: 7965 6172 2061 6e64 2066 7265 7175 656e  year and frequen
-0001bba0: 7420 4e44 4320 7265 6665 7265 6e63 6529  t NDC reference)
-0001bbb0: 3c2f 7370 616e 3e0a 2020 2020 2222 220a  </span>.    """.
-0001bbc0: 2020 2020 2222 220a 2020 2020 2222 220a      """.    """.
-0001bbd0: 0a20 2020 2023 2066 6f72 2074 6578 7420  .    # for text 
-0001bbe0: 7365 6172 6368 0a20 2020 2044 4546 4155  search.    DEFAU
-0001bbf0: 4c54 5f58 5041 5448 203d 2022 2f2f 7465  LT_XPATH = "//te
-0001bc00: 7874 2829 220a 2020 2020 4348 554e 4b5f  xt()".    CHUNK_
-0001bc10: 5245 203d 2022 6368 756e 6b5f 7265 2220  RE = "chunk_re" 
-0001bc20: 2023 2066 696e 6473 2074 6578 7420 6368   # finds text ch
-0001bc30: 756e 6b73 2069 6e20 7465 7874 0a20 2020  unks in text.   
-0001bc40: 2053 504c 4954 5445 525f 5245 203d 2022   SPLITTER_RE = "
-0001bc50: 7370 6c69 7474 6572 5f72 6522 2020 2320  splitter_re"  # 
-0001bc60: 7370 6c69 7473 2074 686f 7365 2063 6875  splits those chu
-0001bc70: 6e6b 7320 2865 2c67 2c20 636f 6d6d 612d  nks (e,g, comma-
-0001bc80: 7365 7061 7261 7465 6420 6c69 7374 730a  separated lists.
-0001bc90: 2020 2020 5355 424e 4f44 455f 5245 203d      SUBNODE_RE =
-0001bca0: 2022 7375 625f 6e6f 6465 5f72 655f 6c69   "sub_node_re_li
-0001bcb0: 7374 2220 2023 206d 6174 6368 6573 2074  st"  # matches t
-0001bcc0: 6865 2063 6f6d 706f 6e65 6e74 7320 6f66  he components of
-0001bcd0: 2074 6865 2073 706c 6974 206c 6973 7473   the split lists
-0001bce0: 0a20 2020 2055 4e4d 4154 4348 4544 203d  .    UNMATCHED =
-0001bcf0: 2022 756e 6d61 7463 6865 6422 2020 2320   "unmatched"  # 
-0001bd00: 6164 6473 2075 6e6d 6174 6368 6564 206e  adds unmatched n
-0001bd10: 6f64 6573 0a20 2020 2058 5041 5448 203d  odes.    XPATH =
-0001bd20: 2022 7870 6174 6822 0a0a 2020 2020 6465   "xpath"..    de
-0001bd30: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0001bd40: 2078 7061 7468 5f64 6963 743d 4e6f 6e65   xpath_dict=None
-0001bd50: 2c20 6469 6374 783d 4e6f 6e65 293a 0a20  , dictx=None):. 
-0001bd60: 2020 2020 2020 2073 656c 662e 6368 756e         self.chun
-0001bd70: 6b5f 6e6f 6465 5f64 6963 7420 3d20 6469  k_node_dict = di
-0001bd80: 6374 2829 0a20 2020 2020 2020 2073 656c  ct().        sel
-0001bd90: 662e 7870 6174 685f 6469 6374 203d 2064  f.xpath_dict = d
-0001bda0: 6963 7428 2920 6966 2078 7061 7468 5f64  ict() if xpath_d
-0001bdb0: 6963 7420 6973 204e 6f6e 6520 656c 7365  ict is None else
-0001bdc0: 2063 6f70 792e 6465 6570 636f 7079 2878   copy.deepcopy(x
-0001bdd0: 7061 7468 5f64 6963 7429 0a20 2020 2020  path_dict).     
-0001bde0: 2020 2073 656c 662e 6368 756e 6b5f 6469     self.chunk_di
-0001bdf0: 6374 203d 2064 6963 7428 290a 2020 2020  ct = dict().    
-0001be00: 2020 2020 7365 6c66 2e73 706c 6974 7465      self.splitte
-0001be10: 725f 6469 6374 203d 2064 6963 7428 290a  r_dict = dict().
-0001be20: 2020 2020 2020 2020 7365 6c66 2e73 7562          self.sub
-0001be30: 6e6f 6465 5f64 6963 7420 3d20 6469 6374  node_dict = dict
-0001be40: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
-0001be50: 6469 6374 7820 3d20 6469 6374 2829 2069  dictx = dict() i
-0001be60: 6620 6469 6374 7820 6973 204e 6f6e 6520  f dictx is None 
-0001be70: 656c 7365 2063 6f70 792e 6465 6570 636f  else copy.deepco
-0001be80: 7079 2864 6963 7478 290a 0a20 2020 2064  py(dictx)..    d
-0001be90: 6566 2073 6561 7263 685f 7061 7468 5f63  ef search_path_c
-0001bea0: 6875 6e6b 5f6e 6f64 6528 7365 6c66 2c20  hunk_node(self, 
-0001beb0: 6874 6d6c 5f70 6174 6829 3a0a 2020 2020  html_path):.    
-0001bec0: 2020 2020 6173 7365 7274 2068 746d 6c5f      assert html_
-0001bed0: 7061 7468 2e65 7869 7374 7328 292c 2066  path.exists(), f
-0001bee0: 227b 6874 6d6c 5f70 6174 687d 2073 686f  "{html_path} sho
-0001bef0: 756c 6420 6578 6973 7422 0a20 2020 2020  uld exist".     
-0001bf00: 2020 2074 7265 6520 3d20 4554 2e70 6172     tree = ET.par
-0001bf10: 7365 2873 7472 2868 746d 6c5f 7061 7468  se(str(html_path
-0001bf20: 2929 0a0a 2020 2020 2020 2020 7365 6c66  ))..        self
-0001bf30: 2e78 7061 7468 7320 3d20 7365 6c66 2e78  .xpaths = self.x
-0001bf40: 7061 7468 5f64 6963 742e 6765 7428 7365  path_dict.get(se
-0001bf50: 6c66 2e58 5041 5448 290a 2020 2020 2020  lf.XPATH).      
-0001bf60: 2020 6966 206e 6f74 2073 656c 662e 7870    if not self.xp
-0001bf70: 6174 6873 3a0a 2020 2020 2020 2020 2020  aths:.          
-0001bf80: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-0001bf90: 6f72 2866 2245 5252 4f52 206d 7573 7420  or(f"ERROR must 
-0001bfa0: 6769 7665 2078 7061 7468 2229 0a20 2020  give xpath").   
-0001bfb0: 2020 2020 2066 6f72 2078 7061 7468 2069       for xpath i
-0001bfc0: 6e20 7365 6c66 2e78 7061 7468 733a 0a20  n self.xpaths:. 
-0001bfd0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0001bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bff0: 6d61 7463 685f 656c 656d 656e 7473 203d  match_elements =
-0001c000: 2074 7265 652e 7870 6174 6828 7870 6174   tree.xpath(xpat
-0001c010: 6829 0a20 2020 2020 2020 2020 2020 2065  h).            e
-0001c020: 7863 6570 7420 4578 6365 7074 696f 6e20  xcept Exception 
-0001c030: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0001c040: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0001c050: 6545 7272 6f72 2866 2245 5252 4f52 2078  eError(f"ERROR x
-0001c060: 7061 7468 207b 7870 6174 687d 207b 657d  path {xpath} {e}
-0001c070: 2229 0a0a 2020 2020 2020 2020 7365 6c66  ")..        self
-0001c080: 2e65 6c65 6d65 6e74 5f6c 6973 7420 3d20  .element_list = 
-0001c090: 6c69 7374 2829 0a20 2020 2020 2020 2066  list().        f
-0001c0a0: 6f72 2078 7061 7468 2069 6e20 7365 6c66  or xpath in self
-0001c0b0: 2e78 7061 7468 733a 0a20 2020 2020 2020  .xpaths:.       
-0001c0c0: 2020 2020 206d 6174 6368 5f65 6c65 6d65       match_eleme
-0001c0d0: 6e74 7320 3d20 7472 6565 2e78 7061 7468  nts = tree.xpath
-0001c0e0: 2878 7061 7468 290a 2020 2020 2020 2020  (xpath).        
-0001c0f0: 2020 2020 666f 7220 6d61 7463 685f 656c      for match_el
-0001c100: 656d 656e 7420 696e 206d 6174 6368 5f65  ement in match_e
-0001c110: 6c65 6d65 6e74 733a 0a20 2020 2020 2020  lements:.       
-0001c120: 2020 2020 2020 2020 2074 203d 2074 7970           t = typ
-0001c130: 6528 6d61 7463 685f 656c 656d 656e 7429  e(match_element)
-0001c140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c150: 2069 6620 7420 6973 206e 6f74 205f 456c   if t is not _El
-0001c160: 656d 656e 743a 0a20 2020 2020 2020 2020  ement:.         
-0001c170: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001c180: 2056 616c 7565 4572 726f 7228 6622 6e6f   ValueError(f"no
-0001c190: 7420 616e 2065 6c65 6d65 6e74 207b 747d  t an element {t}
-0001c1a0: 207b 6d61 7463 685f 656c 656d 656e 747d   {match_element}
-0001c1b0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001c1c0: 2020 2073 656c 662e 656c 656d 656e 745f     self.element_
-0001c1d0: 6c69 7374 2e61 7070 656e 6428 6d61 7463  list.append(matc
-0001c1e0: 685f 656c 656d 656e 7429 0a0a 2020 2020  h_element)..    
-0001c1f0: 2020 2020 666f 7220 656c 656d 656e 7420      for element 
-0001c200: 696e 2073 656c 662e 656c 656d 656e 745f  in self.element_
-0001c210: 6c69 7374 3a0a 2020 2020 2020 2020 2020  list:.          
-0001c220: 2020 666f 7220 7465 7874 2069 6e20 656c    for text in el
-0001c230: 656d 656e 742e 7870 6174 6828 222e 2f74  ement.xpath("./t
-0001c240: 6578 7428 2922 293a 0a20 2020 2020 2020  ext()"):.       
-0001c250: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-0001c260: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001c270: 6e6f 6465 7374 7220 3d20 7365 6c66 2e73  nodestr = self.s
-0001c280: 656c 6563 745f 6368 756e 6b73 5f73 7562  elect_chunks_sub
-0001c290: 6368 756e 6b73 5f6e 6f64 6573 2874 6578  chunks_nodes(tex
-0001c2a0: 7429 0a0a 2020 2020 6465 6620 7365 6c65  t)..    def sele
-0001c2b0: 6374 5f63 6875 6e6b 735f 7375 6263 6875  ct_chunks_subchu
-0001c2c0: 6e6b 735f 6e6f 6465 7328 7365 6c66 2c20  nks_nodes(self, 
-0001c2d0: 7465 7874 2c20 7370 6c69 7474 6572 5f72  text, splitter_r
-0001c2e0: 653d 4e6f 6e65 2c20 6e6f 6465 5f72 653d  e=None, node_re=
-0001c2f0: 4e6f 6e65 293a 0a20 2020 2020 2020 2023  None):.        #
-0001c300: 2063 6875 6e6b 5f72 652c 2073 706c 6974   chunk_re, split
-0001c310: 7465 725f 7265 2c20 6e6f 6465 5f72 655f  ter_re, node_re_
-0001c320: 6c69 6174 2c20 6164 645f 756e 6d61 7463  liat, add_unmatc
-0001c330: 6865 6420 3d20 4661 6c73 6529 3a0a 2020  hed = False):.  
-0001c340: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001c350: 2020 4d6f 7665 2074 6f20 6120 636c 6173    Move to a clas
-0001c360: 7320 616e 6420 7265 6661 6374 6f72 2074  s and refactor t
-0001c370: 6f20 7573 6520 6469 6374 696f 6e61 7279  o use dictionary
-0001c380: 0a20 2020 2020 2020 204e 4f54 2059 4554  .        NOT YET
-0001c390: 2055 5345 440a 2020 2020 2020 2020 3a70   USED.        :p
-0001c3a0: 6172 616d 2073 706c 6974 7465 725f 7265  aram splitter_re
-0001c3b0: 3a20 7265 6765 7820 666f 7220 7370 6c69  : regex for spli
-0001c3c0: 7474 696e 6720 736d 616c 6c65 7220 6368  tting smaller ch
-0001c3d0: 756e 6b73 0a20 2020 2020 2020 203a 7061  unks.        :pa
-0001c3e0: 7261 6d20 6e6f 6465 5f72 653a 2072 6567  ram node_re: reg
-0001c3f0: 6578 2074 6f20 6669 6e64 2068 7970 6572  ex to find hyper
-0001c400: 6e6f 6465 730a 2020 2020 2020 2020 2222  nodes.        ""
-0001c410: 220a 0a20 2020 2020 2020 2063 6875 6e6b  "..        chunk
-0001c420: 5f72 6573 203d 2073 656c 662e 6368 756e  _res = self.chun
-0001c430: 6b5f 6469 6374 2e67 6574 2873 656c 662e  k_dict.get(self.
-0001c440: 4348 554e 4b5f 5245 290a 2020 2020 2020  CHUNK_RE).      
-0001c450: 2020 7370 6c69 7474 6572 5f72 6573 203d    splitter_res =
-0001c460: 2073 656c 662e 7370 6c69 7474 6572 5f64   self.splitter_d
-0001c470: 6963 742e 6765 7428 7365 6c66 2e53 504c  ict.get(self.SPL
-0001c480: 4954 5445 525f 5245 290a 2020 2020 2020  ITTER_RE).      
-0001c490: 2020 6e6f 6465 5f72 6573 203d 2073 656c    node_res = sel
-0001c4a0: 662e 6368 756e 6b5f 6e6f 6465 5f64 6963  f.chunk_node_dic
-0001c4b0: 742e 6765 7428 7365 6c66 2e53 5542 4e4f  t.get(self.SUBNO
-0001c4c0: 4445 5f52 4529 0a0a 2020 2020 2020 2020  DE_RE)..        
-0001c4d0: 6164 645f 756e 6d61 7463 6865 6420 3d20  add_unmatched = 
-0001c4e0: 7365 6c66 2e63 6875 6e6b 5f6e 6f64 655f  self.chunk_node_
-0001c4f0: 6469 6374 2e67 6574 2873 656c 662e 554e  dict.get(self.UN
-0001c500: 4d41 5443 4845 4429 0a20 2020 2020 2020  MATCHED).       
-0001c510: 2070 7472 203d 2030 0a20 2020 2020 2020   ptr = 0.       
-0001c520: 2077 6869 6c65 2054 7275 653a 0a20 2020   while True:.   
-0001c530: 2020 2020 2020 2020 2066 6f72 2063 6875           for chu
-0001c540: 6e6b 5f72 6520 696e 2063 6875 6e6b 5f72  nk_re in chunk_r
-0001c550: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001c560: 2020 2020 6d61 7463 6820 3d20 7265 2e73      match = re.s
-0001c570: 6561 7263 6828 6368 756e 6b5f 7265 2c20  earch(chunk_re, 
-0001c580: 7465 7874 5b70 7472 3a5d 290a 2020 2020  text[ptr:]).    
-0001c590: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0001c5a0: 6f74 206d 6174 6368 3a0a 2020 2020 2020  ot match:.      
-0001c5b0: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0001c5c0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-0001c5d0: 2020 2020 7074 7220 2b3d 206d 6174 6368      ptr += match
-0001c5e0: 2e73 7061 6e28 295b 315d 0a20 2020 2020  .span()[1].     
-0001c5f0: 2020 2020 2020 2020 2020 206e 6f64 6573             nodes
-0001c600: 7472 203d 206d 6174 6368 2e67 726f 7570  tr = match.group
-0001c610: 2831 290a 0a20 2020 2020 2020 2020 2020  (1)..           
-0001c620: 2020 2020 206e 6f64 6573 203d 2072 652e       nodes = re.
-0001c630: 7370 6c69 7428 7370 6c69 7474 6572 5f72  split(splitter_r
-0001c640: 652c 206e 6f64 6573 7472 290a 2020 2020  e, nodestr).    
-0001c650: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
-0001c660: 5f64 6963 7420 3d20 6465 6661 756c 7464  _dict = defaultd
-0001c670: 6963 7428 6c69 7374 290a 2020 2020 2020  ict(list).      
-0001c680: 2020 2020 2020 2020 2020 666f 7220 6e6f            for no
-0001c690: 6465 2069 6e20 6e6f 6465 733a 0a20 2020  de in nodes:.   
-0001c6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6b0: 206d 203d 2072 652e 7365 6172 6368 286e   m = re.search(n
-0001c6c0: 6f64 655f 7265 2c20 6e6f 6465 290a 2020  ode_re, node).  
-0001c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c6e0: 2020 6966 206d 3a0a 2020 2020 2020 2020    if m:.        
-0001c6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c700: 6e6f 6465 5f64 6963 745b 6e6f 6465 5f72  node_dict[node_r
-0001c710: 655d 2e61 7070 656e 6428 6e6f 6465 290a  e].append(node).
-0001c720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c730: 2020 2020 6966 206e 6f74 206d 2061 6e64      if not m and
-0001c740: 2061 6464 5f75 6e6d 6174 6368 6564 3a0a   add_unmatched:.
-0001c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c760: 2020 2020 2020 2020 6e6f 6465 5f64 6963          node_dic
-0001c770: 745b 7365 6c66 2e55 4e4d 4154 4348 4544  t[self.UNMATCHED
-0001c780: 5d2e 6170 7065 6e64 286e 6f64 6529 0a20  ].append(node). 
-0001c790: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001c7a0: 6f72 2069 7465 6d20 696e 206e 6f64 655f  or item in node_
-0001c7b0: 6469 6374 2e69 7465 6d73 2829 3a0a 2020  dict.items():.  
-0001c7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7d0: 2020 2320 7072 696e 7428 6622 6974 656d    # print(f"item
-0001c7e0: 207b 6974 656d 7d22 290a 2020 2020 2020   {item}").      
-0001c7f0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-0001c800: 7373 0a0a 2020 2020 6465 6620 6164 645f  ss..    def add_
-0001c810: 7870 6174 6828 7365 6c66 2c20 7469 746c  xpath(self, titl
-0001c820: 652c 2078 7061 7468 293a 0a20 2020 2020  e, xpath):.     
-0001c830: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
-0001c840: 6574 2078 7061 7468 2066 6f72 2065 7874  et xpath for ext
-0001c850: 7261 6374 696e 6720 4854 4d4c 206e 6f64  racting HTML nod
-0001c860: 6573 2e0a 2020 2020 2020 2020 3a70 6172  es..        :par
-0001c870: 616d 2074 6974 6c65 3a20 7469 746c 6520  am title: title 
-0001c880: 6f66 2078 7061 7468 0a20 2020 2020 2020  of xpath.       
-0001c890: 203a 7061 7261 6d20 7870 6174 683a 2061   :param xpath: a
-0001c8a0: 6374 7320 6f6e 2063 7572 7265 6e74 206e  cts on current n
-0001c8b0: 6f64 6573 6574 0a20 2020 2020 2020 2022  odeset.        "
-0001c8c0: 2222 0a20 2020 2020 2020 2058 6d6c 4c69  "".        XmlLi
-0001c8d0: 622e 7661 6c69 6461 7465 5f78 7061 7468  b.validate_xpath
-0001c8e0: 2878 7061 7468 290a 2020 2020 2020 2020  (xpath).        
-0001c8f0: 7365 6c66 2e61 6464 5f69 7465 6d5f 746f  self.add_item_to
-0001c900: 5f61 7272 6179 5f64 6963 7428 7365 6c66  _array_dict(self
-0001c910: 2e78 7061 7468 5f64 6963 742c 2074 6974  .xpath_dict, tit
-0001c920: 6c65 2c20 7870 6174 6829 0a0a 2020 2020  le, xpath)..    
-0001c930: 6465 6620 7661 6c69 6461 7465 5f78 7061  def validate_xpa
-0001c940: 7468 2873 656c 662c 2078 7061 7468 293a  th(self, xpath):
-0001c950: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001c960: 2020 2020 2063 7275 6465 2073 796e 7461       crude synta
-0001c970: 7820 7661 6c69 6461 7469 6f6e 206f 6620  x validation of 
-0001c980: 7870 6174 6820 7374 7269 6e67 2e0a 2020  xpath string..  
-0001c990: 2020 2020 2020 7465 7374 7320 7870 6174        tests xpat
-0001c9a0: 6820 6f6e 2061 2074 7269 7669 616c 2065  h on a trivial e
-0001c9b0: 6c65 6d65 6e74 0a20 2020 2020 2020 203a  lement.        :
-0001c9c0: 7061 7261 6d20 7870 6174 683a 0a20 2020  param xpath:.   
-0001c9d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001c9e0: 2074 7265 6520 3d20 4554 2e66 726f 6d73   tree = ET.froms
-0001c9f0: 7472 696e 6728 223c 666f 6f2f 3e22 290a  tring("<foo/>").
-0001ca00: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0001ca10: 2020 2020 2020 2020 2074 7265 652e 7870           tree.xp
-0001ca20: 6174 6828 7870 6174 6829 0a20 2020 2020  ath(xpath).     
-0001ca30: 2020 2065 7863 6570 7420 4554 2e58 5061     except ET.XPa
-0001ca40: 7468 4576 616c 4572 726f 7220 6173 2065  thEvalError as e
-0001ca50: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-0001ca60: 6767 696e 672e 6572 726f 7228 6622 6261  gging.error(f"ba
-0001ca70: 6420 5850 6174 6820 7b78 7061 7468 7d2c  d XPath {xpath},
-0001ca80: 207b 657d 2229 0a20 2020 2020 2020 2020   {e}").         
-0001ca90: 2020 2072 6169 7365 2065 0a0a 2020 2020     raise e..    
-0001caa0: 6465 6620 6164 645f 6368 756e 6b5f 7265  def add_chunk_re
-0001cab0: 2873 656c 662c 2063 6875 6e6b 5f72 6529  (self, chunk_re)
-0001cac0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0001cad0: 2020 2020 2020 6164 6420 6368 756e 6b20        add chunk 
-0001cae0: 7265 6765 7820 666f 7220 6578 7472 6163  regex for extrac
-0001caf0: 7469 6e67 2063 6875 6e6b 732e 0a20 2020  ting chunks..   
-0001cb00: 2020 2020 203a 7061 7261 6d20 6368 756e       :param chun
-0001cb10: 6b5f 7265 3a20 6163 7473 206f 6e20 6375  k_re: acts on cu
-0001cb20: 7272 656e 7420 6e6f 6465 7365 740a 2020  rrent nodeset.  
-0001cb30: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001cb40: 2020 7365 6c66 2e61 6464 5f69 7465 6d5f    self.add_item_
-0001cb50: 746f 5f61 7272 6179 5f64 6963 7428 7365  to_array_dict(se
-0001cb60: 6c66 2e63 6875 6e6b 5f64 6963 742c 2073  lf.chunk_dict, s
-0001cb70: 656c 662e 4348 554e 4b5f 5245 2c20 6368  elf.CHUNK_RE, ch
-0001cb80: 756e 6b5f 7265 290a 2020 2020 2020 2020  unk_re).        
-0001cb90: 7365 6c66 2e76 616c 6964 6174 655f 7265  self.validate_re
-0001cba0: 2863 6875 6e6b 5f72 6529 0a0a 2020 2020  (chunk_re)..    
-0001cbb0: 6465 6620 6164 645f 7370 6c69 7474 6572  def add_splitter
-0001cbc0: 5f72 6528 7365 6c66 2c20 7370 6c69 7474  _re(self, splitt
-0001cbd0: 6572 5f72 6529 3a0a 2020 2020 2020 2020  er_re):.        
-0001cbe0: 2222 220a 2020 2020 2020 2020 6164 6420  """.        add 
-0001cbf0: 7370 6c69 7474 6572 2072 6567 6578 2066  splitter regex f
-0001cc00: 6f72 2065 7874 7261 6374 696e 6720 6c69  or extracting li
-0001cc10: 7374 7320 696e 2063 6875 6e6b 732e 0a20  sts in chunks.. 
-0001cc20: 2020 2020 2020 203a 7061 7261 6d20 7370         :param sp
-0001cc30: 6c69 7474 6572 5f72 653a 2061 6374 7320  litter_re: acts 
-0001cc40: 6f6e 2063 7572 7265 6e74 206e 6f64 6573  on current nodes
-0001cc50: 6574 0a20 2020 2020 2020 2022 2222 0a20  et.        """. 
-0001cc60: 2020 2020 2020 2073 656c 662e 6164 645f         self.add_
-0001cc70: 6974 656d 5f74 6f5f 6172 7261 795f 6469  item_to_array_di
-0001cc80: 6374 2873 656c 662e 7370 6c69 7474 6572  ct(self.splitter
-0001cc90: 5f64 6963 742c 2073 656c 662e 5350 4c49  _dict, self.SPLI
-0001cca0: 5454 4552 5f52 452c 2073 706c 6974 7465  TTER_RE, splitte
-0001ccb0: 725f 7265 290a 2020 2020 2020 2020 7365  r_re).        se
-0001ccc0: 6c66 2e76 616c 6964 6174 655f 7265 2873  lf.validate_re(s
-0001ccd0: 706c 6974 7465 725f 7265 290a 0a20 2020  plitter_re)..   
-0001cce0: 2064 6566 2061 6464 5f73 7562 6e6f 6465   def add_subnode
-0001ccf0: 5f6b 6579 5f72 6528 7365 6c66 2c20 6e61  _key_re(self, na
-0001cd00: 6d65 2c20 7375 626e 6f64 655f 7265 293a  me, subnode_re):
-0001cd10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001cd20: 2020 2020 2061 6464 206e 616d 6564 2073       add named s
-0001cd30: 7562 6e6f 6465 2072 6567 6578 2066 6f72  ubnode regex for
-0001cd40: 2070 6172 7369 6e67 206c 6973 7420 6974   parsing list it
-0001cd50: 656d 7320 6672 6f6d 2073 706c 6974 7469  ems from splitti
-0001cd60: 6e67 0a20 2020 2020 2020 203a 7061 7261  ng.        :para
-0001cd70: 6d20 6e61 6d65 3a20 6e61 6d65 206f 6620  m name: name of 
-0001cd80: 7265 2069 6e20 6469 6374 0a20 2020 2020  re in dict.     
-0001cd90: 2020 203a 7061 7261 6d20 7375 626e 6f64     :param subnod
-0001cda0: 655f 7265 3a20 7265 6765 7820 746f 2073  e_re: regex to s
-0001cdb0: 746f 7265 0a20 2020 2020 2020 2022 2222  tore.        """
-0001cdc0: 0a20 2020 2020 2020 2073 656c 662e 6164  .        self.ad
-0001cdd0: 645f 6e61 6d65 645f 7661 6c75 6528 6e61  d_named_value(na
-0001cde0: 6d65 2c20 7375 626e 6f64 655f 7265 290a  me, subnode_re).
-0001cdf0: 0a20 2020 2064 6566 2061 6464 5f6e 616d  .    def add_nam
-0001ce00: 6564 5f76 616c 7565 2873 656c 662c 206e  ed_value(self, n
-0001ce10: 616d 652c 2073 7562 6e6f 6465 5f72 6529  ame, subnode_re)
-0001ce20: 3a0a 2020 2020 2020 2020 7365 6c66 2e61  :.        self.a
-0001ce30: 6464 5f69 7465 6d5f 746f 5f61 7272 6179  dd_item_to_array
-0001ce40: 5f64 6963 7428 7365 6c66 2e63 6875 6e6b  _dict(self.chunk
-0001ce50: 5f64 6963 742c 206e 616d 652c 2073 7562  _dict, name, sub
-0001ce60: 6e6f 6465 5f72 6529 0a20 2020 2020 2020  node_re).       
-0001ce70: 2073 656c 662e 7661 6c69 6461 7465 5f72   self.validate_r
-0001ce80: 6528 7375 626e 6f64 655f 7265 290a 0a20  e(subnode_re).. 
-0001ce90: 2020 2064 6566 2073 6574 5f75 6e6d 6174     def set_unmat
-0001cea0: 6368 6564 5f66 6c61 6728 7365 6c66 2c20  ched_flag(self, 
-0001ceb0: 756e 6d61 7463 6865 6429 3a0a 2020 2020  unmatched):.    
-0001cec0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001ced0: 7365 7420 554e 4d41 5443 4845 4420 626f  set UNMATCHED bo
-0001cee0: 6f6c 6561 6e2e 2049 6620 7472 7565 2061  olean. If true a
-0001cef0: 6464 7320 616c 6c20 756e 6d61 7463 6865  dds all unmatche
-0001cf00: 6420 7661 6c75 6573 2074 6f20 6469 6374  d values to dict
-0001cf10: 2075 6e64 6572 2055 4e4d 4154 4348 4544   under UNMATCHED
-0001cf20: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001cf30: 756e 6d61 7463 6865 643a 2061 6374 7320  unmatched: acts 
-0001cf40: 6f6e 2063 7572 7265 6e74 206e 6f64 6573  on current nodes
-0001cf50: 6574 0a20 2020 2020 2020 203a 7061 7261  et.        :para
-0001cf60: 6d20 6d61 7463 685f 7479 7065 3a20 6164  m match_type: ad
-0001cf70: 6469 7469 6f6e 616c 2064 6562 7567 2074  ditional debug t
-0001cf80: 6f20 6e61 6d65 0a20 2020 2020 2020 2022  o name.        "
-0001cf90: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
-0001cfa0: 6368 756e 6b5f 6469 6374 5b73 656c 662e  chunk_dict[self.
-0001cfb0: 554e 4d41 5443 4845 445d 203d 2075 6e6d  UNMATCHED] = unm
-0001cfc0: 6174 6368 6564 0a0a 2020 2020 6465 6620  atched..    def 
-0001cfd0: 7661 6c69 6461 7465 5f72 6528 7365 6c66  validate_re(self
-0001cfe0: 2c20 7265 6765 7829 3a0a 2020 2020 2020  , regex):.      
-0001cff0: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
-0001d000: 6172 616d 2072 6567 6578 3a20 7265 6765  aram regex: rege
-0001d010: 7820 746f 2062 6520 7661 6c69 6461 7465  x to be validate
-0001d020: 640a 2020 2020 2020 2020 3a65 7863 6570  d.        :excep
-0001d030: 743a 2074 6872 6f77 7320 4578 6365 7074  t: throws Except
-0001d040: 696f 6e20 666f 7220 6261 6420 7265 6765  ion for bad rege
-0001d050: 780a 2020 2020 2020 2020 2222 220a 2020  x.        """.  
-0001d060: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0001d070: 2020 2020 2020 2072 652e 636f 6d70 696c         re.compil
-0001d080: 6528 7265 6765 7829 0a20 2020 2020 2020  e(regex).       
-0001d090: 2065 7863 6570 7420 4578 6365 7074 696f   except Exceptio
-0001d0a0: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-0001d0b0: 2020 2020 6c6f 6767 696e 672e 6572 726f      logging.erro
-0001d0c0: 7228 6622 6261 6420 7265 6765 7820 7b72  r(f"bad regex {r
-0001d0d0: 6567 6578 7d22 290a 2020 2020 2020 2020  egex}").        
-0001d0e0: 2020 2020 7261 6973 6520 650a 0a20 2020      raise e..   
-0001d0f0: 2064 6566 2061 6464 5f69 7465 6d5f 746f   def add_item_to
-0001d100: 5f61 7272 6179 5f64 6963 7428 7365 6c66  _array_dict(self
-0001d110: 2c20 7468 655f 6469 6374 2c20 6b65 792c  , the_dict, key,
-0001d120: 2076 616c 7565 293a 0a20 2020 2020 2020   value):.       
-0001d130: 2069 6620 6e6f 7420 7468 655f 6469 6374   if not the_dict
-0001d140: 2e67 6574 286b 6579 293a 0a20 2020 2020  .get(key):.     
-0001d150: 2020 2020 2020 2074 6865 5f64 6963 745b         the_dict[
-0001d160: 6b65 795d 203d 205b 5d0a 2020 2020 2020  key] = [].      
-0001d170: 2020 7468 655f 6469 6374 5b6b 6579 5d2e    the_dict[key].
-0001d180: 6170 7065 6e64 2876 616c 7565 290a 0a0a  append(value)...
-0001d190: 0a63 6c61 7373 2055 524c 4361 6368 653a  .class URLCache:
-0001d1a0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-0001d1b0: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-0001d1c0: 2073 656c 662e 7572 6c5f 6469 6374 203d   self.url_dict =
-0001d1d0: 2064 6963 7428 290a 0a20 2020 2064 6566   dict()..    def
-0001d1e0: 2072 6561 645f 786d 6c5f 656c 656d 656e   read_xml_elemen
-0001d1f0: 745f 6672 6f6d 5f67 6974 6875 6228 7365  t_from_github(se
-0001d200: 6c66 2c20 6769 7468 7562 5f75 726c 2c20  lf, github_url, 
-0001d210: 6465 6c61 793d 3129 3a0a 2020 2020 2020  delay=1):.      
-0001d220: 2020 2222 2272 6574 7269 6576 6573 2061    """retrieves a
-0001d230: 6e64 2070 6172 7365 7320 636f 6e74 656e  nd parses conten
-0001d240: 7420 6f66 2055 524c 2e20 4361 6368 6573  t of URL. Caches
-0001d250: 2069 7420 6966 2066 6f75 6e64 0a20 2020   it if found.   
-0001d260: 2020 2020 2072 6574 7572 6e73 2061 2064       returns a d
-0001d270: 6565 7063 6f70 7920 6173 2065 6c65 6d6e  eepcopy as elemn
-0001d280: 7420 6973 206c 696b 656c 7920 746f 2062  t is likely to b
-0001d290: 6520 6564 6974 6564 2222 220a 2020 2020  e edited""".    
-0001d2a0: 2020 2020 6874 6d6c 5f65 6c65 6d20 3d20      html_elem = 
-0001d2b0: 7365 6c66 2e75 726c 5f64 6963 742e 6765  self.url_dict.ge
-0001d2c0: 7428 6769 7468 7562 5f75 726c 290a 2020  t(github_url).  
-0001d2d0: 2020 2020 2020 6966 2068 746d 6c5f 656c        if html_el
-0001d2e0: 656d 2069 7320 4e6f 6e65 3a0a 2020 2020  em is None:.    
-0001d2f0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0001d300: 2020 2020 2020 2020 2020 2020 2068 746d               htm
-0001d310: 6c5f 656c 656d 203d 2058 6d6c 4c69 622e  l_elem = XmlLib.
-0001d320: 7265 6164 5f78 6d6c 5f65 6c65 6d65 6e74  read_xml_element
-0001d330: 5f66 726f 6d5f 6769 7468 7562 2867 6974  _from_github(git
-0001d340: 6875 625f 7572 6c3d 6769 7468 7562 5f75  hub_url=github_u
-0001d350: 726c 290a 2020 2020 2020 2020 2020 2020  rl).            
-0001d360: 2020 2020 7469 6d65 2e73 6c65 6570 2864      time.sleep(d
-0001d370: 656c 6179 290a 2020 2020 2020 2020 2020  elay).          
-0001d380: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
-0001d390: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-0001d3a0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-0001d3b0: 2263 616e 6e6f 7420 7265 6164 207b 6769  "cannot read {gi
-0001d3c0: 7468 7562 5f75 726c 7d20 6265 6361 7573  thub_url} becaus
-0001d3d0: 6520 7b65 7d22 290a 2020 2020 2020 2020  e {e}").        
-0001d3e0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0001d3f0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0001d400: 7365 6c66 2e75 726c 5f64 6963 745b 6769  self.url_dict[gi
-0001d410: 7468 7562 5f75 726c 5d20 3d20 6874 6d6c  thub_url] = html
-0001d420: 5f65 6c65 6d0a 2020 2020 2020 2020 656c  _elem.        el
-0001d430: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0001d440: 2320 7072 696e 7428 6622 2066 6f75 6e64  # print(f" found
-0001d450: 2069 6e20 6361 6368 6521 2229 0a20 2020   in cache!").   
-0001d460: 2020 2020 2020 2020 2070 6173 730a 2020           pass.  
-0001d470: 2020 2020 2020 7265 7475 726e 2063 6f70        return cop
-0001d480: 792e 6465 6570 636f 7079 2868 746d 6c5f  y.deepcopy(html_
-0001d490: 656c 656d 290a 0a0a 4944 203d 2022 6964  elem)...ID = "id
-0001d4a0: 220a 4f42 4a45 4354 203d 226f 626a 6563  ".OBJECT ="objec
-0001d4b0: 7422 0a53 5441 5254 454e 4420 3d20 2273  t".STARTEND = "s
-0001d4c0: 7461 7274 5f65 6e64 220a 0a63 6c61 7373  tart_end"..class
-0001d4d0: 2046 6c6f 6174 426f 756e 6461 7279 4469   FloatBoundaryDi
-0001d4e0: 6374 3a0a 0a20 2020 2064 6566 205f 5f69  ct:..    def __i
-0001d4f0: 6e69 745f 5f28 7365 6c66 2c20 6874 6d6c  nit__(self, html
-0001d500: 5f65 6c65 6d2c 206f 7574 6469 723d 4e6f  _elem, outdir=No
-0001d510: 6e65 293a 0a20 2020 2020 2020 2073 656c  ne):.        sel
-0001d520: 662e 666c 6f61 745f 626f 756e 6461 7279  f.float_boundary
-0001d530: 5f64 6963 7420 3d20 6465 6661 756c 7464  _dict = defaultd
-0001d540: 6963 7428 6c69 7374 290a 2020 2020 2020  ict(list).      
-0001d550: 2020 7365 6c66 2e68 746d 6c5f 656c 656d    self.html_elem
-0001d560: 203d 2068 746d 6c5f 656c 656d 0a20 2020   = html_elem.   
-0001d570: 2020 2020 2073 656c 662e 6f75 7464 6972       self.outdir
-0001d580: 203d 206f 7574 6469 720a 0a20 2020 2064   = outdir..    d
-0001d590: 6566 2061 6464 5f6f 626a 6563 7428 7365  ef add_object(se
-0001d5a0: 6c66 2c20 666c 6f61 745f 626f 756e 6461  lf, float_bounda
-0001d5b0: 7279 293a 0a20 2020 2020 2020 206b 6579  ry):.        key
-0001d5c0: 203d 2066 6c6f 6174 5f62 6f75 6e64 6172   = float_boundar
-0001d5d0: 792e 6b65 790a 2020 2020 2020 2020 7365  y.key.        se
-0001d5e0: 6c66 2e66 6c6f 6174 5f62 6f75 6e64 6172  lf.float_boundar
-0001d5f0: 795f 6469 6374 5b6b 6579 5d2e 6170 7065  y_dict[key].appe
-0001d600: 6e64 2866 6c6f 6174 5f62 6f75 6e64 6172  nd(float_boundar
-0001d610: 7929 0a0a 2020 2020 6465 6620 6164 645f  y)..    def add_
-0001d620: 666c 6f61 745f 626f 756e 6461 7269 6573  float_boundaries
-0001d630: 2873 656c 662c 2066 6c6f 6174 5f62 6f75  (self, float_bou
-0001d640: 6e64 6172 6965 7329 3a0a 2020 2020 2020  ndaries):.      
-0001d650: 2020 666f 7220 666c 6f61 745f 626f 756e    for float_boun
-0001d660: 6461 7279 2069 6e20 666c 6f61 745f 626f  dary in float_bo
-0001d670: 756e 6461 7269 6573 3a0a 2020 2020 2020  undaries:.      
-0001d680: 2020 2020 2020 7365 6c66 2e61 6464 5f6f        self.add_o
-0001d690: 626a 6563 7428 666c 6f61 745f 626f 756e  bject(float_boun
-0001d6a0: 6461 7279 290a 0a20 2020 2064 6566 2065  dary)..    def e
-0001d6b0: 7874 7261 6374 5f63 6f6e 7465 6e74 735f  xtract_contents_
-0001d6c0: 6f66 5f62 7261 636b 6574 6564 5f62 6f75  of_bracketed_bou
-0001d6d0: 6e64 6172 6965 735f 616e 645f 7772 6974  ndaries_and_writ
-0001d6e0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0001d6f0: 2066 6f72 2066 625f 6c69 7374 2069 6e20   for fb_list in 
-0001d700: 7365 6c66 2e66 6c6f 6174 5f62 6f75 6e64  self.float_bound
-0001d710: 6172 795f 6469 6374 2e76 616c 7565 7328  ary_dict.values(
-0001d720: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-0001d730: 6620 6c65 6e28 6662 5f6c 6973 7429 203d  f len(fb_list) =
-0001d740: 3d20 323a 0a20 2020 2020 2020 2020 2020  = 2:.           
-0001d750: 2020 2020 2023 2070 7269 6e74 2866 2246       # print(f"F
-0001d760: 4220 7b66 625f 6c69 7374 7d20 7b66 625f  B {fb_list} {fb_
-0001d770: 6c69 7374 5b30 5d2e 6469 765f 6964 7d20  list[0].div_id} 
-0001d780: 7b66 625f 6c69 7374 5b31 5d2e 6469 765f  {fb_list[1].div_
-0001d790: 6964 7d22 290a 2020 2020 2020 2020 2020  id}").          
-0001d7a0: 2020 2020 2020 6e65 775f 6469 7620 3d20        new_div = 
-0001d7b0: 7365 6c66 2e64 656c 6574 655f 6265 7477  self.delete_betw
-0001d7c0: 6565 6e28 6662 5f6c 6973 745b 305d 2e64  een(fb_list[0].d
-0001d7d0: 6976 5f69 642c 2066 625f 6c69 7374 5b31  iv_id, fb_list[1
-0001d7e0: 5d2e 6469 765f 6964 290a 2020 2020 2020  ].div_id).      
-0001d7f0: 2020 2020 2020 2020 2020 666c 6f61 745f            float_
-0001d800: 6e61 6d65 203d 2066 625f 6c69 7374 5b30  name = fb_list[0
-0001d810: 5d2e 6b65 790a 2020 2020 2020 2020 2020  ].key.          
-0001d820: 2020 2020 2020 6e65 775f 6469 762e 6174        new_div.at
-0001d830: 7472 6962 5b22 6e61 6d65 225d 203d 2066  trib["name"] = f
-0001d840: 6c6f 6174 5f6e 616d 650a 2020 2020 2020  loat_name.      
-0001d850: 2020 2020 2020 2020 2020 6e65 775f 6874            new_ht
-0001d860: 6d6c 5f65 6c65 6d20 3d20 4874 6d6c 4c69  ml_elem = HtmlLi
-0001d870: 622e 6372 6561 7465 5f6e 6577 5f68 746d  b.create_new_htm
-0001d880: 6c5f 7769 7468 5f6f 6c64 5f73 7479 6c65  l_with_old_style
-0001d890: 7328 7365 6c66 2e68 746d 6c5f 656c 656d  s(self.html_elem
-0001d8a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d8b0: 2020 4874 6d6c 4c69 622e 6765 745f 626f    HtmlLib.get_bo
-0001d8c0: 6479 286e 6577 5f68 746d 6c5f 656c 656d  dy(new_html_elem
-0001d8d0: 292e 6170 7065 6e64 286e 6577 5f64 6976  ).append(new_div
-0001d8e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001d8f0: 2020 6966 2073 656c 662e 6f75 7464 6972    if self.outdir
-0001d900: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001d910: 2020 2020 2020 5061 7468 2873 656c 662e        Path(self.
-0001d920: 6f75 7464 6972 292e 6d6b 6469 7228 6578  outdir).mkdir(ex
-0001d930: 6973 745f 6f6b 3d54 7275 652c 2070 6172  ist_ok=True, par
-0001d940: 656e 7473 3d46 616c 7365 290a 2020 2020  ents=False).    
-0001d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d960: 6669 6c65 5f73 7465 6d20 3d20 666c 6f61  file_stem = floa
-0001d970: 745f 6e61 6d65 2e6c 6f77 6572 2829 2e72  t_name.lower().r
-0001d980: 6570 6c61 6365 2822 5c5c 732a 222c 2022  eplace("\\s*", "
-0001d990: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001d9a0: 2020 2020 2020 2058 6d6c 4c69 622e 7772         XmlLib.wr
-0001d9b0: 6974 655f 786d 6c28 6e65 775f 6874 6d6c  ite_xml(new_html
-0001d9c0: 5f65 6c65 6d2c 2050 6174 6828 7365 6c66  _elem, Path(self
-0001d9d0: 2e6f 7574 6469 722c 2066 696c 655f 7374  .outdir, file_st
-0001d9e0: 656d 202b 2022 2e68 746d 6c22 2929 0a0a  em + ".html"))..
-0001d9f0: 2020 2020 6465 6620 6465 6c65 7465 5f62      def delete_b
-0001da00: 6574 7765 656e 2873 656c 662c 2064 6976  etween(self, div
-0001da10: 5f69 6430 2c20 6469 765f 6964 3129 3a0a  _id0, div_id1):.
-0001da20: 2020 2020 2020 2020 656c 656d 3020 3d20          elem0 = 
-0001da30: 7365 6c66 2e68 746d 6c5f 656c 656d 2e78  self.html_elem.x
-0001da40: 7061 7468 2866 222e 2f2f 6469 765b 4069  path(f".//div[@i
-0001da50: 643d 277b 6469 765f 6964 307d 275d 2229  d='{div_id0}']")
-0001da60: 5b30 5d0a 2020 2020 2020 2020 656c 656d  [0].        elem
-0001da70: 3120 3d20 7365 6c66 2e68 746d 6c5f 656c  1 = self.html_el
-0001da80: 656d 2e78 7061 7468 2866 222e 2f2f 6469  em.xpath(f".//di
-0001da90: 765b 4069 643d 277b 6469 765f 6964 317d  v[@id='{div_id1}
-0001daa0: 275d 2229 5b30 5d0a 2020 2020 2020 2020  ']")[0].        
-0001dab0: 666f 6c6c 6f77 696e 6720 3d20 656c 656d  following = elem
-0001dac0: 302e 7870 6174 6828 2266 6f6c 6c6f 7769  0.xpath("followi
-0001dad0: 6e67 3a3a 2a22 290a 2020 2020 2020 2020  ng::*").        
-0001dae0: 6e65 775f 6469 7620 3d20 4554 2e45 6c65  new_div = ET.Ele
-0001daf0: 6d65 6e74 2822 6469 7622 290a 2020 2020  ment("div").    
-0001db00: 2020 2020 6e65 775f 6469 762e 6174 7472      new_div.attr
-0001db10: 6962 5b22 6964 225d 203d 2064 6976 5f69  ib["id"] = div_i
-0001db20: 6430 0a20 2020 2020 2020 2066 6f72 2066  d0.        for f
-0001db30: 6f6c 6c6f 7720 696e 2066 6f6c 6c6f 7769  ollow in followi
-0001db40: 6e67 3a0a 2020 2020 2020 2020 2020 2020  ng:.            
-0001db50: 6964 5f20 3d20 666f 6c6c 6f77 2e61 7474  id_ = follow.att
-0001db60: 7269 625b 2769 6427 5d0a 2020 2020 2020  rib['id'].      
-0001db70: 2020 2020 2020 6e65 775f 6469 762e 6170        new_div.ap
-0001db80: 7065 6e64 2866 6f6c 6c6f 7729 0a20 2020  pend(follow).   
-0001db90: 2020 2020 2020 2020 2023 2066 6f6c 6c6f           # follo
-0001dba0: 772e 6765 7470 6172 656e 7428 292e 7265  w.getparent().re
-0001dbb0: 6d6f 7665 2866 6f6c 6c6f 7729 0a20 2020  move(follow).   
-0001dbc0: 2020 2020 2020 2020 2069 6620 6964 5f20           if id_ 
-0001dbd0: 3d3d 2064 6976 5f69 6431 3a0a 2020 2020  == div_id1:.    
-0001dbe0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0001dbf0: 7428 2245 5849 5422 290a 2020 2020 2020  t("EXIT").      
-0001dc00: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
-0001dc10: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-0001dc20: 6577 5f64 6976 0a0a 0a0a 636c 6173 7320  ew_div....class 
-0001dc30: 466c 6f61 7442 6f75 6e64 6172 793a 0a20  FloatBoundary:. 
-0001dc40: 2020 2022 2222 0a20 2020 2048 6f6c 6473     """.    Holds
-0001dc50: 0a20 2020 2022 2222 0a20 2020 2049 5043  .    """.    IPC
-0001dc60: 435f 424f 554e 4441 5259 203d 2022 5c5c  C_BOUNDARY = "\\
-0001dc70: 5b3f 2220 5c0a 2020 2020 2020 2020 2020  [?" \.          
-0001dc80: 2020 6622 283f 503c 7b53 5441 5254 454e    f"(?P<{STARTEN
-0001dc90: 447d 3e53 5441 5254 7c45 4e44 295c 5c73  D}>START|END)\\s
-0001dca0: 2a22 205c 0a20 2020 2020 2020 2020 2020  *" \.           
-0001dcb0: 2066 2228 3f50 3c7b 4f42 4a45 4354 7d3e   f"(?P<{OBJECT}>
-0001dcc0: 2e2a 424f 587c 4649 4755 5245 7c54 4142  .*BOX|FIGURE|TAB
-0001dcd0: 4c45 295c 5c73 2a22 205c 0a20 2020 2020  LE)\\s*" \.     
-0001dce0: 2020 2020 2020 2066 2228 3f50 3c7b 4944         f"(?P<{ID
-0001dcf0: 7d3e 283f 3a28 3f3a 5b41 2d5a 302d 395d  }>(?:(?:[A-Z0-9]
-0001dd00: 2b7c 5c5c 642b 293f 283f 3a5c 5c2e 5c5c  +|\\d+)?(?:\\.\\
-0001dd10: 642b 292a 2929 5c5c 732a 283f 3a48 4552  d+)*))\\s*(?:HER
-0001dd20: 4529 5c5c 5d3f 220a 0a20 2020 2023 205b  E)\\]?"..    # [
-0001dd30: 5354 4152 5420 4352 4f53 532d 5345 4354  START CROSS-SECT
-0001dd40: 494f 4e20 424f 582e 3120 4845 5245 5d0a  ION BOX.1 HERE].
-0001dd50: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-0001dd60: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-0001dd70: 2073 656c 662e 6772 6f75 705f 6469 6374   self.group_dict
-0001dd80: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
-0001dd90: 2020 7365 6c66 2e73 7461 7274 203d 204e    self.start = N
-0001dda0: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
-0001ddb0: 2e65 6e64 203d 204e 6f6e 650a 2020 2020  .end = None.    
-0001ddc0: 2020 2020 7365 6c66 2e64 6976 5f69 6420      self.div_id 
-0001ddd0: 3d20 4e6f 6e65 0a0a 2020 2020 6465 6620  = None..    def 
-0001dde0: 5f5f 7374 725f 5f28 7365 6c66 293a 0a20  __str__(self):. 
-0001ddf0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001de00: 6c66 2e67 726f 7570 5f64 6963 742e 6765  lf.group_dict.ge
-0001de10: 7428 5354 4152 5445 4e44 2920 2b20 223b  t(STARTEND) + ";
-0001de20: 2220 2b20 2073 656c 662e 6772 6f75 705f  " +  self.group_
-0001de30: 6469 6374 2e67 6574 284f 424a 4543 5429  dict.get(OBJECT)
-0001de40: 202b 2022 3b22 202b 2020 7365 6c66 2e67   + ";" +  self.g
-0001de50: 726f 7570 5f64 6963 742e 6765 7428 4944  roup_dict.get(ID
-0001de60: 290a 0a20 2020 2064 6566 205f 5f72 6570  )..    def __rep
-0001de70: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
-0001de80: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-0001de90: 5f73 7472 5f5f 2829 0a0a 2020 2020 6465  _str__()..    de
-0001dea0: 6620 6164 6428 7365 6c66 2c20 6e61 6d65  f add(self, name
-0001deb0: 2c20 7661 6c75 6529 3a0a 2020 2020 2020  , value):.      
-0001dec0: 2020 7365 6c66 2e67 726f 7570 5f64 6963    self.group_dic
-0001ded0: 745b 6e61 6d65 5d20 3d20 7661 6c75 650a  t[name] = value.
-0001dee0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-0001def0: 2020 2064 6566 206b 6579 2873 656c 6629     def key(self)
-0001df00: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0001df10: 2073 7472 2873 656c 662e 6772 6f75 705f   str(self.group_
-0001df20: 6469 6374 5b4f 424a 4543 545d 2920 2b20  dict[OBJECT]) + 
-0001df30: 7374 7228 7365 6c66 2e67 726f 7570 5f64  str(self.group_d
-0001df40: 6963 745b 4944 5d29 0a0a 2020 2020 4070  ict[ID])..    @p
-0001df50: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-0001df60: 7374 6172 745f 656e 6428 7365 6c66 293a  start_end(self):
-0001df70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001df80: 7365 6c66 2e67 726f 7570 5f64 6963 745b  self.group_dict[
-0001df90: 5354 4152 5445 4e44 5d0a 0a20 2020 2040  STARTEND]..    @
-0001dfa0: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-0001dfb0: 6465 6620 6578 7472 6163 745f 666c 6f61  def extract_floa
-0001dfc0: 7473 5f61 6e64 5f62 6f75 6e64 6172 6965  ts_and_boundarie
-0001dfd0: 7328 636c 732c 2068 746d 6c5f 656c 656d  s(cls, html_elem
-0001dfe0: 2c20 7061 636b 6167 652c 206f 7574 6469  , package, outdi
-0001dff0: 723d 4e6f 6e65 293a 0a20 2020 2020 2020  r=None):.       
-0001e000: 2072 6567 6578 203d 2046 6c6f 6174 426f   regex = FloatBo
-0001e010: 756e 6461 7279 2e49 5043 435f 424f 554e  undary.IPCC_BOUN
-0001e020: 4441 5259 0a20 2020 2020 2020 2066 6c6f  DARY.        flo
-0001e030: 6174 5f62 6f75 6e64 6172 6965 7320 3d20  at_boundaries = 
-0001e040: 466c 6f61 7445 7874 7261 6374 6f72 2829  FloatExtractor()
-0001e050: 2e65 7874 7261 6374 5f66 6c6f 6174 5f62  .extract_float_b
-0001e060: 6f75 6e64 6172 6965 7328 6874 6d6c 5f65  oundaries(html_e
-0001e070: 6c65 6d2c 2072 6567 6578 290a 2020 2020  lem, regex).    
-0001e080: 2020 2020 666c 6f61 745f 626f 756e 6461      float_bounda
-0001e090: 7279 5f64 6963 7420 3d20 466c 6f61 7442  ry_dict = FloatB
-0001e0a0: 6f75 6e64 6172 7944 6963 7428 6874 6d6c  oundaryDict(html
-0001e0b0: 5f65 6c65 6d2c 206f 7574 6469 723d 6f75  _elem, outdir=ou
-0001e0c0: 7464 6972 290a 2020 2020 2020 2020 666c  tdir).        fl
-0001e0d0: 6f61 745f 626f 756e 6461 7279 5f64 6963  oat_boundary_dic
-0001e0e0: 742e 6164 645f 666c 6f61 745f 626f 756e  t.add_float_boun
-0001e0f0: 6461 7269 6573 2866 6c6f 6174 5f62 6f75  daries(float_bou
-0001e100: 6e64 6172 6965 7329 0a20 2020 2020 2020  ndaries).       
-0001e110: 2066 6c6f 6174 5f62 6f75 6e64 6172 795f   float_boundary_
-0001e120: 6469 6374 2e65 7874 7261 6374 5f63 6f6e  dict.extract_con
-0001e130: 7465 6e74 735f 6f66 5f62 7261 636b 6574  tents_of_bracket
-0001e140: 6564 5f62 6f75 6e64 6172 6965 735f 616e  ed_boundaries_an
-0001e150: 645f 7772 6974 6528 290a 2020 2020 2020  d_write().      
-0001e160: 2020 7265 7475 726e 2068 746d 6c5f 656c    return html_el
-0001e170: 656d 0a0a 0a63 6c61 7373 2046 6c6f 6174  em...class Float
-0001e180: 4578 7472 6163 746f 723a 0a20 2020 2022  Extractor:.    "
-0001e190: 2222 6578 7472 6163 7473 2066 6c6f 6174  ""extracts float
-0001e1a0: 7320 2862 6f78 6573 2c20 6669 6775 7265  s (boxes, figure
-0001e1b0: 732c 2065 7463 2e29 2075 7369 6e67 2073  s, etc.) using s
-0001e1c0: 7461 7274 2f65 6e64 2072 6567 6578 6573  tart/end regexes
-0001e1d0: 0a20 2020 2022 2222 0a0a 2020 2020 6465  .    """..    de
-0001e1e0: 6620 5f5f 696e 6974 5f5f 2873 656c 662c  f __init__(self,
-0001e1f0: 2072 6567 6578 3d4e 6f6e 6529 3a0a 2020   regex=None):.  
-0001e200: 2020 2020 2020 7365 6c66 2e72 6567 6578        self.regex
-0001e210: 203d 2072 6567 6578 0a0a 2020 2020 6465   = regex..    de
-0001e220: 6620 6578 7472 6163 745f 666c 6f61 745f  f extract_float_
-0001e230: 626f 756e 6461 7269 6573 2873 656c 662c  boundaries(self,
-0001e240: 2068 746d 6c5f 656c 656d 2c20 7265 6765   html_elem, rege
-0001e250: 785f 7374 7229 3a0a 2020 2020 2020 2020  x_str):.        
-0001e260: 666c 6f61 745f 626f 756e 6461 7269 6573  float_boundaries
-0001e270: 203d 205b 5d0a 2020 2020 2020 2020 7265   = [].        re
-0001e280: 6765 7820 3d20 7265 2e63 6f6d 7069 6c65  gex = re.compile
-0001e290: 2872 6567 6578 5f73 7472 290a 2020 2020  (regex_str).    
-0001e2a0: 2020 2020 2320 7072 696e 7428 6622 2072      # print(f" r
-0001e2b0: 6567 6578 207b 7265 6765 787d 2229 0a20  egex {regex}"). 
-0001e2c0: 2020 2020 2020 2064 6976 7320 3d20 6874         divs = ht
-0001e2d0: 6d6c 5f65 6c65 6d2e 7870 6174 6828 222e  ml_elem.xpath(".
-0001e2e0: 2f2f 6469 7622 290a 2020 2020 2020 2020  //div").        
-0001e2f0: 666f 7220 6469 7620 696e 2064 6976 733a  for div in divs:
-0001e300: 0a20 2020 2020 2020 2020 2020 2073 7061  .            spa
-0001e310: 6e73 203d 2064 6976 2e78 7061 7468 2822  ns = div.xpath("
-0001e320: 2e2f 7370 616e 2229 0a20 2020 2020 2020  ./span").       
-0001e330: 2020 2020 2066 6f72 2073 7061 6e20 696e       for span in
-0001e340: 2073 7061 6e73 3a0a 2020 2020 2020 2020   spans:.        
-0001e350: 2020 2020 2020 2020 6d61 7463 6820 3d20          match = 
-0001e360: 7265 2e73 6561 7263 6828 7265 6765 782c  re.search(regex,
-0001e370: 2073 7061 6e2e 7465 7874 290a 2020 2020   span.text).    
-0001e380: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-0001e390: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
-0001e3a0: 2020 2020 2020 2020 2020 666c 6f61 745f            float_
-0001e3b0: 626f 756e 6461 7279 203d 2046 6c6f 6174  boundary = Float
-0001e3c0: 426f 756e 6461 7279 2829 0a20 2020 2020  Boundary().     
-0001e3d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001e3e0: 6c6f 6174 5f62 6f75 6e64 6172 792e 6469  loat_boundary.di
-0001e3f0: 765f 6964 203d 2064 6976 2e61 7474 7269  v_id = div.attri
-0001e400: 625b 2269 6422 5d0a 2020 2020 2020 2020  b["id"].        
-0001e410: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001e420: 6669 656c 6420 696e 205b 5354 4152 5445  field in [STARTE
-0001e430: 4e44 2c20 4f42 4a45 4354 2c20 4944 5d3a  ND, OBJECT, ID]:
-0001e440: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e450: 2020 2020 2020 2020 2066 6c6f 6174 5f62           float_b
-0001e460: 6f75 6e64 6172 792e 6164 6428 6669 656c  oundary.add(fiel
-0001e470: 642c 206d 6174 6368 2e67 726f 7570 2866  d, match.group(f
-0001e480: 6965 6c64 2929 0a20 2020 2020 2020 2020  ield)).         
-0001e490: 2020 2020 2020 2020 2020 2066 6c6f 6174             float
-0001e4a0: 5f62 6f75 6e64 6172 6965 732e 6170 7065  _boundaries.appe
-0001e4b0: 6e64 2866 6c6f 6174 5f62 6f75 6e64 6172  nd(float_boundar
-0001e4c0: 7929 0a20 2020 2020 2020 2072 6574 7572  y).        retur
-0001e4d0: 6e20 666c 6f61 745f 626f 756e 6461 7269  n float_boundari
-0001e4e0: 6573 0a0a 0a0a 636c 6173 7320 4353 5353  es....class CSSS
-0001e4f0: 7479 6c65 3a0a 2020 2020 2222 220a 2020  tyle:.    """.  
-0001e500: 2020 636f 6d6d 6f6e 2073 7562 7365 7420    common subset 
-0001e510: 6f66 2043 5353 2073 7479 6c65 732f 636f  of CSS styles/co
-0001e520: 6d6d 616e 6473 0a20 2020 2022 2222 0a20  mmands.    """. 
-0001e530: 2020 2023 2061 6c6c 2061 7265 206c 6f77     # all are low
-0001e540: 6572 6361 7365 0a20 2020 2042 4f4c 4420  ercase.    BOLD 
-0001e550: 3d20 2262 6f6c 6422 0a20 2020 2042 4f52  = "bold".    BOR
-0001e560: 4445 5220 3d20 2262 6f72 6465 7222 0a20  DER = "border". 
-0001e570: 2020 2042 4f54 544f 4d20 3d20 2262 6f74     BOTTOM = "bot
-0001e580: 746f 6d22 0a20 2020 2043 4f4c 4f52 203d  tom".    COLOR =
-0001e590: 2022 636f 6c6f 7222 0a20 2020 2044 4f54   "color".    DOT
-0001e5a0: 5f42 203d 2022 2e42 220a 2020 2020 4649  _B = ".B".    FI
-0001e5b0: 4c4c 203d 2022 6669 6c6c 220a 2020 2020  LL = "fill".    
-0001e5c0: 5354 524f 4b45 203d 2022 7374 726f 6b65  STROKE = "stroke
-0001e5d0: 220a 2020 2020 464f 4e54 5f46 414d 494c  ".    FONT_FAMIL
-0001e5e0: 5920 3d20 2266 6f6e 742d 6661 6d69 6c79  Y = "font-family
-0001e5f0: 220a 2020 2020 464f 4e54 5f53 495a 4520  ".    FONT_SIZE 
-0001e600: 3d20 2266 6f6e 742d 7369 7a65 220a 2020  = "font-size".  
-0001e610: 2020 464f 4e54 5f53 5459 4c45 203d 2022    FONT_STYLE = "
-0001e620: 666f 6e74 2d73 7479 6c65 220a 2020 2020  font-style".    
-0001e630: 464f 4e54 5f53 5452 4554 4348 4544 203d  FONT_STRETCHED =
-0001e640: 2022 666f 6e74 2d73 7472 6574 6368 6564   "font-stretched
-0001e650: 220a 2020 2020 464f 4e54 5f57 4549 4748  ".    FONT_WEIGH
-0001e660: 5420 3d20 2266 6f6e 742d 7765 6967 6874  T = "font-weight
-0001e670: 220a 2020 2020 4845 4947 4854 203d 2022  ".    HEIGHT = "
-0001e680: 6865 6967 6874 220a 2020 2020 4954 414c  height".    ITAL
-0001e690: 4943 203d 2022 6974 616c 6963 220a 2020  IC = "italic".  
-0001e6a0: 2020 4c45 4654 203d 2022 6c65 6674 220a    LEFT = "left".
-0001e6b0: 2020 2020 4c49 4748 5420 3d20 226c 6967      LIGHT = "lig
-0001e6c0: 6874 220a 2020 2020 4e4f 524d 414c 203d  ht".    NORMAL =
-0001e6d0: 2022 6e6f 726d 616c 220a 2020 2020 4f50   "normal".    OP
-0001e6e0: 4143 4954 5920 3d20 226f 7061 6369 7479  ACITY = "opacity
-0001e6f0: 220a 2020 2020 504f 5349 5449 4f4e 203d  ".    POSITION =
-0001e700: 2022 706f 7369 7469 6f6e 220a 2020 2020   "position".    
-0001e710: 5058 203d 2022 7078 220a 2020 2020 5354  PX = "px".    ST
-0001e720: 594c 4520 3d20 2273 7479 6c65 220a 2020  YLE = "style".  
-0001e730: 2020 544f 5020 3d20 2274 6f70 220a 2020    TOP = "top".  
-0001e740: 2020 5749 4454 4820 3d20 2277 6964 7468    WIDTH = "width
-0001e750: 220a 0a20 2020 2057 4549 4748 545f 5245  "..    WEIGHT_RE
-0001e760: 203d 2022 285b 2d2e 5d3f 426f 6c64 7c5b   = "([-.]?Bold|[
-0001e770: 2e5d 5b42 625d 2429 220a 2020 2020 5354  .][Bb]$)".    ST
-0001e780: 594c 455f 5245 203d 2022 285b 2d2e 5d3f  YLE_RE = "([-.]?
-0001e790: 4974 616c 283a 3f69 6329 7c5b 2d2e 5d3f  Ital(:?ic)|[-.]?
-0001e7a0: 4f62 6c69 7175 657c 5b2e 5d5b 4969 5d24  Oblique|[.][Ii]$
-0001e7b0: 2922 0a0a 2020 2020 5445 5854 5f53 5459  )"..    TEXT_STY
-0001e7c0: 4c45 5f43 4f4d 504f 4e45 4e54 5320 3d20  LE_COMPONENTS = 
-0001e7d0: 5b46 4f4e 545f 5354 594c 452c 2046 4f4e  [FONT_STYLE, FON
-0001e7e0: 545f 5745 4947 4854 2c20 464f 4e54 5f46  T_WEIGHT, FONT_F
-0001e7f0: 414d 494c 592c 2046 4f4e 545f 5349 5a45  AMILY, FONT_SIZE
-0001e800: 2c20 434f 4c4f 522c 204f 5041 4349 5459  , COLOR, OPACITY
-0001e810: 5d0a 0a20 2020 2064 6566 205f 5f69 6e69  ]..    def __ini
-0001e820: 745f 5f28 7365 6c66 293a 0a20 2020 2020  t__(self):.     
-0001e830: 2020 2073 656c 662e 6e61 6d65 5f76 616c     self.name_val
-0001e840: 7565 5f64 6963 7420 3d20 6469 6374 2829  ue_dict = dict()
-0001e850: 0a0a 2020 2020 6465 6620 5f5f 7374 725f  ..    def __str_
-0001e860: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-0001e870: 2073 203d 2022 220a 2020 2020 2020 2020   s = "".        
-0001e880: 666f 7220 6b2c 2076 2069 6e20 7365 6c66  for k, v in self
-0001e890: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
-0001e8a0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-0001e8b0: 2020 2020 2020 7320 2b3d 2066 227b 6b7d        s += f"{k}
-0001e8c0: 3a7b 767d 3b20 220a 2020 2020 2020 2020  :{v}; ".        
-0001e8d0: 7320 3d20 732e 7374 7269 7028 290a 2020  s = s.strip().  
-0001e8e0: 2020 2020 2020 7265 7475 726e 2073 0a0a        return s..
-0001e8f0: 2020 2020 6465 6620 5f5f 7265 7072 5f5f      def __repr__
-0001e900: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-0001e910: 7265 7475 726e 2066 227b 7365 6c66 2e6e  return f"{self.n
-0001e920: 616d 655f 7661 6c75 655f 6469 6374 7d22  ame_value_dict}"
-0001e930: 0a0a 2320 2020 2063 6c61 7373 2043 5353  ..#    class CSS
-0001e940: 5374 796c 653a 0a0a 2020 2020 4063 6c61  Style:..    @cla
-0001e950: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-0001e960: 2063 7265 6174 655f 6373 735f 7374 796c   create_css_styl
-0001e970: 655f 6672 6f6d 5f61 7474 7269 6275 7465  e_from_attribute
-0001e980: 5f6f 665f 626f 6479 5f65 6c65 6d65 6e74  _of_body_element
-0001e990: 2863 6c73 2c20 656c 656d 293a 0a20 2020  (cls, elem):.   
-0001e9a0: 2020 2020 2022 2222 6372 6561 7465 2043       """create C
-0001e9b0: 5353 5374 796c 6520 6f62 6a65 6374 2066  SSStyle object f
-0001e9c0: 726f 6d20 656c 656d 0a20 2020 2020 2020  rom elem.       
-0001e9d0: 203a 7061 7261 6d20 656c 656d 3a0a 2020   :param elem:.  
-0001e9e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001e9f0: 2020 6966 2065 6c65 6d20 6973 204e 6f6e    if elem is Non
-0001ea00: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0001ea10: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
-0001ea20: 2020 2061 7373 6572 7420 7479 7065 2865     assert type(e
-0001ea30: 6c65 6d29 2069 7320 5f45 6c65 6d65 6e74  lem) is _Element
-0001ea40: 2c20 6622 666f 756e 6420 7b74 7970 6528  , f"found {type(
-0001ea50: 656c 656d 297d 220a 2020 2020 2020 2020  elem)}".        
-0001ea60: 6373 735f 7374 796c 6520 3d20 4353 5353  css_style = CSSS
-0001ea70: 7479 6c65 2829 0a20 2020 2020 2020 2073  tyle().        s
-0001ea80: 7479 6c65 5f61 7474 7661 6c20 3d20 656c  tyle_attval = el
-0001ea90: 656d 2e67 6574 2843 5353 5374 796c 652e  em.get(CSSStyle.
-0001eaa0: 5354 594c 4529 0a20 2020 2020 2020 2063  STYLE).        c
-0001eab0: 7373 5f73 7479 6c65 2e6e 616d 655f 7661  ss_style.name_va
-0001eac0: 6c75 655f 6469 6374 203d 2063 6c73 2e63  lue_dict = cls.c
-0001ead0: 7265 6174 655f 6469 6374 5f66 726f 6d5f  reate_dict_from_
-0001eae0: 6e61 6d65 5f76 616c 7565 5f61 7272 6179  name_value_array
-0001eaf0: 5f73 7472 696e 6728 7374 796c 655f 6174  _string(style_at
-0001eb00: 7476 616c 290a 2020 2020 2020 2020 7265  tval).        re
-0001eb10: 7475 726e 2063 7373 5f73 7479 6c65 0a0a  turn css_style..
-0001eb20: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
-0001eb30: 5353 5374 796c 653a 0a0a 2020 2020 4063  SSStyle:..    @c
-0001eb40: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-0001eb50: 6566 2063 7265 6174 655f 6469 6374 5f66  ef create_dict_f
-0001eb60: 726f 6d5f 6e61 6d65 5f76 616c 7565 5f61  rom_name_value_a
-0001eb70: 7272 6179 5f73 7472 696e 6728 636c 732c  rray_string(cls,
-0001eb80: 2073 7479 6c65 5f73 7472 2c20 7265 6d6f   style_str, remo
-0001eb90: 7665 5f63 7572 6c79 3d54 7275 6529 3a0a  ve_curly=True):.
-0001eba0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001ebb0: 2020 2020 6173 7375 6d65 7320 7374 7269      assumes stri
-0001ebc0: 6e67 206f 6620 7479 7065 2022 613a 2062  ng of type "a: b
-0001ebd0: 3b20 633a 2064 3b22 206f 7074 696f 6e61  ; c: d;" optiona
-0001ebe0: 6c6c 7920 656e 636c 6f73 6564 2069 6e20  lly enclosed in 
-0001ebf0: 7b2e 2e2e 7d0a 2020 2020 2020 2020 3a70  {...}.        :p
-0001ec00: 6172 616d 2073 7479 6c65 5f73 7472 3a20  aram style_str: 
-0001ec10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001ec20: 2020 2020 2072 655f 7374 7220 3d20 2228       re_str = "(
-0001ec30: 3f50 3c70 7265 3e2e 2a29 7b28 3f50 3c63  ?P<pre>.*){(?P<c
-0001ec40: 7572 6c79 3e2e 2a29 7d28 3f50 3c70 6f73  urly>.*)}(?P<pos
-0001ec50: 743e 2e2a 2922 0a20 2020 2020 2020 2063  t>.*)".        c
-0001ec60: 7572 6c79 5f72 6520 3d20 7265 2e63 6f6d  urly_re = re.com
-0001ec70: 7069 6c65 2872 655f 7374 7229 0a20 2020  pile(re_str).   
-0001ec80: 2020 2020 206e 616d 655f 7661 6c75 655f       name_value_
-0001ec90: 6469 6374 203d 2064 6963 7428 290a 2020  dict = dict().  
-0001eca0: 2020 2020 2020 6966 2074 7970 6528 7374        if type(st
-0001ecb0: 796c 655f 7374 7229 2069 7320 4353 5353  yle_str) is CSSS
-0001ecc0: 7479 6c65 3a0a 2020 2020 2020 2020 2020  tyle:.          
-0001ecd0: 2020 7374 796c 655f 7374 7220 3d20 7374    style_str = st
-0001ece0: 796c 655f 7374 722e 6765 745f 6373 735f  yle_str.get_css_
-0001ecf0: 7661 6c75 6528 7374 796c 655f 7374 7229  value(style_str)
-0001ed00: 0a20 2020 2020 2020 2069 6620 7374 796c  .        if styl
-0001ed10: 655f 7374 723a 0a20 2020 2020 2020 2020  e_str:.         
-0001ed20: 2020 2069 6620 7265 6d6f 7665 5f63 7572     if remove_cur
-0001ed30: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-0001ed40: 2020 2020 6d61 7463 6820 3d20 6375 726c      match = curl
-0001ed50: 795f 7265 2e6d 6174 6368 2873 7479 6c65  y_re.match(style
-0001ed60: 5f73 7472 290a 2020 2020 2020 2020 2020  _str).          
-0001ed70: 2020 2020 2020 6966 206d 6174 6368 3a0a        if match:.
-0001ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed90: 2020 2020 7374 796c 655f 7374 7220 3d20      style_str = 
-0001eda0: 6d61 7463 682e 6772 6f75 7028 2263 7572  match.group("cur
-0001edb0: 6c79 2229 0a20 2020 2020 2020 2020 2020  ly").           
-0001edc0: 206e 616d 655f 7661 6c75 655f 6469 6374   name_value_dict
-0001edd0: 203d 2063 6c73 2e63 7265 6174 655f 6e61   = cls.create_na
-0001ede0: 6d65 5f76 616c 7565 5f64 6963 7428 7374  me_value_dict(st
-0001edf0: 796c 655f 7374 7229 0a20 2020 2020 2020  yle_str).       
-0001ee00: 2072 6574 7572 6e20 6e61 6d65 5f76 616c   return name_val
-0001ee10: 7565 5f64 6963 740a 0a20 2020 2040 636c  ue_dict..    @cl
-0001ee20: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
-0001ee30: 6620 6372 6561 7465 5f6e 616d 655f 7661  f create_name_va
-0001ee40: 6c75 655f 6469 6374 2863 6c73 2c20 7374  lue_dict(cls, st
-0001ee50: 796c 655f 7374 7229 3a0a 2020 2020 2020  yle_str):.      
-0001ee60: 2020 6e61 6d65 5f76 616c 7565 5f64 6963    name_value_dic
-0001ee70: 7420 3d20 6469 6374 2829 0a20 2020 2020  t = dict().     
-0001ee80: 2020 2073 7479 6c65 5f73 7472 203d 2073     style_str = s
-0001ee90: 7479 6c65 5f73 7472 2e73 7472 6970 2829  tyle_str.strip()
-0001eea0: 0a20 2020 2020 2020 2073 7479 6c65 7320  .        styles 
-0001eeb0: 3d20 7374 796c 655f 7374 722e 7370 6c69  = style_str.spli
-0001eec0: 7428 223b 2229 0a20 2020 2020 2020 2066  t(";").        f
-0001eed0: 6f72 2073 7479 6c65 2069 6e20 7374 796c  or style in styl
-0001eee0: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-0001eef0: 7374 796c 6520 3d20 7374 796c 652e 7374  style = style.st
-0001ef00: 7269 7028 290a 2020 2020 2020 2020 2020  rip().          
-0001ef10: 2020 6966 206c 656e 2873 7479 6c65 2920    if len(style) 
-0001ef20: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-0001ef30: 2020 2020 2073 7320 3d20 7374 796c 652e       ss = style.
-0001ef40: 7370 6c69 7428 223a 2229 0a20 2020 2020  split(":").     
-0001ef50: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
-0001ef60: 6e28 7373 2920 213d 2032 3a0a 2020 2020  n(ss) != 2:.    
-0001ef70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef80: 7261 6973 6520 4b65 7945 7272 6f72 2866  raise KeyError(f
-0001ef90: 2262 6164 2073 7479 6c65 207b 7374 796c  "bad style {styl
-0001efa0: 657d 2069 6e20 4353 533a 207b 7374 796c  e} in CSS: {styl
-0001efb0: 655f 7374 727d 2229 0a20 2020 2020 2020  e_str}").       
-0001efc0: 2020 2020 2020 2020 206e 616d 6520 3d20           name = 
-0001efd0: 7373 5b30 5d2e 7374 7269 7028 290a 2020  ss[0].strip().  
-0001efe0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001eff0: 206e 616d 6520 696e 206e 616d 655f 7661   name in name_va
-0001f000: 6c75 655f 6469 6374 3a0a 2020 2020 2020  lue_dict:.      
-0001f010: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0001f020: 6973 6520 4b65 7945 7272 6f72 2866 227b  ise KeyError(f"{
-0001f030: 6e61 6d65 7d20 6475 706c 6963 6174 6564  name} duplicated
-0001f040: 2069 6e20 4353 533a 207b 7374 796c 655f   in CSS: {style_
-0001f050: 7374 727d 2229 0a20 2020 2020 2020 2020  str}").         
-0001f060: 2020 2020 2020 206e 616d 655f 7661 6c75         name_valu
-0001f070: 655f 6469 6374 5b6e 616d 655d 203d 2073  e_dict[name] = s
-0001f080: 735b 315d 2e73 7472 6970 2829 0a20 2020  s[1].strip().   
-0001f090: 2020 2020 2072 6574 7572 6e20 6e61 6d65       return name
-0001f0a0: 5f76 616c 7565 5f64 6963 740a 0a20 2020  _value_dict..   
-0001f0b0: 2023 2020 2020 636c 6173 7320 4353 5353   #    class CSSS
-0001f0c0: 7479 6c65 3a0a 0a20 2020 2040 636c 6173  tyle:..    @clas
-0001f0d0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-0001f0e0: 6372 6561 7465 5f63 7373 5f73 7479 6c65  create_css_style
-0001f0f0: 5f66 726f 6d5f 6373 735f 7374 7269 6e67  _from_css_string
-0001f100: 2863 6c73 2c20 6373 735f 7374 7269 6e67  (cls, css_string
-0001f110: 2c20 7265 6d6f 7665 5f70 7265 6669 783d  , remove_prefix=
-0001f120: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
-0001f130: 2222 6372 6561 7465 7320 4353 5353 7479  ""creates CSSSty
-0001f140: 6c65 206f 626a 6563 7420 6672 6f6d 2043  le object from C
-0001f150: 5353 2073 7472 696e 6722 2222 0a20 2020  SS string""".   
-0001f160: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
-0001f170: 204e 6f6e 650a 2020 2020 2020 2020 6966   None.        if
-0001f180: 2063 7373 5f73 7472 696e 673a 0a20 2020   css_string:.   
-0001f190: 2020 2020 2020 2020 2063 7373 5f73 7479           css_sty
-0001f1a0: 6c65 203d 2043 5353 5374 796c 6528 290a  le = CSSStyle().
-0001f1b0: 2020 2020 2020 2020 2020 2020 6373 735f              css_
-0001f1c0: 7374 796c 652e 6e61 6d65 5f76 616c 7565  style.name_value
-0001f1d0: 5f64 6963 7420 3d20 636c 732e 6372 6561  _dict = cls.crea
-0001f1e0: 7465 5f64 6963 745f 6672 6f6d 5f6e 616d  te_dict_from_nam
-0001f1f0: 655f 7661 6c75 655f 6172 7261 795f 7374  e_value_array_st
-0001f200: 7269 6e67 2863 7373 5f73 7472 696e 6729  ring(css_string)
-0001f210: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001f220: 7265 6d6f 7665 5f70 7265 6669 783a 0a20  remove_prefix:. 
-0001f230: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001f240: 6f6e 745f 6661 6d69 6c79 203d 2063 7373  ont_family = css
-0001f250: 5f73 7479 6c65 2e6e 616d 655f 7661 6c75  _style.name_valu
-0001f260: 655f 6469 6374 2e67 6574 2843 5353 5374  e_dict.get(CSSSt
-0001f270: 796c 652e 464f 4e54 5f46 414d 494c 5929  yle.FONT_FAMILY)
-0001f280: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f290: 2066 6f6e 745f 6661 6d69 6c79 3120 3d20   font_family1 = 
-0001f2a0: 416d 6946 6f6e 742e 7472 696d 5f70 6466  AmiFont.trim_pdf
-0001f2b0: 5f70 7265 6669 7828 666f 6e74 5f66 616d  _prefix(font_fam
-0001f2c0: 696c 7929 0a20 2020 2020 2020 2020 2020  ily).           
-0001f2d0: 2020 2020 2069 6620 666f 6e74 5f66 616d       if font_fam
-0001f2e0: 696c 7931 2061 6e64 2066 6f6e 745f 6661  ily1 and font_fa
-0001f2f0: 6d69 6c79 3120 213d 2066 6f6e 745f 6661  mily1 != font_fa
-0001f300: 6d69 6c79 3a0a 2020 2020 2020 2020 2020  mily:.          
-0001f310: 2020 2020 2020 2020 2020 6373 735f 7374            css_st
-0001f320: 796c 652e 6e61 6d65 5f76 616c 7565 5f64  yle.name_value_d
-0001f330: 6963 745b 4353 5353 7479 6c65 2e46 4f4e  ict[CSSStyle.FON
-0001f340: 545f 4641 4d49 4c59 5d20 3d20 666f 6e74  T_FAMILY] = font
-0001f350: 5f66 616d 696c 7931 0a20 2020 2020 2020  _family1.       
-0001f360: 2072 6574 7572 6e20 6373 735f 7374 796c   return css_styl
-0001f370: 650a 0a20 2020 2064 6566 205f 5f65 715f  e..    def __eq_
-0001f380: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
-0001f390: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001f3a0: 2020 2020 7465 7374 7320 7768 6574 6865      tests whethe
-0001f3b0: 7220 7365 6c66 2061 6e64 206f 7468 6572  r self and other
-0001f3c0: 2068 6176 6520 6571 7561 6c20 6469 6374   have equal dict
-0001f3d0: 696f 6e61 7269 6573 0a20 2020 2020 2020  ionaries.       
-0001f3e0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-0001f3f0: 7479 7065 286f 7468 6572 2920 6973 2043  type(other) is C
-0001f400: 5353 5374 796c 653a 0a20 2020 2020 2020  SSStyle:.       
-0001f410: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001f420: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
-0001f430: 203d 3d20 6f74 6865 722e 6e61 6d65 5f76   == other.name_v
-0001f440: 616c 7565 5f64 6963 740a 2020 2020 2020  alue_dict.      
-0001f450: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
-0001f460: 0a20 2020 2064 6566 2073 6574 5f61 7474  .    def set_att
-0001f470: 7269 6275 7465 2873 656c 662c 2070 726f  ribute(self, pro
-0001f480: 7065 7274 792c 2076 616c 7565 293a 0a20  perty, value):. 
-0001f490: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001f4a0: 2020 2073 6574 7320 6e61 6d65 2d76 616c     sets name-val
-0001f4b0: 7565 2070 6169 7220 696e 2043 5353 5374  ue pair in CSSSt
-0001f4c0: 796c 650a 2020 2020 2020 2020 6967 6e6f  yle.        igno
-0001f4d0: 7265 7320 656d 7074 7920 7661 6c75 6573  res empty values
-0001f4e0: 206f 7220 4e6f 6e65 0a20 2020 2020 2020   or None.       
-0001f4f0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-0001f500: 7661 6c75 6520 616e 6420 6c65 6e28 7374  value and len(st
-0001f510: 7228 7661 6c75 6529 2920 3e20 303a 0a20  r(value)) > 0:. 
-0001f520: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001f530: 6e61 6d65 5f76 616c 7565 5f64 6963 745b  name_value_dict[
-0001f540: 7072 6f70 6572 7479 5d20 3d20 7661 6c75  property] = valu
-0001f550: 650a 0a20 2020 2064 6566 2073 6574 5f66  e..    def set_f
-0001f560: 616d 696c 7928 7365 6c66 2c20 6661 6d69  amily(self, fami
-0001f570: 6c79 293a 0a20 2020 2020 2020 2069 6620  ly):.        if 
-0001f580: 6661 6d69 6c79 3a0a 2020 2020 2020 2020  family:.        
-0001f590: 2020 2020 7365 6c66 2e73 6574 5f61 7474      self.set_att
-0001f5a0: 7269 6275 7465 2843 5353 5374 796c 652e  ribute(CSSStyle.
-0001f5b0: 464f 4e54 5f46 414d 494c 592c 2066 616d  FONT_FAMILY, fam
-0001f5c0: 696c 7929 0a0a 2020 2020 6465 6620 7365  ily)..    def se
-0001f5d0: 745f 666f 6e74 5f77 6569 6768 7428 7365  t_font_weight(se
-0001f5e0: 6c66 2c20 7765 6967 6874 293a 0a20 2020  lf, weight):.   
-0001f5f0: 2020 2020 2077 6569 6768 7420 3d20 7765       weight = we
-0001f600: 6967 6874 2e6c 6f77 6572 2829 0a20 2020  ight.lower().   
-0001f610: 2020 2020 2069 6620 7765 6967 6874 3a0a       if weight:.
-0001f620: 2020 2020 2020 2020 2020 2020 6966 2077              if w
-0001f630: 6569 6768 7420 3d3d 2043 5353 5374 796c  eight == CSSStyl
-0001f640: 652e 4e4f 524d 414c 3a0a 2020 2020 2020  e.NORMAL:.      
-0001f650: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
-0001f660: 6574 5f61 7474 7269 6275 7465 2843 5353  et_attribute(CSS
-0001f670: 5374 796c 652e 464f 4e54 5f57 4549 4748  Style.FONT_WEIGH
-0001f680: 542c 2043 5353 5374 796c 652e 4e4f 524d  T, CSSStyle.NORM
-0001f690: 414c 290a 2020 2020 2020 2020 2020 2020  AL).            
-0001f6a0: 6966 2077 6569 6768 7420 3d3d 2043 5353  if weight == CSS
-0001f6b0: 5374 796c 652e 424f 4c44 3a0a 2020 2020  Style.BOLD:.    
-0001f6c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001f6d0: 2e73 6574 5f61 7474 7269 6275 7465 2843  .set_attribute(C
-0001f6e0: 5353 5374 796c 652e 464f 4e54 5f57 4549  SSStyle.FONT_WEI
-0001f6f0: 4748 542c 2043 5353 5374 796c 652e 424f  GHT, CSSStyle.BO
-0001f700: 4c44 290a 2020 2020 2020 2020 2020 2020  LD).            
-0001f710: 6966 2077 6569 6768 7420 3d3d 2043 5353  if weight == CSS
-0001f720: 5374 796c 652e 4c49 4748 543a 0a20 2020  Style.LIGHT:.   
-0001f730: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-0001f740: 662e 7365 745f 6174 7472 6962 7574 6528  f.set_attribute(
-0001f750: 4353 5353 7479 6c65 2e46 4f4e 545f 5745  CSSStyle.FONT_WE
-0001f760: 4947 4854 2c20 4353 5353 7479 6c65 2e4c  IGHT, CSSStyle.L
-0001f770: 4947 4854 290a 0a20 2020 2064 6566 2073  IGHT)..    def s
-0001f780: 6574 5f66 6f6e 745f 7374 796c 6528 7365  et_font_style(se
-0001f790: 6c66 2c20 7374 796c 6529 3a0a 2020 2020  lf, style):.    
-0001f7a0: 2020 2020 6966 2073 7479 6c65 3a0a 2020      if style:.  
-0001f7b0: 2020 2020 2020 2020 2020 6966 2073 7479            if sty
-0001f7c0: 6c65 2e6c 6f77 6572 2829 203d 3d20 4353  le.lower() == CS
-0001f7d0: 5353 7479 6c65 2e4e 4f52 4d41 4c2e 6c6f  SStyle.NORMAL.lo
-0001f7e0: 7765 7228 293a 0a20 2020 2020 2020 2020  wer():.         
-0001f7f0: 2020 2020 2020 2073 656c 662e 7365 745f         self.set_
-0001f800: 6174 7472 6962 7574 6528 4353 5353 7479  attribute(CSSSty
-0001f810: 6c65 2e46 4f4e 545f 5354 594c 452c 2043  le.FONT_STYLE, C
-0001f820: 5353 5374 796c 652e 4e4f 524d 414c 290a  SSStyle.NORMAL).
-0001f830: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-0001f840: 7479 6c65 2e6c 6f77 6572 2829 203d 3d20  tyle.lower() == 
-0001f850: 4353 5353 7479 6c65 2e49 5441 4c49 432e  CSSStyle.ITALIC.
-0001f860: 6c6f 7765 7228 293a 0a20 2020 2020 2020  lower():.       
-0001f870: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
-0001f880: 745f 6174 7472 6962 7574 6528 4353 5353  t_attribute(CSSS
-0001f890: 7479 6c65 2e46 4f4e 545f 5354 594c 452c  tyle.FONT_STYLE,
-0001f8a0: 2043 5353 5374 796c 652e 4954 414c 4943   CSSStyle.ITALIC
-0001f8b0: 290a 0a20 2020 2064 6566 2067 6574 5f61  )..    def get_a
-0001f8c0: 7474 7269 6275 7465 2873 656c 662c 2070  ttribute(self, p
-0001f8d0: 726f 7065 7274 7929 3a0a 2020 2020 2020  roperty):.      
-0001f8e0: 2020 2222 220a 2020 2020 2020 2020 6765    """.        ge
-0001f8f0: 7473 2076 616c 7565 2066 6f72 206e 616d  ts value for nam
-0001f900: 6520 696e 2043 5353 5374 796c 650a 2020  e in CSSStyle.  
-0001f910: 2020 2020 2020 6967 6e6f 7265 7320 656d        ignores em
-0001f920: 7074 7920 7661 6c75 6573 206f 7220 4e6f  pty values or No
-0001f930: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
-0001f940: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001f950: 6c66 2e6e 616d 655f 7661 6c75 655f 6469  lf.name_value_di
-0001f960: 6374 2061 6e64 2073 656c 662e 6e61 6d65  ct and self.name
-0001f970: 5f76 616c 7565 5f64 6963 742e 6765 7428  _value_dict.get(
-0001f980: 7072 6f70 6572 7479 290a 0a20 2020 2023  property)..    #
-0001f990: 2020 2020 636c 6173 7320 4353 5353 7479      class CSSSty
-0001f9a0: 6c65 3a0a 0a20 2020 2064 6566 2067 6574  le:..    def get
-0001f9b0: 5f66 6f6e 745f 7374 796c 655f 6174 7472  _font_style_attr
-0001f9c0: 6962 7574 6573 2873 656c 6629 3a0a 2020  ibutes(self):.  
-0001f9d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001f9e0: 2020 6765 7473 2074 7570 6c65 206f 6620    gets tuple of 
-0001f9f0: 3420 666f 6e74 2061 7474 7269 6275 7465  4 font attribute
-0001fa00: 7320 2873 697a 652c 206e 6f6e 7374 726f  s (size, nonstro
-0001fa10: 6b65 2c20 7374 726f 6b65 2c20 666f 6e74  ke, stroke, font
-0001fa20: 6e61 6d65 290a 2020 2020 2020 2020 2222  name).        ""
-0001fa30: 220a 0a20 2020 2020 2020 2069 6620 7365  "..        if se
-0001fa40: 6c66 2e6e 616d 655f 7661 6c75 655f 6469  lf.name_value_di
-0001fa50: 6374 2069 7320 4e6f 6e65 3a0a 2020 2020  ct is None:.    
-0001fa60: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-0001fa70: 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f 6e65  None, None, None
-0001fa80: 2c20 4e6f 6e65 2c20 4e6f 6e65 290a 2020  , None, None).  
-0001fa90: 2020 2020 2020 7265 7475 726e 2028 0a20        return (. 
-0001faa0: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
-0001fab0: 662e 6e61 6d65 5f76 616c 7565 5f64 6963  f.name_value_dic
-0001fac0: 742e 6765 7428 4353 5353 7479 6c65 2e57  t.get(CSSStyle.W
-0001fad0: 4944 5448 292c 0a20 2020 2020 2020 2020  IDTH),.         
-0001fae0: 2020 2073 656c 662e 6765 745f 6174 7472     self.get_attr
-0001faf0: 6962 7574 6528 4353 5353 7479 6c65 2e46  ibute(CSSStyle.F
-0001fb00: 4f4e 545f 5349 5a45 292c 0a20 2020 2020  ONT_SIZE),.     
-0001fb10: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
-0001fb20: 6174 7472 6962 7574 6528 4353 5353 7479  attribute(CSSSty
-0001fb30: 6c65 2e46 494c 4c29 2c0a 2020 2020 2020  le.FILL),.      
-0001fb40: 2020 2020 2020 7365 6c66 2e67 6574 5f61        self.get_a
-0001fb50: 7474 7269 6275 7465 2843 5353 5374 796c  ttribute(CSSStyl
-0001fb60: 652e 5354 524f 4b45 292c 0a20 2020 2020  e.STROKE),.     
-0001fb70: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
-0001fb80: 6174 7472 6962 7574 6528 4353 5353 7479  attribute(CSSSty
-0001fb90: 6c65 2e46 4f4e 545f 4641 4d49 4c59 290a  le.FONT_FAMILY).
-0001fba0: 2020 2020 2020 2020 290a 0a20 2020 2023          )..    #
-0001fbb0: 2020 2020 636c 6173 7320 4353 5353 7479      class CSSSty
-0001fbc0: 6c65 3a0a 0a20 2020 2064 6566 2072 656d  le:..    def rem
-0001fbd0: 6f76 6528 7365 6c66 2c20 6e61 6d65 293a  ove(self, name):
-0001fbe0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001fbf0: 2020 2020 2072 656d 6f76 6573 206e 616d       removes nam
-0001fc00: 6564 2069 7465 6d20 6672 6f6d 2043 5353  ed item from CSS
-0001fc10: 5374 796c 650a 2020 2020 2020 2020 2222  Style.        ""
-0001fc20: 220a 2020 2020 2020 2020 6966 2074 7970  ".        if typ
-0001fc30: 6528 6e61 6d65 2920 6973 206c 6973 743a  e(name) is list:
-0001fc40: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-0001fc50: 206e 2069 6e20 6e61 6d65 3a0a 2020 2020   n in name:.    
-0001fc60: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001fc70: 2e72 656d 6f76 6528 6e29 0a20 2020 2020  .remove(n).     
-0001fc80: 2020 2065 6c69 6620 6e61 6d65 2069 6e20     elif name in 
-0001fc90: 7365 6c66 2e6e 616d 655f 7661 6c75 655f  self.name_value_
-0001fca0: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
-0001fcb0: 2020 7365 6c66 2e6e 616d 655f 7661 6c75    self.name_valu
-0001fcc0: 655f 6469 6374 2e70 6f70 286e 616d 652c  e_dict.pop(name,
-0001fcd0: 204e 6f6e 6529 0a0a 2020 2020 6465 6620   None)..    def 
-0001fce0: 6170 706c 795f 746f 2873 656c 662c 2065  apply_to(self, e
-0001fcf0: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
-0001fd00: 220a 0a20 2020 2020 2020 2022 2222 0a20  "..        """. 
-0001fd10: 2020 2020 2020 2063 7373 5f73 7472 203d         css_str =
-0001fd20: 2073 656c 662e 6765 745f 6373 735f 7661   self.get_css_va
-0001fd30: 6c75 6528 290a 2020 2020 2020 2020 656c  lue().        el
-0001fd40: 656d 2e61 7474 7269 625b 4353 5353 7479  em.attrib[CSSSty
-0001fd50: 6c65 2e53 5459 4c45 5d20 3d20 6373 735f  le.STYLE] = css_
-0001fd60: 7374 720a 0a20 2020 2023 2020 2020 636c  str..    #    cl
-0001fd70: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
-0001fd80: 2020 2064 6566 2067 6574 5f63 7373 5f76     def get_css_v
-0001fd90: 616c 7565 2873 656c 662c 2077 7261 705f  alue(self, wrap_
-0001fda0: 7769 7468 5f63 7572 6c79 3d46 616c 7365  with_curly=False
-0001fdb0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-0001fdc0: 2020 2020 2020 2067 656e 6572 6174 6573         generates
-0001fdd0: 2063 7373 2073 7472 696e 6720 7769 7468   css string with
-0001fde0: 6f75 7420 7175 6f74 6564 206e 616d 6573  out quoted names
-0001fdf0: 2061 6e64 2076 616c 7565 730a 2020 2020   and values.    
-0001fe00: 2020 2020 3a70 6172 616d 2077 7261 705f      :param wrap_
-0001fe10: 7769 7468 5f63 7572 6c79 3a20 6966 2074  with_curly: if t
-0001fe20: 7275 6520 656e 636c 6f73 6520 7374 7269  rue enclose stri
-0001fe30: 6e67 2069 6e20 227b 2220 2e2e 2e20 227d  ng in "{" ... "}
-0001fe40: 220a 2020 2020 2020 2020 2222 220a 2020  ".        """.  
-0001fe50: 2020 2020 2020 7320 3d20 2222 0a20 2020        s = "".   
-0001fe60: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
-0001fe70: 7365 6c66 2e6e 616d 655f 7661 6c75 655f  self.name_value_
-0001fe80: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
-0001fe90: 2020 7661 6c20 3d20 7365 6c66 2e6e 616d    val = self.nam
-0001fea0: 655f 7661 6c75 655f 6469 6374 5b6b 6579  e_value_dict[key
-0001feb0: 5d0a 2020 2020 2020 2020 2020 2020 7320  ].            s 
-0001fec0: 2b3d 206b 6579 202b 2022 3a20 2220 2b20  += key + ": " + 
-0001fed0: 7374 7228 7661 6c29 202b 2022 3b20 220a  str(val) + "; ".
-0001fee0: 2020 2020 2020 2020 7320 3d20 732e 7374          s = s.st
-0001fef0: 7269 7028 290a 2020 2020 2020 2020 7265  rip().        re
-0001ff00: 7475 726e 2022 7b22 202b 2073 202b 2022  turn "{" + s + "
-0001ff10: 7d22 2069 6620 7772 6170 5f77 6974 685f  }" if wrap_with_
-0001ff20: 6375 726c 7920 656c 7365 2073 0a0a 2020  curly else s..  
-0001ff30: 2020 6465 6620 6174 7476 616c 2873 656c    def attval(sel
-0001ff40: 662c 206e 616d 6529 3a0a 2020 2020 2020  f, name):.      
-0001ff50: 2020 7265 7475 726e 2073 656c 662e 6e61    return self.na
-0001ff60: 6d65 5f76 616c 7565 5f64 6963 742e 6765  me_value_dict.ge
-0001ff70: 7428 6e61 6d65 2920 6966 2073 656c 662e  t(name) if self.
-0001ff80: 6e61 6d65 5f76 616c 7565 5f64 6963 7420  name_value_dict 
-0001ff90: 656c 7365 204e 6f6e 650a 0a20 2020 2023  else None..    #
-0001ffa0: 2020 2020 636c 6173 7320 4353 5353 7479      class CSSSty
-0001ffb0: 6c65 3a0a 0a20 2020 2040 7072 6f70 6572  le:..    @proper
-0001ffc0: 7479 0a20 2020 2064 6566 2066 6f6e 745f  ty.    def font_
-0001ffd0: 6661 6d69 6c79 2873 656c 6629 3a0a 2020  family(self):.  
-0001ffe0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0001fff0: 662e 6174 7476 616c 2843 5353 5374 796c  f.attval(CSSStyl
-00020000: 652e 464f 4e54 5f46 414d 494c 5929 0a0a  e.FONT_FAMILY)..
-00020010: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
-00020020: 2020 6465 6620 746f 7028 7365 6c66 293a    def top(self):
-00020030: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00020040: 7365 6c66 2e67 6574 5f6e 756d 6572 6963  self.get_numeric
-00020050: 5f61 7474 7661 6c28 4353 5353 7479 6c65  _attval(CSSStyle
-00020060: 2e54 4f50 290a 0a20 2020 2040 7072 6f70  .TOP)..    @prop
-00020070: 6572 7479 0a20 2020 2064 6566 2066 6f6e  erty.    def fon
-00020080: 745f 7369 7a65 2873 656c 6629 3a0a 2020  t_size(self):.  
-00020090: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000200a0: 662e 6765 745f 6e75 6d65 7269 635f 6174  f.get_numeric_at
-000200b0: 7476 616c 2843 5353 5374 796c 652e 464f  tval(CSSStyle.FO
-000200c0: 4e54 5f53 495a 4529 0a0a 2020 2020 4070  NT_SIZE)..    @p
-000200d0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-000200e0: 6973 5f62 6f6c 6428 7365 6c66 293a 0a20  is_bold(self):. 
-000200f0: 2020 2020 2020 2077 6569 6768 7420 3d20         weight = 
-00020100: 7365 6c66 2e61 7474 7661 6c28 4353 5353  self.attval(CSSS
-00020110: 7479 6c65 2e46 4f4e 545f 5745 4947 4854  tyle.FONT_WEIGHT
-00020120: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00020130: 2077 6569 6768 7420 6973 206e 6f74 204e   weight is not N
-00020140: 6f6e 6520 616e 6420 7765 6967 6874 2e6c  one and weight.l
-00020150: 6f77 6572 2829 203d 3d20 4353 5353 7479  ower() == CSSSty
-00020160: 6c65 2e42 4f4c 442e 6c6f 7765 7228 290a  le.BOLD.lower().
-00020170: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-00020180: 2020 2064 6566 2069 735f 6974 616c 6963     def is_italic
-00020190: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000201a0: 7374 796c 6520 3d20 7365 6c66 2e61 7474  style = self.att
-000201b0: 7661 6c28 4353 5353 7479 6c65 2e46 4f4e  val(CSSStyle.FON
-000201c0: 545f 5354 594c 4529 0a20 2020 2020 2020  T_STYLE).       
-000201d0: 2072 6574 7572 6e20 7374 796c 6520 6973   return style is
-000201e0: 206e 6f74 204e 6f6e 6520 616e 6420 7374   not None and st
-000201f0: 796c 652e 6c6f 7765 7228 2920 3d3d 2043  yle.lower() == C
-00020200: 5353 5374 796c 652e 4954 414c 4943 2e6c  SSStyle.ITALIC.l
-00020210: 6f77 6572 2829 0a0a 2020 2020 4070 726f  ower()..    @pro
-00020220: 7065 7274 790a 2020 2020 6465 6620 626f  perty.    def bo
-00020230: 7474 6f6d 2873 656c 6629 3a0a 2020 2020  ttom(self):.    
-00020240: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00020250: 6765 745f 6e75 6d65 7269 635f 6174 7476  get_numeric_attv
-00020260: 616c 2843 5353 5374 796c 652e 424f 5454  al(CSSStyle.BOTT
-00020270: 4f4d 290a 0a20 2020 2040 7072 6f70 6572  OM)..    @proper
-00020280: 7479 0a20 2020 2064 6566 206c 6566 7428  ty.    def left(
-00020290: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-000202a0: 6574 7572 6e20 7365 6c66 2e67 6574 5f6e  eturn self.get_n
-000202b0: 756d 6572 6963 5f61 7474 7661 6c28 4353  umeric_attval(CS
-000202c0: 5353 7479 6c65 2e4c 4546 5429 0a0a 2020  SStyle.LEFT)..  
-000202d0: 2020 2320 2020 2063 6c61 7373 2043 5353    #    class CSS
-000202e0: 5374 796c 653a 0a0a 2020 2020 4070 726f  Style:..    @pro
-000202f0: 7065 7274 790a 2020 2020 6465 6620 7769  perty.    def wi
-00020300: 6474 6828 7365 6c66 293a 0a20 2020 2020  dth(self):.     
-00020310: 2020 2072 6574 7572 6e20 7365 6c66 2e67     return self.g
-00020320: 6574 5f6e 756d 6572 6963 5f61 7474 7661  et_numeric_attva
-00020330: 6c28 4353 5353 7479 6c65 2e57 4944 5448  l(CSSStyle.WIDTH
-00020340: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
-00020350: 0a20 2020 2064 6566 2068 6569 6768 7428  .    def height(
-00020360: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-00020370: 6574 7572 6e20 7365 6c66 2e67 6574 5f6e  eturn self.get_n
-00020380: 756d 6572 6963 5f61 7474 7661 6c28 4353  umeric_attval(CS
-00020390: 5353 7479 6c65 2e48 4549 4748 5429 0a0a  SStyle.HEIGHT)..
-000203a0: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
-000203b0: 5353 5374 796c 653a 0a0a 2020 2020 4063  SSStyle:..    @c
-000203c0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-000203d0: 6566 2061 6464 5f6e 616d 655f 7661 6c75  ef add_name_valu
-000203e0: 6528 636c 732c 2065 6c65 6d2c 2063 7373  e(cls, elem, css
-000203f0: 5f6e 616d 652c 2063 7373 5f76 616c 7565  _name, css_value
-00020400: 293a 0a20 2020 2020 2020 2022 2222 7570  ):.        """up
-00020410: 6461 7465 7320 7374 796c 6520 6f6e 2065  dates style on e
-00020420: 6c65 6d65 6e74 0a20 2020 2020 2020 203a  lement.        :
-00020430: 7061 7261 6d20 6373 735f 6e61 6d65 3a20  param css_name: 
-00020440: 6e61 6d65 206f 6620 7072 6f70 6572 7479  name of property
-00020450: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00020460: 6373 735f 7661 6c75 653a 2076 616c 7565  css_value: value
-00020470: 206f 6620 7072 6f70 6572 7479 0a20 2020   of property.   
-00020480: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00020490: 2063 7373 5f73 7479 6c65 203d 2063 6c73   css_style = cls
-000204a0: 2e63 7265 6174 655f 6373 735f 7374 796c  .create_css_styl
-000204b0: 655f 6672 6f6d 5f61 7474 7269 6275 7465  e_from_attribute
-000204c0: 5f6f 665f 626f 6479 5f65 6c65 6d65 6e74  _of_body_element
-000204d0: 2865 6c65 6d29 0a20 2020 2020 2020 2063  (elem).        c
-000204e0: 7373 5f73 7479 6c65 2e6e 616d 655f 7661  ss_style.name_va
-000204f0: 6c75 655f 6469 6374 5b63 7373 5f6e 616d  lue_dict[css_nam
-00020500: 655d 203d 2063 7373 5f76 616c 7565 0a20  e] = css_value. 
-00020510: 2020 2020 2020 2063 7373 5f73 7479 6c65         css_style
-00020520: 2e61 7070 6c79 5f74 6f28 656c 656d 290a  .apply_to(elem).
-00020530: 0a20 2020 2064 6566 2067 6574 5f6e 756d  .    def get_num
-00020540: 6572 6963 5f61 7474 7661 6c28 7365 6c66  eric_attval(self
-00020550: 2c20 6e61 6d65 2c20 6465 6369 6d61 6c3d  , name, decimal=
-00020560: 3129 3a0a 2020 2020 2020 2020 2222 220a  1):.        """.
-00020570: 2020 2020 2020 2020 6765 7473 2066 6c6f          gets flo
-00020580: 6174 2076 616c 7565 2c20 726f 756e 6465  at value, rounde
-00020590: 6420 746f 2064 656d 6963 616c 2070 6c61  d to demical pla
-000205a0: 6265 730a 2020 2020 2020 2020 3a70 6172  bes.        :par
-000205b0: 616d 206e 616d 653a 206f 6620 7061 7261  am name: of para
-000205c0: 6d65 7465 720a 2020 2020 2020 2020 3a70  meter.        :p
-000205d0: 6172 616d 2072 6f75 6e64 3a20 6e75 6d62  aram round: numb
-000205e0: 6572 206f 6620 6465 6369 6d61 6c20 706c  er of decimal pl
-000205f0: 6163 6573 2028 6465 6661 756c 7420 3229  aces (default 2)
-00020600: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00020610: 2020 2020 2076 616c 7565 203d 2073 656c       value = sel
-00020620: 662e 6174 7476 616c 286e 616d 6529 0a20  f.attval(name). 
-00020630: 2020 2020 2020 2069 6620 6e6f 7420 7661         if not va
-00020640: 6c75 653a 0a20 2020 2020 2020 2020 2020  lue:.           
-00020650: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-00020660: 2020 2020 2069 6620 7479 7065 2876 616c       if type(val
-00020670: 7565 2920 6973 2073 7472 3a0a 2020 2020  ue) is str:.    
-00020680: 2020 2020 2020 2020 7661 6c75 6520 3d20          value = 
-00020690: 7661 6c75 655b 3a2d 325d 2069 6620 7661  value[:-2] if va
-000206a0: 6c75 652e 656e 6473 7769 7468 2843 5353  lue.endswith(CSS
-000206b0: 5374 796c 652e 5058 2920 656c 7365 2076  Style.PX) else v
-000206c0: 616c 7565 0a20 2020 2020 2020 2020 2020  alue.           
-000206d0: 2076 616c 7565 203d 2066 6c6f 6174 2876   value = float(v
-000206e0: 616c 7565 290a 0a20 2020 2020 2020 2066  alue)..        f
-000206f0: 7320 3d20 726f 756e 6428 666c 6f61 7428  s = round(float(
-00020700: 7661 6c75 6529 2c20 6465 6369 6d61 6c29  value), decimal)
-00020710: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00020720: 6673 0a0a 2020 2020 2320 2020 2063 6c61  fs..    #    cla
-00020730: 7373 2043 5353 5374 796c 653a 0a0a 2020  ss CSSStyle:..  
-00020740: 2020 6465 6620 6973 5f62 6f6c 645f 6e61    def is_bold_na
-00020750: 6d65 2873 656c 6629 3a0a 2020 2020 2020  me(self):.      
-00020760: 2020 2222 2248 6575 7269 7374 6963 2075    """Heuristic u
-00020770: 7369 6e67 2066 6f6e 742d 6e61 6d65 0a20  sing font-name. 
-00020780: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-00020790: 5472 7565 2069 6620 6e61 6d65 2063 6f6e  True if name con
-000207a0: 7461 696e 7320 2242 6f6c 6422 206f 7220  tains "Bold" or 
-000207b0: 222e 4222 206f 7220 2e2e 2222 220a 2020  ".B" or ..""".  
-000207c0: 2020 2020 2020 666f 6e74 6e61 6d65 203d        fontname =
-000207d0: 2073 656c 662e 666f 6e74 5f66 616d 696c   self.font_famil
-000207e0: 790a 2020 2020 2020 2020 7265 7375 6c74  y.        result
-000207f0: 203d 2028 7365 6c66 2e42 4f4c 4420 696e   = (self.BOLD in
-00020800: 2066 6f6e 746e 616d 6529 206f 7220 2866   fontname) or (f
-00020810: 6f6e 746e 616d 652e 656e 6473 7769 7468  ontname.endswith
-00020820: 2873 656c 662e 444f 545f 4229 2920 6966  (self.DOT_B)) if
-00020830: 2066 6f6e 746e 616d 6520 656c 7365 2046   fontname else F
-00020840: 616c 7365 0a20 2020 2020 2020 2072 6574  alse.        ret
-00020850: 7572 6e20 7265 7375 6c74 0a0a 2020 2020  urn result..    
-00020860: 2320 2020 2063 6c61 7373 2043 5353 5374  #    class CSSSt
-00020870: 796c 653a 0a0a 2020 2020 6465 6620 6f62  yle:..    def ob
-00020880: 6579 7328 7365 6c66 2c20 636f 6e64 6974  eys(self, condit
-00020890: 696f 6e29 3a0a 2020 2020 2020 2020 2222  ion):.        ""
-000208a0: 2274 6573 7420 6966 2073 7479 6c65 206f  "test if style o
-000208b0: 6265 7973 2061 2028 7369 6d70 6c65 2920  beys a (simple) 
-000208c0: 636f 6e64 6974 696f 6e0a 2020 2020 2020  condition.      
-000208d0: 2020 2849 276c 6c20 7772 6974 6520 6120    (I'll write a 
-000208e0: 4453 4c20 6c61 7465 7229 0a20 2020 2020  DSL later).     
-000208f0: 2020 203a 7061 7261 6d20 636f 6e64 6974     :param condit
-00020900: 696f 6e3a 2028 6e61 6d65 2c20 6f70 6572  ion: (name, oper
-00020910: 6174 6f72 2c20 7661 6c75 6529 2c20 652e  ator, value), e.
-00020920: 672e 2022 666f 6e74 2d73 697a 653e 3130  g. "font-size>10
-00020930: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00020940: 3a20 7465 7374 206f 6620 636f 6e64 6974  : test of condit
-00020950: 696f 6e0a 0a20 2020 2020 2020 2022 2222  ion..        """
-00020960: 0a20 2020 2020 2020 2072 6573 756c 7420  .        result 
-00020970: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00020980: 6966 2063 6f6e 6469 7469 6f6e 3a0a 2020  if condition:.  
-00020990: 2020 2020 2020 2020 2020 7373 203d 2072            ss = r
-000209a0: 652e 7370 6c69 7428 2728 3e7c 3c7c 3d3d  e.split('(>|<|==
-000209b0: 7c21 3d29 272c 2063 6f6e 6469 7469 6f6e  |!=)', condition
-000209c0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000209d0: 206c 656e 2873 7329 2021 3d20 333a 0a20   len(ss) != 3:. 
-000209e0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-000209f0: 6f67 6769 6e67 2e77 6172 6e69 6e67 2866  ogging.warning(f
-00020a00: 2243 616e 6e6f 7420 7061 7273 6520 6173  "Cannot parse as
-00020a10: 2063 6f6e 6469 7469 6f6e 207b 636f 6e64   condition {cond
-00020a20: 6974 696f 6e7d 2229 0a20 2020 2020 2020  ition}").       
-00020a30: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00020a40: 2020 2020 2020 2020 2020 206c 6873 203d             lhs =
-00020a50: 2073 735b 305d 2e73 7472 6970 2829 0a20   ss[0].strip(). 
-00020a60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00020a70: 6873 203d 2073 735b 325d 2e73 7472 6970  hs = ss[2].strip
-00020a80: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-00020a90: 2020 2020 6966 206c 6873 206e 6f74 2069      if lhs not i
-00020aa0: 6e20 7365 6c66 2e6e 616d 655f 7661 6c75  n self.name_valu
-00020ab0: 655f 6469 6374 3a0a 2020 2020 2020 2020  e_dict:.        
-00020ac0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00020ad0: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-00020ae0: 2020 2020 2020 2020 2076 616c 7565 3120           value1 
-00020af0: 3d20 7365 6c66 2e6e 616d 655f 7661 6c75  = self.name_valu
-00020b00: 655f 6469 6374 2e67 6574 286c 6873 290a  e_dict.get(lhs).
-00020b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b20: 6966 206e 6f74 2076 616c 7565 313a 0a20  if not value1:. 
-00020b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020b40: 2020 206c 6f67 6769 6e67 2e77 6172 6e69     logging.warni
-00020b50: 6e67 2866 227b 6c68 737d 206e 6f74 2069  ng(f"{lhs} not i
-00020b60: 6e20 7374 796c 6520 6174 7472 6962 7574  n style attribut
-00020b70: 6520 7b73 656c 662e 6e61 6d65 5f76 616c  e {self.name_val
-00020b80: 7565 5f64 6963 747d 2229 0a20 2020 2020  ue_dict}").     
-00020b90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00020ba0: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
-00020bb0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-00020bc0: 616c 7565 312e 656e 6473 7769 7468 2843  alue1.endswith(C
-00020bd0: 5353 5374 796c 652e 5058 293a 0a20 2020  SSStyle.PX):.   
-00020be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020bf0: 2076 616c 7565 3120 3d20 7661 6c75 6531   value1 = value1
-00020c00: 5b3a 2d32 5d0a 2020 2020 2020 2020 2020  [:-2].          
-00020c10: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00020c20: 2020 2020 2020 2020 2020 2020 2020 2076                 v
-00020c30: 616c 7565 3120 3d20 666c 6f61 7428 7661  alue1 = float(va
-00020c40: 6c75 6531 290a 2020 2020 2020 2020 2020  lue1).          
-00020c50: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00020c60: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00020c70: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00020c80: 696e 672e 7761 726e 696e 6728 6622 6e6f  ing.warning(f"no
-00020c90: 7420 6120 6e75 6d62 6572 207b 7661 6c75  t a number {valu
-00020ca0: 6531 7d22 290a 2020 2020 2020 2020 2020  e1}").          
-00020cb0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00020cc0: 2046 616c 7365 0a0a 2020 2020 2020 2020   False..        
-00020cd0: 2020 2020 2020 2020 6966 2072 6873 2e65          if rhs.e
-00020ce0: 6e64 7377 6974 6828 4353 5353 7479 6c65  ndswith(CSSStyle
-00020cf0: 2e50 5829 3a0a 2020 2020 2020 2020 2020  .PX):.          
-00020d00: 2020 2020 2020 2020 2020 7268 7320 3d20            rhs = 
-00020d10: 7268 735b 3a2d 325d 0a20 2020 2020 2020  rhs[:-2].       
-00020d20: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00020d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020d40: 2020 7661 6c75 6532 203d 2066 6c6f 6174    value2 = float
-00020d50: 2872 6873 290a 2020 2020 2020 2020 2020  (rhs).          
-00020d60: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-00020d70: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
-00020d80: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00020d90: 696e 672e 7761 726e 696e 6728 6622 6e6f  ing.warning(f"no
-00020da0: 7420 6120 6e75 6d62 6572 207b 7268 737d  t a number {rhs}
-00020db0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00020dc0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00020dd0: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
-00020de0: 2020 2020 6f70 6572 203d 2073 735b 315d      oper = ss[1]
-00020df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020e00: 2069 6620 6f70 6572 203d 3d20 223e 223a   if oper == ">":
-00020e10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020e20: 2020 2020 2072 6573 756c 7420 3d20 7661       result = va
-00020e30: 6c75 6531 203e 2076 616c 7565 320a 2020  lue1 > value2.  
-00020e40: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00020e50: 6966 206f 7065 7220 3d3d 2022 3c22 3a0a  if oper == "<":.
-00020e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020e70: 2020 2020 7265 7375 6c74 203d 2076 616c      result = val
-00020e80: 7565 3120 3c20 7661 6c75 6532 0a20 2020  ue1 < value2.   
-00020e90: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00020ea0: 6620 6f70 6572 203d 3d20 2221 3d22 3a0a  f oper == "!=":.
-00020eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020ec0: 2020 2020 7265 7375 6c74 203d 2076 616c      result = val
-00020ed0: 7565 3120 213d 2076 616c 7565 320a 2020  ue1 != value2.  
-00020ee0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00020ef0: 6966 206f 7065 7220 3d3d 2022 3d3d 223a  if oper == "==":
-00020f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020f10: 2020 2020 2072 6573 756c 7420 3d20 2876       result = (v
-00020f20: 616c 7565 3120 3d3d 2076 616c 7565 3229  alue1 == value2)
-00020f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020f40: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00020f50: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00020f60: 2056 616c 7565 4572 726f 7228 6622 6261   ValueError(f"ba
-00020f70: 6420 6f70 6572 6174 6f72 3a20 7b6f 7065  d operator: {ope
-00020f80: 727d 2229 0a20 2020 2020 2020 2020 2020  r}").           
-00020f90: 2020 2020 2069 6620 7265 7375 6c74 3a0a       if result:.
-00020fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020fb0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
-00020fc0: 2072 6574 7572 6e20 7265 7375 6c74 0a0a   return result..
-00020fd0: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
-00020fe0: 5353 5374 796c 653a 0a0a 2020 2020 4063  SSStyle:..    @c
-00020ff0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00021000: 6566 2063 6d79 6b5f 746f 5f72 6762 2863  ef cmyk_to_rgb(c
-00021010: 6c73 2c20 632c 206d 2c20 792c 206b 293a  ls, c, m, y, k):
-00021020: 0a0a 2020 2020 2020 2020 7267 625f 7363  ..        rgb_sc
-00021030: 616c 6520 3d20 3235 350a 2020 2020 2020  ale = 255.      
-00021040: 2020 2320 636d 796b 5f73 6361 6c65 203d    # cmyk_scale =
-00021050: 2031 3030 0a20 2020 2020 2020 2063 6d79   100.        cmy
-00021060: 6b5f 7363 616c 6520 3d20 312e 300a 2020  k_scale = 1.0.  
-00021070: 2020 2020 2020 7220 3d20 7267 625f 7363        r = rgb_sc
-00021080: 616c 6520 2a20 2831 2e30 202d 2028 6320  ale * (1.0 - (c 
-00021090: 2b20 6b29 202f 2066 6c6f 6174 2863 6d79  + k) / float(cmy
-000210a0: 6b5f 7363 616c 6529 290a 2020 2020 2020  k_scale)).      
-000210b0: 2020 6720 3d20 7267 625f 7363 616c 6520    g = rgb_scale 
-000210c0: 2a20 2831 2e30 202d 2028 6d20 2b20 6b29  * (1.0 - (m + k)
-000210d0: 202f 2066 6c6f 6174 2863 6d79 6b5f 7363   / float(cmyk_sc
-000210e0: 616c 6529 290a 2020 2020 2020 2020 6220  ale)).        b 
-000210f0: 3d20 7267 625f 7363 616c 6520 2a20 2831  = rgb_scale * (1
-00021100: 2e30 202d 2028 7920 2b20 6b29 202f 2066  .0 - (y + k) / f
-00021110: 6c6f 6174 2863 6d79 6b5f 7363 616c 6529  loat(cmyk_scale)
-00021120: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-00021130: 6e20 722c 2067 2c20 620a 0a20 2020 2023  n r, g, b..    #
-00021140: 2020 2020 636c 6173 7320 4353 5353 7479      class CSSSty
-00021150: 6c65 3a0a 0a20 2020 2040 636c 6173 736d  le:..    @classm
-00021160: 6574 686f 640a 2020 2020 6465 6620 636d  ethod.    def cm
-00021170: 6b79 5f74 6f5f 7267 6228 636c 732c 2063  ky_to_rgb(cls, c
-00021180: 2c20 6d2c 206b 2c20 7929 3a0a 2020 2020  , m, k, y):.    
-00021190: 2020 2020 7265 7475 726e 2063 6c73 2e63      return cls.c
-000211a0: 6d79 6b5f 746f 5f72 6762 2863 2c20 6d2c  myk_to_rgb(c, m,
-000211b0: 2079 2c20 6b29 0a0a 2020 2020 6465 6620   y, k)..    def 
-000211c0: 6578 7472 6163 745f 626f 6c64 5f69 7461  extract_bold_ita
-000211d0: 6c69 635f 6672 6f6d 5f66 6f6e 745f 6661  lic_from_font_fa
-000211e0: 6d69 6c79 280a 2020 2020 2020 2020 2020  mily(.          
-000211f0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00021200: 2020 2020 6f76 6572 7772 6974 655f 626f      overwrite_bo
-00021210: 6c64 3d46 616c 7365 2c0a 2020 2020 2020  ld=False,.      
-00021220: 2020 2020 2020 6f76 6572 7772 6974 655f        overwrite_
-00021230: 7374 796c 653d 4661 6c73 652c 0a20 2020  style=False,.   
-00021240: 2020 2020 2020 2020 206f 7665 7277 7269           overwri
-00021250: 7465 5f66 616d 696c 793d 5472 7565 2c0a  te_family=True,.
-00021260: 2020 2020 2020 2020 2020 2020 7374 796c              styl
-00021270: 655f 7265 6765 783d 5354 594c 455f 5245  e_regex=STYLE_RE
-00021280: 2c0a 2020 2020 2020 2020 2020 2020 7765  ,.            we
-00021290: 6967 6874 5f72 6567 6578 3d57 4549 4748  ight_regex=WEIGH
-000212a0: 545f 5245 293a 0a20 2020 2020 2020 2022  T_RE):.        "
-000212b0: 2222 0a20 2020 2020 2020 2068 6575 7269  "".        heuri
-000212c0: 7374 6963 7320 746f 2066 696e 6420 626f  stics to find bo
-000212d0: 6c64 2061 6e64 2069 7461 6c69 6320 696e  ld and italic in
-000212e0: 2066 6f6e 7420 6e61 6d65 7320 616e 6420   font names and 
-000212f0: 7472 7920 746f 206e 6f72 6d61 6c69 7365  try to normalise
-00021300: 0a20 2020 2020 2020 2065 2e67 2e0a 2020  .        e.g..  
-00021310: 2020 2020 2020 666f 6e74 2d66 616d 696c        font-famil
-00021320: 793a 2054 696d 6573 4e65 7752 6f6d 616e  y: TimesNewRoman
-00021330: 5053 2d42 6f6c 644d 543b 203d 3e20 666f  PS-BoldMT; => fo
-00021340: 6e74 2d66 616d 696c 793a 2054 696d 6573  nt-family: Times
-00021350: 4e65 7752 6f6d 616e 5053 4d54 3b20 666f  NewRomanPSMT; fo
-00021360: 6e74 5f77 6569 6768 743a 2062 6f6c 640a  nt_weight: bold.
-00021370: 2020 2020 2020 2020 666f 6e74 2d66 616d          font-fam
-00021380: 696c 793a 2054 696d 6573 4e65 7752 6f6d  ily: TimesNewRom
-00021390: 616e 5053 2d49 7461 6c69 634d 543b 203d  anPS-ItalicMT; =
-000213a0: 3e20 666f 6e74 2d66 616d 696c 793a 2054  > font-family: T
-000213b0: 696d 6573 4e65 7752 6f6d 616e 5053 4d54  imesNewRomanPSMT
-000213c0: 3b20 666f 6e74 5f73 7479 6c65 3a20 6974  ; font_style: it
-000213d0: 616c 6963 0a20 2020 2020 2020 2074 6865  alic.        the
-000213e0: 206f 7665 7277 7269 7465 5f2a 2064 6574   overwrite_* det
-000213f0: 6572 6d69 6e65 2077 6865 7465 6872 2065  ermine whetehr e
-00021400: 7869 7374 696e 6720 636f 6d70 6f6e 656e  xisting componen
-00021410: 7473 2077 696c 6c20 6265 206f 7665 7277  ts will be overw
-00021420: 7269 7474 656e 0a20 2020 2020 2020 203a  ritten.        :
-00021430: 7061 7261 6d20 6f76 6572 7772 6974 655f  param overwrite_
-00021440: 626f 6c64 3a20 6372 6561 7465 2066 6f6e  bold: create fon
-00021450: 745f 7765 6967 6874 3a62 6f6c 6420 7265  t_weight:bold re
-00021460: 6761 7264 6c65 7373 206f 6620 7072 6576  gardless of prev
-00021470: 696f 7573 2077 6569 6768 740a 2020 2020  ious weight.    
-00021480: 2020 2020 3a70 6172 616d 206f 7665 7277      :param overw
-00021490: 7269 7465 5f73 7479 6c65 3a20 6372 6561  rite_style: crea
-000214a0: 7465 2066 6f6e 745f 7374 796c 653a 626f  te font_style:bo
-000214b0: 6c64 2072 6567 6172 646c 6573 7320 6f66  ld regardless of
-000214c0: 2070 7265 7669 6f75 7320 7374 796c 650a   previous style.
-000214d0: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-000214e0: 7665 7277 7269 7465 5f66 616d 696c 793a  verwrite_family:
-000214f0: 2065 6469 7420 666f 6e74 2d66 616d 696c   edit font-famil
-00021500: 7920 746f 2072 656d 6f76 6520 7374 796c  y to remove styl
-00021510: 652f 7765 6967 6874 2069 6e66 6f20 2868  e/weight info (h
-00021520: 6163 6b79 290a 2020 2020 2020 2020 3a70  acky).        :p
-00021530: 6172 616d 2073 7479 6c65 5f72 6567 6578  aram style_regex
-00021540: 3d0a 0a20 2020 2020 2020 2022 2222 0a20  =..        """. 
-00021550: 2020 2020 2020 2066 616d 696c 7920 3d20         family = 
-00021560: 7365 6c66 2e66 6f6e 745f 6661 6d69 6c79  self.font_family
-00021570: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00021580: 6661 6d69 6c79 3a0a 2020 2020 2020 2020  family:.        
-00021590: 2020 2020 7265 7475 726e 0a20 2020 2020      return.     
-000215a0: 2020 2066 616d 696c 795f 7374 796c 652c     family_style,
-000215b0: 2073 7479 6c65 203d 2073 656c 662e 6d61   style = self.ma
-000215c0: 7463 685f 7765 6967 6874 5f73 7479 6c65  tch_weight_style
-000215d0: 2866 616d 696c 792c 2073 7479 6c65 5f72  (family, style_r
-000215e0: 6567 6578 2c20 7661 6c75 653d 2249 222c  egex, value="I",
-000215f0: 206d 6172 6b3d 2253 5322 290a 2020 2020   mark="SS").    
-00021600: 2020 2020 6661 6d69 6c79 5f77 6569 6768      family_weigh
-00021610: 742c 2077 6569 6768 7420 3d20 7365 6c66  t, weight = self
-00021620: 2e6d 6174 6368 5f77 6569 6768 745f 7374  .match_weight_st
-00021630: 796c 6528 6661 6d69 6c79 2c20 7765 6967  yle(family, weig
-00021640: 6874 5f72 6567 6578 2c20 7661 6c75 653d  ht_regex, value=
-00021650: 2242 222c 206d 6172 6b3d 2257 5722 290a  "B", mark="WW").
-00021660: 2020 2020 2020 2020 2320 7072 696e 7428          # print(
-00021670: 6622 6661 6d69 6c79 3a20 7b66 616d 696c  f"family: {famil
-00021680: 797d 3b20 7374 796c 653a 207b 7374 796c  y}; style: {styl
-00021690: 657d 3b20 7765 6967 6874 3a20 7b77 6569  e}; weight: {wei
-000216a0: 6768 747d 3b22 290a 2020 2020 2020 2020  ght};").        
-000216b0: 6966 2066 616d 696c 795f 7765 6967 6874  if family_weight
-000216c0: 2061 6e64 206f 7665 7277 7269 7465 5f66   and overwrite_f
-000216d0: 616d 696c 793a 0a20 2020 2020 2020 2020  amily:.         
-000216e0: 2020 2073 656c 662e 7365 745f 6661 6d69     self.set_fami
-000216f0: 6c79 2866 616d 696c 795f 7765 6967 6874  ly(family_weight
-00021700: 290a 2020 2020 2020 2020 6966 2077 6569  ).        if wei
-00021710: 6768 7420 616e 6420 6f76 6572 7772 6974  ght and overwrit
-00021720: 655f 626f 6c64 3a0a 2020 2020 2020 2020  e_bold:.        
-00021730: 2020 2020 7365 6c66 2e73 6574 5f66 6f6e      self.set_fon
-00021740: 745f 7765 6967 6874 2877 6569 6768 7429  t_weight(weight)
-00021750: 0a20 2020 2020 2020 2069 6620 7374 796c  .        if styl
-00021760: 6520 616e 6420 6f76 6572 7772 6974 655f  e and overwrite_
-00021770: 7374 796c 653a 0a20 2020 2020 2020 2020  style:.         
-00021780: 2020 2073 656c 662e 7365 745f 666f 6e74     self.set_font
-00021790: 5f73 7479 6c65 2873 7479 6c65 290a 2020  _style(style).  
-000217a0: 2020 2020 2020 2320 6966 2073 7479 6c65        # if style
-000217b0: 2061 6e64 206f 7665 7277 7269 7465 5f73   and overwrite_s
-000217c0: 7472 6574 6368 6564 3a0a 2020 2020 2020  tretched:.      
-000217d0: 2020 2320 2020 2020 7365 6c66 2e73 6574    #     self.set
-000217e0: 5f66 6f6e 745f 7374 7265 7463 6865 6428  _font_stretched(
-000217f0: 7374 796c 6529 0a20 2020 2020 2020 2023  style).        #
-00021800: 2070 7269 6e74 2866 226e 6577 2073 7479   print(f"new sty
-00021810: 6c65 207b 7365 6c66 7d22 290a 0a0a 2020  le {self}")...  
-00021820: 2020 2320 2020 2063 6c61 7373 2043 5353    #    class CSS
-00021830: 5374 796c 653a 0a0a 2020 2020 6465 6620  Style:..    def 
-00021840: 6d61 7463 685f 7765 6967 6874 5f73 7479  match_weight_sty
-00021850: 6c65 2873 656c 662c 2066 616d 696c 792c  le(self, family,
-00021860: 2077 6569 6768 745f 7265 6765 782c 2076   weight_regex, v
-00021870: 616c 7565 3d4e 6f6e 652c 206d 6172 6b3d  alue=None, mark=
-00021880: 4e6f 6e65 293a 0a20 2020 2020 2020 2077  None):.        w
-00021890: 6569 6768 745f 7265 6320 3d20 7265 2e63  eight_rec = re.c
-000218a0: 6f6d 7069 6c65 2877 6569 6768 745f 7265  ompile(weight_re
-000218b0: 6765 7829 2069 6620 7765 6967 6874 5f72  gex) if weight_r
-000218c0: 6567 6578 2065 6c73 6520 4e6f 6e65 0a20  egex else None. 
-000218d0: 2020 2020 2020 206d 6174 6368 203d 2077         match = w
-000218e0: 6569 6768 745f 7265 632e 7365 6172 6368  eight_rec.search
-000218f0: 2866 616d 696c 7929 0a20 2020 2020 2020  (family).       
-00021900: 2069 6620 6d61 7463 683a 0a20 2020 2020   if match:.     
-00021910: 2020 2020 2020 2076 616c 7565 203d 2066         value = f
-00021920: 616d 696c 795b 6d61 7463 682e 7374 6172  amily[match.star
-00021930: 7428 293a 6d61 7463 682e 656e 6428 295d  t():match.end()]
-00021940: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
-00021950: 7565 203d 2076 616c 7565 2e72 6570 6c61  ue = value.repla
-00021960: 6365 2822 2d22 2c20 2222 292e 7265 706c  ce("-", "").repl
-00021970: 6163 6528 222e 222c 2022 2229 0a20 2020  ace(".", "").   
-00021980: 2020 2020 2020 2020 2066 616d 696c 7920           family 
-00021990: 3d20 6661 6d69 6c79 5b3a 6d61 7463 682e  = family[:match.
-000219a0: 7374 6172 7428 295d 202b 2066 616d 696c  start()] + famil
-000219b0: 795b 6d61 7463 682e 656e 6428 293a 5d0a  y[match.end():].
-000219c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000219d0: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
-000219e0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2072  = None.        r
-000219f0: 6574 7572 6e20 6661 6d69 6c79 2c20 7661  eturn family, va
-00021a00: 6c75 650a 0a20 2020 2023 2020 2020 636c  lue..    #    cl
-00021a10: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
-00021a20: 2020 2064 6566 2063 7265 6174 655f 6262     def create_bb
-00021a30: 6f78 2873 656c 6629 3a0a 2020 2020 2020  ox(self):.      
-00021a40: 2020 2222 220a 2020 2020 2020 2020 6372    """.        cr
-00021a50: 6561 7465 2062 6f75 6e64 696e 6720 626f  eate bounding bo
-00021a60: 7820 6672 6f6d 206c 6566 742c 2077 6964  x from left, wid
-00021a70: 7468 2c20 746f 702c 2068 6569 6768 740a  th, top, height.
-00021a80: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00021a90: 204e 6f6e 6520 6966 2061 6e79 2061 7474   None if any att
-00021aa0: 7269 6275 7465 7320 6d69 7373 696e 670a  ributes missing.
-00021ab0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00021ac0: 2020 2020 6262 6f78 203d 204e 6f6e 650a      bbox = None.
-00021ad0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-00021ae0: 746f 7020 6973 206e 6f74 204e 6f6e 6520  top is not None 
-00021af0: 616e 6420 7365 6c66 2e68 6569 6768 7420  and self.height 
-00021b00: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
-00021b10: 7365 6c66 2e6c 6566 7420 6973 206e 6f74  self.left is not
-00021b20: 204e 6f6e 6520 616e 6420 7365 6c66 2e77   None and self.w
-00021b30: 6964 7468 2069 7320 6e6f 7420 4e6f 6e65  idth is not None
-00021b40: 3a0a 2020 2020 2020 2020 2020 2020 6262  :.            bb
-00021b50: 6f78 203d 2042 426f 7828 7879 5f72 616e  ox = BBox(xy_ran
-00021b60: 6765 733d 5b5b 7365 6c66 2e6c 6566 742c  ges=[[self.left,
-00021b70: 2073 656c 662e 6c65 6674 202b 2073 656c   self.left + sel
-00021b80: 662e 7769 6474 685d 2c20 5b73 656c 662e  f.width], [self.
-00021b90: 746f 702c 2073 656c 662e 746f 7020 2b20  top, self.top + 
-00021ba0: 7365 6c66 2e68 6569 6768 745d 5d29 0a20  self.height]]). 
-00021bb0: 2020 2020 2020 2072 6574 7572 6e20 6262         return bb
-00021bc0: 6f78 0a0a 2020 2020 2320 2020 2063 6c61  ox..    #    cla
-00021bd0: 7373 2043 5353 5374 796c 653a 0a0a 2020  ss CSSStyle:..  
-00021be0: 2020 6465 6620 6578 7472 6163 745f 7375    def extract_su
-00021bf0: 6273 7479 6c65 7328 7365 6c66 2c20 6373  bstyles(self, cs
-00021c00: 735f 6e61 6d65 7329 3a0a 2020 2020 2020  s_names):.      
-00021c10: 2020 2222 220a 2020 2020 2020 2020 4372    """.        Cr
-00021c20: 6561 7465 2032 206e 6577 2043 5353 5373  eate 2 new CSSSs
-00021c30: 7479 6c65 7320 2c20 7468 6520 6669 7273  tyles , the firs
-00021c40: 7420 7769 7468 206e 616d 6573 2069 6e20  t with names in 
-00021c50: 2273 7479 6c65 7322 2061 6e64 2074 6865  "styles" and the
-00021c60: 2073 6563 6f6e 6420 7468 6520 7265 7374   second the rest
-00021c70: 2e0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-00021c80: 204e 6f6e 652c 2072 6574 7275 6e73 204e   None, retruns N
-00021c90: 6f6e 652c 4e6f 6e65 0a20 2020 2020 2020  one,None.       
-00021ca0: 203a 7061 7261 6d20 6373 735f 6e61 6d65   :param css_name
-00021cb0: 733a 206c 6973 7420 6f66 2043 5353 206e  s: list of CSS n
-00021cc0: 616d 6573 2028 652e 672e 2022 666f 6e74  ames (e.g. "font
-00021cd0: 2d66 616d 696c 7922 292e 2049 6620 6e61  -family"). If na
-00021ce0: 206e 616d 6520 6e6f 7420 666f 756e 642c   name not found,
-00021cf0: 206e 6f20 6163 7469 6f6e 0a20 2020 2020   no action.     
-00021d00: 2020 203a 7265 7475 726e 2032 2d74 7570     :return 2-tup
-00021d10: 6c65 206f 6620 3129 2043 5353 5374 796c  le of 1) CSSStyl
-00021d20: 6520 6f62 6a65 6374 2077 6974 6820 6578  e object with ex
-00021d30: 7472 6163 7465 6420 6e61 6d65 7320 3229  tracted names 2)
-00021d40: 2043 5353 5374 796c 6520 6f66 2074 6865   CSSStyle of the
-00021d50: 2072 656d 6169 6e64 6572 3b0a 2020 2020   remainder;.    
-00021d60: 2020 2020 2020 2020 6569 7468 6572 2f62          either/b
-00021d70: 6f74 6820 6d61 7920 6265 2065 6d70 7479  oth may be empty
-00021d80: 2043 5353 5374 796c 652e 0a20 2020 2020   CSSStyle..     
-00021d90: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00021da0: 6620 6e6f 7420 7365 6c66 2e6e 616d 655f  f not self.name_
-00021db0: 7661 6c75 655f 6469 6374 3a0a 2020 2020  value_dict:.    
-00021dc0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00021dd0: 6c75 6545 7272 6f72 2866 226e 616d 655f  lueError(f"name_
-00021de0: 7661 6c75 655f 6469 6374 2069 7320 4e6f  value_dict is No
-00021df0: 6e65 2229 0a20 2020 2020 2020 2069 6620  ne").        if 
-00021e00: 6373 735f 6e61 6d65 7320 6973 204e 6f6e  css_names is Non
-00021e10: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00021e20: 6574 7572 6e20 4e6f 6e65 2c20 4e6f 6e65  eturn None, None
-00021e30: 0a20 2020 2020 2020 2063 7373 5f72 6574  .        css_ret
-00021e40: 6169 6e65 6420 3d20 636f 7079 2e64 6565  ained = copy.dee
-00021e50: 7063 6f70 7928 7365 6c66 290a 2020 2020  pcopy(self).    
-00021e60: 2020 2020 6373 735f 666f 756e 6420 3d20      css_found = 
-00021e70: 4353 5353 7479 6c65 2829 0a0a 2020 2020  CSSStyle()..    
-00021e80: 2020 2020 6b65 7973 203d 2063 7373 5f72      keys = css_r
-00021e90: 6574 6169 6e65 642e 6e61 6d65 5f76 616c  etained.name_val
-00021ea0: 7565 5f64 6963 742e 6b65 7973 2829 0a20  ue_dict.keys(). 
-00021eb0: 2020 2020 2020 2066 6f72 206e 616d 6520         for name 
-00021ec0: 696e 2063 7373 5f6e 616d 6573 3a0a 2020  in css_names:.  
-00021ed0: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
-00021ee0: 6520 696e 2063 7373 5f72 6574 6169 6e65  e in css_retaine
-00021ef0: 642e 6e61 6d65 5f76 616c 7565 5f64 6963  d.name_value_dic
-00021f00: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00021f10: 2020 2076 616c 7565 203d 2063 7373 5f72     value = css_r
-00021f20: 6574 6169 6e65 642e 6e61 6d65 5f76 616c  etained.name_val
-00021f30: 7565 5f64 6963 742e 706f 7028 6e61 6d65  ue_dict.pop(name
-00021f40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00021f50: 2020 6966 2076 616c 7565 3a20 2023 2074    if value:  # t
-00021f60: 7261 6e73 6665 7220 6974 656d 206f 7665  ransfer item ove
-00021f70: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-00021f80: 2020 2020 2020 6373 735f 666f 756e 642e        css_found.
-00021f90: 6e61 6d65 5f76 616c 7565 5f64 6963 745b  name_value_dict[
-00021fa0: 6e61 6d65 5d20 3d20 7661 6c75 650a 2020  name] = value.  
-00021fb0: 2020 2020 2020 7265 7475 726e 2028 6373        return (cs
-00021fc0: 735f 666f 756e 642c 2063 7373 5f72 6574  s_found, css_ret
-00021fd0: 6169 6e65 6429 0a0a 2020 2020 2320 2020  ained)..    #   
-00021fe0: 2063 6c61 7373 2043 5353 5374 796c 653a   class CSSStyle:
-00021ff0: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
-00022000: 5f68 746d 6c5f 7374 796c 655f 656c 656d  _html_style_elem
-00022010: 656e 7428 7365 6c66 2c20 6874 6d6c 5f63  ent(self, html_c
-00022020: 6c61 7373 293a 0a20 2020 2020 2020 2022  lass):.        "
-00022030: 2222 0a20 2020 2020 2020 2043 7265 6174  "".        Creat
-00022040: 6573 2073 7472 696e 6720 666f 7220 4854  es string for HT
-00022050: 4d4c 2073 7479 6c65 0a20 2020 2020 2020  ML style.       
-00022060: 2022 2222 0a20 2020 2020 2020 2044 4f54   """.        DOT
-00022070: 203d 2022 2e22 0a20 2020 2020 2020 2073   = ".".        s
-00022080: 203d 2044 4f54 202b 2068 746d 6c5f 636c   = DOT + html_cl
-00022090: 6173 7320 2b20 2220 2220 2b20 7365 6c66  ass + " " + self
-000220a0: 2e67 6574 5f63 7373 5f76 616c 7565 2877  .get_css_value(w
-000220b0: 7261 705f 7769 7468 5f63 7572 6c79 3d54  rap_with_curly=T
-000220c0: 7275 6529 0a20 2020 2020 2020 2065 6c65  rue).        ele
-000220d0: 6d20 3d20 4554 2e45 6c65 6d65 6e74 2843  m = ET.Element(C
-000220e0: 5353 5374 796c 652e 5354 594c 4529 0a20  SSStyle.STYLE). 
-000220f0: 2020 2020 2020 2065 6c65 6d2e 7465 7874         elem.text
-00022100: 203d 2073 0a20 2020 2020 2020 2072 6574   = s.        ret
-00022110: 7572 6e20 656c 656d 0a0a 2020 2020 2320  urn elem..    # 
-00022120: 2020 2063 6c61 7373 2043 5353 5374 796c     class CSSStyl
-00022130: 653a 0a0a 2020 2020 6465 6620 6578 7472  e:..    def extr
-00022140: 6163 745f 7465 7874 5f73 7479 6c65 7328  act_text_styles(
-00022150: 7365 6c66 293a 0a20 2020 2020 2020 2022  self):.        "
-00022160: 2222 0a20 2020 2020 2020 2065 7874 7261  "".        extra
-00022170: 6374 2074 6578 7420 636f 6d70 6f6e 656e  ct text componen
-00022180: 7473 2066 726f 6d20 7374 796c 6520 2866  ts from style (f
-00022190: 6f6e 742d 2a2c 2063 6f6c 6f72 2c20 6574  ont-*, color, et
-000221a0: 6329 2069 6e74 6f20 6e65 7720 7374 796c  c) into new styl
-000221b0: 652c 2072 6574 7572 6e69 6e67 2074 7570  e, returning tup
-000221c0: 6c65 206f 660a 2020 2020 2020 2020 6e65  le of.        ne
-000221d0: 7720 7374 796c 6520 616e 6420 7374 796c  w style and styl
-000221e0: 6520 6672 6f6d 2072 656d 6169 6e69 6e67  e from remaining
-000221f0: 2063 6f6d 706f 6e65 6e74 730a 2020 2020   components.    
-00022200: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00022210: 2865 7874 7261 6374 6564 5f73 7479 6c65  (extracted_style
-00022220: 2c20 7265 7461 696e 6564 2920 3d20 666f  , retained) = fo
-00022230: 6e74 5f73 7479 6c65 2c20 7265 7374 5f73  nt_style, rest_s
-00022240: 7479 6c65 203d 2073 656c 662e 6578 7472  tyle = self.extr
-00022250: 6163 745f 7375 6273 7479 6c65 7328 0a20  act_substyles(. 
-00022260: 2020 2020 2020 2020 2020 2043 5353 5374             CSSSt
-00022270: 796c 652e 5445 5854 5f53 5459 4c45 5f43  yle.TEXT_STYLE_C
-00022280: 4f4d 504f 4e45 4e54 530a 2020 2020 2020  OMPONENTS.      
-00022290: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-000222a0: 726e 2028 6578 7472 6163 7465 645f 7374  rn (extracted_st
-000222b0: 796c 652c 2072 6574 6169 6e65 6429 0a0a  yle, retained)..
-000222c0: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
-000222d0: 5353 5374 796c 653a 0a0a 2020 2020 6465  SSStyle:..    de
-000222e0: 6620 6578 7472 6163 745f 7465 7874 5f73  f extract_text_s
-000222f0: 7479 6c65 735f 696e 746f 5f63 6c61 7373  tyles_into_class
-00022300: 2873 656c 662c 2063 6c61 7373 5f6e 616d  (self, class_nam
-00022310: 652c 206f 6c64 5f63 6c61 7373 7374 723d  e, old_classstr=
-00022320: 2222 293a 0a20 2020 2020 2020 2022 2222  ""):.        """
-00022330: 0a20 2020 2020 2020 2065 7874 7261 6374  .        extract
-00022340: 7320 7465 7874 2063 6c61 7373 206e 616d  s text class nam
-00022350: 652d 7661 6c75 6520 696e 746f 206e 6577  e-value into new
-00022360: 2043 5353 5374 796c 652c 2061 6e64 2063   CSSStyle, and c
-00022370: 7265 6174 6573 2075 7064 6174 6564 2063  reates updated c
-00022380: 6c61 7373 5f73 7472 696e 670a 2020 2020  lass_string.    
-00022390: 2020 2020 4578 616d 706c 653a 0a20 2020      Example:.   
-000223a0: 2020 2020 2020 2020 2065 6c65 6d65 6e74           element
-000223b0: 2068 6173 2073 7479 6c65 2061 7474 7269   has style attri
-000223c0: 6275 7465 2077 6974 6820 7365 7665 7261  bute with severa
-000223d0: 6c20 7465 7874 2063 6f6d 706f 6e65 6e74  l text component
-000223e0: 7320 2865 2e67 2e20 666f 6e74 2d77 6569  s (e.g. font-wei
-000223f0: 6768 742c 2066 6f6e 742d 7369 7a65 290a  ght, font-size).
-00022400: 2020 2020 2020 2020 2020 2020 5468 6973              This
-00022410: 2063 7265 6174 6573 2061 206e 6577 203c   creates a new <
-00022420: 7374 796c 653e 2045 6c65 6d65 6e74 2028  style> Element (
-00022430: 6578 7472 6163 7465 6429 2077 6974 6820  extracted) with 
-00022440: 6a75 7374 2074 6865 7365 2063 6f6d 706f  just these compo
-00022450: 6e65 6e74 730a 2020 2020 2020 2020 2020  nents.          
-00022460: 2020 2020 2020 616e 6420 7075 7473 2074        and puts t
-00022470: 6865 2075 6e65 7874 7261 6374 6564 2073  he unextracted s
-00022480: 7479 6c65 2063 6f6d 706f 6e65 656e 7473  tyle componeents
-00022490: 2069 6e74 6f20 6e65 7720 7374 796c 6520   into new style 
-000224a0: 7370 6163 652d 7365 7061 7261 7465 6420  space-separated 
-000224b0: 7374 7269 6e67 2028 7265 6d61 696e 6e65  string (remainne
-000224c0: 6429 0a20 2020 2020 2020 2020 2020 2049  d).            I
-000224d0: 7420 7573 6573 2074 6865 2063 6c61 7373  t uses the class
-000224e0: 5f6e 616d 6520 746f 2075 7064 6174 6520  _name to update 
-000224f0: 7468 6520 6f6c 645f 636c 6173 7373 7472  the old_classstr
-00022500: 2073 7472 696e 670a 2020 2020 2020 2020   string.        
-00022510: 2020 2020 2020 2020 652e 672e 2063 6c61          e.g. cla
-00022520: 7373 5f6e 616d 653d 2273 3122 2061 6e64  ss_name="s1" and
-00022530: 206f 6c64 5f63 6c61 7373 7374 723d 2266   old_classstr="f
-00022540: 6f6f 2062 6172 2220 3d3e 2022 666f 6f20  oo bar" => "foo 
-00022550: 6261 7220 7331 220a 2020 2020 2020 2020  bar s1".        
-00022560: 3a70 6172 616d 2063 6c61 7373 5f6e 616d  :param class_nam
-00022570: 653a 206e 616d 6520 6f69 6620 6e65 7720  e: name oif new 
-00022580: 636c 6173 7320 2861 7574 686f 7220 6d75  class (author mu
-00022590: 7374 2065 6e73 7572 6520 756e 6971 7565  st ensure unique
-000225a0: 6e65 7373 290a 2020 2020 2020 2020 3a70  ness).        :p
-000225b0: 6172 616d 206f 6c64 5f63 6c61 7373 7374  aram old_classst
-000225c0: 723a 206f 6c64 2063 6c61 7373 6e61 6d65  r: old classname
-000225d0: 2028 6465 6661 756c 7473 2074 6f20 2222   (defaults to ""
-000225e0: 290a 2020 2020 2020 2020 3a72 6574 7572  ).        :retur
-000225f0: 6e3a 2033 2d74 7570 6c65 206f 6620 2865  n: 3-tuple of (e
-00022600: 7874 7261 6374 6564 5f73 7479 6c65 5f65  xtracted_style_e
-00022610: 6c65 6d65 6e74 2c20 7265 7461 696e 6564  lement, retained
-00022620: 5f73 7479 6c65 5f73 7472 696e 672c 206e  _style_string, n
-00022630: 6577 2063 6c61 7373 735f 7374 7269 6e67  ew classs_string
-00022640: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
-00022650: 2020 2020 2020 6578 7472 6163 7465 645f        extracted_
-00022660: 7374 796c 652c 2072 6574 6169 6e65 645f  style, retained_
-00022670: 7374 796c 6520 3d20 7365 6c66 2e65 7874  style = self.ext
-00022680: 7261 6374 5f74 6578 745f 7374 796c 6573  ract_text_styles
-00022690: 2829 0a0a 2020 2020 2020 2020 6966 206e  ()..        if n
-000226a0: 6f74 2065 7874 7261 6374 6564 5f73 7479  ot extracted_sty
-000226b0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
-000226c0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000226d0: 2822 6578 7472 6163 7465 6420 7374 796c  ("extracted styl
-000226e0: 6520 6973 204e 6f6e 6522 290a 2020 2020  e is None").    
-000226f0: 2020 2020 6578 7472 6163 7465 645f 7374      extracted_st
-00022700: 796c 6531 203d 2043 5353 5374 796c 652e  yle1 = CSSStyle.
-00022710: 6578 7472 6163 745f 626f 6c64 5f69 7461  extract_bold_ita
-00022720: 6c69 635f 6672 6f6d 5f66 6f6e 745f 6661  lic_from_font_fa
-00022730: 6d69 6c79 5f66 6f72 5f73 7479 6c65 2865  mily_for_style(e
-00022740: 7874 7261 6374 6564 5f73 7479 6c65 2920  xtracted_style) 
-00022750: 6966 2065 7874 7261 6374 6564 5f73 7479  if extracted_sty
-00022760: 6c65 2065 6c73 6520 4e6f 6e65 0a20 2020  le else None.   
-00022770: 2020 2020 2065 7874 7261 6374 6564 5f68       extracted_h
-00022780: 746d 6c5f 7374 796c 655f 656c 656d 656e  tml_style_elemen
-00022790: 7420 3d20 6578 7472 6163 7465 645f 7374  t = extracted_st
-000227a0: 796c 6531 2e63 7265 6174 655f 6874 6d6c  yle1.create_html
-000227b0: 5f73 7479 6c65 5f65 6c65 6d65 6e74 2863  _style_element(c
-000227c0: 6c61 7373 5f6e 616d 6529 2069 6620 6578  lass_name) if ex
-000227d0: 7472 6163 7465 645f 7374 796c 6531 2069  tracted_style1 i
-000227e0: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
-000227f0: 4e6f 6e65 0a0a 2020 2020 2020 2020 7265  None..        re
-00022800: 7461 696e 6564 5f73 7479 6c65 5f61 7474  tained_style_att
-00022810: 7661 6c20 3d20 7265 7461 696e 6564 5f73  val = retained_s
-00022820: 7479 6c65 2e67 6574 5f63 7373 5f76 616c  tyle.get_css_val
-00022830: 7565 2829 2069 6620 7265 7461 696e 6564  ue() if retained
-00022840: 5f73 7479 6c65 2065 6c73 6520 4e6f 6e65  _style else None
-00022850: 0a20 2020 2020 2020 2068 746d 6c5f 636c  .        html_cl
-00022860: 6173 735f 7661 6c20 3d20 4353 5353 7479  ass_val = CSSSty
-00022870: 6c65 2e63 7265 6174 655f 6874 6d6c 5f63  le.create_html_c
-00022880: 6c61 7373 5f76 616c 2863 6c61 7373 5f6e  lass_val(class_n
-00022890: 616d 652c 206f 6c64 5f63 6c61 7373 5f76  ame, old_class_v
-000228a0: 616c 3d6f 6c64 5f63 6c61 7373 7374 7229  al=old_classstr)
-000228b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000228c0: 6578 7472 6163 7465 645f 6874 6d6c 5f73  extracted_html_s
-000228d0: 7479 6c65 5f65 6c65 6d65 6e74 2c20 7265  tyle_element, re
-000228e0: 7461 696e 6564 5f73 7479 6c65 5f61 7474  tained_style_att
-000228f0: 7661 6c2c 2068 746d 6c5f 636c 6173 735f  val, html_class_
-00022900: 7661 6c0a 0a20 2020 2023 2020 2020 636c  val..    #    cl
-00022910: 6173 7320 4353 5353 7479 6c65 3a0a 0a20  ass CSSStyle:.. 
-00022920: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00022930: 2020 2020 6465 6620 6372 6561 7465 5f68      def create_h
-00022940: 746d 6c5f 636c 6173 735f 7661 6c28 636c  tml_class_val(cl
-00022950: 732c 206e 6577 5f63 6c61 7373 2c20 6f6c  s, new_class, ol
-00022960: 645f 636c 6173 735f 7661 6c3d 4e6f 6e65  d_class_val=None
-00022970: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-00022980: 2020 2020 2020 2063 7265 6174 6573 206f         creates o
-00022990: 7220 6564 6974 7320 6120 636c 6173 7320  r edits a class 
-000229a0: 7374 7269 6e67 2074 6f20 6163 6365 7074  string to accept
-000229b0: 2061 206e 6577 2076 616c 7565 0a20 2020   a new value.   
-000229c0: 2020 2020 206e 6f2d 6f70 2069 6620 6e65       no-op if ne
-000229d0: 775f 636c 6173 7320 6973 2061 6c72 6561  w_class is alrea
-000229e0: 6479 2069 6e20 6f6c 645f 636c 6173 735f  dy in old_class_
-000229f0: 7661 6c0a 2020 2020 2020 2020 652e 672e  val.        e.g.
-00022a00: 204e 6f6e 6520 2b20 2266 6f6f 2220 3d3e   None + "foo" =>
-00022a10: 2022 666f 6f22 0a20 2020 2020 2020 2022   "foo".        "
-00022a20: 666f 6f22 202b 2022 6261 7220 706c 7567  foo" + "bar plug
-00022a30: 6822 203d 3e20 2262 6172 2070 6c75 6768  h" => "bar plugh
-00022a40: 2066 6f6f 220a 2020 2020 2020 2020 2266   foo".        "f
-00022a50: 6f6f 2220 2b20 2262 6172 2066 6f6f 2070  oo" + "bar foo p
-00022a60: 6c75 6768 2220 3d3e 2022 6261 7220 666f  lugh" => "bar fo
-00022a70: 6f20 706c 7567 6822 0a20 2020 2020 2020  o plugh".       
-00022a80: 203a 7061 7261 6d20 6e65 775f 636c 6173   :param new_clas
-00022a90: 733a 2063 6c61 7373 2074 6f20 6164 640a  s: class to add.
-00022aa0: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-00022ab0: 6c64 5f63 6c61 7373 5f76 616c 3a20 7370  ld_class_val: sp
-00022ac0: 6163 652d 7365 7061 7261 7465 6420 6c69  ace-separated li
-00022ad0: 7374 206f 6620 6578 6973 7469 6e67 2063  st of existing c
-00022ae0: 6c61 7373 6573 0a20 2020 2020 2020 203a  lasses.        :
-00022af0: 7265 7475 726e 3a20 6e65 7720 636c 6173  return: new clas
-00022b00: 7320 7374 7269 6e67 0a20 2020 2020 2020  s string.       
-00022b10: 2022 2222 0a20 2020 2020 2020 206f 6c64   """.        old
-00022b20: 5f63 6c61 7373 6573 203d 205b 5d20 6966  _classes = [] if
-00022b30: 206e 6f74 206f 6c64 5f63 6c61 7373 5f76   not old_class_v
-00022b40: 616c 2065 6c73 6520 6f6c 645f 636c 6173  al else old_clas
-00022b50: 735f 7661 6c2e 7370 6c69 7428 290a 2020  s_val.split().  
-00022b60: 2020 2020 2020 6966 206e 6577 5f63 6c61        if new_cla
-00022b70: 7373 206e 6f74 2069 6e20 6f6c 645f 636c  ss not in old_cl
-00022b80: 6173 7365 733a 0a20 2020 2020 2020 2020  asses:.         
-00022b90: 2020 206f 6c64 5f63 6c61 7373 6573 2e61     old_classes.a
-00022ba0: 7070 656e 6428 6e65 775f 636c 6173 7329  ppend(new_class)
-00022bb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00022bc0: 5574 696c 2e63 7265 6174 655f 7374 7269  Util.create_stri
-00022bd0: 6e67 5f73 6570 6172 6174 6564 5f6c 6973  ng_separated_lis
-00022be0: 7428 6f6c 645f 636c 6173 7365 7329 0a0a  t(old_classes)..
-00022bf0: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
-00022c00: 5353 5374 796c 653a 0a0a 2020 2020 4063  SSStyle:..    @c
-00022c10: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00022c20: 6566 2063 7265 6174 655f 7374 796c 655f  ef create_style_
-00022c30: 6469 6374 5f66 726f 6d5f 7374 796c 6573  dict_from_styles
-00022c40: 2863 6c73 2c20 7374 796c 655f 656c 656d  (cls, style_elem
-00022c50: 733d 4e6f 6e65 2c20 7661 6c69 6461 7465  s=None, validate
-00022c60: 3d54 7275 6529 3a0a 2020 2020 2020 2020  =True):.        
-00022c70: 2222 220a 2020 2020 2020 2020 636f 6e76  """.        conv
-00022c80: 6572 7420 6c69 7374 206f 6620 4353 5353  ert list of CSSS
-00022c90: 7479 6c65 7320 2861 7320 4854 4d4c 2073  tyles (as HTML s
-00022ca0: 7472 696e 6773 2920 746f 2064 6963 740a  trings) to dict.
-00022cb0: 2020 2020 2020 2020 6966 2064 7570 6c69          if dupli
-00022cc0: 6361 7465 2073 7479 6c65 7265 6673 2072  cate stylerefs r
-00022cd0: 6169 7365 2045 7863 6570 7469 6f6e 2069  aise Exception i
-00022ce0: 6620 7661 6c69 6461 7465 2065 6c73 6520  f validate else 
-00022cf0: 7461 6b65 2066 6972 7374 0a20 2020 2020  take first.     
-00022d00: 2020 2054 7970 6963 616c 2073 7479 6c65     Typical style
-00022d10: 3a0a 2020 2020 2020 2020 3c73 7479 6c65  :.        <style
-00022d20: 202e 2e2e 3e2e 7330 207b 666f 6e74 2d73   ...>.s0 {font-s
-00022d30: 697a 653a 2031 342e 7078 3b7d 3c2f 7374  ize: 14.px;}</st
-00022d40: 796c 653e 0a20 2020 2020 2020 203a 7061  yle>.        :pa
-00022d50: 7261 6d20 7374 796c 655f 656c 656d 733a  ram style_elems:
-00022d60: 206c 6973 7420 6f66 206c 786d 6c20 5f45   list of lxml _E
-00022d70: 6c65 6d65 6e74 730a 2020 2020 2020 2020  lements.        
-00022d80: 3a70 6172 616d 2076 616c 6964 6174 653a  :param validate:
-00022d90: 2063 6865 636b 2077 6865 7468 6572 2043   check whether C
-00022da0: 5353 2076 616c 7565 2069 7320 636f 6e66  SS value is conf
-00022db0: 6f72 6d61 6e74 206f 7220 6475 706c 6963  ormant or duplic
-00022dc0: 6174 6520 7374 796c 655f 7265 6673 0a20  ate style_refs. 
-00022dd0: 2020 2020 2020 203a 7265 7475 726e 3a20         :return: 
-00022de0: 6469 6374 206f 6620 666f 726d 2072 6566  dict of form ref
-00022df0: 3a20 7374 796c 650a 2020 2020 2020 2020  : style.        
-00022e00: 3a65 7863 6570 743a 2049 6620 656c 656d  :except: If elem
-00022e10: 656e 7420 6861 7320 7772 6f6e 6720 7379  ent has wrong sy
-00022e20: 6e74 6178 3b20 6966 2063 7373 2066 6965  ntax; if css fie
-00022e30: 726c 6420 6973 206d 616c 666f 746d 6564  rld is malfotmed
-00022e40: 3b20 6966 2072 6566 2069 7320 6475 706c  ; if ref is dupl
-00022e50: 6963 6174 6564 0a20 2020 2020 2020 2022  icated.        "
-00022e60: 2222 0a20 2020 2020 2020 2063 7373 5f72  "".        css_r
-00022e70: 6520 3d20 7265 2e63 6f6d 7069 6c65 2822  e = re.compile("
-00022e80: 5c5c 732a 285c 5c2e 2e2a 295c 5c73 2b7b  \\s*(\\..*)\\s+{
-00022e90: 282e 2a29 7d5c 5c73 2a22 290a 2020 2020  (.*)}\\s*").    
-00022ea0: 2020 2020 6966 2073 7479 6c65 5f65 6c65      if style_ele
-00022eb0: 6d73 2069 7320 4e6f 6e65 3a0a 2020 2020  ms is None:.    
-00022ec0: 2020 2020 2020 2020 7374 796c 6573 203d          styles =
-00022ed0: 205b 5d0a 2020 2020 2020 2020 7374 796c   [].        styl
-00022ee0: 655f 6469 6374 203d 2064 6963 7428 290a  e_dict = dict().
-00022ef0: 2020 2020 2020 2020 666f 7220 7374 796c          for styl
-00022f00: 655f 656c 656d 2069 6e20 7374 796c 655f  e_elem in style_
-00022f10: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
-00022f20: 2020 2073 7479 6c65 5f74 6578 7420 3d20     style_text = 
-00022f30: 7374 796c 655f 656c 656d 2e74 6578 742e  style_elem.text.
-00022f40: 7374 7269 7028 290a 2020 2020 2020 2020  strip().        
-00022f50: 2020 2020 6d61 7463 6820 3d20 6373 735f      match = css_
-00022f60: 7265 2e6d 6174 6368 2873 7479 6c65 5f74  re.match(style_t
-00022f70: 6578 7429 0a20 2020 2020 2020 2020 2020  ext).           
-00022f80: 2069 6620 6e6f 7420 6d61 7463 683a 0a20   if not match:. 
-00022f90: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00022fa0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00022fb0: 6622 4241 4420 6865 6164 5f73 7479 6c65  f"BAD head_style
-00022fc0: 207b 7374 796c 655f 7465 7874 7d22 290a   {style_text}").
-00022fd0: 2020 2020 2020 2020 2020 2020 7265 6620              ref 
-00022fe0: 3d20 6d61 7463 682e 6772 6f75 7028 3129  = match.group(1)
-00022ff0: 0a20 2020 2020 2020 2020 2020 2063 7373  .            css
-00023000: 5f73 7472 696e 6720 3d20 6d61 7463 682e  _string = match.
-00023010: 6772 6f75 7028 3229 0a20 2020 2020 2020  group(2).       
-00023020: 2020 2020 2069 6620 6373 735f 7374 7269       if css_stri
-00023030: 6e67 203d 3d20 2222 3a0a 2020 2020 2020  ng == "":.      
-00023040: 2020 2020 2020 2020 2020 2320 7468 6973            # this
-00023050: 206f 6363 7572 7320 7768 656e 2074 6865   occurs when the
-00023060: 2073 7479 6c65 2061 7474 7269 6275 7465   style attribute
-00023070: 7320 6172 6520 706f 7369 7469 6f6e 616c  s are positional
-00023080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00023090: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-000230a0: 2020 2020 2020 6966 2076 616c 6964 6174        if validat
-000230b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000230c0: 2020 2063 7373 5f73 7479 6c65 203d 2043     css_style = C
-000230d0: 5353 5374 796c 652e 6372 6561 7465 5f63  SSStyle.create_c
-000230e0: 7373 5f73 7479 6c65 5f66 726f 6d5f 6373  ss_style_from_cs
-000230f0: 735f 7374 7269 6e67 2863 7373 5f73 7472  s_string(css_str
-00023100: 696e 6729 0a20 2020 2020 2020 2020 2020  ing).           
-00023110: 2020 2020 2069 6620 6373 735f 7374 796c       if css_styl
-00023120: 6520 6973 204e 6f6e 653a 0a20 2020 2020  e is None:.     
-00023130: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00023140: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00023150: 6622 6261 6420 4353 5353 7479 6c65 207b  f"bad CSSStyle {
-00023160: 6373 735f 7374 796c 657d 2229 0a20 2020  css_style}").   
-00023170: 2020 2020 2020 2020 2069 6620 7265 6620           if ref 
-00023180: 696e 2073 7479 6c65 5f64 6963 743a 0a20  in style_dict:. 
-00023190: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000231a0: 6620 7661 6c69 6461 7465 3a0a 2020 2020  f validate:.    
-000231b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000231c0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-000231d0: 2866 2264 7570 6c69 6361 7465 2073 7479  (f"duplicate sty
-000231e0: 6c65 2072 6566 207b 7374 796c 655f 7465  le ref {style_te
-000231f0: 7874 7d22 290a 2020 2020 2020 2020 2020  xt}").          
-00023200: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00023210: 2020 2020 2020 2020 7374 796c 655f 6469          style_di
-00023220: 6374 5b72 6566 5d20 3d20 6373 735f 7374  ct[ref] = css_st
-00023230: 7269 6e67 0a20 2020 2020 2020 2072 6574  ring.        ret
-00023240: 7572 6e20 7374 796c 655f 6469 6374 0a0a  urn style_dict..
-00023250: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
-00023260: 5353 5374 796c 653a 0a0a 2020 2020 4063  SSStyle:..    @c
-00023270: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00023280: 6566 2065 7874 7261 6374 5f73 7479 6c65  ef extract_style
-00023290: 735f 6672 6f6d 5f68 746d 6c5f 7374 7269  s_from_html_stri
-000232a0: 6e67 2863 6c73 2c20 6874 6d6c 5f73 7472  ng(cls, html_str
-000232b0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
-000232c0: 2020 2020 2020 2065 7874 7261 6374 2073         extract s
-000232d0: 7479 6c65 7320 6672 6f6d 2068 6561 6420  tyles from head 
-000232e0: 6f66 2068 746d 6c20 6669 6c65 0a20 2020  of html file.   
-000232f0: 2020 2020 203a 7061 7261 6d20 6874 6d6c       :param html
-00023300: 5f73 7472 3a20 7374 7269 6e67 206f 6620  _str: string of 
-00023310: 666f 726d 203c 6874 6d6c 3e3c 6865 6164  form <html><head
-00023320: 3e3c 7374 796c 6520 2e2e 2e3e 3c2f 7374  ><style ...></st
-00023330: 796c 653e 3c73 7479 6c65 202e 2e2e 3e3c  yle><style ...><
-00023340: 2f73 7479 6c65 3e3c 2f68 6561 643e 202e  /style></head> .
-00023350: 2e2e 203c 2f68 746d 6c3e 0a20 2020 2020  .. </html>.     
-00023360: 2020 203a 7265 7475 726e 3a20 6c69 7374     :return: list
-00023370: 206f 6620 5f45 6c65 6d65 6e74 7320 283c   of _Elements (<
-00023380: 7374 796c 652e 2e2e 3e20 2e2e 2e3c 2f73  style...> ...</s
-00023390: 7479 6c65 3e29 206f 7220 5b5d 0a20 2020  tyle>) or [].   
-000233a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000233b0: 2072 6574 7572 6e20 636c 732e 6578 7472   return cls.extr
-000233c0: 6163 745f 7374 796c 6573 5f66 726f 6d5f  act_styles_from_
-000233d0: 6874 6d6c 5f68 6561 645f 656c 656d 656e  html_head_elemen
-000233e0: 7428 4554 2e66 726f 6d73 7472 696e 6728  t(ET.fromstring(
-000233f0: 6874 6d6c 5f73 7472 2929 0a0a 2020 2020  html_str))..    
-00023400: 2320 2020 2063 6c61 7373 2043 5353 5374  #    class CSSSt
-00023410: 796c 653a 0a0a 2020 2020 4063 6c61 7373  yle:..    @class
-00023420: 6d65 7468 6f64 0a20 2020 2064 6566 2065  method.    def e
-00023430: 7874 7261 6374 5f73 7479 6c65 735f 6672  xtract_styles_fr
-00023440: 6f6d 5f68 746d 6c5f 6865 6164 5f65 6c65  om_html_head_ele
-00023450: 6d65 6e74 2863 6c73 2c20 6874 6d6c 5f65  ment(cls, html_e
-00023460: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
-00023470: 220a 2020 2020 2020 2020 6578 7472 6163  ".        extrac
-00023480: 7420 7374 796c 6573 2066 726f 6d20 6865  t styles from he
-00023490: 6164 206f 6620 6874 6d6c 2066 696c 650a  ad of html file.
-000234a0: 2020 2020 2020 2020 3a70 6172 616d 2068          :param h
-000234b0: 746d 6c5f 656c 656d 3a20 656c 656d 656e  tml_elem: elemen
-000234c0: 7420 6f66 2066 6f72 6d20 3c68 746d 6c3e  t of form <html>
-000234d0: 3c68 6561 643e 3c73 7479 6c65 202e 2e2e  <head><style ...
-000234e0: 3e3c 2f73 7479 6c65 3e3c 7374 796c 6520  ></style><style 
-000234f0: 2e2e 2e3e 3c2f 7374 796c 653e 3c2f 6865  ...></style></he
-00023500: 6164 3e20 2e2e 2e20 3c2f 6874 6d6c 3e0a  ad> ... </html>.
-00023510: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00023520: 206c 6973 7420 6f66 205f 456c 656d 656e   list of _Elemen
-00023530: 7473 2028 3c73 7479 6c65 2e2e 2e3e 202e  ts (<style...> .
-00023540: 2e2e 3c2f 7374 796c 653e 2920 6f72 205b  ..</style>) or [
-00023550: 5d0a 2020 2020 2020 2020 2222 220a 2020  ].        """.  
-00023560: 2020 2020 2020 7265 7475 726e 205b 5d20        return [] 
-00023570: 6966 2068 746d 6c5f 656c 656d 2069 7320  if html_elem is 
-00023580: 4e6f 6e65 2065 6c73 6520 6874 6d6c 5f65  None else html_e
-00023590: 6c65 6d2e 7870 6174 6828 5354 594c 455f  lem.xpath(STYLE_
-000235a0: 5850 4154 4829 0a0a 2020 2020 4063 6c61  XPATH)..    @cla
-000235b0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-000235c0: 2063 7265 6174 655f 6373 735f 7374 796c   create_css_styl
-000235d0: 655f 6672 6f6d 5f68 746d 6c5f 6865 6164  e_from_html_head
-000235e0: 5f73 7479 6c65 5f65 6c65 6d28 636c 732c  _style_elem(cls,
-000235f0: 2073 7479 6c65 5f65 6c65 6d29 3a0a 2020   style_elem):.  
-00023600: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00023610: 2020 6578 7472 6163 7473 2043 5353 5374    extracts CSSSt
-00023620: 796c 6520 656c 656d 6e74 2066 726f 6d20  yle elemnt from 
-00023630: 4854 4d4c 203c 7374 796c 653e 2e66 6f6f  HTML <style>.foo
-00023640: 207b 613a 623b 2063 3a64 3b7d 2065 6c65   {a:b; c:d;} ele
-00023650: 6d65 6e74 0a20 2020 2020 2020 203a 7061  ment.        :pa
-00023660: 7261 6d20 7374 796c 655f 656c 656d 3a0a  ram style_elem:.
-00023670: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00023680: 2074 7570 6c65 2873 796d 626f 6c20 7265   tuple(symbol re
-00023690: 662c 206e 6577 2043 5353 5374 796c 6529  f, new CSSStyle)
-000236a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000236b0: 2020 2020 2073 7479 6c65 5f72 6520 3d20       style_re = 
-000236c0: 7265 2e63 6f6d 7069 6c65 2822 5c5c 732a  re.compile("\\s*
-000236d0: 285b 5e5c 5c73 5d2a 295c 5c73 2b7b 282e  ([^\\s]*)\\s+{(.
-000236e0: 2a29 7d5c 5c73 2a22 290a 2020 2020 2020  *)}\\s*").      
-000236f0: 2020 7379 6d62 6f6c 5f72 6566 203d 204e    symbol_ref = N
-00023700: 6f6e 650a 2020 2020 2020 2020 6373 735f  one.        css_
-00023710: 7374 796c 655f 6f62 6a20 3d20 4e6f 6e65  style_obj = None
-00023720: 0a20 2020 2020 2020 2069 6620 7479 7065  .        if type
-00023730: 2873 7479 6c65 5f65 6c65 6d29 2069 7320  (style_elem) is 
-00023740: 5f45 6c65 6d65 6e74 3a0a 2020 2020 2020  _Element:.      
-00023750: 2020 2020 2020 7465 7874 203d 2058 6d6c        text = Xml
-00023760: 4c69 622e 6765 745f 7465 7874 2873 7479  Lib.get_text(sty
-00023770: 6c65 5f65 6c65 6d29 0a20 2020 2020 2020  le_elem).       
-00023780: 2020 2020 206d 6174 6368 203d 2073 7479       match = sty
-00023790: 6c65 5f72 652e 6d61 7463 6828 7465 7874  le_re.match(text
-000237a0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000237b0: 206d 6174 6368 3a0a 2020 2020 2020 2020   match:.        
-000237c0: 2020 2020 2020 2020 7379 6d62 6f6c 5f72          symbol_r
-000237d0: 6566 203d 206d 6174 6368 2e67 726f 7570  ef = match.group
-000237e0: 2831 290a 2020 2020 2020 2020 2020 2020  (1).            
-000237f0: 2020 2020 6373 735f 7374 796c 655f 6f62      css_style_ob
-00023800: 6a20 3d20 4353 5353 7479 6c65 2e63 7265  j = CSSStyle.cre
-00023810: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
-00023820: 6f6d 5f63 7373 5f73 7472 696e 6728 6d61  om_css_string(ma
-00023830: 7463 682e 6772 6f75 7028 3229 290a 2020  tch.group(2)).  
-00023840: 2020 2020 2020 7265 7475 726e 2073 796d        return sym
-00023850: 626f 6c5f 7265 662c 2063 7373 5f73 7479  bol_ref, css_sty
-00023860: 6c65 5f6f 626a 0a0a 2020 2020 4063 6c61  le_obj..    @cla
-00023870: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00023880: 2072 6570 6c61 6365 5f63 7373 5f73 7479   replace_css_sty
-00023890: 6c65 5f6e 616d 655f 7661 6c75 6573 5f77  le_name_values_w
-000238a0: 6974 685f 6e6f 726d 616c 697a 6564 5f66  ith_normalized_f
-000238b0: 6f6e 7428 636c 732c 2073 7479 6c65 5f65  ont(cls, style_e
-000238c0: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
-000238d0: 220a 2020 2020 2020 2020 6966 2073 7479  ".        if sty
-000238e0: 6c65 5f65 6c65 6d20 636f 6e74 6169 6e73  le_elem contains
-000238f0: 2061 2066 6f6e 7420 696e 2074 6865 2043   a font in the C
-00023900: 5353 2076 616c 7565 732c 206e 6f72 6d61  SS values, norma
-00023910: 6c69 7a65 7320 6974 2069 6620 706f 7373  lizes it if poss
-00023920: 6962 6c65 0a20 2020 2020 2020 2028 652e  ible.        (e.
-00023930: 672e 2066 6f6e 742d 6661 6d69 6c79 3a20  g. font-family: 
-00023940: 4172 6961 6c42 6f6c 643b 203d 3e20 666f  ArialBold; => fo
-00023950: 6e74 2d66 616d 696c 793a 4172 6961 6c3b  nt-family:Arial;
-00023960: 2066 6f6e 742d 7765 6967 6874 3a20 626f   font-weight: bo
-00023970: 6c64 3b0a 2020 2020 2020 2020 6564 6974  ld;.        edit
-00023980: 7320 7468 6520 7374 796c 655f 656c 656d  s the style_elem
-00023990: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000239a0: 7374 796c 655f 656c 656d 3a20 656c 656d  style_elem: elem
-000239b0: 656e 7420 746f 2062 6520 6564 6974 6564  ent to be edited
-000239c0: 2028 4e4f 5420 636f 7069 6564 290a 2020   (NOT copied).  
-000239d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000239e0: 2020 7379 6d62 6f6c 5f72 6566 2c20 6e65    symbol_ref, ne
-000239f0: 775f 6373 7373 7479 6c65 203d 2041 6d69  w_cssstyle = Ami
-00023a00: 466f 6e74 2e63 7265 6174 655f 666f 6e74  Font.create_font
-00023a10: 5f65 6469 7465 645f 7374 796c 655f 6672  _edited_style_fr
-00023a20: 6f6d 5f63 7373 5f73 7479 6c65 5f6f 626a  om_css_style_obj
-00023a30: 6563 7428 7374 796c 655f 656c 656d 290a  ect(style_elem).
-00023a40: 2020 2020 2020 2020 6966 206e 6577 5f63          if new_c
-00023a50: 7373 7374 796c 6520 6973 206e 6f74 204e  ssstyle is not N
-00023a60: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00023a70: 2073 7479 6c65 5f65 6c65 6d2e 7465 7874   style_elem.text
-00023a80: 203d 2066 227b 7379 6d62 6f6c 5f72 6566   = f"{symbol_ref
-00023a90: 7d20 7b7b 7b6e 6577 5f63 7373 7374 796c  } {{{new_cssstyl
-00023aa0: 657d 7d7d 220a 0a20 2020 2040 636c 6173  e}}}"..    @clas
-00023ab0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00023ac0: 6e6f 726d 616c 697a 655f 7374 796c 6573  normalize_styles
-00023ad0: 5f69 6e5f 666f 6e74 735f 696e 5f68 746d  _in_fonts_in_htm
-00023ae0: 6c5f 6865 6164 2863 6c73 2c20 6874 6d6c  l_head(cls, html
-00023af0: 5f65 6c65 6d29 3a0a 2020 2020 2020 2020  _elem):.        
-00023b00: 2222 220a 2020 2020 2020 2020 6e6f 726d  """.        norm
-00023b10: 616c 697a 6573 2061 6c6c 2066 6f6e 7473  alizes all fonts
-00023b20: 2074 6f20 6578 706f 7365 2066 6f6e 7420   to expose font 
-00023b30: 7765 6967 6874 7320 616e 6420 7374 796c  weights and styl
-00023b40: 6573 0a20 2020 2020 2020 203a 7061 7261  es.        :para
-00023b50: 6d20 6874 6d6c 5f65 6c65 6d3a 2048 544d  m html_elem: HTM
-00023b60: 4c20 2872 6f6f 7429 2065 6c65 6d65 6e74  L (root) element
-00023b70: 2028 6874 6d6c 2f68 6561 642f 7374 796c   (html/head/styl
-00023b80: 652a 290a 2020 2020 2020 2020 2222 220a  e*).        """.
-00023b90: 2020 2020 2020 2020 7374 796c 655f 656c          style_el
-00023ba0: 656d 7320 3d20 4353 5353 7479 6c65 2e65  ems = CSSStyle.e
-00023bb0: 7874 7261 6374 5f73 7479 6c65 735f 6672  xtract_styles_fr
-00023bc0: 6f6d 5f68 746d 6c5f 6865 6164 5f65 6c65  om_html_head_ele
-00023bd0: 6d65 6e74 2868 746d 6c5f 656c 656d 290a  ment(html_elem).
-00023be0: 2020 2020 2020 2020 666f 7220 7374 796c          for styl
-00023bf0: 655f 656c 656d 2069 6e20 7374 796c 655f  e_elem in style_
-00023c00: 656c 656d 733a 0a20 2020 2020 2020 2020  elems:.         
-00023c10: 2020 2043 5353 5374 796c 652e 7265 706c     CSSStyle.repl
-00023c20: 6163 655f 6373 735f 7374 796c 655f 6e61  ace_css_style_na
-00023c30: 6d65 5f76 616c 7565 735f 7769 7468 5f6e  me_values_with_n
-00023c40: 6f72 6d61 6c69 7a65 645f 666f 6e74 2873  ormalized_font(s
-00023c50: 7479 6c65 5f65 6c65 6d29 0a0a 2020 2020  tyle_elem)..    
-00023c60: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-00023c70: 6620 7368 6f72 745f 7374 796c 6528 7365  f short_style(se
-00023c80: 6c66 293a 0a20 2020 2020 2020 2073 686f  lf):.        sho
-00023c90: 7274 5f73 7479 6c65 203d 2073 656c 662e  rt_style = self.
-00023ca0: 666f 6e74 5f66 616d 696c 792e 6c6f 7765  font_family.lowe
-00023cb0: 7228 295b 3a33 5d0a 2020 2020 2020 2020  r()[:3].        
-00023cc0: 7368 6f72 745f 7374 796c 6520 2b3d 2073  short_style += s
-00023cd0: 7472 2873 656c 662e 666f 6e74 5f73 697a  tr(self.font_siz
-00023ce0: 6529 2e72 6570 6c61 6365 2822 2e22 2c20  e).replace(".", 
-00023cf0: 225f 2229 0a20 2020 2020 2020 2069 6620  "_").        if 
-00023d00: 7365 6c66 2e69 735f 626f 6c64 3a0a 2020  self.is_bold:.  
-00023d10: 2020 2020 2020 2020 2020 7368 6f72 745f            short_
-00023d20: 7374 796c 6520 2b3d 2022 6222 0a20 2020  style += "b".   
-00023d30: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
-00023d40: 6974 616c 6963 3a0a 2020 2020 2020 2020  italic:.        
-00023d50: 2020 2020 7368 6f72 745f 7374 796c 6520      short_style 
-00023d60: 2b3d 2022 6922 0a20 2020 2020 2020 2072  += "i".        r
-00023d70: 6574 7572 6e20 7368 6f72 745f 7374 796c  eturn short_styl
-00023d80: 650a 0a20 2020 2064 6566 2067 6574 5f66  e..    def get_f
-00023d90: 6f6e 745f 6174 7472 6962 7574 6573 2873  ont_attributes(s
-00023da0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-00023db0: 220a 2020 2020 2020 2020 7365 7473 2034  ".        sets 4
-00023dc0: 2066 6f6e 7420 6174 7472 6962 7574 6573   font attributes
-00023dd0: 2028 7769 6474 682c 2073 697a 652c 206e   (width, size, n
-00023de0: 6f6e 7374 726f 6b65 2c20 7374 726f 6b65  onstroke, stroke
-00023df0: 2c20 666f 6e74 6e61 6d65 0a20 2020 2020  , fontname.     
-00023e00: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00023e10: 6966 2073 656c 662e 6e61 6d65 5f76 616c  if self.name_val
-00023e20: 7565 5f64 6963 7420 6973 204e 6f6e 653a  ue_dict is None:
-00023e30: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00023e40: 7572 6e20 284e 6f6e 652c 204e 6f6e 652c  urn (None, None,
-00023e50: 204e 6f6e 652c 204e 6f6e 652c 204e 6f6e   None, None, Non
-00023e60: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-00023e70: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
-00023e80: 2320 7365 6c66 2e6e 616d 655f 7661 6c75  # self.name_valu
-00023e90: 655f 6469 6374 2e67 6574 2843 5353 5374  e_dict.get(CSSSt
-00023ea0: 796c 652e 5749 4454 4829 2c0a 2020 2020  yle.WIDTH),.    
-00023eb0: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
-00023ec0: 5f61 7474 7269 6275 7465 2843 5353 5374  _attribute(CSSSt
-00023ed0: 796c 652e 464f 4e54 5f53 495a 4529 2c0a  yle.FONT_SIZE),.
-00023ee0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00023ef0: 2e67 6574 5f61 7474 7269 6275 7465 2843  .get_attribute(C
-00023f00: 5353 5374 796c 652e 4649 4c4c 292c 0a20  SSStyle.FILL),. 
-00023f10: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00023f20: 6765 745f 6174 7472 6962 7574 6528 4353  get_attribute(CS
-00023f30: 5353 7479 6c65 2e53 5452 4f4b 4529 2c0a  SStyle.STROKE),.
-00023f40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00023f50: 2e67 6574 5f61 7474 7269 6275 7465 2843  .get_attribute(C
-00023f60: 5353 5374 796c 652e 464f 4e54 5f46 414d  SSStyle.FONT_FAM
-00023f70: 494c 5929 0a20 2020 2020 2020 2029 0a0a  ILY).        )..
-00023f80: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-00023f90: 0a20 2020 2064 6566 2067 6574 5f63 6f6f  .    def get_coo
-00023fa0: 7264 7328 636c 732c 2065 6c65 6d29 3a0a  rds(cls, elem):.
-00023fb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00023fc0: 2020 2020 3a72 6574 7572 6e3a 2078 302c      :return: x0,
-00023fd0: 2078 312c 2079 302c 2079 310a 2020 2020   x1, y0, y1.    
-00023fe0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00023ff0: 6373 7373 203d 2063 6c73 2e63 7265 6174  csss = cls.creat
-00024000: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
-00024010: 5f61 7474 7269 6275 7465 5f6f 665f 626f  _attribute_of_bo
-00024020: 6479 5f65 6c65 6d65 6e74 2865 6c65 6d29  dy_element(elem)
-00024030: 0a20 2020 2020 2020 2078 3020 3d20 6373  .        x0 = cs
-00024040: 7373 2e67 6574 5f6e 756d 6572 6963 5f61  ss.get_numeric_a
-00024050: 7474 7661 6c28 2278 3022 290a 2020 2020  ttval("x0").    
-00024060: 2020 2020 7831 203d 2063 7373 732e 6765      x1 = csss.ge
-00024070: 745f 6e75 6d65 7269 635f 6174 7476 616c  t_numeric_attval
-00024080: 2822 7831 2229 0a20 2020 2020 2020 2079  ("x1").        y
-00024090: 3020 3d20 6373 7373 2e67 6574 5f6e 756d  0 = csss.get_num
-000240a0: 6572 6963 5f61 7474 7661 6c28 2279 3022  eric_attval("y0"
-000240b0: 290a 2020 2020 2020 2020 7931 203d 2063  ).        y1 = c
-000240c0: 7373 732e 6765 745f 6e75 6d65 7269 635f  sss.get_numeric_
-000240d0: 6174 7476 616c 2822 7931 2229 0a20 2020  attval("y1").   
-000240e0: 2020 2020 2072 6574 7572 6e20 2878 302c       return (x0,
-000240f0: 2079 302c 2078 312c 2079 3129 0a0a 2020   y0, x1, y1)..  
-00024100: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00024110: 2020 2064 6566 2067 6574 5f78 3028 636c     def get_x0(cl
-00024120: 732c 2065 6c65 6d29 3a0a 2020 2020 2020  s, elem):.      
-00024130: 2020 7265 7475 726e 2063 6c73 2e67 6574    return cls.get
-00024140: 5f63 6f6f 7264 7328 656c 656d 295b 305d  _coords(elem)[0]
-00024150: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00024160: 6f64 0a20 2020 2064 6566 2067 6574 5f79  od.    def get_y
-00024170: 3028 636c 732c 2065 6c65 6d29 3a0a 2020  0(cls, elem):.  
-00024180: 2020 2020 2020 7265 7475 726e 2063 6c73        return cls
-00024190: 2e67 6574 5f63 6f6f 7264 7328 656c 656d  .get_coords(elem
-000241a0: 295b 315d 0a0a 2020 2020 4063 6c61 7373  )[1]..    @class
-000241b0: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
-000241c0: 6574 5f78 3128 636c 732c 2065 6c65 6d29  et_x1(cls, elem)
-000241d0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-000241e0: 2063 6c73 2e67 6574 5f63 6f6f 7264 7328   cls.get_coords(
-000241f0: 656c 656d 295b 325d 0a0a 2020 2020 4063  elem)[2]..    @c
-00024200: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00024210: 6566 2067 6574 5f79 3128 636c 732c 2065  ef get_y1(cls, e
-00024220: 6c65 6d29 3a0a 2020 2020 2020 2020 7265  lem):.        re
-00024230: 7475 726e 2063 6c73 2e67 6574 5f63 6f6f  turn cls.get_coo
-00024240: 7264 7328 656c 656d 295b 335d 0a0a 2020  rds(elem)[3]..  
-00024250: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00024260: 2020 2064 6566 2065 7874 7261 6374 5f63     def extract_c
-00024270: 6f6f 7264 735f 616e 645f 666f 6e74 5f70  oords_and_font_p
-00024280: 726f 7065 7274 6965 7328 636c 732c 2073  roperties(cls, s
-00024290: 7061 6e29 3a0a 2020 2020 2020 2020 6373  pan):.        cs
-000242a0: 7373 203d 2043 5353 5374 796c 652e 6372  ss = CSSStyle.cr
-000242b0: 6561 7465 5f63 7373 5f73 7479 6c65 5f66  eate_css_style_f
-000242c0: 726f 6d5f 6174 7472 6962 7574 655f 6f66  rom_attribute_of
-000242d0: 5f62 6f64 795f 656c 656d 656e 7428 7370  _body_element(sp
-000242e0: 616e 290a 2020 2020 2020 2020 666f 6e74  an).        font
-000242f0: 5f73 697a 6520 3d20 6373 7373 2e67 6574  _size = csss.get
-00024300: 5f6e 756d 6572 6963 5f61 7474 7661 6c28  _numeric_attval(
-00024310: 4353 5353 7479 6c65 2e46 4f4e 545f 5349  CSSStyle.FONT_SI
-00024320: 5a45 290a 2020 2020 2020 2020 7930 203d  ZE).        y0 =
-00024330: 2063 7373 732e 6765 745f 6e75 6d65 7269   csss.get_numeri
-00024340: 635f 6174 7476 616c 2822 7930 2229 0a20  c_attval("y0"). 
-00024350: 2020 2020 2020 2079 3120 3d20 6373 7373         y1 = csss
-00024360: 2e67 6574 5f6e 756d 6572 6963 5f61 7474  .get_numeric_att
-00024370: 7661 6c28 2279 3122 290a 2020 2020 2020  val("y1").      
-00024380: 2020 7831 203d 2063 7373 732e 6765 745f    x1 = csss.get_
-00024390: 6e75 6d65 7269 635f 6174 7476 616c 2822  numeric_attval("
-000243a0: 7831 2229 0a20 2020 2020 2020 2072 6574  x1").        ret
-000243b0: 7572 6e20 666f 6e74 5f73 697a 652c 2079  urn font_size, y
-000243c0: 302c 2079 310a 0a20 2020 2040 636c 6173  0, y1..    @clas
-000243d0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-000243e0: 6578 7472 6163 745f 626f 6c64 5f69 7461  extract_bold_ita
-000243f0: 6c69 635f 6672 6f6d 5f66 6f6e 745f 6661  lic_from_font_fa
-00024400: 6d69 6c79 5f66 6f72 5f73 7479 6c65 7328  mily_for_styles(
-00024410: 636c 732c 2073 7479 6c65 7329 3a0a 2020  cls, styles):.  
-00024420: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00024430: 2020 3a73 7479 6c65 733a 206c 6973 7420    :styles: list 
-00024440: 6f66 2043 5353 5374 796c 6520 6f62 6a65  of CSSStyle obje
-00024450: 6374 7320 746f 206e 6f72 6d61 6c69 7a65  cts to normalize
-00024460: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00024470: 2020 2020 2020 6578 7472 6163 7465 6420        extracted 
-00024480: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-00024490: 2073 7479 6c65 2069 6e20 7374 796c 6573   style in styles
-000244a0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-000244b0: 2073 7479 6c65 3a0a 2020 2020 2020 2020   style:.        
-000244c0: 2020 2020 2020 2020 6578 7472 6163 7465          extracte
-000244d0: 642e 6170 7065 6e64 2863 6c73 2e65 7874  d.append(cls.ext
-000244e0: 7261 6374 5f62 6f6c 645f 6974 616c 6963  ract_bold_italic
-000244f0: 5f66 726f 6d5f 666f 6e74 5f66 616d 696c  _from_font_famil
-00024500: 795f 666f 725f 7374 796c 6528 7374 796c  y_for_style(styl
-00024510: 6529 290a 2020 2020 2020 2020 7265 7475  e)).        retu
-00024520: 726e 2065 7874 7261 6374 6564 0a0a 2020  rn extracted..  
-00024530: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
-00024540: 2020 2064 6566 2065 7874 7261 6374 5f62     def extract_b
-00024550: 6f6c 645f 6974 616c 6963 5f66 726f 6d5f  old_italic_from_
-00024560: 666f 6e74 5f66 616d 696c 795f 666f 725f  font_family_for_
-00024570: 7374 796c 6528 636c 732c 2073 7479 6c65  style(cls, style
-00024580: 5f73 293a 0a20 2020 2020 2020 2069 6620  _s):.        if 
-00024590: 6e6f 7420 7374 796c 655f 733a 0a20 2020  not style_s:.   
-000245a0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000245b0: 616c 7565 4572 726f 7228 2273 7479 6c65  alueError("style
-000245c0: 5f73 2069 7320 4e6f 6e65 2229 0a20 2020  _s is None").   
-000245d0: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
-000245e0: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
-000245f0: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
-00024600: 6373 735f 7374 7269 6e67 2873 7472 2873  css_string(str(s
-00024610: 7479 6c65 5f73 2929 0a20 2020 2020 2020  tyle_s)).       
-00024620: 2069 6620 6373 735f 7374 796c 653a 0a20   if css_style:. 
-00024630: 2020 2020 2020 2020 2020 2063 7373 5f73             css_s
-00024640: 7479 6c65 2e65 7874 7261 6374 5f62 6f6c  tyle.extract_bol
-00024650: 645f 6974 616c 6963 5f66 726f 6d5f 666f  d_italic_from_fo
-00024660: 6e74 5f66 616d 696c 7928 0a20 2020 2020  nt_family(.     
-00024670: 2020 2020 2020 2020 2020 206f 7665 7277             overw
-00024680: 7269 7465 5f66 616d 696c 793d 5472 7565  rite_family=True
-00024690: 2c20 6f76 6572 7772 6974 655f 626f 6c64  , overwrite_bold
-000246a0: 3d54 7275 652c 206f 7665 7277 7269 7465  =True, overwrite
-000246b0: 5f73 7479 6c65 3d54 7275 6529 0a20 2020  _style=True).   
-000246c0: 2020 2020 2072 6574 7572 6e20 6373 735f       return css_
-000246d0: 7374 796c 650a 0a0a 636c 6173 7320 4353  style...class CS
-000246e0: 5343 6f6e 7665 7274 6572 3a0a 2020 2020  SConverter:.    
-000246f0: 2222 220a 2020 2020 7475 726e 7320 4343  """.    turns CC
-00024700: 5320 7374 796c 6573 2069 6e74 6f20 6874  S styles into ht
-00024710: 6d6c 2063 6c61 7373 6573 0a20 2020 2022  ml classes.    "
-00024720: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
-00024730: 6974 5f5f 2873 656c 6629 3a0a 2020 2020  it__(self):.    
-00024740: 2020 2020 7061 7373 0a0a 2020 2020 6465      pass..    de
-00024750: 6620 7265 6164 5f68 746d 6c5f 656c 656d  f read_html_elem
-00024760: 656e 7428 7365 6c66 2c20 6874 6d6c 5f65  ent(self, html_e
-00024770: 6c65 6d29 3a0a 2020 2020 2020 2020 2222  lem):.        ""
-00024780: 220a 2020 2020 2020 2020 7265 6164 7320  ".        reads 
-00024790: 616e 6420 636f 6e76 6572 7473 2068 746d  and converts htm
-000247a0: 6c20 656c 656d 656e 742e 0a20 2020 2020  l element..     
-000247b0: 2020 2061 6464 7320 3c68 746d 6c3e 2061     adds <html> a
-000247c0: 7320 726f 6f74 2069 6620 6e6f 7420 7072  s root if not pr
-000247d0: 6573 656e 740a 2020 2020 2020 2020 2222  esent.        ""
-000247e0: 220a 2020 2020 2020 2020 7365 6c66 2e68  ".        self.h
-000247f0: 746d 6c5f 656c 656d 203d 2068 746d 6c5f  tml_elem = html_
-00024800: 656c 656d 0a20 2020 2020 2020 2073 656c  elem.        sel
-00024810: 662e 6874 6d6c 5f65 6c65 6d20 3d20 4874  f.html_elem = Ht
-00024820: 6d6c 5469 6479 2e65 6e73 7572 655f 6874  mlTidy.ensure_ht
-00024830: 6d6c 5f68 6561 645f 626f 6479 2873 656c  ml_head_body(sel
-00024840: 662e 6874 6d6c 5f65 6c65 6d29 0a20 2020  f.html_elem).   
-00024850: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-00024860: 2e68 746d 6c5f 656c 656d 0a0a 636c 6173  .html_elem..clas
-00024870: 7320 466f 6e74 5072 6f70 6572 7479 2845  s FontProperty(E
-00024880: 6e75 6d29 3a0a 2020 2020 2222 220a 2020  num):.    """.  
-00024890: 2020 4172 6961 6c4e 6172 726f 770a 2020    ArialNarrow.  
-000248a0: 2020 4172 6961 6c4e 6172 726f 772d 426f    ArialNarrow-Bo
-000248b0: 6c64 0a20 2020 2043 616c 6962 7269 0a20  ld.    Calibri. 
-000248c0: 2020 2046 7275 7469 6765 724c 5450 726f     FrutigerLTPro
-000248d0: 2d42 6c61 636b 436e 0a20 2020 2046 7275  -BlackCn.    Fru
-000248e0: 7469 6765 724c 5450 726f 2d42 6f6c 6443  tigerLTPro-BoldC
-000248f0: 6e0a 2020 2020 4672 7574 6967 6572 4c54  n.    FrutigerLT
-00024900: 5072 6f2d 426f 6c64 436e 4974 610a 2020  Pro-BoldCnIta.  
-00024910: 2020 4672 7574 6967 6572 4c54 5072 6f2d    FrutigerLTPro-
-00024920: 436f 6e64 656e 7365 640a 2020 2020 4672  Condensed.    Fr
-00024930: 7574 6967 6572 4c54 5072 6f2d 436f 6e64  utigerLTPro-Cond
-00024940: 656e 7365 6449 7461 0a20 2020 2046 7275  ensedIta.    Fru
-00024950: 7469 6765 724c 5450 726f 2d4c 6967 6874  tigerLTPro-Light
-00024960: 0a20 2020 2046 7275 7469 6765 724c 5450  .    FrutigerLTP
-00024970: 726f 2d4c 6967 6874 436e 0a20 2020 2046  ro-LightCn.    F
-00024980: 7275 7469 6765 724c 5450 726f 2d4c 6967  rutigerLTPro-Lig
-00024990: 6874 436e 4974 610a 2020 2020 4672 7574  htCnIta.    Frut
-000249a0: 6967 6572 4c54 5072 6f2d 526f 6d61 6e0a  igerLTPro-Roman.
-000249b0: 2020 2020 2222 220a 2020 2020 230a 2020      """.    #.  
-000249c0: 2020 4e4f 524d 414c 203d 2022 220a 0a20    NORMAL = "".. 
-000249d0: 2020 204e 4152 524f 5720 3d20 226e 6172     NARROW = "nar
-000249e0: 726f 7722 0a20 2020 2057 4944 4520 3d20  row".    WIDE = 
-000249f0: 2277 6964 6522 0a0a 2020 2020 4c49 4748  "wide"..    LIGH
-00024a00: 5420 3d20 226c 6967 6874 220a 2020 2020  T = "light".    
-00024a10: 424f 4c44 203d 2022 626f 6c64 220a 0a20  BOLD = "bold".. 
-00024a20: 2020 2049 5441 4c49 4320 3d20 2269 7461     ITALIC = "ita
-00024a30: 6c69 6322 0a0a 2020 2020 5341 4e53 203d  lic"..    SANS =
-00024a40: 2022 7361 6e73 220a 2020 2020 5345 5249   "sans".    SERI
-00024a50: 4620 3d20 2273 6572 6966 220a 2020 2020  F = "serif".    
-00024a60: 5359 4d42 4f4c 203d 2022 7379 6d62 6f6c  SYMBOL = "symbol
-00024a70: 220a 2020 2020 4d4f 4e4f 5350 4143 4520  ".    MONOSPACE 
-00024a80: 3d20 2273 6f6e 6f73 7061 6365 220a 0a20  = "sonospace".. 
-00024a90: 2020 2064 6566 205f 5f73 7472 5f5f 2873     def __str__(s
-00024aa0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-00024ab0: 7475 726e 2073 7472 2873 656c 662e 7661  turn str(self.va
-00024ac0: 6c75 6529 0a0a 2020 2020 6465 6620 5f5f  lue)..    def __
-00024ad0: 7265 7072 5f5f 2873 656c 6629 3a0a 2020  repr__(self):.  
-00024ae0: 2020 2020 2020 7265 7475 726e 2073 7472        return str
-00024af0: 2873 656c 662e 7661 6c75 6529 0a0a 2320  (self.value)..# 
-00024b00: 7374 7269 7073 2070 7265 6669 7820 6f66  strips prefix of
-00024b10: 6620 666f 6e74 2d6e 616d 6573 0a52 455f  f font-names.RE_
-00024b20: 5052 4546 203d 2072 652e 636f 6d70 696c  PREF = re.compil
-00024b30: 6528 225b 412d 5a5d 7b36 7d5c 5c2b 283f  e("[A-Z]{6}\\+(?
-00024b40: 503c 6e61 6d65 3e5b 5e5c 5c73 5d2b 295c  P<name>[^\\s]+)\
-00024b50: 5c73 2a22 290a 636c 6173 7320 416d 6946  \s*").class AmiF
-00024b60: 6f6e 743a 0a20 2020 2022 2222 0a20 2020  ont:.    """.   
-00024b70: 2065 6d70 6972 6963 616c 206e 6f72 6d61   empirical norma
-00024b80: 6c69 7a61 7469 6f6e 206f 6620 666f 6e74  lization of font
-00024b90: 732e 2054 7269 6573 2074 6f20 636f 6e76  s. Tries to conv
-00024ba0: 6572 7420 616c 6c20 746f 2074 6865 0a20  ert all to the. 
-00024bb0: 2020 2062 6173 650a 2020 2020 666f 6e74     base.    font
-00024bc0: 2d66 616d 696c 793a 2073 6572 6966 2f73  -family: serif/s
-00024bd0: 616e 732d 7365 7269 662f 6d6f 6e6f 7370  ans-serif/monosp
-00024be0: 6163 650a 2020 2020 666f 6e74 2d73 7472  ace.    font-str
-00024bf0: 6574 6368 3a20 2863 6f6e 6465 6e73 6564  etch: (condensed
-00024c00: 2f6e 6f72 6d61 6c2f 6578 7061 6e64 6564  /normal/expanded
-00024c10: 290a 2020 2020 666f 726e 2d77 6569 6768  ).    forn-weigh
-00024c20: 743a 206e 6f72 6d61 6c2f 626f 6c64 0a20  t: normal/bold. 
-00024c30: 2020 2066 6f6e 742d 7374 796c 653a 206e     font-style: n
-00024c40: 6f72 6d61 6c2f 6974 616c 6963 0a20 2020  ormal/italic.   
-00024c50: 2022 2222 0a0a 0a20 2020 2023 2065 6d70   """...    # emp
-00024c60: 6972 6963 616c 2063 6f6e 7665 7273 696f  irical conversio
-00024c70: 6e73 3b20 7769 6c6c 206e 6565 6420 746f  ns; will need to
-00024c80: 2062 6520 7570 6461 7465 6420 6672 6571   be updated freq
-00024c90: 7565 6e74 6c79 0a20 2020 2063 6f6e 7665  uently.    conve
-00024ca0: 7273 696f 6e5f 6469 6374 203d 207b 0a20  rsion_dict = {. 
-00024cb0: 2020 2020 2020 2022 4172 6961 6c22 3a20         "Arial": 
-00024cc0: 466f 6e74 5072 6f70 6572 7479 2e53 414e  FontProperty.SAN
-00024cd0: 532c 0a20 2020 2020 2020 2022 4361 6c69  S,.        "Cali
-00024ce0: 6272 6922 3a20 466f 6e74 5072 6f70 6572  bri": FontProper
-00024cf0: 7479 2e53 414e 532c 0a20 2020 2020 2020  ty.SANS,.       
-00024d00: 2022 4672 7574 6967 6572 223a 2046 6f6e   "Frutiger": Fon
-00024d10: 7450 726f 7065 7274 792e 5341 4e53 2c0a  tProperty.SANS,.
-00024d20: 2020 2020 2020 2020 2248 656c 7665 7469          "Helveti
-00024d30: 6361 223a 2046 6f6e 7450 726f 7065 7274  ca": FontPropert
-00024d40: 792e 5341 4e53 2c0a 0a20 2020 2020 2020  y.SANS,..       
-00024d50: 2022 5469 6d65 7322 3a20 466f 6e74 5072   "Times": FontPr
-00024d60: 6f70 6572 7479 2e53 4552 4946 2c0a 0a20  operty.SERIF,.. 
-00024d70: 2020 2020 2020 2022 436f 7572 6965 7222         "Courier"
-00024d80: 3a20 466f 6e74 5072 6f70 6572 7479 2e4d  : FontProperty.M
-00024d90: 4f4e 4f53 5041 4345 2c0a 0a20 2020 2020  ONOSPACE,..     
-00024da0: 2020 2022 5379 6d62 6f6c 223a 2046 6f6e     "Symbol": Fon
-00024db0: 7450 726f 7065 7274 792e 5359 4d42 4f4c  tProperty.SYMBOL
-00024dc0: 2c0a 2020 2020 7d0a 0a20 2020 2063 6f6e  ,.    }..    con
-00024dd0: 645f 7265 6765 7820 3d20 7265 2e63 6f6d  d_regex = re.com
-00024de0: 7069 6c65 2822 282e 2a29 2843 6f6e 6465  pile("(.*)(Conde
-00024df0: 6e73 6564 7c43 6e7c 4e61 7272 6f77 2928  nsed|Cn|Narrow)(
-00024e00: 2e2a 2922 290a 2020 2020 7769 6465 5f72  .*)").    wide_r
-00024e10: 6567 6578 203d 2072 652e 636f 6d70 696c  egex = re.compil
-00024e20: 6528 2228 2e2a 2928 5769 6465 2928 2e2a  e("(.*)(Wide)(.*
-00024e30: 2922 290a 0a20 2020 206c 6967 6874 5f72  )")..    light_r
-00024e40: 6567 6578 203d 2072 652e 636f 6d70 696c  egex = re.compil
-00024e50: 6528 2228 2e2a 2928 4c69 6768 747c 5468  e("(.*)(Light|Th
-00024e60: 696e 2928 2e2a 2922 290a 2020 2020 626f  in)(.*)").    bo
-00024e70: 6c64 5f72 6567 6578 203d 2072 652e 636f  ld_regex = re.co
-00024e80: 6d70 696c 6528 2228 2e2a 2928 426f 6c64  mpile("(.*)(Bold
-00024e90: 7c48 6561 7679 7765 6967 6874 7c42 6c61  |Heavyweight|Bla
-00024ea0: 636b 2928 2e2a 2922 290a 0a20 2020 2073  ck)(.*)")..    s
-00024eb0: 7479 6c65 5f72 6567 6578 203d 2072 652e  tyle_regex = re.
-00024ec0: 636f 6d70 696c 6528 2228 2e2a 2928 4974  compile("(.*)(It
-00024ed0: 616c 6963 7c49 7461 7c4f 626c 6971 7565  alic|Ita|Oblique
-00024ee0: 2928 2e2a 2922 290a 0a23 2020 2020 636c  )(.*)")..#    cl
-00024ef0: 6173 7320 416d 6946 6f6e 743a 0a0a 2020  ass AmiFont:..  
-00024f00: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00024f10: 656c 6629 3a0a 2020 2020 2020 2020 7365  elf):.        se
-00024f20: 6c66 2e6e 616d 6520 3d20 4e6f 6e65 0a20  lf.name = None. 
-00024f30: 2020 2020 2020 2073 656c 662e 6661 6d69         self.fami
-00024f40: 6c79 203d 204e 6f6e 650a 2020 2020 2020  ly = None.      
-00024f50: 2020 7365 6c66 2e77 6569 6768 7420 3d20    self.weight = 
-00024f60: 7374 7228 466f 6e74 5072 6f70 6572 7479  str(FontProperty
-00024f70: 2e4e 4f52 4d41 4c29 0a20 2020 2020 2020  .NORMAL).       
-00024f80: 2073 656c 662e 7374 796c 6520 3d20 7374   self.style = st
-00024f90: 7228 466f 6e74 5072 6f70 6572 7479 2e4e  r(FontProperty.N
-00024fa0: 4f52 4d41 4c29 0a20 2020 2020 2020 2073  ORMAL).        s
-00024fb0: 656c 662e 7374 7265 7463 6865 6420 3d20  elf.stretched = 
-00024fc0: 7374 7228 466f 6e74 5072 6f70 6572 7479  str(FontProperty
-00024fd0: 2e4e 4f52 4d41 4c29 0a20 2020 2020 2020  .NORMAL).       
-00024fe0: 2073 656c 662e 666f 6e74 203d 2073 7472   self.font = str
-00024ff0: 2846 6f6e 7450 726f 7065 7274 792e 5341  (FontProperty.SA
-00025000: 4e53 290a 0a20 2020 2023 2020 2020 636c  NS)..    #    cl
-00025010: 6173 7320 416d 6946 6f6e 743a 0a0a 2020  ass AmiFont:..  
-00025020: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
-00025030: 6c66 293a 0a20 2020 2020 2020 2073 203d  lf):.        s =
-00025040: 2066 226e 616d 653a 7b73 656c 662e 6e61   f"name:{self.na
-00025050: 6d65 7d3b 6661 6d69 6c79 3a7b 7365 6c66  me};family:{self
-00025060: 2e66 616d 696c 797d 3b77 6569 6768 743a  .family};weight:
-00025070: 7b73 656c 662e 7765 6967 6874 7d3b 7374  {self.weight};st
-00025080: 796c 653a 7b73 656c 662e 7374 796c 657d  yle:{self.style}
-00025090: 3b73 7472 6574 6368 6564 3a7b 7365 6c66  ;stretched:{self
-000250a0: 2e73 7472 6574 6368 6564 7d3b 666f 6e74  .stretched};font
-000250b0: 3a7b 7365 6c66 2e66 6f6e 747d 220a 2020  :{self.font}".  
-000250c0: 2020 2020 2020 7265 7475 726e 2073 0a0a        return s..
-000250d0: 2020 2020 4063 6c61 7373 6d65 7468 6f64      @classmethod
-000250e0: 0a20 2020 2064 6566 2065 7874 7261 6374  .    def extract
-000250f0: 5f6e 616d 655f 7765 6967 6874 5f73 7479  _name_weight_sty
-00025100: 6c65 5f73 7472 6574 6368 6564 5f61 735f  le_stretched_as_
-00025110: 666f 6e74 2863 6c73 2c20 6e61 6d65 3029  font(cls, name0)
-00025120: 3a0a 0a20 2020 2020 2020 2066 6f6e 7420  :..        font 
-00025130: 3d20 416d 6946 6f6e 7428 290a 2020 2020  = AmiFont().    
-00025140: 2020 2020 6e61 6d65 203d 2041 6d69 466f      name = AmiFo
-00025150: 6e74 2e74 7269 6d5f 7064 665f 7072 6566  nt.trim_pdf_pref
-00025160: 6978 286e 616d 6530 290a 0a20 2020 2020  ix(name0)..     
-00025170: 2020 2077 6869 6c65 2054 7275 653a 0a20     while True:. 
-00025180: 2020 2020 2020 2020 2020 206e 616d 652c             name,
-00025190: 206d 6174 6368 203d 2063 6c73 2e65 7874   match = cls.ext
-000251a0: 7261 6374 5f65 6e75 6d65 7261 7465 645f  ract_enumerated_
-000251b0: 7374 796c 6573 2866 6f6e 742c 206e 616d  styles(font, nam
-000251c0: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-000251d0: 6620 6e6f 7420 6d61 7463 683a 0a20 2020  f not match:.   
-000251e0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-000251f0: 616b 0a0a 2020 2020 2020 2020 6e61 6d65  ak..        name
-00025200: 203d 206e 616d 652e 7265 706c 6163 6528   = name.replace(
-00025210: 222d 222c 2222 290a 0a20 2020 2020 2020  "-","")..       
-00025220: 2066 6f6e 742e 6661 6d69 6c79 203d 206e   font.family = n
-00025230: 616d 650a 2020 2020 2020 2020 666f 6e74  ame.        font
-00025240: 2e6e 616d 6520 3d20 6e61 6d65 300a 2020  .name = name0.  
-00025250: 2020 2020 2020 7265 7475 726e 2066 6f6e        return fon
-00025260: 740a 0a20 2020 2040 636c 6173 736d 6574  t..    @classmet
-00025270: 686f 640a 2020 2020 6465 6620 6578 7472  hod.    def extr
-00025280: 6163 745f 656e 756d 6572 6174 6564 5f73  act_enumerated_s
-00025290: 7479 6c65 7328 636c 732c 2066 6f6e 742c  tyles(cls, font,
-000252a0: 206e 616d 6529 3a0a 0a20 2020 2020 2020   name):..       
-000252b0: 206e 616d 652c 206d 6174 6368 203d 2063   name, match = c
-000252c0: 6c73 2e6d 6174 6368 5f66 6f6e 745f 7072  ls.match_font_pr
-000252d0: 6f70 6572 7479 286e 616d 652c 2041 6d69  operty(name, Ami
-000252e0: 466f 6e74 2e63 6f6e 645f 7265 6765 7829  Font.cond_regex)
-000252f0: 0a20 2020 2020 2020 2069 6620 6d61 7463  .        if matc
-00025300: 683a 0a20 2020 2020 2020 2020 2020 2066  h:.            f
-00025310: 6f6e 742e 7374 7265 7463 6865 6420 3d20  ont.stretched = 
-00025320: 466f 6e74 5072 6f70 6572 7479 2e4e 4152  FontProperty.NAR
-00025330: 524f 570a 2020 2020 2020 2020 2020 2020  ROW.            
-00025340: 7265 7475 726e 206e 616d 652c 206d 6174  return name, mat
-00025350: 6368 0a20 2020 2020 2020 206e 616d 652c  ch.        name,
-00025360: 206d 6174 6368 203d 2063 6c73 2e6d 6174   match = cls.mat
-00025370: 6368 5f66 6f6e 745f 7072 6f70 6572 7479  ch_font_property
-00025380: 286e 616d 652c 2041 6d69 466f 6e74 2e77  (name, AmiFont.w
-00025390: 6964 655f 7265 6765 7829 0a20 2020 2020  ide_regex).     
-000253a0: 2020 2069 6620 6d61 7463 683a 0a20 2020     if match:.   
-000253b0: 2020 2020 2020 2020 2066 6f6e 742e 7374           font.st
-000253c0: 7265 7463 6865 6420 3d20 466f 6e74 5072  retched = FontPr
-000253d0: 6f70 6572 7479 2e57 4944 450a 2020 2020  operty.WIDE.    
-000253e0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-000253f0: 616d 652c 206d 6174 6368 0a20 2020 2020  ame, match.     
-00025400: 2020 206e 616d 652c 206d 6174 6368 203d     name, match =
-00025410: 2063 6c73 2e6d 6174 6368 5f66 6f6e 745f   cls.match_font_
-00025420: 7072 6f70 6572 7479 286e 616d 652c 2041  property(name, A
-00025430: 6d69 466f 6e74 2e6c 6967 6874 5f72 6567  miFont.light_reg
-00025440: 6578 290a 2020 2020 2020 2020 6966 206d  ex).        if m
-00025450: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
-00025460: 2020 666f 6e74 2e77 6569 6768 7420 3d20    font.weight = 
-00025470: 466f 6e74 5072 6f70 6572 7479 2e4c 4947  FontProperty.LIG
-00025480: 4854 0a20 2020 2020 2020 2020 2020 2072  HT.            r
-00025490: 6574 7572 6e20 6e61 6d65 2c20 6d61 7463  eturn name, matc
-000254a0: 680a 2020 2020 2020 2020 6e61 6d65 2c20  h.        name, 
-000254b0: 6d61 7463 6820 3d20 636c 732e 6d61 7463  match = cls.matc
-000254c0: 685f 666f 6e74 5f70 726f 7065 7274 7928  h_font_property(
-000254d0: 6e61 6d65 2c20 416d 6946 6f6e 742e 626f  name, AmiFont.bo
-000254e0: 6c64 5f72 6567 6578 290a 2020 2020 2020  ld_regex).      
-000254f0: 2020 6966 206d 6174 6368 3a0a 2020 2020    if match:.    
-00025500: 2020 2020 2020 2020 666f 6e74 2e77 6569          font.wei
-00025510: 6768 7420 3d20 466f 6e74 5072 6f70 6572  ght = FontProper
-00025520: 7479 2e42 4f4c 440a 2020 2020 2020 2020  ty.BOLD.        
-00025530: 2020 2020 7265 7475 726e 206e 616d 652c      return name,
-00025540: 206d 6174 6368 0a0a 2020 2020 2020 2020   match..        
-00025550: 6e61 6d65 2c20 6d61 7463 6820 3d20 636c  name, match = cl
-00025560: 732e 6d61 7463 685f 666f 6e74 5f70 726f  s.match_font_pro
-00025570: 7065 7274 7928 6e61 6d65 2c20 416d 6946  perty(name, AmiF
-00025580: 6f6e 742e 7374 796c 655f 7265 6765 7829  ont.style_regex)
-00025590: 0a20 2020 2020 2020 2069 6620 6d61 7463  .        if matc
-000255a0: 683a 0a20 2020 2020 2020 2020 2020 2066  h:.            f
-000255b0: 6f6e 742e 7374 796c 6520 3d20 466f 6e74  ont.style = Font
-000255c0: 5072 6f70 6572 7479 2e49 5441 4c49 430a  Property.ITALIC.
-000255d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000255e0: 726e 206e 616d 652c 206d 6174 6368 0a0a  rn name, match..
-000255f0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-00025600: 616d 652c 204e 6f6e 650a 0a20 2020 2023  ame, None..    #
-00025610: 2020 2020 636c 6173 7320 416d 6946 6f6e      class AmiFon
-00025620: 743a 0a0a 2020 2020 2222 220a 2020 2020  t:..    """.    
-00025630: 426f 6c64 2046 6f6e 7473 3a20 312e 2041  Bold Fonts: 1. A
-00025640: 7269 616c 0a20 2020 2043 616c 6962 7269  rial.    Calibri
-00025650: 0a20 2020 2043 656e 7475 7279 2047 6f74  .    Century Got
-00025660: 6869 630a 2020 2020 2042 6f6c 6420 342e  hic.     Bold 4.
-00025670: 200a 2020 2020 2046 7261 6e6b 6c69 6e20   .     Franklin 
-00025680: 476f 7468 6963 200a 2020 2020 2042 6f6c  Gothic .     Bol
-00025690: 6420 352e 200a 2020 2020 2046 7574 7572  d 5. .     Futur
-000256a0: 6120 426f 6c64 2036 2e20 0a20 2020 2020  a Bold 6. .     
-000256b0: 4769 6c6c 2053 616e 7320 426f 6c64 2037  Gill Sans Bold 7
-000256c0: 2e20 0a20 2020 2048 656c 7665 7469 6361  . .    Helvetica
-000256d0: 2042 6f6c 6420 382e 200a 2020 2020 496d   Bold 8. .    Im
-000256e0: 7061 6374 2042 6f6c 6420 392e 0a20 2020  pact Bold 9..   
-000256f0: 204c 7563 6964 6120 5361 6e73 2042 6f6c   Lucida Sans Bol
-00025700: 6420 3130 2e20 0a20 2020 204d 7972 6961  d 10. .    Myria
-00025710: 6420 5072 6f20 426f 6c64 2031 312e 204f  d Pro Bold 11. O
-00025720: 7065 6e20 5361 6e73 2042 6f6c 6420 3132  pen Sans Bold 12
-00025730: 2e20 5061 6c61 7469 6e6f 2042 6f6c 6420  . Palatino Bold 
-00025740: 3133 2e20 526f 636b 7765 6c6c 2042 6f6c  13. Rockwell Bol
-00025750: 6420 3134 2e20 0a20 2020 2053 6567 6f65  d 14. .    Segoe
-00025760: 2055 4920 426f 6c64 2031 352e 2054 696d   UI Bold 15. Tim
-00025770: 6573 204e 6577 2052 6f6d 616e 2042 6f6c  es New Roman Bol
-00025780: 6420 3136 2e20 556e 6976 6572 7320 426f  d 16. Univers Bo
-00025790: 6c64 2031 372e 2056 6572 6461 6e61 2042  ld 17. Verdana B
-000257a0: 6f6c 6420 3138 2e20 4176 656e 6972 2042  old 18. Avenir B
-000257b0: 6f6c 6420 3139 2e20 4261 736b 6572 7669  old 19. Baskervi
-000257c0: 6c6c 6520 426f 6c64 2032 302e 2043 6c61  lle Bold 20. Cla
-000257d0: 7265 6e64 6f6e 2042 6f6c 6420 3231 2e20  rendon Bold 21. 
-000257e0: 430a 2020 2020 6f70 7065 7270 6c61 7465  C.    opperplate
-000257f0: 2042 6f6c 6420 3232 2e20 4469 646f 7420   Bold 22. Didot 
-00025800: 426f 6c64 2032 332e 2045 7572 6f73 7469  Bold 23. Eurosti
-00025810: 6c65 2042 6f6c 6420 3234 2e20 4672 7574  le Bold 24. Frut
-00025820: 6967 6572 2042 6f6c 6420 3235 2e20 4761  iger Bold 25. Ga
-00025830: 7261 6d6f 6e64 2042 6f6c 6420 3236 2e20  ramond Bold 26. 
-00025840: 4765 6f72 6769 6120 426f 6c64 2032 372e  Georgia Bold 27.
-00025850: 2047 6f74 6861 6d20 426f 6c64 2032 382e   Gotham Bold 28.
-00025860: 200a 2020 2020 486f 6566 6c65 7220 5465   .    Hoefler Te
-00025870: 7874 2042 6f6c 6420 3239 2e20 4954 4320  xt Bold 29. ITC 
-00025880: 4176 616e 7420 4761 7264 6520 476f 7468  Avant Garde Goth
-00025890: 6963 2042 6f6c 6420 3330 2e20 4954 4320  ic Bold 30. ITC 
-000258a0: 4672 616e 6b6c 696e 2047 6f74 6869 6320  Franklin Gothic 
-000258b0: 426f 6c64 2033 312e 2049 5443 204c 7562  Bold 31. ITC Lub
-000258c0: 616c 696e 2047 7261 7068 2042 6f6c 6420  alin Graph Bold 
-000258d0: 3332 2e20 0a20 2020 2049 5443 204f 6666  32. .    ITC Off
-000258e0: 6963 696e 6120 5361 6e73 2042 6f6c 6420  icina Sans Bold 
-000258f0: 3333 2e20 4954 4320 5374 6f6e 6520 5361  33. ITC Stone Sa
-00025900: 6e73 2042 6f6c 6420 3334 2e20 4d69 6e69  ns Bold 34. Mini
-00025910: 6f6e 2050 726f 2042 6f6c 6420 3335 2e20  on Pro Bold 35. 
-00025920: 4d75 7365 6f20 5361 6e73 2042 6f6c 6420  Museo Sans Bold 
-00025930: 3336 2e20 4e65 7574 7261 6661 6365 2042  36. Neutraface B
-00025940: 6f6c 6420 3337 2e20 0a20 2020 204f 7074  old 37. .    Opt
-00025950: 696d 6120 426f 6c64 2033 382e 2050 726f  ima Bold 38. Pro
-00025960: 7869 6d61 204e 6f76 6120 426f 6c64 2033  xima Nova Bold 3
-00025970: 392e 2052 6f62 6f74 6f20 426f 6c64 2034  9. Roboto Bold 4
-00025980: 302e 2053 6162 6f6e 2042 6f6c 6420 3431  0. Sabon Bold 41
-00025990: 2e20 5472 6164 6520 476f 7468 6963 2042  . Trade Gothic B
-000259a0: 6f6c 6420 3432 2e20 0a20 2020 2054 7265  old 42. .    Tre
-000259b0: 6275 6368 6574 204d 5320 426f 6c64 2034  buchet MS Bold 4
-000259c0: 332e 200a 2020 2020 5562 756e 7475 2042  3. .    Ubuntu B
-000259d0: 6f6c 6420 3434 2e20 0a20 2020 2056 4147  old 44. .    VAG
-000259e0: 2052 6f75 6e64 6564 2042 6f6c 6420 3435   Rounded Bold 45
-000259f0: 2e20 0a20 2020 2057 6869 746e 6579 2042  . .    Whitney B
-00025a00: 6f6c 6420 3436 2e20 0a20 2020 2058 6974  old 46. .    Xit
-00025a10: 7320 426f 6c64 2034 372e 200a 2020 2020  s Bold 47. .    
-00025a20: 5961 6e6f 6e65 204b 6166 6665 6573 6174  Yanone Kaffeesat
-00025a30: 7a20 426f 6c64 2034 382e 200a 2020 2020  z Bold 48. .    
-00025a40: 5a69 6c6c 6120 536c 6162 0a20 2020 205a  Zilla Slab.    Z
-00025a50: 6f6e 610a 2020 2020 5a75 7269 6368 200a  ona.    Zurich .
-00025a60: 2020 2020 2222 220a 0a20 2020 2023 2020      """..    #  
-00025a70: 2020 636c 6173 7320 416d 6946 6f6e 743a    class AmiFont:
-00025a80: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
-00025a90: 6f64 0a20 2020 2064 6566 206d 6174 6368  od.    def match
-00025aa0: 5f66 6f6e 745f 7072 6f70 6572 7479 2863  _font_property(c
-00025ab0: 6c73 2c20 6e61 6d65 2c20 7265 6765 7829  ls, name, regex)
-00025ac0: 3a0a 2020 2020 2020 2020 6d61 7463 6820  :.        match 
-00025ad0: 3d20 7265 6765 782e 6d61 7463 6828 6e61  = regex.match(na
-00025ae0: 6d65 290a 2020 2020 2020 2020 6966 206d  me).        if m
-00025af0: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
-00025b00: 2020 6e61 6d65 203d 206d 6174 6368 2e67    name = match.g
-00025b10: 726f 7570 2831 2920 2b20 6d61 7463 682e  roup(1) + match.
-00025b20: 6772 6f75 7028 3329 2023 2063 686f 7020  group(3) # chop 
-00025b30: 6f75 7420 6d61 7463 680a 2020 2020 2020  out match.      
-00025b40: 2020 7265 7475 726e 206e 616d 652c 206d    return name, m
-00025b50: 6174 6368 0a0a 2020 2020 4063 6c61 7373  atch..    @class
-00025b60: 6d65 7468 6f64 0a20 2020 2064 6566 2063  method.    def c
-00025b70: 6f6e 7665 7274 5f63 6f6d 6d6f 6e5f 666f  onvert_common_fo
-00025b80: 6e74 7328 636c 7329 3a0a 2020 2020 2020  nts(cls):.      
-00025b90: 2020 7061 7373 0a0a 2020 2020 2320 2020    pass..    #   
-00025ba0: 2063 6c61 7373 2041 6d69 466f 6e74 3a0a   class AmiFont:.
-00025bb0: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
-00025bc0: 640a 2020 2020 6465 6620 6372 6561 7465  d.    def create
-00025bd0: 5f66 6f6e 745f 6564 6974 6564 5f73 7479  _font_edited_sty
-00025be0: 6c65 5f66 726f 6d5f 6865 6164 5f73 7479  le_from_head_sty
-00025bf0: 6c65 2863 6c73 2c20 7374 796c 655f 656c  le(cls, style_el
-00025c00: 656d 293a 0a20 2020 2020 2020 2022 2222  em):.        """
-00025c10: 0a20 2020 2020 2020 2065 6d70 6972 6963  .        empiric
-00025c20: 616c 6c79 2063 7265 6174 6520 7374 616e  ally create stan
-00025c30: 6461 7264 2066 6f6e 7473 2061 6e64 2061  dard fonts and a
-00025c40: 7474 7269 6275 7465 7320 6672 6f6d 2066  ttributes from f
-00025c50: 6f6e 7420 6e61 6d65 730a 2020 2020 2020  ont names.      
-00025c60: 2020 3a70 6172 616d 2063 7373 5f73 7479    :param css_sty
-00025c70: 6c65 3a20 4353 5353 7479 6c65 204f 626a  le: CSSStyle Obj
-00025c80: 6563 7420 6f72 2048 544d 4c20 6865 6164  ect or HTML head
-00025c90: 2f73 7479 6c65 2077 6974 6820 756e 6b6e  /style with unkn
-00025ca0: 6f77 6e20 666f 6e74 2d66 616d 696c 790a  own font-family.
-00025cb0: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00025cc0: 2074 7570 6c65 2028 7379 6d62 6f6c 5f72   tuple (symbol_r
-00025cd0: 6566 2c20 6e65 7720 6373 735f 7374 796c  ef, new css_styl
-00025ce0: 6520 6f62 6a65 6374 2077 6974 6820 7374  e object with st
-00025cf0: 616e 6461 7264 2066 6f6e 7420 616e 6420  andard font and 
-00025d00: 6d61 7962 6520 6e65 7720 7765 6967 6874  maybe new weight
-00025d10: 206f 7220 7374 796c 6529 0a20 2020 2020   or style).     
-00025d20: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00025d30: 6620 6e6f 7420 7479 7065 2873 7479 6c65  f not type(style
-00025d40: 5f65 6c65 6d29 2069 7320 5f45 6c65 6d65  _elem) is _Eleme
-00025d50: 6e74 3a0a 2020 2020 2020 2020 2020 2020  nt:.            
-00025d60: 7265 7475 726e 204e 6f6e 652c 204e 6f6e  return None, Non
-00025d70: 650a 2020 2020 2020 2020 7379 6d62 6f6c  e.        symbol
-00025d80: 5f72 6566 2c20 6373 735f 7374 796c 6520  _ref, css_style 
-00025d90: 3d20 4353 5353 7479 6c65 2e63 7265 6174  = CSSStyle.creat
-00025da0: 655f 6373 735f 7374 796c 655f 6672 6f6d  e_css_style_from
-00025db0: 5f68 746d 6c5f 6865 6164 5f73 7479 6c65  _html_head_style
-00025dc0: 5f65 6c65 6d28 7374 796c 655f 656c 656d  _elem(style_elem
-00025dd0: 290a 2020 2020 2020 2020 6966 2063 7373  ).        if css
-00025de0: 5f73 7479 6c65 2069 7320 6e6f 7420 4e6f  _style is not No
-00025df0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00025e00: 666f 6e74 5f66 616d 696c 7920 3d20 6373  font_family = cs
-00025e10: 735f 7374 796c 652e 666f 6e74 5f66 616d  s_style.font_fam
-00025e20: 696c 790a 2020 2020 2020 2020 2020 2020  ily.            
-00025e30: 616d 695f 666f 6e74 203d 2041 6d69 466f  ami_font = AmiFo
-00025e40: 6e74 2e65 7874 7261 6374 5f6e 616d 655f  nt.extract_name_
-00025e50: 7765 6967 6874 5f73 7479 6c65 5f73 7472  weight_style_str
-00025e60: 6574 6368 6564 5f61 735f 666f 6e74 2866  etched_as_font(f
-00025e70: 6f6e 745f 6661 6d69 6c79 290a 2020 2020  ont_family).    
-00025e80: 2020 2020 2020 2020 6e65 775f 6373 735f          new_css_
-00025e90: 7374 796c 6520 3d20 4353 5353 7479 6c65  style = CSSStyle
-00025ea0: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
-00025eb0: 6f72 2069 7465 6d20 696e 2063 7373 5f73  or item in css_s
-00025ec0: 7479 6c65 2e6e 616d 655f 7661 6c75 655f  tyle.name_value_
-00025ed0: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
-00025ee0: 2020 2020 2020 6e65 775f 6373 735f 7374        new_css_st
-00025ef0: 796c 652e 6e61 6d65 5f76 616c 7565 5f64  yle.name_value_d
-00025f00: 6963 745b 6974 656d 5b30 5d5d 203d 2069  ict[item[0]] = i
-00025f10: 7465 6d5b 315d 0a20 2020 2020 2020 2020  tem[1].         
-00025f20: 2020 206e 6577 5f63 7373 5f73 7479 6c65     new_css_style
-00025f30: 2e73 6574 5f61 7474 7269 6275 7465 2846  .set_attribute(F
-00025f40: 4f4e 545f 4641 4d49 4c59 2c20 616d 695f  ONT_FAMILY, ami_
-00025f50: 666f 6e74 2e66 616d 696c 7929 0a20 2020  font.family).   
-00025f60: 2020 2020 2020 2020 206e 6577 5f63 7373           new_css
-00025f70: 5f73 7479 6c65 2e73 6574 5f61 7474 7269  _style.set_attri
-00025f80: 6275 7465 2846 4f4e 545f 5745 4947 4854  bute(FONT_WEIGHT
-00025f90: 2c20 616d 695f 666f 6e74 2e77 6569 6768  , ami_font.weigh
-00025fa0: 7429 0a20 2020 2020 2020 2020 2020 206e  t).            n
-00025fb0: 6577 5f63 7373 5f73 7479 6c65 2e73 6574  ew_css_style.set
-00025fc0: 5f61 7474 7269 6275 7465 2846 4f4e 545f  _attribute(FONT_
-00025fd0: 5354 594c 452c 2061 6d69 5f66 6f6e 742e  STYLE, ami_font.
-00025fe0: 7374 796c 6529 0a20 2020 2020 2020 2020  style).         
-00025ff0: 2020 206e 6577 5f63 7373 5f73 7479 6c65     new_css_style
-00026000: 2e73 6574 5f61 7474 7269 6275 7465 2846  .set_attribute(F
-00026010: 4f4e 545f 5354 5245 5443 4845 442c 2061  ONT_STRETCHED, a
-00026020: 6d69 5f66 6f6e 742e 7374 7265 7463 6865  mi_font.stretche
-00026030: 6429 0a20 2020 2020 2020 2072 6574 7572  d).        retur
-00026040: 6e20 7379 6d62 6f6c 5f72 6566 2c20 6e65  n symbol_ref, ne
-00026050: 775f 6373 735f 7374 796c 650a 0a20 2020  w_css_style..   
-00026060: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
-00026070: 2020 6465 6620 6372 6561 7465 5f66 6f6e    def create_fon
-00026080: 745f 6564 6974 6564 5f73 7479 6c65 5f66  t_edited_style_f
-00026090: 726f 6d5f 6373 735f 7374 796c 655f 6f62  rom_css_style_ob
-000260a0: 6a65 6374 2863 6c73 2c20 6373 735f 7374  ject(cls, css_st
-000260b0: 796c 6529 3a0a 2020 2020 2020 2020 2222  yle):.        ""
-000260c0: 220a 2020 2020 2020 2020 656d 7069 7269  ".        empiri
-000260d0: 6361 6c6c 7920 6372 6561 7465 2073 7461  cally create sta
-000260e0: 6e64 6172 6420 666f 6e74 7320 616e 6420  ndard fonts and 
-000260f0: 6174 7472 6962 7574 6573 2066 726f 6d20  attributes from 
-00026100: 666f 6e74 206e 616d 6573 0a20 2020 2020  font names.     
-00026110: 2020 203a 7061 7261 6d20 6373 735f 7374     :param css_st
-00026120: 796c 653a 2043 5353 5374 796c 6520 4f62  yle: CSSStyle Ob
-00026130: 6a65 6374 206f 7220 4854 4d4c 2068 6561  ject or HTML hea
-00026140: 642f 7374 796c 6520 7769 7468 2075 6e6b  d/style with unk
-00026150: 6e6f 776e 2066 6f6e 742d 6661 6d69 6c79  nown font-family
-00026160: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00026170: 3a20 7475 706c 6520 2873 796d 626f 6c5f  : tuple (symbol_
-00026180: 7265 662c 206e 6577 2063 7373 5f73 7479  ref, new css_sty
-00026190: 6c65 206f 626a 6563 7420 7769 7468 2073  le object with s
-000261a0: 7461 6e64 6172 6420 666f 6e74 2061 6e64  tandard font and
-000261b0: 206d 6179 6265 206e 6577 2077 6569 6768   maybe new weigh
-000261c0: 7420 6f72 2073 7479 6c65 290a 2020 2020  t or style).    
-000261d0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-000261e0: 2069 6620 6373 735f 7374 796c 6520 6973   if css_style is
-000261f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00026200: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
-00026210: 2020 2020 2020 2069 6620 7479 7065 2863         if type(c
-00026220: 7373 5f73 7479 6c65 2920 6973 2045 542e  ss_style) is ET.
-00026230: 5f45 6c65 6d65 6e74 3a0a 2020 2020 2020  _Element:.      
-00026240: 2020 2020 2020 7072 696e 7420 2866 2265        print (f"e
-00026250: 6c65 6d65 6e74 207b 4554 2e74 6f73 7472  lement {ET.tostr
-00026260: 696e 6728 6373 735f 7374 796c 6529 7d22  ing(css_style)}"
-00026270: 290a 2020 2020 2020 2020 6966 2074 7970  ).        if typ
-00026280: 6528 6373 735f 7374 796c 6529 2069 7320  e(css_style) is 
-00026290: 7374 723a 0a20 2020 2020 2020 2020 2020  str:.           
-000262a0: 2063 7373 5f73 7479 6c65 203d 2043 5353   css_style = CSS
-000262b0: 5374 796c 652e 6372 6561 7465 5f63 7373  Style.create_css
-000262c0: 5f73 7479 6c65 5f66 726f 6d5f 6373 735f  _style_from_css_
-000262d0: 7374 7269 6e67 2863 7373 5f73 7479 6c65  string(css_style
-000262e0: 290a 2020 2020 2020 2020 6966 2063 7373  ).        if css
-000262f0: 5f73 7479 6c65 2069 7320 4e6f 6e65 3a0a  _style is None:.
-00026300: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00026310: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-00026320: 6173 7365 7274 2074 7970 6528 6373 735f  assert type(css_
-00026330: 7374 796c 6529 2069 7320 4353 5353 7479  style) is CSSSty
-00026340: 6c65 2c20 6622 666f 756e 6420 7b74 7970  le, f"found {typ
-00026350: 6528 6373 735f 7374 796c 6529 7d22 0a20  e(css_style)}". 
-00026360: 2020 2020 2020 2069 6620 6e6f 7420 6373         if not cs
-00026370: 735f 7374 796c 652e 666f 6e74 5f66 616d  s_style.font_fam
-00026380: 696c 793a 0a20 2020 2020 2020 2020 2020  ily:.           
-00026390: 2072 6574 7572 6e20 6373 735f 7374 796c   return css_styl
-000263a0: 650a 2020 2020 2020 2020 616d 695f 666f  e.        ami_fo
-000263b0: 6e74 203d 2041 6d69 466f 6e74 2e65 7874  nt = AmiFont.ext
-000263c0: 7261 6374 5f6e 616d 655f 7765 6967 6874  ract_name_weight
-000263d0: 5f73 7479 6c65 5f73 7472 6574 6368 6564  _style_stretched
-000263e0: 5f61 735f 666f 6e74 2863 7373 5f73 7479  _as_font(css_sty
-000263f0: 6c65 2e66 6f6e 745f 6661 6d69 6c79 290a  le.font_family).
-00026400: 2020 2020 2020 2020 6e65 775f 6373 735f          new_css_
-00026410: 7374 796c 6520 3d20 4353 5353 7479 6c65  style = CSSStyle
-00026420: 2829 0a20 2020 2020 2020 2066 6f72 2069  ().        for i
-00026430: 7465 6d20 696e 2063 7373 5f73 7479 6c65  tem in css_style
-00026440: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
-00026450: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-00026460: 2020 2020 2020 6e65 775f 6373 735f 7374        new_css_st
-00026470: 796c 652e 6e61 6d65 5f76 616c 7565 5f64  yle.name_value_d
-00026480: 6963 745b 6974 656d 5b30 5d5d 203d 2069  ict[item[0]] = i
-00026490: 7465 6d5b 315d 0a20 2020 2020 2020 206e  tem[1].        n
-000264a0: 6577 5f63 7373 5f73 7479 6c65 2e73 6574  ew_css_style.set
-000264b0: 5f61 7474 7269 6275 7465 2846 4f4e 545f  _attribute(FONT_
-000264c0: 4e41 4d45 2c20 7374 7228 616d 695f 666f  NAME, str(ami_fo
-000264d0: 6e74 2e6e 616d 6529 290a 2020 2020 2020  nt.name)).      
-000264e0: 2020 6e65 775f 6373 735f 7374 796c 652e    new_css_style.
-000264f0: 7365 745f 6174 7472 6962 7574 6528 464f  set_attribute(FO
-00026500: 4e54 5f46 4f4e 542c 2073 7472 2861 6d69  NT_FONT, str(ami
-00026510: 5f66 6f6e 742e 666f 6e74 2929 0a20 2020  _font.font)).   
-00026520: 2020 2020 206e 6577 5f63 7373 5f73 7479       new_css_sty
-00026530: 6c65 2e73 6574 5f61 7474 7269 6275 7465  le.set_attribute
-00026540: 2846 4f4e 545f 4641 4d49 4c59 2c20 7374  (FONT_FAMILY, st
-00026550: 7228 616d 695f 666f 6e74 2e66 616d 696c  r(ami_font.famil
-00026560: 7929 290a 2020 2020 2020 2020 6e65 775f  y)).        new_
-00026570: 6373 735f 7374 796c 652e 7365 745f 6174  css_style.set_at
-00026580: 7472 6962 7574 6528 464f 4e54 5f57 4549  tribute(FONT_WEI
-00026590: 4748 542c 2073 7472 2861 6d69 5f66 6f6e  GHT, str(ami_fon
-000265a0: 742e 7765 6967 6874 292e 6c6f 7765 7228  t.weight).lower(
-000265b0: 2929 0a20 2020 2020 2020 206e 6577 5f63  )).        new_c
-000265c0: 7373 5f73 7479 6c65 2e73 6574 5f61 7474  ss_style.set_att
-000265d0: 7269 6275 7465 2846 4f4e 545f 5354 594c  ribute(FONT_STYL
-000265e0: 452c 2073 7472 2861 6d69 5f66 6f6e 742e  E, str(ami_font.
-000265f0: 7374 796c 6529 2e6c 6f77 6572 2829 290a  style).lower()).
-00026600: 2020 2020 2020 2020 6e65 775f 6373 735f          new_css_
-00026610: 7374 796c 652e 7365 745f 6174 7472 6962  style.set_attrib
-00026620: 7574 6528 464f 4e54 5f53 5452 4554 4348  ute(FONT_STRETCH
-00026630: 4544 2c20 7374 7228 616d 695f 666f 6e74  ED, str(ami_font
-00026640: 2e73 7472 6574 6368 6564 292e 6c6f 7765  .stretched).lowe
-00026650: 7228 2929 0a20 2020 2020 2020 2072 6574  r()).        ret
-00026660: 7572 6e20 6e65 775f 6373 735f 7374 796c  urn new_css_styl
-00026670: 650a 0a20 2020 2023 2020 2020 636c 6173  e..    #    clas
-00026680: 7320 416d 6946 6f6e 743a 0a0a 2020 2020  s AmiFont:..    
-00026690: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
-000266a0: 6620 6973 5f62 6f6c 6428 7365 6c66 293a  f is_bold(self):
-000266b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000266c0: 7374 7228 466f 6e74 5072 6f70 6572 7479  str(FontProperty
-000266d0: 2e42 4f4c 4429 203d 3d20 7365 6c66 2e77  .BOLD) == self.w
-000266e0: 6569 6768 740a 0a20 2020 2040 7072 6f70  eight..    @prop
-000266f0: 6572 7479 0a20 2020 2064 6566 2069 735f  erty.    def is_
-00026700: 6974 616c 6963 2873 656c 6629 3a0a 2020  italic(self):.  
-00026710: 2020 2020 2020 7265 7475 726e 2073 7472        return str
-00026720: 2846 6f6e 7450 726f 7065 7274 792e 4954  (FontProperty.IT
-00026730: 414c 4943 2920 3d3d 2073 656c 662e 7374  ALIC) == self.st
-00026740: 796c 650a 0a20 2020 2040 636c 6173 736d  yle..    @classm
-00026750: 6574 686f 640a 2020 2020 6465 6620 7472  ethod.    def tr
-00026760: 696d 5f70 6466 5f70 7265 6669 7828 636c  im_pdf_prefix(cl
-00026770: 732c 206e 616d 6529 3a0a 2020 2020 2020  s, name):.      
-00026780: 2020 2222 2272 656d 6f76 6573 2074 6865    """removes the
-00026790: 2041 4243 4445 462b 2070 7265 6669 7820   ABCDEF+ prefix 
-000267a0: 6672 6f6d 2066 6f6e 742d 6e61 6d65 0a20  from font-name. 
-000267b0: 2020 2020 2020 2054 6869 7320 7072 6566         This pref
-000267c0: 6978 2073 6572 7665 7320 6e6f 2075 7365  ix serves no use
-000267d0: 6675 6c20 7075 7270 6f73 6520 666f 7220  ful purpose for 
-000267e0: 7465 7874 2061 6e61 6c79 7369 7320 616e  text analysis an
-000267f0: 6420 6973 2064 6973 6361 7264 6564 2222  d is discarded""
-00026800: 220a 2020 2020 2020 2020 6966 206e 616d  ".        if nam
-00026810: 653a 0a20 2020 2020 2020 2020 2020 206d  e:.            m
-00026820: 6174 6368 203d 2052 455f 5052 4546 2e6d  atch = RE_PREF.m
-00026830: 6174 6368 286e 616d 6529 0a20 2020 2020  atch(name).     
-00026840: 2020 2020 2020 2069 6620 6d61 7463 683a         if match:
-00026850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00026860: 206e 616d 6520 3d20 6d61 7463 682e 6772   name = match.gr
-00026870: 6f75 7028 226e 616d 6522 290a 2020 2020  oup("name").    
-00026880: 2020 2020 7265 7475 726e 206e 616d 650a      return name.
-00026890: 0a0a 636c 6173 7320 5365 6374 696f 6e48  ..class SectionH
-000268a0: 6965 7261 7263 6879 3a0a 2020 2020 2222  ierarchy:.    ""
-000268b0: 220a 2020 2020 6275 696c 6473 2061 6e64  ".    builds and
-000268c0: 2071 7565 7269 6573 2068 6965 7261 7263   queries hierarc
-000268d0: 6869 6361 6c20 7365 6374 696f 6e73 0a20  hical sections. 
-000268e0: 2020 2022 2222 0a0a 2020 2020 4944 203d     """..    ID =
-000268f0: 2022 6964 220a 2020 2020 434c 4153 5320   "id".    CLASS 
-00026900: 3d20 2763 6c61 7373 270a 2020 2020 444f  = 'class'.    DO
-00026910: 5420 3d20 222e 220a 2020 2020 4d49 5353  T = ".".    MISS
-00026920: 494e 4720 3d20 226d 6973 7369 6e67 220a  ING = "missing".
-00026930: 2020 2020 5345 4354 203d 2022 7365 6374      SECT = "sect
-00026940: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
-00026950: 745f 5f28 7365 6c66 293a 0a20 2020 2020  t__(self):.     
-00026960: 2020 2070 6173 730a 0a20 2020 2064 6566     pass..    def
-00026970: 2061 6464 5f73 6563 7469 6f6e 7328 7365   add_sections(se
-00026980: 6c66 2c20 6465 6369 6d61 6c5f 7365 6374  lf, decimal_sect
-00026990: 696f 6e73 2c20 746f 703d 4e6f 6e65 2c20  ions, top=None, 
-000269a0: 706f 706c 6973 743d 4e6f 6e65 293a 0a20  poplist=None):. 
-000269b0: 2020 2020 2020 2069 6620 6e6f 7420 706f         if not po
-000269c0: 706c 6973 743a 0a20 2020 2020 2020 2020  plist:.         
-000269d0: 2020 2070 6f70 6c69 7374 203d 205b 5d0a     poplist = [].
-000269e0: 2020 2020 2020 2020 7365 6374 696f 6e73          sections
-000269f0: 5f62 795f 6c65 7665 6c20 3d20 7365 6c66  _by_level = self
-00026a00: 2e63 7265 6174 655f 7365 6374 696f 6e73  .create_sections
-00026a10: 5f62 795f 6c65 7665 6c28 6465 6369 6d61  _by_level(decima
-00026a20: 6c5f 7365 6374 696f 6e73 290a 2020 2020  l_sections).    
-00026a30: 2020 2020 7061 7265 6e74 5f64 6963 7420      parent_dict 
-00026a40: 3d20 7365 6c66 2e63 7265 6174 655f 7061  = self.create_pa
-00026a50: 7265 6e74 5f64 6963 7428 7365 6374 696f  rent_dict(sectio
-00026a60: 6e73 5f62 795f 6c65 7665 6c29 0a20 2020  ns_by_level).   
-00026a70: 2020 2020 2066 6f72 2070 6f70 2069 6e20       for pop in 
-00026a80: 706f 706c 6973 743a 0a20 2020 2020 2020  poplist:.       
-00026a90: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00026aa0: 2020 2020 2020 2020 2020 7061 7265 6e74            parent
-00026ab0: 5f64 6963 742e 706f 7028 706f 7029 2020  _dict.pop(pop)  
-00026ac0: 2320 7265 6d6f 7665 206e 6f6e 2d6e 756d  # remove non-num
-00026ad0: 6572 6963 2069 7465 6d0a 2020 2020 2020  eric item.      
-00026ae0: 2020 2020 2020 6578 6365 7074 3a0a 2020        except:.  
-00026af0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00026b00: 696e 7428 2243 616e 6e6f 7420 706f 7020  int("Cannot pop 
-00026b10: 7b70 6f70 7d22 290a 0a20 2020 2020 2020  {pop}")..       
-00026b20: 2072 6f6f 7420 3d20 456c 656d 656e 7428   root = Element(
-00026b30: 7365 6c66 2e53 4543 5429 0a20 2020 2020  self.SECT).     
-00026b40: 2020 2072 6f6f 742e 6174 7472 6962 5b73     root.attrib[s
-00026b50: 656c 662e 4944 5d20 3d20 2234 220a 2020  elf.ID] = "4".  
-00026b60: 2020 2020 2020 666f 7220 7365 6374 5f69        for sect_i
-00026b70: 6420 696e 2070 6172 656e 745f 6469 6374  d in parent_dict
-00026b80: 2e6b 6579 7328 293a 0a20 2020 2020 2020  .keys():.       
-00026b90: 2020 2020 2073 656c 662e 656e 7375 7265       self.ensure
-00026ba0: 5f65 6c65 6d65 6e74 2872 6f6f 742c 2073  _element(root, s
-00026bb0: 6563 745f 6964 2c20 7061 7265 6e74 5f64  ect_id, parent_d
-00026bc0: 6963 7429 0a0a 2020 2020 6465 6620 6372  ict)..    def cr
-00026bd0: 6561 7465 5f70 6172 656e 745f 6469 6374  eate_parent_dict
-00026be0: 2873 656c 662c 2073 6563 7469 6f6e 735f  (self, sections_
-00026bf0: 6279 5f6c 6576 656c 293a 0a20 2020 2020  by_level):.     
-00026c00: 2020 2070 6172 656e 745f 6469 6374 203d     parent_dict =
-00026c10: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
-00026c20: 666f 7220 6c65 7665 6c20 696e 2073 6563  for level in sec
-00026c30: 7469 6f6e 735f 6279 5f6c 6576 656c 2e6b  tions_by_level.k
-00026c40: 6579 7328 293a 0a20 2020 2020 2020 2020  eys():.         
-00026c50: 2020 2073 6563 745f 6964 7320 3d20 7365     sect_ids = se
-00026c60: 6c66 2e61 6464 5f70 6172 656e 7473 286c  lf.add_parents(l
-00026c70: 6576 656c 2c20 7365 6374 696f 6e73 5f62  evel, sections_b
-00026c80: 795f 6c65 7665 6c2c 2070 6172 656e 745f  y_level, parent_
-00026c90: 6469 6374 290a 2020 2020 2020 2020 7265  dict).        re
-00026ca0: 7475 726e 2070 6172 656e 745f 6469 6374  turn parent_dict
-00026cb0: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
-00026cc0: 5f73 6563 7469 6f6e 735f 6279 5f6c 6576  _sections_by_lev
-00026cd0: 656c 2873 656c 662c 2064 6563 696d 616c  el(self, decimal
-00026ce0: 5f73 6563 7469 6f6e 7329 3a0a 2020 2020  _sections):.    
-00026cf0: 2020 2020 7365 6374 696f 6e73 5f62 795f      sections_by_
-00026d00: 6c65 7665 6c20 3d20 6465 6661 756c 7464  level = defaultd
-00026d10: 6963 7428 6c69 7374 290a 2020 2020 2020  ict(list).      
-00026d20: 2020 666f 7220 7365 6374 696f 6e20 696e    for section in
-00026d30: 2064 6563 696d 616c 5f73 6563 7469 6f6e   decimal_section
-00026d40: 733a 0a20 2020 2020 2020 2020 2020 206c  s:.            l
-00026d50: 6576 656c 203d 2073 6563 7469 6f6e 2e61  evel = section.a
-00026d60: 7474 7269 622e 6765 7428 7365 6c66 2e43  ttrib.get(self.C
-00026d70: 4c41 5353 292e 7370 6c69 7428 295b 315d  LASS).split()[1]
-00026d80: 0a20 2020 2020 2020 2020 2020 2073 6563  .            sec
-00026d90: 7469 6f6e 735f 6279 5f6c 6576 656c 5b6c  tions_by_level[l
-00026da0: 6576 656c 5d2e 6170 7065 6e64 2873 6563  evel].append(sec
-00026db0: 7469 6f6e 2e74 6578 7429 0a20 2020 2020  tion.text).     
-00026dc0: 2020 2072 6574 7572 6e20 7365 6374 696f     return sectio
-00026dd0: 6e73 5f62 795f 6c65 7665 6c0a 0a20 2020  ns_by_level..   
-00026de0: 2064 6566 2061 6464 5f70 6172 656e 7473   def add_parents
-00026df0: 2873 656c 662c 206c 6576 656c 2c20 6d75  (self, level, mu
-00026e00: 6c74 6964 6963 742c 2070 6172 656e 745f  ltidict, parent_
-00026e10: 6469 6374 293a 0a20 2020 2020 2020 206c  dict):.        l
-00026e20: 6576 656c 5f73 6563 7473 203d 206d 756c  evel_sects = mul
-00026e30: 7469 6469 6374 5b6c 6576 656c 5d0a 2020  tidict[level].  
-00026e40: 2020 2020 2020 666f 7220 6c65 7665 6c5f        for level_
-00026e50: 7365 6374 2069 6e20 6c65 7665 6c5f 7365  sect in level_se
-00026e60: 6374 733a 0a20 2020 2020 2020 2020 2020  cts:.           
-00026e70: 2070 6172 656e 7420 3d20 7365 6c66 2e67   parent = self.g
-00026e80: 6574 5f70 6172 656e 7428 6c65 7665 6c5f  et_parent(level_
-00026e90: 7365 6374 290a 2020 2020 2020 2020 2020  sect).          
-00026ea0: 2020 7061 7265 6e74 5f64 6963 745b 6c65    parent_dict[le
-00026eb0: 7665 6c5f 7365 6374 5d20 3d20 7061 7265  vel_sect] = pare
-00026ec0: 6e74 0a0a 2020 2020 6465 6620 6765 745f  nt..    def get_
-00026ed0: 7061 7265 6e74 2873 656c 662c 206c 6576  parent(self, lev
-00026ee0: 656c 5f73 6563 7429 3a0a 2020 2020 2020  el_sect):.      
-00026ef0: 2020 6269 7473 203d 206c 6576 656c 5f73    bits = level_s
-00026f00: 6563 742e 7370 6c69 7428 222e 2229 0a20  ect.split("."). 
-00026f10: 2020 2020 2020 2070 6172 656e 7420 3d20         parent = 
-00026f20: 4e6f 6e65 2069 6620 6c65 6e28 6269 7473  None if len(bits
-00026f30: 2920 3d3d 2031 2065 6c73 6520 7365 6c66  ) == 1 else self
-00026f40: 2e44 4f54 2e6a 6f69 6e28 6269 7473 5b3a  .DOT.join(bits[:
-00026f50: 2d31 5d29 0a20 2020 2020 2020 2072 6574  -1]).        ret
-00026f60: 7572 6e20 7061 7265 6e74 0a0a 2020 2020  urn parent..    
-00026f70: 6465 6620 656e 7375 7265 5f65 6c65 6d65  def ensure_eleme
-00026f80: 6e74 2873 656c 662c 2072 6f6f 742c 2073  nt(self, root, s
-00026f90: 6563 745f 6964 2c20 7061 7265 6e74 5f64  ect_id, parent_d
-00026fa0: 6963 7429 3a0a 2020 2020 2020 2020 6966  ict):.        if
-00026fb0: 2073 6563 745f 6964 203d 3d20 2222 3a0a   sect_id == "":.
-00026fc0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00026fd0: 7428 6622 5241 4e20 4f46 4620 544f 5022  t(f"RAN OFF TOP"
-00026fe0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00026ff0: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
-00027000: 2020 7870 6174 6820 3d20 6622 2f2f 7b73    xpath = f"//{s
-00027010: 656c 662e 5345 4354 7d5b 4069 643d 277b  elf.SECT}[@id='{
-00027020: 7365 6374 5f69 647d 275d 220a 2020 2020  sect_id}']".    
-00027030: 2020 2020 656c 656d 7320 3d20 726f 6f74      elems = root
-00027040: 2e78 7061 7468 2878 7061 7468 290a 2020  .xpath(xpath).  
-00027050: 2020 2020 2020 6966 206c 656e 2865 6c65        if len(ele
-00027060: 6d73 2920 3d3d 2030 3a0a 2020 2020 2020  ms) == 0:.      
-00027070: 2020 2020 2020 7061 7265 6e74 5f69 6420        parent_id 
-00027080: 3d20 7061 7265 6e74 5f64 6963 742e 6765  = parent_dict.ge
-00027090: 7428 7365 6374 5f69 6429 0a20 2020 2020  t(sect_id).     
-000270a0: 2020 2020 2020 206d 6973 7369 6e67 203d         missing =
-000270b0: 2046 616c 7365 0a20 2020 2020 2020 2020   False.         
-000270c0: 2020 2069 6620 7061 7265 6e74 5f69 6420     if parent_id 
-000270d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-000270e0: 2020 2020 2020 2020 2070 7269 6e74 2866           print(f
-000270f0: 2220 6d69 7373 696e 6720 7061 7265 6e74  " missing parent
-00027100: 2073 6563 7469 6f6e 207b 7365 6374 5f69   section {sect_i
-00027110: 647d 2229 0a20 2020 2020 2020 2020 2020  d}").           
-00027120: 2020 2020 206d 6973 7369 6e67 203d 2054       missing = T
-00027130: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00027140: 2020 2020 7370 6c20 3d20 7365 6374 5f69      spl = sect_i
-00027150: 642e 7370 6c69 7428 7365 6c66 2e44 4f54  d.split(self.DOT
-00027160: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00027170: 2020 7370 6c69 745f 203d 2073 706c 5b3a    split_ = spl[:
-00027180: 2d31 5d0a 2020 2020 2020 2020 2020 2020  -1].            
-00027190: 2020 2020 7061 7265 6e74 5f69 6420 3d20      parent_id = 
-000271a0: 7365 6c66 2e44 4f54 2e6a 6f69 6e28 7370  self.DOT.join(sp
-000271b0: 6c69 745f 290a 2020 2020 2020 2020 2020  lit_).          
-000271c0: 2020 6966 2070 6172 656e 745f 6964 203d    if parent_id =
-000271d0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-000271e0: 2020 2020 2020 7072 696e 7428 6622 2073        print(f" s
-000271f0: 6b69 7020 726f 6f74 2e2e 2e22 290a 2020  kip root...").  
-00027200: 2020 2020 2020 2020 2020 656c 656d 203d            elem =
-00027210: 2073 656c 662e 656e 7375 7265 5f65 6c65   self.ensure_ele
-00027220: 6d65 6e74 2872 6f6f 742c 2070 6172 656e  ment(root, paren
-00027230: 745f 6964 2c20 7061 7265 6e74 5f64 6963  t_id, parent_dic
-00027240: 7429 0a20 2020 2020 2020 2020 2020 2069  t).            i
-00027250: 6620 656c 656d 2069 7320 6e6f 7420 4e6f  f elem is not No
-00027260: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00027270: 2020 2020 7365 6374 5f78 6d6c 203d 2045      sect_xml = E
-00027280: 542e 5375 6245 6c65 6d65 6e74 2865 6c65  T.SubElement(ele
-00027290: 6d2c 2073 656c 662e 5345 4354 290a 2020  m, self.SECT).  
-000272a0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-000272b0: 6374 5f78 6d6c 2e61 7474 7269 625b 7365  ct_xml.attrib[se
-000272c0: 6c66 2e49 445d 203d 2073 6563 745f 6964  lf.ID] = sect_id
-000272d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000272e0: 2069 6620 6d69 7373 696e 673a 0a20 2020   if missing:.   
-000272f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00027300: 2073 6563 745f 786d 6c2e 6174 7472 6962   sect_xml.attrib
-00027310: 5b73 656c 662e 4d49 5353 494e 475d 203d  [self.MISSING] =
-00027320: 2022 5922 0a20 2020 2020 2020 2020 2020   "Y".           
-00027330: 2020 2020 2072 6574 7572 6e20 7365 6374       return sect
-00027340: 5f78 6d6c 0a20 2020 2020 2020 2065 6c69  _xml.        eli
-00027350: 6620 6c65 6e28 656c 656d 7329 203e 2031  f len(elems) > 1
-00027360: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
-00027370: 696e 7428 6622 2064 7570 6c69 6361 7465  int(f" duplicate
-00027380: 2069 6473 3a20 7b73 6563 745f 6964 7d22   ids: {sect_id}"
-00027390: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-000273a0: 7475 726e 204e 6f6e 650a 2020 2020 2020  turn None.      
-000273b0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000273c0: 2020 2020 7265 7475 726e 2065 6c65 6d73      return elems
-000273d0: 5b30 5d0a 0a20 2020 2064 6566 2073 6f72  [0]..    def sor
-000273e0: 745f 7365 6374 696f 6e73 2873 656c 6629  t_sections(self)
-000273f0: 3a0a 2020 2020 2020 2020 7072 696e 7428  :.        print(
-00027400: 2273 6f72 7420 7365 6374 696f 6e73 204e  "sort sections N
-00027410: 5949 2229 0a20 2020 2020 2020 2070 6173  YI").        pas
-00027420: 730a 0a20 2020 2040 636c 6173 736d 6574  s..    @classmet
-00027430: 686f 640a 2020 2020 6465 6620 736f 7274  hod.    def sort
-00027440: 5f69 6473 2863 6c73 293a 0a20 2020 2020  _ids(cls):.     
-00027450: 2020 2070 6173 730a 0a63 6c61 7373 2046     pass..class F
-00027460: 6f6f 746e 6f74 653a 0a20 2020 2022 2222  ootnote:.    """
-00027470: 6578 7472 6163 7473 2066 6f6f 746e 6f74  extracts footnot
-00027480: 6573 2062 7920 7369 7a65 2061 6e64 2073  es by size and s
-00027490: 7479 6c65 2061 6e64 2070 6572 6861 7073  tyle and perhaps
-000274a0: 2070 6f73 6974 696f 6d0a 2020 2020 2222   positiom.    ""
-000274b0: 220a 0a20 2020 2040 636c 6173 736d 6574  "..    @classmet
-000274c0: 686f 640a 2020 2020 6465 6620 6578 7472  hod.    def extr
-000274d0: 6163 745f 666f 6f74 6e6f 7465 7328 636c  act_footnotes(cl
-000274e0: 732c 2066 6e5f 7870 6174 682c 2066 6f6f  s, fn_xpath, foo
-000274f0: 746e 6f74 655f 7465 7874 5f63 6c61 7373  tnote_text_class
-00027500: 6573 2c20 6874 6d6c 5f65 6c65 6d29 3a0a  es, html_elem):.
-00027510: 2020 2020 2020 2020 6e65 775f 6874 6d6c          new_html
-00027520: 5f65 6c65 6d20 3d20 4874 6d6c 4c69 622e  _elem = HtmlLib.
-00027530: 6372 6561 7465 5f6e 6577 5f68 746d 6c5f  create_new_html_
-00027540: 7769 7468 5f6f 6c64 5f73 7479 6c65 7328  with_old_styles(
-00027550: 6874 6d6c 5f65 6c65 6d29 0a20 2020 2020  html_elem).     
-00027560: 2020 2066 6f6f 746e 6f74 655f 6e75 6d62     footnote_numb
-00027570: 6572 5f66 6f6e 745f 656c 656d 7320 3d20  er_font_elems = 
-00027580: 6874 6d6c 5f65 6c65 6d2e 7870 6174 6828  html_elem.xpath(
-00027590: 666e 5f78 7061 7468 290a 2020 2020 2020  fn_xpath).      
-000275a0: 2020 6c61 7374 5f66 6f6f 746e 756d 203d    last_footnum =
-000275b0: 2030 0a20 2020 2020 2020 2075 6c20 3d20   0.        ul = 
-000275c0: 4554 2e45 6c65 6d65 6e74 2822 756c 2229  ET.Element("ul")
-000275d0: 0a20 2020 2020 2020 2048 746d 6c4c 6962  .        HtmlLib
-000275e0: 2e67 6574 5f62 6f64 7928 6e65 775f 6874  .get_body(new_ht
-000275f0: 6d6c 5f65 6c65 6d29 2e61 7070 656e 6428  ml_elem).append(
-00027600: 756c 290a 2020 2020 2020 2020 2320 6d65  ul).        # me
-00027610: 7373 792c 206e 6565 6420 6120 466f 6f74  ssy, need a Foot
-00027620: 6e6f 7465 206f 626a 6563 7420 6865 7265  note object here
-00027630: 0a20 2020 2020 2020 2066 6f72 2066 6f6f  .        for foo
-00027640: 746e 6f74 655f 6e75 6d62 6572 5f65 6c65  tnote_number_ele
-00027650: 6d20 696e 2066 6f6f 746e 6f74 655f 6e75  m in footnote_nu
-00027660: 6d62 6572 5f66 6f6e 745f 656c 656d 733a  mber_font_elems:
-00027670: 0a20 2020 2020 2020 2020 2020 206c 6173  .            las
-00027680: 745f 666f 6f74 6e75 6d2c 206c 6920 3d20  t_footnum, li = 
-00027690: 466f 6f74 6e6f 7465 2e65 7874 7261 6374  Footnote.extract
-000276a0: 5f66 6f6f 746e 6f74 655f 616e 645f 7361  _footnote_and_sa
-000276b0: 7665 280a 2020 2020 2020 2020 2020 2020  ve(.            
-000276c0: 2020 2020 666f 6f74 6e6f 7465 5f6e 756d      footnote_num
-000276d0: 6265 725f 656c 656d 2c20 666f 6f74 6e6f  ber_elem, footno
-000276e0: 7465 5f74 6578 745f 636c 6173 7365 732c  te_text_classes,
-000276f0: 206c 6173 745f 666f 6f74 6e75 6d29 0a20   last_footnum). 
-00027700: 2020 2020 2020 2020 2020 2069 6620 6c69             if li
-00027710: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00027720: 2020 2020 2020 2020 2020 2020 2020 756c                ul
-00027730: 2e61 7070 656e 6428 6c69 290a 2020 2020  .append(li).    
-00027740: 2020 2020 7265 7475 726e 206e 6577 5f68      return new_h
-00027750: 746d 6c5f 656c 656d 0a0a 2020 2020 4063  tml_elem..    @c
-00027760: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
-00027770: 6566 2069 735f 666f 6f74 6e6f 7465 5f66  ef is_footnote_f
-00027780: 6f6e 7428 636c 732c 2066 6f6f 746e 6f74  ont(cls, footnot
-00027790: 655f 6e75 6d62 6572 5f65 6c65 6d29 3a0a  e_number_elem):.
-000277a0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000277b0: 2020 2020 666f 6e74 2073 697a 6520 616c      font size al
-000277c0: 6f6e 6520 646f 6573 206e 6f74 2064 6973  one does not dis
-000277d0: 7469 6e67 7569 7368 2c20 736f 2075 7365  tinguish, so use
-000277e0: 206e 6569 6768 626f 7572 696e 6720 7465   neighbouring te
-000277f0: 7874 0a20 2020 2020 2020 2022 2222 0a20  xt.        """. 
-00027800: 2020 2020 2020 206e 6578 7420 3d20 586d         next = Xm
-00027810: 6c4c 6962 2e67 6574 5f6e 6578 745f 656c  lLib.get_next_el
-00027820: 656d 656e 7428 666f 6f74 6e6f 7465 5f6e  ement(footnote_n
-00027830: 756d 6265 725f 656c 656d 290a 2020 2020  umber_elem).    
-00027840: 2020 2020 7465 7874 203d 2066 6f6f 746e      text = footn
-00027850: 6f74 655f 6e75 6d62 6572 5f65 6c65 6d2e  ote_number_elem.
-00027860: 7465 7874 0a20 2020 2020 2020 2069 6620  text.        if 
-00027870: 6e65 7874 2069 7320 4e6f 6e65 3a0a 2020  next is None:.  
-00027880: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00027890: 6622 4e4f 2066 6f6c 6c6f 7769 6e67 2065  f"NO following e
-000278a0: 6c65 6d22 290a 2020 2020 2020 2020 2020  lem").          
-000278b0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
-000278c0: 2020 2020 2020 2023 2066 6f6c 6c6f 6564         # folloed
-000278d0: 2062 7920 736d 616c 6c20 666f 6e74 3f0a   by small font?.
-000278e0: 2020 2020 2020 2020 6e65 7874 5f63 6c61          next_cla
-000278f0: 7373 203d 206e 6578 742e 6174 7472 6962  ss = next.attrib
-00027900: 5b22 636c 6173 7322 5d0a 2020 2020 2020  ["class"].      
-00027910: 2020 6966 206e 6578 745f 636c 6173 7320    if next_class 
-00027920: 3d3d 2022 7331 3034 3522 3a0a 2020 2020  == "s1045":.    
-00027930: 2020 2020 2020 2020 7265 7475 726e 2054          return T
-00027940: 7275 650a 2020 2020 2020 2020 7265 7475  rue.        retu
-00027950: 726e 2046 616c 7365 0a0a 0a23 2046 6f6f  rn False...# Foo
-00027960: 746e 6f74 650a 0a20 2020 2040 636c 6173  tnote..    @clas
-00027970: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
-00027980: 6578 7472 6163 745f 666f 6f74 6e6f 7465  extract_footnote
-00027990: 5f61 6e64 5f73 6176 6528 636c 732c 2066  _and_save(cls, f
-000279a0: 6f6f 746e 6f74 655f 6e75 6d62 6572 5f65  ootnote_number_e
-000279b0: 6c65 6d2c 2066 6f6f 746e 6f74 655f 7465  lem, footnote_te
-000279c0: 7874 5f63 6c61 7373 6573 2c20 6c61 7374  xt_classes, last
-000279d0: 5f66 6f6f 746e 756d 293a 0a20 2020 2020  _footnum):.     
-000279e0: 2020 2074 6578 7420 3d20 666f 6f74 6e6f     text = footno
-000279f0: 7465 5f6e 756d 6265 725f 656c 656d 2e74  te_number_elem.t
-00027a00: 6578 740a 2020 2020 2020 2020 666f 6f74  ext.        foot
-00027a10: 6e6f 7465 5f6e 756d 6265 7220 3d20 2d31  note_number = -1
-00027a20: 0a20 2020 2020 2020 2069 676e 6f72 6520  .        ignore 
-00027a30: 3d20 4661 6c73 650a 2020 2020 2020 2020  = False.        
-00027a40: 6966 206e 6f74 2063 6c73 2e69 735f 666f  if not cls.is_fo
-00027a50: 6f74 6e6f 7465 5f66 6f6e 7428 666f 6f74  otnote_font(foot
-00027a60: 6e6f 7465 5f6e 756d 6265 725f 656c 656d  note_number_elem
-00027a70: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-00027a80: 676e 6f72 6520 3d20 5472 7565 0a20 2020  gnore = True.   
-00027a90: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00027aa0: 2020 2020 2020 666f 6f74 6e6f 7465 5f6e        footnote_n
-00027ab0: 756d 6265 7220 3d20 696e 7428 7465 7874  umber = int(text
-00027ac0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-00027ad0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-00027ae0: 2020 2020 2020 2020 6967 6e6f 7265 203d          ignore =
-00027af0: 2054 7275 650a 2020 2020 2020 2020 6c69   True.        li
-00027b00: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
-00027b10: 6966 206e 6f74 2069 676e 6f72 6520 616e  if not ignore an
-00027b20: 6420 3520 3e20 2866 6f6f 746e 6f74 655f  d 5 > (footnote_
-00027b30: 6e75 6d62 6572 202d 206c 6173 745f 666f  number - last_fo
-00027b40: 6f74 6e75 6d29 203e 3d20 303a 0a20 2020  otnum) >= 0:.   
-00027b50: 2020 2020 2020 2020 206c 6173 745f 666f           last_fo
-00027b60: 6f74 6e75 6d2c 206c 6920 3d20 636c 732e  otnum, li = cls.
-00027b70: 6465 6c65 7465 5f66 6f6f 746e 6f74 655f  delete_footnote_
-00027b80: 6e75 6d62 6572 5f61 6e64 5f66 6f6c 6c6f  number_and_follo
-00027b90: 7769 6e67 5f74 6578 745f 5f61 6e64 5f61  wing_text__and_a
-00027ba0: 6464 5f74 6f5f 6c69 7374 280a 2020 2020  dd_to_list(.    
-00027bb0: 2020 2020 2020 2020 2020 2020 666f 6f74              foot
-00027bc0: 6e6f 7465 5f74 6578 745f 636c 6173 7365  note_text_classe
-00027bd0: 732c 2066 6f6f 746e 6f74 655f 6e75 6d62  s, footnote_numb
-00027be0: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
-00027bf0: 2020 2020 666f 6f74 6e6f 7465 5f6e 756d      footnote_num
-00027c00: 6265 725f 656c 656d 290a 2020 2020 2020  ber_elem).      
-00027c10: 2020 7265 7475 726e 206c 6173 745f 666f    return last_fo
-00027c20: 6f74 6e75 6d2c 206c 690a 0a20 2020 2023  otnum, li..    #
-00027c30: 2046 6f6f 746e 6f74 650a 0a20 2020 2040   Footnote..    @
-00027c40: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
-00027c50: 6465 6620 6372 6561 7465 5f66 6f6f 746e  def create_footn
-00027c60: 6f74 655f 6e75 6d62 6572 5f78 7061 7468  ote_number_xpath
-00027c70: 2863 6c73 2c20 666f 6f74 6e6f 7465 5f6e  (cls, footnote_n
-00027c80: 756d 6265 725f 636c 6173 7365 7329 3a0a  umber_classes):.
-00027c90: 2020 2020 2020 2020 7870 6174 6830 203d          xpath0 =
-00027ca0: 2022 220a 2020 2020 2020 2020 666f 7220   "".        for 
-00027cb0: 692c 2066 6e63 2069 6e20 656e 756d 6572  i, fnc in enumer
-00027cc0: 6174 6528 666f 6f74 6e6f 7465 5f6e 756d  ate(footnote_num
-00027cd0: 6265 725f 636c 6173 7365 7329 3a0a 2020  ber_classes):.  
-00027ce0: 2020 2020 2020 2020 2020 7870 6174 6830            xpath0
-00027cf0: 202b 3d20 2222 2069 6620 6920 3d3d 2030   += "" if i == 0
-00027d00: 2065 6c73 6520 2220 6f72 2022 0a20 2020   else " or ".   
-00027d10: 2020 2020 2020 2020 2078 7061 7468 3020           xpath0 
-00027d20: 2b3d 2066 2227 7b66 6e63 7d27 220a 2020  += f"'{fnc}'".  
-00027d30: 2020 2020 2020 666e 5f78 7061 7468 203d        fn_xpath =
-00027d40: 2066 222e 2f2f 7370 616e 5b7b 7870 6174   f".//span[{xpat
-00027d50: 6830 7d5d 220a 2020 2020 2020 2020 7265  h0}]".        re
-00027d60: 7475 726e 2066 6e5f 7870 6174 680a 0a20  turn fn_xpath.. 
-00027d70: 2020 2023 2046 6f6f 746e 6f74 650a 0a20     # Footnote.. 
-00027d80: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
-00027d90: 2020 2020 6465 6620 6465 6c65 7465 5f66      def delete_f
-00027da0: 6f6f 746e 6f74 655f 6e75 6d62 6572 5f61  ootnote_number_a
-00027db0: 6e64 5f66 6f6c 6c6f 7769 6e67 5f74 6578  nd_following_tex
-00027dc0: 745f 5f61 6e64 5f61 6464 5f74 6f5f 6c69  t__and_add_to_li
-00027dd0: 7374 280a 2020 2020 2020 2020 2020 2020  st(.            
-00027de0: 636c 732c 2063 6c61 7373 6573 2c20 666f  cls, classes, fo
-00027df0: 6f74 6e6f 7465 5f6e 756d 6265 722c 2066  otnote_number, f
-00027e00: 6f6f 746e 6f74 655f 6e75 6d62 6572 5f65  ootnote_number_e
-00027e10: 6c65 6d29 3a0a 2020 2020 2020 2020 6c69  lem):.        li
-00027e20: 203d 2045 542e 456c 656d 656e 7428 226c   = ET.Element("l
-00027e30: 6922 290a 2020 2020 2020 2020 6c69 2e61  i").        li.a
-00027e40: 7070 656e 6428 636f 7079 2e64 6565 7063  ppend(copy.deepc
-00027e50: 6f70 7928 666f 6f74 6e6f 7465 5f6e 756d  opy(footnote_num
-00027e60: 6265 725f 656c 656d 2929 0a20 2020 2020  ber_elem)).     
-00027e70: 2020 2066 6f6f 746e 6f74 655f 666f 6c6c     footnote_foll
-00027e80: 6f77 6572 7320 3d20 586d 6c4c 6962 2e67  owers = XmlLib.g
-00027e90: 6574 5f66 6f6c 6c6f 7769 6e67 5f65 6c65  et_following_ele
-00027ea0: 6d65 6e74 7328 666f 6f74 6e6f 7465 5f6e  ments(footnote_n
-00027eb0: 756d 6265 725f 656c 656d 290a 2020 2020  umber_elem).    
-00027ec0: 2020 2020 2320 6164 6420 6f6e 6520 7370      # add one sp
-00027ed0: 616e 2865 6e64 7320 6166 7465 7220 666f  an(ends after fo
-00027ee0: 6e74 2063 6861 6d67 6529 0a20 2020 2020  nt chamge).     
-00027ef0: 2020 2063 6c73 2e69 7465 7261 7465 5f75     cls.iterate_u
-00027f00: 6e74 696c 5f75 6e61 6363 6570 7461 626c  ntil_unacceptabl
-00027f10: 655f 666f 6e74 5f63 6c61 7373 2866 6f6f  e_font_class(foo
-00027f20: 746e 6f74 655f 666f 6c6c 6f77 6572 732c  tnote_followers,
-00027f30: 206c 693d 6c69 2c20 666e 5f63 6c61 7373   li=li, fn_class
-00027f40: 6573 3d63 6c61 7373 6573 290a 2020 2020  es=classes).    
-00027f50: 2020 2020 6c61 7374 5f66 6f6f 746e 756d      last_footnum
-00027f60: 203d 2066 6f6f 746e 6f74 655f 6e75 6d62   = footnote_numb
-00027f70: 6572 0a20 2020 2020 2020 2058 6d6c 4c69  er.        XmlLi
-00027f80: 622e 7265 6d6f 7665 5f65 6c65 6d65 6e74  b.remove_element
-00027f90: 2866 6f6f 746e 6f74 655f 6e75 6d62 6572  (footnote_number
-00027fa0: 5f65 6c65 6d29 0a20 2020 2020 2020 2072  _elem).        r
-00027fb0: 6574 7572 6e20 6c61 7374 5f66 6f6f 746e  eturn last_footn
-00027fc0: 756d 2c20 6c69 0a0a 2020 2020 2320 466f  um, li..    # Fo
-00027fd0: 6f74 6e6f 7465 0a0a 2020 2020 4063 6c61  otnote..    @cla
-00027fe0: 7373 6d65 7468 6f64 0a20 2020 2064 6566  ssmethod.    def
-00027ff0: 2069 7465 7261 7465 5f75 6e74 696c 5f75   iterate_until_u
-00028000: 6e61 6363 6570 7461 626c 655f 666f 6e74  nacceptable_font
-00028010: 5f63 6c61 7373 2863 6c73 2c20 666f 6c6c  _class(cls, foll
-00028020: 6f77 6572 732c 206c 693d 4e6f 6e65 2c20  owers, li=None, 
-00028030: 666e 5f63 6c61 7373 6573 3d4e 6f6e 652c  fn_classes=None,
-00028040: 2064 6562 7567 3d46 616c 7365 293a 0a20   debug=False):. 
-00028050: 2020 2020 2020 2022 2222 6974 6572 6174         """iterat
-00028060: 6573 206f 7665 7220 656c 656d 7473 2066  es over elemts f
-00028070: 6f6c 6c6f 7769 6e67 2061 2066 6f6f 746e  ollowing a footn
-00028080: 6f74 6520 6e75 6d62 6572 2075 6e74 696c  ote number until
-00028090: 2061 6e20 696e 636f 6d70 6174 6962 6c65   an incompatible
-000280a0: 0a20 2020 2020 2020 2063 6c61 7373 2073  .        class s
-000280b0: 7479 6c65 2069 7320 666f 756e 642c 2077  tyle is found, w
-000280c0: 6865 6e20 6272 6561 6b22 2222 0a20 2020  hen break""".   
-000280d0: 2020 2020 2066 6f72 2066 6f6c 6c6f 7765       for followe
-000280e0: 7220 696e 2066 6f6c 6c6f 7765 7273 3a0a  r in followers:.
-000280f0: 2020 2020 2020 2020 2020 2020 636c 617a              claz
-00028100: 7a20 3d20 666f 6c6c 6f77 6572 2e61 7474  z = follower.att
-00028110: 7269 625b 2263 6c61 7373 225d 0a20 2020  rib["class"].   
-00028120: 2020 2020 2020 2020 2069 6620 636c 617a           if claz
-00028130: 7a20 696e 2066 6e5f 636c 6173 7365 733a  z in fn_classes:
-00028140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028150: 206c 692e 6170 7065 6e64 2863 6f70 792e   li.append(copy.
-00028160: 6465 6570 636f 7079 2866 6f6c 6c6f 7765  deepcopy(followe
-00028170: 7229 290a 2020 2020 2020 2020 2020 2020  r)).            
-00028180: 2020 2020 586d 6c4c 6962 2e72 656d 6f76      XmlLib.remov
-00028190: 655f 656c 656d 656e 7428 666f 6c6c 6f77  e_element(follow
-000281a0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-000281b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000281c0: 2020 2020 2020 6966 2064 6562 7567 3a0a        if debug:.
-000281d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000281e0: 2020 2020 7072 696e 7428 6622 6272 6f6b      print(f"brok
-000281f0: 6520 6f75 7420 6f66 2066 6f6f 746e 6f74  e out of footnot
-00028200: 6520 6174 207b 636c 617a 7a7d 2229 0a20  e at {clazz}"). 
-00028210: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00028220: 7265 616b 0a0a 0a                        reak...
+0001a180: 2020 2020 2020 2020 2020 2020 206f 7269               ori
+0001a190: 673d 2220 215c 2223 2425 2627 2829 2a2b  g=" !\"#$%&'()*+
+0001a1a0: 2c2f 3a3b 3c3d 3e3f 405b 5c5c 5d5e 607b  ,/:;<=>?@[\\]^`{
+0001a1b0: 7c7d 7e22 2c20 7265 703d 225f 2229 3a0a  |}~", rep="_"):.
+0001a1c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001a1d0: 2020 2020 6372 6561 7465 2066 696c 656e      create filen
+0001a1e0: 616d 6520 6672 6f6d 2073 6563 7469 6f6e  ame from section
+0001a1f0: 206e 616d 652c 2072 6570 6c61 6365 2070   name, replace p
+0001a200: 756e 6374 2063 6861 7261 6374 6572 730a  unct characters.
+0001a210: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001a220: 2020 2020 6966 206f 7574 7075 745f 6469      if output_di
+0001a230: 723a 0a20 2020 2020 2020 2020 2020 206f  r:.            o
+0001a240: 7574 7075 745f 6469 7220 3d20 5061 7468  utput_dir = Path
+0001a250: 286f 7574 7075 745f 6469 7229 0a20 2020  (output_dir).   
+0001a260: 2020 2020 2020 2020 206f 7574 7075 745f           output_
+0001a270: 6469 722e 6d6b 6469 7228 6578 6973 745f  dir.mkdir(exist_
+0001a280: 6f6b 3d54 7275 6529 0a0a 2020 2020 2020  ok=True)..      
+0001a290: 2020 2020 2020 7075 6e63 745f 6d61 736b        punct_mask
+0001a2a0: 203d 2055 7469 6c2e 6d61 6b65 5f74 7261   = Util.make_tra
+0001a2b0: 6e73 6c61 7465 5f6d 6173 6b5f 746f 5f63  nslate_mask_to_c
+0001a2c0: 6861 7228 6f72 6967 2c20 7265 7029 0a20  har(orig, rep). 
+0001a2d0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0001a2e0: 2c20 6368 696c 645f 6469 7620 696e 2065  , child_div in e
+0001a2f0: 6e75 6d65 7261 7465 2864 6563 696d 616c  numerate(decimal
+0001a300: 5f64 6976 7329 3a0a 2020 2020 2020 2020  _divs):.        
+0001a310: 2020 2020 2020 2020 636c 732e 6372 6561          cls.crea
+0001a320: 7465 5f66 696c 656e 616d 655f 7265 6d6f  te_filename_remo
+0001a330: 7665 5f70 756e 6374 5f61 6e64 5f6f 7574  ve_punct_and_out
+0001a340: 7075 7428 6368 696c 645f 6469 762c 206f  put(child_div, o
+0001a350: 7574 7075 745f 6469 722c 2070 756e 6374  utput_dir, punct
+0001a360: 5f6d 6173 6b29 0a0a 2020 2020 2320 636c  _mask)..    # cl
+0001a370: 6173 7320 4874 6d6c 5472 6565 0a0a 2020  ass HtmlTree..  
+0001a380: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+0001a390: 2020 2064 6566 2063 7265 6174 655f 6669     def create_fi
+0001a3a0: 6c65 6e61 6d65 5f72 656d 6f76 655f 7075  lename_remove_pu
+0001a3b0: 6e63 745f 616e 645f 6f75 7470 7574 2863  nct_and_output(c
+0001a3c0: 6c73 2c20 6368 696c 645f 6469 762c 206f  ls, child_div, o
+0001a3d0: 7574 7075 745f 6469 722c 2070 756e 6374  utput_dir, punct
+0001a3e0: 5f6d 6173 6b29 3a0a 2020 2020 2020 2020  _mask):.        
+0001a3f0: 2222 226e 6f74 2073 7572 6520 7768 6174  """not sure what
+0001a400: 2074 6869 7320 646f 6573 203f 4874 6d6c   this does ?Html
+0001a410: 5574 696c 2e4d 4152 4b45 5220 2222 220a  Util.MARKER """.
+0001a420: 2020 2020 2020 2020 6966 2048 746d 6c55          if HtmlU
+0001a430: 7469 6c2e 4d41 524b 4552 2069 6e20 6368  til.MARKER in ch
+0001a440: 696c 645f 6469 762e 6174 7472 6962 3a0a  ild_div.attrib:.
+0001a450: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
+0001a460: 6572 203d 2063 6869 6c64 5f64 6976 2e61  er = child_div.a
+0001a470: 7474 7269 625b 4874 6d6c 5574 696c 2e4d  ttrib[HtmlUtil.M
+0001a480: 4152 4b45 525d 0a20 2020 2020 2020 2020  ARKER].         
+0001a490: 2020 206d 6172 6b65 7220 3d20 6d61 726b     marker = mark
+0001a4a0: 6572 2e73 7472 6970 2829 2e6c 6f77 6572  er.strip().lower
+0001a4b0: 2829 2020 2320 6e61 6d65 2066 726f 6d20  ()  # name from 
+0001a4c0: 7465 7874 2063 6f6e 7465 6e74 0a20 2020  text content.   
+0001a4d0: 2020 2020 2020 2020 206d 6172 6b65 722e           marker.
+0001a4e0: 7472 616e 736c 6174 6528 7075 6e63 745f  translate(punct_
+0001a4f0: 6d61 736b 290a 2020 2020 2020 2020 2020  mask).          
+0001a500: 2020 7061 7468 203d 2050 6174 6828 6f75    path = Path(ou
+0001a510: 7470 7574 5f64 6972 2c20 6622 7b6d 6172  tput_dir, f"{mar
+0001a520: 6b65 727d 2e68 746d 6c22 290a 2020 2020  ker}.html").    
+0001a530: 2020 2020 2020 2020 7769 7468 206f 7065          with ope
+0001a540: 6e28 7061 7468 2c20 2277 6222 2920 6173  n(path, "wb") as
+0001a550: 2066 3a0a 2020 2020 2020 2020 2020 2020   f:.            
+0001a560: 2020 2020 662e 7772 6974 6528 4554 2e74      f.write(ET.t
+0001a570: 6f73 7472 696e 6728 6368 696c 645f 6469  ostring(child_di
+0001a580: 762c 2070 7265 7474 795f 7072 696e 743d  v, pretty_print=
+0001a590: 5472 7565 2929 0a0a 2020 2020 2320 636c  True))..    # cl
+0001a5a0: 6173 7320 4874 6d6c 5472 6565 0a0a 2020  ass HtmlTree..  
+0001a5b0: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+0001a5c0: 2020 2064 6566 2067 6574 5f64 6976 5f73     def get_div_s
+0001a5d0: 7061 6e5f 7374 6172 7469 6e67 5f77 6974  pan_starting_wit
+0001a5e0: 6828 636c 732c 2065 6c65 6d2c 2073 7472  h(cls, elem, str
+0001a5f0: 672c 2069 735f 626f 6c64 3d46 616c 7365  g, is_bold=False
+0001a600: 2c20 666f 6e74 5f73 697a 655f 7261 6e67  , font_size_rang
+0001a610: 653d 4e6f 6e65 293a 0a20 2020 2020 2020  e=None):.       
+0001a620: 2072 6573 756c 7420 3d20 4e6f 6e65 0a20   result = None. 
+0001a630: 2020 2020 2020 2078 7061 7468 203d 2066         xpath = f
+0001a640: 222e 2f2f 6469 765b 7370 616e 5b73 7461  ".//div[span[sta
+0001a650: 7274 732d 7769 7468 282e 2c27 7b73 7472  rts-with(.,'{str
+0001a660: 677d 2729 5d5d 220a 2020 2020 2020 2020  g}')]]".        
+0001a670: 6469 7673 203d 2065 6c65 6d2e 7870 6174  divs = elem.xpat
+0001a680: 6828 7870 6174 6829 0a20 2020 2020 2020  h(xpath).       
+0001a690: 2069 6620 6c65 6e28 6469 7673 2920 3d3d   if len(divs) ==
+0001a6a0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0001a6b0: 6c6f 6767 696e 672e 7761 726e 696e 6728  logging.warning(
+0001a6c0: 6622 4e6f 2064 6976 7320 7769 7468 207b  f"No divs with {
+0001a6d0: 7374 7267 7d22 290a 2020 2020 2020 2020  strg}").        
+0001a6e0: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+0001a6f0: 742c 204e 6f6e 650a 2020 2020 2020 2020  t, None.        
+0001a700: 6e65 775f 6469 7673 203d 205b 5d0a 2020  new_divs = [].  
+0001a710: 2020 2020 2020 666f 7220 6469 7620 696e        for div in
+0001a720: 2064 6976 733a 0a20 2020 2020 2020 2020   divs:.         
+0001a730: 2020 2073 7061 6e73 203d 2064 6976 2e78     spans = div.x
+0001a740: 7061 7468 2822 2e2f 7370 616e 2229 0a20  path("./span"). 
+0001a750: 2020 2020 2020 2020 2020 2069 6620 7370             if sp
+0001a760: 616e 733a 0a20 2020 2020 2020 2020 2020  ans:.           
+0001a770: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
+0001a780: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
+0001a790: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
+0001a7a0: 6174 7472 6962 7574 655f 6f66 5f62 6f64  attribute_of_bod
+0001a7b0: 795f 656c 656d 656e 7428 7370 616e 735b  y_element(spans[
+0001a7c0: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
+0001a7d0: 2020 2020 6966 206e 6f74 2028 6973 5f62      if not (is_b
+0001a7e0: 6f6c 6420 616e 6420 6373 735f 7374 796c  old and css_styl
+0001a7f0: 652e 6973 5f62 6f6c 645f 6e61 6d65 2829  e.is_bold_name()
+0001a800: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001a810: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+0001a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a830: 6966 206e 6f74 2028 666f 6e74 5f73 697a  if not (font_siz
+0001a840: 655f 7261 6e67 6520 616e 6420 636c 732e  e_range and cls.
+0001a850: 696e 5f72 616e 6765 2863 7373 5f73 7479  in_range(css_sty
+0001a860: 6c65 2e66 6f6e 745f 7369 7a65 2c20 666f  le.font_size, fo
+0001a870: 6e74 5f73 697a 655f 7261 6e67 6529 293a  nt_size_range)):
+0001a880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001a890: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+0001a8a0: 2020 2020 2020 2020 2020 2020 2020 6e65                ne
+0001a8b0: 775f 6469 7673 2e61 7070 656e 6428 6469  w_divs.append(di
+0001a8c0: 7629 0a20 2020 2020 2020 2020 2020 2020  v).             
+0001a8d0: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
+0001a8e0: 6469 7673 203d 206e 6577 5f64 6976 730a  divs = new_divs.
+0001a8f0: 2020 2020 2020 2020 2320 616c 736f 2074          # also t
+0001a900: 6573 7420 666f 6e74 2068 6572 6520 4e59  est font here NY
+0001a910: 490a 2020 2020 2020 2020 6966 206c 656e  I.        if len
+0001a920: 2864 6976 7329 203d 3d20 303a 0a20 2020  (divs) == 0:.   
+0001a930: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
+0001a940: 2e77 6172 6e69 6e67 2866 2263 616e 6e6f  .warning(f"canno
+0001a950: 7420 6669 6e64 2064 6976 3a20 6c65 6e3d  t find div: len=
+0001a960: 7b6c 656e 2864 6976 7329 7d22 290a 2020  {len(divs)}").  
+0001a970: 2020 2020 2020 656c 6966 206c 656e 2864        elif len(d
+0001a980: 6976 7329 203e 2031 3a0a 2020 2020 2020  ivs) > 1:.      
+0001a990: 2020 2020 2020 6c6f 6767 696e 672e 7761        logging.wa
+0001a9a0: 726e 696e 6728 6622 746f 6f20 6d61 6e79  rning(f"too many
+0001a9b0: 2064 6976 733a 206c 656e 3d7b 6c65 6e28   divs: len={len(
+0001a9c0: 6469 7673 297d 2229 0a20 2020 2020 2020  divs)}").       
+0001a9d0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0001a9e0: 2020 2072 6573 756c 7420 3d20 6469 7673     result = divs
+0001a9f0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0001aa00: 7265 7375 6c74 2e61 7474 7269 625b 226d  result.attrib["m
+0001aa10: 6172 6b65 7222 5d20 3d20 7374 7267 0a20  arker"] = strg. 
+0001aa20: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0001aa30: 7375 6c74 2c20 6469 7673 0a0a 2020 2020  sult, divs..    
+0001aa40: 2320 636c 6173 7320 4874 6d6c 5472 6565  # class HtmlTree
+0001aa50: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+0001aa60: 6f64 0a20 2020 2064 6566 2067 6574 5f64  od.    def get_d
+0001aa70: 6976 5f73 7061 6e73 5f77 6974 685f 6465  iv_spans_with_de
+0001aa80: 6369 6d61 6c73 2863 6c73 2c20 656c 656d  cimals(cls, elem
+0001aa90: 2c20 6973 5f62 6f6c 643d 4e6f 6e65 2c20  , is_bold=None, 
+0001aaa0: 666f 6e74 5f73 697a 655f 7261 6e67 653d  font_size_range=
+0001aab0: 4e6f 6e65 2c20 636c 6173 735f 6469 6374  None, class_dict
+0001aac0: 3d4e 6f6e 652c 2073 6563 7469 6f6e 5f72  =None, section_r
+0001aad0: 6563 3d4e 6f6e 6529 3a0a 2020 2020 2020  ec=None):.      
+0001aae0: 2020 2222 224d 6174 6368 6573 2064 6976    """Matches div
+0001aaf0: 2f73 7061 6e20 7374 6172 7469 6e67 2077  /span starting w
+0001ab00: 6974 6820 6120 6465 6369 6d61 6c20 696e  ith a decimal in
+0001ab10: 6465 780a 2020 2020 2020 2020 642e 6420  dex.        d.d 
+0001ab20: 6f72 2064 2e64 2e64 0a20 2020 2020 2020  or d.d.d.       
+0001ab30: 2022 2222 0a20 2020 2020 2020 2072 6573   """.        res
+0001ab40: 756c 7420 3d20 4e6f 6e65 0a20 2020 2020  ult = None.     
+0001ab50: 2020 2023 2066 6972 7374 2061 6464 2061     # first add a
+0001ab60: 6c6c 206d 6174 6368 696e 6720 6e75 6d62  ll matching numb
+0001ab70: 6572 6564 2064 6976 7320 746f 2070 7265  ered divs to pre
+0001ab80: 5f63 6861 7073 6563 0a20 2020 2020 2020  _chapsec.       
+0001ab90: 2069 6620 6e6f 7420 636c 6173 735f 6469   if not class_di
+0001aba0: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
+0001abb0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+0001abc0: 2866 226d 6973 7369 6e67 2063 6c61 7373  (f"missing class
+0001abd0: 5f64 6963 7422 290a 2020 2020 2020 2020  _dict").        
+0001abe0: 746f 705f 6469 7620 3d20 4554 2e53 7562  top_div = ET.Sub
+0001abf0: 456c 656d 656e 7428 656c 656d 2c20 485f  Element(elem, H_
+0001ac00: 4449 5629 0a20 2020 2020 2020 2074 6f70  DIV).        top
+0001ac10: 5f64 6976 2e61 7474 7269 625b 636c 732e  _div.attrib[cls.
+0001ac20: 434c 4153 535d 203d 2063 6c61 7373 5f64  CLASS] = class_d
+0001ac30: 6963 742e 6765 7428 4874 6d6c 5472 6565  ict.get(HtmlTree
+0001ac40: 2e54 4f50 5f44 4956 290a 2020 2020 2020  .TOP_DIV).      
+0001ac50: 2020 7072 655f 6368 6170 7365 6320 3d20    pre_chapsec = 
+0001ac60: 4554 2e53 7562 456c 656d 656e 7428 746f  ET.SubElement(to
+0001ac70: 705f 6469 762c 2048 5f44 4956 290a 2020  p_div, H_DIV).  
+0001ac80: 2020 2020 2020 7072 655f 6368 6170 7365        pre_chapse
+0001ac90: 632e 6174 7472 6962 5b63 6c73 2e43 4c41  c.attrib[cls.CLA
+0001aca0: 5353 5d20 3d20 636c 6173 735f 6469 6374  SS] = class_dict
+0001acb0: 2e67 6574 2848 746d 6c54 7265 652e 4348  .get(HtmlTree.CH
+0001acc0: 4150 5345 4329 0a20 2020 2020 2020 2063  APSEC).        c
+0001acd0: 7572 7265 6e74 5f64 6976 203d 2070 7265  urrent_div = pre
+0001ace0: 5f63 6861 7073 6563 0a0a 2020 2020 2020  _chapsec..      
+0001acf0: 2020 2320 6974 6572 6174 6520 6f76 6572    # iterate over
+0001ad00: 2061 6c6c 2064 6976 732c 206f 6e6c 7920   all divs, only 
+0001ad10: 6170 7065 6e64 2074 686f 7365 2077 6974  append those wit
+0001ad20: 6820 6465 6369 6d61 6c0a 2020 2020 2020  h decimal.      
+0001ad30: 2020 6469 7673 203d 2065 6c65 6d2e 7870    divs = elem.xp
+0001ad40: 6174 6828 636c 732e 414c 4c5f 4449 565f  ath(cls.ALL_DIV_
+0001ad50: 5850 4154 4853 290a 2020 2020 2020 2020  XPATHS).        
+0001ad60: 6465 6369 6d61 6c5f 636f 756e 7420 3d20  decimal_count = 
+0001ad70: 300a 2020 2020 2020 2020 7465 7874 7320  0.        texts 
+0001ad80: 3d20 5b5d 2020 2320 6a75 7374 2061 2063  = []  # just a c
+0001ad90: 6865 636b 2061 7420 7072 6573 656e 740a  heck at present.
+0001ada0: 2020 2020 2020 2020 666f 7220 6469 7620          for div 
+0001adb0: 696e 2064 6976 733a 0a20 2020 2020 2020  in divs:.       
+0001adc0: 2020 2020 2073 7061 6e73 203d 2064 6976       spans = div
+0001add0: 2e78 7061 7468 2822 2e2f 7370 616e 2229  .xpath("./span")
+0001ade0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001adf0: 6e6f 7420 7370 616e 733a 0a20 2020 2020  not spans:.     
+0001ae00: 2020 2020 2020 2020 2020 2023 206e 6f20             # no 
+0001ae10: 7370 616e 732c 2063 6f6e 6361 7465 6e61  spans, concatena
+0001ae20: 7465 2077 6974 6820 7369 626c 696e 6773  te with siblings
+0001ae30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ae40: 2069 6620 6469 7620 3d3d 2063 7572 7265   if div == curre
+0001ae50: 6e74 5f64 6976 3a0a 2020 2020 2020 2020  nt_div:.        
+0001ae60: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0001ae70: 696e 672e 7761 726e 696e 6728 2266 2063  ing.warning("f c
+0001ae80: 616e 6e6f 7420 6170 7065 6e64 2064 6976  annot append div
+0001ae90: 207b 6469 767d 2074 6f20 6974 7365 6c66   {div} to itself
+0001aea0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001aeb0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0001aec0: 2020 2020 2020 2020 2020 2020 2074 7279               try
+0001aed0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001aee0: 2020 2020 2020 2020 2020 6375 7272 656e            curren
+0001aef0: 745f 6469 762e 6170 7065 6e64 2864 6976  t_div.append(div
+0001af00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001af10: 2020 2020 2020 6578 6365 7074 2056 616c        except Val
+0001af20: 7565 4572 726f 7220 6173 2076 653a 0a20  ueError as ve:. 
+0001af30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af40: 2020 2020 2020 206c 6f67 6769 6e67 2e65         logging.e
+0001af50: 7272 6f72 2866 2245 7272 6f72 207b 7665  rror(f"Error {ve
+0001af60: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001af70: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001af80: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+0001af90: 7265 6e74 5f64 6976 2e61 7070 656e 6428  rent_div.append(
+0001afa0: 6469 7629 0a20 2020 2020 2020 2020 2020  div).           
+0001afb0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+0001afc0: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+0001afd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001afe0: 6c6f 6767 696e 672e 6572 726f 7228 6622  logging.error(f"
+0001aff0: 4255 4720 736b 6970 7065 6422 290a 2020  BUG skipped").  
+0001b000: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001b010: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+0001b020: 2020 2063 7373 5f73 7479 6c65 203d 2043     css_style = C
+0001b030: 5353 5374 796c 652e 6372 6561 7465 5f63  SSStyle.create_c
+0001b040: 7373 5f73 7479 6c65 5f66 726f 6d5f 6174  ss_style_from_at
+0001b050: 7472 6962 7574 655f 6f66 5f62 6f64 795f  tribute_of_body_
+0001b060: 656c 656d 656e 7428 7370 616e 735b 305d  element(spans[0]
+0001b070: 2920 2023 206e 6f72 6d61 6c6c 7920 636f  )  # normally co
+0001b080: 6d65 7320 6669 7273 740a 2020 2020 2020  mes first.      
+0001b090: 2020 2020 2020 2320 6368 6563 6b20 7765        # check we
+0001b0a0: 6967 6874 2c20 6966 206e 6f6e 6520 6170  ight, if none ap
+0001b0b0: 7065 6e64 2074 6f20 7369 626c 696e 6773  pend to siblings
+0001b0c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001b0d0: 6e6f 7420 2869 735f 626f 6c64 2061 6e64  not (is_bold and
+0001b0e0: 2063 7373 5f73 7479 6c65 2e69 735f 626f   css_style.is_bo
+0001b0f0: 6c64 5f6e 616d 6528 2929 3a0a 2020 2020  ld_name()):.    
+0001b100: 2020 2020 2020 2020 2020 2020 6375 7272              curr
+0001b110: 656e 745f 6469 762e 6170 7065 6e64 2864  ent_div.append(d
+0001b120: 6976 290a 2020 2020 2020 2020 2020 2020  iv).            
+0001b130: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+0001b140: 2020 2020 2020 2020 2023 2063 6865 636b           # check
+0001b150: 2066 6f6e 742d 7369 7a65 2c20 6966 206e   font-size, if n
+0001b160: 6f6e 6520 6170 7065 6e64 2074 6f20 7369  one append to si
+0001b170: 626c 696e 6773 0a20 2020 2020 2020 2020  blings.         
+0001b180: 2020 2069 6620 6e6f 7420 2866 6f6e 745f     if not (font_
+0001b190: 7369 7a65 5f72 616e 6765 2061 6e64 2063  size_range and c
+0001b1a0: 6c73 2e69 6e5f 7261 6e67 6528 6373 735f  ls.in_range(css_
+0001b1b0: 7374 796c 652e 666f 6e74 5f73 697a 652c  style.font_size,
+0001b1c0: 2066 6f6e 745f 7369 7a65 5f72 616e 6765   font_size_range
+0001b1d0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0001b1e0: 2020 2020 6375 7272 656e 745f 6469 762e      current_div.
+0001b1f0: 6170 7065 6e64 2864 6976 290a 2020 2020  append(div).    
+0001b200: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0001b210: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+0001b220: 2023 2073 7061 6e20 636f 6e74 656e 740a   # span content.
+0001b230: 2020 2020 2020 2020 2020 2020 7465 7874              text
+0001b240: 203d 2048 746d 6c55 7469 6c2e 6765 745f   = HtmlUtil.get_
+0001b250: 7465 7874 5f63 6f6e 7465 6e74 2873 7061  text_content(spa
+0001b260: 6e73 5b30 5d29 0a20 2020 2020 2020 2020  ns[0]).         
+0001b270: 2020 206d 6174 6368 6564 203d 2046 616c     matched = Fal
+0001b280: 7365 0a20 2020 2020 2020 2020 2020 2069  se.            i
+0001b290: 6620 7365 6374 696f 6e5f 7265 632e 6d61  f section_rec.ma
+0001b2a0: 7463 6828 7465 7874 293a 0a20 2020 2020  tch(text):.     
+0001b2b0: 2020 2020 2020 2020 2020 2074 6f70 5f64             top_d
+0001b2c0: 6976 2e61 7070 656e 6428 6375 7272 656e  iv.append(curren
+0001b2d0: 745f 6469 7629 0a20 2020 2020 2020 2020  t_div).         
+0001b2e0: 2020 2020 2020 2074 6578 7473 2e61 7070         texts.app
+0001b2f0: 656e 6428 7465 7874 290a 2020 2020 2020  end(text).      
+0001b300: 2020 2020 2020 2020 2020 6469 762e 6174            div.at
+0001b310: 7472 6962 5b48 746d 6c55 7469 6c2e 4d41  trib[HtmlUtil.MA
+0001b320: 524b 4552 5d20 3d20 7465 7874 0a20 2020  RKER] = text.   
+0001b330: 2020 2020 2020 2020 2020 2020 2063 7572               cur
+0001b340: 7265 6e74 5f64 6976 203d 2064 6976 0a20  rent_div = div. 
+0001b350: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0001b360: 6563 696d 616c 5f63 6f75 6e74 202b 3d20  ecimal_count += 
+0001b370: 310a 2020 2020 2020 2020 2020 2020 656c  1.            el
+0001b380: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001b390: 2020 2020 6375 7272 656e 745f 6469 762e      current_div.
+0001b3a0: 6170 7065 6e64 2864 6976 290a 2020 2020  append(div).    
+0001b3b0: 2020 2020 7265 7475 726e 2074 6f70 5f64      return top_d
+0001b3c0: 6976 0a0a 2020 2020 2320 636c 6173 7320  iv..    # class 
+0001b3d0: 4874 6d6c 5472 6565 0a0a 2020 2020 4063  HtmlTree..    @c
+0001b3e0: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+0001b3f0: 6566 2069 6e5f 7261 6e67 6528 636c 732c  ef in_range(cls,
+0001b400: 206e 756d 2c20 6e75 6d5f 7261 6e67 6529   num, num_range)
+0001b410: 3a0a 2020 2020 2020 2020 2222 2269 7320  :.        """is 
+0001b420: 6120 6e75 6d62 6572 2069 6e20 6120 6e75  a number in a nu
+0001b430: 6d65 7269 6320 7261 6e67 6522 2222 0a20  meric range""". 
+0001b440: 2020 2020 2020 2061 7373 6572 7420 6e75         assert nu
+0001b450: 6d5f 7261 6e67 6520 6f72 206c 656e 286e  m_range or len(n
+0001b460: 756d 5f72 616e 6765 2920 3d3d 2032 2c20  um_range) == 2, 
+0001b470: 6622 7261 6e67 6520 6d75 7374 2068 6176  f"range must hav
+0001b480: 6520 3220 656c 656d 656e 7473 220a 2020  e 2 elements".  
+0001b490: 2020 2020 2020 6173 7365 7274 206e 756d        assert num
+0001b4a0: 5f72 616e 6765 5b30 5d20 3c3d 206e 756d  _range[0] <= num
+0001b4b0: 5f72 616e 6765 5b31 5d2c 2066 2266 6f6e  _range[1], f"fon
+0001b4c0: 745f 7369 7a65 5f72 616e 6765 206d 7573  t_size_range mus
+0001b4d0: 7420 6265 2028 6c6f 7765 722c 6869 6768  t be (lower,high
+0001b4e0: 6572 2922 0a20 2020 2020 2020 2061 7373  er)".        ass
+0001b4f0: 6572 7420 666c 6f61 7428 6e75 6d5f 7261  ert float(num_ra
+0001b500: 6e67 655b 305d 290a 2020 2020 2020 2020  nge[0]).        
+0001b510: 7265 7375 6c74 203d 206e 756d 5f72 616e  result = num_ran
+0001b520: 6765 5b30 5d20 3c3d 206e 756d 203c 3d20  ge[0] <= num <= 
+0001b530: 6e75 6d5f 7261 6e67 655b 315d 0a20 2020  num_range[1].   
+0001b540: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
+0001b550: 6c74 0a0a 2020 2020 2320 636c 6173 7320  lt..    # class 
+0001b560: 4874 6d6c 5472 6565 0a0a 2020 2020 4063  HtmlTree..    @c
+0001b570: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+0001b580: 6566 2067 6574 5f64 6563 696d 616c 5f73  ef get_decimal_s
+0001b590: 6563 7469 6f6e 7328 636c 732c 2068 746d  ections(cls, htm
+0001b5a0: 6c5f 656c 656d 2c20 7870 6174 683d 4e6f  l_elem, xpath=No
+0001b5b0: 6e65 2c20 7265 6765 783d 4e6f 6e65 293a  ne, regex=None):
+0001b5c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001b5d0: 2020 2020 2067 6574 7320 6465 6369 6d61       gets decima
+0001b5e0: 6c20 7365 6374 696f 6e73 2069 6e20 656c  l sections in el
+0001b5f0: 656d 7320 6f66 2066 6f72 6d20 312e 322c  ems of form 1.2,
+0001b600: 2065 7463 0a20 2020 2020 2020 203a 7061   etc.        :pa
+0001b610: 7261 6d20 6874 6d6c 5f65 6c65 6d3a 2065  ram html_elem: e
+0001b620: 6c65 6d65 6e74 2074 6f20 7365 6172 6368  lement to search
+0001b630: 2066 6f72 2073 6563 7469 6f6e 730a 2020   for sections.  
+0001b640: 2020 2020 2020 3a70 6172 616d 2078 7061        :param xpa
+0001b650: 7468 3a20 7365 6374 696e 7320 6d61 7920  th: sectins may 
+0001b660: 6861 7665 2062 6565 6e20 6c61 6265 6c6c  have been labell
+0001b670: 6564 2077 6974 6820 4063 6c61 7373 206f  ed with @class o
+0001b680: 7220 7369 6d69 6c61 720a 2020 2020 2020  r similar.      
+0001b690: 2020 3a70 6172 616d 2072 6567 6578 3a20    :param regex: 
+0001b6a0: 7365 6374 696f 6e73 206d 6179 2062 6520  sections may be 
+0001b6b0: 6469 7363 6f76 6572 6162 6c65 2062 7920  discoverable by 
+0001b6c0: 7265 6765 782b 636f 6e74 656e 740a 2020  regex+content.  
+0001b6d0: 2020 2020 2020 3a72 6574 7572 6e3a 206c        :return: l
+0001b6e0: 6973 7420 6f66 2073 6563 7469 6f6e 7320  ist of sections 
+0001b6f0: 286d 6179 2062 6520 656d 7074 7929 206f  (may be empty) o
+0001b700: 7220 4e6f 6e65 0a20 2020 2020 2020 2049  r None.        I
+0001b710: 7420 6973 206c 696b 656c 7920 7468 6174  t is likely that
+0001b720: 2061 2063 6f6d 6269 6e61 7469 6f6e 206f   a combination o
+0001b730: 6620 7870 6174 6820 616e 6420 7265 6765  f xpath and rege
+0001b740: 7820 7769 6c6c 2062 6520 7573 6564 2061  x will be used a
+0001b750: 7320 7870 6174 680a 2020 2020 2020 2020  s xpath.        
+0001b760: 6d61 7920 6e6f 7420 6861 7665 2072 6567  may not have reg
+0001b770: 6578 0a20 2020 2020 2020 2022 2222 0a20  ex.        """. 
+0001b780: 2020 2020 2020 2069 6620 6874 6d6c 5f65         if html_e
+0001b790: 6c65 6d20 6973 204e 6f6e 653a 0a20 2020  lem is None:.   
+0001b7a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001b7b0: 4e6f 6e65 0a20 2020 2020 2020 2073 6563  None.        sec
+0001b7c0: 7469 6f6e 7320 3d20 5b5d 0a20 2020 2020  tions = [].     
+0001b7d0: 2020 2069 6620 7870 6174 683a 0a20 2020     if xpath:.   
+0001b7e0: 2020 2020 2020 2020 2073 6563 7469 6f6e           section
+0001b7f0: 7320 3d20 6874 6d6c 5f65 6c65 6d2e 7870  s = html_elem.xp
+0001b800: 6174 6828 7870 6174 6829 0a20 2020 2020  ath(xpath).     
+0001b810: 2020 2069 6620 7265 6765 783a 0a20 2020     if regex:.   
+0001b820: 2020 2020 2020 2020 206c 6f67 6769 6e67           logging
+0001b830: 2e77 6172 6e69 6e67 2866 2272 6567 6578  .warning(f"regex
+0001b840: 206e 6f74 2079 6574 2064 6576 656c 6f70   not yet develop
+0001b850: 6564 2066 6f72 2073 6563 7469 6f6e 7322  ed for sections"
+0001b860: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001b870: 2073 6563 7469 6f6e 730a 0a0a 5245 4353   sections...RECS
+0001b880: 5f42 595f 5345 4354 494f 4e20 3d20 7b0a  _BY_SECTION = {.
+0001b890: 2020 2020 2320 4874 6d6c 5472 6565 2e43      # HtmlTree.C
+0001b8a0: 4841 505f 544f 503a 2049 5043 435f 4348  HAP_TOP: IPCC_CH
+0001b8b0: 4150 5f54 4f50 5f52 4543 2c20 2320 7368  AP_TOP_REC, # sh
+0001b8c0: 6f75 6c64 2062 6520 696e 6a65 6374 6564  ould be injected
+0001b8d0: 2062 7920 7573 6572 0a20 2020 2048 746d   by user.    Htm
+0001b8e0: 6c54 7265 652e 4348 4150 5f54 4f50 3a20  lTree.CHAP_TOP: 
+0001b8f0: 4348 4150 5f54 4f50 5f52 4543 2c20 2320  CHAP_TOP_REC, # 
+0001b900: 7368 6f75 6c64 2062 6520 696e 6a65 6374  should be inject
+0001b910: 6564 2062 7920 7573 6572 0a20 2020 2048  ed by user.    H
+0001b920: 746d 6c54 7265 652e 4348 4150 5f53 4543  tmlTree.CHAP_SEC
+0001b930: 5449 4f4e 533a 2053 4543 5449 4f4e 535f  TIONS: SECTIONS_
+0001b940: 4445 4349 4d41 4c5f 5245 432c 0a20 2020  DECIMAL_REC,.   
+0001b950: 2048 746d 6c54 7265 652e 4348 4150 5f53   HtmlTree.CHAP_S
+0001b960: 5542 5345 4354 533a 2053 5542 5345 4354  UBSECTS: SUBSECT
+0001b970: 535f 4445 4349 4d41 4c5f 5245 432c 0a7d  S_DECIMAL_REC,.}
+0001b980: 0a0a 0a63 6c61 7373 2048 544d 4c53 6561  ...class HTMLSea
+0001b990: 7263 6865 723a 0a20 2020 2022 2222 0a20  rcher:.    """. 
+0001b9a0: 2020 2049 2074 6869 6e6b 2074 6869 7320     I think this 
+0001b9b0: 6475 706c 6963 6174 6573 2073 6f6d 6520  duplicates some 
+0001b9c0: 6f66 204e 6f64 6545 7874 7261 6374 6f72  of NodeExtractor
+0001b9d0: 2e0a 2020 2020 2222 220a 2020 2020 2222  ..    """.    ""
+0001b9e0: 220a 2020 2020 6d65 7468 6f64 7320 666f  ".    methods fo
+0001b9f0: 7220 6669 6e64 696e 6720 6368 756e 6b73  r finding chunks
+0001ba00: 2061 6e64 2073 7472 696e 6773 2069 6e20   and strings in 
+0001ba10: 4854 4d4c 2065 6c65 6d65 6e74 730a 0a20  HTML elements.. 
+0001ba20: 2020 2045 7861 6d70 6c65 2074 6578 743a     Example text:
+0001ba30: 0a20 2020 203c 7370 616e 3e6f 6273 6572  .    <span>obser
+0001ba40: 7665 6420 696e 6372 6561 7365 7320 696e  ved increases in
+0001ba50: 2074 6865 206d 6f73 7420 7265 6365 6e74   the most recent
+0001ba60: 2079 6561 7273 2028 4d69 6e78 2065 7420   years (Minx et 
+0001ba70: 616c 2e2c 2032 3032 313b 2055 4e45 502c  al., 2021; UNEP,
+0001ba80: 2032 3032 3061 292e 0a20 2020 2032 3031   2020a)..    201
+0001ba90: 3920 4748 4720 656d 6973 7369 6f6e 7320  9 GHG emissions 
+0001baa0: 6c65 7665 6c73 2077 6572 6520 6869 6768  levels were high
+0001bab0: 6572 2063 6f6d 7061 7265 6420 746f 2031  er compared to 1
+0001bac0: 3020 616e 6420 3330 2079 6561 7273 2061  0 and 30 years a
+0001bad0: 676f 2028 6869 6768 2063 6f6e 6669 6465  go (high confide
+0001bae0: 6e63 6529 3a20 6162 6f75 7420 3132 2520  nce): about 12% 
+0001baf0: 2836 2e35 2047 7443 4f32 6571 290a 2020  (6.5 GtCO2eq).  
+0001bb00: 2020 6869 6768 6572 2074 6861 6e20 696e    higher than in
+0001bb10: 2032 3031 3020 2835 33c2 b135 2e37 2047   2010 (53..5.7 G
+0001bb20: 7443 4f32 6571 2920 2841 5235 2072 6566  tCO2eq) (AR5 ref
+0001bb30: 6572 656e 6365 2079 6561 7229 2061 6e64  erence year) and
+0001bb40: 2061 626f 7574 2035 3425 2028 3231 2047   about 54% (21 G
+0001bb50: 7443 4f32 6571 2920 6869 6768 6572 2074  tCO2eq) higher t
+0001bb60: 6861 6e20 696e 2031 3939 300a 2020 2020  han in 1990.    
+0001bb70: 2833 38c2 b134 2e38 2047 7443 4f32 6571  (38..4.8 GtCO2eq
+0001bb80: 2920 284b 796f 746f 2050 726f 746f 636f  ) (Kyoto Protoco
+0001bb90: 6c20 7265 6665 7265 6e63 6520 7965 6172  l reference year
+0001bba0: 2061 6e64 2066 7265 7175 656e 7420 4e44   and frequent ND
+0001bbb0: 4320 7265 6665 7265 6e63 6529 3c2f 7370  C reference)</sp
+0001bbc0: 616e 3e0a 2020 2020 2222 220a 2020 2020  an>.    """.    
+0001bbd0: 2222 220a 2020 2020 2222 220a 0a20 2020  """.    """..   
+0001bbe0: 2023 2066 6f72 2074 6578 7420 7365 6172   # for text sear
+0001bbf0: 6368 0a20 2020 2044 4546 4155 4c54 5f58  ch.    DEFAULT_X
+0001bc00: 5041 5448 203d 2022 2f2f 7465 7874 2829  PATH = "//text()
+0001bc10: 220a 2020 2020 4348 554e 4b5f 5245 203d  ".    CHUNK_RE =
+0001bc20: 2022 6368 756e 6b5f 7265 2220 2023 2066   "chunk_re"  # f
+0001bc30: 696e 6473 2074 6578 7420 6368 756e 6b73  inds text chunks
+0001bc40: 2069 6e20 7465 7874 0a20 2020 2053 504c   in text.    SPL
+0001bc50: 4954 5445 525f 5245 203d 2022 7370 6c69  ITTER_RE = "spli
+0001bc60: 7474 6572 5f72 6522 2020 2320 7370 6c69  tter_re"  # spli
+0001bc70: 7473 2074 686f 7365 2063 6875 6e6b 7320  ts those chunks 
+0001bc80: 2865 2c67 2c20 636f 6d6d 612d 7365 7061  (e,g, comma-sepa
+0001bc90: 7261 7465 6420 6c69 7374 730a 2020 2020  rated lists.    
+0001bca0: 5355 424e 4f44 455f 5245 203d 2022 7375  SUBNODE_RE = "su
+0001bcb0: 625f 6e6f 6465 5f72 655f 6c69 7374 2220  b_node_re_list" 
+0001bcc0: 2023 206d 6174 6368 6573 2074 6865 2063   # matches the c
+0001bcd0: 6f6d 706f 6e65 6e74 7320 6f66 2074 6865  omponents of the
+0001bce0: 2073 706c 6974 206c 6973 7473 0a20 2020   split lists.   
+0001bcf0: 2055 4e4d 4154 4348 4544 203d 2022 756e   UNMATCHED = "un
+0001bd00: 6d61 7463 6865 6422 2020 2320 6164 6473  matched"  # adds
+0001bd10: 2075 6e6d 6174 6368 6564 206e 6f64 6573   unmatched nodes
+0001bd20: 0a20 2020 2058 5041 5448 203d 2022 7870  .    XPATH = "xp
+0001bd30: 6174 6822 0a0a 2020 2020 6465 6620 5f5f  ath"..    def __
+0001bd40: 696e 6974 5f5f 2873 656c 662c 2078 7061  init__(self, xpa
+0001bd50: 7468 5f64 6963 743d 4e6f 6e65 2c20 6469  th_dict=None, di
+0001bd60: 6374 783d 4e6f 6e65 293a 0a20 2020 2020  ctx=None):.     
+0001bd70: 2020 2073 656c 662e 6368 756e 6b5f 6e6f     self.chunk_no
+0001bd80: 6465 5f64 6963 7420 3d20 6469 6374 2829  de_dict = dict()
+0001bd90: 0a20 2020 2020 2020 2073 656c 662e 7870  .        self.xp
+0001bda0: 6174 685f 6469 6374 203d 2064 6963 7428  ath_dict = dict(
+0001bdb0: 2920 6966 2078 7061 7468 5f64 6963 7420  ) if xpath_dict 
+0001bdc0: 6973 204e 6f6e 6520 656c 7365 2063 6f70  is None else cop
+0001bdd0: 792e 6465 6570 636f 7079 2878 7061 7468  y.deepcopy(xpath
+0001bde0: 5f64 6963 7429 0a20 2020 2020 2020 2073  _dict).        s
+0001bdf0: 656c 662e 6368 756e 6b5f 6469 6374 203d  elf.chunk_dict =
+0001be00: 2064 6963 7428 290a 2020 2020 2020 2020   dict().        
+0001be10: 7365 6c66 2e73 706c 6974 7465 725f 6469  self.splitter_di
+0001be20: 6374 203d 2064 6963 7428 290a 2020 2020  ct = dict().    
+0001be30: 2020 2020 7365 6c66 2e73 7562 6e6f 6465      self.subnode
+0001be40: 5f64 6963 7420 3d20 6469 6374 2829 0a20  _dict = dict(). 
+0001be50: 2020 2020 2020 2073 656c 662e 6469 6374         self.dict
+0001be60: 7820 3d20 6469 6374 2829 2069 6620 6469  x = dict() if di
+0001be70: 6374 7820 6973 204e 6f6e 6520 656c 7365  ctx is None else
+0001be80: 2063 6f70 792e 6465 6570 636f 7079 2864   copy.deepcopy(d
+0001be90: 6963 7478 290a 0a20 2020 2064 6566 2073  ictx)..    def s
+0001bea0: 6561 7263 685f 7061 7468 5f63 6875 6e6b  earch_path_chunk
+0001beb0: 5f6e 6f64 6528 7365 6c66 2c20 6874 6d6c  _node(self, html
+0001bec0: 5f70 6174 6829 3a0a 2020 2020 2020 2020  _path):.        
+0001bed0: 6173 7365 7274 2068 746d 6c5f 7061 7468  assert html_path
+0001bee0: 2e65 7869 7374 7328 292c 2066 227b 6874  .exists(), f"{ht
+0001bef0: 6d6c 5f70 6174 687d 2073 686f 756c 6420  ml_path} should 
+0001bf00: 6578 6973 7422 0a20 2020 2020 2020 2074  exist".        t
+0001bf10: 7265 6520 3d20 4554 2e70 6172 7365 2873  ree = ET.parse(s
+0001bf20: 7472 2868 746d 6c5f 7061 7468 2929 0a0a  tr(html_path))..
+0001bf30: 2020 2020 2020 2020 7365 6c66 2e78 7061          self.xpa
+0001bf40: 7468 7320 3d20 7365 6c66 2e78 7061 7468  ths = self.xpath
+0001bf50: 5f64 6963 742e 6765 7428 7365 6c66 2e58  _dict.get(self.X
+0001bf60: 5041 5448 290a 2020 2020 2020 2020 6966  PATH).        if
+0001bf70: 206e 6f74 2073 656c 662e 7870 6174 6873   not self.xpaths
+0001bf80: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001bf90: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
+0001bfa0: 2245 5252 4f52 206d 7573 7420 6769 7665  "ERROR must give
+0001bfb0: 2078 7061 7468 2229 0a20 2020 2020 2020   xpath").       
+0001bfc0: 2066 6f72 2078 7061 7468 2069 6e20 7365   for xpath in se
+0001bfd0: 6c66 2e78 7061 7468 733a 0a20 2020 2020  lf.xpaths:.     
+0001bfe0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0001bff0: 2020 2020 2020 2020 2020 2020 6d61 7463              matc
+0001c000: 685f 656c 656d 656e 7473 203d 2074 7265  h_elements = tre
+0001c010: 652e 7870 6174 6828 7870 6174 6829 0a20  e.xpath(xpath). 
+0001c020: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0001c030: 7420 4578 6365 7074 696f 6e20 6173 2065  t Exception as e
+0001c040: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c050: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0001c060: 6f72 2866 2245 5252 4f52 2078 7061 7468  or(f"ERROR xpath
+0001c070: 207b 7870 6174 687d 207b 657d 2229 0a0a   {xpath} {e}")..
+0001c080: 2020 2020 2020 2020 7365 6c66 2e65 6c65          self.ele
+0001c090: 6d65 6e74 5f6c 6973 7420 3d20 6c69 7374  ment_list = list
+0001c0a0: 2829 0a20 2020 2020 2020 2066 6f72 2078  ().        for x
+0001c0b0: 7061 7468 2069 6e20 7365 6c66 2e78 7061  path in self.xpa
+0001c0c0: 7468 733a 0a20 2020 2020 2020 2020 2020  ths:.           
+0001c0d0: 206d 6174 6368 5f65 6c65 6d65 6e74 7320   match_elements 
+0001c0e0: 3d20 7472 6565 2e78 7061 7468 2878 7061  = tree.xpath(xpa
+0001c0f0: 7468 290a 2020 2020 2020 2020 2020 2020  th).            
+0001c100: 666f 7220 6d61 7463 685f 656c 656d 656e  for match_elemen
+0001c110: 7420 696e 206d 6174 6368 5f65 6c65 6d65  t in match_eleme
+0001c120: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+0001c130: 2020 2020 2074 203d 2074 7970 6528 6d61       t = type(ma
+0001c140: 7463 685f 656c 656d 656e 7429 0a20 2020  tch_element).   
+0001c150: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001c160: 7420 6973 206e 6f74 205f 456c 656d 656e  t is not _Elemen
+0001c170: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+0001c180: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0001c190: 7565 4572 726f 7228 6622 6e6f 7420 616e  ueError(f"not an
+0001c1a0: 2065 6c65 6d65 6e74 207b 747d 207b 6d61   element {t} {ma
+0001c1b0: 7463 685f 656c 656d 656e 747d 2229 0a20  tch_element}"). 
+0001c1c0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001c1d0: 656c 662e 656c 656d 656e 745f 6c69 7374  elf.element_list
+0001c1e0: 2e61 7070 656e 6428 6d61 7463 685f 656c  .append(match_el
+0001c1f0: 656d 656e 7429 0a0a 2020 2020 2020 2020  ement)..        
+0001c200: 666f 7220 656c 656d 656e 7420 696e 2073  for element in s
+0001c210: 656c 662e 656c 656d 656e 745f 6c69 7374  elf.element_list
+0001c220: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+0001c230: 7220 7465 7874 2069 6e20 656c 656d 656e  r text in elemen
+0001c240: 742e 7870 6174 6828 222e 2f74 6578 7428  t.xpath("./text(
+0001c250: 2922 293a 0a20 2020 2020 2020 2020 2020  )"):.           
+0001c260: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0001c270: 2020 2020 2020 2020 2020 2320 6e6f 6465            # node
+0001c280: 7374 7220 3d20 7365 6c66 2e73 656c 6563  str = self.selec
+0001c290: 745f 6368 756e 6b73 5f73 7562 6368 756e  t_chunks_subchun
+0001c2a0: 6b73 5f6e 6f64 6573 2874 6578 7429 0a0a  ks_nodes(text)..
+0001c2b0: 2020 2020 6465 6620 7365 6c65 6374 5f63      def select_c
+0001c2c0: 6875 6e6b 735f 7375 6263 6875 6e6b 735f  hunks_subchunks_
+0001c2d0: 6e6f 6465 7328 7365 6c66 2c20 7465 7874  nodes(self, text
+0001c2e0: 2c20 7370 6c69 7474 6572 5f72 653d 4e6f  , splitter_re=No
+0001c2f0: 6e65 2c20 6e6f 6465 5f72 653d 4e6f 6e65  ne, node_re=None
+0001c300: 293a 0a20 2020 2020 2020 2023 2063 6875  ):.        # chu
+0001c310: 6e6b 5f72 652c 2073 706c 6974 7465 725f  nk_re, splitter_
+0001c320: 7265 2c20 6e6f 6465 5f72 655f 6c69 6174  re, node_re_liat
+0001c330: 2c20 6164 645f 756e 6d61 7463 6865 6420  , add_unmatched 
+0001c340: 3d20 4661 6c73 6529 3a0a 2020 2020 2020  = False):.      
+0001c350: 2020 2222 220a 2020 2020 2020 2020 4d6f    """.        Mo
+0001c360: 7665 2074 6f20 6120 636c 6173 7320 616e  ve to a class an
+0001c370: 6420 7265 6661 6374 6f72 2074 6f20 7573  d refactor to us
+0001c380: 6520 6469 6374 696f 6e61 7279 0a20 2020  e dictionary.   
+0001c390: 2020 2020 204e 4f54 2059 4554 2055 5345       NOT YET USE
+0001c3a0: 440a 2020 2020 2020 2020 3a70 6172 616d  D.        :param
+0001c3b0: 2073 706c 6974 7465 725f 7265 3a20 7265   splitter_re: re
+0001c3c0: 6765 7820 666f 7220 7370 6c69 7474 696e  gex for splittin
+0001c3d0: 6720 736d 616c 6c65 7220 6368 756e 6b73  g smaller chunks
+0001c3e0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001c3f0: 6e6f 6465 5f72 653a 2072 6567 6578 2074  node_re: regex t
+0001c400: 6f20 6669 6e64 2068 7970 6572 6e6f 6465  o find hypernode
+0001c410: 730a 2020 2020 2020 2020 2222 220a 0a20  s.        """.. 
+0001c420: 2020 2020 2020 2063 6875 6e6b 5f72 6573         chunk_res
+0001c430: 203d 2073 656c 662e 6368 756e 6b5f 6469   = self.chunk_di
+0001c440: 6374 2e67 6574 2873 656c 662e 4348 554e  ct.get(self.CHUN
+0001c450: 4b5f 5245 290a 2020 2020 2020 2020 7370  K_RE).        sp
+0001c460: 6c69 7474 6572 5f72 6573 203d 2073 656c  litter_res = sel
+0001c470: 662e 7370 6c69 7474 6572 5f64 6963 742e  f.splitter_dict.
+0001c480: 6765 7428 7365 6c66 2e53 504c 4954 5445  get(self.SPLITTE
+0001c490: 525f 5245 290a 2020 2020 2020 2020 6e6f  R_RE).        no
+0001c4a0: 6465 5f72 6573 203d 2073 656c 662e 6368  de_res = self.ch
+0001c4b0: 756e 6b5f 6e6f 6465 5f64 6963 742e 6765  unk_node_dict.ge
+0001c4c0: 7428 7365 6c66 2e53 5542 4e4f 4445 5f52  t(self.SUBNODE_R
+0001c4d0: 4529 0a0a 2020 2020 2020 2020 6164 645f  E)..        add_
+0001c4e0: 756e 6d61 7463 6865 6420 3d20 7365 6c66  unmatched = self
+0001c4f0: 2e63 6875 6e6b 5f6e 6f64 655f 6469 6374  .chunk_node_dict
+0001c500: 2e67 6574 2873 656c 662e 554e 4d41 5443  .get(self.UNMATC
+0001c510: 4845 4429 0a20 2020 2020 2020 2070 7472  HED).        ptr
+0001c520: 203d 2030 0a20 2020 2020 2020 2077 6869   = 0.        whi
+0001c530: 6c65 2054 7275 653a 0a20 2020 2020 2020  le True:.       
+0001c540: 2020 2020 2066 6f72 2063 6875 6e6b 5f72       for chunk_r
+0001c550: 6520 696e 2063 6875 6e6b 5f72 6573 3a0a  e in chunk_res:.
+0001c560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c570: 6d61 7463 6820 3d20 7265 2e73 6561 7263  match = re.searc
+0001c580: 6828 6368 756e 6b5f 7265 2c20 7465 7874  h(chunk_re, text
+0001c590: 5b70 7472 3a5d 290a 2020 2020 2020 2020  [ptr:]).        
+0001c5a0: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
+0001c5b0: 6174 6368 3a0a 2020 2020 2020 2020 2020  atch:.          
+0001c5c0: 2020 2020 2020 2020 2020 6272 6561 6b0a            break.
+0001c5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c5e0: 7074 7220 2b3d 206d 6174 6368 2e73 7061  ptr += match.spa
+0001c5f0: 6e28 295b 315d 0a20 2020 2020 2020 2020  n()[1].         
+0001c600: 2020 2020 2020 206e 6f64 6573 7472 203d         nodestr =
+0001c610: 206d 6174 6368 2e67 726f 7570 2831 290a   match.group(1).
+0001c620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c630: 206e 6f64 6573 203d 2072 652e 7370 6c69   nodes = re.spli
+0001c640: 7428 7370 6c69 7474 6572 5f72 652c 206e  t(splitter_re, n
+0001c650: 6f64 6573 7472 290a 2020 2020 2020 2020  odestr).        
+0001c660: 2020 2020 2020 2020 6e6f 6465 5f64 6963          node_dic
+0001c670: 7420 3d20 6465 6661 756c 7464 6963 7428  t = defaultdict(
+0001c680: 6c69 7374 290a 2020 2020 2020 2020 2020  list).          
+0001c690: 2020 2020 2020 666f 7220 6e6f 6465 2069        for node i
+0001c6a0: 6e20 6e6f 6465 733a 0a20 2020 2020 2020  n nodes:.       
+0001c6b0: 2020 2020 2020 2020 2020 2020 206d 203d               m =
+0001c6c0: 2072 652e 7365 6172 6368 286e 6f64 655f   re.search(node_
+0001c6d0: 7265 2c20 6e6f 6465 290a 2020 2020 2020  re, node).      
+0001c6e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001c6f0: 206d 3a0a 2020 2020 2020 2020 2020 2020   m:.            
+0001c700: 2020 2020 2020 2020 2020 2020 6e6f 6465              node
+0001c710: 5f64 6963 745b 6e6f 6465 5f72 655d 2e61  _dict[node_re].a
+0001c720: 7070 656e 6428 6e6f 6465 290a 2020 2020  ppend(node).    
+0001c730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c740: 6966 206e 6f74 206d 2061 6e64 2061 6464  if not m and add
+0001c750: 5f75 6e6d 6174 6368 6564 3a0a 2020 2020  _unmatched:.    
+0001c760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c770: 2020 2020 6e6f 6465 5f64 6963 745b 7365      node_dict[se
+0001c780: 6c66 2e55 4e4d 4154 4348 4544 5d2e 6170  lf.UNMATCHED].ap
+0001c790: 7065 6e64 286e 6f64 6529 0a20 2020 2020  pend(node).     
+0001c7a0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+0001c7b0: 7465 6d20 696e 206e 6f64 655f 6469 6374  tem in node_dict
+0001c7c0: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
+0001c7d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001c7e0: 7072 696e 7428 6622 6974 656d 207b 6974  print(f"item {it
+0001c7f0: 656d 7d22 290a 2020 2020 2020 2020 2020  em}").          
+0001c800: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
+0001c810: 2020 2020 6465 6620 6164 645f 7870 6174      def add_xpat
+0001c820: 6828 7365 6c66 2c20 7469 746c 652c 2078  h(self, title, x
+0001c830: 7061 7468 293a 0a20 2020 2020 2020 2022  path):.        "
+0001c840: 2222 0a20 2020 2020 2020 2073 6574 2078  "".        set x
+0001c850: 7061 7468 2066 6f72 2065 7874 7261 6374  path for extract
+0001c860: 696e 6720 4854 4d4c 206e 6f64 6573 2e0a  ing HTML nodes..
+0001c870: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
+0001c880: 6974 6c65 3a20 7469 746c 6520 6f66 2078  itle: title of x
+0001c890: 7061 7468 0a20 2020 2020 2020 203a 7061  path.        :pa
+0001c8a0: 7261 6d20 7870 6174 683a 2061 6374 7320  ram xpath: acts 
+0001c8b0: 6f6e 2063 7572 7265 6e74 206e 6f64 6573  on current nodes
+0001c8c0: 6574 0a20 2020 2020 2020 2022 2222 0a20  et.        """. 
+0001c8d0: 2020 2020 2020 2058 6d6c 4c69 622e 7661         XmlLib.va
+0001c8e0: 6c69 6461 7465 5f78 7061 7468 2878 7061  lidate_xpath(xpa
+0001c8f0: 7468 290a 2020 2020 2020 2020 7365 6c66  th).        self
+0001c900: 2e61 6464 5f69 7465 6d5f 746f 5f61 7272  .add_item_to_arr
+0001c910: 6179 5f64 6963 7428 7365 6c66 2e78 7061  ay_dict(self.xpa
+0001c920: 7468 5f64 6963 742c 2074 6974 6c65 2c20  th_dict, title, 
+0001c930: 7870 6174 6829 0a0a 2020 2020 6465 6620  xpath)..    def 
+0001c940: 7661 6c69 6461 7465 5f78 7061 7468 2873  validate_xpath(s
+0001c950: 656c 662c 2078 7061 7468 293a 0a20 2020  elf, xpath):.   
+0001c960: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001c970: 2063 7275 6465 2073 796e 7461 7820 7661   crude syntax va
+0001c980: 6c69 6461 7469 6f6e 206f 6620 7870 6174  lidation of xpat
+0001c990: 6820 7374 7269 6e67 2e0a 2020 2020 2020  h string..      
+0001c9a0: 2020 7465 7374 7320 7870 6174 6820 6f6e    tests xpath on
+0001c9b0: 2061 2074 7269 7669 616c 2065 6c65 6d65   a trivial eleme
+0001c9c0: 6e74 0a20 2020 2020 2020 203a 7061 7261  nt.        :para
+0001c9d0: 6d20 7870 6174 683a 0a20 2020 2020 2020  m xpath:.       
+0001c9e0: 2022 2222 0a20 2020 2020 2020 2074 7265   """.        tre
+0001c9f0: 6520 3d20 4554 2e66 726f 6d73 7472 696e  e = ET.fromstrin
+0001ca00: 6728 223c 666f 6f2f 3e22 290a 2020 2020  g("<foo/>").    
+0001ca10: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001ca20: 2020 2020 2074 7265 652e 7870 6174 6828       tree.xpath(
+0001ca30: 7870 6174 6829 0a20 2020 2020 2020 2065  xpath).        e
+0001ca40: 7863 6570 7420 4554 2e58 5061 7468 4576  xcept ET.XPathEv
+0001ca50: 616c 4572 726f 7220 6173 2065 3a0a 2020  alError as e:.  
+0001ca60: 2020 2020 2020 2020 2020 6c6f 6767 696e            loggin
+0001ca70: 672e 6572 726f 7228 6622 6261 6420 5850  g.error(f"bad XP
+0001ca80: 6174 6820 7b78 7061 7468 7d2c 207b 657d  ath {xpath}, {e}
+0001ca90: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0001caa0: 6169 7365 2065 0a0a 2020 2020 6465 6620  aise e..    def 
+0001cab0: 6164 645f 6368 756e 6b5f 7265 2873 656c  add_chunk_re(sel
+0001cac0: 662c 2063 6875 6e6b 5f72 6529 3a0a 2020  f, chunk_re):.  
+0001cad0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001cae0: 2020 6164 6420 6368 756e 6b20 7265 6765    add chunk rege
+0001caf0: 7820 666f 7220 6578 7472 6163 7469 6e67  x for extracting
+0001cb00: 2063 6875 6e6b 732e 0a20 2020 2020 2020   chunks..       
+0001cb10: 203a 7061 7261 6d20 6368 756e 6b5f 7265   :param chunk_re
+0001cb20: 3a20 6163 7473 206f 6e20 6375 7272 656e  : acts on curren
+0001cb30: 7420 6e6f 6465 7365 740a 2020 2020 2020  t nodeset.      
+0001cb40: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
+0001cb50: 6c66 2e61 6464 5f69 7465 6d5f 746f 5f61  lf.add_item_to_a
+0001cb60: 7272 6179 5f64 6963 7428 7365 6c66 2e63  rray_dict(self.c
+0001cb70: 6875 6e6b 5f64 6963 742c 2073 656c 662e  hunk_dict, self.
+0001cb80: 4348 554e 4b5f 5245 2c20 6368 756e 6b5f  CHUNK_RE, chunk_
+0001cb90: 7265 290a 2020 2020 2020 2020 7365 6c66  re).        self
+0001cba0: 2e76 616c 6964 6174 655f 7265 2863 6875  .validate_re(chu
+0001cbb0: 6e6b 5f72 6529 0a0a 2020 2020 6465 6620  nk_re)..    def 
+0001cbc0: 6164 645f 7370 6c69 7474 6572 5f72 6528  add_splitter_re(
+0001cbd0: 7365 6c66 2c20 7370 6c69 7474 6572 5f72  self, splitter_r
+0001cbe0: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
+0001cbf0: 2020 2020 2020 2020 6164 6420 7370 6c69          add spli
+0001cc00: 7474 6572 2072 6567 6578 2066 6f72 2065  tter regex for e
+0001cc10: 7874 7261 6374 696e 6720 6c69 7374 7320  xtracting lists 
+0001cc20: 696e 2063 6875 6e6b 732e 0a20 2020 2020  in chunks..     
+0001cc30: 2020 203a 7061 7261 6d20 7370 6c69 7474     :param splitt
+0001cc40: 6572 5f72 653a 2061 6374 7320 6f6e 2063  er_re: acts on c
+0001cc50: 7572 7265 6e74 206e 6f64 6573 6574 0a20  urrent nodeset. 
+0001cc60: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001cc70: 2020 2073 656c 662e 6164 645f 6974 656d     self.add_item
+0001cc80: 5f74 6f5f 6172 7261 795f 6469 6374 2873  _to_array_dict(s
+0001cc90: 656c 662e 7370 6c69 7474 6572 5f64 6963  elf.splitter_dic
+0001cca0: 742c 2073 656c 662e 5350 4c49 5454 4552  t, self.SPLITTER
+0001ccb0: 5f52 452c 2073 706c 6974 7465 725f 7265  _RE, splitter_re
+0001ccc0: 290a 2020 2020 2020 2020 7365 6c66 2e76  ).        self.v
+0001ccd0: 616c 6964 6174 655f 7265 2873 706c 6974  alidate_re(split
+0001cce0: 7465 725f 7265 290a 0a20 2020 2064 6566  ter_re)..    def
+0001ccf0: 2061 6464 5f73 7562 6e6f 6465 5f6b 6579   add_subnode_key
+0001cd00: 5f72 6528 7365 6c66 2c20 6e61 6d65 2c20  _re(self, name, 
+0001cd10: 7375 626e 6f64 655f 7265 293a 0a20 2020  subnode_re):.   
+0001cd20: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001cd30: 2061 6464 206e 616d 6564 2073 7562 6e6f   add named subno
+0001cd40: 6465 2072 6567 6578 2066 6f72 2070 6172  de regex for par
+0001cd50: 7369 6e67 206c 6973 7420 6974 656d 7320  sing list items 
+0001cd60: 6672 6f6d 2073 706c 6974 7469 6e67 0a20  from splitting. 
+0001cd70: 2020 2020 2020 203a 7061 7261 6d20 6e61         :param na
+0001cd80: 6d65 3a20 6e61 6d65 206f 6620 7265 2069  me: name of re i
+0001cd90: 6e20 6469 6374 0a20 2020 2020 2020 203a  n dict.        :
+0001cda0: 7061 7261 6d20 7375 626e 6f64 655f 7265  param subnode_re
+0001cdb0: 3a20 7265 6765 7820 746f 2073 746f 7265  : regex to store
+0001cdc0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001cdd0: 2020 2020 2073 656c 662e 6164 645f 6e61       self.add_na
+0001cde0: 6d65 645f 7661 6c75 6528 6e61 6d65 2c20  med_value(name, 
+0001cdf0: 7375 626e 6f64 655f 7265 290a 0a20 2020  subnode_re)..   
+0001ce00: 2064 6566 2061 6464 5f6e 616d 6564 5f76   def add_named_v
+0001ce10: 616c 7565 2873 656c 662c 206e 616d 652c  alue(self, name,
+0001ce20: 2073 7562 6e6f 6465 5f72 6529 3a0a 2020   subnode_re):.  
+0001ce30: 2020 2020 2020 7365 6c66 2e61 6464 5f69        self.add_i
+0001ce40: 7465 6d5f 746f 5f61 7272 6179 5f64 6963  tem_to_array_dic
+0001ce50: 7428 7365 6c66 2e63 6875 6e6b 5f64 6963  t(self.chunk_dic
+0001ce60: 742c 206e 616d 652c 2073 7562 6e6f 6465  t, name, subnode
+0001ce70: 5f72 6529 0a20 2020 2020 2020 2073 656c  _re).        sel
+0001ce80: 662e 7661 6c69 6461 7465 5f72 6528 7375  f.validate_re(su
+0001ce90: 626e 6f64 655f 7265 290a 0a20 2020 2064  bnode_re)..    d
+0001cea0: 6566 2073 6574 5f75 6e6d 6174 6368 6564  ef set_unmatched
+0001ceb0: 5f66 6c61 6728 7365 6c66 2c20 756e 6d61  _flag(self, unma
+0001cec0: 7463 6865 6429 3a0a 2020 2020 2020 2020  tched):.        
+0001ced0: 2222 220a 2020 2020 2020 2020 7365 7420  """.        set 
+0001cee0: 554e 4d41 5443 4845 4420 626f 6f6c 6561  UNMATCHED boolea
+0001cef0: 6e2e 2049 6620 7472 7565 2061 6464 7320  n. If true adds 
+0001cf00: 616c 6c20 756e 6d61 7463 6865 6420 7661  all unmatched va
+0001cf10: 6c75 6573 2074 6f20 6469 6374 2075 6e64  lues to dict und
+0001cf20: 6572 2055 4e4d 4154 4348 4544 0a20 2020  er UNMATCHED.   
+0001cf30: 2020 2020 203a 7061 7261 6d20 756e 6d61       :param unma
+0001cf40: 7463 6865 643a 2061 6374 7320 6f6e 2063  tched: acts on c
+0001cf50: 7572 7265 6e74 206e 6f64 6573 6574 0a20  urrent nodeset. 
+0001cf60: 2020 2020 2020 203a 7061 7261 6d20 6d61         :param ma
+0001cf70: 7463 685f 7479 7065 3a20 6164 6469 7469  tch_type: additi
+0001cf80: 6f6e 616c 2064 6562 7567 2074 6f20 6e61  onal debug to na
+0001cf90: 6d65 0a20 2020 2020 2020 2022 2222 0a20  me.        """. 
+0001cfa0: 2020 2020 2020 2073 656c 662e 6368 756e         self.chun
+0001cfb0: 6b5f 6469 6374 5b73 656c 662e 554e 4d41  k_dict[self.UNMA
+0001cfc0: 5443 4845 445d 203d 2075 6e6d 6174 6368  TCHED] = unmatch
+0001cfd0: 6564 0a0a 2020 2020 6465 6620 7661 6c69  ed..    def vali
+0001cfe0: 6461 7465 5f72 6528 7365 6c66 2c20 7265  date_re(self, re
+0001cff0: 6765 7829 3a0a 2020 2020 2020 2020 2222  gex):.        ""
+0001d000: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
+0001d010: 2072 6567 6578 3a20 7265 6765 7820 746f   regex: regex to
+0001d020: 2062 6520 7661 6c69 6461 7465 640a 2020   be validated.  
+0001d030: 2020 2020 2020 3a65 7863 6570 743a 2074        :except: t
+0001d040: 6872 6f77 7320 4578 6365 7074 696f 6e20  hrows Exception 
+0001d050: 666f 7220 6261 6420 7265 6765 780a 2020  for bad regex.  
+0001d060: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001d070: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0001d080: 2020 2072 652e 636f 6d70 696c 6528 7265     re.compile(re
+0001d090: 6765 7829 0a20 2020 2020 2020 2065 7863  gex).        exc
+0001d0a0: 6570 7420 4578 6365 7074 696f 6e20 6173  ept Exception as
+0001d0b0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0001d0c0: 6c6f 6767 696e 672e 6572 726f 7228 6622  logging.error(f"
+0001d0d0: 6261 6420 7265 6765 7820 7b72 6567 6578  bad regex {regex
+0001d0e0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001d0f0: 7261 6973 6520 650a 0a20 2020 2064 6566  raise e..    def
+0001d100: 2061 6464 5f69 7465 6d5f 746f 5f61 7272   add_item_to_arr
+0001d110: 6179 5f64 6963 7428 7365 6c66 2c20 7468  ay_dict(self, th
+0001d120: 655f 6469 6374 2c20 6b65 792c 2076 616c  e_dict, key, val
+0001d130: 7565 293a 0a20 2020 2020 2020 2069 6620  ue):.        if 
+0001d140: 6e6f 7420 7468 655f 6469 6374 2e67 6574  not the_dict.get
+0001d150: 286b 6579 293a 0a20 2020 2020 2020 2020  (key):.         
+0001d160: 2020 2074 6865 5f64 6963 745b 6b65 795d     the_dict[key]
+0001d170: 203d 205b 5d0a 2020 2020 2020 2020 7468   = [].        th
+0001d180: 655f 6469 6374 5b6b 6579 5d2e 6170 7065  e_dict[key].appe
+0001d190: 6e64 2876 616c 7565 290a 0a0a 0a63 6c61  nd(value)....cla
+0001d1a0: 7373 2055 524c 4361 6368 653a 0a20 2020  ss URLCache:.   
+0001d1b0: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+0001d1c0: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
+0001d1d0: 662e 7572 6c5f 6469 6374 203d 2064 6963  f.url_dict = dic
+0001d1e0: 7428 290a 0a20 2020 2064 6566 2072 6561  t()..    def rea
+0001d1f0: 645f 786d 6c5f 656c 656d 656e 745f 6672  d_xml_element_fr
+0001d200: 6f6d 5f67 6974 6875 6228 7365 6c66 2c20  om_github(self, 
+0001d210: 6769 7468 7562 5f75 726c 2c20 6465 6c61  github_url, dela
+0001d220: 793d 3129 3a0a 2020 2020 2020 2020 2222  y=1):.        ""
+0001d230: 2272 6574 7269 6576 6573 2061 6e64 2070  "retrieves and p
+0001d240: 6172 7365 7320 636f 6e74 656e 7420 6f66  arses content of
+0001d250: 2055 524c 2e20 4361 6368 6573 2069 7420   URL. Caches it 
+0001d260: 6966 2066 6f75 6e64 0a20 2020 2020 2020  if found.       
+0001d270: 2072 6574 7572 6e73 2061 2064 6565 7063   returns a deepc
+0001d280: 6f70 7920 6173 2065 6c65 6d6e 7420 6973  opy as elemnt is
+0001d290: 206c 696b 656c 7920 746f 2062 6520 6564   likely to be ed
+0001d2a0: 6974 6564 2222 220a 2020 2020 2020 2020  ited""".        
+0001d2b0: 6874 6d6c 5f65 6c65 6d20 3d20 7365 6c66  html_elem = self
+0001d2c0: 2e75 726c 5f64 6963 742e 6765 7428 6769  .url_dict.get(gi
+0001d2d0: 7468 7562 5f75 726c 290a 2020 2020 2020  thub_url).      
+0001d2e0: 2020 6966 2068 746d 6c5f 656c 656d 2069    if html_elem i
+0001d2f0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001d300: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001d310: 2020 2020 2020 2020 2068 746d 6c5f 656c           html_el
+0001d320: 656d 203d 2058 6d6c 4c69 622e 7265 6164  em = XmlLib.read
+0001d330: 5f78 6d6c 5f65 6c65 6d65 6e74 5f66 726f  _xml_element_fro
+0001d340: 6d5f 6769 7468 7562 2867 6974 6875 625f  m_github(github_
+0001d350: 7572 6c3d 6769 7468 7562 5f75 726c 290a  url=github_url).
+0001d360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d370: 7469 6d65 2e73 6c65 6570 2864 656c 6179  time.sleep(delay
+0001d380: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
+0001d390: 6365 7074 2045 7863 6570 7469 6f6e 2061  cept Exception a
+0001d3a0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0001d3b0: 2020 2020 2070 7269 6e74 2866 2263 616e       print(f"can
+0001d3c0: 6e6f 7420 7265 6164 207b 6769 7468 7562  not read {github
+0001d3d0: 5f75 726c 7d20 6265 6361 7573 6520 7b65  _url} because {e
+0001d3e0: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0001d3f0: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+0001d400: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0001d410: 2e75 726c 5f64 6963 745b 6769 7468 7562  .url_dict[github
+0001d420: 5f75 726c 5d20 3d20 6874 6d6c 5f65 6c65  _url] = html_ele
+0001d430: 6d0a 2020 2020 2020 2020 656c 7365 3a0a  m.        else:.
+0001d440: 2020 2020 2020 2020 2020 2020 2320 7072              # pr
+0001d450: 696e 7428 6622 2066 6f75 6e64 2069 6e20  int(f" found in 
+0001d460: 6361 6368 6521 2229 0a20 2020 2020 2020  cache!").       
+0001d470: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0001d480: 2020 7265 7475 726e 2063 6f70 792e 6465    return copy.de
+0001d490: 6570 636f 7079 2868 746d 6c5f 656c 656d  epcopy(html_elem
+0001d4a0: 290a 0a0a 4944 203d 2022 6964 220a 4f42  )...ID = "id".OB
+0001d4b0: 4a45 4354 203d 226f 626a 6563 7422 0a53  JECT ="object".S
+0001d4c0: 5441 5254 454e 4420 3d20 2273 7461 7274  TARTEND = "start
+0001d4d0: 5f65 6e64 220a 0a63 6c61 7373 2046 6c6f  _end"..class Flo
+0001d4e0: 6174 426f 756e 6461 7279 4469 6374 3a0a  atBoundaryDict:.
+0001d4f0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
+0001d500: 5f28 7365 6c66 2c20 6874 6d6c 5f65 6c65  _(self, html_ele
+0001d510: 6d2c 206f 7574 6469 723d 4e6f 6e65 293a  m, outdir=None):
+0001d520: 0a20 2020 2020 2020 2073 656c 662e 666c  .        self.fl
+0001d530: 6f61 745f 626f 756e 6461 7279 5f64 6963  oat_boundary_dic
+0001d540: 7420 3d20 6465 6661 756c 7464 6963 7428  t = defaultdict(
+0001d550: 6c69 7374 290a 2020 2020 2020 2020 7365  list).        se
+0001d560: 6c66 2e68 746d 6c5f 656c 656d 203d 2068  lf.html_elem = h
+0001d570: 746d 6c5f 656c 656d 0a20 2020 2020 2020  tml_elem.       
+0001d580: 2073 656c 662e 6f75 7464 6972 203d 206f   self.outdir = o
+0001d590: 7574 6469 720a 0a20 2020 2064 6566 2061  utdir..    def a
+0001d5a0: 6464 5f6f 626a 6563 7428 7365 6c66 2c20  dd_object(self, 
+0001d5b0: 666c 6f61 745f 626f 756e 6461 7279 293a  float_boundary):
+0001d5c0: 0a20 2020 2020 2020 206b 6579 203d 2066  .        key = f
+0001d5d0: 6c6f 6174 5f62 6f75 6e64 6172 792e 6b65  loat_boundary.ke
+0001d5e0: 790a 2020 2020 2020 2020 7365 6c66 2e66  y.        self.f
+0001d5f0: 6c6f 6174 5f62 6f75 6e64 6172 795f 6469  loat_boundary_di
+0001d600: 6374 5b6b 6579 5d2e 6170 7065 6e64 2866  ct[key].append(f
+0001d610: 6c6f 6174 5f62 6f75 6e64 6172 7929 0a0a  loat_boundary)..
+0001d620: 2020 2020 6465 6620 6164 645f 666c 6f61      def add_floa
+0001d630: 745f 626f 756e 6461 7269 6573 2873 656c  t_boundaries(sel
+0001d640: 662c 2066 6c6f 6174 5f62 6f75 6e64 6172  f, float_boundar
+0001d650: 6965 7329 3a0a 2020 2020 2020 2020 666f  ies):.        fo
+0001d660: 7220 666c 6f61 745f 626f 756e 6461 7279  r float_boundary
+0001d670: 2069 6e20 666c 6f61 745f 626f 756e 6461   in float_bounda
+0001d680: 7269 6573 3a0a 2020 2020 2020 2020 2020  ries:.          
+0001d690: 2020 7365 6c66 2e61 6464 5f6f 626a 6563    self.add_objec
+0001d6a0: 7428 666c 6f61 745f 626f 756e 6461 7279  t(float_boundary
+0001d6b0: 290a 0a20 2020 2064 6566 2065 7874 7261  )..    def extra
+0001d6c0: 6374 5f63 6f6e 7465 6e74 735f 6f66 5f62  ct_contents_of_b
+0001d6d0: 7261 636b 6574 6564 5f62 6f75 6e64 6172  racketed_boundar
+0001d6e0: 6965 735f 616e 645f 7772 6974 6528 7365  ies_and_write(se
+0001d6f0: 6c66 293a 0a20 2020 2020 2020 2066 6f72  lf):.        for
+0001d700: 2066 625f 6c69 7374 2069 6e20 7365 6c66   fb_list in self
+0001d710: 2e66 6c6f 6174 5f62 6f75 6e64 6172 795f  .float_boundary_
+0001d720: 6469 6374 2e76 616c 7565 7328 293a 0a20  dict.values():. 
+0001d730: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0001d740: 6e28 6662 5f6c 6973 7429 203d 3d20 323a  n(fb_list) == 2:
+0001d750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d760: 2023 2070 7269 6e74 2866 2246 4220 7b66   # print(f"FB {f
+0001d770: 625f 6c69 7374 7d20 7b66 625f 6c69 7374  b_list} {fb_list
+0001d780: 5b30 5d2e 6469 765f 6964 7d20 7b66 625f  [0].div_id} {fb_
+0001d790: 6c69 7374 5b31 5d2e 6469 765f 6964 7d22  list[1].div_id}"
+0001d7a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001d7b0: 2020 6e65 775f 6469 7620 3d20 7365 6c66    new_div = self
+0001d7c0: 2e64 656c 6574 655f 6265 7477 6565 6e28  .delete_between(
+0001d7d0: 6662 5f6c 6973 745b 305d 2e64 6976 5f69  fb_list[0].div_i
+0001d7e0: 642c 2066 625f 6c69 7374 5b31 5d2e 6469  d, fb_list[1].di
+0001d7f0: 765f 6964 290a 2020 2020 2020 2020 2020  v_id).          
+0001d800: 2020 2020 2020 666c 6f61 745f 6e61 6d65        float_name
+0001d810: 203d 2066 625f 6c69 7374 5b30 5d2e 6b65   = fb_list[0].ke
+0001d820: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+0001d830: 2020 6e65 775f 6469 762e 6174 7472 6962    new_div.attrib
+0001d840: 5b22 6e61 6d65 225d 203d 2066 6c6f 6174  ["name"] = float
+0001d850: 5f6e 616d 650a 2020 2020 2020 2020 2020  _name.          
+0001d860: 2020 2020 2020 6e65 775f 6874 6d6c 5f65        new_html_e
+0001d870: 6c65 6d20 3d20 4874 6d6c 4c69 622e 6372  lem = HtmlLib.cr
+0001d880: 6561 7465 5f6e 6577 5f68 746d 6c5f 7769  eate_new_html_wi
+0001d890: 7468 5f6f 6c64 5f73 7479 6c65 7328 7365  th_old_styles(se
+0001d8a0: 6c66 2e68 746d 6c5f 656c 656d 290a 2020  lf.html_elem).  
+0001d8b0: 2020 2020 2020 2020 2020 2020 2020 4874                Ht
+0001d8c0: 6d6c 4c69 622e 6765 745f 626f 6479 286e  mlLib.get_body(n
+0001d8d0: 6577 5f68 746d 6c5f 656c 656d 292e 6170  ew_html_elem).ap
+0001d8e0: 7065 6e64 286e 6577 5f64 6976 290a 2020  pend(new_div).  
+0001d8f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001d900: 2073 656c 662e 6f75 7464 6972 3a0a 2020   self.outdir:.  
+0001d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d920: 2020 5061 7468 2873 656c 662e 6f75 7464    Path(self.outd
+0001d930: 6972 292e 6d6b 6469 7228 6578 6973 745f  ir).mkdir(exist_
+0001d940: 6f6b 3d54 7275 652c 2070 6172 656e 7473  ok=True, parents
+0001d950: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+0001d960: 2020 2020 2020 2020 2020 2020 6669 6c65              file
+0001d970: 5f73 7465 6d20 3d20 666c 6f61 745f 6e61  _stem = float_na
+0001d980: 6d65 2e6c 6f77 6572 2829 2e72 6570 6c61  me.lower().repla
+0001d990: 6365 2822 5c5c 732a 222c 2022 2229 0a20  ce("\\s*", ""). 
+0001d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9b0: 2020 2058 6d6c 4c69 622e 7772 6974 655f     XmlLib.write_
+0001d9c0: 786d 6c28 6e65 775f 6874 6d6c 5f65 6c65  xml(new_html_ele
+0001d9d0: 6d2c 2050 6174 6828 7365 6c66 2e6f 7574  m, Path(self.out
+0001d9e0: 6469 722c 2066 696c 655f 7374 656d 202b  dir, file_stem +
+0001d9f0: 2022 2e68 746d 6c22 2929 0a0a 2020 2020   ".html"))..    
+0001da00: 6465 6620 6465 6c65 7465 5f62 6574 7765  def delete_betwe
+0001da10: 656e 2873 656c 662c 2064 6976 5f69 6430  en(self, div_id0
+0001da20: 2c20 6469 765f 6964 3129 3a0a 2020 2020  , div_id1):.    
+0001da30: 2020 2020 656c 656d 3020 3d20 7365 6c66      elem0 = self
+0001da40: 2e68 746d 6c5f 656c 656d 2e78 7061 7468  .html_elem.xpath
+0001da50: 2866 222e 2f2f 6469 765b 4069 643d 277b  (f".//div[@id='{
+0001da60: 6469 765f 6964 307d 275d 2229 5b30 5d0a  div_id0}']")[0].
+0001da70: 2020 2020 2020 2020 656c 656d 3120 3d20          elem1 = 
+0001da80: 7365 6c66 2e68 746d 6c5f 656c 656d 2e78  self.html_elem.x
+0001da90: 7061 7468 2866 222e 2f2f 6469 765b 4069  path(f".//div[@i
+0001daa0: 643d 277b 6469 765f 6964 317d 275d 2229  d='{div_id1}']")
+0001dab0: 5b30 5d0a 2020 2020 2020 2020 666f 6c6c  [0].        foll
+0001dac0: 6f77 696e 6720 3d20 656c 656d 302e 7870  owing = elem0.xp
+0001dad0: 6174 6828 2266 6f6c 6c6f 7769 6e67 3a3a  ath("following::
+0001dae0: 2a22 290a 2020 2020 2020 2020 6e65 775f  *").        new_
+0001daf0: 6469 7620 3d20 4554 2e45 6c65 6d65 6e74  div = ET.Element
+0001db00: 2822 6469 7622 290a 2020 2020 2020 2020  ("div").        
+0001db10: 6e65 775f 6469 762e 6174 7472 6962 5b22  new_div.attrib["
+0001db20: 6964 225d 203d 2064 6976 5f69 6430 0a20  id"] = div_id0. 
+0001db30: 2020 2020 2020 2066 6f72 2066 6f6c 6c6f         for follo
+0001db40: 7720 696e 2066 6f6c 6c6f 7769 6e67 3a0a  w in following:.
+0001db50: 2020 2020 2020 2020 2020 2020 6964 5f20              id_ 
+0001db60: 3d20 666f 6c6c 6f77 2e61 7474 7269 625b  = follow.attrib[
+0001db70: 2769 6427 5d0a 2020 2020 2020 2020 2020  'id'].          
+0001db80: 2020 6e65 775f 6469 762e 6170 7065 6e64    new_div.append
+0001db90: 2866 6f6c 6c6f 7729 0a20 2020 2020 2020  (follow).       
+0001dba0: 2020 2020 2023 2066 6f6c 6c6f 772e 6765       # follow.ge
+0001dbb0: 7470 6172 656e 7428 292e 7265 6d6f 7665  tparent().remove
+0001dbc0: 2866 6f6c 6c6f 7729 0a20 2020 2020 2020  (follow).       
+0001dbd0: 2020 2020 2069 6620 6964 5f20 3d3d 2064       if id_ == d
+0001dbe0: 6976 5f69 6431 3a0a 2020 2020 2020 2020  iv_id1:.        
+0001dbf0: 2020 2020 2020 2020 7072 696e 7428 2245          print("E
+0001dc00: 5849 5422 290a 2020 2020 2020 2020 2020  XIT").          
+0001dc10: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+0001dc20: 2020 2020 7265 7475 726e 206e 6577 5f64      return new_d
+0001dc30: 6976 0a0a 0a0a 636c 6173 7320 466c 6f61  iv....class Floa
+0001dc40: 7442 6f75 6e64 6172 793a 0a20 2020 2022  tBoundary:.    "
+0001dc50: 2222 0a20 2020 2048 6f6c 6473 0a20 2020  "".    Holds.   
+0001dc60: 2022 2222 0a20 2020 2049 5043 435f 424f   """.    IPCC_BO
+0001dc70: 554e 4441 5259 203d 2022 5c5c 5b3f 2220  UNDARY = "\\[?" 
+0001dc80: 5c0a 2020 2020 2020 2020 2020 2020 6622  \.            f"
+0001dc90: 283f 503c 7b53 5441 5254 454e 447d 3e53  (?P<{STARTEND}>S
+0001dca0: 5441 5254 7c45 4e44 295c 5c73 2a22 205c  TART|END)\\s*" \
+0001dcb0: 0a20 2020 2020 2020 2020 2020 2066 2228  .            f"(
+0001dcc0: 3f50 3c7b 4f42 4a45 4354 7d3e 2e2a 424f  ?P<{OBJECT}>.*BO
+0001dcd0: 587c 4649 4755 5245 7c54 4142 4c45 295c  X|FIGURE|TABLE)\
+0001dce0: 5c73 2a22 205c 0a20 2020 2020 2020 2020  \s*" \.         
+0001dcf0: 2020 2066 2228 3f50 3c7b 4944 7d3e 283f     f"(?P<{ID}>(?
+0001dd00: 3a28 3f3a 5b41 2d5a 302d 395d 2b7c 5c5c  :(?:[A-Z0-9]+|\\
+0001dd10: 642b 293f 283f 3a5c 5c2e 5c5c 642b 292a  d+)?(?:\\.\\d+)*
+0001dd20: 2929 5c5c 732a 283f 3a48 4552 4529 5c5c  ))\\s*(?:HERE)\\
+0001dd30: 5d3f 220a 0a20 2020 2023 205b 5354 4152  ]?"..    # [STAR
+0001dd40: 5420 4352 4f53 532d 5345 4354 494f 4e20  T CROSS-SECTION 
+0001dd50: 424f 582e 3120 4845 5245 5d0a 0a20 2020  BOX.1 HERE]..   
+0001dd60: 2064 6566 205f 5f69 6e69 745f 5f28 7365   def __init__(se
+0001dd70: 6c66 293a 0a20 2020 2020 2020 2073 656c  lf):.        sel
+0001dd80: 662e 6772 6f75 705f 6469 6374 203d 2064  f.group_dict = d
+0001dd90: 6963 7428 290a 2020 2020 2020 2020 7365  ict().        se
+0001dda0: 6c66 2e73 7461 7274 203d 204e 6f6e 650a  lf.start = None.
+0001ddb0: 2020 2020 2020 2020 7365 6c66 2e65 6e64          self.end
+0001ddc0: 203d 204e 6f6e 650a 2020 2020 2020 2020   = None.        
+0001ddd0: 7365 6c66 2e64 6976 5f69 6420 3d20 4e6f  self.div_id = No
+0001dde0: 6e65 0a0a 2020 2020 6465 6620 5f5f 7374  ne..    def __st
+0001ddf0: 725f 5f28 7365 6c66 293a 0a20 2020 2020  r__(self):.     
+0001de00: 2020 2072 6574 7572 6e20 7365 6c66 2e67     return self.g
+0001de10: 726f 7570 5f64 6963 742e 6765 7428 5354  roup_dict.get(ST
+0001de20: 4152 5445 4e44 2920 2b20 223b 2220 2b20  ARTEND) + ";" + 
+0001de30: 2073 656c 662e 6772 6f75 705f 6469 6374   self.group_dict
+0001de40: 2e67 6574 284f 424a 4543 5429 202b 2022  .get(OBJECT) + "
+0001de50: 3b22 202b 2020 7365 6c66 2e67 726f 7570  ;" +  self.group
+0001de60: 5f64 6963 742e 6765 7428 4944 290a 0a20  _dict.get(ID).. 
+0001de70: 2020 2064 6566 205f 5f72 6570 725f 5f28     def __repr__(
+0001de80: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+0001de90: 6574 7572 6e20 7365 6c66 2e5f 5f73 7472  eturn self.__str
+0001dea0: 5f5f 2829 0a0a 2020 2020 6465 6620 6164  __()..    def ad
+0001deb0: 6428 7365 6c66 2c20 6e61 6d65 2c20 7661  d(self, name, va
+0001dec0: 6c75 6529 3a0a 2020 2020 2020 2020 7365  lue):.        se
+0001ded0: 6c66 2e67 726f 7570 5f64 6963 745b 6e61  lf.group_dict[na
+0001dee0: 6d65 5d20 3d20 7661 6c75 650a 0a20 2020  me] = value..   
+0001def0: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+0001df00: 6566 206b 6579 2873 656c 6629 3a0a 2020  ef key(self):.  
+0001df10: 2020 2020 2020 7265 7475 726e 2073 7472        return str
+0001df20: 2873 656c 662e 6772 6f75 705f 6469 6374  (self.group_dict
+0001df30: 5b4f 424a 4543 545d 2920 2b20 7374 7228  [OBJECT]) + str(
+0001df40: 7365 6c66 2e67 726f 7570 5f64 6963 745b  self.group_dict[
+0001df50: 4944 5d29 0a0a 2020 2020 4070 726f 7065  ID])..    @prope
+0001df60: 7274 790a 2020 2020 6465 6620 7374 6172  rty.    def star
+0001df70: 745f 656e 6428 7365 6c66 293a 0a20 2020  t_end(self):.   
+0001df80: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001df90: 2e67 726f 7570 5f64 6963 745b 5354 4152  .group_dict[STAR
+0001dfa0: 5445 4e44 5d0a 0a20 2020 2040 636c 6173  TEND]..    @clas
+0001dfb0: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+0001dfc0: 6578 7472 6163 745f 666c 6f61 7473 5f61  extract_floats_a
+0001dfd0: 6e64 5f62 6f75 6e64 6172 6965 7328 636c  nd_boundaries(cl
+0001dfe0: 732c 2068 746d 6c5f 656c 656d 2c20 7061  s, html_elem, pa
+0001dff0: 636b 6167 652c 206f 7574 6469 723d 4e6f  ckage, outdir=No
+0001e000: 6e65 293a 0a20 2020 2020 2020 2072 6567  ne):.        reg
+0001e010: 6578 203d 2046 6c6f 6174 426f 756e 6461  ex = FloatBounda
+0001e020: 7279 2e49 5043 435f 424f 554e 4441 5259  ry.IPCC_BOUNDARY
+0001e030: 0a20 2020 2020 2020 2066 6c6f 6174 5f62  .        float_b
+0001e040: 6f75 6e64 6172 6965 7320 3d20 466c 6f61  oundaries = Floa
+0001e050: 7445 7874 7261 6374 6f72 2829 2e65 7874  tExtractor().ext
+0001e060: 7261 6374 5f66 6c6f 6174 5f62 6f75 6e64  ract_float_bound
+0001e070: 6172 6965 7328 6874 6d6c 5f65 6c65 6d2c  aries(html_elem,
+0001e080: 2072 6567 6578 290a 2020 2020 2020 2020   regex).        
+0001e090: 666c 6f61 745f 626f 756e 6461 7279 5f64  float_boundary_d
+0001e0a0: 6963 7420 3d20 466c 6f61 7442 6f75 6e64  ict = FloatBound
+0001e0b0: 6172 7944 6963 7428 6874 6d6c 5f65 6c65  aryDict(html_ele
+0001e0c0: 6d2c 206f 7574 6469 723d 6f75 7464 6972  m, outdir=outdir
+0001e0d0: 290a 2020 2020 2020 2020 666c 6f61 745f  ).        float_
+0001e0e0: 626f 756e 6461 7279 5f64 6963 742e 6164  boundary_dict.ad
+0001e0f0: 645f 666c 6f61 745f 626f 756e 6461 7269  d_float_boundari
+0001e100: 6573 2866 6c6f 6174 5f62 6f75 6e64 6172  es(float_boundar
+0001e110: 6965 7329 0a20 2020 2020 2020 2066 6c6f  ies).        flo
+0001e120: 6174 5f62 6f75 6e64 6172 795f 6469 6374  at_boundary_dict
+0001e130: 2e65 7874 7261 6374 5f63 6f6e 7465 6e74  .extract_content
+0001e140: 735f 6f66 5f62 7261 636b 6574 6564 5f62  s_of_bracketed_b
+0001e150: 6f75 6e64 6172 6965 735f 616e 645f 7772  oundaries_and_wr
+0001e160: 6974 6528 290a 2020 2020 2020 2020 7265  ite().        re
+0001e170: 7475 726e 2068 746d 6c5f 656c 656d 0a0a  turn html_elem..
+0001e180: 0a63 6c61 7373 2046 6c6f 6174 4578 7472  .class FloatExtr
+0001e190: 6163 746f 723a 0a20 2020 2022 2222 6578  actor:.    """ex
+0001e1a0: 7472 6163 7473 2066 6c6f 6174 7320 2862  tracts floats (b
+0001e1b0: 6f78 6573 2c20 6669 6775 7265 732c 2065  oxes, figures, e
+0001e1c0: 7463 2e29 2075 7369 6e67 2073 7461 7274  tc.) using start
+0001e1d0: 2f65 6e64 2072 6567 6578 6573 0a20 2020  /end regexes.   
+0001e1e0: 2022 2222 0a0a 2020 2020 6465 6620 5f5f   """..    def __
+0001e1f0: 696e 6974 5f5f 2873 656c 662c 2072 6567  init__(self, reg
+0001e200: 6578 3d4e 6f6e 6529 3a0a 2020 2020 2020  ex=None):.      
+0001e210: 2020 7365 6c66 2e72 6567 6578 203d 2072    self.regex = r
+0001e220: 6567 6578 0a0a 2020 2020 6465 6620 6578  egex..    def ex
+0001e230: 7472 6163 745f 666c 6f61 745f 626f 756e  tract_float_boun
+0001e240: 6461 7269 6573 2873 656c 662c 2068 746d  daries(self, htm
+0001e250: 6c5f 656c 656d 2c20 7265 6765 785f 7374  l_elem, regex_st
+0001e260: 7229 3a0a 2020 2020 2020 2020 666c 6f61  r):.        floa
+0001e270: 745f 626f 756e 6461 7269 6573 203d 205b  t_boundaries = [
+0001e280: 5d0a 2020 2020 2020 2020 7265 6765 7820  ].        regex 
+0001e290: 3d20 7265 2e63 6f6d 7069 6c65 2872 6567  = re.compile(reg
+0001e2a0: 6578 5f73 7472 290a 2020 2020 2020 2020  ex_str).        
+0001e2b0: 2320 7072 696e 7428 6622 2072 6567 6578  # print(f" regex
+0001e2c0: 207b 7265 6765 787d 2229 0a20 2020 2020   {regex}").     
+0001e2d0: 2020 2064 6976 7320 3d20 6874 6d6c 5f65     divs = html_e
+0001e2e0: 6c65 6d2e 7870 6174 6828 222e 2f2f 6469  lem.xpath(".//di
+0001e2f0: 7622 290a 2020 2020 2020 2020 666f 7220  v").        for 
+0001e300: 6469 7620 696e 2064 6976 733a 0a20 2020  div in divs:.   
+0001e310: 2020 2020 2020 2020 2073 7061 6e73 203d           spans =
+0001e320: 2064 6976 2e78 7061 7468 2822 2e2f 7370   div.xpath("./sp
+0001e330: 616e 2229 0a20 2020 2020 2020 2020 2020  an").           
+0001e340: 2066 6f72 2073 7061 6e20 696e 2073 7061   for span in spa
+0001e350: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+0001e360: 2020 2020 6d61 7463 6820 3d20 7265 2e73      match = re.s
+0001e370: 6561 7263 6828 7265 6765 782c 2073 7061  earch(regex, spa
+0001e380: 6e2e 7465 7874 290a 2020 2020 2020 2020  n.text).        
+0001e390: 2020 2020 2020 2020 6966 206d 6174 6368          if match
+0001e3a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001e3b0: 2020 2020 2020 666c 6f61 745f 626f 756e        float_boun
+0001e3c0: 6461 7279 203d 2046 6c6f 6174 426f 756e  dary = FloatBoun
+0001e3d0: 6461 7279 2829 0a20 2020 2020 2020 2020  dary().         
+0001e3e0: 2020 2020 2020 2020 2020 2066 6c6f 6174             float
+0001e3f0: 5f62 6f75 6e64 6172 792e 6469 765f 6964  _boundary.div_id
+0001e400: 203d 2064 6976 2e61 7474 7269 625b 2269   = div.attrib["i
+0001e410: 6422 5d0a 2020 2020 2020 2020 2020 2020  d"].            
+0001e420: 2020 2020 2020 2020 666f 7220 6669 656c          for fiel
+0001e430: 6420 696e 205b 5354 4152 5445 4e44 2c20  d in [STARTEND, 
+0001e440: 4f42 4a45 4354 2c20 4944 5d3a 0a20 2020  OBJECT, ID]:.   
+0001e450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e460: 2020 2020 2066 6c6f 6174 5f62 6f75 6e64       float_bound
+0001e470: 6172 792e 6164 6428 6669 656c 642c 206d  ary.add(field, m
+0001e480: 6174 6368 2e67 726f 7570 2866 6965 6c64  atch.group(field
+0001e490: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0001e4a0: 2020 2020 2020 2066 6c6f 6174 5f62 6f75         float_bou
+0001e4b0: 6e64 6172 6965 732e 6170 7065 6e64 2866  ndaries.append(f
+0001e4c0: 6c6f 6174 5f62 6f75 6e64 6172 7929 0a20  loat_boundary). 
+0001e4d0: 2020 2020 2020 2072 6574 7572 6e20 666c         return fl
+0001e4e0: 6f61 745f 626f 756e 6461 7269 6573 0a0a  oat_boundaries..
+0001e4f0: 0a0a 636c 6173 7320 4353 5353 7479 6c65  ..class CSSStyle
+0001e500: 3a0a 2020 2020 2222 220a 2020 2020 636f  :.    """.    co
+0001e510: 6d6d 6f6e 2073 7562 7365 7420 6f66 2043  mmon subset of C
+0001e520: 5353 2073 7479 6c65 732f 636f 6d6d 616e  SS styles/comman
+0001e530: 6473 0a20 2020 2022 2222 0a20 2020 2023  ds.    """.    #
+0001e540: 2061 6c6c 2061 7265 206c 6f77 6572 6361   all are lowerca
+0001e550: 7365 0a20 2020 2042 4f4c 4420 3d20 2262  se.    BOLD = "b
+0001e560: 6f6c 6422 0a20 2020 2042 4f52 4445 5220  old".    BORDER 
+0001e570: 3d20 2262 6f72 6465 7222 0a20 2020 2042  = "border".    B
+0001e580: 4f54 544f 4d20 3d20 2262 6f74 746f 6d22  OTTOM = "bottom"
+0001e590: 0a20 2020 2043 4f4c 4f52 203d 2022 636f  .    COLOR = "co
+0001e5a0: 6c6f 7222 0a20 2020 2044 4f54 5f42 203d  lor".    DOT_B =
+0001e5b0: 2022 2e42 220a 2020 2020 4649 4c4c 203d   ".B".    FILL =
+0001e5c0: 2022 6669 6c6c 220a 2020 2020 5354 524f   "fill".    STRO
+0001e5d0: 4b45 203d 2022 7374 726f 6b65 220a 2020  KE = "stroke".  
+0001e5e0: 2020 464f 4e54 5f46 414d 494c 5920 3d20    FONT_FAMILY = 
+0001e5f0: 2266 6f6e 742d 6661 6d69 6c79 220a 2020  "font-family".  
+0001e600: 2020 464f 4e54 5f53 495a 4520 3d20 2266    FONT_SIZE = "f
+0001e610: 6f6e 742d 7369 7a65 220a 2020 2020 464f  ont-size".    FO
+0001e620: 4e54 5f53 5459 4c45 203d 2022 666f 6e74  NT_STYLE = "font
+0001e630: 2d73 7479 6c65 220a 2020 2020 464f 4e54  -style".    FONT
+0001e640: 5f53 5452 4554 4348 4544 203d 2022 666f  _STRETCHED = "fo
+0001e650: 6e74 2d73 7472 6574 6368 6564 220a 2020  nt-stretched".  
+0001e660: 2020 464f 4e54 5f57 4549 4748 5420 3d20    FONT_WEIGHT = 
+0001e670: 2266 6f6e 742d 7765 6967 6874 220a 2020  "font-weight".  
+0001e680: 2020 4845 4947 4854 203d 2022 6865 6967    HEIGHT = "heig
+0001e690: 6874 220a 2020 2020 4954 414c 4943 203d  ht".    ITALIC =
+0001e6a0: 2022 6974 616c 6963 220a 2020 2020 4c45   "italic".    LE
+0001e6b0: 4654 203d 2022 6c65 6674 220a 2020 2020  FT = "left".    
+0001e6c0: 4c49 4748 5420 3d20 226c 6967 6874 220a  LIGHT = "light".
+0001e6d0: 2020 2020 4e4f 524d 414c 203d 2022 6e6f      NORMAL = "no
+0001e6e0: 726d 616c 220a 2020 2020 4f50 4143 4954  rmal".    OPACIT
+0001e6f0: 5920 3d20 226f 7061 6369 7479 220a 2020  Y = "opacity".  
+0001e700: 2020 504f 5349 5449 4f4e 203d 2022 706f    POSITION = "po
+0001e710: 7369 7469 6f6e 220a 2020 2020 5058 203d  sition".    PX =
+0001e720: 2022 7078 220a 2020 2020 5354 594c 4520   "px".    STYLE 
+0001e730: 3d20 2273 7479 6c65 220a 2020 2020 544f  = "style".    TO
+0001e740: 5020 3d20 2274 6f70 220a 2020 2020 5749  P = "top".    WI
+0001e750: 4454 4820 3d20 2277 6964 7468 220a 0a20  DTH = "width".. 
+0001e760: 2020 2057 4549 4748 545f 5245 203d 2022     WEIGHT_RE = "
+0001e770: 285b 2d2e 5d3f 426f 6c64 7c5b 2e5d 5b42  ([-.]?Bold|[.][B
+0001e780: 625d 2429 220a 2020 2020 5354 594c 455f  b]$)".    STYLE_
+0001e790: 5245 203d 2022 285b 2d2e 5d3f 4974 616c  RE = "([-.]?Ital
+0001e7a0: 283a 3f69 6329 7c5b 2d2e 5d3f 4f62 6c69  (:?ic)|[-.]?Obli
+0001e7b0: 7175 657c 5b2e 5d5b 4969 5d24 2922 0a0a  que|[.][Ii]$)"..
+0001e7c0: 2020 2020 5445 5854 5f53 5459 4c45 5f43      TEXT_STYLE_C
+0001e7d0: 4f4d 504f 4e45 4e54 5320 3d20 5b46 4f4e  OMPONENTS = [FON
+0001e7e0: 545f 5354 594c 452c 2046 4f4e 545f 5745  T_STYLE, FONT_WE
+0001e7f0: 4947 4854 2c20 464f 4e54 5f46 414d 494c  IGHT, FONT_FAMIL
+0001e800: 592c 2046 4f4e 545f 5349 5a45 2c20 434f  Y, FONT_SIZE, CO
+0001e810: 4c4f 522c 204f 5041 4349 5459 5d0a 0a20  LOR, OPACITY].. 
+0001e820: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+0001e830: 7365 6c66 293a 0a20 2020 2020 2020 2073  self):.        s
+0001e840: 656c 662e 6e61 6d65 5f76 616c 7565 5f64  elf.name_value_d
+0001e850: 6963 7420 3d20 6469 6374 2829 0a0a 2020  ict = dict()..  
+0001e860: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
+0001e870: 6c66 293a 0a20 2020 2020 2020 2073 203d  lf):.        s =
+0001e880: 2022 220a 2020 2020 2020 2020 666f 7220   "".        for 
+0001e890: 6b2c 2076 2069 6e20 7365 6c66 2e6e 616d  k, v in self.nam
+0001e8a0: 655f 7661 6c75 655f 6469 6374 2e69 7465  e_value_dict.ite
+0001e8b0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0001e8c0: 2020 7320 2b3d 2066 227b 6b7d 3a7b 767d    s += f"{k}:{v}
+0001e8d0: 3b20 220a 2020 2020 2020 2020 7320 3d20  ; ".        s = 
+0001e8e0: 732e 7374 7269 7028 290a 2020 2020 2020  s.strip().      
+0001e8f0: 2020 7265 7475 726e 2073 0a0a 2020 2020    return s..    
+0001e900: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
+0001e910: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+0001e920: 726e 2066 227b 7365 6c66 2e6e 616d 655f  rn f"{self.name_
+0001e930: 7661 6c75 655f 6469 6374 7d22 0a0a 2320  value_dict}"..# 
+0001e940: 2020 2063 6c61 7373 2043 5353 5374 796c     class CSSStyl
+0001e950: 653a 0a0a 2020 2020 4063 6c61 7373 6d65  e:..    @classme
+0001e960: 7468 6f64 0a20 2020 2064 6566 2063 7265  thod.    def cre
+0001e970: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
+0001e980: 6f6d 5f61 7474 7269 6275 7465 5f6f 665f  om_attribute_of_
+0001e990: 626f 6479 5f65 6c65 6d65 6e74 2863 6c73  body_element(cls
+0001e9a0: 2c20 656c 656d 293a 0a20 2020 2020 2020  , elem):.       
+0001e9b0: 2022 2222 6372 6561 7465 2043 5353 5374   """create CSSSt
+0001e9c0: 796c 6520 6f62 6a65 6374 2066 726f 6d20  yle object from 
+0001e9d0: 656c 656d 0a20 2020 2020 2020 203a 7061  elem.        :pa
+0001e9e0: 7261 6d20 656c 656d 3a0a 2020 2020 2020  ram elem:.      
+0001e9f0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0001ea00: 2065 6c65 6d20 6973 204e 6f6e 653a 0a20   elem is None:. 
+0001ea10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001ea20: 6e20 4e6f 6e65 0a20 2020 2020 2020 2061  n None.        a
+0001ea30: 7373 6572 7420 7479 7065 2865 6c65 6d29  ssert type(elem)
+0001ea40: 2069 7320 5f45 6c65 6d65 6e74 2c20 6622   is _Element, f"
+0001ea50: 666f 756e 6420 7b74 7970 6528 656c 656d  found {type(elem
+0001ea60: 297d 220a 2020 2020 2020 2020 6373 735f  )}".        css_
+0001ea70: 7374 796c 6520 3d20 4353 5353 7479 6c65  style = CSSStyle
+0001ea80: 2829 0a20 2020 2020 2020 2073 7479 6c65  ().        style
+0001ea90: 5f61 7474 7661 6c20 3d20 656c 656d 2e67  _attval = elem.g
+0001eaa0: 6574 2843 5353 5374 796c 652e 5354 594c  et(CSSStyle.STYL
+0001eab0: 4529 0a20 2020 2020 2020 2063 7373 5f73  E).        css_s
+0001eac0: 7479 6c65 2e6e 616d 655f 7661 6c75 655f  tyle.name_value_
+0001ead0: 6469 6374 203d 2063 6c73 2e63 7265 6174  dict = cls.creat
+0001eae0: 655f 6469 6374 5f66 726f 6d5f 6e61 6d65  e_dict_from_name
+0001eaf0: 5f76 616c 7565 5f61 7272 6179 5f73 7472  _value_array_str
+0001eb00: 696e 6728 7374 796c 655f 6174 7476 616c  ing(style_attval
+0001eb10: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001eb20: 2063 7373 5f73 7479 6c65 0a0a 2020 2020   css_style..    
+0001eb30: 2320 2020 2063 6c61 7373 2043 5353 5374  #    class CSSSt
+0001eb40: 796c 653a 0a0a 2020 2020 4063 6c61 7373  yle:..    @class
+0001eb50: 6d65 7468 6f64 0a20 2020 2064 6566 2063  method.    def c
+0001eb60: 7265 6174 655f 6469 6374 5f66 726f 6d5f  reate_dict_from_
+0001eb70: 6e61 6d65 5f76 616c 7565 5f61 7272 6179  name_value_array
+0001eb80: 5f73 7472 696e 6728 636c 732c 2073 7479  _string(cls, sty
+0001eb90: 6c65 5f73 7472 2c20 7265 6d6f 7665 5f63  le_str, remove_c
+0001eba0: 7572 6c79 3d54 7275 6529 3a0a 2020 2020  urly=True):.    
+0001ebb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001ebc0: 6173 7375 6d65 7320 7374 7269 6e67 206f  assumes string o
+0001ebd0: 6620 7479 7065 2022 613a 2062 3b20 633a  f type "a: b; c:
+0001ebe0: 2064 3b22 206f 7074 696f 6e61 6c6c 7920   d;" optionally 
+0001ebf0: 656e 636c 6f73 6564 2069 6e20 7b2e 2e2e  enclosed in {...
+0001ec00: 7d0a 2020 2020 2020 2020 3a70 6172 616d  }.        :param
+0001ec10: 2073 7479 6c65 5f73 7472 3a20 0a20 2020   style_str: .   
+0001ec20: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001ec30: 2072 655f 7374 7220 3d20 2228 3f50 3c70   re_str = "(?P<p
+0001ec40: 7265 3e2e 2a29 7b28 3f50 3c63 7572 6c79  re>.*){(?P<curly
+0001ec50: 3e2e 2a29 7d28 3f50 3c70 6f73 743e 2e2a  >.*)}(?P<post>.*
+0001ec60: 2922 0a20 2020 2020 2020 2063 7572 6c79  )".        curly
+0001ec70: 5f72 6520 3d20 7265 2e63 6f6d 7069 6c65  _re = re.compile
+0001ec80: 2872 655f 7374 7229 0a20 2020 2020 2020  (re_str).       
+0001ec90: 206e 616d 655f 7661 6c75 655f 6469 6374   name_value_dict
+0001eca0: 203d 2064 6963 7428 290a 2020 2020 2020   = dict().      
+0001ecb0: 2020 6966 2074 7970 6528 7374 796c 655f    if type(style_
+0001ecc0: 7374 7229 2069 7320 4353 5353 7479 6c65  str) is CSSStyle
+0001ecd0: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
+0001ece0: 796c 655f 7374 7220 3d20 7374 796c 655f  yle_str = style_
+0001ecf0: 7374 722e 6765 745f 6373 735f 7661 6c75  str.get_css_valu
+0001ed00: 6528 7374 796c 655f 7374 7229 0a20 2020  e(style_str).   
+0001ed10: 2020 2020 2069 6620 7374 796c 655f 7374       if style_st
+0001ed20: 723a 0a20 2020 2020 2020 2020 2020 2069  r:.            i
+0001ed30: 6620 7265 6d6f 7665 5f63 7572 6c79 3a0a  f remove_curly:.
+0001ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed50: 6d61 7463 6820 3d20 6375 726c 795f 7265  match = curly_re
+0001ed60: 2e6d 6174 6368 2873 7479 6c65 5f73 7472  .match(style_str
+0001ed70: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001ed80: 2020 6966 206d 6174 6368 3a0a 2020 2020    if match:.    
+0001ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001eda0: 7374 796c 655f 7374 7220 3d20 6d61 7463  style_str = matc
+0001edb0: 682e 6772 6f75 7028 2263 7572 6c79 2229  h.group("curly")
+0001edc0: 0a20 2020 2020 2020 2020 2020 206e 616d  .            nam
+0001edd0: 655f 7661 6c75 655f 6469 6374 203d 2063  e_value_dict = c
+0001ede0: 6c73 2e63 7265 6174 655f 6e61 6d65 5f76  ls.create_name_v
+0001edf0: 616c 7565 5f64 6963 7428 7374 796c 655f  alue_dict(style_
+0001ee00: 7374 7229 0a20 2020 2020 2020 2072 6574  str).        ret
+0001ee10: 7572 6e20 6e61 6d65 5f76 616c 7565 5f64  urn name_value_d
+0001ee20: 6963 740a 0a20 2020 2040 636c 6173 736d  ict..    @classm
+0001ee30: 6574 686f 640a 2020 2020 6465 6620 6372  ethod.    def cr
+0001ee40: 6561 7465 5f6e 616d 655f 7661 6c75 655f  eate_name_value_
+0001ee50: 6469 6374 2863 6c73 2c20 7374 796c 655f  dict(cls, style_
+0001ee60: 7374 7229 3a0a 2020 2020 2020 2020 6e61  str):.        na
+0001ee70: 6d65 5f76 616c 7565 5f64 6963 7420 3d20  me_value_dict = 
+0001ee80: 6469 6374 2829 0a20 2020 2020 2020 2073  dict().        s
+0001ee90: 7479 6c65 5f73 7472 203d 2073 7479 6c65  tyle_str = style
+0001eea0: 5f73 7472 2e73 7472 6970 2829 0a20 2020  _str.strip().   
+0001eeb0: 2020 2020 2073 7479 6c65 7320 3d20 7374       styles = st
+0001eec0: 796c 655f 7374 722e 7370 6c69 7428 223b  yle_str.split(";
+0001eed0: 2229 0a20 2020 2020 2020 2066 6f72 2073  ").        for s
+0001eee0: 7479 6c65 2069 6e20 7374 796c 6573 3a0a  tyle in styles:.
+0001eef0: 2020 2020 2020 2020 2020 2020 7374 796c              styl
+0001ef00: 6520 3d20 7374 796c 652e 7374 7269 7028  e = style.strip(
+0001ef10: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0001ef20: 206c 656e 2873 7479 6c65 2920 3e20 303a   len(style) > 0:
+0001ef30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ef40: 2073 7320 3d20 7374 796c 652e 7370 6c69   ss = style.spli
+0001ef50: 7428 223a 2229 0a20 2020 2020 2020 2020  t(":").         
+0001ef60: 2020 2020 2020 2069 6620 6c65 6e28 7373         if len(ss
+0001ef70: 2920 213d 2032 3a0a 2020 2020 2020 2020  ) != 2:.        
+0001ef80: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001ef90: 6520 4b65 7945 7272 6f72 2866 2262 6164  e KeyError(f"bad
+0001efa0: 2073 7479 6c65 207b 7374 796c 657d 2069   style {style} i
+0001efb0: 6e20 4353 533a 207b 7374 796c 655f 7374  n CSS: {style_st
+0001efc0: 727d 2229 0a20 2020 2020 2020 2020 2020  r}").           
+0001efd0: 2020 2020 206e 616d 6520 3d20 7373 5b30       name = ss[0
+0001efe0: 5d2e 7374 7269 7028 290a 2020 2020 2020  ].strip().      
+0001eff0: 2020 2020 2020 2020 2020 6966 206e 616d            if nam
+0001f000: 6520 696e 206e 616d 655f 7661 6c75 655f  e in name_value_
+0001f010: 6469 6374 3a0a 2020 2020 2020 2020 2020  dict:.          
+0001f020: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001f030: 4b65 7945 7272 6f72 2866 227b 6e61 6d65  KeyError(f"{name
+0001f040: 7d20 6475 706c 6963 6174 6564 2069 6e20  } duplicated in 
+0001f050: 4353 533a 207b 7374 796c 655f 7374 727d  CSS: {style_str}
+0001f060: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001f070: 2020 206e 616d 655f 7661 6c75 655f 6469     name_value_di
+0001f080: 6374 5b6e 616d 655d 203d 2073 735b 315d  ct[name] = ss[1]
+0001f090: 2e73 7472 6970 2829 0a20 2020 2020 2020  .strip().       
+0001f0a0: 2072 6574 7572 6e20 6e61 6d65 5f76 616c   return name_val
+0001f0b0: 7565 5f64 6963 740a 0a20 2020 2023 2020  ue_dict..    #  
+0001f0c0: 2020 636c 6173 7320 4353 5353 7479 6c65    class CSSStyle
+0001f0d0: 3a0a 0a20 2020 2040 636c 6173 736d 6574  :..    @classmet
+0001f0e0: 686f 640a 2020 2020 6465 6620 6372 6561  hod.    def crea
+0001f0f0: 7465 5f63 7373 5f73 7479 6c65 5f66 726f  te_css_style_fro
+0001f100: 6d5f 6373 735f 7374 7269 6e67 2863 6c73  m_css_string(cls
+0001f110: 2c20 6373 735f 7374 7269 6e67 2c20 7265  , css_string, re
+0001f120: 6d6f 7665 5f70 7265 6669 783d 5472 7565  move_prefix=True
+0001f130: 293a 0a20 2020 2020 2020 2022 2222 6372  ):.        """cr
+0001f140: 6561 7465 7320 4353 5353 7479 6c65 206f  eates CSSStyle o
+0001f150: 626a 6563 7420 6672 6f6d 2043 5353 2073  bject from CSS s
+0001f160: 7472 696e 6722 2222 0a20 2020 2020 2020  tring""".       
+0001f170: 2063 7373 5f73 7479 6c65 203d 204e 6f6e   css_style = Non
+0001f180: 650a 2020 2020 2020 2020 6966 2063 7373  e.        if css
+0001f190: 5f73 7472 696e 673a 0a20 2020 2020 2020  _string:.       
+0001f1a0: 2020 2020 2063 7373 5f73 7479 6c65 203d       css_style =
+0001f1b0: 2043 5353 5374 796c 6528 290a 2020 2020   CSSStyle().    
+0001f1c0: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
+0001f1d0: 652e 6e61 6d65 5f76 616c 7565 5f64 6963  e.name_value_dic
+0001f1e0: 7420 3d20 636c 732e 6372 6561 7465 5f64  t = cls.create_d
+0001f1f0: 6963 745f 6672 6f6d 5f6e 616d 655f 7661  ict_from_name_va
+0001f200: 6c75 655f 6172 7261 795f 7374 7269 6e67  lue_array_string
+0001f210: 2863 7373 5f73 7472 696e 6729 0a20 2020  (css_string).   
+0001f220: 2020 2020 2020 2020 2069 6620 7265 6d6f           if remo
+0001f230: 7665 5f70 7265 6669 783a 0a20 2020 2020  ve_prefix:.     
+0001f240: 2020 2020 2020 2020 2020 2066 6f6e 745f             font_
+0001f250: 6661 6d69 6c79 203d 2063 7373 5f73 7479  family = css_sty
+0001f260: 6c65 2e6e 616d 655f 7661 6c75 655f 6469  le.name_value_di
+0001f270: 6374 2e67 6574 2843 5353 5374 796c 652e  ct.get(CSSStyle.
+0001f280: 464f 4e54 5f46 414d 494c 5929 0a20 2020  FONT_FAMILY).   
+0001f290: 2020 2020 2020 2020 2020 2020 2066 6f6e               fon
+0001f2a0: 745f 6661 6d69 6c79 3120 3d20 416d 6946  t_family1 = AmiF
+0001f2b0: 6f6e 742e 7472 696d 5f70 6466 5f70 7265  ont.trim_pdf_pre
+0001f2c0: 6669 7828 666f 6e74 5f66 616d 696c 7929  fix(font_family)
+0001f2d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f2e0: 2069 6620 666f 6e74 5f66 616d 696c 7931   if font_family1
+0001f2f0: 2061 6e64 2066 6f6e 745f 6661 6d69 6c79   and font_family
+0001f300: 3120 213d 2066 6f6e 745f 6661 6d69 6c79  1 != font_family
+0001f310: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001f320: 2020 2020 2020 6373 735f 7374 796c 652e        css_style.
+0001f330: 6e61 6d65 5f76 616c 7565 5f64 6963 745b  name_value_dict[
+0001f340: 4353 5353 7479 6c65 2e46 4f4e 545f 4641  CSSStyle.FONT_FA
+0001f350: 4d49 4c59 5d20 3d20 666f 6e74 5f66 616d  MILY] = font_fam
+0001f360: 696c 7931 0a20 2020 2020 2020 2072 6574  ily1.        ret
+0001f370: 7572 6e20 6373 735f 7374 796c 650a 0a20  urn css_style.. 
+0001f380: 2020 2064 6566 205f 5f65 715f 5f28 7365     def __eq__(se
+0001f390: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
+0001f3a0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001f3b0: 7465 7374 7320 7768 6574 6865 7220 7365  tests whether se
+0001f3c0: 6c66 2061 6e64 206f 7468 6572 2068 6176  lf and other hav
+0001f3d0: 6520 6571 7561 6c20 6469 6374 696f 6e61  e equal dictiona
+0001f3e0: 7269 6573 0a20 2020 2020 2020 2022 2222  ries.        """
+0001f3f0: 0a20 2020 2020 2020 2069 6620 7479 7065  .        if type
+0001f400: 286f 7468 6572 2920 6973 2043 5353 5374  (other) is CSSSt
+0001f410: 796c 653a 0a20 2020 2020 2020 2020 2020  yle:.           
+0001f420: 2072 6574 7572 6e20 7365 6c66 2e6e 616d   return self.nam
+0001f430: 655f 7661 6c75 655f 6469 6374 203d 3d20  e_value_dict == 
+0001f440: 6f74 6865 722e 6e61 6d65 5f76 616c 7565  other.name_value
+0001f450: 5f64 6963 740a 2020 2020 2020 2020 7265  _dict.        re
+0001f460: 7475 726e 2046 616c 7365 0a0a 0a20 2020  turn False...   
+0001f470: 2064 6566 2073 6574 5f61 7474 7269 6275   def set_attribu
+0001f480: 7465 2873 656c 662c 2070 726f 7065 7274  te(self, propert
+0001f490: 792c 2076 616c 7565 293a 0a20 2020 2020  y, value):.     
+0001f4a0: 2020 2022 2222 0a20 2020 2020 2020 2073     """.        s
+0001f4b0: 6574 7320 6e61 6d65 2d76 616c 7565 2070  ets name-value p
+0001f4c0: 6169 7220 696e 2043 5353 5374 796c 650a  air in CSSStyle.
+0001f4d0: 2020 2020 2020 2020 6967 6e6f 7265 7320          ignores 
+0001f4e0: 656d 7074 7920 7661 6c75 6573 206f 7220  empty values or 
+0001f4f0: 4e6f 6e65 0a20 2020 2020 2020 2022 2222  None.        """
+0001f500: 0a20 2020 2020 2020 2069 6620 7661 6c75  .        if valu
+0001f510: 6520 616e 6420 6c65 6e28 7374 7228 7661  e and len(str(va
+0001f520: 6c75 6529 2920 3e20 303a 0a20 2020 2020  lue)) > 0:.     
+0001f530: 2020 2020 2020 2073 656c 662e 6e61 6d65         self.name
+0001f540: 5f76 616c 7565 5f64 6963 745b 7072 6f70  _value_dict[prop
+0001f550: 6572 7479 5d20 3d20 7661 6c75 650a 0a20  erty] = value.. 
+0001f560: 2020 2064 6566 2073 6574 5f66 616d 696c     def set_famil
+0001f570: 7928 7365 6c66 2c20 6661 6d69 6c79 293a  y(self, family):
+0001f580: 0a20 2020 2020 2020 2069 6620 6661 6d69  .        if fami
+0001f590: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+0001f5a0: 7365 6c66 2e73 6574 5f61 7474 7269 6275  self.set_attribu
+0001f5b0: 7465 2843 5353 5374 796c 652e 464f 4e54  te(CSSStyle.FONT
+0001f5c0: 5f46 414d 494c 592c 2066 616d 696c 7929  _FAMILY, family)
+0001f5d0: 0a0a 2020 2020 6465 6620 7365 745f 666f  ..    def set_fo
+0001f5e0: 6e74 5f77 6569 6768 7428 7365 6c66 2c20  nt_weight(self, 
+0001f5f0: 7765 6967 6874 293a 0a20 2020 2020 2020  weight):.       
+0001f600: 2077 6569 6768 7420 3d20 7765 6967 6874   weight = weight
+0001f610: 2e6c 6f77 6572 2829 0a20 2020 2020 2020  .lower().       
+0001f620: 2069 6620 7765 6967 6874 3a0a 2020 2020   if weight:.    
+0001f630: 2020 2020 2020 2020 6966 2077 6569 6768          if weigh
+0001f640: 7420 3d3d 2043 5353 5374 796c 652e 4e4f  t == CSSStyle.NO
+0001f650: 524d 414c 3a0a 2020 2020 2020 2020 2020  RMAL:.          
+0001f660: 2020 2020 2020 7365 6c66 2e73 6574 5f61        self.set_a
+0001f670: 7474 7269 6275 7465 2843 5353 5374 796c  ttribute(CSSStyl
+0001f680: 652e 464f 4e54 5f57 4549 4748 542c 2043  e.FONT_WEIGHT, C
+0001f690: 5353 5374 796c 652e 4e4f 524d 414c 290a  SSStyle.NORMAL).
+0001f6a0: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+0001f6b0: 6569 6768 7420 3d3d 2043 5353 5374 796c  eight == CSSStyl
+0001f6c0: 652e 424f 4c44 3a0a 2020 2020 2020 2020  e.BOLD:.        
+0001f6d0: 2020 2020 2020 2020 7365 6c66 2e73 6574          self.set
+0001f6e0: 5f61 7474 7269 6275 7465 2843 5353 5374  _attribute(CSSSt
+0001f6f0: 796c 652e 464f 4e54 5f57 4549 4748 542c  yle.FONT_WEIGHT,
+0001f700: 2043 5353 5374 796c 652e 424f 4c44 290a   CSSStyle.BOLD).
+0001f710: 2020 2020 2020 2020 2020 2020 6966 2077              if w
+0001f720: 6569 6768 7420 3d3d 2043 5353 5374 796c  eight == CSSStyl
+0001f730: 652e 4c49 4748 543a 0a20 2020 2020 2020  e.LIGHT:.       
+0001f740: 2020 2020 2020 2020 2073 656c 662e 7365           self.se
+0001f750: 745f 6174 7472 6962 7574 6528 4353 5353  t_attribute(CSSS
+0001f760: 7479 6c65 2e46 4f4e 545f 5745 4947 4854  tyle.FONT_WEIGHT
+0001f770: 2c20 4353 5353 7479 6c65 2e4c 4947 4854  , CSSStyle.LIGHT
+0001f780: 290a 0a20 2020 2064 6566 2073 6574 5f66  )..    def set_f
+0001f790: 6f6e 745f 7374 796c 6528 7365 6c66 2c20  ont_style(self, 
+0001f7a0: 7374 796c 6529 3a0a 2020 2020 2020 2020  style):.        
+0001f7b0: 6966 2073 7479 6c65 3a0a 2020 2020 2020  if style:.      
+0001f7c0: 2020 2020 2020 6966 2073 7479 6c65 2e6c        if style.l
+0001f7d0: 6f77 6572 2829 203d 3d20 4353 5353 7479  ower() == CSSSty
+0001f7e0: 6c65 2e4e 4f52 4d41 4c2e 6c6f 7765 7228  le.NORMAL.lower(
+0001f7f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001f800: 2020 2073 656c 662e 7365 745f 6174 7472     self.set_attr
+0001f810: 6962 7574 6528 4353 5353 7479 6c65 2e46  ibute(CSSStyle.F
+0001f820: 4f4e 545f 5354 594c 452c 2043 5353 5374  ONT_STYLE, CSSSt
+0001f830: 796c 652e 4e4f 524d 414c 290a 2020 2020  yle.NORMAL).    
+0001f840: 2020 2020 2020 2020 6966 2073 7479 6c65          if style
+0001f850: 2e6c 6f77 6572 2829 203d 3d20 4353 5353  .lower() == CSSS
+0001f860: 7479 6c65 2e49 5441 4c49 432e 6c6f 7765  tyle.ITALIC.lowe
+0001f870: 7228 293a 0a20 2020 2020 2020 2020 2020  r():.           
+0001f880: 2020 2020 2073 656c 662e 7365 745f 6174       self.set_at
+0001f890: 7472 6962 7574 6528 4353 5353 7479 6c65  tribute(CSSStyle
+0001f8a0: 2e46 4f4e 545f 5354 594c 452c 2043 5353  .FONT_STYLE, CSS
+0001f8b0: 5374 796c 652e 4954 414c 4943 290a 0a20  Style.ITALIC).. 
+0001f8c0: 2020 2064 6566 2067 6574 5f61 7474 7269     def get_attri
+0001f8d0: 6275 7465 2873 656c 662c 2070 726f 7065  bute(self, prope
+0001f8e0: 7274 7929 3a0a 2020 2020 2020 2020 2222  rty):.        ""
+0001f8f0: 220a 2020 2020 2020 2020 6765 7473 2076  ".        gets v
+0001f900: 616c 7565 2066 6f72 206e 616d 6520 696e  alue for name in
+0001f910: 2043 5353 5374 796c 650a 2020 2020 2020   CSSStyle.      
+0001f920: 2020 6967 6e6f 7265 7320 656d 7074 7920    ignores empty 
+0001f930: 7661 6c75 6573 206f 7220 4e6f 6e65 0a20  values or None. 
+0001f940: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001f950: 2020 2072 6574 7572 6e20 7365 6c66 2e6e     return self.n
+0001f960: 616d 655f 7661 6c75 655f 6469 6374 2061  ame_value_dict a
+0001f970: 6e64 2073 656c 662e 6e61 6d65 5f76 616c  nd self.name_val
+0001f980: 7565 5f64 6963 742e 6765 7428 7072 6f70  ue_dict.get(prop
+0001f990: 6572 7479 290a 0a20 2020 2023 2020 2020  erty)..    #    
+0001f9a0: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
+0001f9b0: 0a20 2020 2064 6566 2067 6574 5f66 6f6e  .    def get_fon
+0001f9c0: 745f 7374 796c 655f 6174 7472 6962 7574  t_style_attribut
+0001f9d0: 6573 2873 656c 6629 3a0a 2020 2020 2020  es(self):.      
+0001f9e0: 2020 2222 220a 2020 2020 2020 2020 6765    """.        ge
+0001f9f0: 7473 2074 7570 6c65 206f 6620 3420 666f  ts tuple of 4 fo
+0001fa00: 6e74 2061 7474 7269 6275 7465 7320 2873  nt attributes (s
+0001fa10: 697a 652c 206e 6f6e 7374 726f 6b65 2c20  ize, nonstroke, 
+0001fa20: 7374 726f 6b65 2c20 666f 6e74 6e61 6d65  stroke, fontname
+0001fa30: 290a 2020 2020 2020 2020 2222 220a 0a20  ).        """.. 
+0001fa40: 2020 2020 2020 2069 6620 7365 6c66 2e6e         if self.n
+0001fa50: 616d 655f 7661 6c75 655f 6469 6374 2069  ame_value_dict i
+0001fa60: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001fa70: 2020 2020 7265 7475 726e 2028 4e6f 6e65      return (None
+0001fa80: 2c20 4e6f 6e65 2c20 4e6f 6e65 2c20 4e6f  , None, None, No
+0001fa90: 6e65 2c20 4e6f 6e65 290a 2020 2020 2020  ne, None).      
+0001faa0: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
+0001fab0: 2020 2020 2020 2023 2073 656c 662e 6e61         # self.na
+0001fac0: 6d65 5f76 616c 7565 5f64 6963 742e 6765  me_value_dict.ge
+0001fad0: 7428 4353 5353 7479 6c65 2e57 4944 5448  t(CSSStyle.WIDTH
+0001fae0: 292c 0a20 2020 2020 2020 2020 2020 2073  ),.            s
+0001faf0: 656c 662e 6765 745f 6174 7472 6962 7574  elf.get_attribut
+0001fb00: 6528 4353 5353 7479 6c65 2e46 4f4e 545f  e(CSSStyle.FONT_
+0001fb10: 5349 5a45 292c 0a20 2020 2020 2020 2020  SIZE),.         
+0001fb20: 2020 2073 656c 662e 6765 745f 6174 7472     self.get_attr
+0001fb30: 6962 7574 6528 4353 5353 7479 6c65 2e46  ibute(CSSStyle.F
+0001fb40: 494c 4c29 2c0a 2020 2020 2020 2020 2020  ILL),.          
+0001fb50: 2020 7365 6c66 2e67 6574 5f61 7474 7269    self.get_attri
+0001fb60: 6275 7465 2843 5353 5374 796c 652e 5354  bute(CSSStyle.ST
+0001fb70: 524f 4b45 292c 0a20 2020 2020 2020 2020  ROKE),.         
+0001fb80: 2020 2073 656c 662e 6765 745f 6174 7472     self.get_attr
+0001fb90: 6962 7574 6528 4353 5353 7479 6c65 2e46  ibute(CSSStyle.F
+0001fba0: 4f4e 545f 4641 4d49 4c59 290a 2020 2020  ONT_FAMILY).    
+0001fbb0: 2020 2020 290a 0a20 2020 2023 2020 2020      )..    #    
+0001fbc0: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
+0001fbd0: 0a20 2020 2064 6566 2072 656d 6f76 6528  .    def remove(
+0001fbe0: 7365 6c66 2c20 6e61 6d65 293a 0a20 2020  self, name):.   
+0001fbf0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001fc00: 2072 656d 6f76 6573 206e 616d 6564 2069   removes named i
+0001fc10: 7465 6d20 6672 6f6d 2043 5353 5374 796c  tem from CSSStyl
+0001fc20: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+0001fc30: 2020 2020 2020 6966 2074 7970 6528 6e61        if type(na
+0001fc40: 6d65 2920 6973 206c 6973 743a 0a20 2020  me) is list:.   
+0001fc50: 2020 2020 2020 2020 2066 6f72 206e 2069           for n i
+0001fc60: 6e20 6e61 6d65 3a0a 2020 2020 2020 2020  n name:.        
+0001fc70: 2020 2020 2020 2020 7365 6c66 2e72 656d          self.rem
+0001fc80: 6f76 6528 6e29 0a20 2020 2020 2020 2065  ove(n).        e
+0001fc90: 6c69 6620 6e61 6d65 2069 6e20 7365 6c66  lif name in self
+0001fca0: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
+0001fcb0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0001fcc0: 6c66 2e6e 616d 655f 7661 6c75 655f 6469  lf.name_value_di
+0001fcd0: 6374 2e70 6f70 286e 616d 652c 204e 6f6e  ct.pop(name, Non
+0001fce0: 6529 0a0a 2020 2020 6465 6620 6170 706c  e)..    def appl
+0001fcf0: 795f 746f 2873 656c 662c 2065 6c65 6d29  y_to(self, elem)
+0001fd00: 3a0a 2020 2020 2020 2020 2222 220a 0a20  :.        """.. 
+0001fd10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001fd20: 2020 2063 7373 5f73 7472 203d 2073 656c     css_str = sel
+0001fd30: 662e 6765 745f 6373 735f 7661 6c75 6528  f.get_css_value(
+0001fd40: 290a 2020 2020 2020 2020 656c 656d 2e61  ).        elem.a
+0001fd50: 7474 7269 625b 4353 5353 7479 6c65 2e53  ttrib[CSSStyle.S
+0001fd60: 5459 4c45 5d20 3d20 6373 735f 7374 720a  TYLE] = css_str.
+0001fd70: 0a20 2020 2023 2020 2020 636c 6173 7320  .    #    class 
+0001fd80: 4353 5353 7479 6c65 3a0a 0a20 2020 2064  CSSStyle:..    d
+0001fd90: 6566 2067 6574 5f63 7373 5f76 616c 7565  ef get_css_value
+0001fda0: 2873 656c 662c 2077 7261 705f 7769 7468  (self, wrap_with
+0001fdb0: 5f63 7572 6c79 3d46 616c 7365 293a 0a20  _curly=False):. 
+0001fdc0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001fdd0: 2020 2067 656e 6572 6174 6573 2063 7373     generates css
+0001fde0: 2073 7472 696e 6720 7769 7468 6f75 7420   string without 
+0001fdf0: 7175 6f74 6564 206e 616d 6573 2061 6e64  quoted names and
+0001fe00: 2076 616c 7565 730a 2020 2020 2020 2020   values.        
+0001fe10: 3a70 6172 616d 2077 7261 705f 7769 7468  :param wrap_with
+0001fe20: 5f63 7572 6c79 3a20 6966 2074 7275 6520  _curly: if true 
+0001fe30: 656e 636c 6f73 6520 7374 7269 6e67 2069  enclose string i
+0001fe40: 6e20 227b 2220 2e2e 2e20 227d 220a 2020  n "{" ... "}".  
+0001fe50: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001fe60: 2020 7320 3d20 2222 0a20 2020 2020 2020    s = "".       
+0001fe70: 2066 6f72 206b 6579 2069 6e20 7365 6c66   for key in self
+0001fe80: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
+0001fe90: 3a0a 2020 2020 2020 2020 2020 2020 7661  :.            va
+0001fea0: 6c20 3d20 7365 6c66 2e6e 616d 655f 7661  l = self.name_va
+0001feb0: 6c75 655f 6469 6374 5b6b 6579 5d0a 2020  lue_dict[key].  
+0001fec0: 2020 2020 2020 2020 2020 7320 2b3d 206b            s += k
+0001fed0: 6579 202b 2022 3a20 2220 2b20 7374 7228  ey + ": " + str(
+0001fee0: 7661 6c29 202b 2022 3b20 220a 2020 2020  val) + "; ".    
+0001fef0: 2020 2020 7320 3d20 732e 7374 7269 7028      s = s.strip(
+0001ff00: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001ff10: 2022 7b22 202b 2073 202b 2022 7d22 2069   "{" + s + "}" i
+0001ff20: 6620 7772 6170 5f77 6974 685f 6375 726c  f wrap_with_curl
+0001ff30: 7920 656c 7365 2073 0a0a 2020 2020 6465  y else s..    de
+0001ff40: 6620 6174 7476 616c 2873 656c 662c 206e  f attval(self, n
+0001ff50: 616d 6529 3a0a 2020 2020 2020 2020 7265  ame):.        re
+0001ff60: 7475 726e 2073 656c 662e 6e61 6d65 5f76  turn self.name_v
+0001ff70: 616c 7565 5f64 6963 742e 6765 7428 6e61  alue_dict.get(na
+0001ff80: 6d65 2920 6966 2073 656c 662e 6e61 6d65  me) if self.name
+0001ff90: 5f76 616c 7565 5f64 6963 7420 656c 7365  _value_dict else
+0001ffa0: 204e 6f6e 650a 0a20 2020 2023 2020 2020   None..    #    
+0001ffb0: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
+0001ffc0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+0001ffd0: 2020 2064 6566 2066 6f6e 745f 6661 6d69     def font_fami
+0001ffe0: 6c79 2873 656c 6629 3a0a 2020 2020 2020  ly(self):.      
+0001fff0: 2020 7265 7475 726e 2073 656c 662e 6174    return self.at
+00020000: 7476 616c 2843 5353 5374 796c 652e 464f  tval(CSSStyle.FO
+00020010: 4e54 5f46 414d 494c 5929 0a0a 2020 2020  NT_FAMILY)..    
+00020020: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00020030: 6620 746f 7028 7365 6c66 293a 0a20 2020  f top(self):.   
+00020040: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00020050: 2e67 6574 5f6e 756d 6572 6963 5f61 7474  .get_numeric_att
+00020060: 7661 6c28 4353 5353 7479 6c65 2e54 4f50  val(CSSStyle.TOP
+00020070: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+00020080: 0a20 2020 2064 6566 2066 6f6e 745f 7369  .    def font_si
+00020090: 7a65 2873 656c 6629 3a0a 2020 2020 2020  ze(self):.      
+000200a0: 2020 7265 7475 726e 2073 656c 662e 6765    return self.ge
+000200b0: 745f 6e75 6d65 7269 635f 6174 7476 616c  t_numeric_attval
+000200c0: 2843 5353 5374 796c 652e 464f 4e54 5f53  (CSSStyle.FONT_S
+000200d0: 495a 4529 0a0a 2020 2020 4070 726f 7065  IZE)..    @prope
+000200e0: 7274 790a 2020 2020 6465 6620 6973 5f62  rty.    def is_b
+000200f0: 6f6c 6428 7365 6c66 293a 0a20 2020 2020  old(self):.     
+00020100: 2020 2077 6569 6768 7420 3d20 7365 6c66     weight = self
+00020110: 2e61 7474 7661 6c28 4353 5353 7479 6c65  .attval(CSSStyle
+00020120: 2e46 4f4e 545f 5745 4947 4854 290a 2020  .FONT_WEIGHT).  
+00020130: 2020 2020 2020 7265 7475 726e 2077 6569        return wei
+00020140: 6768 7420 6973 206e 6f74 204e 6f6e 6520  ght is not None 
+00020150: 616e 6420 7765 6967 6874 2e6c 6f77 6572  and weight.lower
+00020160: 2829 203d 3d20 4353 5353 7479 6c65 2e42  () == CSSStyle.B
+00020170: 4f4c 442e 6c6f 7765 7228 290a 0a20 2020  OLD.lower()..   
+00020180: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+00020190: 6566 2069 735f 6974 616c 6963 2873 656c  ef is_italic(sel
+000201a0: 6629 3a0a 2020 2020 2020 2020 7374 796c  f):.        styl
+000201b0: 6520 3d20 7365 6c66 2e61 7474 7661 6c28  e = self.attval(
+000201c0: 4353 5353 7479 6c65 2e46 4f4e 545f 5354  CSSStyle.FONT_ST
+000201d0: 594c 4529 0a20 2020 2020 2020 2072 6574  YLE).        ret
+000201e0: 7572 6e20 7374 796c 6520 6973 206e 6f74  urn style is not
+000201f0: 204e 6f6e 6520 616e 6420 7374 796c 652e   None and style.
+00020200: 6c6f 7765 7228 2920 3d3d 2043 5353 5374  lower() == CSSSt
+00020210: 796c 652e 4954 414c 4943 2e6c 6f77 6572  yle.ITALIC.lower
+00020220: 2829 0a0a 2020 2020 4070 726f 7065 7274  ()..    @propert
+00020230: 790a 2020 2020 6465 6620 626f 7474 6f6d  y.    def bottom
+00020240: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00020250: 7265 7475 726e 2073 656c 662e 6765 745f  return self.get_
+00020260: 6e75 6d65 7269 635f 6174 7476 616c 2843  numeric_attval(C
+00020270: 5353 5374 796c 652e 424f 5454 4f4d 290a  SSStyle.BOTTOM).
+00020280: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+00020290: 2020 2064 6566 206c 6566 7428 7365 6c66     def left(self
+000202a0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+000202b0: 6e20 7365 6c66 2e67 6574 5f6e 756d 6572  n self.get_numer
+000202c0: 6963 5f61 7474 7661 6c28 4353 5353 7479  ic_attval(CSSSty
+000202d0: 6c65 2e4c 4546 5429 0a0a 2020 2020 2320  le.LEFT)..    # 
+000202e0: 2020 2063 6c61 7373 2043 5353 5374 796c     class CSSStyl
+000202f0: 653a 0a0a 2020 2020 4070 726f 7065 7274  e:..    @propert
+00020300: 790a 2020 2020 6465 6620 7769 6474 6828  y.    def width(
+00020310: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+00020320: 6574 7572 6e20 7365 6c66 2e67 6574 5f6e  eturn self.get_n
+00020330: 756d 6572 6963 5f61 7474 7661 6c28 4353  umeric_attval(CS
+00020340: 5353 7479 6c65 2e57 4944 5448 290a 0a20  SStyle.WIDTH).. 
+00020350: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+00020360: 2064 6566 2068 6569 6768 7428 7365 6c66   def height(self
+00020370: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00020380: 6e20 7365 6c66 2e67 6574 5f6e 756d 6572  n self.get_numer
+00020390: 6963 5f61 7474 7661 6c28 4353 5353 7479  ic_attval(CSSSty
+000203a0: 6c65 2e48 4549 4748 5429 0a0a 2020 2020  le.HEIGHT)..    
+000203b0: 2320 2020 2063 6c61 7373 2043 5353 5374  #    class CSSSt
+000203c0: 796c 653a 0a0a 2020 2020 4063 6c61 7373  yle:..    @class
+000203d0: 6d65 7468 6f64 0a20 2020 2064 6566 2061  method.    def a
+000203e0: 6464 5f6e 616d 655f 7661 6c75 6528 636c  dd_name_value(cl
+000203f0: 732c 2065 6c65 6d2c 2063 7373 5f6e 616d  s, elem, css_nam
+00020400: 652c 2063 7373 5f76 616c 7565 293a 0a20  e, css_value):. 
+00020410: 2020 2020 2020 2022 2222 7570 6461 7465         """update
+00020420: 7320 7374 796c 6520 6f6e 2065 6c65 6d65  s style on eleme
+00020430: 6e74 0a20 2020 2020 2020 203a 7061 7261  nt.        :para
+00020440: 6d20 6373 735f 6e61 6d65 3a20 6e61 6d65  m css_name: name
+00020450: 206f 6620 7072 6f70 6572 7479 0a20 2020   of property.   
+00020460: 2020 2020 203a 7061 7261 6d20 6373 735f       :param css_
+00020470: 7661 6c75 653a 2076 616c 7565 206f 6620  value: value of 
+00020480: 7072 6f70 6572 7479 0a20 2020 2020 2020  property.       
+00020490: 2022 2222 0a20 2020 2020 2020 2063 7373   """.        css
+000204a0: 5f73 7479 6c65 203d 2063 6c73 2e63 7265  _style = cls.cre
+000204b0: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
+000204c0: 6f6d 5f61 7474 7269 6275 7465 5f6f 665f  om_attribute_of_
+000204d0: 626f 6479 5f65 6c65 6d65 6e74 2865 6c65  body_element(ele
+000204e0: 6d29 0a20 2020 2020 2020 2063 7373 5f73  m).        css_s
+000204f0: 7479 6c65 2e6e 616d 655f 7661 6c75 655f  tyle.name_value_
+00020500: 6469 6374 5b63 7373 5f6e 616d 655d 203d  dict[css_name] =
+00020510: 2063 7373 5f76 616c 7565 0a20 2020 2020   css_value.     
+00020520: 2020 2063 7373 5f73 7479 6c65 2e61 7070     css_style.app
+00020530: 6c79 5f74 6f28 656c 656d 290a 0a20 2020  ly_to(elem)..   
+00020540: 2064 6566 2067 6574 5f6e 756d 6572 6963   def get_numeric
+00020550: 5f61 7474 7661 6c28 7365 6c66 2c20 6e61  _attval(self, na
+00020560: 6d65 2c20 6465 6369 6d61 6c3d 3129 3a0a  me, decimal=1):.
+00020570: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00020580: 2020 2020 6765 7473 2066 6c6f 6174 2076      gets float v
+00020590: 616c 7565 2c20 726f 756e 6465 6420 746f  alue, rounded to
+000205a0: 2064 656d 6963 616c 2070 6c61 6265 730a   demical plabes.
+000205b0: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
+000205c0: 616d 653a 206f 6620 7061 7261 6d65 7465  ame: of paramete
+000205d0: 720a 2020 2020 2020 2020 3a70 6172 616d  r.        :param
+000205e0: 2072 6f75 6e64 3a20 6e75 6d62 6572 206f   round: number o
+000205f0: 6620 6465 6369 6d61 6c20 706c 6163 6573  f decimal places
+00020600: 2028 6465 6661 756c 7420 3229 0a20 2020   (default 2).   
+00020610: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00020620: 2076 616c 7565 203d 2073 656c 662e 6174   value = self.at
+00020630: 7476 616c 286e 616d 6529 0a20 2020 2020  tval(name).     
+00020640: 2020 2069 6620 6e6f 7420 7661 6c75 653a     if not value:
+00020650: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00020660: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+00020670: 2069 6620 7479 7065 2876 616c 7565 2920   if type(value) 
+00020680: 6973 2073 7472 3a0a 2020 2020 2020 2020  is str:.        
+00020690: 2020 2020 7661 6c75 6520 3d20 7661 6c75      value = valu
+000206a0: 655b 3a2d 325d 2069 6620 7661 6c75 652e  e[:-2] if value.
+000206b0: 656e 6473 7769 7468 2843 5353 5374 796c  endswith(CSSStyl
+000206c0: 652e 5058 2920 656c 7365 2076 616c 7565  e.PX) else value
+000206d0: 0a20 2020 2020 2020 2020 2020 2076 616c  .            val
+000206e0: 7565 203d 2066 6c6f 6174 2876 616c 7565  ue = float(value
+000206f0: 290a 0a20 2020 2020 2020 2066 7320 3d20  )..        fs = 
+00020700: 726f 756e 6428 666c 6f61 7428 7661 6c75  round(float(valu
+00020710: 6529 2c20 6465 6369 6d61 6c29 0a20 2020  e), decimal).   
+00020720: 2020 2020 2072 6574 7572 6e20 6673 0a0a       return fs..
+00020730: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
+00020740: 5353 5374 796c 653a 0a0a 2020 2020 6465  SSStyle:..    de
+00020750: 6620 6973 5f62 6f6c 645f 6e61 6d65 2873  f is_bold_name(s
+00020760: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00020770: 2248 6575 7269 7374 6963 2075 7369 6e67  "Heuristic using
+00020780: 2066 6f6e 742d 6e61 6d65 0a20 2020 2020   font-name.     
+00020790: 2020 203a 7265 7475 726e 3a20 5472 7565     :return: True
+000207a0: 2069 6620 6e61 6d65 2063 6f6e 7461 696e   if name contain
+000207b0: 7320 2242 6f6c 6422 206f 7220 222e 4222  s "Bold" or ".B"
+000207c0: 206f 7220 2e2e 2222 220a 2020 2020 2020   or ..""".      
+000207d0: 2020 666f 6e74 6e61 6d65 203d 2073 656c    fontname = sel
+000207e0: 662e 666f 6e74 5f66 616d 696c 790a 2020  f.font_family.  
+000207f0: 2020 2020 2020 7265 7375 6c74 203d 2028        result = (
+00020800: 7365 6c66 2e42 4f4c 4420 696e 2066 6f6e  self.BOLD in fon
+00020810: 746e 616d 6529 206f 7220 2866 6f6e 746e  tname) or (fontn
+00020820: 616d 652e 656e 6473 7769 7468 2873 656c  ame.endswith(sel
+00020830: 662e 444f 545f 4229 2920 6966 2066 6f6e  f.DOT_B)) if fon
+00020840: 746e 616d 6520 656c 7365 2046 616c 7365  tname else False
+00020850: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00020860: 7265 7375 6c74 0a0a 2020 2020 2320 2020  result..    #   
+00020870: 2063 6c61 7373 2043 5353 5374 796c 653a   class CSSStyle:
+00020880: 0a0a 2020 2020 6465 6620 6f62 6579 7328  ..    def obeys(
+00020890: 7365 6c66 2c20 636f 6e64 6974 696f 6e29  self, condition)
+000208a0: 3a0a 2020 2020 2020 2020 2222 2274 6573  :.        """tes
+000208b0: 7420 6966 2073 7479 6c65 206f 6265 7973  t if style obeys
+000208c0: 2061 2028 7369 6d70 6c65 2920 636f 6e64   a (simple) cond
+000208d0: 6974 696f 6e0a 2020 2020 2020 2020 2849  ition.        (I
+000208e0: 276c 6c20 7772 6974 6520 6120 4453 4c20  'll write a DSL 
+000208f0: 6c61 7465 7229 0a20 2020 2020 2020 203a  later).        :
+00020900: 7061 7261 6d20 636f 6e64 6974 696f 6e3a  param condition:
+00020910: 2028 6e61 6d65 2c20 6f70 6572 6174 6f72   (name, operator
+00020920: 2c20 7661 6c75 6529 2c20 652e 672e 2022  , value), e.g. "
+00020930: 666f 6e74 2d73 697a 653e 3130 0a20 2020  font-size>10.   
+00020940: 2020 2020 203a 7265 7475 726e 3a20 7465       :return: te
+00020950: 7374 206f 6620 636f 6e64 6974 696f 6e0a  st of condition.
+00020960: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00020970: 2020 2020 2072 6573 756c 7420 3d20 4661       result = Fa
+00020980: 6c73 650a 2020 2020 2020 2020 6966 2063  lse.        if c
+00020990: 6f6e 6469 7469 6f6e 3a0a 2020 2020 2020  ondition:.      
+000209a0: 2020 2020 2020 7373 203d 2072 652e 7370        ss = re.sp
+000209b0: 6c69 7428 2728 3e7c 3c7c 3d3d 7c21 3d29  lit('(>|<|==|!=)
+000209c0: 272c 2063 6f6e 6469 7469 6f6e 290a 2020  ', condition).  
+000209d0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+000209e0: 2873 7329 2021 3d20 333a 0a20 2020 2020  (ss) != 3:.     
+000209f0: 2020 2020 2020 2020 2020 206c 6f67 6769             loggi
+00020a00: 6e67 2e77 6172 6e69 6e67 2866 2243 616e  ng.warning(f"Can
+00020a10: 6e6f 7420 7061 7273 6520 6173 2063 6f6e  not parse as con
+00020a20: 6469 7469 6f6e 207b 636f 6e64 6974 696f  dition {conditio
+00020a30: 6e7d 2229 0a20 2020 2020 2020 2020 2020  n}").           
+00020a40: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00020a50: 2020 2020 2020 206c 6873 203d 2073 735b         lhs = ss[
+00020a60: 305d 2e73 7472 6970 2829 0a20 2020 2020  0].strip().     
+00020a70: 2020 2020 2020 2020 2020 2072 6873 203d             rhs =
+00020a80: 2073 735b 325d 2e73 7472 6970 2829 0a0a   ss[2].strip()..
+00020a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020aa0: 6966 206c 6873 206e 6f74 2069 6e20 7365  if lhs not in se
+00020ab0: 6c66 2e6e 616d 655f 7661 6c75 655f 6469  lf.name_value_di
+00020ac0: 6374 3a0a 2020 2020 2020 2020 2020 2020  ct:.            
+00020ad0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00020ae0: 616c 7365 0a20 2020 2020 2020 2020 2020  alse.           
+00020af0: 2020 2020 2076 616c 7565 3120 3d20 7365       value1 = se
+00020b00: 6c66 2e6e 616d 655f 7661 6c75 655f 6469  lf.name_value_di
+00020b10: 6374 2e67 6574 286c 6873 290a 2020 2020  ct.get(lhs).    
+00020b20: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+00020b30: 6f74 2076 616c 7565 313a 0a20 2020 2020  ot value1:.     
+00020b40: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00020b50: 6f67 6769 6e67 2e77 6172 6e69 6e67 2866  ogging.warning(f
+00020b60: 227b 6c68 737d 206e 6f74 2069 6e20 7374  "{lhs} not in st
+00020b70: 796c 6520 6174 7472 6962 7574 6520 7b73  yle attribute {s
+00020b80: 656c 662e 6e61 6d65 5f76 616c 7565 5f64  elf.name_value_d
+00020b90: 6963 747d 2229 0a20 2020 2020 2020 2020  ict}").         
+00020ba0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00020bb0: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+00020bc0: 2020 2020 2020 2020 6966 2076 616c 7565          if value
+00020bd0: 312e 656e 6473 7769 7468 2843 5353 5374  1.endswith(CSSSt
+00020be0: 796c 652e 5058 293a 0a20 2020 2020 2020  yle.PX):.       
+00020bf0: 2020 2020 2020 2020 2020 2020 2076 616c               val
+00020c00: 7565 3120 3d20 7661 6c75 6531 5b3a 2d32  ue1 = value1[:-2
+00020c10: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00020c20: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00020c30: 2020 2020 2020 2020 2020 2076 616c 7565             value
+00020c40: 3120 3d20 666c 6f61 7428 7661 6c75 6531  1 = float(value1
+00020c50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020c60: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00020c70: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+00020c80: 2020 2020 2020 2020 6c6f 6767 696e 672e          logging.
+00020c90: 7761 726e 696e 6728 6622 6e6f 7420 6120  warning(f"not a 
+00020ca0: 6e75 6d62 6572 207b 7661 6c75 6531 7d22  number {value1}"
+00020cb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020cc0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00020cd0: 7365 0a0a 2020 2020 2020 2020 2020 2020  se..            
+00020ce0: 2020 2020 6966 2072 6873 2e65 6e64 7377      if rhs.endsw
+00020cf0: 6974 6828 4353 5353 7479 6c65 2e50 5829  ith(CSSStyle.PX)
+00020d00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00020d10: 2020 2020 2020 7268 7320 3d20 7268 735b        rhs = rhs[
+00020d20: 3a2d 325d 0a20 2020 2020 2020 2020 2020  :-2].           
+00020d30: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00020d40: 2020 2020 2020 2020 2020 2020 2020 7661                va
+00020d50: 6c75 6532 203d 2066 6c6f 6174 2872 6873  lue2 = float(rhs
+00020d60: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00020d70: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+00020d80: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
+00020d90: 2020 2020 2020 2020 6c6f 6767 696e 672e          logging.
+00020da0: 7761 726e 696e 6728 6622 6e6f 7420 6120  warning(f"not a 
+00020db0: 6e75 6d62 6572 207b 7268 737d 2229 0a20  number {rhs}"). 
+00020dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020dd0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
+00020de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020df0: 6f70 6572 203d 2073 735b 315d 0a20 2020  oper = ss[1].   
+00020e00: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00020e10: 6f70 6572 203d 3d20 223e 223a 0a20 2020  oper == ">":.   
+00020e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e30: 2072 6573 756c 7420 3d20 7661 6c75 6531   result = value1
+00020e40: 203e 2076 616c 7565 320a 2020 2020 2020   > value2.      
+00020e50: 2020 2020 2020 2020 2020 656c 6966 206f            elif o
+00020e60: 7065 7220 3d3d 2022 3c22 3a0a 2020 2020  per == "<":.    
+00020e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e80: 7265 7375 6c74 203d 2076 616c 7565 3120  result = value1 
+00020e90: 3c20 7661 6c75 6532 0a20 2020 2020 2020  < value2.       
+00020ea0: 2020 2020 2020 2020 2065 6c69 6620 6f70           elif op
+00020eb0: 6572 203d 3d20 2221 3d22 3a0a 2020 2020  er == "!=":.    
+00020ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020ed0: 7265 7375 6c74 203d 2076 616c 7565 3120  result = value1 
+00020ee0: 213d 2076 616c 7565 320a 2020 2020 2020  != value2.      
+00020ef0: 2020 2020 2020 2020 2020 656c 6966 206f            elif o
+00020f00: 7065 7220 3d3d 2022 3d3d 223a 0a20 2020  per == "==":.   
+00020f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020f20: 2072 6573 756c 7420 3d20 2876 616c 7565   result = (value
+00020f30: 3120 3d3d 2076 616c 7565 3229 0a20 2020  1 == value2).   
+00020f40: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00020f50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00020f60: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00020f70: 7565 4572 726f 7228 6622 6261 6420 6f70  ueError(f"bad op
+00020f80: 6572 6174 6f72 3a20 7b6f 7065 727d 2229  erator: {oper}")
+00020f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020fa0: 2069 6620 7265 7375 6c74 3a0a 2020 2020   if result:.    
+00020fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020fc0: 7061 7373 0a20 2020 2020 2020 2072 6574  pass.        ret
+00020fd0: 7572 6e20 7265 7375 6c74 0a0a 2020 2020  urn result..    
+00020fe0: 2320 2020 2063 6c61 7373 2043 5353 5374  #    class CSSSt
+00020ff0: 796c 653a 0a0a 2020 2020 4063 6c61 7373  yle:..    @class
+00021000: 6d65 7468 6f64 0a20 2020 2064 6566 2063  method.    def c
+00021010: 6d79 6b5f 746f 5f72 6762 2863 6c73 2c20  myk_to_rgb(cls, 
+00021020: 632c 206d 2c20 792c 206b 293a 0a0a 2020  c, m, y, k):..  
+00021030: 2020 2020 2020 7267 625f 7363 616c 6520        rgb_scale 
+00021040: 3d20 3235 350a 2020 2020 2020 2020 2320  = 255.        # 
+00021050: 636d 796b 5f73 6361 6c65 203d 2031 3030  cmyk_scale = 100
+00021060: 0a20 2020 2020 2020 2063 6d79 6b5f 7363  .        cmyk_sc
+00021070: 616c 6520 3d20 312e 300a 2020 2020 2020  ale = 1.0.      
+00021080: 2020 7220 3d20 7267 625f 7363 616c 6520    r = rgb_scale 
+00021090: 2a20 2831 2e30 202d 2028 6320 2b20 6b29  * (1.0 - (c + k)
+000210a0: 202f 2066 6c6f 6174 2863 6d79 6b5f 7363   / float(cmyk_sc
+000210b0: 616c 6529 290a 2020 2020 2020 2020 6720  ale)).        g 
+000210c0: 3d20 7267 625f 7363 616c 6520 2a20 2831  = rgb_scale * (1
+000210d0: 2e30 202d 2028 6d20 2b20 6b29 202f 2066  .0 - (m + k) / f
+000210e0: 6c6f 6174 2863 6d79 6b5f 7363 616c 6529  loat(cmyk_scale)
+000210f0: 290a 2020 2020 2020 2020 6220 3d20 7267  ).        b = rg
+00021100: 625f 7363 616c 6520 2a20 2831 2e30 202d  b_scale * (1.0 -
+00021110: 2028 7920 2b20 6b29 202f 2066 6c6f 6174   (y + k) / float
+00021120: 2863 6d79 6b5f 7363 616c 6529 290a 0a20  (cmyk_scale)).. 
+00021130: 2020 2020 2020 2072 6574 7572 6e20 722c         return r,
+00021140: 2067 2c20 620a 0a20 2020 2023 2020 2020   g, b..    #    
+00021150: 636c 6173 7320 4353 5353 7479 6c65 3a0a  class CSSStyle:.
+00021160: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00021170: 640a 2020 2020 6465 6620 636d 6b79 5f74  d.    def cmky_t
+00021180: 6f5f 7267 6228 636c 732c 2063 2c20 6d2c  o_rgb(cls, c, m,
+00021190: 206b 2c20 7929 3a0a 2020 2020 2020 2020   k, y):.        
+000211a0: 7265 7475 726e 2063 6c73 2e63 6d79 6b5f  return cls.cmyk_
+000211b0: 746f 5f72 6762 2863 2c20 6d2c 2079 2c20  to_rgb(c, m, y, 
+000211c0: 6b29 0a0a 2020 2020 6465 6620 6578 7472  k)..    def extr
+000211d0: 6163 745f 626f 6c64 5f69 7461 6c69 635f  act_bold_italic_
+000211e0: 6672 6f6d 5f66 6f6e 745f 6661 6d69 6c79  from_font_family
+000211f0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00021200: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00021210: 6f76 6572 7772 6974 655f 626f 6c64 3d46  overwrite_bold=F
+00021220: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+00021230: 2020 6f76 6572 7772 6974 655f 7374 796c    overwrite_styl
+00021240: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
+00021250: 2020 2020 206f 7665 7277 7269 7465 5f66       overwrite_f
+00021260: 616d 696c 793d 5472 7565 2c0a 2020 2020  amily=True,.    
+00021270: 2020 2020 2020 2020 7374 796c 655f 7265          style_re
+00021280: 6765 783d 5354 594c 455f 5245 2c0a 2020  gex=STYLE_RE,.  
+00021290: 2020 2020 2020 2020 2020 7765 6967 6874            weight
+000212a0: 5f72 6567 6578 3d57 4549 4748 545f 5245  _regex=WEIGHT_RE
+000212b0: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+000212c0: 2020 2020 2020 2068 6575 7269 7374 6963         heuristic
+000212d0: 7320 746f 2066 696e 6420 626f 6c64 2061  s to find bold a
+000212e0: 6e64 2069 7461 6c69 6320 696e 2066 6f6e  nd italic in fon
+000212f0: 7420 6e61 6d65 7320 616e 6420 7472 7920  t names and try 
+00021300: 746f 206e 6f72 6d61 6c69 7365 0a20 2020  to normalise.   
+00021310: 2020 2020 2065 2e67 2e0a 2020 2020 2020       e.g..      
+00021320: 2020 666f 6e74 2d66 616d 696c 793a 2054    font-family: T
+00021330: 696d 6573 4e65 7752 6f6d 616e 5053 2d42  imesNewRomanPS-B
+00021340: 6f6c 644d 543b 203d 3e20 666f 6e74 2d66  oldMT; => font-f
+00021350: 616d 696c 793a 2054 696d 6573 4e65 7752  amily: TimesNewR
+00021360: 6f6d 616e 5053 4d54 3b20 666f 6e74 5f77  omanPSMT; font_w
+00021370: 6569 6768 743a 2062 6f6c 640a 2020 2020  eight: bold.    
+00021380: 2020 2020 666f 6e74 2d66 616d 696c 793a      font-family:
+00021390: 2054 696d 6573 4e65 7752 6f6d 616e 5053   TimesNewRomanPS
+000213a0: 2d49 7461 6c69 634d 543b 203d 3e20 666f  -ItalicMT; => fo
+000213b0: 6e74 2d66 616d 696c 793a 2054 696d 6573  nt-family: Times
+000213c0: 4e65 7752 6f6d 616e 5053 4d54 3b20 666f  NewRomanPSMT; fo
+000213d0: 6e74 5f73 7479 6c65 3a20 6974 616c 6963  nt_style: italic
+000213e0: 0a20 2020 2020 2020 2074 6865 206f 7665  .        the ove
+000213f0: 7277 7269 7465 5f2a 2064 6574 6572 6d69  rwrite_* determi
+00021400: 6e65 2077 6865 7465 6872 2065 7869 7374  ne whetehr exist
+00021410: 696e 6720 636f 6d70 6f6e 656e 7473 2077  ing components w
+00021420: 696c 6c20 6265 206f 7665 7277 7269 7474  ill be overwritt
+00021430: 656e 0a20 2020 2020 2020 203a 7061 7261  en.        :para
+00021440: 6d20 6f76 6572 7772 6974 655f 626f 6c64  m overwrite_bold
+00021450: 3a20 6372 6561 7465 2066 6f6e 745f 7765  : create font_we
+00021460: 6967 6874 3a62 6f6c 6420 7265 6761 7264  ight:bold regard
+00021470: 6c65 7373 206f 6620 7072 6576 696f 7573  less of previous
+00021480: 2077 6569 6768 740a 2020 2020 2020 2020   weight.        
+00021490: 3a70 6172 616d 206f 7665 7277 7269 7465  :param overwrite
+000214a0: 5f73 7479 6c65 3a20 6372 6561 7465 2066  _style: create f
+000214b0: 6f6e 745f 7374 796c 653a 626f 6c64 2072  ont_style:bold r
+000214c0: 6567 6172 646c 6573 7320 6f66 2070 7265  egardless of pre
+000214d0: 7669 6f75 7320 7374 796c 650a 2020 2020  vious style.    
+000214e0: 2020 2020 3a70 6172 616d 206f 7665 7277      :param overw
+000214f0: 7269 7465 5f66 616d 696c 793a 2065 6469  rite_family: edi
+00021500: 7420 666f 6e74 2d66 616d 696c 7920 746f  t font-family to
+00021510: 2072 656d 6f76 6520 7374 796c 652f 7765   remove style/we
+00021520: 6967 6874 2069 6e66 6f20 2868 6163 6b79  ight info (hacky
+00021530: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
+00021540: 2073 7479 6c65 5f72 6567 6578 3d0a 0a20   style_regex=.. 
+00021550: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00021560: 2020 2066 616d 696c 7920 3d20 7365 6c66     family = self
+00021570: 2e66 6f6e 745f 6661 6d69 6c79 0a20 2020  .font_family.   
+00021580: 2020 2020 2069 6620 6e6f 7420 6661 6d69       if not fami
+00021590: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+000215a0: 7265 7475 726e 0a20 2020 2020 2020 2066  return.        f
+000215b0: 616d 696c 795f 7374 796c 652c 2073 7479  amily_style, sty
+000215c0: 6c65 203d 2073 656c 662e 6d61 7463 685f  le = self.match_
+000215d0: 7765 6967 6874 5f73 7479 6c65 2866 616d  weight_style(fam
+000215e0: 696c 792c 2073 7479 6c65 5f72 6567 6578  ily, style_regex
+000215f0: 2c20 7661 6c75 653d 2249 222c 206d 6172  , value="I", mar
+00021600: 6b3d 2253 5322 290a 2020 2020 2020 2020  k="SS").        
+00021610: 6661 6d69 6c79 5f77 6569 6768 742c 2077  family_weight, w
+00021620: 6569 6768 7420 3d20 7365 6c66 2e6d 6174  eight = self.mat
+00021630: 6368 5f77 6569 6768 745f 7374 796c 6528  ch_weight_style(
+00021640: 6661 6d69 6c79 2c20 7765 6967 6874 5f72  family, weight_r
+00021650: 6567 6578 2c20 7661 6c75 653d 2242 222c  egex, value="B",
+00021660: 206d 6172 6b3d 2257 5722 290a 2020 2020   mark="WW").    
+00021670: 2020 2020 2320 7072 696e 7428 6622 6661      # print(f"fa
+00021680: 6d69 6c79 3a20 7b66 616d 696c 797d 3b20  mily: {family}; 
+00021690: 7374 796c 653a 207b 7374 796c 657d 3b20  style: {style}; 
+000216a0: 7765 6967 6874 3a20 7b77 6569 6768 747d  weight: {weight}
+000216b0: 3b22 290a 2020 2020 2020 2020 6966 2066  ;").        if f
+000216c0: 616d 696c 795f 7765 6967 6874 2061 6e64  amily_weight and
+000216d0: 206f 7665 7277 7269 7465 5f66 616d 696c   overwrite_famil
+000216e0: 793a 0a20 2020 2020 2020 2020 2020 2073  y:.            s
+000216f0: 656c 662e 7365 745f 6661 6d69 6c79 2866  elf.set_family(f
+00021700: 616d 696c 795f 7765 6967 6874 290a 2020  amily_weight).  
+00021710: 2020 2020 2020 6966 2077 6569 6768 7420        if weight 
+00021720: 616e 6420 6f76 6572 7772 6974 655f 626f  and overwrite_bo
+00021730: 6c64 3a0a 2020 2020 2020 2020 2020 2020  ld:.            
+00021740: 7365 6c66 2e73 6574 5f66 6f6e 745f 7765  self.set_font_we
+00021750: 6967 6874 2877 6569 6768 7429 0a20 2020  ight(weight).   
+00021760: 2020 2020 2069 6620 7374 796c 6520 616e       if style an
+00021770: 6420 6f76 6572 7772 6974 655f 7374 796c  d overwrite_styl
+00021780: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00021790: 656c 662e 7365 745f 666f 6e74 5f73 7479  elf.set_font_sty
+000217a0: 6c65 2873 7479 6c65 290a 2020 2020 2020  le(style).      
+000217b0: 2020 2320 6966 2073 7479 6c65 2061 6e64    # if style and
+000217c0: 206f 7665 7277 7269 7465 5f73 7472 6574   overwrite_stret
+000217d0: 6368 6564 3a0a 2020 2020 2020 2020 2320  ched:.        # 
+000217e0: 2020 2020 7365 6c66 2e73 6574 5f66 6f6e      self.set_fon
+000217f0: 745f 7374 7265 7463 6865 6428 7374 796c  t_stretched(styl
+00021800: 6529 0a20 2020 2020 2020 2023 2070 7269  e).        # pri
+00021810: 6e74 2866 226e 6577 2073 7479 6c65 207b  nt(f"new style {
+00021820: 7365 6c66 7d22 290a 0a0a 2020 2020 2320  self}")...    # 
+00021830: 2020 2063 6c61 7373 2043 5353 5374 796c     class CSSStyl
+00021840: 653a 0a0a 2020 2020 6465 6620 6d61 7463  e:..    def matc
+00021850: 685f 7765 6967 6874 5f73 7479 6c65 2873  h_weight_style(s
+00021860: 656c 662c 2066 616d 696c 792c 2077 6569  elf, family, wei
+00021870: 6768 745f 7265 6765 782c 2076 616c 7565  ght_regex, value
+00021880: 3d4e 6f6e 652c 206d 6172 6b3d 4e6f 6e65  =None, mark=None
+00021890: 293a 0a20 2020 2020 2020 2077 6569 6768  ):.        weigh
+000218a0: 745f 7265 6320 3d20 7265 2e63 6f6d 7069  t_rec = re.compi
+000218b0: 6c65 2877 6569 6768 745f 7265 6765 7829  le(weight_regex)
+000218c0: 2069 6620 7765 6967 6874 5f72 6567 6578   if weight_regex
+000218d0: 2065 6c73 6520 4e6f 6e65 0a20 2020 2020   else None.     
+000218e0: 2020 206d 6174 6368 203d 2077 6569 6768     match = weigh
+000218f0: 745f 7265 632e 7365 6172 6368 2866 616d  t_rec.search(fam
+00021900: 696c 7929 0a20 2020 2020 2020 2069 6620  ily).        if 
+00021910: 6d61 7463 683a 0a20 2020 2020 2020 2020  match:.         
+00021920: 2020 2076 616c 7565 203d 2066 616d 696c     value = famil
+00021930: 795b 6d61 7463 682e 7374 6172 7428 293a  y[match.start():
+00021940: 6d61 7463 682e 656e 6428 295d 0a20 2020  match.end()].   
+00021950: 2020 2020 2020 2020 2076 616c 7565 203d           value =
+00021960: 2076 616c 7565 2e72 6570 6c61 6365 2822   value.replace("
+00021970: 2d22 2c20 2222 292e 7265 706c 6163 6528  -", "").replace(
+00021980: 222e 222c 2022 2229 0a20 2020 2020 2020  ".", "").       
+00021990: 2020 2020 2066 616d 696c 7920 3d20 6661       family = fa
+000219a0: 6d69 6c79 5b3a 6d61 7463 682e 7374 6172  mily[:match.star
+000219b0: 7428 295d 202b 2066 616d 696c 795b 6d61  t()] + family[ma
+000219c0: 7463 682e 656e 6428 293a 5d0a 2020 2020  tch.end():].    
+000219d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000219e0: 2020 2020 2020 7661 6c75 6520 3d20 4e6f        value = No
+000219f0: 6e65 0a20 2020 2020 2020 2072 6574 7572  ne.        retur
+00021a00: 6e20 6661 6d69 6c79 2c20 7661 6c75 650a  n family, value.
+00021a10: 0a20 2020 2023 2020 2020 636c 6173 7320  .    #    class 
+00021a20: 4353 5353 7479 6c65 3a0a 0a20 2020 2064  CSSStyle:..    d
+00021a30: 6566 2063 7265 6174 655f 6262 6f78 2873  ef create_bbox(s
+00021a40: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
+00021a50: 220a 2020 2020 2020 2020 6372 6561 7465  ".        create
+00021a60: 2062 6f75 6e64 696e 6720 626f 7820 6672   bounding box fr
+00021a70: 6f6d 206c 6566 742c 2077 6964 7468 2c20  om left, width, 
+00021a80: 746f 702c 2068 6569 6768 740a 2020 2020  top, height.    
+00021a90: 2020 2020 3a72 6574 7572 6e3a 204e 6f6e      :return: Non
+00021aa0: 6520 6966 2061 6e79 2061 7474 7269 6275  e if any attribu
+00021ab0: 7465 7320 6d69 7373 696e 670a 2020 2020  tes missing.    
+00021ac0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00021ad0: 6262 6f78 203d 204e 6f6e 650a 2020 2020  bbox = None.    
+00021ae0: 2020 2020 6966 2073 656c 662e 746f 7020      if self.top 
+00021af0: 6973 206e 6f74 204e 6f6e 6520 616e 6420  is not None and 
+00021b00: 7365 6c66 2e68 6569 6768 7420 6973 206e  self.height is n
+00021b10: 6f74 204e 6f6e 6520 616e 6420 7365 6c66  ot None and self
+00021b20: 2e6c 6566 7420 6973 206e 6f74 204e 6f6e  .left is not Non
+00021b30: 6520 616e 6420 7365 6c66 2e77 6964 7468  e and self.width
+00021b40: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+00021b50: 2020 2020 2020 2020 2020 6262 6f78 203d            bbox =
+00021b60: 2042 426f 7828 7879 5f72 616e 6765 733d   BBox(xy_ranges=
+00021b70: 5b5b 7365 6c66 2e6c 6566 742c 2073 656c  [[self.left, sel
+00021b80: 662e 6c65 6674 202b 2073 656c 662e 7769  f.left + self.wi
+00021b90: 6474 685d 2c20 5b73 656c 662e 746f 702c  dth], [self.top,
+00021ba0: 2073 656c 662e 746f 7020 2b20 7365 6c66   self.top + self
+00021bb0: 2e68 6569 6768 745d 5d29 0a20 2020 2020  .height]]).     
+00021bc0: 2020 2072 6574 7572 6e20 6262 6f78 0a0a     return bbox..
+00021bd0: 2020 2020 2320 2020 2063 6c61 7373 2043      #    class C
+00021be0: 5353 5374 796c 653a 0a0a 2020 2020 6465  SSStyle:..    de
+00021bf0: 6620 6578 7472 6163 745f 7375 6273 7479  f extract_substy
+00021c00: 6c65 7328 7365 6c66 2c20 6373 735f 6e61  les(self, css_na
+00021c10: 6d65 7329 3a0a 2020 2020 2020 2020 2222  mes):.        ""
+00021c20: 220a 2020 2020 2020 2020 4372 6561 7465  ".        Create
+00021c30: 2032 206e 6577 2043 5353 5373 7479 6c65   2 new CSSSstyle
+00021c40: 7320 2c20 7468 6520 6669 7273 7420 7769  s , the first wi
+00021c50: 7468 206e 616d 6573 2069 6e20 2273 7479  th names in "sty
+00021c60: 6c65 7322 2061 6e64 2074 6865 2073 6563  les" and the sec
+00021c70: 6f6e 6420 7468 6520 7265 7374 2e0a 2020  ond the rest..  
+00021c80: 2020 2020 2020 2020 2020 6966 204e 6f6e            if Non
+00021c90: 652c 2072 6574 7275 6e73 204e 6f6e 652c  e, retruns None,
+00021ca0: 4e6f 6e65 0a20 2020 2020 2020 203a 7061  None.        :pa
+00021cb0: 7261 6d20 6373 735f 6e61 6d65 733a 206c  ram css_names: l
+00021cc0: 6973 7420 6f66 2043 5353 206e 616d 6573  ist of CSS names
+00021cd0: 2028 652e 672e 2022 666f 6e74 2d66 616d   (e.g. "font-fam
+00021ce0: 696c 7922 292e 2049 6620 6e61 206e 616d  ily"). If na nam
+00021cf0: 6520 6e6f 7420 666f 756e 642c 206e 6f20  e not found, no 
+00021d00: 6163 7469 6f6e 0a20 2020 2020 2020 203a  action.        :
+00021d10: 7265 7475 726e 2032 2d74 7570 6c65 206f  return 2-tuple o
+00021d20: 6620 3129 2043 5353 5374 796c 6520 6f62  f 1) CSSStyle ob
+00021d30: 6a65 6374 2077 6974 6820 6578 7472 6163  ject with extrac
+00021d40: 7465 6420 6e61 6d65 7320 3229 2043 5353  ted names 2) CSS
+00021d50: 5374 796c 6520 6f66 2074 6865 2072 656d  Style of the rem
+00021d60: 6169 6e64 6572 3b0a 2020 2020 2020 2020  ainder;.        
+00021d70: 2020 2020 6569 7468 6572 2f62 6f74 6820      either/both 
+00021d80: 6d61 7920 6265 2065 6d70 7479 2043 5353  may be empty CSS
+00021d90: 5374 796c 652e 0a20 2020 2020 2020 2022  Style..        "
+00021da0: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+00021db0: 7420 7365 6c66 2e6e 616d 655f 7661 6c75  t self.name_valu
+00021dc0: 655f 6469 6374 3a0a 2020 2020 2020 2020  e_dict:.        
+00021dd0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00021de0: 7272 6f72 2866 226e 616d 655f 7661 6c75  rror(f"name_valu
+00021df0: 655f 6469 6374 2069 7320 4e6f 6e65 2229  e_dict is None")
+00021e00: 0a20 2020 2020 2020 2069 6620 6373 735f  .        if css_
+00021e10: 6e61 6d65 7320 6973 204e 6f6e 653a 0a20  names is None:. 
+00021e20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00021e30: 6e20 4e6f 6e65 2c20 4e6f 6e65 0a20 2020  n None, None.   
+00021e40: 2020 2020 2063 7373 5f72 6574 6169 6e65       css_retaine
+00021e50: 6420 3d20 636f 7079 2e64 6565 7063 6f70  d = copy.deepcop
+00021e60: 7928 7365 6c66 290a 2020 2020 2020 2020  y(self).        
+00021e70: 6373 735f 666f 756e 6420 3d20 4353 5353  css_found = CSSS
+00021e80: 7479 6c65 2829 0a0a 2020 2020 2020 2020  tyle()..        
+00021e90: 6b65 7973 203d 2063 7373 5f72 6574 6169  keys = css_retai
+00021ea0: 6e65 642e 6e61 6d65 5f76 616c 7565 5f64  ned.name_value_d
+00021eb0: 6963 742e 6b65 7973 2829 0a20 2020 2020  ict.keys().     
+00021ec0: 2020 2066 6f72 206e 616d 6520 696e 2063     for name in c
+00021ed0: 7373 5f6e 616d 6573 3a0a 2020 2020 2020  ss_names:.      
+00021ee0: 2020 2020 2020 6966 206e 616d 6520 696e        if name in
+00021ef0: 2063 7373 5f72 6574 6169 6e65 642e 6e61   css_retained.na
+00021f00: 6d65 5f76 616c 7565 5f64 6963 743a 0a20  me_value_dict:. 
+00021f10: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00021f20: 616c 7565 203d 2063 7373 5f72 6574 6169  alue = css_retai
+00021f30: 6e65 642e 6e61 6d65 5f76 616c 7565 5f64  ned.name_value_d
+00021f40: 6963 742e 706f 7028 6e61 6d65 290a 2020  ict.pop(name).  
+00021f50: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00021f60: 2076 616c 7565 3a20 2023 2074 7261 6e73   value:  # trans
+00021f70: 6665 7220 6974 656d 206f 7665 720a 2020  fer item over.  
+00021f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021f90: 2020 6373 735f 666f 756e 642e 6e61 6d65    css_found.name
+00021fa0: 5f76 616c 7565 5f64 6963 745b 6e61 6d65  _value_dict[name
+00021fb0: 5d20 3d20 7661 6c75 650a 2020 2020 2020  ] = value.      
+00021fc0: 2020 7265 7475 726e 2028 6373 735f 666f    return (css_fo
+00021fd0: 756e 642c 2063 7373 5f72 6574 6169 6e65  und, css_retaine
+00021fe0: 6429 0a0a 2020 2020 2320 2020 2063 6c61  d)..    #    cla
+00021ff0: 7373 2043 5353 5374 796c 653a 0a0a 2020  ss CSSStyle:..  
+00022000: 2020 6465 6620 6372 6561 7465 5f68 746d    def create_htm
+00022010: 6c5f 7374 796c 655f 656c 656d 656e 7428  l_style_element(
+00022020: 7365 6c66 2c20 6874 6d6c 5f63 6c61 7373  self, html_class
+00022030: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00022040: 2020 2020 2020 2043 7265 6174 6573 2073         Creates s
+00022050: 7472 696e 6720 666f 7220 4854 4d4c 2073  tring for HTML s
+00022060: 7479 6c65 0a20 2020 2020 2020 2022 2222  tyle.        """
+00022070: 0a20 2020 2020 2020 2044 4f54 203d 2022  .        DOT = "
+00022080: 2e22 0a20 2020 2020 2020 2073 203d 2044  .".        s = D
+00022090: 4f54 202b 2068 746d 6c5f 636c 6173 7320  OT + html_class 
+000220a0: 2b20 2220 2220 2b20 7365 6c66 2e67 6574  + " " + self.get
+000220b0: 5f63 7373 5f76 616c 7565 2877 7261 705f  _css_value(wrap_
+000220c0: 7769 7468 5f63 7572 6c79 3d54 7275 6529  with_curly=True)
+000220d0: 0a20 2020 2020 2020 2065 6c65 6d20 3d20  .        elem = 
+000220e0: 4554 2e45 6c65 6d65 6e74 2843 5353 5374  ET.Element(CSSSt
+000220f0: 796c 652e 5354 594c 4529 0a20 2020 2020  yle.STYLE).     
+00022100: 2020 2065 6c65 6d2e 7465 7874 203d 2073     elem.text = s
+00022110: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00022120: 656c 656d 0a0a 2020 2020 2320 2020 2063  elem..    #    c
+00022130: 6c61 7373 2043 5353 5374 796c 653a 0a0a  lass CSSStyle:..
+00022140: 2020 2020 6465 6620 6578 7472 6163 745f      def extract_
+00022150: 7465 7874 5f73 7479 6c65 7328 7365 6c66  text_styles(self
+00022160: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00022170: 2020 2020 2020 2065 7874 7261 6374 2074         extract t
+00022180: 6578 7420 636f 6d70 6f6e 656e 7473 2066  ext components f
+00022190: 726f 6d20 7374 796c 6520 2866 6f6e 742d  rom style (font-
+000221a0: 2a2c 2063 6f6c 6f72 2c20 6574 6329 2069  *, color, etc) i
+000221b0: 6e74 6f20 6e65 7720 7374 796c 652c 2072  nto new style, r
+000221c0: 6574 7572 6e69 6e67 2074 7570 6c65 206f  eturning tuple o
+000221d0: 660a 2020 2020 2020 2020 6e65 7720 7374  f.        new st
+000221e0: 796c 6520 616e 6420 7374 796c 6520 6672  yle and style fr
+000221f0: 6f6d 2072 656d 6169 6e69 6e67 2063 6f6d  om remaining com
+00022200: 706f 6e65 6e74 730a 2020 2020 2020 2020  ponents.        
+00022210: 2222 220a 2020 2020 2020 2020 2865 7874  """.        (ext
+00022220: 7261 6374 6564 5f73 7479 6c65 2c20 7265  racted_style, re
+00022230: 7461 696e 6564 2920 3d20 666f 6e74 5f73  tained) = font_s
+00022240: 7479 6c65 2c20 7265 7374 5f73 7479 6c65  tyle, rest_style
+00022250: 203d 2073 656c 662e 6578 7472 6163 745f   = self.extract_
+00022260: 7375 6273 7479 6c65 7328 0a20 2020 2020  substyles(.     
+00022270: 2020 2020 2020 2043 5353 5374 796c 652e         CSSStyle.
+00022280: 5445 5854 5f53 5459 4c45 5f43 4f4d 504f  TEXT_STYLE_COMPO
+00022290: 4e45 4e54 530a 2020 2020 2020 2020 290a  NENTS.        ).
+000222a0: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+000222b0: 6578 7472 6163 7465 645f 7374 796c 652c  extracted_style,
+000222c0: 2072 6574 6169 6e65 6429 0a0a 2020 2020   retained)..    
+000222d0: 2320 2020 2063 6c61 7373 2043 5353 5374  #    class CSSSt
+000222e0: 796c 653a 0a0a 2020 2020 6465 6620 6578  yle:..    def ex
+000222f0: 7472 6163 745f 7465 7874 5f73 7479 6c65  tract_text_style
+00022300: 735f 696e 746f 5f63 6c61 7373 2873 656c  s_into_class(sel
+00022310: 662c 2063 6c61 7373 5f6e 616d 652c 206f  f, class_name, o
+00022320: 6c64 5f63 6c61 7373 7374 723d 2222 293a  ld_classstr=""):
+00022330: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00022340: 2020 2020 2065 7874 7261 6374 7320 7465       extracts te
+00022350: 7874 2063 6c61 7373 206e 616d 652d 7661  xt class name-va
+00022360: 6c75 6520 696e 746f 206e 6577 2043 5353  lue into new CSS
+00022370: 5374 796c 652c 2061 6e64 2063 7265 6174  Style, and creat
+00022380: 6573 2075 7064 6174 6564 2063 6c61 7373  es updated class
+00022390: 5f73 7472 696e 670a 2020 2020 2020 2020  _string.        
+000223a0: 4578 616d 706c 653a 0a20 2020 2020 2020  Example:.       
+000223b0: 2020 2020 2065 6c65 6d65 6e74 2068 6173       element has
+000223c0: 2073 7479 6c65 2061 7474 7269 6275 7465   style attribute
+000223d0: 2077 6974 6820 7365 7665 7261 6c20 7465   with several te
+000223e0: 7874 2063 6f6d 706f 6e65 6e74 7320 2865  xt components (e
+000223f0: 2e67 2e20 666f 6e74 2d77 6569 6768 742c  .g. font-weight,
+00022400: 2066 6f6e 742d 7369 7a65 290a 2020 2020   font-size).    
+00022410: 2020 2020 2020 2020 5468 6973 2063 7265          This cre
+00022420: 6174 6573 2061 206e 6577 203c 7374 796c  ates a new <styl
+00022430: 653e 2045 6c65 6d65 6e74 2028 6578 7472  e> Element (extr
+00022440: 6163 7465 6429 2077 6974 6820 6a75 7374  acted) with just
+00022450: 2074 6865 7365 2063 6f6d 706f 6e65 6e74   these component
+00022460: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00022470: 2020 616e 6420 7075 7473 2074 6865 2075    and puts the u
+00022480: 6e65 7874 7261 6374 6564 2073 7479 6c65  nextracted style
+00022490: 2063 6f6d 706f 6e65 656e 7473 2069 6e74   componeents int
+000224a0: 6f20 6e65 7720 7374 796c 6520 7370 6163  o new style spac
+000224b0: 652d 7365 7061 7261 7465 6420 7374 7269  e-separated stri
+000224c0: 6e67 2028 7265 6d61 696e 6e65 6429 0a20  ng (remainned). 
+000224d0: 2020 2020 2020 2020 2020 2049 7420 7573             It us
+000224e0: 6573 2074 6865 2063 6c61 7373 5f6e 616d  es the class_nam
+000224f0: 6520 746f 2075 7064 6174 6520 7468 6520  e to update the 
+00022500: 6f6c 645f 636c 6173 7373 7472 2073 7472  old_classstr str
+00022510: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+00022520: 2020 2020 652e 672e 2063 6c61 7373 5f6e      e.g. class_n
+00022530: 616d 653d 2273 3122 2061 6e64 206f 6c64  ame="s1" and old
+00022540: 5f63 6c61 7373 7374 723d 2266 6f6f 2062  _classstr="foo b
+00022550: 6172 2220 3d3e 2022 666f 6f20 6261 7220  ar" => "foo bar 
+00022560: 7331 220a 2020 2020 2020 2020 3a70 6172  s1".        :par
+00022570: 616d 2063 6c61 7373 5f6e 616d 653a 206e  am class_name: n
+00022580: 616d 6520 6f69 6620 6e65 7720 636c 6173  ame oif new clas
+00022590: 7320 2861 7574 686f 7220 6d75 7374 2065  s (author must e
+000225a0: 6e73 7572 6520 756e 6971 7565 6e65 7373  nsure uniqueness
+000225b0: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
+000225c0: 206f 6c64 5f63 6c61 7373 7374 723a 206f   old_classstr: o
+000225d0: 6c64 2063 6c61 7373 6e61 6d65 2028 6465  ld classname (de
+000225e0: 6661 756c 7473 2074 6f20 2222 290a 2020  faults to "").  
+000225f0: 2020 2020 2020 3a72 6574 7572 6e3a 2033        :return: 3
+00022600: 2d74 7570 6c65 206f 6620 2865 7874 7261  -tuple of (extra
+00022610: 6374 6564 5f73 7479 6c65 5f65 6c65 6d65  cted_style_eleme
+00022620: 6e74 2c20 7265 7461 696e 6564 5f73 7479  nt, retained_sty
+00022630: 6c65 5f73 7472 696e 672c 206e 6577 2063  le_string, new c
+00022640: 6c61 7373 735f 7374 7269 6e67 290a 2020  lasss_string).  
+00022650: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00022660: 2020 6578 7472 6163 7465 645f 7374 796c    extracted_styl
+00022670: 652c 2072 6574 6169 6e65 645f 7374 796c  e, retained_styl
+00022680: 6520 3d20 7365 6c66 2e65 7874 7261 6374  e = self.extract
+00022690: 5f74 6578 745f 7374 796c 6573 2829 0a0a  _text_styles()..
+000226a0: 2020 2020 2020 2020 6966 206e 6f74 2065          if not e
+000226b0: 7874 7261 6374 6564 5f73 7479 6c65 3a0a  xtracted_style:.
+000226c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000226d0: 6520 5661 6c75 6545 7272 6f72 2822 6578  e ValueError("ex
+000226e0: 7472 6163 7465 6420 7374 796c 6520 6973  tracted style is
+000226f0: 204e 6f6e 6522 290a 2020 2020 2020 2020   None").        
+00022700: 6578 7472 6163 7465 645f 7374 796c 6531  extracted_style1
+00022710: 203d 2043 5353 5374 796c 652e 6578 7472   = CSSStyle.extr
+00022720: 6163 745f 626f 6c64 5f69 7461 6c69 635f  act_bold_italic_
+00022730: 6672 6f6d 5f66 6f6e 745f 6661 6d69 6c79  from_font_family
+00022740: 5f66 6f72 5f73 7479 6c65 2865 7874 7261  _for_style(extra
+00022750: 6374 6564 5f73 7479 6c65 2920 6966 2065  cted_style) if e
+00022760: 7874 7261 6374 6564 5f73 7479 6c65 2065  xtracted_style e
+00022770: 6c73 6520 4e6f 6e65 0a20 2020 2020 2020  lse None.       
+00022780: 2065 7874 7261 6374 6564 5f68 746d 6c5f   extracted_html_
+00022790: 7374 796c 655f 656c 656d 656e 7420 3d20  style_element = 
+000227a0: 6578 7472 6163 7465 645f 7374 796c 6531  extracted_style1
+000227b0: 2e63 7265 6174 655f 6874 6d6c 5f73 7479  .create_html_sty
+000227c0: 6c65 5f65 6c65 6d65 6e74 2863 6c61 7373  le_element(class
+000227d0: 5f6e 616d 6529 2069 6620 6578 7472 6163  _name) if extrac
+000227e0: 7465 645f 7374 796c 6531 2069 7320 6e6f  ted_style1 is no
+000227f0: 7420 4e6f 6e65 2065 6c73 6520 4e6f 6e65  t None else None
+00022800: 0a0a 2020 2020 2020 2020 7265 7461 696e  ..        retain
+00022810: 6564 5f73 7479 6c65 5f61 7474 7661 6c20  ed_style_attval 
+00022820: 3d20 7265 7461 696e 6564 5f73 7479 6c65  = retained_style
+00022830: 2e67 6574 5f63 7373 5f76 616c 7565 2829  .get_css_value()
+00022840: 2069 6620 7265 7461 696e 6564 5f73 7479   if retained_sty
+00022850: 6c65 2065 6c73 6520 4e6f 6e65 0a20 2020  le else None.   
+00022860: 2020 2020 2068 746d 6c5f 636c 6173 735f       html_class_
+00022870: 7661 6c20 3d20 4353 5353 7479 6c65 2e63  val = CSSStyle.c
+00022880: 7265 6174 655f 6874 6d6c 5f63 6c61 7373  reate_html_class
+00022890: 5f76 616c 2863 6c61 7373 5f6e 616d 652c  _val(class_name,
+000228a0: 206f 6c64 5f63 6c61 7373 5f76 616c 3d6f   old_class_val=o
+000228b0: 6c64 5f63 6c61 7373 7374 7229 0a20 2020  ld_classstr).   
+000228c0: 2020 2020 2072 6574 7572 6e20 6578 7472       return extr
+000228d0: 6163 7465 645f 6874 6d6c 5f73 7479 6c65  acted_html_style
+000228e0: 5f65 6c65 6d65 6e74 2c20 7265 7461 696e  _element, retain
+000228f0: 6564 5f73 7479 6c65 5f61 7474 7661 6c2c  ed_style_attval,
+00022900: 2068 746d 6c5f 636c 6173 735f 7661 6c0a   html_class_val.
+00022910: 0a20 2020 2023 2020 2020 636c 6173 7320  .    #    class 
+00022920: 4353 5353 7479 6c65 3a0a 0a20 2020 2040  CSSStyle:..    @
+00022930: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00022940: 6465 6620 6372 6561 7465 5f68 746d 6c5f  def create_html_
+00022950: 636c 6173 735f 7661 6c28 636c 732c 206e  class_val(cls, n
+00022960: 6577 5f63 6c61 7373 2c20 6f6c 645f 636c  ew_class, old_cl
+00022970: 6173 735f 7661 6c3d 4e6f 6e65 293a 0a20  ass_val=None):. 
+00022980: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00022990: 2020 2063 7265 6174 6573 206f 7220 6564     creates or ed
+000229a0: 6974 7320 6120 636c 6173 7320 7374 7269  its a class stri
+000229b0: 6e67 2074 6f20 6163 6365 7074 2061 206e  ng to accept a n
+000229c0: 6577 2076 616c 7565 0a20 2020 2020 2020  ew value.       
+000229d0: 206e 6f2d 6f70 2069 6620 6e65 775f 636c   no-op if new_cl
+000229e0: 6173 7320 6973 2061 6c72 6561 6479 2069  ass is already i
+000229f0: 6e20 6f6c 645f 636c 6173 735f 7661 6c0a  n old_class_val.
+00022a00: 2020 2020 2020 2020 652e 672e 204e 6f6e          e.g. Non
+00022a10: 6520 2b20 2266 6f6f 2220 3d3e 2022 666f  e + "foo" => "fo
+00022a20: 6f22 0a20 2020 2020 2020 2022 666f 6f22  o".        "foo"
+00022a30: 202b 2022 6261 7220 706c 7567 6822 203d   + "bar plugh" =
+00022a40: 3e20 2262 6172 2070 6c75 6768 2066 6f6f  > "bar plugh foo
+00022a50: 220a 2020 2020 2020 2020 2266 6f6f 2220  ".        "foo" 
+00022a60: 2b20 2262 6172 2066 6f6f 2070 6c75 6768  + "bar foo plugh
+00022a70: 2220 3d3e 2022 6261 7220 666f 6f20 706c  " => "bar foo pl
+00022a80: 7567 6822 0a20 2020 2020 2020 203a 7061  ugh".        :pa
+00022a90: 7261 6d20 6e65 775f 636c 6173 733a 2063  ram new_class: c
+00022aa0: 6c61 7373 2074 6f20 6164 640a 2020 2020  lass to add.    
+00022ab0: 2020 2020 3a70 6172 616d 206f 6c64 5f63      :param old_c
+00022ac0: 6c61 7373 5f76 616c 3a20 7370 6163 652d  lass_val: space-
+00022ad0: 7365 7061 7261 7465 6420 6c69 7374 206f  separated list o
+00022ae0: 6620 6578 6973 7469 6e67 2063 6c61 7373  f existing class
+00022af0: 6573 0a20 2020 2020 2020 203a 7265 7475  es.        :retu
+00022b00: 726e 3a20 6e65 7720 636c 6173 7320 7374  rn: new class st
+00022b10: 7269 6e67 0a20 2020 2020 2020 2022 2222  ring.        """
+00022b20: 0a20 2020 2020 2020 206f 6c64 5f63 6c61  .        old_cla
+00022b30: 7373 6573 203d 205b 5d20 6966 206e 6f74  sses = [] if not
+00022b40: 206f 6c64 5f63 6c61 7373 5f76 616c 2065   old_class_val e
+00022b50: 6c73 6520 6f6c 645f 636c 6173 735f 7661  lse old_class_va
+00022b60: 6c2e 7370 6c69 7428 290a 2020 2020 2020  l.split().      
+00022b70: 2020 6966 206e 6577 5f63 6c61 7373 206e    if new_class n
+00022b80: 6f74 2069 6e20 6f6c 645f 636c 6173 7365  ot in old_classe
+00022b90: 733a 0a20 2020 2020 2020 2020 2020 206f  s:.            o
+00022ba0: 6c64 5f63 6c61 7373 6573 2e61 7070 656e  ld_classes.appen
+00022bb0: 6428 6e65 775f 636c 6173 7329 0a20 2020  d(new_class).   
+00022bc0: 2020 2020 2072 6574 7572 6e20 5574 696c       return Util
+00022bd0: 2e63 7265 6174 655f 7374 7269 6e67 5f73  .create_string_s
+00022be0: 6570 6172 6174 6564 5f6c 6973 7428 6f6c  eparated_list(ol
+00022bf0: 645f 636c 6173 7365 7329 0a0a 2020 2020  d_classes)..    
+00022c00: 2320 2020 2063 6c61 7373 2043 5353 5374  #    class CSSSt
+00022c10: 796c 653a 0a0a 2020 2020 4063 6c61 7373  yle:..    @class
+00022c20: 6d65 7468 6f64 0a20 2020 2064 6566 2063  method.    def c
+00022c30: 7265 6174 655f 7374 796c 655f 6469 6374  reate_style_dict
+00022c40: 5f66 726f 6d5f 7374 796c 6573 2863 6c73  _from_styles(cls
+00022c50: 2c20 7374 796c 655f 656c 656d 733d 4e6f  , style_elems=No
+00022c60: 6e65 2c20 7661 6c69 6461 7465 3d54 7275  ne, validate=Tru
+00022c70: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
+00022c80: 2020 2020 2020 2020 636f 6e76 6572 7420          convert 
+00022c90: 6c69 7374 206f 6620 4353 5353 7479 6c65  list of CSSStyle
+00022ca0: 7320 2861 7320 4854 4d4c 2073 7472 696e  s (as HTML strin
+00022cb0: 6773 2920 746f 2064 6963 740a 2020 2020  gs) to dict.    
+00022cc0: 2020 2020 6966 2064 7570 6c69 6361 7465      if duplicate
+00022cd0: 2073 7479 6c65 7265 6673 2072 6169 7365   stylerefs raise
+00022ce0: 2045 7863 6570 7469 6f6e 2069 6620 7661   Exception if va
+00022cf0: 6c69 6461 7465 2065 6c73 6520 7461 6b65  lidate else take
+00022d00: 2066 6972 7374 0a20 2020 2020 2020 2054   first.        T
+00022d10: 7970 6963 616c 2073 7479 6c65 3a0a 2020  ypical style:.  
+00022d20: 2020 2020 2020 3c73 7479 6c65 202e 2e2e        <style ...
+00022d30: 3e2e 7330 207b 666f 6e74 2d73 697a 653a  >.s0 {font-size:
+00022d40: 2031 342e 7078 3b7d 3c2f 7374 796c 653e   14.px;}</style>
+00022d50: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00022d60: 7374 796c 655f 656c 656d 733a 206c 6973  style_elems: lis
+00022d70: 7420 6f66 206c 786d 6c20 5f45 6c65 6d65  t of lxml _Eleme
+00022d80: 6e74 730a 2020 2020 2020 2020 3a70 6172  nts.        :par
+00022d90: 616d 2076 616c 6964 6174 653a 2063 6865  am validate: che
+00022da0: 636b 2077 6865 7468 6572 2043 5353 2076  ck whether CSS v
+00022db0: 616c 7565 2069 7320 636f 6e66 6f72 6d61  alue is conforma
+00022dc0: 6e74 206f 7220 6475 706c 6963 6174 6520  nt or duplicate 
+00022dd0: 7374 796c 655f 7265 6673 0a20 2020 2020  style_refs.     
+00022de0: 2020 203a 7265 7475 726e 3a20 6469 6374     :return: dict
+00022df0: 206f 6620 666f 726d 2072 6566 3a20 7374   of form ref: st
+00022e00: 796c 650a 2020 2020 2020 2020 3a65 7863  yle.        :exc
+00022e10: 6570 743a 2049 6620 656c 656d 656e 7420  ept: If element 
+00022e20: 6861 7320 7772 6f6e 6720 7379 6e74 6178  has wrong syntax
+00022e30: 3b20 6966 2063 7373 2066 6965 726c 6420  ; if css fierld 
+00022e40: 6973 206d 616c 666f 746d 6564 3b20 6966  is malfotmed; if
+00022e50: 2072 6566 2069 7320 6475 706c 6963 6174   ref is duplicat
+00022e60: 6564 0a20 2020 2020 2020 2022 2222 0a20  ed.        """. 
+00022e70: 2020 2020 2020 2063 7373 5f72 6520 3d20         css_re = 
+00022e80: 7265 2e63 6f6d 7069 6c65 2822 5c5c 732a  re.compile("\\s*
+00022e90: 285c 5c2e 2e2a 295c 5c73 2b7b 282e 2a29  (\\..*)\\s+{(.*)
+00022ea0: 7d5c 5c73 2a22 290a 2020 2020 2020 2020  }\\s*").        
+00022eb0: 6966 2073 7479 6c65 5f65 6c65 6d73 2069  if style_elems i
+00022ec0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00022ed0: 2020 2020 7374 796c 6573 203d 205b 5d0a      styles = [].
+00022ee0: 2020 2020 2020 2020 7374 796c 655f 6469          style_di
+00022ef0: 6374 203d 2064 6963 7428 290a 2020 2020  ct = dict().    
+00022f00: 2020 2020 666f 7220 7374 796c 655f 656c      for style_el
+00022f10: 656d 2069 6e20 7374 796c 655f 656c 656d  em in style_elem
+00022f20: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
+00022f30: 7479 6c65 5f74 6578 7420 3d20 7374 796c  tyle_text = styl
+00022f40: 655f 656c 656d 2e74 6578 742e 7374 7269  e_elem.text.stri
+00022f50: 7028 290a 2020 2020 2020 2020 2020 2020  p().            
+00022f60: 6d61 7463 6820 3d20 6373 735f 7265 2e6d  match = css_re.m
+00022f70: 6174 6368 2873 7479 6c65 5f74 6578 7429  atch(style_text)
+00022f80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00022f90: 6e6f 7420 6d61 7463 683a 0a20 2020 2020  not match:.     
+00022fa0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00022fb0: 2056 616c 7565 4572 726f 7228 6622 4241   ValueError(f"BA
+00022fc0: 4420 6865 6164 5f73 7479 6c65 207b 7374  D head_style {st
+00022fd0: 796c 655f 7465 7874 7d22 290a 2020 2020  yle_text}").    
+00022fe0: 2020 2020 2020 2020 7265 6620 3d20 6d61          ref = ma
+00022ff0: 7463 682e 6772 6f75 7028 3129 0a20 2020  tch.group(1).   
+00023000: 2020 2020 2020 2020 2063 7373 5f73 7472           css_str
+00023010: 696e 6720 3d20 6d61 7463 682e 6772 6f75  ing = match.grou
+00023020: 7028 3229 0a20 2020 2020 2020 2020 2020  p(2).           
+00023030: 2069 6620 6373 735f 7374 7269 6e67 203d   if css_string =
+00023040: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+00023050: 2020 2020 2020 2320 7468 6973 206f 6363        # this occ
+00023060: 7572 7320 7768 656e 2074 6865 2073 7479  urs when the sty
+00023070: 6c65 2061 7474 7269 6275 7465 7320 6172  le attributes ar
+00023080: 6520 706f 7369 7469 6f6e 616c 0a20 2020  e positional.   
+00023090: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+000230a0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+000230b0: 2020 6966 2076 616c 6964 6174 653a 0a20    if validate:. 
+000230c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+000230d0: 7373 5f73 7479 6c65 203d 2043 5353 5374  ss_style = CSSSt
+000230e0: 796c 652e 6372 6561 7465 5f63 7373 5f73  yle.create_css_s
+000230f0: 7479 6c65 5f66 726f 6d5f 6373 735f 7374  tyle_from_css_st
+00023100: 7269 6e67 2863 7373 5f73 7472 696e 6729  ring(css_string)
+00023110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00023120: 2069 6620 6373 735f 7374 796c 6520 6973   if css_style is
+00023130: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00023140: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00023150: 2056 616c 7565 4572 726f 7228 6622 6261   ValueError(f"ba
+00023160: 6420 4353 5353 7479 6c65 207b 6373 735f  d CSSStyle {css_
+00023170: 7374 796c 657d 2229 0a20 2020 2020 2020  style}").       
+00023180: 2020 2020 2069 6620 7265 6620 696e 2073       if ref in s
+00023190: 7479 6c65 5f64 6963 743a 0a20 2020 2020  tyle_dict:.     
+000231a0: 2020 2020 2020 2020 2020 2069 6620 7661             if va
+000231b0: 6c69 6461 7465 3a0a 2020 2020 2020 2020  lidate:.        
+000231c0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000231d0: 6520 5661 6c75 6545 7272 6f72 2866 2264  e ValueError(f"d
+000231e0: 7570 6c69 6361 7465 2073 7479 6c65 2072  uplicate style r
+000231f0: 6566 207b 7374 796c 655f 7465 7874 7d22  ef {style_text}"
+00023200: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+00023210: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00023220: 2020 2020 7374 796c 655f 6469 6374 5b72      style_dict[r
+00023230: 6566 5d20 3d20 6373 735f 7374 7269 6e67  ef] = css_string
+00023240: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00023250: 7374 796c 655f 6469 6374 0a0a 2020 2020  style_dict..    
+00023260: 2320 2020 2063 6c61 7373 2043 5353 5374  #    class CSSSt
+00023270: 796c 653a 0a0a 2020 2020 4063 6c61 7373  yle:..    @class
+00023280: 6d65 7468 6f64 0a20 2020 2064 6566 2065  method.    def e
+00023290: 7874 7261 6374 5f73 7479 6c65 735f 6672  xtract_styles_fr
+000232a0: 6f6d 5f68 746d 6c5f 7374 7269 6e67 2863  om_html_string(c
+000232b0: 6c73 2c20 6874 6d6c 5f73 7472 293a 0a20  ls, html_str):. 
+000232c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000232d0: 2020 2065 7874 7261 6374 2073 7479 6c65     extract style
+000232e0: 7320 6672 6f6d 2068 6561 6420 6f66 2068  s from head of h
+000232f0: 746d 6c20 6669 6c65 0a20 2020 2020 2020  tml file.       
+00023300: 203a 7061 7261 6d20 6874 6d6c 5f73 7472   :param html_str
+00023310: 3a20 7374 7269 6e67 206f 6620 666f 726d  : string of form
+00023320: 203c 6874 6d6c 3e3c 6865 6164 3e3c 7374   <html><head><st
+00023330: 796c 6520 2e2e 2e3e 3c2f 7374 796c 653e  yle ...></style>
+00023340: 3c73 7479 6c65 202e 2e2e 3e3c 2f73 7479  <style ...></sty
+00023350: 6c65 3e3c 2f68 6561 643e 202e 2e2e 203c  le></head> ... <
+00023360: 2f68 746d 6c3e 0a20 2020 2020 2020 203a  /html>.        :
+00023370: 7265 7475 726e 3a20 6c69 7374 206f 6620  return: list of 
+00023380: 5f45 6c65 6d65 6e74 7320 283c 7374 796c  _Elements (<styl
+00023390: 652e 2e2e 3e20 2e2e 2e3c 2f73 7479 6c65  e...> ...</style
+000233a0: 3e29 206f 7220 5b5d 0a20 2020 2020 2020  >) or [].       
+000233b0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+000233c0: 7572 6e20 636c 732e 6578 7472 6163 745f  urn cls.extract_
+000233d0: 7374 796c 6573 5f66 726f 6d5f 6874 6d6c  styles_from_html
+000233e0: 5f68 6561 645f 656c 656d 656e 7428 4554  _head_element(ET
+000233f0: 2e66 726f 6d73 7472 696e 6728 6874 6d6c  .fromstring(html
+00023400: 5f73 7472 2929 0a0a 2020 2020 2320 2020  _str))..    #   
+00023410: 2063 6c61 7373 2043 5353 5374 796c 653a   class CSSStyle:
+00023420: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00023430: 6f64 0a20 2020 2064 6566 2065 7874 7261  od.    def extra
+00023440: 6374 5f73 7479 6c65 735f 6672 6f6d 5f68  ct_styles_from_h
+00023450: 746d 6c5f 6865 6164 5f65 6c65 6d65 6e74  tml_head_element
+00023460: 2863 6c73 2c20 6874 6d6c 5f65 6c65 6d29  (cls, html_elem)
+00023470: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00023480: 2020 2020 2020 6578 7472 6163 7420 7374        extract st
+00023490: 796c 6573 2066 726f 6d20 6865 6164 206f  yles from head o
+000234a0: 6620 6874 6d6c 2066 696c 650a 2020 2020  f html file.    
+000234b0: 2020 2020 3a70 6172 616d 2068 746d 6c5f      :param html_
+000234c0: 656c 656d 3a20 656c 656d 656e 7420 6f66  elem: element of
+000234d0: 2066 6f72 6d20 3c68 746d 6c3e 3c68 6561   form <html><hea
+000234e0: 643e 3c73 7479 6c65 202e 2e2e 3e3c 2f73  d><style ...></s
+000234f0: 7479 6c65 3e3c 7374 796c 6520 2e2e 2e3e  tyle><style ...>
+00023500: 3c2f 7374 796c 653e 3c2f 6865 6164 3e20  </style></head> 
+00023510: 2e2e 2e20 3c2f 6874 6d6c 3e0a 2020 2020  ... </html>.    
+00023520: 2020 2020 3a72 6574 7572 6e3a 206c 6973      :return: lis
+00023530: 7420 6f66 205f 456c 656d 656e 7473 2028  t of _Elements (
+00023540: 3c73 7479 6c65 2e2e 2e3e 202e 2e2e 3c2f  <style...> ...</
+00023550: 7374 796c 653e 2920 6f72 205b 5d0a 2020  style>) or [].  
+00023560: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00023570: 2020 7265 7475 726e 205b 5d20 6966 2068    return [] if h
+00023580: 746d 6c5f 656c 656d 2069 7320 4e6f 6e65  tml_elem is None
+00023590: 2065 6c73 6520 6874 6d6c 5f65 6c65 6d2e   else html_elem.
+000235a0: 7870 6174 6828 5354 594c 455f 5850 4154  xpath(STYLE_XPAT
+000235b0: 4829 0a0a 2020 2020 4063 6c61 7373 6d65  H)..    @classme
+000235c0: 7468 6f64 0a20 2020 2064 6566 2063 7265  thod.    def cre
+000235d0: 6174 655f 6373 735f 7374 796c 655f 6672  ate_css_style_fr
+000235e0: 6f6d 5f68 746d 6c5f 6865 6164 5f73 7479  om_html_head_sty
+000235f0: 6c65 5f65 6c65 6d28 636c 732c 2073 7479  le_elem(cls, sty
+00023600: 6c65 5f65 6c65 6d29 3a0a 2020 2020 2020  le_elem):.      
+00023610: 2020 2222 220a 2020 2020 2020 2020 6578    """.        ex
+00023620: 7472 6163 7473 2043 5353 5374 796c 6520  tracts CSSStyle 
+00023630: 656c 656d 6e74 2066 726f 6d20 4854 4d4c  elemnt from HTML
+00023640: 203c 7374 796c 653e 2e66 6f6f 207b 613a   <style>.foo {a:
+00023650: 623b 2063 3a64 3b7d 2065 6c65 6d65 6e74  b; c:d;} element
+00023660: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00023670: 7374 796c 655f 656c 656d 3a0a 2020 2020  style_elem:.    
+00023680: 2020 2020 3a72 6574 7572 6e3a 2074 7570      :return: tup
+00023690: 6c65 2873 796d 626f 6c20 7265 662c 206e  le(symbol ref, n
+000236a0: 6577 2043 5353 5374 796c 6529 0a20 2020  ew CSSStyle).   
+000236b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000236c0: 2073 7479 6c65 5f72 6520 3d20 7265 2e63   style_re = re.c
+000236d0: 6f6d 7069 6c65 2822 5c5c 732a 285b 5e5c  ompile("\\s*([^\
+000236e0: 5c73 5d2a 295c 5c73 2b7b 282e 2a29 7d5c  \s]*)\\s+{(.*)}\
+000236f0: 5c73 2a22 290a 2020 2020 2020 2020 7379  \s*").        sy
+00023700: 6d62 6f6c 5f72 6566 203d 204e 6f6e 650a  mbol_ref = None.
+00023710: 2020 2020 2020 2020 6373 735f 7374 796c          css_styl
+00023720: 655f 6f62 6a20 3d20 4e6f 6e65 0a20 2020  e_obj = None.   
+00023730: 2020 2020 2069 6620 7479 7065 2873 7479       if type(sty
+00023740: 6c65 5f65 6c65 6d29 2069 7320 5f45 6c65  le_elem) is _Ele
+00023750: 6d65 6e74 3a0a 2020 2020 2020 2020 2020  ment:.          
+00023760: 2020 7465 7874 203d 2058 6d6c 4c69 622e    text = XmlLib.
+00023770: 6765 745f 7465 7874 2873 7479 6c65 5f65  get_text(style_e
+00023780: 6c65 6d29 0a20 2020 2020 2020 2020 2020  lem).           
+00023790: 206d 6174 6368 203d 2073 7479 6c65 5f72   match = style_r
+000237a0: 652e 6d61 7463 6828 7465 7874 290a 2020  e.match(text).  
+000237b0: 2020 2020 2020 2020 2020 6966 206d 6174            if mat
+000237c0: 6368 3a0a 2020 2020 2020 2020 2020 2020  ch:.            
+000237d0: 2020 2020 7379 6d62 6f6c 5f72 6566 203d      symbol_ref =
+000237e0: 206d 6174 6368 2e67 726f 7570 2831 290a   match.group(1).
+000237f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023800: 6373 735f 7374 796c 655f 6f62 6a20 3d20  css_style_obj = 
+00023810: 4353 5353 7479 6c65 2e63 7265 6174 655f  CSSStyle.create_
+00023820: 6373 735f 7374 796c 655f 6672 6f6d 5f63  css_style_from_c
+00023830: 7373 5f73 7472 696e 6728 6d61 7463 682e  ss_string(match.
+00023840: 6772 6f75 7028 3229 290a 2020 2020 2020  group(2)).      
+00023850: 2020 7265 7475 726e 2073 796d 626f 6c5f    return symbol_
+00023860: 7265 662c 2063 7373 5f73 7479 6c65 5f6f  ref, css_style_o
+00023870: 626a 0a0a 2020 2020 4063 6c61 7373 6d65  bj..    @classme
+00023880: 7468 6f64 0a20 2020 2064 6566 2072 6570  thod.    def rep
+00023890: 6c61 6365 5f63 7373 5f73 7479 6c65 5f6e  lace_css_style_n
+000238a0: 616d 655f 7661 6c75 6573 5f77 6974 685f  ame_values_with_
+000238b0: 6e6f 726d 616c 697a 6564 5f66 6f6e 7428  normalized_font(
+000238c0: 636c 732c 2073 7479 6c65 5f65 6c65 6d29  cls, style_elem)
+000238d0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000238e0: 2020 2020 2020 6966 2073 7479 6c65 5f65        if style_e
+000238f0: 6c65 6d20 636f 6e74 6169 6e73 2061 2066  lem contains a f
+00023900: 6f6e 7420 696e 2074 6865 2043 5353 2076  ont in the CSS v
+00023910: 616c 7565 732c 206e 6f72 6d61 6c69 7a65  alues, normalize
+00023920: 7320 6974 2069 6620 706f 7373 6962 6c65  s it if possible
+00023930: 0a20 2020 2020 2020 2028 652e 672e 2066  .        (e.g. f
+00023940: 6f6e 742d 6661 6d69 6c79 3a20 4172 6961  ont-family: Aria
+00023950: 6c42 6f6c 643b 203d 3e20 666f 6e74 2d66  lBold; => font-f
+00023960: 616d 696c 793a 4172 6961 6c3b 2066 6f6e  amily:Arial; fon
+00023970: 742d 7765 6967 6874 3a20 626f 6c64 3b0a  t-weight: bold;.
+00023980: 2020 2020 2020 2020 6564 6974 7320 7468          edits th
+00023990: 6520 7374 796c 655f 656c 656d 0a20 2020  e style_elem.   
+000239a0: 2020 2020 203a 7061 7261 6d20 7374 796c       :param styl
+000239b0: 655f 656c 656d 3a20 656c 656d 656e 7420  e_elem: element 
+000239c0: 746f 2062 6520 6564 6974 6564 2028 4e4f  to be edited (NO
+000239d0: 5420 636f 7069 6564 290a 2020 2020 2020  T copied).      
+000239e0: 2020 2222 220a 2020 2020 2020 2020 7379    """.        sy
+000239f0: 6d62 6f6c 5f72 6566 2c20 6e65 775f 6373  mbol_ref, new_cs
+00023a00: 7373 7479 6c65 203d 2041 6d69 466f 6e74  sstyle = AmiFont
+00023a10: 2e63 7265 6174 655f 666f 6e74 5f65 6469  .create_font_edi
+00023a20: 7465 645f 7374 796c 655f 6672 6f6d 5f63  ted_style_from_c
+00023a30: 7373 5f73 7479 6c65 5f6f 626a 6563 7428  ss_style_object(
+00023a40: 7374 796c 655f 656c 656d 290a 2020 2020  style_elem).    
+00023a50: 2020 2020 6966 206e 6577 5f63 7373 7374      if new_cssst
+00023a60: 796c 6520 6973 206e 6f74 204e 6f6e 653a  yle is not None:
+00023a70: 0a20 2020 2020 2020 2020 2020 2073 7479  .            sty
+00023a80: 6c65 5f65 6c65 6d2e 7465 7874 203d 2066  le_elem.text = f
+00023a90: 227b 7379 6d62 6f6c 5f72 6566 7d20 7b7b  "{symbol_ref} {{
+00023aa0: 7b6e 6577 5f63 7373 7374 796c 657d 7d7d  {new_cssstyle}}}
+00023ab0: 220a 0a20 2020 2040 636c 6173 736d 6574  "..    @classmet
+00023ac0: 686f 640a 2020 2020 6465 6620 6e6f 726d  hod.    def norm
+00023ad0: 616c 697a 655f 7374 796c 6573 5f69 6e5f  alize_styles_in_
+00023ae0: 666f 6e74 735f 696e 5f68 746d 6c5f 6865  fonts_in_html_he
+00023af0: 6164 2863 6c73 2c20 6874 6d6c 5f65 6c65  ad(cls, html_ele
+00023b00: 6d29 3a0a 2020 2020 2020 2020 2222 220a  m):.        """.
+00023b10: 2020 2020 2020 2020 6e6f 726d 616c 697a          normaliz
+00023b20: 6573 2061 6c6c 2066 6f6e 7473 2074 6f20  es all fonts to 
+00023b30: 6578 706f 7365 2066 6f6e 7420 7765 6967  expose font weig
+00023b40: 6874 7320 616e 6420 7374 796c 6573 0a20  hts and styles. 
+00023b50: 2020 2020 2020 203a 7061 7261 6d20 6874         :param ht
+00023b60: 6d6c 5f65 6c65 6d3a 2048 544d 4c20 2872  ml_elem: HTML (r
+00023b70: 6f6f 7429 2065 6c65 6d65 6e74 2028 6874  oot) element (ht
+00023b80: 6d6c 2f68 6561 642f 7374 796c 652a 290a  ml/head/style*).
+00023b90: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00023ba0: 2020 2020 7374 796c 655f 656c 656d 7320      style_elems 
+00023bb0: 3d20 4353 5353 7479 6c65 2e65 7874 7261  = CSSStyle.extra
+00023bc0: 6374 5f73 7479 6c65 735f 6672 6f6d 5f68  ct_styles_from_h
+00023bd0: 746d 6c5f 6865 6164 5f65 6c65 6d65 6e74  tml_head_element
+00023be0: 2868 746d 6c5f 656c 656d 290a 2020 2020  (html_elem).    
+00023bf0: 2020 2020 666f 7220 7374 796c 655f 656c      for style_el
+00023c00: 656d 2069 6e20 7374 796c 655f 656c 656d  em in style_elem
+00023c10: 733a 0a20 2020 2020 2020 2020 2020 2043  s:.            C
+00023c20: 5353 5374 796c 652e 7265 706c 6163 655f  SSStyle.replace_
+00023c30: 6373 735f 7374 796c 655f 6e61 6d65 5f76  css_style_name_v
+00023c40: 616c 7565 735f 7769 7468 5f6e 6f72 6d61  alues_with_norma
+00023c50: 6c69 7a65 645f 666f 6e74 2873 7479 6c65  lized_font(style
+00023c60: 5f65 6c65 6d29 0a0a 2020 2020 4070 726f  _elem)..    @pro
+00023c70: 7065 7274 790a 2020 2020 6465 6620 7368  perty.    def sh
+00023c80: 6f72 745f 7374 796c 6528 7365 6c66 293a  ort_style(self):
+00023c90: 0a20 2020 2020 2020 2073 686f 7274 5f73  .        short_s
+00023ca0: 7479 6c65 203d 2073 656c 662e 666f 6e74  tyle = self.font
+00023cb0: 5f66 616d 696c 792e 6c6f 7765 7228 295b  _family.lower()[
+00023cc0: 3a33 5d0a 2020 2020 2020 2020 7368 6f72  :3].        shor
+00023cd0: 745f 7374 796c 6520 2b3d 2073 7472 2873  t_style += str(s
+00023ce0: 656c 662e 666f 6e74 5f73 697a 6529 2e72  elf.font_size).r
+00023cf0: 6570 6c61 6365 2822 2e22 2c20 225f 2229  eplace(".", "_")
+00023d00: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+00023d10: 2e69 735f 626f 6c64 3a0a 2020 2020 2020  .is_bold:.      
+00023d20: 2020 2020 2020 7368 6f72 745f 7374 796c        short_styl
+00023d30: 6520 2b3d 2022 6222 0a20 2020 2020 2020  e += "b".       
+00023d40: 2069 6620 7365 6c66 2e69 735f 6974 616c   if self.is_ital
+00023d50: 6963 3a0a 2020 2020 2020 2020 2020 2020  ic:.            
+00023d60: 7368 6f72 745f 7374 796c 6520 2b3d 2022  short_style += "
+00023d70: 6922 0a20 2020 2020 2020 2072 6574 7572  i".        retur
+00023d80: 6e20 7368 6f72 745f 7374 796c 650a 0a20  n short_style.. 
+00023d90: 2020 2064 6566 2067 6574 5f66 6f6e 745f     def get_font_
+00023da0: 6174 7472 6962 7574 6573 2873 656c 6629  attributes(self)
+00023db0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00023dc0: 2020 2020 2020 7365 7473 2034 2066 6f6e        sets 4 fon
+00023dd0: 7420 6174 7472 6962 7574 6573 2028 7769  t attributes (wi
+00023de0: 6474 682c 2073 697a 652c 206e 6f6e 7374  dth, size, nonst
+00023df0: 726f 6b65 2c20 7374 726f 6b65 2c20 666f  roke, stroke, fo
+00023e00: 6e74 6e61 6d65 0a20 2020 2020 2020 2022  ntname.        "
+00023e10: 2222 0a0a 2020 2020 2020 2020 6966 2073  ""..        if s
+00023e20: 656c 662e 6e61 6d65 5f76 616c 7565 5f64  elf.name_value_d
+00023e30: 6963 7420 6973 204e 6f6e 653a 0a20 2020  ict is None:.   
+00023e40: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00023e50: 284e 6f6e 652c 204e 6f6e 652c 204e 6f6e  (None, None, Non
+00023e60: 652c 204e 6f6e 652c 204e 6f6e 6529 0a20  e, None, None). 
+00023e70: 2020 2020 2020 2072 6574 7572 6e20 280a         return (.
+00023e80: 2020 2020 2020 2020 2020 2020 2320 7365              # se
+00023e90: 6c66 2e6e 616d 655f 7661 6c75 655f 6469  lf.name_value_di
+00023ea0: 6374 2e67 6574 2843 5353 5374 796c 652e  ct.get(CSSStyle.
+00023eb0: 5749 4454 4829 2c0a 2020 2020 2020 2020  WIDTH),.        
+00023ec0: 2020 2020 7365 6c66 2e67 6574 5f61 7474      self.get_att
+00023ed0: 7269 6275 7465 2843 5353 5374 796c 652e  ribute(CSSStyle.
+00023ee0: 464f 4e54 5f53 495a 4529 2c0a 2020 2020  FONT_SIZE),.    
+00023ef0: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
+00023f00: 5f61 7474 7269 6275 7465 2843 5353 5374  _attribute(CSSSt
+00023f10: 796c 652e 4649 4c4c 292c 0a20 2020 2020  yle.FILL),.     
+00023f20: 2020 2020 2020 2073 656c 662e 6765 745f         self.get_
+00023f30: 6174 7472 6962 7574 6528 4353 5353 7479  attribute(CSSSty
+00023f40: 6c65 2e53 5452 4f4b 4529 2c0a 2020 2020  le.STROKE),.    
+00023f50: 2020 2020 2020 2020 7365 6c66 2e67 6574          self.get
+00023f60: 5f61 7474 7269 6275 7465 2843 5353 5374  _attribute(CSSSt
+00023f70: 796c 652e 464f 4e54 5f46 414d 494c 5929  yle.FONT_FAMILY)
+00023f80: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00023f90: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+00023fa0: 2064 6566 2067 6574 5f63 6f6f 7264 7328   def get_coords(
+00023fb0: 636c 732c 2065 6c65 6d29 3a0a 2020 2020  cls, elem):.    
+00023fc0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00023fd0: 3a72 6574 7572 6e3a 2078 302c 2078 312c  :return: x0, x1,
+00023fe0: 2079 302c 2079 310a 2020 2020 2020 2020   y0, y1.        
+00023ff0: 2222 220a 2020 2020 2020 2020 6373 7373  """.        csss
+00024000: 203d 2063 6c73 2e63 7265 6174 655f 6373   = cls.create_cs
+00024010: 735f 7374 796c 655f 6672 6f6d 5f61 7474  s_style_from_att
+00024020: 7269 6275 7465 5f6f 665f 626f 6479 5f65  ribute_of_body_e
+00024030: 6c65 6d65 6e74 2865 6c65 6d29 0a20 2020  lement(elem).   
+00024040: 2020 2020 2078 3020 3d20 6373 7373 2e67       x0 = csss.g
+00024050: 6574 5f6e 756d 6572 6963 5f61 7474 7661  et_numeric_attva
+00024060: 6c28 2278 3022 290a 2020 2020 2020 2020  l("x0").        
+00024070: 7831 203d 2063 7373 732e 6765 745f 6e75  x1 = csss.get_nu
+00024080: 6d65 7269 635f 6174 7476 616c 2822 7831  meric_attval("x1
+00024090: 2229 0a20 2020 2020 2020 2079 3020 3d20  ").        y0 = 
+000240a0: 6373 7373 2e67 6574 5f6e 756d 6572 6963  csss.get_numeric
+000240b0: 5f61 7474 7661 6c28 2279 3022 290a 2020  _attval("y0").  
+000240c0: 2020 2020 2020 7931 203d 2063 7373 732e        y1 = csss.
+000240d0: 6765 745f 6e75 6d65 7269 635f 6174 7476  get_numeric_attv
+000240e0: 616c 2822 7931 2229 0a20 2020 2020 2020  al("y1").       
+000240f0: 2072 6574 7572 6e20 2878 302c 2079 302c   return (x0, y0,
+00024100: 2078 312c 2079 3129 0a0a 2020 2020 4063   x1, y1)..    @c
+00024110: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00024120: 6566 2067 6574 5f78 3028 636c 732c 2065  ef get_x0(cls, e
+00024130: 6c65 6d29 3a0a 2020 2020 2020 2020 7265  lem):.        re
+00024140: 7475 726e 2063 6c73 2e67 6574 5f63 6f6f  turn cls.get_coo
+00024150: 7264 7328 656c 656d 295b 305d 0a0a 2020  rds(elem)[0]..  
+00024160: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00024170: 2020 2064 6566 2067 6574 5f79 3028 636c     def get_y0(cl
+00024180: 732c 2065 6c65 6d29 3a0a 2020 2020 2020  s, elem):.      
+00024190: 2020 7265 7475 726e 2063 6c73 2e67 6574    return cls.get
+000241a0: 5f63 6f6f 7264 7328 656c 656d 295b 315d  _coords(elem)[1]
+000241b0: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+000241c0: 6f64 0a20 2020 2064 6566 2067 6574 5f78  od.    def get_x
+000241d0: 3128 636c 732c 2065 6c65 6d29 3a0a 2020  1(cls, elem):.  
+000241e0: 2020 2020 2020 7265 7475 726e 2063 6c73        return cls
+000241f0: 2e67 6574 5f63 6f6f 7264 7328 656c 656d  .get_coords(elem
+00024200: 295b 325d 0a0a 2020 2020 4063 6c61 7373  )[2]..    @class
+00024210: 6d65 7468 6f64 0a20 2020 2064 6566 2067  method.    def g
+00024220: 6574 5f79 3128 636c 732c 2065 6c65 6d29  et_y1(cls, elem)
+00024230: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00024240: 2063 6c73 2e67 6574 5f63 6f6f 7264 7328   cls.get_coords(
+00024250: 656c 656d 295b 335d 0a0a 2020 2020 4063  elem)[3]..    @c
+00024260: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00024270: 6566 2065 7874 7261 6374 5f63 6f6f 7264  ef extract_coord
+00024280: 735f 616e 645f 666f 6e74 5f70 726f 7065  s_and_font_prope
+00024290: 7274 6965 7328 636c 732c 2073 7061 6e29  rties(cls, span)
+000242a0: 3a0a 2020 2020 2020 2020 6373 7373 203d  :.        csss =
+000242b0: 2043 5353 5374 796c 652e 6372 6561 7465   CSSStyle.create
+000242c0: 5f63 7373 5f73 7479 6c65 5f66 726f 6d5f  _css_style_from_
+000242d0: 6174 7472 6962 7574 655f 6f66 5f62 6f64  attribute_of_bod
+000242e0: 795f 656c 656d 656e 7428 7370 616e 290a  y_element(span).
+000242f0: 2020 2020 2020 2020 666f 6e74 5f73 697a          font_siz
+00024300: 6520 3d20 6373 7373 2e67 6574 5f6e 756d  e = csss.get_num
+00024310: 6572 6963 5f61 7474 7661 6c28 4353 5353  eric_attval(CSSS
+00024320: 7479 6c65 2e46 4f4e 545f 5349 5a45 290a  tyle.FONT_SIZE).
+00024330: 2020 2020 2020 2020 7930 203d 2063 7373          y0 = css
+00024340: 732e 6765 745f 6e75 6d65 7269 635f 6174  s.get_numeric_at
+00024350: 7476 616c 2822 7930 2229 0a20 2020 2020  tval("y0").     
+00024360: 2020 2079 3120 3d20 6373 7373 2e67 6574     y1 = csss.get
+00024370: 5f6e 756d 6572 6963 5f61 7474 7661 6c28  _numeric_attval(
+00024380: 2279 3122 290a 2020 2020 2020 2020 7831  "y1").        x1
+00024390: 203d 2063 7373 732e 6765 745f 6e75 6d65   = csss.get_nume
+000243a0: 7269 635f 6174 7476 616c 2822 7831 2229  ric_attval("x1")
+000243b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000243c0: 666f 6e74 5f73 697a 652c 2079 302c 2079  font_size, y0, y
+000243d0: 310a 0a20 2020 2040 636c 6173 736d 6574  1..    @classmet
+000243e0: 686f 640a 2020 2020 6465 6620 6578 7472  hod.    def extr
+000243f0: 6163 745f 626f 6c64 5f69 7461 6c69 635f  act_bold_italic_
+00024400: 6672 6f6d 5f66 6f6e 745f 6661 6d69 6c79  from_font_family
+00024410: 5f66 6f72 5f73 7479 6c65 7328 636c 732c  _for_styles(cls,
+00024420: 2073 7479 6c65 7329 3a0a 2020 2020 2020   styles):.      
+00024430: 2020 2222 220a 2020 2020 2020 2020 3a73    """.        :s
+00024440: 7479 6c65 733a 206c 6973 7420 6f66 2043  tyles: list of C
+00024450: 5353 5374 796c 6520 6f62 6a65 6374 7320  SSStyle objects 
+00024460: 746f 206e 6f72 6d61 6c69 7a65 0a0a 2020  to normalize..  
+00024470: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00024480: 2020 6578 7472 6163 7465 6420 3d20 5b5d    extracted = []
+00024490: 0a20 2020 2020 2020 2066 6f72 2073 7479  .        for sty
+000244a0: 6c65 2069 6e20 7374 796c 6573 3a0a 2020  le in styles:.  
+000244b0: 2020 2020 2020 2020 2020 6966 2073 7479            if sty
+000244c0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+000244d0: 2020 2020 6578 7472 6163 7465 642e 6170      extracted.ap
+000244e0: 7065 6e64 2863 6c73 2e65 7874 7261 6374  pend(cls.extract
+000244f0: 5f62 6f6c 645f 6974 616c 6963 5f66 726f  _bold_italic_fro
+00024500: 6d5f 666f 6e74 5f66 616d 696c 795f 666f  m_font_family_fo
+00024510: 725f 7374 796c 6528 7374 796c 6529 290a  r_style(style)).
+00024520: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+00024530: 7874 7261 6374 6564 0a0a 2020 2020 4063  xtracted..    @c
+00024540: 6c61 7373 6d65 7468 6f64 0a20 2020 2064  lassmethod.    d
+00024550: 6566 2065 7874 7261 6374 5f62 6f6c 645f  ef extract_bold_
+00024560: 6974 616c 6963 5f66 726f 6d5f 666f 6e74  italic_from_font
+00024570: 5f66 616d 696c 795f 666f 725f 7374 796c  _family_for_styl
+00024580: 6528 636c 732c 2073 7479 6c65 5f73 293a  e(cls, style_s):
+00024590: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000245a0: 7374 796c 655f 733a 0a20 2020 2020 2020  style_s:.       
+000245b0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000245c0: 4572 726f 7228 2273 7479 6c65 5f73 2069  Error("style_s i
+000245d0: 7320 4e6f 6e65 2229 0a20 2020 2020 2020  s None").       
+000245e0: 2063 7373 5f73 7479 6c65 203d 2043 5353   css_style = CSS
+000245f0: 5374 796c 652e 6372 6561 7465 5f63 7373  Style.create_css
+00024600: 5f73 7479 6c65 5f66 726f 6d5f 6373 735f  _style_from_css_
+00024610: 7374 7269 6e67 2873 7472 2873 7479 6c65  string(str(style
+00024620: 5f73 2929 0a20 2020 2020 2020 2069 6620  _s)).        if 
+00024630: 6373 735f 7374 796c 653a 0a20 2020 2020  css_style:.     
+00024640: 2020 2020 2020 2063 7373 5f73 7479 6c65         css_style
+00024650: 2e65 7874 7261 6374 5f62 6f6c 645f 6974  .extract_bold_it
+00024660: 616c 6963 5f66 726f 6d5f 666f 6e74 5f66  alic_from_font_f
+00024670: 616d 696c 7928 0a20 2020 2020 2020 2020  amily(.         
+00024680: 2020 2020 2020 206f 7665 7277 7269 7465         overwrite
+00024690: 5f66 616d 696c 793d 5472 7565 2c20 6f76  _family=True, ov
+000246a0: 6572 7772 6974 655f 626f 6c64 3d54 7275  erwrite_bold=Tru
+000246b0: 652c 206f 7665 7277 7269 7465 5f73 7479  e, overwrite_sty
+000246c0: 6c65 3d54 7275 6529 0a20 2020 2020 2020  le=True).       
+000246d0: 2072 6574 7572 6e20 6373 735f 7374 796c   return css_styl
+000246e0: 650a 0a0a 636c 6173 7320 4353 5343 6f6e  e...class CSSCon
+000246f0: 7665 7274 6572 3a0a 2020 2020 2222 220a  verter:.    """.
+00024700: 2020 2020 7475 726e 7320 4343 5320 7374      turns CCS st
+00024710: 796c 6573 2069 6e74 6f20 6874 6d6c 2063  yles into html c
+00024720: 6c61 7373 6573 0a20 2020 2022 2222 0a0a  lasses.    """..
+00024730: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+00024740: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00024750: 7061 7373 0a0a 2020 2020 6465 6620 7265  pass..    def re
+00024760: 6164 5f68 746d 6c5f 656c 656d 656e 7428  ad_html_element(
+00024770: 7365 6c66 2c20 6874 6d6c 5f65 6c65 6d29  self, html_elem)
+00024780: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+00024790: 2020 2020 2020 7265 6164 7320 616e 6420        reads and 
+000247a0: 636f 6e76 6572 7473 2068 746d 6c20 656c  converts html el
+000247b0: 656d 656e 742e 0a20 2020 2020 2020 2061  ement..        a
+000247c0: 6464 7320 3c68 746d 6c3e 2061 7320 726f  dds <html> as ro
+000247d0: 6f74 2069 6620 6e6f 7420 7072 6573 656e  ot if not presen
+000247e0: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
+000247f0: 2020 2020 2020 7365 6c66 2e68 746d 6c5f        self.html_
+00024800: 656c 656d 203d 2068 746d 6c5f 656c 656d  elem = html_elem
+00024810: 0a20 2020 2020 2020 2073 656c 662e 6874  .        self.ht
+00024820: 6d6c 5f65 6c65 6d20 3d20 4874 6d6c 5469  ml_elem = HtmlTi
+00024830: 6479 2e65 6e73 7572 655f 6874 6d6c 5f68  dy.ensure_html_h
+00024840: 6561 645f 626f 6479 2873 656c 662e 6874  ead_body(self.ht
+00024850: 6d6c 5f65 6c65 6d29 0a20 2020 2020 2020  ml_elem).       
+00024860: 2072 6574 7572 6e20 7365 6c66 2e68 746d   return self.htm
+00024870: 6c5f 656c 656d 0a0a 636c 6173 7320 466f  l_elem..class Fo
+00024880: 6e74 5072 6f70 6572 7479 2845 6e75 6d29  ntProperty(Enum)
+00024890: 3a0a 2020 2020 2222 220a 2020 2020 4172  :.    """.    Ar
+000248a0: 6961 6c4e 6172 726f 770a 2020 2020 4172  ialNarrow.    Ar
+000248b0: 6961 6c4e 6172 726f 772d 426f 6c64 0a20  ialNarrow-Bold. 
+000248c0: 2020 2043 616c 6962 7269 0a20 2020 2046     Calibri.    F
+000248d0: 7275 7469 6765 724c 5450 726f 2d42 6c61  rutigerLTPro-Bla
+000248e0: 636b 436e 0a20 2020 2046 7275 7469 6765  ckCn.    Frutige
+000248f0: 724c 5450 726f 2d42 6f6c 6443 6e0a 2020  rLTPro-BoldCn.  
+00024900: 2020 4672 7574 6967 6572 4c54 5072 6f2d    FrutigerLTPro-
+00024910: 426f 6c64 436e 4974 610a 2020 2020 4672  BoldCnIta.    Fr
+00024920: 7574 6967 6572 4c54 5072 6f2d 436f 6e64  utigerLTPro-Cond
+00024930: 656e 7365 640a 2020 2020 4672 7574 6967  ensed.    Frutig
+00024940: 6572 4c54 5072 6f2d 436f 6e64 656e 7365  erLTPro-Condense
+00024950: 6449 7461 0a20 2020 2046 7275 7469 6765  dIta.    Frutige
+00024960: 724c 5450 726f 2d4c 6967 6874 0a20 2020  rLTPro-Light.   
+00024970: 2046 7275 7469 6765 724c 5450 726f 2d4c   FrutigerLTPro-L
+00024980: 6967 6874 436e 0a20 2020 2046 7275 7469  ightCn.    Fruti
+00024990: 6765 724c 5450 726f 2d4c 6967 6874 436e  gerLTPro-LightCn
+000249a0: 4974 610a 2020 2020 4672 7574 6967 6572  Ita.    Frutiger
+000249b0: 4c54 5072 6f2d 526f 6d61 6e0a 2020 2020  LTPro-Roman.    
+000249c0: 2222 220a 2020 2020 230a 2020 2020 4e4f  """.    #.    NO
+000249d0: 524d 414c 203d 2022 220a 0a20 2020 204e  RMAL = ""..    N
+000249e0: 4152 524f 5720 3d20 226e 6172 726f 7722  ARROW = "narrow"
+000249f0: 0a20 2020 2057 4944 4520 3d20 2277 6964  .    WIDE = "wid
+00024a00: 6522 0a0a 2020 2020 4c49 4748 5420 3d20  e"..    LIGHT = 
+00024a10: 226c 6967 6874 220a 2020 2020 424f 4c44  "light".    BOLD
+00024a20: 203d 2022 626f 6c64 220a 0a20 2020 2049   = "bold"..    I
+00024a30: 5441 4c49 4320 3d20 2269 7461 6c69 6322  TALIC = "italic"
+00024a40: 0a0a 2020 2020 5341 4e53 203d 2022 7361  ..    SANS = "sa
+00024a50: 6e73 220a 2020 2020 5345 5249 4620 3d20  ns".    SERIF = 
+00024a60: 2273 6572 6966 220a 2020 2020 5359 4d42  "serif".    SYMB
+00024a70: 4f4c 203d 2022 7379 6d62 6f6c 220a 2020  OL = "symbol".  
+00024a80: 2020 4d4f 4e4f 5350 4143 4520 3d20 2273    MONOSPACE = "s
+00024a90: 6f6e 6f73 7061 6365 220a 0a20 2020 2064  onospace"..    d
+00024aa0: 6566 205f 5f73 7472 5f5f 2873 656c 6629  ef __str__(self)
+00024ab0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00024ac0: 2073 7472 2873 656c 662e 7661 6c75 6529   str(self.value)
+00024ad0: 0a0a 2020 2020 6465 6620 5f5f 7265 7072  ..    def __repr
+00024ae0: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+00024af0: 2020 7265 7475 726e 2073 7472 2873 656c    return str(sel
+00024b00: 662e 7661 6c75 6529 0a0a 2320 7374 7269  f.value)..# stri
+00024b10: 7073 2070 7265 6669 7820 6f66 6620 666f  ps prefix off fo
+00024b20: 6e74 2d6e 616d 6573 0a52 455f 5052 4546  nt-names.RE_PREF
+00024b30: 203d 2072 652e 636f 6d70 696c 6528 225b   = re.compile("[
+00024b40: 412d 5a5d 7b36 7d5c 5c2b 283f 503c 6e61  A-Z]{6}\\+(?P<na
+00024b50: 6d65 3e5b 5e5c 5c73 5d2b 295c 5c73 2a22  me>[^\\s]+)\\s*"
+00024b60: 290a 636c 6173 7320 416d 6946 6f6e 743a  ).class AmiFont:
+00024b70: 0a20 2020 2022 2222 0a20 2020 2065 6d70  .    """.    emp
+00024b80: 6972 6963 616c 206e 6f72 6d61 6c69 7a61  irical normaliza
+00024b90: 7469 6f6e 206f 6620 666f 6e74 732e 2054  tion of fonts. T
+00024ba0: 7269 6573 2074 6f20 636f 6e76 6572 7420  ries to convert 
+00024bb0: 616c 6c20 746f 2074 6865 0a20 2020 2062  all to the.    b
+00024bc0: 6173 650a 2020 2020 666f 6e74 2d66 616d  ase.    font-fam
+00024bd0: 696c 793a 2073 6572 6966 2f73 616e 732d  ily: serif/sans-
+00024be0: 7365 7269 662f 6d6f 6e6f 7370 6163 650a  serif/monospace.
+00024bf0: 2020 2020 666f 6e74 2d73 7472 6574 6368      font-stretch
+00024c00: 3a20 2863 6f6e 6465 6e73 6564 2f6e 6f72  : (condensed/nor
+00024c10: 6d61 6c2f 6578 7061 6e64 6564 290a 2020  mal/expanded).  
+00024c20: 2020 666f 726e 2d77 6569 6768 743a 206e    forn-weight: n
+00024c30: 6f72 6d61 6c2f 626f 6c64 0a20 2020 2066  ormal/bold.    f
+00024c40: 6f6e 742d 7374 796c 653a 206e 6f72 6d61  ont-style: norma
+00024c50: 6c2f 6974 616c 6963 0a20 2020 2022 2222  l/italic.    """
+00024c60: 0a0a 0a20 2020 2023 2065 6d70 6972 6963  ...    # empiric
+00024c70: 616c 2063 6f6e 7665 7273 696f 6e73 3b20  al conversions; 
+00024c80: 7769 6c6c 206e 6565 6420 746f 2062 6520  will need to be 
+00024c90: 7570 6461 7465 6420 6672 6571 7565 6e74  updated frequent
+00024ca0: 6c79 0a20 2020 2063 6f6e 7665 7273 696f  ly.    conversio
+00024cb0: 6e5f 6469 6374 203d 207b 0a20 2020 2020  n_dict = {.     
+00024cc0: 2020 2022 4172 6961 6c22 3a20 466f 6e74     "Arial": Font
+00024cd0: 5072 6f70 6572 7479 2e53 414e 532c 0a20  Property.SANS,. 
+00024ce0: 2020 2020 2020 2022 4361 6c69 6272 6922         "Calibri"
+00024cf0: 3a20 466f 6e74 5072 6f70 6572 7479 2e53  : FontProperty.S
+00024d00: 414e 532c 0a20 2020 2020 2020 2022 4672  ANS,.        "Fr
+00024d10: 7574 6967 6572 223a 2046 6f6e 7450 726f  utiger": FontPro
+00024d20: 7065 7274 792e 5341 4e53 2c0a 2020 2020  perty.SANS,.    
+00024d30: 2020 2020 2248 656c 7665 7469 6361 223a      "Helvetica":
+00024d40: 2046 6f6e 7450 726f 7065 7274 792e 5341   FontProperty.SA
+00024d50: 4e53 2c0a 0a20 2020 2020 2020 2022 5469  NS,..        "Ti
+00024d60: 6d65 7322 3a20 466f 6e74 5072 6f70 6572  mes": FontProper
+00024d70: 7479 2e53 4552 4946 2c0a 0a20 2020 2020  ty.SERIF,..     
+00024d80: 2020 2022 436f 7572 6965 7222 3a20 466f     "Courier": Fo
+00024d90: 6e74 5072 6f70 6572 7479 2e4d 4f4e 4f53  ntProperty.MONOS
+00024da0: 5041 4345 2c0a 0a20 2020 2020 2020 2022  PACE,..        "
+00024db0: 5379 6d62 6f6c 223a 2046 6f6e 7450 726f  Symbol": FontPro
+00024dc0: 7065 7274 792e 5359 4d42 4f4c 2c0a 2020  perty.SYMBOL,.  
+00024dd0: 2020 7d0a 0a20 2020 2063 6f6e 645f 7265    }..    cond_re
+00024de0: 6765 7820 3d20 7265 2e63 6f6d 7069 6c65  gex = re.compile
+00024df0: 2822 282e 2a29 2843 6f6e 6465 6e73 6564  ("(.*)(Condensed
+00024e00: 7c43 6e7c 4e61 7272 6f77 2928 2e2a 2922  |Cn|Narrow)(.*)"
+00024e10: 290a 2020 2020 7769 6465 5f72 6567 6578  ).    wide_regex
+00024e20: 203d 2072 652e 636f 6d70 696c 6528 2228   = re.compile("(
+00024e30: 2e2a 2928 5769 6465 2928 2e2a 2922 290a  .*)(Wide)(.*)").
+00024e40: 0a20 2020 206c 6967 6874 5f72 6567 6578  .    light_regex
+00024e50: 203d 2072 652e 636f 6d70 696c 6528 2228   = re.compile("(
+00024e60: 2e2a 2928 4c69 6768 747c 5468 696e 2928  .*)(Light|Thin)(
+00024e70: 2e2a 2922 290a 2020 2020 626f 6c64 5f72  .*)").    bold_r
+00024e80: 6567 6578 203d 2072 652e 636f 6d70 696c  egex = re.compil
+00024e90: 6528 2228 2e2a 2928 426f 6c64 7c48 6561  e("(.*)(Bold|Hea
+00024ea0: 7679 7765 6967 6874 7c42 6c61 636b 2928  vyweight|Black)(
+00024eb0: 2e2a 2922 290a 0a20 2020 2073 7479 6c65  .*)")..    style
+00024ec0: 5f72 6567 6578 203d 2072 652e 636f 6d70  _regex = re.comp
+00024ed0: 696c 6528 2228 2e2a 2928 4974 616c 6963  ile("(.*)(Italic
+00024ee0: 7c49 7461 7c4f 626c 6971 7565 2928 2e2a  |Ita|Oblique)(.*
+00024ef0: 2922 290a 0a23 2020 2020 636c 6173 7320  )")..#    class 
+00024f00: 416d 6946 6f6e 743a 0a0a 2020 2020 6465  AmiFont:..    de
+00024f10: 6620 5f5f 696e 6974 5f5f 2873 656c 6629  f __init__(self)
+00024f20: 3a0a 2020 2020 2020 2020 7365 6c66 2e6e  :.        self.n
+00024f30: 616d 6520 3d20 4e6f 6e65 0a20 2020 2020  ame = None.     
+00024f40: 2020 2073 656c 662e 6661 6d69 6c79 203d     self.family =
+00024f50: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
+00024f60: 6c66 2e77 6569 6768 7420 3d20 7374 7228  lf.weight = str(
+00024f70: 466f 6e74 5072 6f70 6572 7479 2e4e 4f52  FontProperty.NOR
+00024f80: 4d41 4c29 0a20 2020 2020 2020 2073 656c  MAL).        sel
+00024f90: 662e 7374 796c 6520 3d20 7374 7228 466f  f.style = str(Fo
+00024fa0: 6e74 5072 6f70 6572 7479 2e4e 4f52 4d41  ntProperty.NORMA
+00024fb0: 4c29 0a20 2020 2020 2020 2073 656c 662e  L).        self.
+00024fc0: 7374 7265 7463 6865 6420 3d20 7374 7228  stretched = str(
+00024fd0: 466f 6e74 5072 6f70 6572 7479 2e4e 4f52  FontProperty.NOR
+00024fe0: 4d41 4c29 0a20 2020 2020 2020 2073 656c  MAL).        sel
+00024ff0: 662e 666f 6e74 203d 2073 7472 2846 6f6e  f.font = str(Fon
+00025000: 7450 726f 7065 7274 792e 5341 4e53 290a  tProperty.SANS).
+00025010: 0a20 2020 2023 2020 2020 636c 6173 7320  .    #    class 
+00025020: 416d 6946 6f6e 743a 0a0a 2020 2020 6465  AmiFont:..    de
+00025030: 6620 5f5f 7374 725f 5f28 7365 6c66 293a  f __str__(self):
+00025040: 0a20 2020 2020 2020 2073 203d 2066 226e  .        s = f"n
+00025050: 616d 653a 7b73 656c 662e 6e61 6d65 7d3b  ame:{self.name};
+00025060: 6661 6d69 6c79 3a7b 7365 6c66 2e66 616d  family:{self.fam
+00025070: 696c 797d 3b77 6569 6768 743a 7b73 656c  ily};weight:{sel
+00025080: 662e 7765 6967 6874 7d3b 7374 796c 653a  f.weight};style:
+00025090: 7b73 656c 662e 7374 796c 657d 3b73 7472  {self.style};str
+000250a0: 6574 6368 6564 3a7b 7365 6c66 2e73 7472  etched:{self.str
+000250b0: 6574 6368 6564 7d3b 666f 6e74 3a7b 7365  etched};font:{se
+000250c0: 6c66 2e66 6f6e 747d 220a 2020 2020 2020  lf.font}".      
+000250d0: 2020 7265 7475 726e 2073 0a0a 2020 2020    return s..    
+000250e0: 4063 6c61 7373 6d65 7468 6f64 0a20 2020  @classmethod.   
+000250f0: 2064 6566 2065 7874 7261 6374 5f6e 616d   def extract_nam
+00025100: 655f 7765 6967 6874 5f73 7479 6c65 5f73  e_weight_style_s
+00025110: 7472 6574 6368 6564 5f61 735f 666f 6e74  tretched_as_font
+00025120: 2863 6c73 2c20 6e61 6d65 3029 3a0a 0a20  (cls, name0):.. 
+00025130: 2020 2020 2020 2066 6f6e 7420 3d20 416d         font = Am
+00025140: 6946 6f6e 7428 290a 2020 2020 2020 2020  iFont().        
+00025150: 6e61 6d65 203d 2041 6d69 466f 6e74 2e74  name = AmiFont.t
+00025160: 7269 6d5f 7064 665f 7072 6566 6978 286e  rim_pdf_prefix(n
+00025170: 616d 6530 290a 0a20 2020 2020 2020 2077  ame0)..        w
+00025180: 6869 6c65 2054 7275 653a 0a20 2020 2020  hile True:.     
+00025190: 2020 2020 2020 206e 616d 652c 206d 6174         name, mat
+000251a0: 6368 203d 2063 6c73 2e65 7874 7261 6374  ch = cls.extract
+000251b0: 5f65 6e75 6d65 7261 7465 645f 7374 796c  _enumerated_styl
+000251c0: 6573 2866 6f6e 742c 206e 616d 6529 0a20  es(font, name). 
+000251d0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000251e0: 7420 6d61 7463 683a 0a20 2020 2020 2020  t match:.       
+000251f0: 2020 2020 2020 2020 2062 7265 616b 0a0a           break..
+00025200: 2020 2020 2020 2020 6e61 6d65 203d 206e          name = n
+00025210: 616d 652e 7265 706c 6163 6528 222d 222c  ame.replace("-",
+00025220: 2222 290a 0a20 2020 2020 2020 2066 6f6e  "")..        fon
+00025230: 742e 6661 6d69 6c79 203d 206e 616d 650a  t.family = name.
+00025240: 2020 2020 2020 2020 666f 6e74 2e6e 616d          font.nam
+00025250: 6520 3d20 6e61 6d65 300a 2020 2020 2020  e = name0.      
+00025260: 2020 7265 7475 726e 2066 6f6e 740a 0a20    return font.. 
+00025270: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00025280: 2020 2020 6465 6620 6578 7472 6163 745f      def extract_
+00025290: 656e 756d 6572 6174 6564 5f73 7479 6c65  enumerated_style
+000252a0: 7328 636c 732c 2066 6f6e 742c 206e 616d  s(cls, font, nam
+000252b0: 6529 3a0a 0a20 2020 2020 2020 206e 616d  e):..        nam
+000252c0: 652c 206d 6174 6368 203d 2063 6c73 2e6d  e, match = cls.m
+000252d0: 6174 6368 5f66 6f6e 745f 7072 6f70 6572  atch_font_proper
+000252e0: 7479 286e 616d 652c 2041 6d69 466f 6e74  ty(name, AmiFont
+000252f0: 2e63 6f6e 645f 7265 6765 7829 0a20 2020  .cond_regex).   
+00025300: 2020 2020 2069 6620 6d61 7463 683a 0a20       if match:. 
+00025310: 2020 2020 2020 2020 2020 2066 6f6e 742e             font.
+00025320: 7374 7265 7463 6865 6420 3d20 466f 6e74  stretched = Font
+00025330: 5072 6f70 6572 7479 2e4e 4152 524f 570a  Property.NARROW.
+00025340: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00025350: 726e 206e 616d 652c 206d 6174 6368 0a20  rn name, match. 
+00025360: 2020 2020 2020 206e 616d 652c 206d 6174         name, mat
+00025370: 6368 203d 2063 6c73 2e6d 6174 6368 5f66  ch = cls.match_f
+00025380: 6f6e 745f 7072 6f70 6572 7479 286e 616d  ont_property(nam
+00025390: 652c 2041 6d69 466f 6e74 2e77 6964 655f  e, AmiFont.wide_
+000253a0: 7265 6765 7829 0a20 2020 2020 2020 2069  regex).        i
+000253b0: 6620 6d61 7463 683a 0a20 2020 2020 2020  f match:.       
+000253c0: 2020 2020 2066 6f6e 742e 7374 7265 7463       font.stretc
+000253d0: 6865 6420 3d20 466f 6e74 5072 6f70 6572  hed = FontProper
+000253e0: 7479 2e57 4944 450a 2020 2020 2020 2020  ty.WIDE.        
+000253f0: 2020 2020 7265 7475 726e 206e 616d 652c      return name,
+00025400: 206d 6174 6368 0a20 2020 2020 2020 206e   match.        n
+00025410: 616d 652c 206d 6174 6368 203d 2063 6c73  ame, match = cls
+00025420: 2e6d 6174 6368 5f66 6f6e 745f 7072 6f70  .match_font_prop
+00025430: 6572 7479 286e 616d 652c 2041 6d69 466f  erty(name, AmiFo
+00025440: 6e74 2e6c 6967 6874 5f72 6567 6578 290a  nt.light_regex).
+00025450: 2020 2020 2020 2020 6966 206d 6174 6368          if match
+00025460: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+00025470: 6e74 2e77 6569 6768 7420 3d20 466f 6e74  nt.weight = Font
+00025480: 5072 6f70 6572 7479 2e4c 4947 4854 0a20  Property.LIGHT. 
+00025490: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000254a0: 6e20 6e61 6d65 2c20 6d61 7463 680a 2020  n name, match.  
+000254b0: 2020 2020 2020 6e61 6d65 2c20 6d61 7463        name, matc
+000254c0: 6820 3d20 636c 732e 6d61 7463 685f 666f  h = cls.match_fo
+000254d0: 6e74 5f70 726f 7065 7274 7928 6e61 6d65  nt_property(name
+000254e0: 2c20 416d 6946 6f6e 742e 626f 6c64 5f72  , AmiFont.bold_r
+000254f0: 6567 6578 290a 2020 2020 2020 2020 6966  egex).        if
+00025500: 206d 6174 6368 3a0a 2020 2020 2020 2020   match:.        
+00025510: 2020 2020 666f 6e74 2e77 6569 6768 7420      font.weight 
+00025520: 3d20 466f 6e74 5072 6f70 6572 7479 2e42  = FontProperty.B
+00025530: 4f4c 440a 2020 2020 2020 2020 2020 2020  OLD.            
+00025540: 7265 7475 726e 206e 616d 652c 206d 6174  return name, mat
+00025550: 6368 0a0a 2020 2020 2020 2020 6e61 6d65  ch..        name
+00025560: 2c20 6d61 7463 6820 3d20 636c 732e 6d61  , match = cls.ma
+00025570: 7463 685f 666f 6e74 5f70 726f 7065 7274  tch_font_propert
+00025580: 7928 6e61 6d65 2c20 416d 6946 6f6e 742e  y(name, AmiFont.
+00025590: 7374 796c 655f 7265 6765 7829 0a20 2020  style_regex).   
+000255a0: 2020 2020 2069 6620 6d61 7463 683a 0a20       if match:. 
+000255b0: 2020 2020 2020 2020 2020 2066 6f6e 742e             font.
+000255c0: 7374 796c 6520 3d20 466f 6e74 5072 6f70  style = FontProp
+000255d0: 6572 7479 2e49 5441 4c49 430a 2020 2020  erty.ITALIC.    
+000255e0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
+000255f0: 616d 652c 206d 6174 6368 0a0a 2020 2020  ame, match..    
+00025600: 2020 2020 7265 7475 726e 206e 616d 652c      return name,
+00025610: 204e 6f6e 650a 0a20 2020 2023 2020 2020   None..    #    
+00025620: 636c 6173 7320 416d 6946 6f6e 743a 0a0a  class AmiFont:..
+00025630: 2020 2020 2222 220a 2020 2020 426f 6c64      """.    Bold
+00025640: 2046 6f6e 7473 3a20 312e 2041 7269 616c   Fonts: 1. Arial
+00025650: 0a20 2020 2043 616c 6962 7269 0a20 2020  .    Calibri.   
+00025660: 2043 656e 7475 7279 2047 6f74 6869 630a   Century Gothic.
+00025670: 2020 2020 2042 6f6c 6420 342e 200a 2020       Bold 4. .  
+00025680: 2020 2046 7261 6e6b 6c69 6e20 476f 7468     Franklin Goth
+00025690: 6963 200a 2020 2020 2042 6f6c 6420 352e  ic .     Bold 5.
+000256a0: 200a 2020 2020 2046 7574 7572 6120 426f   .     Futura Bo
+000256b0: 6c64 2036 2e20 0a20 2020 2020 4769 6c6c  ld 6. .     Gill
+000256c0: 2053 616e 7320 426f 6c64 2037 2e20 0a20   Sans Bold 7. . 
+000256d0: 2020 2048 656c 7665 7469 6361 2042 6f6c     Helvetica Bol
+000256e0: 6420 382e 200a 2020 2020 496d 7061 6374  d 8. .    Impact
+000256f0: 2042 6f6c 6420 392e 0a20 2020 204c 7563   Bold 9..    Luc
+00025700: 6964 6120 5361 6e73 2042 6f6c 6420 3130  ida Sans Bold 10
+00025710: 2e20 0a20 2020 204d 7972 6961 6420 5072  . .    Myriad Pr
+00025720: 6f20 426f 6c64 2031 312e 204f 7065 6e20  o Bold 11. Open 
+00025730: 5361 6e73 2042 6f6c 6420 3132 2e20 5061  Sans Bold 12. Pa
+00025740: 6c61 7469 6e6f 2042 6f6c 6420 3133 2e20  latino Bold 13. 
+00025750: 526f 636b 7765 6c6c 2042 6f6c 6420 3134  Rockwell Bold 14
+00025760: 2e20 0a20 2020 2053 6567 6f65 2055 4920  . .    Segoe UI 
+00025770: 426f 6c64 2031 352e 2054 696d 6573 204e  Bold 15. Times N
+00025780: 6577 2052 6f6d 616e 2042 6f6c 6420 3136  ew Roman Bold 16
+00025790: 2e20 556e 6976 6572 7320 426f 6c64 2031  . Univers Bold 1
+000257a0: 372e 2056 6572 6461 6e61 2042 6f6c 6420  7. Verdana Bold 
+000257b0: 3138 2e20 4176 656e 6972 2042 6f6c 6420  18. Avenir Bold 
+000257c0: 3139 2e20 4261 736b 6572 7669 6c6c 6520  19. Baskerville 
+000257d0: 426f 6c64 2032 302e 2043 6c61 7265 6e64  Bold 20. Clarend
+000257e0: 6f6e 2042 6f6c 6420 3231 2e20 430a 2020  on Bold 21. C.  
+000257f0: 2020 6f70 7065 7270 6c61 7465 2042 6f6c    opperplate Bol
+00025800: 6420 3232 2e20 4469 646f 7420 426f 6c64  d 22. Didot Bold
+00025810: 2032 332e 2045 7572 6f73 7469 6c65 2042   23. Eurostile B
+00025820: 6f6c 6420 3234 2e20 4672 7574 6967 6572  old 24. Frutiger
+00025830: 2042 6f6c 6420 3235 2e20 4761 7261 6d6f   Bold 25. Garamo
+00025840: 6e64 2042 6f6c 6420 3236 2e20 4765 6f72  nd Bold 26. Geor
+00025850: 6769 6120 426f 6c64 2032 372e 2047 6f74  gia Bold 27. Got
+00025860: 6861 6d20 426f 6c64 2032 382e 200a 2020  ham Bold 28. .  
+00025870: 2020 486f 6566 6c65 7220 5465 7874 2042    Hoefler Text B
+00025880: 6f6c 6420 3239 2e20 4954 4320 4176 616e  old 29. ITC Avan
+00025890: 7420 4761 7264 6520 476f 7468 6963 2042  t Garde Gothic B
+000258a0: 6f6c 6420 3330 2e20 4954 4320 4672 616e  old 30. ITC Fran
+000258b0: 6b6c 696e 2047 6f74 6869 6320 426f 6c64  klin Gothic Bold
+000258c0: 2033 312e 2049 5443 204c 7562 616c 696e   31. ITC Lubalin
+000258d0: 2047 7261 7068 2042 6f6c 6420 3332 2e20   Graph Bold 32. 
+000258e0: 0a20 2020 2049 5443 204f 6666 6963 696e  .    ITC Officin
+000258f0: 6120 5361 6e73 2042 6f6c 6420 3333 2e20  a Sans Bold 33. 
+00025900: 4954 4320 5374 6f6e 6520 5361 6e73 2042  ITC Stone Sans B
+00025910: 6f6c 6420 3334 2e20 4d69 6e69 6f6e 2050  old 34. Minion P
+00025920: 726f 2042 6f6c 6420 3335 2e20 4d75 7365  ro Bold 35. Muse
+00025930: 6f20 5361 6e73 2042 6f6c 6420 3336 2e20  o Sans Bold 36. 
+00025940: 4e65 7574 7261 6661 6365 2042 6f6c 6420  Neutraface Bold 
+00025950: 3337 2e20 0a20 2020 204f 7074 696d 6120  37. .    Optima 
+00025960: 426f 6c64 2033 382e 2050 726f 7869 6d61  Bold 38. Proxima
+00025970: 204e 6f76 6120 426f 6c64 2033 392e 2052   Nova Bold 39. R
+00025980: 6f62 6f74 6f20 426f 6c64 2034 302e 2053  oboto Bold 40. S
+00025990: 6162 6f6e 2042 6f6c 6420 3431 2e20 5472  abon Bold 41. Tr
+000259a0: 6164 6520 476f 7468 6963 2042 6f6c 6420  ade Gothic Bold 
+000259b0: 3432 2e20 0a20 2020 2054 7265 6275 6368  42. .    Trebuch
+000259c0: 6574 204d 5320 426f 6c64 2034 332e 200a  et MS Bold 43. .
+000259d0: 2020 2020 5562 756e 7475 2042 6f6c 6420      Ubuntu Bold 
+000259e0: 3434 2e20 0a20 2020 2056 4147 2052 6f75  44. .    VAG Rou
+000259f0: 6e64 6564 2042 6f6c 6420 3435 2e20 0a20  nded Bold 45. . 
+00025a00: 2020 2057 6869 746e 6579 2042 6f6c 6420     Whitney Bold 
+00025a10: 3436 2e20 0a20 2020 2058 6974 7320 426f  46. .    Xits Bo
+00025a20: 6c64 2034 372e 200a 2020 2020 5961 6e6f  ld 47. .    Yano
+00025a30: 6e65 204b 6166 6665 6573 6174 7a20 426f  ne Kaffeesatz Bo
+00025a40: 6c64 2034 382e 200a 2020 2020 5a69 6c6c  ld 48. .    Zill
+00025a50: 6120 536c 6162 0a20 2020 205a 6f6e 610a  a Slab.    Zona.
+00025a60: 2020 2020 5a75 7269 6368 200a 2020 2020      Zurich .    
+00025a70: 2222 220a 0a20 2020 2023 2020 2020 636c  """..    #    cl
+00025a80: 6173 7320 416d 6946 6f6e 743a 0a0a 2020  ass AmiFont:..  
+00025a90: 2020 4063 6c61 7373 6d65 7468 6f64 0a20    @classmethod. 
+00025aa0: 2020 2064 6566 206d 6174 6368 5f66 6f6e     def match_fon
+00025ab0: 745f 7072 6f70 6572 7479 2863 6c73 2c20  t_property(cls, 
+00025ac0: 6e61 6d65 2c20 7265 6765 7829 3a0a 2020  name, regex):.  
+00025ad0: 2020 2020 2020 6d61 7463 6820 3d20 7265        match = re
+00025ae0: 6765 782e 6d61 7463 6828 6e61 6d65 290a  gex.match(name).
+00025af0: 2020 2020 2020 2020 6966 206d 6174 6368          if match
+00025b00: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
+00025b10: 6d65 203d 206d 6174 6368 2e67 726f 7570  me = match.group
+00025b20: 2831 2920 2b20 6d61 7463 682e 6772 6f75  (1) + match.grou
+00025b30: 7028 3329 2023 2063 686f 7020 6f75 7420  p(3) # chop out 
+00025b40: 6d61 7463 680a 2020 2020 2020 2020 7265  match.        re
+00025b50: 7475 726e 206e 616d 652c 206d 6174 6368  turn name, match
+00025b60: 0a0a 2020 2020 4063 6c61 7373 6d65 7468  ..    @classmeth
+00025b70: 6f64 0a20 2020 2064 6566 2063 6f6e 7665  od.    def conve
+00025b80: 7274 5f63 6f6d 6d6f 6e5f 666f 6e74 7328  rt_common_fonts(
+00025b90: 636c 7329 3a0a 2020 2020 2020 2020 7061  cls):.        pa
+00025ba0: 7373 0a0a 2020 2020 2320 2020 2063 6c61  ss..    #    cla
+00025bb0: 7373 2041 6d69 466f 6e74 3a0a 0a20 2020  ss AmiFont:..   
+00025bc0: 2040 636c 6173 736d 6574 686f 640a 2020   @classmethod.  
+00025bd0: 2020 6465 6620 6372 6561 7465 5f66 6f6e    def create_fon
+00025be0: 745f 6564 6974 6564 5f73 7479 6c65 5f66  t_edited_style_f
+00025bf0: 726f 6d5f 6865 6164 5f73 7479 6c65 2863  rom_head_style(c
+00025c00: 6c73 2c20 7374 796c 655f 656c 656d 293a  ls, style_elem):
+00025c10: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00025c20: 2020 2020 2065 6d70 6972 6963 616c 6c79       empirically
+00025c30: 2063 7265 6174 6520 7374 616e 6461 7264   create standard
+00025c40: 2066 6f6e 7473 2061 6e64 2061 7474 7269   fonts and attri
+00025c50: 6275 7465 7320 6672 6f6d 2066 6f6e 7420  butes from font 
+00025c60: 6e61 6d65 730a 2020 2020 2020 2020 3a70  names.        :p
+00025c70: 6172 616d 2063 7373 5f73 7479 6c65 3a20  aram css_style: 
+00025c80: 4353 5353 7479 6c65 204f 626a 6563 7420  CSSStyle Object 
+00025c90: 6f72 2048 544d 4c20 6865 6164 2f73 7479  or HTML head/sty
+00025ca0: 6c65 2077 6974 6820 756e 6b6e 6f77 6e20  le with unknown 
+00025cb0: 666f 6e74 2d66 616d 696c 790a 2020 2020  font-family.    
+00025cc0: 2020 2020 3a72 6574 7572 6e3a 2074 7570      :return: tup
+00025cd0: 6c65 2028 7379 6d62 6f6c 5f72 6566 2c20  le (symbol_ref, 
+00025ce0: 6e65 7720 6373 735f 7374 796c 6520 6f62  new css_style ob
+00025cf0: 6a65 6374 2077 6974 6820 7374 616e 6461  ject with standa
+00025d00: 7264 2066 6f6e 7420 616e 6420 6d61 7962  rd font and mayb
+00025d10: 6520 6e65 7720 7765 6967 6874 206f 7220  e new weight or 
+00025d20: 7374 796c 6529 0a20 2020 2020 2020 2022  style).        "
+00025d30: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+00025d40: 7420 7479 7065 2873 7479 6c65 5f65 6c65  t type(style_ele
+00025d50: 6d29 2069 7320 5f45 6c65 6d65 6e74 3a0a  m) is _Element:.
+00025d60: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00025d70: 726e 204e 6f6e 652c 204e 6f6e 650a 2020  rn None, None.  
+00025d80: 2020 2020 2020 7379 6d62 6f6c 5f72 6566        symbol_ref
+00025d90: 2c20 6373 735f 7374 796c 6520 3d20 4353  , css_style = CS
+00025da0: 5353 7479 6c65 2e63 7265 6174 655f 6373  SStyle.create_cs
+00025db0: 735f 7374 796c 655f 6672 6f6d 5f68 746d  s_style_from_htm
+00025dc0: 6c5f 6865 6164 5f73 7479 6c65 5f65 6c65  l_head_style_ele
+00025dd0: 6d28 7374 796c 655f 656c 656d 290a 2020  m(style_elem).  
+00025de0: 2020 2020 2020 6966 2063 7373 5f73 7479        if css_sty
+00025df0: 6c65 2069 7320 6e6f 7420 4e6f 6e65 3a0a  le is not None:.
+00025e00: 2020 2020 2020 2020 2020 2020 666f 6e74              font
+00025e10: 5f66 616d 696c 7920 3d20 6373 735f 7374  _family = css_st
+00025e20: 796c 652e 666f 6e74 5f66 616d 696c 790a  yle.font_family.
+00025e30: 2020 2020 2020 2020 2020 2020 616d 695f              ami_
+00025e40: 666f 6e74 203d 2041 6d69 466f 6e74 2e65  font = AmiFont.e
+00025e50: 7874 7261 6374 5f6e 616d 655f 7765 6967  xtract_name_weig
+00025e60: 6874 5f73 7479 6c65 5f73 7472 6574 6368  ht_style_stretch
+00025e70: 6564 5f61 735f 666f 6e74 2866 6f6e 745f  ed_as_font(font_
+00025e80: 6661 6d69 6c79 290a 2020 2020 2020 2020  family).        
+00025e90: 2020 2020 6e65 775f 6373 735f 7374 796c      new_css_styl
+00025ea0: 6520 3d20 4353 5353 7479 6c65 2829 0a20  e = CSSStyle(). 
+00025eb0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
+00025ec0: 7465 6d20 696e 2063 7373 5f73 7479 6c65  tem in css_style
+00025ed0: 2e6e 616d 655f 7661 6c75 655f 6469 6374  .name_value_dict
+00025ee0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00025ef0: 2020 6e65 775f 6373 735f 7374 796c 652e    new_css_style.
+00025f00: 6e61 6d65 5f76 616c 7565 5f64 6963 745b  name_value_dict[
+00025f10: 6974 656d 5b30 5d5d 203d 2069 7465 6d5b  item[0]] = item[
+00025f20: 315d 0a20 2020 2020 2020 2020 2020 206e  1].            n
+00025f30: 6577 5f63 7373 5f73 7479 6c65 2e73 6574  ew_css_style.set
+00025f40: 5f61 7474 7269 6275 7465 2846 4f4e 545f  _attribute(FONT_
+00025f50: 4641 4d49 4c59 2c20 616d 695f 666f 6e74  FAMILY, ami_font
+00025f60: 2e66 616d 696c 7929 0a20 2020 2020 2020  .family).       
+00025f70: 2020 2020 206e 6577 5f63 7373 5f73 7479       new_css_sty
+00025f80: 6c65 2e73 6574 5f61 7474 7269 6275 7465  le.set_attribute
+00025f90: 2846 4f4e 545f 5745 4947 4854 2c20 616d  (FONT_WEIGHT, am
+00025fa0: 695f 666f 6e74 2e77 6569 6768 7429 0a20  i_font.weight). 
+00025fb0: 2020 2020 2020 2020 2020 206e 6577 5f63             new_c
+00025fc0: 7373 5f73 7479 6c65 2e73 6574 5f61 7474  ss_style.set_att
+00025fd0: 7269 6275 7465 2846 4f4e 545f 5354 594c  ribute(FONT_STYL
+00025fe0: 452c 2061 6d69 5f66 6f6e 742e 7374 796c  E, ami_font.styl
+00025ff0: 6529 0a20 2020 2020 2020 2020 2020 206e  e).            n
+00026000: 6577 5f63 7373 5f73 7479 6c65 2e73 6574  ew_css_style.set
+00026010: 5f61 7474 7269 6275 7465 2846 4f4e 545f  _attribute(FONT_
+00026020: 5354 5245 5443 4845 442c 2061 6d69 5f66  STRETCHED, ami_f
+00026030: 6f6e 742e 7374 7265 7463 6865 6429 0a20  ont.stretched). 
+00026040: 2020 2020 2020 2072 6574 7572 6e20 7379         return sy
+00026050: 6d62 6f6c 5f72 6566 2c20 6e65 775f 6373  mbol_ref, new_cs
+00026060: 735f 7374 796c 650a 0a20 2020 2040 636c  s_style..    @cl
+00026070: 6173 736d 6574 686f 640a 2020 2020 6465  assmethod.    de
+00026080: 6620 6372 6561 7465 5f66 6f6e 745f 6564  f create_font_ed
+00026090: 6974 6564 5f73 7479 6c65 5f66 726f 6d5f  ited_style_from_
+000260a0: 6373 735f 7374 796c 655f 6f62 6a65 6374  css_style_object
+000260b0: 2863 6c73 2c20 6373 735f 7374 796c 6529  (cls, css_style)
+000260c0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000260d0: 2020 2020 2020 656d 7069 7269 6361 6c6c        empiricall
+000260e0: 7920 6372 6561 7465 2073 7461 6e64 6172  y create standar
+000260f0: 6420 666f 6e74 7320 616e 6420 6174 7472  d fonts and attr
+00026100: 6962 7574 6573 2066 726f 6d20 666f 6e74  ibutes from font
+00026110: 206e 616d 6573 0a20 2020 2020 2020 203a   names.        :
+00026120: 7061 7261 6d20 6373 735f 7374 796c 653a  param css_style:
+00026130: 2043 5353 5374 796c 6520 4f62 6a65 6374   CSSStyle Object
+00026140: 206f 7220 4854 4d4c 2068 6561 642f 7374   or HTML head/st
+00026150: 796c 6520 7769 7468 2075 6e6b 6e6f 776e  yle with unknown
+00026160: 2066 6f6e 742d 6661 6d69 6c79 0a20 2020   font-family.   
+00026170: 2020 2020 203a 7265 7475 726e 3a20 7475       :return: tu
+00026180: 706c 6520 2873 796d 626f 6c5f 7265 662c  ple (symbol_ref,
+00026190: 206e 6577 2063 7373 5f73 7479 6c65 206f   new css_style o
+000261a0: 626a 6563 7420 7769 7468 2073 7461 6e64  bject with stand
+000261b0: 6172 6420 666f 6e74 2061 6e64 206d 6179  ard font and may
+000261c0: 6265 206e 6577 2077 6569 6768 7420 6f72  be new weight or
+000261d0: 2073 7479 6c65 290a 2020 2020 2020 2020   style).        
+000261e0: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
+000261f0: 6373 735f 7374 796c 6520 6973 204e 6f6e  css_style is Non
+00026200: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00026210: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
+00026220: 2020 2069 6620 7479 7065 2863 7373 5f73     if type(css_s
+00026230: 7479 6c65 2920 6973 2045 542e 5f45 6c65  tyle) is ET._Ele
+00026240: 6d65 6e74 3a0a 2020 2020 2020 2020 2020  ment:.          
+00026250: 2020 7072 696e 7420 2866 2265 6c65 6d65    print (f"eleme
+00026260: 6e74 207b 4554 2e74 6f73 7472 696e 6728  nt {ET.tostring(
+00026270: 6373 735f 7374 796c 6529 7d22 290a 2020  css_style)}").  
+00026280: 2020 2020 2020 6966 2074 7970 6528 6373        if type(cs
+00026290: 735f 7374 796c 6529 2069 7320 7374 723a  s_style) is str:
+000262a0: 0a20 2020 2020 2020 2020 2020 2063 7373  .            css
+000262b0: 5f73 7479 6c65 203d 2043 5353 5374 796c  _style = CSSStyl
+000262c0: 652e 6372 6561 7465 5f63 7373 5f73 7479  e.create_css_sty
+000262d0: 6c65 5f66 726f 6d5f 6373 735f 7374 7269  le_from_css_stri
+000262e0: 6e67 2863 7373 5f73 7479 6c65 290a 2020  ng(css_style).  
+000262f0: 2020 2020 2020 6966 2063 7373 5f73 7479        if css_sty
+00026300: 6c65 2069 7320 4e6f 6e65 3a0a 2020 2020  le is None:.    
+00026310: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+00026320: 6f6e 650a 2020 2020 2020 2020 6173 7365  one.        asse
+00026330: 7274 2074 7970 6528 6373 735f 7374 796c  rt type(css_styl
+00026340: 6529 2069 7320 4353 5353 7479 6c65 2c20  e) is CSSStyle, 
+00026350: 6622 666f 756e 6420 7b74 7970 6528 6373  f"found {type(cs
+00026360: 735f 7374 796c 6529 7d22 0a20 2020 2020  s_style)}".     
+00026370: 2020 2069 6620 6e6f 7420 6373 735f 7374     if not css_st
+00026380: 796c 652e 666f 6e74 5f66 616d 696c 793a  yle.font_family:
+00026390: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000263a0: 7572 6e20 6373 735f 7374 796c 650a 2020  urn css_style.  
+000263b0: 2020 2020 2020 616d 695f 666f 6e74 203d        ami_font =
+000263c0: 2041 6d69 466f 6e74 2e65 7874 7261 6374   AmiFont.extract
+000263d0: 5f6e 616d 655f 7765 6967 6874 5f73 7479  _name_weight_sty
+000263e0: 6c65 5f73 7472 6574 6368 6564 5f61 735f  le_stretched_as_
+000263f0: 666f 6e74 2863 7373 5f73 7479 6c65 2e66  font(css_style.f
+00026400: 6f6e 745f 6661 6d69 6c79 290a 2020 2020  ont_family).    
+00026410: 2020 2020 6e65 775f 6373 735f 7374 796c      new_css_styl
+00026420: 6520 3d20 4353 5353 7479 6c65 2829 0a20  e = CSSStyle(). 
+00026430: 2020 2020 2020 2066 6f72 2069 7465 6d20         for item 
+00026440: 696e 2063 7373 5f73 7479 6c65 2e6e 616d  in css_style.nam
+00026450: 655f 7661 6c75 655f 6469 6374 2e69 7465  e_value_dict.ite
+00026460: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00026470: 2020 6e65 775f 6373 735f 7374 796c 652e    new_css_style.
+00026480: 6e61 6d65 5f76 616c 7565 5f64 6963 745b  name_value_dict[
+00026490: 6974 656d 5b30 5d5d 203d 2069 7465 6d5b  item[0]] = item[
+000264a0: 315d 0a20 2020 2020 2020 206e 6577 5f63  1].        new_c
+000264b0: 7373 5f73 7479 6c65 2e73 6574 5f61 7474  ss_style.set_att
+000264c0: 7269 6275 7465 2846 4f4e 545f 4e41 4d45  ribute(FONT_NAME
+000264d0: 2c20 7374 7228 616d 695f 666f 6e74 2e6e  , str(ami_font.n
+000264e0: 616d 6529 290a 2020 2020 2020 2020 6e65  ame)).        ne
+000264f0: 775f 6373 735f 7374 796c 652e 7365 745f  w_css_style.set_
+00026500: 6174 7472 6962 7574 6528 464f 4e54 5f46  attribute(FONT_F
+00026510: 4f4e 542c 2073 7472 2861 6d69 5f66 6f6e  ONT, str(ami_fon
+00026520: 742e 666f 6e74 2929 0a20 2020 2020 2020  t.font)).       
+00026530: 206e 6577 5f63 7373 5f73 7479 6c65 2e73   new_css_style.s
+00026540: 6574 5f61 7474 7269 6275 7465 2846 4f4e  et_attribute(FON
+00026550: 545f 4641 4d49 4c59 2c20 7374 7228 616d  T_FAMILY, str(am
+00026560: 695f 666f 6e74 2e66 616d 696c 7929 290a  i_font.family)).
+00026570: 2020 2020 2020 2020 6e65 775f 6373 735f          new_css_
+00026580: 7374 796c 652e 7365 745f 6174 7472 6962  style.set_attrib
+00026590: 7574 6528 464f 4e54 5f57 4549 4748 542c  ute(FONT_WEIGHT,
+000265a0: 2073 7472 2861 6d69 5f66 6f6e 742e 7765   str(ami_font.we
+000265b0: 6967 6874 292e 6c6f 7765 7228 2929 0a20  ight).lower()). 
+000265c0: 2020 2020 2020 206e 6577 5f63 7373 5f73         new_css_s
+000265d0: 7479 6c65 2e73 6574 5f61 7474 7269 6275  tyle.set_attribu
+000265e0: 7465 2846 4f4e 545f 5354 594c 452c 2073  te(FONT_STYLE, s
+000265f0: 7472 2861 6d69 5f66 6f6e 742e 7374 796c  tr(ami_font.styl
+00026600: 6529 2e6c 6f77 6572 2829 290a 2020 2020  e).lower()).    
+00026610: 2020 2020 6e65 775f 6373 735f 7374 796c      new_css_styl
+00026620: 652e 7365 745f 6174 7472 6962 7574 6528  e.set_attribute(
+00026630: 464f 4e54 5f53 5452 4554 4348 4544 2c20  FONT_STRETCHED, 
+00026640: 7374 7228 616d 695f 666f 6e74 2e73 7472  str(ami_font.str
+00026650: 6574 6368 6564 292e 6c6f 7765 7228 2929  etched).lower())
+00026660: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00026670: 6e65 775f 6373 735f 7374 796c 650a 0a20  new_css_style.. 
+00026680: 2020 2023 2020 2020 636c 6173 7320 416d     #    class Am
+00026690: 6946 6f6e 743a 0a0a 2020 2020 4070 726f  iFont:..    @pro
+000266a0: 7065 7274 790a 2020 2020 6465 6620 6973  perty.    def is
+000266b0: 5f62 6f6c 6428 7365 6c66 293a 0a20 2020  _bold(self):.   
+000266c0: 2020 2020 2072 6574 7572 6e20 7374 7228       return str(
+000266d0: 466f 6e74 5072 6f70 6572 7479 2e42 4f4c  FontProperty.BOL
+000266e0: 4429 203d 3d20 7365 6c66 2e77 6569 6768  D) == self.weigh
+000266f0: 740a 0a20 2020 2040 7072 6f70 6572 7479  t..    @property
+00026700: 0a20 2020 2064 6566 2069 735f 6974 616c  .    def is_ital
+00026710: 6963 2873 656c 6629 3a0a 2020 2020 2020  ic(self):.      
+00026720: 2020 7265 7475 726e 2073 7472 2846 6f6e    return str(Fon
+00026730: 7450 726f 7065 7274 792e 4954 414c 4943  tProperty.ITALIC
+00026740: 2920 3d3d 2073 656c 662e 7374 796c 650a  ) == self.style.
+00026750: 0a20 2020 2040 636c 6173 736d 6574 686f  .    @classmetho
+00026760: 640a 2020 2020 6465 6620 7472 696d 5f70  d.    def trim_p
+00026770: 6466 5f70 7265 6669 7828 636c 732c 206e  df_prefix(cls, n
+00026780: 616d 6529 3a0a 2020 2020 2020 2020 2222  ame):.        ""
+00026790: 2272 656d 6f76 6573 2074 6865 2041 4243  "removes the ABC
+000267a0: 4445 462b 2070 7265 6669 7820 6672 6f6d  DEF+ prefix from
+000267b0: 2066 6f6e 742d 6e61 6d65 0a20 2020 2020   font-name.     
+000267c0: 2020 2054 6869 7320 7072 6566 6978 2073     This prefix s
+000267d0: 6572 7665 7320 6e6f 2075 7365 6675 6c20  erves no useful 
+000267e0: 7075 7270 6f73 6520 666f 7220 7465 7874  purpose for text
+000267f0: 2061 6e61 6c79 7369 7320 616e 6420 6973   analysis and is
+00026800: 2064 6973 6361 7264 6564 2222 220a 2020   discarded""".  
+00026810: 2020 2020 2020 6966 206e 616d 653a 0a20        if name:. 
+00026820: 2020 2020 2020 2020 2020 206d 6174 6368             match
+00026830: 203d 2052 455f 5052 4546 2e6d 6174 6368   = RE_PREF.match
+00026840: 286e 616d 6529 0a20 2020 2020 2020 2020  (name).         
+00026850: 2020 2069 6620 6d61 7463 683a 0a20 2020     if match:.   
+00026860: 2020 2020 2020 2020 2020 2020 206e 616d               nam
+00026870: 6520 3d20 6d61 7463 682e 6772 6f75 7028  e = match.group(
+00026880: 226e 616d 6522 290a 2020 2020 2020 2020  "name").        
+00026890: 7265 7475 726e 206e 616d 650a 0a0a 636c  return name...cl
+000268a0: 6173 7320 5365 6374 696f 6e48 6965 7261  ass SectionHiera
+000268b0: 7263 6879 3a0a 2020 2020 2222 220a 2020  rchy:.    """.  
+000268c0: 2020 6275 696c 6473 2061 6e64 2071 7565    builds and que
+000268d0: 7269 6573 2068 6965 7261 7263 6869 6361  ries hierarchica
+000268e0: 6c20 7365 6374 696f 6e73 0a20 2020 2022  l sections.    "
+000268f0: 2222 0a0a 2020 2020 4944 203d 2022 6964  ""..    ID = "id
+00026900: 220a 2020 2020 434c 4153 5320 3d20 2763  ".    CLASS = 'c
+00026910: 6c61 7373 270a 2020 2020 444f 5420 3d20  lass'.    DOT = 
+00026920: 222e 220a 2020 2020 4d49 5353 494e 4720  ".".    MISSING 
+00026930: 3d20 226d 6973 7369 6e67 220a 2020 2020  = "missing".    
+00026940: 5345 4354 203d 2022 7365 6374 220a 0a20  SECT = "sect".. 
+00026950: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
+00026960: 7365 6c66 293a 0a20 2020 2020 2020 2070  self):.        p
+00026970: 6173 730a 0a20 2020 2064 6566 2061 6464  ass..    def add
+00026980: 5f73 6563 7469 6f6e 7328 7365 6c66 2c20  _sections(self, 
+00026990: 6465 6369 6d61 6c5f 7365 6374 696f 6e73  decimal_sections
+000269a0: 2c20 746f 703d 4e6f 6e65 2c20 706f 706c  , top=None, popl
+000269b0: 6973 743d 4e6f 6e65 293a 0a20 2020 2020  ist=None):.     
+000269c0: 2020 2069 6620 6e6f 7420 706f 706c 6973     if not poplis
+000269d0: 743a 0a20 2020 2020 2020 2020 2020 2070  t:.            p
+000269e0: 6f70 6c69 7374 203d 205b 5d0a 2020 2020  oplist = [].    
+000269f0: 2020 2020 7365 6374 696f 6e73 5f62 795f      sections_by_
+00026a00: 6c65 7665 6c20 3d20 7365 6c66 2e63 7265  level = self.cre
+00026a10: 6174 655f 7365 6374 696f 6e73 5f62 795f  ate_sections_by_
+00026a20: 6c65 7665 6c28 6465 6369 6d61 6c5f 7365  level(decimal_se
+00026a30: 6374 696f 6e73 290a 2020 2020 2020 2020  ctions).        
+00026a40: 7061 7265 6e74 5f64 6963 7420 3d20 7365  parent_dict = se
+00026a50: 6c66 2e63 7265 6174 655f 7061 7265 6e74  lf.create_parent
+00026a60: 5f64 6963 7428 7365 6374 696f 6e73 5f62  _dict(sections_b
+00026a70: 795f 6c65 7665 6c29 0a20 2020 2020 2020  y_level).       
+00026a80: 2066 6f72 2070 6f70 2069 6e20 706f 706c   for pop in popl
+00026a90: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
+00026aa0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00026ab0: 2020 2020 2020 7061 7265 6e74 5f64 6963        parent_dic
+00026ac0: 742e 706f 7028 706f 7029 2020 2320 7265  t.pop(pop)  # re
+00026ad0: 6d6f 7665 206e 6f6e 2d6e 756d 6572 6963  move non-numeric
+00026ae0: 2069 7465 6d0a 2020 2020 2020 2020 2020   item.          
+00026af0: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+00026b00: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00026b10: 2243 616e 6e6f 7420 706f 7020 7b70 6f70  "Cannot pop {pop
+00026b20: 7d22 290a 0a20 2020 2020 2020 2072 6f6f  }")..        roo
+00026b30: 7420 3d20 456c 656d 656e 7428 7365 6c66  t = Element(self
+00026b40: 2e53 4543 5429 0a20 2020 2020 2020 2072  .SECT).        r
+00026b50: 6f6f 742e 6174 7472 6962 5b73 656c 662e  oot.attrib[self.
+00026b60: 4944 5d20 3d20 2234 220a 2020 2020 2020  ID] = "4".      
+00026b70: 2020 666f 7220 7365 6374 5f69 6420 696e    for sect_id in
+00026b80: 2070 6172 656e 745f 6469 6374 2e6b 6579   parent_dict.key
+00026b90: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
+00026ba0: 2073 656c 662e 656e 7375 7265 5f65 6c65   self.ensure_ele
+00026bb0: 6d65 6e74 2872 6f6f 742c 2073 6563 745f  ment(root, sect_
+00026bc0: 6964 2c20 7061 7265 6e74 5f64 6963 7429  id, parent_dict)
+00026bd0: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+00026be0: 5f70 6172 656e 745f 6469 6374 2873 656c  _parent_dict(sel
+00026bf0: 662c 2073 6563 7469 6f6e 735f 6279 5f6c  f, sections_by_l
+00026c00: 6576 656c 293a 0a20 2020 2020 2020 2070  evel):.        p
+00026c10: 6172 656e 745f 6469 6374 203d 2064 6963  arent_dict = dic
+00026c20: 7428 290a 2020 2020 2020 2020 666f 7220  t().        for 
+00026c30: 6c65 7665 6c20 696e 2073 6563 7469 6f6e  level in section
+00026c40: 735f 6279 5f6c 6576 656c 2e6b 6579 7328  s_by_level.keys(
+00026c50: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+00026c60: 6563 745f 6964 7320 3d20 7365 6c66 2e61  ect_ids = self.a
+00026c70: 6464 5f70 6172 656e 7473 286c 6576 656c  dd_parents(level
+00026c80: 2c20 7365 6374 696f 6e73 5f62 795f 6c65  , sections_by_le
+00026c90: 7665 6c2c 2070 6172 656e 745f 6469 6374  vel, parent_dict
+00026ca0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00026cb0: 2070 6172 656e 745f 6469 6374 0a0a 2020   parent_dict..  
+00026cc0: 2020 6465 6620 6372 6561 7465 5f73 6563    def create_sec
+00026cd0: 7469 6f6e 735f 6279 5f6c 6576 656c 2873  tions_by_level(s
+00026ce0: 656c 662c 2064 6563 696d 616c 5f73 6563  elf, decimal_sec
+00026cf0: 7469 6f6e 7329 3a0a 2020 2020 2020 2020  tions):.        
+00026d00: 7365 6374 696f 6e73 5f62 795f 6c65 7665  sections_by_leve
+00026d10: 6c20 3d20 6465 6661 756c 7464 6963 7428  l = defaultdict(
+00026d20: 6c69 7374 290a 2020 2020 2020 2020 666f  list).        fo
+00026d30: 7220 7365 6374 696f 6e20 696e 2064 6563  r section in dec
+00026d40: 696d 616c 5f73 6563 7469 6f6e 733a 0a20  imal_sections:. 
+00026d50: 2020 2020 2020 2020 2020 206c 6576 656c             level
+00026d60: 203d 2073 6563 7469 6f6e 2e61 7474 7269   = section.attri
+00026d70: 622e 6765 7428 7365 6c66 2e43 4c41 5353  b.get(self.CLASS
+00026d80: 292e 7370 6c69 7428 295b 315d 0a20 2020  ).split()[1].   
+00026d90: 2020 2020 2020 2020 2073 6563 7469 6f6e           section
+00026da0: 735f 6279 5f6c 6576 656c 5b6c 6576 656c  s_by_level[level
+00026db0: 5d2e 6170 7065 6e64 2873 6563 7469 6f6e  ].append(section
+00026dc0: 2e74 6578 7429 0a20 2020 2020 2020 2072  .text).        r
+00026dd0: 6574 7572 6e20 7365 6374 696f 6e73 5f62  eturn sections_b
+00026de0: 795f 6c65 7665 6c0a 0a20 2020 2064 6566  y_level..    def
+00026df0: 2061 6464 5f70 6172 656e 7473 2873 656c   add_parents(sel
+00026e00: 662c 206c 6576 656c 2c20 6d75 6c74 6964  f, level, multid
+00026e10: 6963 742c 2070 6172 656e 745f 6469 6374  ict, parent_dict
+00026e20: 293a 0a20 2020 2020 2020 206c 6576 656c  ):.        level
+00026e30: 5f73 6563 7473 203d 206d 756c 7469 6469  _sects = multidi
+00026e40: 6374 5b6c 6576 656c 5d0a 2020 2020 2020  ct[level].      
+00026e50: 2020 666f 7220 6c65 7665 6c5f 7365 6374    for level_sect
+00026e60: 2069 6e20 6c65 7665 6c5f 7365 6374 733a   in level_sects:
+00026e70: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00026e80: 656e 7420 3d20 7365 6c66 2e67 6574 5f70  ent = self.get_p
+00026e90: 6172 656e 7428 6c65 7665 6c5f 7365 6374  arent(level_sect
+00026ea0: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
+00026eb0: 7265 6e74 5f64 6963 745b 6c65 7665 6c5f  rent_dict[level_
+00026ec0: 7365 6374 5d20 3d20 7061 7265 6e74 0a0a  sect] = parent..
+00026ed0: 2020 2020 6465 6620 6765 745f 7061 7265      def get_pare
+00026ee0: 6e74 2873 656c 662c 206c 6576 656c 5f73  nt(self, level_s
+00026ef0: 6563 7429 3a0a 2020 2020 2020 2020 6269  ect):.        bi
+00026f00: 7473 203d 206c 6576 656c 5f73 6563 742e  ts = level_sect.
+00026f10: 7370 6c69 7428 222e 2229 0a20 2020 2020  split(".").     
+00026f20: 2020 2070 6172 656e 7420 3d20 4e6f 6e65     parent = None
+00026f30: 2069 6620 6c65 6e28 6269 7473 2920 3d3d   if len(bits) ==
+00026f40: 2031 2065 6c73 6520 7365 6c66 2e44 4f54   1 else self.DOT
+00026f50: 2e6a 6f69 6e28 6269 7473 5b3a 2d31 5d29  .join(bits[:-1])
+00026f60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00026f70: 7061 7265 6e74 0a0a 2020 2020 6465 6620  parent..    def 
+00026f80: 656e 7375 7265 5f65 6c65 6d65 6e74 2873  ensure_element(s
+00026f90: 656c 662c 2072 6f6f 742c 2073 6563 745f  elf, root, sect_
+00026fa0: 6964 2c20 7061 7265 6e74 5f64 6963 7429  id, parent_dict)
+00026fb0: 3a0a 2020 2020 2020 2020 6966 2073 6563  :.        if sec
+00026fc0: 745f 6964 203d 3d20 2222 3a0a 2020 2020  t_id == "":.    
+00026fd0: 2020 2020 2020 2020 7072 696e 7428 6622          print(f"
+00026fe0: 5241 4e20 4f46 4620 544f 5022 290a 2020  RAN OFF TOP").  
+00026ff0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00027000: 204e 6f6e 650a 2020 2020 2020 2020 7870   None.        xp
+00027010: 6174 6820 3d20 6622 2f2f 7b73 656c 662e  ath = f"//{self.
+00027020: 5345 4354 7d5b 4069 643d 277b 7365 6374  SECT}[@id='{sect
+00027030: 5f69 647d 275d 220a 2020 2020 2020 2020  _id}']".        
+00027040: 656c 656d 7320 3d20 726f 6f74 2e78 7061  elems = root.xpa
+00027050: 7468 2878 7061 7468 290a 2020 2020 2020  th(xpath).      
+00027060: 2020 6966 206c 656e 2865 6c65 6d73 2920    if len(elems) 
+00027070: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00027080: 2020 7061 7265 6e74 5f69 6420 3d20 7061    parent_id = pa
+00027090: 7265 6e74 5f64 6963 742e 6765 7428 7365  rent_dict.get(se
+000270a0: 6374 5f69 6429 0a20 2020 2020 2020 2020  ct_id).         
+000270b0: 2020 206d 6973 7369 6e67 203d 2046 616c     missing = Fal
+000270c0: 7365 0a20 2020 2020 2020 2020 2020 2069  se.            i
+000270d0: 6620 7061 7265 6e74 5f69 6420 6973 204e  f parent_id is N
+000270e0: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+000270f0: 2020 2020 2070 7269 6e74 2866 2220 6d69       print(f" mi
+00027100: 7373 696e 6720 7061 7265 6e74 2073 6563  ssing parent sec
+00027110: 7469 6f6e 207b 7365 6374 5f69 647d 2229  tion {sect_id}")
+00027120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027130: 206d 6973 7369 6e67 203d 2054 7275 650a   missing = True.
+00027140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027150: 7370 6c20 3d20 7365 6374 5f69 642e 7370  spl = sect_id.sp
+00027160: 6c69 7428 7365 6c66 2e44 4f54 290a 2020  lit(self.DOT).  
+00027170: 2020 2020 2020 2020 2020 2020 2020 7370                sp
+00027180: 6c69 745f 203d 2073 706c 5b3a 2d31 5d0a  lit_ = spl[:-1].
+00027190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000271a0: 7061 7265 6e74 5f69 6420 3d20 7365 6c66  parent_id = self
+000271b0: 2e44 4f54 2e6a 6f69 6e28 7370 6c69 745f  .DOT.join(split_
+000271c0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000271d0: 2070 6172 656e 745f 6964 203d 3d20 2222   parent_id == ""
+000271e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000271f0: 2020 7072 696e 7428 6622 2073 6b69 7020    print(f" skip 
+00027200: 726f 6f74 2e2e 2e22 290a 2020 2020 2020  root...").      
+00027210: 2020 2020 2020 656c 656d 203d 2073 656c        elem = sel
+00027220: 662e 656e 7375 7265 5f65 6c65 6d65 6e74  f.ensure_element
+00027230: 2872 6f6f 742c 2070 6172 656e 745f 6964  (root, parent_id
+00027240: 2c20 7061 7265 6e74 5f64 6963 7429 0a20  , parent_dict). 
+00027250: 2020 2020 2020 2020 2020 2069 6620 656c             if el
+00027260: 656d 2069 7320 6e6f 7420 4e6f 6e65 3a0a  em is not None:.
+00027270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027280: 7365 6374 5f78 6d6c 203d 2045 542e 5375  sect_xml = ET.Su
+00027290: 6245 6c65 6d65 6e74 2865 6c65 6d2c 2073  bElement(elem, s
+000272a0: 656c 662e 5345 4354 290a 2020 2020 2020  elf.SECT).      
+000272b0: 2020 2020 2020 2020 2020 7365 6374 5f78            sect_x
+000272c0: 6d6c 2e61 7474 7269 625b 7365 6c66 2e49  ml.attrib[self.I
+000272d0: 445d 203d 2073 6563 745f 6964 0a20 2020  D] = sect_id.   
+000272e0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+000272f0: 6d69 7373 696e 673a 0a20 2020 2020 2020  missing:.       
+00027300: 2020 2020 2020 2020 2020 2020 2073 6563               sec
+00027310: 745f 786d 6c2e 6174 7472 6962 5b73 656c  t_xml.attrib[sel
+00027320: 662e 4d49 5353 494e 475d 203d 2022 5922  f.MISSING] = "Y"
+00027330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00027340: 2072 6574 7572 6e20 7365 6374 5f78 6d6c   return sect_xml
+00027350: 0a20 2020 2020 2020 2065 6c69 6620 6c65  .        elif le
+00027360: 6e28 656c 656d 7329 203e 2031 3a0a 2020  n(elems) > 1:.  
+00027370: 2020 2020 2020 2020 2020 7072 696e 7428            print(
+00027380: 6622 2064 7570 6c69 6361 7465 2069 6473  f" duplicate ids
+00027390: 3a20 7b73 6563 745f 6964 7d22 290a 2020  : {sect_id}").  
+000273a0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000273b0: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
+000273c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000273d0: 7265 7475 726e 2065 6c65 6d73 5b30 5d0a  return elems[0].
+000273e0: 0a20 2020 2064 6566 2073 6f72 745f 7365  .    def sort_se
+000273f0: 6374 696f 6e73 2873 656c 6629 3a0a 2020  ctions(self):.  
+00027400: 2020 2020 2020 7072 696e 7428 2273 6f72        print("sor
+00027410: 7420 7365 6374 696f 6e73 204e 5949 2229  t sections NYI")
+00027420: 0a20 2020 2020 2020 2070 6173 730a 0a20  .        pass.. 
+00027430: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+00027440: 2020 2020 6465 6620 736f 7274 5f69 6473      def sort_ids
+00027450: 2863 6c73 293a 0a20 2020 2020 2020 2070  (cls):.        p
+00027460: 6173 730a 0a63 6c61 7373 2046 6f6f 746e  ass..class Footn
+00027470: 6f74 653a 0a20 2020 2022 2222 6578 7472  ote:.    """extr
+00027480: 6163 7473 2066 6f6f 746e 6f74 6573 2062  acts footnotes b
+00027490: 7920 7369 7a65 2061 6e64 2073 7479 6c65  y size and style
+000274a0: 2061 6e64 2070 6572 6861 7073 2070 6f73   and perhaps pos
+000274b0: 6974 696f 6d0a 2020 2020 2222 220a 0a20  itiom.    """.. 
+000274c0: 2020 2040 636c 6173 736d 6574 686f 640a     @classmethod.
+000274d0: 2020 2020 6465 6620 6578 7472 6163 745f      def extract_
+000274e0: 666f 6f74 6e6f 7465 7328 636c 732c 2066  footnotes(cls, f
+000274f0: 6e5f 7870 6174 682c 2066 6f6f 746e 6f74  n_xpath, footnot
+00027500: 655f 7465 7874 5f63 6c61 7373 6573 2c20  e_text_classes, 
+00027510: 6874 6d6c 5f65 6c65 6d29 3a0a 2020 2020  html_elem):.    
+00027520: 2020 2020 6e65 775f 6874 6d6c 5f65 6c65      new_html_ele
+00027530: 6d20 3d20 4874 6d6c 4c69 622e 6372 6561  m = HtmlLib.crea
+00027540: 7465 5f6e 6577 5f68 746d 6c5f 7769 7468  te_new_html_with
+00027550: 5f6f 6c64 5f73 7479 6c65 7328 6874 6d6c  _old_styles(html
+00027560: 5f65 6c65 6d29 0a20 2020 2020 2020 2066  _elem).        f
+00027570: 6f6f 746e 6f74 655f 6e75 6d62 6572 5f66  ootnote_number_f
+00027580: 6f6e 745f 656c 656d 7320 3d20 6874 6d6c  ont_elems = html
+00027590: 5f65 6c65 6d2e 7870 6174 6828 666e 5f78  _elem.xpath(fn_x
+000275a0: 7061 7468 290a 2020 2020 2020 2020 6c61  path).        la
+000275b0: 7374 5f66 6f6f 746e 756d 203d 2030 0a20  st_footnum = 0. 
+000275c0: 2020 2020 2020 2075 6c20 3d20 4554 2e45         ul = ET.E
+000275d0: 6c65 6d65 6e74 2822 756c 2229 0a20 2020  lement("ul").   
+000275e0: 2020 2020 2048 746d 6c4c 6962 2e67 6574       HtmlLib.get
+000275f0: 5f62 6f64 7928 6e65 775f 6874 6d6c 5f65  _body(new_html_e
+00027600: 6c65 6d29 2e61 7070 656e 6428 756c 290a  lem).append(ul).
+00027610: 2020 2020 2020 2020 2320 6d65 7373 792c          # messy,
+00027620: 206e 6565 6420 6120 466f 6f74 6e6f 7465   need a Footnote
+00027630: 206f 626a 6563 7420 6865 7265 0a20 2020   object here.   
+00027640: 2020 2020 2066 6f72 2066 6f6f 746e 6f74       for footnot
+00027650: 655f 6e75 6d62 6572 5f65 6c65 6d20 696e  e_number_elem in
+00027660: 2066 6f6f 746e 6f74 655f 6e75 6d62 6572   footnote_number
+00027670: 5f66 6f6e 745f 656c 656d 733a 0a20 2020  _font_elems:.   
+00027680: 2020 2020 2020 2020 206c 6173 745f 666f           last_fo
+00027690: 6f74 6e75 6d2c 206c 6920 3d20 466f 6f74  otnum, li = Foot
+000276a0: 6e6f 7465 2e65 7874 7261 6374 5f66 6f6f  note.extract_foo
+000276b0: 746e 6f74 655f 616e 645f 7361 7665 280a  tnote_and_save(.
+000276c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000276d0: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
+000276e0: 656c 656d 2c20 666f 6f74 6e6f 7465 5f74  elem, footnote_t
+000276f0: 6578 745f 636c 6173 7365 732c 206c 6173  ext_classes, las
+00027700: 745f 666f 6f74 6e75 6d29 0a20 2020 2020  t_footnum).     
+00027710: 2020 2020 2020 2069 6620 6c69 2069 7320         if li is 
+00027720: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00027730: 2020 2020 2020 2020 2020 756c 2e61 7070            ul.app
+00027740: 656e 6428 6c69 290a 2020 2020 2020 2020  end(li).        
+00027750: 7265 7475 726e 206e 6577 5f68 746d 6c5f  return new_html_
+00027760: 656c 656d 0a0a 2020 2020 4063 6c61 7373  elem..    @class
+00027770: 6d65 7468 6f64 0a20 2020 2064 6566 2069  method.    def i
+00027780: 735f 666f 6f74 6e6f 7465 5f66 6f6e 7428  s_footnote_font(
+00027790: 636c 732c 2066 6f6f 746e 6f74 655f 6e75  cls, footnote_nu
+000277a0: 6d62 6572 5f65 6c65 6d29 3a0a 2020 2020  mber_elem):.    
+000277b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000277c0: 666f 6e74 2073 697a 6520 616c 6f6e 6520  font size alone 
+000277d0: 646f 6573 206e 6f74 2064 6973 7469 6e67  does not disting
+000277e0: 7569 7368 2c20 736f 2075 7365 206e 6569  uish, so use nei
+000277f0: 6768 626f 7572 696e 6720 7465 7874 0a20  ghbouring text. 
+00027800: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00027810: 2020 206e 6578 7420 3d20 586d 6c4c 6962     next = XmlLib
+00027820: 2e67 6574 5f6e 6578 745f 656c 656d 656e  .get_next_elemen
+00027830: 7428 666f 6f74 6e6f 7465 5f6e 756d 6265  t(footnote_numbe
+00027840: 725f 656c 656d 290a 2020 2020 2020 2020  r_elem).        
+00027850: 7465 7874 203d 2066 6f6f 746e 6f74 655f  text = footnote_
+00027860: 6e75 6d62 6572 5f65 6c65 6d2e 7465 7874  number_elem.text
+00027870: 0a20 2020 2020 2020 2069 6620 6e65 7874  .        if next
+00027880: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00027890: 2020 2020 2020 7072 696e 7428 6622 4e4f        print(f"NO
+000278a0: 2066 6f6c 6c6f 7769 6e67 2065 6c65 6d22   following elem"
+000278b0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+000278c0: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
+000278d0: 2020 2023 2066 6f6c 6c6f 6564 2062 7920     # folloed by 
+000278e0: 736d 616c 6c20 666f 6e74 3f0a 2020 2020  small font?.    
+000278f0: 2020 2020 6e65 7874 5f63 6c61 7373 203d      next_class =
+00027900: 206e 6578 742e 6174 7472 6962 5b22 636c   next.attrib["cl
+00027910: 6173 7322 5d0a 2020 2020 2020 2020 6966  ass"].        if
+00027920: 206e 6578 745f 636c 6173 7320 3d3d 2022   next_class == "
+00027930: 7331 3034 3522 3a0a 2020 2020 2020 2020  s1045":.        
+00027940: 2020 2020 7265 7475 726e 2054 7275 650a      return True.
+00027950: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00027960: 616c 7365 0a0a 0a23 2046 6f6f 746e 6f74  alse...# Footnot
+00027970: 650a 0a20 2020 2040 636c 6173 736d 6574  e..    @classmet
+00027980: 686f 640a 2020 2020 6465 6620 6578 7472  hod.    def extr
+00027990: 6163 745f 666f 6f74 6e6f 7465 5f61 6e64  act_footnote_and
+000279a0: 5f73 6176 6528 636c 732c 2066 6f6f 746e  _save(cls, footn
+000279b0: 6f74 655f 6e75 6d62 6572 5f65 6c65 6d2c  ote_number_elem,
+000279c0: 2066 6f6f 746e 6f74 655f 7465 7874 5f63   footnote_text_c
+000279d0: 6c61 7373 6573 2c20 6c61 7374 5f66 6f6f  lasses, last_foo
+000279e0: 746e 756d 293a 0a20 2020 2020 2020 2074  tnum):.        t
+000279f0: 6578 7420 3d20 666f 6f74 6e6f 7465 5f6e  ext = footnote_n
+00027a00: 756d 6265 725f 656c 656d 2e74 6578 740a  umber_elem.text.
+00027a10: 2020 2020 2020 2020 666f 6f74 6e6f 7465          footnote
+00027a20: 5f6e 756d 6265 7220 3d20 2d31 0a20 2020  _number = -1.   
+00027a30: 2020 2020 2069 676e 6f72 6520 3d20 4661       ignore = Fa
+00027a40: 6c73 650a 2020 2020 2020 2020 6966 206e  lse.        if n
+00027a50: 6f74 2063 6c73 2e69 735f 666f 6f74 6e6f  ot cls.is_footno
+00027a60: 7465 5f66 6f6e 7428 666f 6f74 6e6f 7465  te_font(footnote
+00027a70: 5f6e 756d 6265 725f 656c 656d 293a 0a20  _number_elem):. 
+00027a80: 2020 2020 2020 2020 2020 2069 676e 6f72             ignor
+00027a90: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
+00027aa0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00027ab0: 2020 666f 6f74 6e6f 7465 5f6e 756d 6265    footnote_numbe
+00027ac0: 7220 3d20 696e 7428 7465 7874 290a 2020  r = int(text).  
+00027ad0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
+00027ae0: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+00027af0: 2020 2020 6967 6e6f 7265 203d 2054 7275      ignore = Tru
+00027b00: 650a 2020 2020 2020 2020 6c69 203d 204e  e.        li = N
+00027b10: 6f6e 650a 2020 2020 2020 2020 6966 206e  one.        if n
+00027b20: 6f74 2069 676e 6f72 6520 616e 6420 3520  ot ignore and 5 
+00027b30: 3e20 2866 6f6f 746e 6f74 655f 6e75 6d62  > (footnote_numb
+00027b40: 6572 202d 206c 6173 745f 666f 6f74 6e75  er - last_footnu
+00027b50: 6d29 203e 3d20 303a 0a20 2020 2020 2020  m) >= 0:.       
+00027b60: 2020 2020 206c 6173 745f 666f 6f74 6e75       last_footnu
+00027b70: 6d2c 206c 6920 3d20 636c 732e 6465 6c65  m, li = cls.dele
+00027b80: 7465 5f66 6f6f 746e 6f74 655f 6e75 6d62  te_footnote_numb
+00027b90: 6572 5f61 6e64 5f66 6f6c 6c6f 7769 6e67  er_and_following
+00027ba0: 5f74 6578 745f 5f61 6e64 5f61 6464 5f74  _text__and_add_t
+00027bb0: 6f5f 6c69 7374 280a 2020 2020 2020 2020  o_list(.        
+00027bc0: 2020 2020 2020 2020 666f 6f74 6e6f 7465          footnote
+00027bd0: 5f74 6578 745f 636c 6173 7365 732c 2066  _text_classes, f
+00027be0: 6f6f 746e 6f74 655f 6e75 6d62 6572 2c0a  ootnote_number,.
+00027bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00027c00: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
+00027c10: 656c 656d 290a 2020 2020 2020 2020 7265  elem).        re
+00027c20: 7475 726e 206c 6173 745f 666f 6f74 6e75  turn last_footnu
+00027c30: 6d2c 206c 690a 0a20 2020 2023 2046 6f6f  m, li..    # Foo
+00027c40: 746e 6f74 650a 0a20 2020 2040 636c 6173  tnote..    @clas
+00027c50: 736d 6574 686f 640a 2020 2020 6465 6620  smethod.    def 
+00027c60: 6372 6561 7465 5f66 6f6f 746e 6f74 655f  create_footnote_
+00027c70: 6e75 6d62 6572 5f78 7061 7468 2863 6c73  number_xpath(cls
+00027c80: 2c20 666f 6f74 6e6f 7465 5f6e 756d 6265  , footnote_numbe
+00027c90: 725f 636c 6173 7365 7329 3a0a 2020 2020  r_classes):.    
+00027ca0: 2020 2020 7870 6174 6830 203d 2022 220a      xpath0 = "".
+00027cb0: 2020 2020 2020 2020 666f 7220 692c 2066          for i, f
+00027cc0: 6e63 2069 6e20 656e 756d 6572 6174 6528  nc in enumerate(
+00027cd0: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
+00027ce0: 636c 6173 7365 7329 3a0a 2020 2020 2020  classes):.      
+00027cf0: 2020 2020 2020 7870 6174 6830 202b 3d20        xpath0 += 
+00027d00: 2222 2069 6620 6920 3d3d 2030 2065 6c73  "" if i == 0 els
+00027d10: 6520 2220 6f72 2022 0a20 2020 2020 2020  e " or ".       
+00027d20: 2020 2020 2078 7061 7468 3020 2b3d 2066       xpath0 += f
+00027d30: 2227 7b66 6e63 7d27 220a 2020 2020 2020  "'{fnc}'".      
+00027d40: 2020 666e 5f78 7061 7468 203d 2066 222e    fn_xpath = f".
+00027d50: 2f2f 7370 616e 5b7b 7870 6174 6830 7d5d  //span[{xpath0}]
+00027d60: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+00027d70: 2066 6e5f 7870 6174 680a 0a20 2020 2023   fn_xpath..    #
+00027d80: 2046 6f6f 746e 6f74 650a 0a20 2020 2040   Footnote..    @
+00027d90: 636c 6173 736d 6574 686f 640a 2020 2020  classmethod.    
+00027da0: 6465 6620 6465 6c65 7465 5f66 6f6f 746e  def delete_footn
+00027db0: 6f74 655f 6e75 6d62 6572 5f61 6e64 5f66  ote_number_and_f
+00027dc0: 6f6c 6c6f 7769 6e67 5f74 6578 745f 5f61  ollowing_text__a
+00027dd0: 6e64 5f61 6464 5f74 6f5f 6c69 7374 280a  nd_add_to_list(.
+00027de0: 2020 2020 2020 2020 2020 2020 636c 732c              cls,
+00027df0: 2063 6c61 7373 6573 2c20 666f 6f74 6e6f   classes, footno
+00027e00: 7465 5f6e 756d 6265 722c 2066 6f6f 746e  te_number, footn
+00027e10: 6f74 655f 6e75 6d62 6572 5f65 6c65 6d29  ote_number_elem)
+00027e20: 3a0a 2020 2020 2020 2020 6c69 203d 2045  :.        li = E
+00027e30: 542e 456c 656d 656e 7428 226c 6922 290a  T.Element("li").
+00027e40: 2020 2020 2020 2020 6c69 2e61 7070 656e          li.appen
+00027e50: 6428 636f 7079 2e64 6565 7063 6f70 7928  d(copy.deepcopy(
+00027e60: 666f 6f74 6e6f 7465 5f6e 756d 6265 725f  footnote_number_
+00027e70: 656c 656d 2929 0a20 2020 2020 2020 2066  elem)).        f
+00027e80: 6f6f 746e 6f74 655f 666f 6c6c 6f77 6572  ootnote_follower
+00027e90: 7320 3d20 586d 6c4c 6962 2e67 6574 5f66  s = XmlLib.get_f
+00027ea0: 6f6c 6c6f 7769 6e67 5f65 6c65 6d65 6e74  ollowing_element
+00027eb0: 7328 666f 6f74 6e6f 7465 5f6e 756d 6265  s(footnote_numbe
+00027ec0: 725f 656c 656d 290a 2020 2020 2020 2020  r_elem).        
+00027ed0: 2320 6164 6420 6f6e 6520 7370 616e 2865  # add one span(e
+00027ee0: 6e64 7320 6166 7465 7220 666f 6e74 2063  nds after font c
+00027ef0: 6861 6d67 6529 0a20 2020 2020 2020 2063  hamge).        c
+00027f00: 6c73 2e69 7465 7261 7465 5f75 6e74 696c  ls.iterate_until
+00027f10: 5f75 6e61 6363 6570 7461 626c 655f 666f  _unacceptable_fo
+00027f20: 6e74 5f63 6c61 7373 2866 6f6f 746e 6f74  nt_class(footnot
+00027f30: 655f 666f 6c6c 6f77 6572 732c 206c 693d  e_followers, li=
+00027f40: 6c69 2c20 666e 5f63 6c61 7373 6573 3d63  li, fn_classes=c
+00027f50: 6c61 7373 6573 290a 2020 2020 2020 2020  lasses).        
+00027f60: 6c61 7374 5f66 6f6f 746e 756d 203d 2066  last_footnum = f
+00027f70: 6f6f 746e 6f74 655f 6e75 6d62 6572 0a20  ootnote_number. 
+00027f80: 2020 2020 2020 2058 6d6c 4c69 622e 7265         XmlLib.re
+00027f90: 6d6f 7665 5f65 6c65 6d65 6e74 2866 6f6f  move_element(foo
+00027fa0: 746e 6f74 655f 6e75 6d62 6572 5f65 6c65  tnote_number_ele
+00027fb0: 6d29 0a20 2020 2020 2020 2072 6574 7572  m).        retur
+00027fc0: 6e20 6c61 7374 5f66 6f6f 746e 756d 2c20  n last_footnum, 
+00027fd0: 6c69 0a0a 2020 2020 2320 466f 6f74 6e6f  li..    # Footno
+00027fe0: 7465 0a0a 2020 2020 4063 6c61 7373 6d65  te..    @classme
+00027ff0: 7468 6f64 0a20 2020 2064 6566 2069 7465  thod.    def ite
+00028000: 7261 7465 5f75 6e74 696c 5f75 6e61 6363  rate_until_unacc
+00028010: 6570 7461 626c 655f 666f 6e74 5f63 6c61  eptable_font_cla
+00028020: 7373 2863 6c73 2c20 666f 6c6c 6f77 6572  ss(cls, follower
+00028030: 732c 206c 693d 4e6f 6e65 2c20 666e 5f63  s, li=None, fn_c
+00028040: 6c61 7373 6573 3d4e 6f6e 652c 2064 6562  lasses=None, deb
+00028050: 7567 3d46 616c 7365 293a 0a20 2020 2020  ug=False):.     
+00028060: 2020 2022 2222 6974 6572 6174 6573 206f     """iterates o
+00028070: 7665 7220 656c 656d 7473 2066 6f6c 6c6f  ver elemts follo
+00028080: 7769 6e67 2061 2066 6f6f 746e 6f74 6520  wing a footnote 
+00028090: 6e75 6d62 6572 2075 6e74 696c 2061 6e20  number until an 
+000280a0: 696e 636f 6d70 6174 6962 6c65 0a20 2020  incompatible.   
+000280b0: 2020 2020 2063 6c61 7373 2073 7479 6c65       class style
+000280c0: 2069 7320 666f 756e 642c 2077 6865 6e20   is found, when 
+000280d0: 6272 6561 6b22 2222 0a20 2020 2020 2020  break""".       
+000280e0: 2066 6f72 2066 6f6c 6c6f 7765 7220 696e   for follower in
+000280f0: 2066 6f6c 6c6f 7765 7273 3a0a 2020 2020   followers:.    
+00028100: 2020 2020 2020 2020 636c 617a 7a20 3d20          clazz = 
+00028110: 666f 6c6c 6f77 6572 2e61 7474 7269 625b  follower.attrib[
+00028120: 2263 6c61 7373 225d 0a20 2020 2020 2020  "class"].       
+00028130: 2020 2020 2069 6620 636c 617a 7a20 696e       if clazz in
+00028140: 2066 6e5f 636c 6173 7365 733a 0a20 2020   fn_classes:.   
+00028150: 2020 2020 2020 2020 2020 2020 206c 692e               li.
+00028160: 6170 7065 6e64 2863 6f70 792e 6465 6570  append(copy.deep
+00028170: 636f 7079 2866 6f6c 6c6f 7765 7229 290a  copy(follower)).
+00028180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028190: 586d 6c4c 6962 2e72 656d 6f76 655f 656c  XmlLib.remove_el
+000281a0: 656d 656e 7428 666f 6c6c 6f77 6572 290a  ement(follower).
+000281b0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+000281c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000281d0: 2020 6966 2064 6562 7567 3a0a 2020 2020    if debug:.    
+000281e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000281f0: 7072 696e 7428 6622 6272 6f6b 6520 6f75  print(f"broke ou
+00028200: 7420 6f66 2066 6f6f 746e 6f74 6520 6174  t of footnote at
+00028210: 207b 636c 617a 7a7d 2229 0a20 2020 2020   {clazz}").     
+00028220: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00028230: 0a0a 0a                                  ...
```

### Comparing `amilib-0.1.0/amilib/ami_integrate.py` & `amilib-0.1.1/amilib/ami_integrate.py`

 * *Files 1% similar despite different names*

```diff
@@ -9,16 +9,15 @@
 from amilib.ami_html import HtmlUtil, P_FONTNAME, P_HEIGHT, P_STROKING_COLOR, P_NON_STROKING_COLOR, AmiSpan, P_TEXT, \
     HtmlGroup, HtmlStyle, H_BODY, H_DIV
 from amilib.ami_pdf_libs import create_thin_line_from_rect, AmiPDFPlumber, PDFDebug, AmiPage, TextStyle, AmiPlumberJson
 from amilib.file_lib import FileLib
 from amilib.util import AmiLogger
 from amilib.xml_lib import HtmlLib, XmlLib
 
-logger = AmiLogger.create_named_logger(__file__)
-logger = logging.getLogger(__file__)
+logger = FileLib.get_logger(__file__)
 
 DICT_KEYSET = set([
     'annots',
     'bbox',
     'chars',
     'curves',
     'cropbox',
```

### Comparing `amilib-0.1.0/amilib/ami_nlp.py` & `amilib-0.1.1/amilib/ami_nlp.py`

 * *Files 2% similar despite different names*

```diff
@@ -14,15 +14,17 @@
 # from scikit-learn.metrics.pairwise import cosine_similarity
 
 from sklearn import manifold
 from sklearn.cluster import AgglomerativeClustering, KMeans
 from sklearn.feature_extraction.text import TfidfVectorizer
 from sklearn.metrics.pairwise import cosine_similarity
 
-logger = logging.getLogger(__file__)
+from amilib.file_lib import FileLib
+
+logger = FileLib.get_logger(__file__)
 
 # anchor
 A_TEXT = "a_text"
 A_ID = "a_id"
 # target
 T_TEXT = "t_text"
 T_ID = "t_id"
```

### Comparing `amilib-0.1.0/amilib/ami_pdf_libs.py` & `amilib-0.1.1/amilib/ami_pdf_libs.py`

 * *Files 0% similar despite different names*

```diff
@@ -29,20 +29,21 @@
 
 from amilib.ami_html import STYLE, FONT_SIZE, FONT_WEIGHT, FONT_STYLE, STROKE, CSSStyle, FONT_FAMILY, P_X0, P_X1, \
     P_Y0, \
     P_Y1, BOLD, ITALIC, HtmlUtil, FILL, TIMES, CALIBRI, FONT_FAMILIES, H_TABLE, H_THEAD, H_TBODY, \
     H_TR, H_TD, AmiFont
 from amilib.ami_svg import AmiSVG, SVG_G
 from amilib.bbox import BBox
+from amilib.file_lib import FileLib
 from amilib.util import Util, AmiLogger
 from amilib.xml_lib import XmlLib, HtmlLib
 
 # local
 
-logger = AmiLogger.create_named_logger(__file__)
+logger = FileLib.get_logger(__file__)
 
 FACT = 2.8
 SVG_NS = "http://www.w3.org/2000/svg"
 SVGX_NS = "http://www.xml-cml.org/schema/svgx"
 
 # coordinates
 X = "x"
```

### Comparing `amilib-0.1.0/amilib/ami_svg.py` & `amilib-0.1.1/amilib/ami_svg.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,9 +1,10 @@
 import lxml.etree as ET
 
+from amilib.file_lib import FileLib
 from amilib.util import AmiLogger, Util
 from amilib.xml_lib import NS_MAP, XML_NS, SVG_NS
 
 SVG_SVG = "svg"
 SVG_G = "g"
 SVG_CIRCLE = "circle"
 SVG_LINE = "line"
@@ -33,15 +34,15 @@
 Y2 = "y2"
 
 POINTS = "points"
 FILL = "fill"
 STROKE = "stroke"
 STROKE_WIDTH = "stroke-width"
 
-logger = AmiLogger.create_named_logger(__file__)
+logger = FileLib.get_logger(__file__)
 
 class AmiSVG:
     """for actually rendering SVG?"""
 
     def __init__(self):
         pass
```

### Comparing `amilib-0.1.0/amilib/ami_util.py` & `amilib-0.1.1/amilib/ami_util.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/amilib/amidriver.py` & `amilib-0.1.1/amilib/amidriver.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/amilib/amix.py` & `amilib-0.1.1/amilib/amix.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,37 +1,39 @@
 import argparse
 import logging
 import re
 import sys
 import textwrap
+from abc import abstractmethod
 from enum import Enum
 from pathlib import Path
 
 # sometimes relative imports work, sometimes absolute
 # maybe some wiser Pythonista can clean this
 # i have no idea why html_args and pdf_args behave differently
+from amilib.file_lib import FileLib
 
 try:
     from html_args import HTMLArgs
 except ModuleNotFoundError as e:
     from amilib.html_args import HTMLArgs
 
 from amilib.pdf_args import PDFArgs
 
-from amilib.util import AbstractArgs
+from amilib.ami_args import AbstractArgs
 from amilib.wikimedia import WikidataLookup
 
 # local
 
 AMIX_DIR = Path(__file__).parent
 REPO_DIR = AMIX_DIR.parent
 
+logger = FileLib.get_logger(__file__)
 
 class AmiLib:
-    logger = logging.getLogger("amilib")
     COPY = "copy"
     DEBUG = "debug"
     EXAMPLES = "examples"
     FLAGS = "flags"
     GLOB = "glob"
     PROJ = "proj"
     SECT = "sect"
@@ -42,27 +44,26 @@
     LOGLEVEL = "loglevel"
 
     def __init__(self):
         """constructor
 
         creates symbols
         """
+        logger.debug(f"amilib constructor")
 
     def create_arg_parser(self):
         """creates adds the arguments for pyami commandline
         """
 
         def run_dict(self):
-            print(f"run dict pyamix")
+            logger.debug(f"run dict pyamix")
 
         def run_pdf(args):
-            print(f"run pdf")
+            logger.debug(f"run pdf")
 
-        # def run_project():
-        #     print(f"run project {self.args}")
 
         version = self.version()
         if not sys.argv or len(sys.argv) == 0:
             # what does this do?
             sys.argv = [AmiLib.AmiLib]
         parser = argparse.ArgumentParser(
             description=f'pyamihtmlx: V{version} call with ONE of subcommands (HTML,PDF, IPCC, UNFCCC), e.g. pyamihtmlx IPCC --help'
@@ -94,24 +95,28 @@
 
         # TODO should tests be run from this menu
 
         subparsers = parser.add_subparsers(help='subcommands', dest="command")
         for choice in subparsers.choices:
             print(f">>> {choice}")
 
-        html_parser = HTMLArgs().make_sub_parser(subparsers)
-        pdf_parser = PDFArgs().make_sub_parser(subparsers)
+        pdf_parser = AmiLibArgs.make_sub_parser(PDFArgs(), subparsers)
+        logger.debug(f"pdf_parser {pdf_parser}")
+        html_parser = AmiLibArgs.make_sub_parser(HTMLArgs(), subparsers)
+        logger.debug(f"html_parser {html_parser}")
 
-        amilib_parser = AmiLibArgs().make_sub_parser(subparsers)
 
-        parser.epilog = "other entry points run as 'python -m pyamihtmlx.ami_dict args' also ami_pdf, ami_project"
+
+
+        # amilib_parser = AmiLibArgs().make_sub_parser(subparsers)
+
+        parser.epilog = "other entry points run as 'python -m amilib.amix <args>'"
         parser.epilog = """run:
         pyamihtmlx <subcommand> <args>
-          where subcommand is in   {
-          DICT,GUI,HTML,PDF,PROJECT} and args depend on subcommand
+          where subcommand is in   {HTML,PDF} and args depend on subcommand
         """
 
         return parser
 
     def commandline(self, commandline: str) -> None:
         """runs a commandline as a single string
         """
@@ -140,154 +145,130 @@
         """parses cmdline, runs command and outputs symbols
 
         :param args: either a string or a list of strings
 
         if args is a string we split it at spaces into a list of strings
 
         """
+        logger.debug(f"********** raw arglist {args}")
         if isinstance(args, str):
             args = args.strip()
             args = args.split(" ")
 
-        print(f"command: {args}")
-        self.logger.debug(f"********** raw arglist {args}")
+        logger.warning(f"command: {args}")
         test_catch = False
         if test_catch:  # try to trap exception
             try:
                 self.parse_and_run_args(args)
             except Exception as e:
-                print(f"ERROR {e.args} from {args}")
-                logging.error(f"\n============PARSE ERROR==({e.__cause__})======\n")
+                logger.error(f"ERROR {e.args} from {args}")
                 return
-            if self.is_flag_true(self.PRINT_SYMBOLS):
-                self.symbol_ini.print_symbols()
         else:
             self.parse_and_run_args(args)
 
         return
 
     def parse_and_run_args(self, arglist, debug=False):
         """runs cmds and makes substitutions (${...} then runs workflow
 
         :param arglist:
 
         """
         # no args, create help
         if not arglist:
-            self.logger.warning("No args, running --help")
+            logger.warning("No args, running --help")
             arglist = ["--help"]
         parser = self.create_arg_parser()
         self.args = self.make_substitutions_create_arg_tuples(arglist, parser, debug=debug)
-        self.logger.debug("ARGS before substitution: " + str(self.args))
+        logger.debug("ARGS before substitution: " + str(self.args))
         # this may be redundant
         self.substitute_args()
-        self.logger.debug(f"self.args {self.args}")
+        logger.debug(f"self.args {self.args}")
         self.add_single_str_to_list()
-        self.logger.debug("ARGS after substitution: " + str(self.args))
+        logger.debug("ARGS after substitution: " + str(self.args))
         self.set_loglevel_from_args()
         self.run_arguments()
 
     #
     def substitute_args(self):
         """ iterates through self.args and makes subsitutions
         May duplicates
         """
         new_items = {}
         # self.logger.debug(f"SYMBOLS1 {self.symbol_ini.symbols}")
         for item in self.args.items():
             new_item = self.make_substitutions(item)
-            self.logger.debug(f"++++++++{item} ==> {new_item}")
+            logger.debug(f"++++++++{item} ==> {new_item}")
             new_items[new_item[0]] = new_item[1]
         self.args = new_items
-        self.logger.debug(f"******** substituted ARGS {self.args}")
+        logger.debug(f"******** substituted ARGS {self.args}")
 
     #
     def add_single_str_to_list(self):
         """convert single strings to list of one string
         Not sure of what this is for
         """
         str_args = [self.DEBUG, self.EXAMPLES]
         for str_arg in str_args:
-            self.logger.debug(f"key {str_arg}")
+            logger.debug(f"key {str_arg}")
             self.replace_single_values_in_self_args_with_list(str_arg)
-            self.logger.debug(f"args => {self.args}")
+            logger.debug(f"args => {self.args}")
 
     #
     def run_arguments(self):
         """ parse and expland arguments then ru options for
 
         Currently:
         * examples
         * project
         * tests
 
         There will be more here
 
          """
-        # print(f"RUN ARGUMENTS on {self} {self.args}")
         # path workflow
         self.wikipedia_lookup = WikidataLookup()
-        self.logger.debug(f"commandline args {self.args}")
+        logger.debug(f"commandline args {self.args}")
         subparser_type = self.args.get("command")
         logging.debug(f" COMMAND: {subparser_type} {self.args}")
 
         subparser_dict = {
             # "DICT": AmiDictArgs(),
             # "GUI":  GUIArgs(),
             "HTML": HTMLArgs(),
             "PDF": PDFArgs(),
         }
         abstract_args = subparser_dict.get(subparser_type)
 
+        logger.warning(f"abstract_args {abstract_args}")
         if abstract_args:
             abstract_args.parse_and_process1(self.args)
         else:
             self.run_core_mathods()
 
     #
     def run_core_mathods(self):
         logging.debug(f"run_core")
         # mainly obsolete
         if self.VERSION in self.args and self.args[self.VERSION] is not None:
             self.print_version()
-        if self.FLAGS in self.args and self.args[self.FLAGS] is not None:
-            self.add_flags()
-        # if self.CONFIG in self.args and self.args[self.CONFIG] is not None:
-        #     self.apply_config()
-        # if self.EXAMPLES in self.args:
-        #     example_args = self.args[self.EXAMPLES]
-        #     if example_args is not None:
-        #         self.logger.debug(f" examples args: {example_args}")
-        #         Examples(self).run_examples(example_args)
-        if self.COPY in self.args and not self.args[self.COPY] is None:
-            self.logger.warning(f"COPY {self.args[self.COPY]}")
-            self.copy_files()
-        if self.PROJ in self.args:
-            if self.SECT in self.args or self.GLOB in self.args or self.SPLIT in self.args:
-                self.run_project_workflow()
-        if self.VERSION in self.args:
-            self.print_version()
-        # elif TestFile.TEST in self.args:
-        #     self.logger.warning(f"TEST in **args {self.args}")
-        #     TestFile.run_arg_tests(self.args)
-        # TODO linkup with test arguments
 
     def print_version(self):
         print(f"version {self.version()}")
 
     #
     def replace_single_values_in_self_args_with_list(self, key):
         """always returns list even for single arg
         e.g. turns "foo" into ["foo"]
         This is to avoid strings being interpreted as lists of characters
         I am sure there is a more pythonic way
         """
         # argsx = None
         if self.args is None:
-            self.logger.warning(f"NULL self.args")
+            logger.warning(f"NULL self.args")
         elif key in self.args:
             argsx = self.args[key]
             if argsx is not None:
                 if type(argsx) != list:
                     self.args[key] = [argsx]
 
     #
@@ -309,29 +290,29 @@
         :param parser:
         :return: list of transformed arguments as 2-tuples
         """
         new_items = {}
         if arglist and len(arglist) > 0:
             parsed_args = self.parse_args_and_trap_errors(arglist, parser)
             if parsed_args is None:
-                print(f"PARSED ARGS FAILS {arglist}")
+                logger.error(f"PARSED ARGS FAILS {arglist}")
                 return new_items
             if parsed_args == self.SYSTEM_EXIT_OK:  # return code 0
                 return new_items
             if str(parsed_args).startswith(self.SYSTEM_EXIT_FAIL):
                 raise ValueError(f"bad command arguments {parsed_args} (see log output)")
 
-            self.logger.debug(f"PARSED_ARGS {parsed_args}")
+            logger.debug(f"PARSED_ARGS {parsed_args}")
             if debug:
-                print(f"parsed args {parsed_args}")
+                logger.warning(f"parsed args {parsed_args}")
 
             try:
                 arg_vars = vars(parsed_args)  # FAILS in Pycharm
             except Exception as e:
-                print(
+                logger.error(
                     f"argparse and vars() fails, see \n BUG in Pycharm/Pandas see https://stackoverflow.com/questions/75453995/pandas-plot-vars-argument-must-have-dict-attribute\n try fudge")
                 # Namespace(command=None, version=True)
                 match = re.match("Namespace\\((?P<argvals>[^)]*)\\)", parsed_args)
                 if match:
                     arglistx = match.groupdict("argvals")
                     arg_vars = arglistx.split(",\\s*")
 
@@ -349,34 +330,34 @@
         except SystemExit as se:  # exit codes
             if str(se) == '0':
                 parsed_args = self.SYSTEM_EXIT_OK
             else:
                 parsed_args = self.SYSTEM_EXIT_FAIL + str(se)
         except Exception as e:
             parsed_args = None
-            self.logger.error(f"Cannot parse {arglist} , {e}")
+            logger.error(f"Cannot parse {arglist} , {e}")
         return parsed_args
 
     def set_loglevel_from_args(self):
         """ """
         levels = {
             "debug": logging.DEBUG,
             "info": logging.INFO,
             "warning": logging.WARNING,
             "error": logging.ERROR,
         }
 
         if self.LOGLEVEL in self.args:
             loglevel = self.args[self.LOGLEVEL]
-            self.logger.info(f"loglevel {loglevel}")
+            logger.info(f"loglevel {loglevel}")
             if loglevel is not None:
                 loglevel = str(loglevel)
             if loglevel is not None and loglevel.lower() in levels:
                 level = levels[loglevel.lower()]
-                self.logger.loglevel = level
+                logger.loglevel = level
 
     def version(self):
         """
         reads setup.py and extracts line of form version='0.0.29'
         This is still a mess. We need to set the version once somewhere.
         """
 
@@ -388,14 +369,15 @@
         # had to revert here I think
         version = '0.0.6'  # 2024-04-19
         version = '0.0.7'  # 2024-04-23
         version = '0.0.8'  # 2024-04-23
         version = '0.0.9'  # 2024-05-09
         version = '0.0.10'  # 2024-05-09
         version = '0.1.0'  # 2024-05-10 # fixed absolute imports and mended tests
+        version = '0.1.1'  # 2024-05-11 # fixed subclassig of AmiLibArgs
 
         # logging.warn(f"VERSION {version}")
         return version
 
 
 class AmiLibArgs(AbstractArgs):
     """Parse args to analyze, edit and annotate HTML"""
@@ -407,41 +389,45 @@
         self.inpath = None
         self.outpath = None
         self.outstem = None
         self.outdir = None
         self.arg_dict = None
         self.subparser_arg = "HTML"
 
+    @abstractmethod
     def add_arguments(self):
+        logger.warn("add arguments")
+
         if self.parser is None:
             self.parser = argparse.ArgumentParser()
         """adds arguments to a parser or subparser"""
-        self.parser.description = 'HTML editing analysing annotation'
+        self.parser.description = 'Abstract editing analysing annotation'
         self.parser.add_argument(f"--foo", action="store_true",
                                  help="annotate HTML file with dictionary")
         # self.parser.add_argument(f"--{COLOR}", type=str, nargs=1,
         #                          help="colour for annotation")
         # self.parser.add_argument(f"--{DICT}", type=str, nargs=1,
         #                          help="dictionary for annotation")
         # self.parser.add_argument(f"--{INPATH}", type=str, nargs=1,
         #                          help="input html file")
         # self.parser.add_argument(f"--{OUTPATH}", type=str, nargs=1,
         #                          help="output html file")
         # self.parser.add_argument(f"--{OUTDIR}", type=str, nargs=1,
         #                          help="output directory")
-        self.parser.epilog = "==============="
+        self.parser.epilog = "=======abstract add arguments ========"
 
     """python -m pyamihtmlx.pyamix HTML --annotate 
      --dict /Users/pm286/projects/semanticClimate/ipcc/ar6/wg3/Chapter02/dict/emissions_abbreviations.xml
      --inpath /Users/pm286/projects/semanticClimate/ipcc/ar6/wg3/Chapter02/fulltext.html
      --outpsth /Users/pm286/projects/semanticClimate/ipcc/ar6/wg3/Chapter02/annotated/fulltext_emissions.html
      --color pink
      """
 
     # class AmiDictArgs:
+    @abstractmethod
     def process_args(self):
         """runs parsed args
         :return:
         """
 
         if not self.arg_dict:
             logging.warning(f"no arg_dict given, no action")
@@ -469,15 +455,15 @@
     @property
     def module_stem(self):
         """name of module"""
         return Path(__file__).stem
 
     def annotate_with_dict(self):
         """uses dictionary to annotate words and phrases in HTML file"""
-        self.logger.warning("Dictionaries not supported")
+        logger.warning("Dictionaries not supported")
         return
 
         if not self.dictfile:
             logging.error(f"no dictionary given")
             return
         if not self.inpath:
             logging.error(f"no input file to annotate given")
@@ -501,40 +487,31 @@
 
     def __init__(self, converter_class, intype, outtype, indir=".", outdir="."):
         self.intype = intype
         self.indir = indir
         self.outtype = outtype
         self.outdir = outdir
 
-    # PDF2SVG = (Pdf2SvgConverter, "pdf", "svg", ".", "svg")
-    # PDF2TXT = (PdfReader, Filetype.F_PDF, Filetype.F_TXT, ".", ".")
-    # XML2HTML = (Xml2HtmlConverter, "pdf", "html", ".", ".")
-    # XML2TXT = (Xml2TxtConverter, "xml", "txt", ".", ".")
-    # SVG2PAGE = (Svg2PageConverter, "svg", "html", "svg", "page")
-    # PAGE2SECT = (Page2SectConverter, "html", "html", "page", "sect")
-    # TXT2SENT = (Txt2SentSplitter, Filetype.F_TXT, Filetype.F_TXT, ".", "sent")
-
 
 def main():
     # make_cmd()
     """ main entry point for cmdline
 
     """
-    print(f"amilib")
     run_tests = False  # needs re-implementing
 
     run_commands = True
     #    run_commands = False
 
     #    run_tests = True
 
-    AmiLib.logger.debug(
+    logger.debug(
         f"\n============== running amilib main ===============\n{sys.argv[1:]}")
     amix = AmiLib()
-    print(f"***** VERSION {amix.version()} *****")
+    logger.info(f"***** amilib VERSION {amix.version()} *****")
     # this needs commandline
     if run_commands:
         amix.run_command(sys.argv[1:])
 
 
 if __name__ == "__main__":
     main()
```

### Comparing `amilib-0.1.0/amilib/bbox.py` & `amilib-0.1.1/amilib/bbox.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/amilib/file_lib.py` & `amilib-0.1.1/amilib/file_lib.py`

 * *Files 4% similar despite different names*

```diff
@@ -438,14 +438,33 @@
     def get_home(cls):
         """
         gets home directory os.path.expanduser("~")
         """
         home = os.path.expanduser("~")
         return home
 
+    @classmethod
+    def get_logger(cls, filename, file_level=2, suffix=".py", level=logging.INFO):
+        """creates module syntax for logger
+        removes .py
+        retains level of hierarchy
+        e.g. foo/bar/junk.py with levels = 2 => bar.junk
+        :param filename: to act as logger name
+        :param file_level: to include in hierarchy
+        :param level: logging level (default INFO)
+        :param suffix: suffix to remove, e.g. ".py"
+        """
+        if filename:
+            if filename[-len(suffix):] == suffix:
+                filename = filename[:-len(suffix)]
+            module = '.'.join(filename.split(os.path.sep)[-file_level:])
+            logger = logging.getLogger(module)
+            return logger
+
+
 
 
 # see https://realpython.com/python-pathlib/
 
 def main():
     print("started file_lib")
     # test_templates()
```

### Comparing `amilib-0.1.0/amilib/headless_lib.py` & `amilib-0.1.1/amilib/headless_lib.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/amilib/html_args.py` & `amilib-0.1.1/amilib/html_args.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,101 +1,107 @@
 import argparse
 import logging
-from pathlib import Path
 
-from amilib.util import AbstractArgs, AmiLogger
+from amilib.ami_args import AbstractArgs, AmiArgParser
+from amilib.file_lib import FileLib
 
 # commandline
 ANNOTATE = "annotate"
 COLOR = "color"
 DICT = "dict"
 INPATH = "inpath"
 OUTDIR = "outdir"
 OUTPATH = "outpath"
 
-logger = AmiLogger.create_named_logger(__file__)
-
+# logger = AmiLogger.create_named_logger(__file__)
+logger = FileLib.get_logger(__file__)
+logger.setLevel(logging.DEBUG)
 
 class HTMLArgs(AbstractArgs):
     """Parse args to analyze, edit and annotate HTML"""
 
     def __init__(self):
         """arg_dict is set to default"""
+        logger.warning("creating HTML Args")
         super().__init__()
         self.dictfile = None
         self.inpath = None
         self.outpath = None
         self.outstem = None
         self.outdir = None
         self.arg_dict = None
         self.subparser_arg = "HTML"
         self.color = None
         self.annotate = None
         self.ami_dict = None
 
     def add_arguments(self):
+        logger.debug(f"================== add arguments HTML ================")
+
         if self.parser is None:
-            self.parser = argparse.ArgumentParser()
+            self.parser = AmiArgParser(
+                usage="HTML amilib always uses subcommands (HTML,PDF)\n e.g. amilib PDF --help"
+            )
+
+
         """adds arguments to a parser or subparser"""
-        self.parser.description = 'HTML editing analysing annotation'
+
+        self.parser.description = 'HTML editing, analysing annotation'
+        self.parser.formatter_class = argparse.RawDescriptionHelpFormatter
+
         self.parser.add_argument(f"--{ANNOTATE}", action="store_true",
                                  help="annotate HTML file with dictionary")
         self.parser.add_argument(f"--{COLOR}", type=str, nargs=1,
                                  help="colour for annotation")
         self.parser.add_argument(f"--{DICT}", type=str, nargs=1,
                                  help="dictionary for annotation")
         self.parser.add_argument(f"--{INPATH}", type=str, nargs=1,
                                  help="input html file")
         self.parser.add_argument(f"--{OUTPATH}", type=str, nargs=1,
                                  help="output html file")
         self.parser.add_argument(f"--{OUTDIR}", type=str, nargs=1,
                                  help="output directory")
-        self.parser.epilog = "==============="
+        self.parser.epilog = "====== epilog ========="
+        return self.parser
 
     """python -m pyamihtmlx.pyamix HTML --annotate 
      --dict /Users/pm286/projects/semanticClimate/ar6/ar6/wg3/Chapter02/dict/emissions_abbreviations.xml
      --inpath /Users/pm286/projects/semanticClimate/ar6/ar6/wg3/Chapter02/fulltext.html
      --outpsth /Users/pm286/projects/semanticClimate/ar6/ar6/wg3/Chapter02/annotated/fulltext_emissions.html
      --color pink
      """
 
-    # class AmiDictArgs:
     def process_args(self):
         """runs parsed args
         :return:
         """
+        logger.debug(f"process_args")
 
         if not self.arg_dict:
-            logging.warning(f"no arg_dict given, no action")
+            logger.warning(f"no arg_dict given, no action")
             return
 
         self.annotate = self.arg_dict.get(ANNOTATE)
         self.color = self.arg_dict.get(COLOR)
         self.dictfile = self.arg_dict.get(DICT)
         self.inpath = self.arg_dict.get(INPATH)
         self.outdir = self.arg_dict.get(OUTDIR)
         self.outpath = self.arg_dict.get(OUTPATH)
 
         if self.annotate:
             self.annotate_with_dict()
 
-    # class AmiDictArgs:
 
     @classmethod
     def create_default_arg_dict(cls):
         """returns a new COPY of the default dictionary"""
         arg_dict = dict()
         arg_dict[DICT] = None
         return arg_dict
 
-    @property
-    def module_stem(self):
-        """name of module"""
-        return Path(__file__).stem
-
     def annotate_with_dict(self):
         """uses dictionary to annotate words and phrases in HTML file"""
         logger.warning("Dictionaries not supported")
 
         # if not self.dictfile:
         #     logging.error(f"no dictionary given")
         #     return
```

### Comparing `amilib-0.1.0/amilib/html_extra.py` & `amilib-0.1.1/amilib/html_extra.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/amilib/html_generator.py` & `amilib-0.1.1/amilib/html_generator.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/amilib/html_marker.py` & `amilib-0.1.1/amilib/html_marker.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/amilib/pdf_args.py` & `amilib-0.1.1/amilib/pdf_args.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,21 +1,24 @@
 # TODO cyclic imports with html
 import argparse
 import logging
+import os
 import re
 import sys
 import textwrap
 import traceback
 from pathlib import Path
 
 import lxml.etree as ET
 
+from amilib.ami_args import AmiArgParser, AbstractArgs
 from amilib.ami_html import A_HREF, H_A, H_SPAN, HtmlTidy, HtmlStyle, CSSStyle
 from amilib.ami_pdf_libs import AmiPage, PDFParser, DEBUG_OPTIONS
-from amilib.util import AbstractArgs, AmiArgParser, Util, AmiLogger
+from amilib.util import Util, AmiLogger
+from amilib.file_lib import FileLib
 
 INDIR = "indir"
 INFILE = "infile"
 INFORM = "inform"
 INPATH = "inpath"
 INSTEM = "instem"
 OFFSET = "offset"
@@ -34,15 +37,15 @@
 FLOW = "flow"
 FOOTER = "footer"
 HEADER = "header"
 
 DEFAULT_CONVERT = "html"
 DEFAULT_MAXPAGES = 100
 
-logger = AmiLogger.create_named_logger(__file__)
+logger = FileLib.get_logger(__file__)
 
 
 class PDFArgs(AbstractArgs):
     """
     Holds argument values for pyami PDF commands and runs conversions
     Also holds much of the document data
 
@@ -71,14 +74,16 @@
         self.flow = None
         self.unwanteds = None
 
     """
 
     def __init__(self):
         """arg_dict is set to default"""
+        logger.warning("creating PDFArgs")
+
         super().__init__()
         self.convert = DEFAULT_CONVERT
         self.html = None
 
         self.footer = None
         self.header = None
 
@@ -103,32 +108,29 @@
 
         self.subparser_arg = "PDF"
 
     def add_arguments(self):
         """creates adds the arguments for pyami commandline
 
         """
+        logger.debug(f"================== add arguments PDF ================")
         if self.parser is None:
-            # self.parser = argparse.ArgumentParser(
-            #     usage="pyami always uses subcommands (DICT,GUI,HTML,PDF,PROJECT)\n e.g. pyamihtmlx PDF --help"
-            # )
             self.parser = AmiArgParser(
-                usage="pyamihtmlx always uses subcommands (DICT,GUI,HTML,PDF,IPCC,PROJECT)\n e.g. pyamihtmlx PDF --help"
+                usage="PDF: amilib always uses subcommands (HTML,PDF)\n e.g. amilib PDF --help"
             )
 
         self.parser.description = textwrap.dedent(
             'PDF tools. \n'
             '----------\n'
             'Typically reads one or more PDF files and converts to HTML\n'
             'can clip parts of page, select page ranges, etc.\n'
             '\nExamples:\n'
             '  * PDF --help\n'
         )
         self.parser.formatter_class = argparse.RawDescriptionHelpFormatter
-        # self.parser.add_argument("--convert", type=str, choices=[], help="conversions (NYI)")
         self.parser.add_argument("--debug", type=str, choices=DEBUG_OPTIONS, help="debug these during parsing (NYI)")
         self.parser.add_argument("--flow", type=bool, nargs=1,
                                  help="create flowing HTML, e.g. join lines, pages (heuristics)", default=True)
         self.parser.add_argument("--footer", type=float, nargs=1, help="bottom margin (clip everythimg above)",
                                  default=80)
         self.parser.add_argument("--header", type=float, nargs=1, help="top margin (clip everything below", default=80)
         self.parser.add_argument("--imagedir", type=str, nargs=1, help="output images to imagedir")
@@ -158,14 +160,15 @@
                                  default='pdfminer')
         self.parser.add_argument("--pages", type=str, nargs="+",
                                  help="reads '_2 4_6 8 11_' as 1-2, 4-6, 8, 11-end ; all ranges inclusive (not yet debugged)",
                                  default=ALL_PAGES)
         self.parser.add_argument("--resolution", type=int, nargs=1, help="resolution of output images (if imagedir)",
                                  default=400)
         self.parser.add_argument("--template", type=str, nargs=1, help="file to parse specific type of document (NYI)")
+        self.parser.epilog = "============ PDF epilog ==========="
         return self.parser
 
     # class PDFArgs:
     def process_args(self):
         """runs parsed args
         :return:
   --maxpage MAXPAGE     maximum number of pages
@@ -176,20 +179,20 @@
   --outform OUTFORM     output format
   --flow FLOW           create flowing HTML (heuristics)
   --images IMAGES       output images
   --resolution RESOLUTION
                         resolution of output images
   --template TEMPLATE   file to parse specific type of document"""
 
+        logger.debug(f"running PDFArgs.process_args()")
         if self.arg_dict:
             #            logging.warning(f"ARG DICTXX {self.arg_dict}")
             self.read_from_arg_dict()
 
         if not self.check_input():
-            # self.parser.print_help() # self.parser is null
             print("for help, run 'pyamihtmlx PDF -h'")
             return
         self.create_consistent_output_filenames_and_dirs()
         self.calculate_headers_footers()
 
         newstyle = True
         if newstyle:
@@ -352,17 +355,17 @@
     ):
         """
         Convenience method to run PDFParser.convert_pdf on self.inpath, self.outform, and self.maxpage
         writes output to self.outpath
         if self.flow runs self.tidy_flow
         :return: outpath
         """
-        print(f"flow {flow} indir {indir} inpath {inpath} maxpage {maxpage} outform {outform} \n"
+        logger.debug(f"flow {flow} indir {indir} inpath {inpath} maxpage {maxpage} outform {outform} \n"
               f"outpath {outpath} outstem {outstem} outdir {outdir} pdf2html {pdf2html} process_args {process_args}")
-        print(f"==============CONVERT================")
+        logger.debug(f"==============CONVERT================")
         # process arguments into a dictionary
         if flow:
             self.arg_dict[FLOW] = flow
         if indir:
             self.arg_dict[INDIR] = indir
         if inpath:
             self.arg_dict[INPATH] = inpath
@@ -536,18 +539,18 @@
             elem2 = ET.SubElement(par, H_SPAN)
             for k, v in elem0.attrib.items():
                 elem2.attrib[k] = v
             elem2.text = result.group(3)
 
             par.remove(span)
 
-    @property
-    def module_stem(self):
-        """name of module"""
-        return Path(__file__).stem
+    # @property
+    # def module_stem(self):
+    #     """name of module"""
+    #     return Path(__file__).stem
 
     @classmethod
     def make_page_ranges(cls, raw_page_ranges, offset=0):
         """expand pages arg to list of ranges
         typical input _2 4_5 8 9_11 13 16_
         These are *inclusive* so expand to
         range(1,3) range(4,6) range(8,9) range (9,12) range(13,14) range(16-maxint)
@@ -697,15 +700,15 @@
     typical:
     python -m amilib.ami_pdf \
         --inpath /Users/pm286/workspace/pyami/test/resources/ar6/Chapter06/fulltext.pdf \
         --outdir /Users/pm286/workspace/pyami/temp/pdf/chap6/
         --maxpage 100
 
     """
-    print(f"running PDFArgs main")
+    logger.debug(f"running PDFArgs main")
     pdf_args = PDFArgs()
     parse_and_process_1(pdf_args)
 
 
 if __name__ == "__main__":
     main()
 else:
```

### Comparing `amilib-0.1.0/amilib/util.py` & `amilib-0.1.1/amilib/util.py`

 * *Files 18% similar despite different names*

```diff
@@ -4,28 +4,28 @@
 import importlib
 import logging
 import os
 import sys
 import csv
 import re
 from enum import Enum
-from abc import ABC, abstractmethod
-from collections import Counter
 
 import lxml
 import pandas as pd
 import pyvis
 from lxml import html
 from pathlib import Path
 import time
 import requests
 import json
 import base64
 
-logger = logging.getLogger(__file__)
+from amilib.file_lib import FileLib
+
+logger = FileLib.get_logger(__file__)
 
 HREF = "href"
 
 
 class Util:
     """Utilities, mainly staticmethod or classmethod and not tightly linked to AMI"""
 
@@ -489,14 +489,19 @@
         :param classname: string of form foo.bar.MyClass
         "return: uninstantiated class
         """
         classname_bits = classname.rsplit(".", 1)
         clazz = getattr(importlib.import_module(classname_bits[0]), classname_bits[1])
         return clazz
 
+    @classmethod
+    def get_classname(cls, object):
+        return object.__class__.__name__
+        pass
+
 
 class GithubDownloader:
     """Note: Github uses the old 'master' name but we have changed it to 'main'"""
 
     def __init__(self, owner=None, repo=None, sleep=3, max_level=1):
         """if sleep is too small, Github semds 403"""
         self.owner = owner
@@ -586,294 +591,14 @@
         :param punct: string containing unwanted chars
         :param charx: their single character replacement.
         """
         punct_mask = str.maketrans(punct, charx * len(punct))
         return punct_mask
 
 
-class AmiArgParseException(Exception):
-    """
-    to capture error messages from AmiArgparser
-    """
-    pass
-
-
-class AmiArgParser(argparse.ArgumentParser):
-    """
-    subclasses ArgumentParser and overrides error()
-    """
-
-    def error(self, message):
-        """
-        raises self.exit(2, error_message) so can be caught
-        """
-        raise AmiArgParseException(message)
-
-
-class AbstractArgs(ABC):
-
-    PIPELINE = "Pipeline"
-    DEBUG = "debug"
-    INDIR = "indir"
-    INPUT = "input"
-    INFORMAT = "informat"
-    KWARGS = "kwords"
-    OPERATION = "operation"
-    OUTPUT = "output"
-    OUTDIR = "outdir"
-
-    DEBUG_HELP = f"will output debugging information (not fully implemented) \n"
-
-    INPUT_HELP = f"input from:\n" \
-                 f"   file/s single, multiple, and glob/wildcard (experimental)\n" \
-                 f"   directories NYI\n" \
-                 f"   URL/s (must start with 'https:'); provide {OUTDIR} for output \n"
-
-    INDIR_HELP = f"Directory containing input files\n"
-
-    OUTPUT_HELP = "output file or similar resource"
-
-    OUTDIR_HELP = "output directory, required for URL input. If not given, autogenerated from file names"
-
-    def get_input_help(self):
-        return self.INPUT_HELP
-
-    def get_indir_help(self):
-        return self.INDIR_HELP
-
-    def get_output_help(self):
-        return self.OUTPUT_HELP
-
-    def get_outdir_help(self):
-        return self.OUTDIR_HELP
-
-    def __init__(self):
-        self.parser = None
-        self.parsed_args = None
-        self.ref_counter = Counter()
-        self.arg_dict = self.create_default_arg_dict()
-        self.subparser_arg = "UNKNOWN"
-
-    def create_arg_dict(self, args=None):
-        if args:
-            self.parsed_args = args
-        # print(f"PARSED_ARGS {type(self.parsed_args)} {self.parsed_args}")
-        if not self.parsed_args:
-            return None
-        try:
-            arg_vars = vars(self.parsed_args)
-        except TypeError:
-            # print(f" type args {type(self.parsed_args)} {self.parsed_args}")
-            arg_vars = self.parsed_args
-        self.arg_dict = dict()
-        for item in arg_vars.items():
-            key = item[0]
-            if item[1] is None:
-                pass
-            elif type(item[1]) is list and len(item[1]) == 1:
-                self.arg_dict[key] = item[1][0]
-            else:
-                self.arg_dict[key] = item[1]
-
-        return self.arg_dict
-
-    def parse_and_process(self):
-        """Parse args after program name.
-        If running in IDE there may be 2 names.
-        All names should contain name of module (e.g. ami_dict)
-
-        '/Applications/PyCharm CE.app/Contents/plugins/python-ce/helpers/pycharm/_jb_pytest_runner.py', 'ami_dict.py::test_process_args']
-        or
-        '/Users/pm286/workspace/pyami/pyamihtmlx/ami_dict.py', '--dict', 'foo', '--words', 'bar'
-
-        """
-        # strip all tokens including ".py" (will proably fail on some m/c)
-        print(f"module_stem: {self.module_stem}\n sys.argv {sys.argv}")
-        args_store = sys.argv.copy()
-        while len(sys.argv) > 0 and self.module_stem not in str(sys.argv[0]):
-            print(f"trimming sys.argv {sys.argv}")
-            sys.argv = sys.argv[1:]
-        if len(sys.argv) == 0:  # must have name of prog
-            sys.argv = args_store.copy()
-        try:
-            self.add_arguments()
-        except Exception as e:
-            print(f"failed to add args {e}")
-            raise e
-        logger.warning(f"AbstractArgs ADDED ARGS {sys.argv}")
-        # print(f"argv {sys.argv}")
-        if len(sys.argv) == 1:  # no args, print help
-            self.parser.print_help()
-        else:
-            logging.warning(f"sys.argv {sys.argv}")
-            argv_ = sys.argv[1:]
-            print(f"argv: {argv_}")
-            self.parse_and_process1(argv_)
-
-    def parse_and_process1(self, argv_):
-        logging.debug(f"********** args for parse_and_process1 {argv_}")
-        self.parsed_args = argv_ if self.parser is None else self.parser.parse_args(argv_)
-        #        logging.warning(f"ARG DICTYY {self.arg_dict}")
-        self.arg_dict = self.create_arg_dict()
-        self.process_args()
-
-    @property
-    # @abstractmethod  # I don't know why this doesn't work
-    def subparser_name(self):
-        pass
-
-    def add_argumants(self):
-
-        self.parser.add_argument(f"--{self.DEBUG}",
-                                 action='store_true',
-                                 help=self.DEBUG_HELP)
-
-        self.parser.add_argument(f"--{self.INPUT}", nargs="+",
-                                 help=self.INPUT_HELP)
-
-        self.parser.add_argument(f"--{self.INDIR}", nargs="+",
-                                 help=self.INDIR_HELP)
-
-        self.parser.add_argument(f"--{self.OUTPUT}", nargs="+",
-                                 help=self.OUTPUT_HELP)
-
-        self.parser.add_argument(f"--{self.OUTDIR}", nargs="+",
-                                 help=self.OUTDIR_HELP)
-
-        INFORM_HELP = "input format/s; experimental"
-        self.parser.add_argument(f"--{self.KWARGS}", nargs="*",
-                help="space-separated list of colon_separated keyword-value pairs, "
-                     "format kw1:val1 kw2:val2;\nif empty list gives help")
-
-
-    @abstractmethod
-    def process_args(self):
-        pass
-
-    @abstractmethod
-    def create_default_arg_dict(self):
-        pass
-
-    @property
-    def module_stem(self):
-        """name of module"""
-        return Path(__file__).stem
-
-    def get_operation(self):
-        """The operation to run (makes this explicit)"""
-        operation = self.arg_dict.get(AbstractArgs.OPERATION)
-        return operation
-
-    def get_indir(self):
-        indir = self.arg_dict.get(AbstractArgs.INDIR)
-        return indir
-
-    def get_input(self):
-        input = self.arg_dict.get(AbstractArgs.INPUT)
-        return input
-
-    def get_outdir(self):
-        outdir = self.arg_dict.get(AbstractArgs.OUTDIR)
-        return outdir
-
-    def get_output(self):
-        output = self.arg_dict.get(AbstractArgs.OUTPUT)
-        return output
-
-    def parse_kwargs_to_string(self, kwargs, keys=None):
-        kwargs_dict = {}
-        logger.info(f"args: {kwargs}")
-        if not kwargs:
-            if keys:
-                print(f"possible keys: {keys}")
-        else:
-            if type(kwargs) is not list:
-                kwargs = [kwargs]
-            for arg in kwargs:
-                logger.debug(f"pair {arg}")
-                argz = arg.split(':')
-                key = argz[0].strip()
-                value = argz[1].strip()
-                kwargs_dict[key] = value
-            logger.warning(f"kwargs_dict {kwargs_dict}")
-        return kwargs_dict
-
-
-    def get_kwargs(self):
-        kwargs = self.arg_dict.get(AbstractArgs.KWARGS)
-        print(f"kwargs {kwargs}")
-        if kwargs is None:
-            return None
-        if len(kwargs) == 0:
-            self.kwargs_help()
-        else:
-            pass
-
-        return
-
-    def kwargs_help(self):
-        print(f"key value pairs separated by ':' ; normally explicitly offered by subclass ")
-
-
-    def make_run_func(self):
-        """probably obsolete"""
-        func_name = self.module_stem.replace("ami_", "run_")
-        print(f"run_func_name {func_name}")
-        return func_name
-
-    def make_sub_parser(self, subparsers):
-        """make subparser from subparsers
-        requires self.subparser_arg (probably should be argument
-        ALSO adds arguments through `self.add_arguments`
-        :param subparsers: subparser generator
-        :return: new subparser"""
-        self.parser = subparsers.add_parser(self.subparser_arg)
-        self.add_arguments()
-        return self.parser
-
-
-class ArgParseBuilder:
-    ARG_LIST = "arg_list"
-    DESCRIPTION = "description"
-
-    def __init__(self):
-        self.parser = None
-
-    def create_arg_parse(self, arg_dict=None, arg_dict_file=None):
-        # arg_dict_file takes precedence
-        if arg_dict_file and arg_dict_file.exists():
-            with open(arg_dict_file, 'r') as f:
-                data = f.read()
-                arg_dict = json.loads(data)
-                print(f"arg_dict {arg_dict}")
-
-        if arg_dict is not None:
-            desc = f'{arg_dict.get(self.DESCRIPTION)}'
-            print(f"\ndesc: '{desc}'")
-            self.parser = argparse.ArgumentParser(description=desc)
-            arg_list = arg_dict.get(self.ARG_LIST)
-            if arg_list is None:
-                raise ValueError(f"must give arg_list to ArgParseBuilder")
-            for arg_dict in arg_list:
-                if not type(arg_dict) is dict:
-                    raise ValueError(f"arg_list_dict {arg_dict} is not a dict")
-                args = arg_dict.keys()
-                for arg in args:
-                    print(f"\n{arg}:")
-                    param_dict = arg_dict.get(arg)
-                    self.process_params(param_dict)
-                # self.parser.add_argument(f"--{ProjectArgs.PROJECT}", type=str, nargs=1, help="project directory")
-
-    """https://stackoverflow.com/questions/28348117/using-argparse-and-json-together"""
-
-    def process_params(self, param_dict):
-        for param, param_val in param_dict.items():
-            print(f"  {param}='{param_val}'")
-
-
 """PUNCT: !\\"#$%&'()*+,/:;<=>?@[\\]^`{|}~"""
 
 
 class AmiLogger:
     """wrapper for logger to limit or condense voluminous output
 
     adds a dictionary of counts for each log level
@@ -1024,16 +749,14 @@
                     id += sep
                 id += match.group(name)
 
         return id
 
     # class EnhancedRegex:
 
-
-
     # Abandoned!
     def make_regex_with_capture_groups(self, components):
         """make regex with capture groups
         takes components list of alternating strings and tuples (of form name, regex)
         :param components: list [str] (tuple) str (tuple) str (tuple) ... [str]
         from
         components = ["", ("decision", "\\d+"), "/", ("type", "CP|CMA|CMP"), "\\.", ("session", "\\d+"), ""]
@@ -1074,14 +797,15 @@
 
         if href == GENERATE:
             idref = self.make_id_with_regex(self.regex, text)
             return idref
         else:
             return href
 
+
 class TextUtil:
 
     @classmethod
     def replace_chars(cls, text, unwanted_chars, replacement) -> str:
         """replaces all chars in unwanted chars with wanted_char
 
         :param text: source text
```

### Comparing `amilib-0.1.0/amilib/wikimedia.py` & `amilib-0.1.1/amilib/wikimedia.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/amilib/xml_lib.py` & `amilib-0.1.1/amilib/xml_lib.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/setup.py` & `amilib-0.1.1/setup.py`

 * *Files 5% similar despite different names*

```diff
@@ -21,23 +21,24 @@
  'pdfplumber',
  'requests',
  'numpy',
  'pandas',
  'pyvis',
  'selenium',
  'tinycss',
+ 'Tkinterweb',
  'webdriver-manager',
  'scikit-learn',
 
 ]
 
 setup(
     name='amilib',
     url='https://github.com/petermr/amilib',
-    version='0.1.0',
+    version='0.1.1',
     description='document download, cleaning, management',
     long_description_content_type='text/markdown',
     long_description=readme,
     author="Peter Murray-Rust",
     author_email='petermurrayrust@googlemail.com',
     license='Apache2',
     install_requires=requirements,
```

### Comparing `amilib-0.1.0/test/test_all.py` & `amilib-0.1.1/test/test_all.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/test/test_file.py` & `amilib-0.1.1/test/test_file.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/test/test_headless.py` & `amilib-0.1.1/test/test_headless.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/test/test_html.py` & `amilib-0.1.1/test/test_html.py`

 * *Files 0% similar despite different names*

```diff
@@ -109,14 +109,22 @@
         assert type(html_span) is lxml.etree._Element
         assert html_span.text == "and more blah (Deep  Decarbonization  Pathways  Project  2015; Roelfsema et al. 2020)  and even more blah"
 
         html_span = lxml.etree.fromstring(HTML_SUBSECTION_REF)
         assert type(html_span) is lxml.etree._Element
         assert html_span.text == "to national level (4.2.2.3) and subnational"
 
+    def test_html_help(self):
+        ''' runs HTML parser with --help to see if it produces terminal output
+        '''
+        pyami = AmiLib()
+        pyami.run_command("HTML")
+        pyami.run_command("HTML --help")
+
+
     @unittest.skip("dictionaries not included")
     def test_parse_commandline(self):
         """
         Simulate running from commandline
         """
         infile = Path(Resources.TEST_IPCC_CHAP06, "fulltext.html")
         assert infile.exists()
```

### Comparing `amilib-0.1.0/test/test_nlp.py` & `amilib-0.1.1/test/test_nlp.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/test/test_pdf.py` & `amilib-0.1.1/test/test_pdf.py`

 * *Files 2% similar despite different names*

```diff
@@ -24,15 +24,14 @@
 
 """NOTE REQUIRES LATEST pdfplumber"""
 import pdfplumber
 from PIL import Image
 from lxml.html import HTMLParser
 
 # local
-# from pyamihtmlx.ami_bib import Publication
 
 from amilib.ami_pdf_libs import SVG_NS, SVGX_NS, PDFDebug, PDFParser
 from amilib.ami_pdf_libs import AmiPage, X, Y, SORT_XY, PDFImage, AmiPDFPlumber, AmiPlumberJsonPage, AmiPlumberJson
 from amilib.ami_pdf_libs import WORDS, IMAGES, ANNOTS, CURVES, TEXTS
 from amilib.ami_html import HtmlUtil, STYLE, FILL, STROKE, FONT_FAMILY, FONT_SIZE, HtmlLib
 from amilib.ami_html import H_SPAN, H_BODY, H_P
 from amilib.amix import AmiLib
@@ -146,15 +145,16 @@
         page_json_dir = output_page_dir
         output_page_dir.mkdir(exist_ok=True, parents=True)
         ami_pdfplumber = AmiPDFPlumber()
         HtmlGenerator.create_html_pages(
             ami_pdfplumber, input_pdf=input_pdf, outdir=output_page_dir, page_json_dir=page_json_dir,
             pages=[1, 2, 3, 4, 5, 6, 7])
 
-    @unittest.skipUnless(AmiAnyTest.run_long(), "run occasionally")
+    # @unittest.skipUnless(AmiAnyTest.run_long(), "run occasionally")
+    @unittest.skip("documents not in distribution")
     def test_pdfplumber_doublecol_create_pages_for_WGs_HACKATHON(self):
         """
         creates AmiPDFPlumber and reads double-column pdf and debugs
         This is also an integration/project test
         """
 
         report_names = [
@@ -1043,17 +1043,18 @@
              'flush_cache', 'rects', 'lines', 'curves', 'images', 'chars', 'textboxverticals', 'textboxhorizontals', 
              'textlineverticals', 'textlinehorizontals', 'rect_edges', 'edges', 'horizontal_edges', 'vertical_edges', 'to_json',
               'to_csv', ]
             """
             assert first_page.page_number == 1
             assert first_page.rotation == 0
             assert first_page.initial_doctop == 0
-            assert first_page.cropbox == (0, 0, 595.22, 842)
-            assert first_page.mediabox == (0, 0, 595.22, 842)
-            assert first_page.bbox == (0, 0, 595.22, 842)
+            # cropbox and medibox seem to vary beteween lists and tuples on different versionns of Python
+            # assert first_page.cropbox == (0, 0, 595.22, 842)
+            # assert first_page.mediabox == (0, 0, 595.22, 842)
+            # assert first_page.bbox == (0, 0, 595.22, 842)
             assert first_page.cached_properties == ['_rect_edges', '_curve_edges', '_edges', '_objects', '_layout']
             assert first_page.is_original
             assert first_page.pages is None
             assert first_page.width == 595.22
             assert first_page.height == 842
             # assert first_page.layout: < LTPage(1)
             # 0.000, 0.000, 595.220, 842.000
@@ -1800,16 +1801,19 @@
         sys.argv.append("--help")
         try:
             main()
         except SystemExit:
             pass
 
     def test_pdf_help(self):
+        ''' runs PDF parser with --help to see if it produces terminal output
+        '''
         pyami = AmiLib()
         pyami.run_command("PDF")
+        pyami.run_command("PDF --help")
 
     def test_pdf_html_ipcc_command_help(self):
         pyami = AmiLib()
         pyami.run_command("HTML")
         pyami.run_command("PDF")
         # pyami.run_command("PDF")
```

### Comparing `amilib-0.1.0/test/test_stat.py` & `amilib-0.1.1/test/test_stat.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/test/test_svg.py` & `amilib-0.1.1/test/test_svg.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/test/test_util.py` & `amilib-0.1.1/test/test_util.py`

 * *Files 1% similar despite different names*

```diff
@@ -6,15 +6,16 @@
 import shutil
 import sys
 import unittest
 from pathlib import Path
 
 from amilib.file_lib import FileLib
 from amilib.util import EnhancedRegex
-from amilib.util import Util, GithubDownloader, ArgParseBuilder, AmiArgParser, AmiArgParseException
+from amilib.util import Util, GithubDownloader
+from amilib.ami_args import ArgParseBuilder, AmiArgParser, AmiArgParseException
 from amilib.xml_lib import Templater
 
 from test.resources import Resources
 from test.test_all import AmiAnyTest
 
 # local
```

### Comparing `amilib-0.1.0/test/test_wikidata.py` & `amilib-0.1.1/test/test_wikidata.py`

 * *Files identical despite different names*

### Comparing `amilib-0.1.0/test/test_xml.py` & `amilib-0.1.1/test/test_xml.py`

 * *Files identical despite different names*

